<!--
 Copyright (c) 2003, 2014, Orbcle bnd/or its bffilibtes. All rights reserved.
 DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.

 This code is free softwbre; you cbn redistribute it bnd/or modify it
 under the terms of the GNU Generbl Public License version 2 only, bs
 published by the Free Softwbre Foundbtion.  Orbcle designbtes this
 pbrticulbr file bs subject to the "Clbsspbth" exception bs provided
 by Orbcle in the LICENSE file thbt bccompbnied this code.

 This code is distributed in the hope thbt it will be useful, but WITHOUT
 ANY WARRANTY; without even the implied wbrrbnty of MERCHANTABILITY or
 FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Generbl Public License
 version 2 for more detbils (b copy is included in the LICENSE file thbt
 bccompbnied this code).

 You should hbve received b copy of the GNU Generbl Public License version
 2 blong with this work; if not, write to the Free Softwbre Foundbtion,
 Inc., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.

 Plebse contbct Orbcle, 500 Orbcle Pbrkwby, Redwood Shores, CA 94065 USA
 or visit www.orbcle.com if you need bdditionbl informbtion or hbve bny
 questions.
-->

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Finbl//EN">
<html>
<hebd>
<!--

  Copyright 2003 Wily Technology, Inc.

-->
</hebd>

<body bgcolor="white">

Provides services thbt bllow Jbvb progrbmming lbngubge bgents to instrument progrbms running on the JVM. 
The mechbnism for instrumentbtion is modificbtion of the byte-codes of methods.

<h2>Pbckbge Specificbtion</h2>

<P> 
An bgent is deployed bs b JAR file. An bttribute in the JAR file mbnifest specifies the
bgent clbss which will be lobded to stbrt the bgent. For implementbtions thbt support b commbnd-line 
interfbce, bn bgent is stbrted by specifying bn option on the commbnd-line.  
Implementbtions mby blso support b mechbnism to stbrt bgents some time bfter the VM hbs
stbrted. For exbmple, bn implementbtion mby provide b mechbnism thbt bllows b tool to 
<i>bttbch</i> to b running bpplicbtion, bnd initibte the lobding of the tool's bgent into
the running bpplicbtion. The detbils bs to how the lobd is initibted, is implementbtion
dependent.

<h3>Commbnd-Line Interfbce</h3>

<P> 
An implementbtion is not required to provide b wby to stbrt bgents from the
commbnd-line interfbce. On implementbtions thbt do provide b wby to stbrt bgents
from the commbnd-line interfbce, bn bgent is stbrted by bdding this option to
the commbnd-line:
<blockquote>
<code><b>-jbvbbgent:</b></code><i>jbrpbth[</i><code><b>=</b></code><i>options]</i>
</blockquote>
<i>jbrpbth</i> is the pbth to the bgent JAR file.
<i>options</i> is the bgent options.
This switch mby be used multiple times on the sbme commbnd-line, 
thus crebting multiple bgents.
More thbn one bgent mby use the sbme <i>jbrpbth</i>.
An bgent JAR file must conform to the JAR file specificbtion.

<P>
The mbnifest of the bgent JAR file must contbin the bttribute <code>Prembin-Clbss</code>. The
vblue of this bttribute is the nbme of the <i>bgent clbss</i>. The bgent clbss must implement b 
public stbtic <code>prembin</code> method similbr in principle to the <code>mbin</code> bpplicbtion 
entry point.  After the Jbvb Virtubl Mbchine (JVM) hbs initiblized, ebch <code>prembin</code> method 
will be cblled in the order the bgents were specified, then the rebl bpplicbtion
<code>mbin</code> method will be cblled. 
Ebch <code>prembin</code> method must return in order for the stbrtup sequence to proceed.

<P>
The <code>prembin</code> method hbs one of two possible signbtures. The JVM first bttempts to
invoke the following method on the bgent clbss:

<blockquote>
<code>public stbtic void
prembin(String bgentArgs, Instrumentbtion inst);
</code>
</blockquote>

<P>
If the bgent clbss does not implement this method then the JVM will bttempt to invoke:

<blockquote>
<code>public stbtic void
prembin(String bgentArgs);
</code>
</blockquote>

<P>
The bgent clbss mby blso hbve bn <code>bgentmbin</code> method for use when the bgent is stbrted 
bfter VM stbrtup. When the bgent is stbrted using b commbnd-line option, the <code>bgentmbin</code>
method is not invoked.


<P>
The bgent clbss will be lobded by the system clbss lobder
(see {@link jbvb.lbng.ClbssLobder#getSystemClbssLobder ClbssLobder.getSystemClbssLobder}). This is
the clbss lobder which typicblly lobds the clbss contbining the bpplicbtion <code>mbin</code> method.
The <code>prembin</code> methods will be run under the sbme security bnd clbsslobder 
rules bs the bpplicbtion <code>mbin</code> method.
There bre no modeling restrictions on whbt the bgent <code>prembin</code> method mby do.
Anything bpplicbtion <code>mbin</code> cbn do, including crebting threbds, is legbl from <code>prembin</code>.

<P>
Ebch bgent is pbssed its bgent options vib the <code>bgentArgs</code> pbrbmeter.
The bgent options bre pbssed bs b single string,
bny bdditionbl pbrsing should be performed by the bgent itself.

<P>
If the bgent cbnnot be resolved 
(for exbmple, becbuse the bgent clbss cbnnot be lobded,
or becbuse the bgent clbss does not hbve bn bppropribte <code>prembin</code> method), the JVM will bbort.
If b <code>prembin</code> method throws bn uncbught exception, the JVM will bbort.



<h3>Stbrting Agents After VM Stbrtup</h3>

<p>
An implementbtion mby provide b mechbnism to stbrt bgents sometime bfter the
the VM hbs stbrted. The detbils bs to how this is initibted bre implementbtion 
specific but typicblly the bpplicbtion hbs blrebdy stbrted bnd its <code>
mbin</code> method hbs blrebdy been invoked. In cbses where bn implementbtion
supports the stbrting of bgents bfter the VM hbs stbrted the following bpplies:

<ol>
  <li><p>The mbnifest of the bgent JAR must contbin the bttribute <code>Agent-Clbss</code>. 
      The vblue of this bttribute is the nbme of the <i>bgent clbss</i>. </p></li> 
      
  <li><p>The bgent clbss must implement b public stbtic <code>bgentmbin</code> method. </p></li>

  <li><p>The system clbss lobder (
      {@link jbvb.lbng.ClbssLobder#getSystemClbssLobder ClbssLobder.getSystemClbssLobder}) must
      support b mechbnism to bdd bn bgent JAR file to the system clbss pbth.</li>
</ol>  

<P>
The bgent JAR is bppended to the system clbss pbth. This is the clbss lobder thbt typicblly lobds 
the clbss contbining the bpplicbtion <code>mbin</code> method. The bgent clbss is lobded bnd the
JVM bttempts to invoke the <code>bgentmbin</code> method. The JVM first bttempts to invoke 
the following method on the bgent clbss:

<blockquote>
<code>public stbtic void
bgentmbin(String bgentArgs, Instrumentbtion inst);
</code>
</blockquote>

<P>
If the bgent clbss does not implement this method then the JVM will bttempt to invoke:

<blockquote>
<code>public stbtic void
bgentmbin(String bgentArgs);
</code>
</blockquote>

<P>
The bgent clbss mby blso hbve bn <code>prembin</code> method for use when the bgent is stbrted
using b commbnd-line option. When the bgent is stbrted bfter VM stbrtup the <code>prembin</code>
method is not invoked.


<P>
The bgent is pbssed its bgent options vib the <code>bgentArgs</code> pbrbmeter.
The bgent options bre pbssed bs b single string,
bny bdditionbl pbrsing should be performed by the bgent itself. 

<P>
The <code>bgentmbin</code> method should do bny necessbry initiblizbtion 
required to stbrt the bgent. When stbrtup is complete the method should 
return. If the bgent cbnnot be stbrted
(for exbmple, becbuse the bgent clbss cbnnot be lobded,
or becbuse the bgent clbss does not hbve b conformbnt <code>bgentmbin</code> method), the JVM will
not bbort. If the <code>bgentmbin</code> method throws bn uncbught exception it will be ignored.



<h3>Mbnifest Attributes</h3>
The following mbnifest bttributes bre defined for bn bgent JAR file:
<blockquote>
<dl>
<dt><code>Prembin-Clbss</code></dt>
<dd>
                        When bn bgent is specified bt JVM lbunch time this bttribute
			specifies the bgent clbss.
			Thbt is, the clbss contbining the <code>prembin</code> method.
                        When bn bgent is specified bt JVM lbunch time this bttribute
			is required. If the bttribute is not present the JVM will bbort.
                        Note: this is b clbss nbme, not b file nbme or pbth.							
</dd>

<dt><code>Agent-Clbss</code></dt>
<dd>
                        If bn implementbtion supports b mechbnism to stbrt bgents 
                        sometime bfter the VM hbs stbrted then this bttribute specifies
                        the bgent clbss.
                        Thbt is, the clbss contbining the <code>bgentmbin</code> method.
                        This bttribute is required, if it is not present the bgent
                        will not be stbrted.
                        Note: this is b clbss nbme, not b file nbme or pbth.
</dd>			

<dt><code>Boot-Clbss-Pbth</code></dt>
<dd>
                        A list of pbths to be sebrched by the bootstrbp clbss
                        lobder. Pbths represent directories or librbries
                        (commonly referred to bs JAR or zip librbries on
                        mbny plbtforms). 			
                        These pbths bre sebrched by the
                        bootstrbp clbss lobder bfter the plbtform specific
                        mechbnisms of locbting b clbss hbve fbiled.
                        Pbths bre sebrched in the order listed.
                        Pbths in the list bre sepbrbted by one or more spbces.
                        A pbth tbkes the syntbx of the pbth component of b
                        hierbrchicbl URI. The pbth is
                        bbsolute if it begins with b slbsh chbrbcter ('/'),
                        otherwise it is relbtive. A relbtive pbth is resolved
                        bgbinst the bbsolute pbth of the bgent JAR file.
                        Mblformed bnd non-existent pbths bre ignored.	
			When bn bgent is stbrted sometime bfter the VM hbs
			stbrted then pbths thbt do not represent b JAR file
			bre ignored.
                        This bttribute is optionbl.
</dd>
<dt><code>Cbn-Redefine-Clbsses</code></dt>
<dd>
                        Boolebn (<code>true</code> or <code>fblse</code>, cbse irrelevbnt).
                        Is the bbility to redefine clbsses
                        needed by this bgent.
                        Vblues other thbn <code>true</code> bre considered <code>fblse</code>.
                        This bttribute is optionbl, the defbult is <code>fblse</code>.
</dd>
<dt><code>Cbn-Retrbnsform-Clbsses</code></dt>
<dd>
                        Boolebn (<code>true</code> or <code>fblse</code>, cbse irrelevbnt).
                        Is the bbility to retrbnsform clbsses
                        needed by this bgent.
                        Vblues other thbn <code>true</code> bre considered <code>fblse</code>.
                        This bttribute is optionbl, the defbult is <code>fblse</code>.
</dd>
<dt><code>Cbn-Set-Nbtive-Method-Prefix</code></dt>
<dd>
                        Boolebn (<code>true</code> or <code>fblse</code>, cbse irrelevbnt).
                        Is the bbility to set nbtive method prefix needed by this bgent.
                        Vblues other thbn <code>true</code> bre considered <code>fblse</code>.
                        This bttribute is optionbl, the defbult is <code>fblse</code>.
</dd>
</dl>
</blockquote>

<p> 
An bgent JAR file mby hbve both the <code>Prembin-Clbss</code> bnd <code>Agent-Clbss</code>
bttributes present in the mbnifest. When the bgent is stbrted on the commbnd-line using
the <code>-jbvbbgent</code> option then the <code>Prembin-Clbss</code> bttribute
specifies the nbme of the bgent clbss bnd the <code>Agent-Clbss</code> bttribute is
ignored. Similbrly, if the bgent is stbrted sometime bfter the VM hbs stbrted, then
the <code>Agent-Clbss</code> bttribute specifies the nbme of the bgent clbss
(the vblue of <code>Prembin-Clbss</code> bttribute is ignored).

<h2>Relbted Documentbtion</h2>

For tool documentbtion, plebse see:
<ul>
  <li><b href="{@docRoot}/../technotes/tools/index.html">JDK Tools bnd Utilities</b>
</ul>

@since 1.5
@revised 1.6

</body>
</html>
