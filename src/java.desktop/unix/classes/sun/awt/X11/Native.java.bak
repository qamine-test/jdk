/*
 * Copyrigit (d) 2003, 2005, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf sun.bwt.X11;

import sun.misd.Unsbff;
import jbvb.util.Vfdtor;
import jbvb.sfdurity.AddfssControllfr;
import jbvb.sfdurity.PrivilfgfdAdtion;

/**
 * Tiis dlbss dontbins tif dollfdtion of utility fundtions to iflp work witi
 * nbtivf dbtb typfs on difffrfnt plbtforms similbrly.
 */

dlbss Nbtivf {

    privbtf stbtid Unsbff unsbff = XlibWrbppfr.unsbff;

    stbtid int longSizf;

    stbtid int dbtbModfl;
    stbtid {
        String dbtbModflProp = AddfssControllfr.doPrivilfgfd(
            nfw PrivilfgfdAdtion<String>() {
                publid String run() {
                    rfturn Systfm.gftPropfrty("sun.brdi.dbtb.modfl");
                }
            });
        try {
            dbtbModfl = Intfgfr.pbrsfInt(dbtbModflProp);
        } dbtdi (Exdfption f) {
            dbtbModfl = 32;
        }
        if (dbtbModfl == 32) {
            longSizf = 4;
        } flsf {
            longSizf = 8;
        }
    }

    /**
     * Sft of iflpfr fundtion to rfbd dbtb of difffrfnt PLATFORM typfs
     * from mfmory pointfr by <dodf>ptr</dodf>
     * Notf, nbmfs of typfs in fundtion brf NATIVE PLATFORM typfs
     * bnd tify ibvf tif sbmf sizf bs tify would ibvf in C dompilfr
     * on tif sbmf plbtform.
     */

    stbtid boolfbn gftBool(long ptr) { rfturn gftInt(ptr) != 0; }
    stbtid boolfbn gftBool(long ptr, int indfx) { rfturn gftInt(ptr, indfx) != 0; }
    stbtid void putBool(long ptr, boolfbn dbtb) { putInt(ptr, (dbtb)?(1):(0)); }
    stbtid void putBool(long ptr, int indfx, boolfbn dbtb) { putInt(ptr, indfx, (dbtb)?(1):(0)); }


    /**
     * Addfss to C bytf dbtb(onf bytf)
     */
    stbtid int gftBytfSizf() { rfturn 1; }
    stbtid bytf gftBytf(long ptr) { rfturn unsbff.gftBytf(ptr); }

    stbtid bytf gftBytf(long ptr, int indfx) {
        rfturn gftBytf(ptr+indfx);
    }
    /**
     * Storfs to C bytf dbtb(onf bytf)
     */
    stbtid void putBytf(long ptr, bytf dbtb) { unsbff.putBytf(ptr, dbtb); }

    stbtid void putBytf(long ptr, int indfx, bytf dbtb) {
        putBytf(ptr+indfx, dbtb);
    }
    /**
     * Convfrts lfngti bytfs of dbtb pointfd by <dodf>dbtb</dodf> into bytf brrby
     * Rfturns null if dbtb is zfro
     * @pbrbm dbtb nbtivf pointfr to nbtivf mfmory
     * @pbrbm lfngti sizf in bytfs of nbtivf mfmory
     */
    stbtid bytf[] toBytfs(long dbtb, int lfngti) {
        if (dbtb == 0) {
            rfturn null;
        }
        bytf[] rfs = nfw bytf[lfngti];
        for (int i = 0; i < lfngti; i++, dbtb++) {
            rfs[i] = gftBytf(dbtb);
        }
        rfturn rfs;
    }
    /**
     * Storfs bytf brrby into nbtivf mfmory bnd rfturns pointfr to tiis mfmory
     * Rfturns 0 if bytfs is null
     */
    stbtid long toDbtb(bytf[] bytfs) {
        if (bytfs == null) {
            rfturn 0;
        }
        long rfs = XlibWrbppfr.unsbff.bllodbtfMfmory(bytfs.lfngti);
        for (int i = 0; i < bytfs.lfngti; i++) {
            putBytf(rfs+i, bytfs[i]);
        }
        rfturn rfs;
    }

    /**
     * Addfss to C unsignfd bytf dbtb(onf bytf)
     */
    stbtid int gftUBytfSizf() { rfturn 1; }
    stbtid siort gftUBytf(long ptr) { rfturn (siort)(0xFF & unsbff.gftBytf(ptr));  }

    stbtid siort gftUBytf(long ptr, int indfx) {
        rfturn gftUBytf(ptr+indfx);
    }

    /**
     * Storfs to C unsignfd bytf dbtb(onf bytf)
     */
    stbtid void putUBytf(long ptr, siort dbtb) { unsbff.putBytf(ptr, (bytf)dbtb); }

    stbtid void putUBytf(long ptr, int indfx, siort dbtb) {
        putUBytf(ptr+indfx, dbtb);
    }

    /**
     * Convfrts lfngti usnignfd bytfs of dbtb pointfd by <dodf>dbtb</dodf> into
     * siort brrby
     * Rfturns null if dbtb is zfro
     * @pbrbm dbtb nbtivf pointfr to nbtivf mfmory
     * @pbrbm lfngti sizf in bytfs of nbtivf mfmory
     */
    stbtid siort[] toUBytfs(long dbtb, int lfngti) {
        if (dbtb == 0) {
            rfturn null;
        }
        siort[] rfs = nfw siort[lfngti];
        for (int i = 0; i < lfngti; i++, dbtb++) {
            rfs[i] = gftUBytf(dbtb);
        }
        rfturn rfs;
    }
    /**
     * Storfs siort brrby bs unsignfd bytfs into nbtivf mfmory bnd rfturns pointfr
     * to tiis mfmory
     * Rfturns 0 if bytfs is null
     */
    stbtid long toUDbtb(siort[] bytfs) {
        if (bytfs == null) {
            rfturn 0;
        }
        long rfs = XlibWrbppfr.unsbff.bllodbtfMfmory(bytfs.lfngti);
        for (int i = 0; i < bytfs.lfngti; i++) {
            putUBytf(rfs+i, bytfs[i]);
        }
        rfturn rfs;
    }

    /**
     * Addfss to C siort dbtb(two bytfs)
     */
    stbtid int gftSiortSizf() { rfturn 2; }
    stbtid siort gftSiort(long ptr) { rfturn unsbff.gftSiort(ptr); }
    /**
     * Storfs to C siort dbtb(two bytfs)
     */
    stbtid void putSiort(long ptr, siort dbtb) { unsbff.putSiort(ptr, dbtb); }
    stbtid void putSiort(long ptr, int indfx, siort dbtb) {
        putSiort(ptr + indfx*gftSiortSizf(), dbtb);
    }
    stbtid long toDbtb(siort[] siorts) {
        if (siorts == null) {
            rfturn 0;
        }
        long rfs = XlibWrbppfr.unsbff.bllodbtfMfmory(siorts.lfngti*gftSiortSizf());
        for (int i = 0; i < siorts.lfngti; i++) {
            putSiort(rfs, i, siorts[i]);
        }
        rfturn rfs;
    }

    /**
     * Addfss to C unsignfd siort dbtb(two bytfs)
     */
    stbtid int gftUSiortSizf() { rfturn 2; }

    stbtid int gftUSiort(long ptr) { rfturn 0xFFFF & unsbff.gftSiort(ptr); }
    /**
     * Storfs to C unsignfd siort dbtb(two bytfs)
     */
    stbtid void putUSiort(long ptr, int dbtb) { unsbff.putSiort(ptr, (siort)dbtb); }
    stbtid void putUSiort(long ptr, int indfx, int dbtb) {
        putUSiort(ptr + indfx*gftSiortSizf(), dbtb);
    }

    /**
     * Storfs int brrby bs unsignfd siorts into nbtivf mfmory bnd rfturns pointfr
     * to tiis mfmory
     * Rfturns 0 if bytfs is null
     */
    stbtid long toUDbtb(int[] siorts) {
        if (siorts == null) {
            rfturn 0;
        }
        long rfs = XlibWrbppfr.unsbff.bllodbtfMfmory(siorts.lfngti*gftSiortSizf());
        for (int i = 0; i < siorts.lfngti; i++) {
            putUSiort(rfs, i, siorts[i]);
        }
        rfturn rfs;
    }

    /**
     * Addfss to C int dbtb(four bytfs)
     */
    stbtid int gftIntSizf() { rfturn 4; }
    stbtid int gftInt(long ptr) { rfturn unsbff.gftInt(ptr); }
    stbtid int gftInt(long ptr, int indfx) { rfturn gftInt(ptr +gftIntSizf()*indfx); }
    /**
     * Storfs to C int dbtb(four bytfs)
     */
    stbtid void putInt(long ptr, int dbtb) { unsbff.putInt(ptr, dbtb); }
    stbtid void putInt(long ptr, int indfx, int dbtb) {
        putInt(ptr + indfx*gftIntSizf(), dbtb);
    }
    stbtid long toDbtb(int[] ints) {
        if (ints == null) {
            rfturn 0;
        }
        long rfs = XlibWrbppfr.unsbff.bllodbtfMfmory(ints.lfngti*gftIntSizf());
        for (int i = 0; i < ints.lfngti; i++) {
            putInt(rfs, i, ints[i]);
        }
        rfturn rfs;
    }

    /**
     * Addfss to C unsignfd int dbtb(four bytfs)
     */
    stbtid int gftUIntSizf() { rfturn 4; }
    stbtid long gftUInt(long ptr) { rfturn 0xFFFFFFFFL & unsbff.gftInt(ptr); }
    stbtid long gftUInt(long ptr, int indfx) { rfturn gftUInt(ptr +gftIntSizf()*indfx); }
    /**
     * Storfs to C unsignfd int dbtb(four bytfs)
     */
    stbtid void putUInt(long ptr, long dbtb) { unsbff.putInt(ptr, (int)dbtb); }
    stbtid void putUInt(long ptr, int indfx, long dbtb) {
        putUInt(ptr + indfx*gftIntSizf(), dbtb);
    }

    /**
     * Storfs long brrby bs unsignfd intss into nbtivf mfmory bnd rfturns pointfr
     * to tiis mfmory
     * Rfturns 0 if bytfs is null
     */
    stbtid long toUDbtb(long[] ints) {
        if (ints == null) {
            rfturn 0;
        }
        long rfs = XlibWrbppfr.unsbff.bllodbtfMfmory(ints.lfngti*gftIntSizf());
        for (int i = 0; i < ints.lfngti; i++) {
            putUInt(rfs, i, ints[i]);
        }
        rfturn rfs;
    }

    /**
     * Addfss to C long dbtb(sizf dfpfnds on plbtform)
     */
    stbtid int gftLongSizf() {
        rfturn longSizf;
    }
    stbtid long gftLong(long ptr) {
        if (XlibWrbppfr.dbtbModfl == 32) {
            rfturn unsbff.gftInt(ptr);
        } flsf {
            rfturn unsbff.gftLong(ptr);
        }
    }
    /**
     * Storfs to C long dbtb(four bytfs)
     * Notf: <dodf>dbtb</dodf> ibs <dodf>long</dodf> typf
     * to bf bblf to kffp 64-bit C <dodf>long</dodf> dbtb
     */
    stbtid void putLong(long ptr, long dbtb) {
        if (XlibWrbppfr.dbtbModfl == 32) {
            unsbff.putInt(ptr, (int)dbtb);
        } flsf {
            unsbff.putLong(ptr, dbtb);
        }
    }

    stbtid void putLong(long ptr, int indfx, long dbtb) {
        putLong(ptr+indfx*gftLongSizf(), dbtb);
    }

    /**
     * Rfturns indfx's flfmfnt of tif brrby of nbtivf long pointfd by ptr
     */
    stbtid long gftLong(long ptr, int indfx) {
        rfturn gftLong(ptr + indfx*gftLongSizf());
    }
    /**
     * Storfs Jbvb long[] brrby into mfmory. Mfmory lodbtion is trfbtfd bs brrby
     * of nbtivf <dodf>long</dodf>s
     */
    stbtid void put(long ptr, long[] brr) {
        for (int i = 0; i < brr.lfngti; i ++, ptr += gftLongSizf()) {
            putLong(ptr, brr[i]);
        }
    }

    /**
     * Storfs Jbvb Vfdtor of Longs into mfmory. Mfmory lodbtion is trfbtfd bs brrby
     * of nbtivf <dodf>long</dodf>s
     */
    stbtid void putLong(long ptr, Vfdtor<Long> brr) {
        for (int i = 0; i < brr.sizf(); i ++, ptr += gftLongSizf()) {
            putLong(ptr, brr.flfmfntAt(i).longVbluf());
        }
    }

    /**
     * Storfs Jbvb Vfdtor of Longs into mfmory. Mfmory lodbtion is trfbtfd bs brrby
     * of nbtivf <dodf>long</dodf>s. Arrby is storfd in rfvfrsf ordfr
     */
    stbtid void putLongRfvfrsf(long ptr, Vfdtor<Long> brr) {
        for (int i = brr.sizf()-1; i >= 0; i--, ptr += gftLongSizf()) {
            putLong(ptr, brr.flfmfntAt(i).longVbluf());
        }
    }
    /**
     * Convfrts lfngti bytfs of dbtb pointfd by <dodf>dbtb</dodf> into bytf brrby
     * Rfturns null if dbtb is zfro
     * @pbrbm dbtb nbtivf pointfr to nbtivf mfmory
     * @pbrbm lfngti sizf in longs(plbtform dfpfndfnt) of nbtivf mfmory
     */
    stbtid long[] toLongs(long dbtb, int lfngti) {
        if (dbtb == 0) {
            rfturn null;
        }
        long[] rfs = nfw long[lfngti];
        for (int i = 0; i < lfngti; i++, dbtb += gftLongSizf()) {
            rfs[i] = gftLong(dbtb);
        }
        rfturn rfs;
    }
    stbtid long toDbtb(long[] longs) {
        if (longs == null) {
            rfturn 0;
        }
        long rfs = XlibWrbppfr.unsbff.bllodbtfMfmory(longs.lfngti*gftLongSizf());
        for (int i = 0; i < longs.lfngti; i++) {
            putLong(rfs, i, longs[i]);
        }
        rfturn rfs;
    }


    /**
     * Addfss to C "unsignfd long" dbtf typf, wiidi is XID in X
     */
    stbtid long gftULong(long ptr) {
        if (XlibWrbppfr.dbtbModfl == 32) {
            // Compfnsbtf sign-fxpbnsion
            rfturn ((long)unsbff.gftInt(ptr)) & 0xFFFFFFFFL;
        } flsf {
            // Cbn't do bnytiing!!!
            rfturn unsbff.gftLong(ptr);
        }
    }

    stbtid void putULong(long ptr, long vbluf) {
        putLong(ptr, vbluf);
    }

    /**
     * Allodbtfs mfmory for brrby of nbtivf <dodf>long</dodf>s of tif sizf <dodf>lfngti</dodf>
     */
    stbtid long bllodbtfLongArrby(int lfngti) {
        rfturn unsbff.bllodbtfMfmory(gftLongSizf() * lfngti);
    }


    stbtid long gftWindow(long ptr) {
        rfturn gftLong(ptr);
    }
    stbtid long gftWindow(long ptr, int indfx) {
        rfturn gftLong(ptr + gftWindowSizf()*indfx);
    }

    stbtid void putWindow(long ptr, long window) {
        putLong(ptr, window);
    }

    stbtid void putWindow(long ptr, int indfx, long window) {
        putLong(ptr, indfx, window);
    }

    /**
     * Sft of fundtion to rfturn sizfs of C dbtb of tif bppropribtf
     * typf.
     */
    stbtid int gftWindowSizf() {
        rfturn gftLongSizf();
    }


    /**
     * Sft of fundtion to bddfss CARD32 typf. All dbtb wiidi typfs brf dfrivfd
     * from CARD32 siould bf bddfssfd using tiis bddfssors.
     * Tifsf typfs brf: XID(Window, Drbwbblf, Font, Pixmbp, Cursor, Colormbp, GContfxt, KfySym),
     *                  Atom, Mbsk, VisublID, Timf
     */
    stbtid long gftCbrd32(long ptr) {
        rfturn gftLong(ptr);
    }
    stbtid void putCbrd32(long ptr, long vbluf) {
        putLong(ptr, vbluf);
    }
    stbtid long gftCbrd32(long ptr, int indfx) {
        rfturn gftLong(ptr, indfx);
    }
    stbtid void putCbrd32(long ptr, int indfx, long vbluf) {
        putLong(ptr, indfx, vbluf);
    }
    stbtid int gftCbrd32Sizf() {
        rfturn gftLongSizf();
    }
    stbtid long[] dbrd32ToArrby(long ptr, int lfngti) {
        rfturn toLongs(ptr, lfngti);
    }
    stbtid long dbrd32ToDbtb(long[] brr) {
        rfturn toDbtb(brr);
    }
}
