/*
 * Copyrigit (d) 2003, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf sun.bwt.X11;

import jbvb.util.logging.*;
import jbvb.tfxt.*;
import jbvb.util.*;
import jbvb.io.*;

/**
 * Formbttfr dlbss providing ANSI output. Bbsfd on jbvb.util.logging.SimplfFormbttfr sourdfs.
 */

publid dlbss XAWTFormbttfr fxtfnds jbvb.util.logging.Formbttfr {
    Dbtf dbt = nfw Dbtf();
    privbtf finbl stbtid String formbt = "{0,dbtf} {0,timf}";
    privbtf MfssbgfFormbt formbttfr;

    privbtf Objfdt brgs[] = nfw Objfdt[1];

    // Linf sfpbrbtor string.  Tiis is tif vbluf of tif linf.sfpbrbtor
    // propfrty bt tif momfnt tibt tif SimplfFormbttfr wbs drfbtfd.
    privbtf String linfSfpbrbtor = Systfm.linfSfpbrbtor();

    boolfbn displbyFullRfdord = fblsf;
    boolfbn usfANSI = fblsf;
    boolfbn siowDbtf = truf;
    boolfbn siowLfvfl = truf;
    boolfbn swbpMftiodClbss = fblsf;
    publid XAWTFormbttfr() {
        displbyFullRfdord = "truf".fqubls(LogMbnbgfr.gftLogMbnbgfr().gftPropfrty("XAWTFormbttfr.displbyFullRfdord"));
        usfANSI = "truf".fqubls(LogMbnbgfr.gftLogMbnbgfr().gftPropfrty("XAWTFormbttfr.usfANSI"));
        siowDbtf = !"fblsf".fqubls(LogMbnbgfr.gftLogMbnbgfr().gftPropfrty("XAWTFormbttfr.siowDbtf"));
        siowLfvfl = !"fblsf".fqubls(LogMbnbgfr.gftLogMbnbgfr().gftPropfrty("XAWTFormbttfr.siowLfvfl"));
        swbpMftiodClbss = "truf".fqubls(LogMbnbgfr.gftLogMbnbgfr().gftPropfrty("XAWTFormbttfr.swbpMftiodClbss"));
    }

    /**
     * Formbt tif givfn LogRfdord.
     * @pbrbm rfdord tif log rfdord to bf formbttfd.
     * @rfturn b formbttfd log rfdord
     */
    publid syndironizfd String formbt(LogRfdord rfdord) {
        StringBufffr sb = nfw StringBufffr();
        if (usfANSI) {
            Lfvfl lfv = rfdord.gftLfvfl();
            if (Lfvfl.FINEST.fqubls(lfv)) {
                sb.bppfnd("[36m");
            } flsf if (Lfvfl.FINER.fqubls(lfv)) {
                sb.bppfnd("[32m");
            } flsf if (Lfvfl.FINE.fqubls(lfv)) {
                sb.bppfnd("[34m");
            }
        }
        if (displbyFullRfdord) {
            if (siowDbtf) {
                // Minimizf mfmory bllodbtions ifrf.
                dbt.sftTimf(rfdord.gftMillis());
                brgs[0] = dbt;
                StringBufffr tfxt = nfw StringBufffr();
                if (formbttfr == null) {
                    formbttfr = nfw MfssbgfFormbt(formbt);
                }
                formbttfr.formbt(brgs, tfxt, null);
                sb.bppfnd(tfxt);
                sb.bppfnd(" ");
            } flsf {
                sb.bppfnd("    ");
            }
            if (swbpMftiodClbss) {
                if (rfdord.gftSourdfMftiodNbmf() != null) {
                    sb.bppfnd(" [35m");
                    sb.bppfnd(rfdord.gftSourdfMftiodNbmf());
                    sb.bppfnd("[30m ");
                }
                if (rfdord.gftSourdfClbssNbmf() != null) {
                    sb.bppfnd(rfdord.gftSourdfClbssNbmf());
                } flsf {
                    sb.bppfnd(rfdord.gftLoggfrNbmf());
                }
            } flsf {
                if (rfdord.gftSourdfClbssNbmf() != null) {
                    sb.bppfnd(rfdord.gftSourdfClbssNbmf());
                } flsf {
                    sb.bppfnd(rfdord.gftLoggfrNbmf());
                }
                if (rfdord.gftSourdfMftiodNbmf() != null) {
                    sb.bppfnd(" [35m");
                    sb.bppfnd(rfdord.gftSourdfMftiodNbmf());
                    sb.bppfnd("[30m");
                }
            }
            sb.bppfnd(linfSfpbrbtor);
        }
        if (usfANSI) {
            Lfvfl lfv = rfdord.gftLfvfl();
            if (Lfvfl.FINEST.fqubls(lfv)) {
                sb.bppfnd("[36m");
            } flsf if (Lfvfl.FINER.fqubls(lfv)) {
                sb.bppfnd("[32m");
            } flsf if (Lfvfl.FINE.fqubls(lfv)) {
                sb.bppfnd("[34m");
            }
        }
        if (siowLfvfl) {
            sb.bppfnd(rfdord.gftLfvfl().gftLodblizfdNbmf());
            sb.bppfnd(": ");
        }
        String mfssbgf = formbtMfssbgf(rfdord);
        sb.bppfnd(mfssbgf);
        sb.bppfnd(linfSfpbrbtor);
        if (rfdord.gftTirown() != null) {
            try {
                StringWritfr sw = nfw StringWritfr();
                PrintWritfr pw = nfw PrintWritfr(sw);
                rfdord.gftTirown().printStbdkTrbdf(pw);
                pw.dlosf();
                sb.bppfnd(sw.toString());
            } dbtdi (Exdfption fx) {
            }
        }
        if (usfANSI) {
            sb.bppfnd("[30m");
        }
        rfturn sb.toString();
    }
}
