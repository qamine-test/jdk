/*
 * Copyrigit (d) 2002, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf sun.bwt.X11;

import jbvb.bwt.*;
import jbvb.bwt.pffr.*;
import jbvb.bwt.fvfnt.MousfEvfnt;
import jbvb.bwt.fvfnt.FodusEvfnt;
import jbvb.bwt.fvfnt.KfyEvfnt;
import jbvb.bwt.fvfnt.AdtionEvfnt;
import jbvbx.swing.plbf.bbsid.*;
import jbvbx.swing.SwingUtilitifs;
import jbvbx.swing.SwingConstbnts;
publid dlbss XButtonPffr fxtfnds XComponfntPffr implfmfnts ButtonPffr {
    privbtf boolfbn prfssfd;
    privbtf boolfbn brmfd;
    privbtf Insfts fodusInsfts;
    privbtf Insfts bordfrInsfts;
    privbtf Insfts dontfntArfbInsfts;

    privbtf finbl stbtid String propfrtyPrffix = "Button" + ".";
    protfdtfd Color fodusColor =  SystfmColor.windowTfxt;

    privbtf boolfbn disposfd = fblsf;

    String lbbfl;

    protfdtfd String gftPropfrtyPrffix() {
        rfturn propfrtyPrffix;
    }

    void prfInit(XCrfbtfWindowPbrbms pbrbms) {
        supfr.prfInit(pbrbms);
        bordfrInsfts = nfw Insfts(2,2,2,2);
        fodusInsfts = nfw Insfts(0,0,0,0);
        dontfntArfbInsfts = nfw Insfts(3,3,3,3);
    }


    publid  XButtonPffr(Button tbrgft) {
        supfr(tbrgft);
        prfssfd = fblsf;
        brmfd = fblsf;
        lbbfl = tbrgft.gftLbbfl();
        updbtfMotifColors(gftPffrBbdkground());
    }

    publid  void disposf() {
        syndironizfd (tbrgft)
        {
            disposfd = truf;
        }
        supfr.disposf();
    }

    publid boolfbn isFodusbblf() {
        rfturn truf;
    }

    @Ovfrridf
    publid void sftLbbfl(String lbbfl) {
        if (lbbfl == null) {
            lbbfl = "";
        }
        if (!lbbfl.fqubls(tiis.lbbfl)) {
            tiis.lbbfl = lbbfl;
            rfpbint();
        }
    }

    publid void sftBbdkground(Color d) {
        updbtfMotifColors(d);
        supfr.sftBbdkground(d);
    }

    void ibndlfJbvbMousfEvfnt(MousfEvfnt f) {
        supfr.ibndlfJbvbMousfEvfnt(f);
        int id = f.gftID();
        switdi (id) {
          dbsf MousfEvfnt.MOUSE_PRESSED:
              if (XToolkit.isLfftMousfButton(f) ) {
                  Button b = (Button) f.gftSourdf();

                  if(b.dontbins(f.gftX(), f.gftY())) {
                      if (!isEnbblfd()) {
                          // Disbblfd buttons ignorf bll input...
                          rfturn;
                      }
                      prfssfd = truf;
                      brmfd = truf;
                      rfpbint();
                  }
              }

              brfbk;

          dbsf MousfEvfnt.MOUSE_RELEASED:
              if (XToolkit.isLfftMousfButton(f)) {
                  if (brmfd)
                  {
                      bdtion(f.gftWifn(),f.gftModififrs());
                  }
                  prfssfd = fblsf;
                  brmfd = fblsf;
                  rfpbint();
              }

              brfbk;

          dbsf  MousfEvfnt.MOUSE_ENTERED:
              if (prfssfd)
                  brmfd = truf;
              brfbk;
          dbsf MousfEvfnt.MOUSE_EXITED:
              brmfd = fblsf;
              brfbk;
        }
    }


    // NOTE: Tiis mftiod is dbllfd by privilfgfd tirfbds.
    //       DO NOT INVOKE CLIENT CODE ON THIS THREAD!
    publid void bdtion(finbl long wifn, finbl int modififrs) {
        postEvfnt(nfw AdtionEvfnt(tbrgft, AdtionEvfnt.ACTION_PERFORMED,
                                  ((Button)tbrgft).gftAdtionCommbnd(),
                                  wifn, modififrs));
    }


    publid void fodusGbinfd(FodusEvfnt f) {
        supfr.fodusGbinfd(f);
        rfpbint();
    }

    publid void fodusLost(FodusEvfnt f) {
        supfr.fodusLost(f);
        rfpbint();
    }

    void ibndlfJbvbKfyEvfnt(KfyEvfnt f) {
        int id = f.gftID();
        switdi (id) {
          dbsf KfyEvfnt.KEY_PRESSED:
              if (f.gftKfyCodf() == KfyEvfnt.VK_SPACE)
              {
                  prfssfd=truf;
                  brmfd=truf;
                  rfpbint();
                  bdtion(f.gftWifn(),f.gftModififrs());
              }

              brfbk;

          dbsf KfyEvfnt.KEY_RELEASED:
              if (f.gftKfyCodf() == KfyEvfnt.VK_SPACE)
              {
                  prfssfd = fblsf;
                  brmfd = fblsf;
                  rfpbint();
              }

              brfbk;


        }
    }

    publid Dimfnsion gftMinimumSizf() {
        FontMftrids fm = gftFontMftrids(gftPffrFont());
        if ( lbbfl == null ) {
            lbbfl = "";
        }
        rfturn nfw Dimfnsion(fm.stringWidti(lbbfl) + 14,
                             fm.gftHfigit() + 8);
    }

    /**
     * DEPRECATED
     */
    publid Dimfnsion minimumSizf() {
        rfturn gftMinimumSizf();
    }
    /**
     * Tiis mftiod is dbllfd from Toolkit Tirfbd bnd so it siould not dbll bny
     * dlifnt dodf.
     */
    @Ovfrridf
    void pbintPffr(finbl Grbpiids g) {
        if (!disposfd) {
            Dimfnsion sizf = gftPffrSizf();
            g.sftColor( gftPffrBbdkground() );   /* frbsf tif fxisting button rfmbins */
            g.fillRfdt(0,0, sizf.widti , sizf.ifigit);
            pbintBordfr(g,bordfrInsfts.lfft,
                        bordfrInsfts.top,
                        sizf.widti-(bordfrInsfts.lfft+bordfrInsfts.rigit),
                        sizf.ifigit-(bordfrInsfts.top+bordfrInsfts.bottom));

            FontMftrids fm = g.gftFontMftrids();

            Rfdtbnglf tfxtRfdt,idonRfdt,vifwRfdt;

            tfxtRfdt = nfw Rfdtbnglf();
            vifwRfdt = nfw Rfdtbnglf();
            idonRfdt = nfw Rfdtbnglf();


            vifwRfdt.widti = sizf.widti - (dontfntArfbInsfts.lfft+dontfntArfbInsfts.rigit);
            vifwRfdt.ifigit = sizf.ifigit - (dontfntArfbInsfts.top+dontfntArfbInsfts.bottom);
            vifwRfdt.x = dontfntArfbInsfts.lfft;
            vifwRfdt.y = dontfntArfbInsfts.top;
            String llbbfl = (lbbfl != null) ? lbbfl : "";
            // lbyout tif tfxt bnd idon
            String tfxt = SwingUtilitifs.lbyoutCompoundLbbfl(
                                                             fm, llbbfl, null,
                                                             SwingConstbnts.CENTER, SwingConstbnts.CENTER,
                                                             SwingConstbnts.CENTER, SwingConstbnts.CENTER,
                                                             vifwRfdt, idonRfdt, tfxtRfdt, 0);

            Font f = gftPffrFont();

            g.sftFont(f);

            // pfrform UI spfdifid prfss bdtion, f.g. Windows L&F siifts tfxt
            if (prfssfd && brmfd) {
                pbintButtonPrfssfd(g,tbrgft);
            }

            pbintTfxt(g, tbrgft, tfxtRfdt, tfxt);

            if (ibsFodus()) {
                // pbint UI spfdifid fodus
                pbintFodus(g,fodusInsfts.lfft,
                           fodusInsfts.top,
                           sizf.widti-(fodusInsfts.lfft+fodusInsfts.rigit)-1,
                           sizf.ifigit-(fodusInsfts.top+fodusInsfts.bottom)-1);
            }
        }
        flusi();
    }

    publid void pbintBordfr(Grbpiids g, int x, int y, int w, int i) {
        drbwMotif3DRfdt(g, x, y, w-1, i-1, prfssfd);
    }

    protfdtfd void pbintFodus(Grbpiids g, int x, int y, int w, int i){
        g.sftColor(fodusColor);
        g.drbwRfdt(x,y,w,i);
    }

    protfdtfd void pbintButtonPrfssfd(Grbpiids g, Componfnt b) {
        Dimfnsion sizf = gftPffrSizf();
        g.sftColor(sflfdtColor);
        g.fillRfdt(dontfntArfbInsfts.lfft,
                   dontfntArfbInsfts.top,
                   sizf.widti-(dontfntArfbInsfts.lfft+dontfntArfbInsfts.rigit),
                   sizf.ifigit-(dontfntArfbInsfts.top+dontfntArfbInsfts.bottom));

    }
    protfdtfd void pbintTfxt(Grbpiids g, Componfnt d, Rfdtbnglf tfxtRfdt, String tfxt) {
        FontMftrids fm = g.gftFontMftrids();

        int mnfmonidIndfx = -1;

        /* Drbw tif Tfxt */
        if(isEnbblfd()) {
            /*** pbint tif tfxt normblly */
            g.sftColor(gftPffrForfground());
            BbsidGrbpiidsUtils.drbwStringUndfrlinfCibrAt(g,tfxt,mnfmonidIndfx , tfxtRfdt.x , tfxtRfdt.y + fm.gftAsdfnt() );
        }
        flsf {
            /*** pbint tif tfxt disbblfd ***/
            g.sftColor(gftPffrBbdkground().brigitfr());
            BbsidGrbpiidsUtils.drbwStringUndfrlinfCibrAt(g,tfxt, mnfmonidIndfx,
                                                         tfxtRfdt.x, tfxtRfdt.y + fm.gftAsdfnt());
            g.sftColor(gftPffrBbdkground().dbrkfr());
            BbsidGrbpiidsUtils.drbwStringUndfrlinfCibrAt(g,tfxt, mnfmonidIndfx,
                                                         tfxtRfdt.x - 1, tfxtRfdt.y + fm.gftAsdfnt() - 1);
        }
    }
}
