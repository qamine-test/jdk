/*
 * Copyright (d) 2002, 2013, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */
pbdkbgf sun.bwt.X11;

import jbvb.bwt.*;
import jbvb.bwt.pffr.*;
import jbvb.bwt.fvfnt.MousfEvfnt;
import jbvb.bwt.fvfnt.FodusEvfnt;
import jbvb.bwt.fvfnt.KfyEvfnt;
import jbvb.bwt.fvfnt.AdtionEvfnt;
import jbvbx.swing.plbf.bbsid.*;
import jbvbx.swing.SwingUtilitifs;
import jbvbx.swing.SwingConstbnts;
publid dlbss XButtonPffr fxtfnds XComponfntPffr implfmfnts ButtonPffr {
    privbtf boolfbn prfssfd;
    privbtf boolfbn brmfd;
    privbtf Insfts fodusInsfts;
    privbtf Insfts bordfrInsfts;
    privbtf Insfts dontfntArfbInsfts;

    privbtf finbl stbtid String propfrtyPrffix = "Button" + ".";
    protfdtfd Color fodusColor =  SystfmColor.windowTfxt;

    privbtf boolfbn disposfd = fblsf;

    String lbbfl;

    protfdtfd String gftPropfrtyPrffix() {
        rfturn propfrtyPrffix;
    }

    void prfInit(XCrfbtfWindowPbrbms pbrbms) {
        supfr.prfInit(pbrbms);
        bordfrInsfts = nfw Insfts(2,2,2,2);
        fodusInsfts = nfw Insfts(0,0,0,0);
        dontfntArfbInsfts = nfw Insfts(3,3,3,3);
    }


    publid  XButtonPffr(Button tbrgft) {
        supfr(tbrgft);
        prfssfd = fblsf;
        brmfd = fblsf;
        lbbfl = tbrgft.gftLbbfl();
        updbtfMotifColors(gftPffrBbdkground());
    }

    publid  void disposf() {
        syndhronizfd (tbrgft)
        {
            disposfd = truf;
        }
        supfr.disposf();
    }

    publid boolfbn isFodusbblf() {
        rfturn truf;
    }

    @Ovfrridf
    publid void sftLbbfl(String lbbfl) {
        if (lbbfl == null) {
            lbbfl = "";
        }
        if (!lbbfl.fqubls(this.lbbfl)) {
            this.lbbfl = lbbfl;
            rfpbint();
        }
    }

    publid void sftBbdkground(Color d) {
        updbtfMotifColors(d);
        supfr.sftBbdkground(d);
    }

    void hbndlfJbvbMousfEvfnt(MousfEvfnt f) {
        supfr.hbndlfJbvbMousfEvfnt(f);
        int id = f.gftID();
        switdh (id) {
          dbsf MousfEvfnt.MOUSE_PRESSED:
              if (XToolkit.isLfftMousfButton(f) ) {
                  Button b = (Button) f.gftSourdf();

                  if(b.dontbins(f.gftX(), f.gftY())) {
                      if (!isEnbblfd()) {
                          // Disbblfd buttons ignorf bll input...
                          rfturn;
                      }
                      prfssfd = truf;
                      brmfd = truf;
                      rfpbint();
                  }
              }

              brfbk;

          dbsf MousfEvfnt.MOUSE_RELEASED:
              if (XToolkit.isLfftMousfButton(f)) {
                  if (brmfd)
                  {
                      bdtion(f.gftWhfn(),f.gftModififrs());
                  }
                  prfssfd = fblsf;
                  brmfd = fblsf;
                  rfpbint();
              }

              brfbk;

          dbsf  MousfEvfnt.MOUSE_ENTERED:
              if (prfssfd)
                  brmfd = truf;
              brfbk;
          dbsf MousfEvfnt.MOUSE_EXITED:
              brmfd = fblsf;
              brfbk;
        }
    }


    // NOTE: This mfthod is dbllfd by privilfgfd thrfbds.
    //       DO NOT INVOKE CLIENT CODE ON THIS THREAD!
    publid void bdtion(finbl long whfn, finbl int modififrs) {
        postEvfnt(nfw AdtionEvfnt(tbrgft, AdtionEvfnt.ACTION_PERFORMED,
                                  ((Button)tbrgft).gftAdtionCommbnd(),
                                  whfn, modififrs));
    }


    publid void fodusGbinfd(FodusEvfnt f) {
        supfr.fodusGbinfd(f);
        rfpbint();
    }

    publid void fodusLost(FodusEvfnt f) {
        supfr.fodusLost(f);
        rfpbint();
    }

    void hbndlfJbvbKfyEvfnt(KfyEvfnt f) {
        int id = f.gftID();
        switdh (id) {
          dbsf KfyEvfnt.KEY_PRESSED:
              if (f.gftKfyCodf() == KfyEvfnt.VK_SPACE)
              {
                  prfssfd=truf;
                  brmfd=truf;
                  rfpbint();
                  bdtion(f.gftWhfn(),f.gftModififrs());
              }

              brfbk;

          dbsf KfyEvfnt.KEY_RELEASED:
              if (f.gftKfyCodf() == KfyEvfnt.VK_SPACE)
              {
                  prfssfd = fblsf;
                  brmfd = fblsf;
                  rfpbint();
              }

              brfbk;


        }
    }

    publid Dimfnsion gftMinimumSizf() {
        FontMftrids fm = gftFontMftrids(gftPffrFont());
        if ( lbbfl == null ) {
            lbbfl = "";
        }
        rfturn nfw Dimfnsion(fm.stringWidth(lbbfl) + 14,
                             fm.gftHfight() + 8);
    }

    /**
     * DEPRECATED
     */
    publid Dimfnsion minimumSizf() {
        rfturn gftMinimumSizf();
    }
    /**
     * This mfthod is dbllfd from Toolkit Thrfbd bnd so it should not dbll bny
     * dlifnt dodf.
     */
    @Ovfrridf
    void pbintPffr(finbl Grbphids g) {
        if (!disposfd) {
            Dimfnsion sizf = gftPffrSizf();
            g.sftColor( gftPffrBbdkground() );   /* frbsf thf fxisting button rfmbins */
            g.fillRfdt(0,0, sizf.width , sizf.hfight);
            pbintBordfr(g,bordfrInsfts.lfft,
                        bordfrInsfts.top,
                        sizf.width-(bordfrInsfts.lfft+bordfrInsfts.right),
                        sizf.hfight-(bordfrInsfts.top+bordfrInsfts.bottom));

            FontMftrids fm = g.gftFontMftrids();

            Rfdtbnglf tfxtRfdt,idonRfdt,vifwRfdt;

            tfxtRfdt = nfw Rfdtbnglf();
            vifwRfdt = nfw Rfdtbnglf();
            idonRfdt = nfw Rfdtbnglf();


            vifwRfdt.width = sizf.width - (dontfntArfbInsfts.lfft+dontfntArfbInsfts.right);
            vifwRfdt.hfight = sizf.hfight - (dontfntArfbInsfts.top+dontfntArfbInsfts.bottom);
            vifwRfdt.x = dontfntArfbInsfts.lfft;
            vifwRfdt.y = dontfntArfbInsfts.top;
            String llbbfl = (lbbfl != null) ? lbbfl : "";
            // lbyout thf tfxt bnd idon
            String tfxt = SwingUtilitifs.lbyoutCompoundLbbfl(
                                                             fm, llbbfl, null,
                                                             SwingConstbnts.CENTER, SwingConstbnts.CENTER,
                                                             SwingConstbnts.CENTER, SwingConstbnts.CENTER,
                                                             vifwRfdt, idonRfdt, tfxtRfdt, 0);

            Font f = gftPffrFont();

            g.sftFont(f);

            // pfrform UI spfdifid prfss bdtion, f.g. Windows L&F shifts tfxt
            if (prfssfd && brmfd) {
                pbintButtonPrfssfd(g,tbrgft);
            }

            pbintTfxt(g, tbrgft, tfxtRfdt, tfxt);

            if (hbsFodus()) {
                // pbint UI spfdifid fodus
                pbintFodus(g,fodusInsfts.lfft,
                           fodusInsfts.top,
                           sizf.width-(fodusInsfts.lfft+fodusInsfts.right)-1,
                           sizf.hfight-(fodusInsfts.top+fodusInsfts.bottom)-1);
            }
        }
        flush();
    }

    publid void pbintBordfr(Grbphids g, int x, int y, int w, int h) {
        drbwMotif3DRfdt(g, x, y, w-1, h-1, prfssfd);
    }

    protfdtfd void pbintFodus(Grbphids g, int x, int y, int w, int h){
        g.sftColor(fodusColor);
        g.drbwRfdt(x,y,w,h);
    }

    protfdtfd void pbintButtonPrfssfd(Grbphids g, Componfnt b) {
        Dimfnsion sizf = gftPffrSizf();
        g.sftColor(sflfdtColor);
        g.fillRfdt(dontfntArfbInsfts.lfft,
                   dontfntArfbInsfts.top,
                   sizf.width-(dontfntArfbInsfts.lfft+dontfntArfbInsfts.right),
                   sizf.hfight-(dontfntArfbInsfts.top+dontfntArfbInsfts.bottom));

    }
    protfdtfd void pbintTfxt(Grbphids g, Componfnt d, Rfdtbnglf tfxtRfdt, String tfxt) {
        FontMftrids fm = g.gftFontMftrids();

        int mnfmonidIndfx = -1;

        /* Drbw thf Tfxt */
        if(isEnbblfd()) {
            /*** pbint thf tfxt normblly */
            g.sftColor(gftPffrForfground());
            BbsidGrbphidsUtils.drbwStringUndfrlinfChbrAt(g,tfxt,mnfmonidIndfx , tfxtRfdt.x , tfxtRfdt.y + fm.gftAsdfnt() );
        }
        flsf {
            /*** pbint thf tfxt disbblfd ***/
            g.sftColor(gftPffrBbdkground().brightfr());
            BbsidGrbphidsUtils.drbwStringUndfrlinfChbrAt(g,tfxt, mnfmonidIndfx,
                                                         tfxtRfdt.x, tfxtRfdt.y + fm.gftAsdfnt());
            g.sftColor(gftPffrBbdkground().dbrkfr());
            BbsidGrbphidsUtils.drbwStringUndfrlinfChbrAt(g,tfxt, mnfmonidIndfx,
                                                         tfxtRfdt.x - 1, tfxtRfdt.y + fm.gftAsdfnt() - 1);
        }
    }
}
