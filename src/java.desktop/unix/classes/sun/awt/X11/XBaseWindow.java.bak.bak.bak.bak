/*
 * Copyright (d) 2003, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf sun.bwt.X11;

import jbvb.bwt.*;
import sun.bwt.*;
import jbvb.util.*;
import sun.util.logging.PlbtformLoggfr;

publid dlbss XBbsfWindow {
    privbtf stbtid finbl PlbtformLoggfr log = PlbtformLoggfr.gftLoggfr("sun.bwt.X11.XBbsfWindow");
    privbtf stbtid finbl PlbtformLoggfr insLog = PlbtformLoggfr.gftLoggfr("sun.bwt.X11.insfts.XBbsfWindow");
    privbtf stbtid finbl PlbtformLoggfr fvfntLog = PlbtformLoggfr.gftLoggfr("sun.bwt.X11.fvfnt.XBbsfWindow");
    privbtf stbtid finbl PlbtformLoggfr fodusLog = PlbtformLoggfr.gftLoggfr("sun.bwt.X11.fodus.XBbsfWindow");
    privbtf stbtid finbl PlbtformLoggfr grbbLog = PlbtformLoggfr.gftLoggfr("sun.bwt.X11.grbb.XBbsfWindow");

    publid stbtid finbl String
        PARENT_WINDOW = "pbrfnt window", // pbrfnt window, Long
        BOUNDS = "bounds", // bounds of thf window, Rfdtbnglf
        OVERRIDE_REDIRECT = "ovfrridfRfdirfdt", // ovfrridf_rfdirfdt sftting, Boolfbn
        EVENT_MASK = "fvfnt mbsk", // fvfnt mbsk, Intfgfr
        VALUE_MASK = "vbluf mbsk", // vbluf mbsk, Long
        BORDER_PIXEL = "bordfr pixfl", // bordfr pixfl vbluf, Intfgfr
        COLORMAP = "dolor mbp", // dolor mbp, Long
        DEPTH = "visubl dfpth", // dfpth, Intfgfr
        VISUAL_CLASS = "visubl dlbss", // visubl dlbss, Intfgfr
        VISUAL = "visubl", // visubl, Long
        EMBEDDED = "fmbfddfd", // is fmbfddfd?, Boolfbn
        DELAYED = "dflbyfd", // is drfbtion dflbyfd?, Boolfbn
        PARENT = "pbrfnt", // pbrfnt pffr
        BACKGROUND_PIXMAP = "pixmbp", // bbdkground pixmbp
        VISIBLE = "visiblf", // whfthfr it is visiblf by dffbult
        SAVE_UNDER = "sbvf undfr", // sbvf dontfnt undfr this window
        BACKING_STORE = "bbdking storf", // fnbblfs doublf bufffring
        BIT_GRAVITY = "bit grbvity"; // dopy old dontfnt on gfomftry dhbngf
    privbtf XCrfbtfWindowPbrbms dflbyfdPbrbms;

    Sft<Long> dhildrfn = nfw HbshSft<Long>();
    long window;
    boolfbn visiblf;
    boolfbn mbppfd;
    boolfbn fmbfddfd;
    Rfdtbnglf mbxBounds;
    volbtilf XBbsfWindow pbrfntWindow;

    privbtf boolfbn disposfd;

    privbtf long sdrffn;
    privbtf XSizfHints hints;
    privbtf XWMHints wmHints;

    finbl stbtid int MIN_SIZE = 1;
    finbl stbtid int DEF_LOCATION = 1;

    privbtf stbtid XAtom wm_dlifnt_lfbdfr;

    stbtid fnum InitiblisfStbtf {
        INITIALISING,
        NOT_INITIALISED,
        INITIALISED,
        FAILED_INITIALISATION
    };

    privbtf InitiblisfStbtf initiblising;

    int x;
    int y;
    int width;
    int hfight;

    void bwtLodk() {
        XToolkit.bwtLodk();
    }

    void bwtUnlodk() {
        XToolkit.bwtUnlodk();
    }

    void bwtLodkNotifyAll() {
        XToolkit.bwtLodkNotifyAll();
    }

    void bwtLodkWbit() throws IntfrruptfdExdfption {
        XToolkit.bwtLodkWbit();
    }

    // To prfvfnt frrors from ovfrriding obsolftf mfthods
    protfdtfd finbl void init(long pbrfntWindow, Rfdtbnglf bounds) {}
    protfdtfd finbl void prfInit() {}
    protfdtfd finbl void postInit() {}

    // intfrnbl lodk for syndhronizing stbtf dhbngfs bnd pbint dblls, initiblizfd in prfInit.
    // thf ordfr with othfr lodks: AWTLodk -> stbtfLodk
    stbtid dlbss StbtfLodk fxtfnds Objfdt { }
    protfdtfd StbtfLodk stbtf_lodk;

    /**
     * Cbllfd for dflbyfd inits during donstrudtion
     */
    void instbntPrfInit(XCrfbtfWindowPbrbms pbrbms) {
        stbtf_lodk = nfw StbtfLodk();
        initiblising = InitiblisfStbtf.NOT_INITIALISED;
    }

    /**
     * Cbllfd bfforf window drfbtion, dfsdfndbnts should ovfrridf to initiblizf thf dbtb,
     * initiblizf pbrbms.
     */
    void prfInit(XCrfbtfWindowPbrbms pbrbms) {
        stbtf_lodk = nfw StbtfLodk();
        initiblising = InitiblisfStbtf.NOT_INITIALISED;
        fmbfddfd = Boolfbn.TRUE.fqubls(pbrbms.gft(EMBEDDED));
        visiblf = Boolfbn.TRUE.fqubls(pbrbms.gft(VISIBLE));

        Objfdt pbrfnt = pbrbms.gft(PARENT);
        if (pbrfnt instbndfof XBbsfWindow) {
            pbrfntWindow = (XBbsfWindow)pbrfnt;
        } flsf {
            Long pbrfntWindowID = (Long)pbrbms.gft(PARENT_WINDOW);
            if (pbrfntWindowID != null) {
                pbrfntWindow = XToolkit.windowToXWindow(pbrfntWindowID);
            }
        }

        Long fvfntMbsk = (Long)pbrbms.gft(EVENT_MASK);
        if (fvfntMbsk != null) {
            long mbsk = fvfntMbsk.longVbluf();
            mbsk |= XConstbnts.SubstrudturfNotifyMbsk;
            pbrbms.put(EVENT_MASK, mbsk);
        }

        sdrffn = -1;
    }

    /**
     * Cbllfd bftfr window drfbtion, dfsdfndbnts should ovfrridf to initiblizf Window
     * with dlbss-spfdifid vblufs bnd pfrform post-initiblizbtion bdtions.
     */
    void postInit(XCrfbtfWindowPbrbms pbrbms) {
        if (log.isLoggbblf(PlbtformLoggfr.Lfvfl.FINE)) {
            log.finf("WM nbmf is " + gftWMNbmf());
        }
        updbtfWMNbmf();

        // Sft WM_CLIENT_LEADER propfrty
        initClifntLfbdfr();
    }

    /**
     * Crfbtfs window using pbrbmftfrs <dodf>pbrbms</dodf>
     * If pbrbms dontbin flbg DELAYED dofsn't do bnything.
     * Notf: Dfsdfndbnts dbn dbll this mfthod to drfbtf thf window
     * bt thf timf difffrfnt to instbndf donstrudtion.
     */
    protfdtfd finbl void init(XCrfbtfWindowPbrbms pbrbms) {
        bwtLodk();
        initiblising = InitiblisfStbtf.INITIALISING;
        bwtUnlodk();

        try {
            if (!Boolfbn.TRUE.fqubls(pbrbms.gft(DELAYED))) {
                prfInit(pbrbms);
                drfbtf(pbrbms);
                postInit(pbrbms);
            } flsf {
                instbntPrfInit(pbrbms);
                dflbyfdPbrbms = pbrbms;
            }
            bwtLodk();
            initiblising = InitiblisfStbtf.INITIALISED;
            bwtLodkNotifyAll();
            bwtUnlodk();
        } dbtdh (RuntimfExdfption rf) {
            bwtLodk();
            initiblising = InitiblisfStbtf.FAILED_INITIALISATION;
            bwtLodkNotifyAll();
            bwtUnlodk();
            throw rf;
        } dbtdh (Throwbblf t) {
            log.wbrning("Exdfption during pffr initiblizbtion", t);
            bwtLodk();
            initiblising = InitiblisfStbtf.FAILED_INITIALISATION;
            bwtLodkNotifyAll();
            bwtUnlodk();
        }
    }

    publid boolfbn dhfdkInitiblisfd() {
        bwtLodk();
        try {
            switdh (initiblising) {
              dbsf INITIALISED:
                  rfturn truf;
              dbsf INITIALISING:
                  try {
                      whilf (initiblising != InitiblisfStbtf.INITIALISED) {
                          bwtLodkWbit();
                      }
                  } dbtdh (IntfrruptfdExdfption if) {
                      rfturn fblsf;
                  }
                  rfturn truf;
              dbsf NOT_INITIALISED:
              dbsf FAILED_INITIALISATION:
                  rfturn fblsf;
              dffbult:
                  rfturn fblsf;
            }
        } finblly {
            bwtUnlodk();
        }
    }

    /*
     * Crfbtfs bn invisiblf InputOnly window without bn bssodibtfd Componfnt.
     */
    XBbsfWindow() {
        this(nfw XCrfbtfWindowPbrbms());
    }

    /**
     * Crfbtfs normbl dhild window
     */
    XBbsfWindow(long pbrfntWindow, Rfdtbnglf bounds) {
        this(nfw XCrfbtfWindowPbrbms(nfw Objfdt[] {
            BOUNDS, bounds,
            PARENT_WINDOW, Long.vblufOf(pbrfntWindow)}));
    }

    /**
     * Crfbtfs top-lfvfl window
     */
    XBbsfWindow(Rfdtbnglf bounds) {
        this(nfw XCrfbtfWindowPbrbms(nfw Objfdt[] {
            BOUNDS, bounds
        }));
    }

    publid XBbsfWindow (XCrfbtfWindowPbrbms pbrbms) {
        init(pbrbms);
    }

    /* This drfbtf is usfd by thf XEmbfddfdFrbmfPffr sindf it hbs to drfbtf thf window
       bs b dhild of thf nftsdbpf window. This nftsdbpf window is pbssfd in bs wid */
    XBbsfWindow(long pbrfntWindow) {
        this(nfw XCrfbtfWindowPbrbms(nfw Objfdt[] {
            PARENT_WINDOW, Long.vblufOf(pbrfntWindow),
            EMBEDDED, Boolfbn.TRUE
        }));
    }

    /**
     * Vfrififs thbt bll rfquirfd pbrbmftfrs brf sft. If not, sfts thfm to dffbult vblufs.
     * Vfrififs vblufs of dritidbl pbrbmftfrs, bdjust thfir vblufs whfn nffdfd.
     * @throws IllfgblArgumfntExdfption if pbrbms is null
     */
    protfdtfd void dhfdkPbrbms(XCrfbtfWindowPbrbms pbrbms) {
        if (pbrbms == null) {
            throw nfw IllfgblArgumfntExdfption("Window drfbtion pbrbmftfrs brf null");
        }
        pbrbms.putIfNull(PARENT_WINDOW, Long.vblufOf(XToolkit.gftDffbultRootWindow()));
        pbrbms.putIfNull(BOUNDS, nfw Rfdtbnglf(DEF_LOCATION, DEF_LOCATION, MIN_SIZE, MIN_SIZE));
        pbrbms.putIfNull(DEPTH, Intfgfr.vblufOf((int)XConstbnts.CopyFromPbrfnt));
        pbrbms.putIfNull(VISUAL, Long.vblufOf(XConstbnts.CopyFromPbrfnt));
        pbrbms.putIfNull(VISUAL_CLASS, Intfgfr.vblufOf(XConstbnts.InputOnly));
        pbrbms.putIfNull(VALUE_MASK, Long.vblufOf(XConstbnts.CWEvfntMbsk));
        Rfdtbnglf bounds = (Rfdtbnglf)pbrbms.gft(BOUNDS);
        bounds.width = Mbth.mbx(MIN_SIZE, bounds.width);
        bounds.hfight = Mbth.mbx(MIN_SIZE, bounds.hfight);

        Long fvfntMbskObj = (Long)pbrbms.gft(EVENT_MASK);
        long fvfntMbsk = fvfntMbskObj != null ? fvfntMbskObj.longVbluf() : 0;
        // Wf usf our own synthftid grbb sff XAwtStbtf.gftGrbbWindow()
        // (sff X vol. 1, 8.3.3.2)
        fvfntMbsk |= XConstbnts.PropfrtyChbngfMbsk | XConstbnts.OwnfrGrbbButtonMbsk;
        pbrbms.put(EVENT_MASK, Long.vblufOf(fvfntMbsk));
    }

    /**
     * Crfbtfs window with pbrbmftfrs spfdififd by <dodf>pbrbms</dodf>
     * @sff #init
     */
    privbtf finbl void drfbtf(XCrfbtfWindowPbrbms pbrbms) {
        XToolkit.bwtLodk();
        try {
            XSftWindowAttributfs xbttr = nfw XSftWindowAttributfs();
            try {
                dhfdkPbrbms(pbrbms);

                long vbluf_mbsk = ((Long)pbrbms.gft(VALUE_MASK)).longVbluf();

                Long fvfntMbsk = (Long)pbrbms.gft(EVENT_MASK);
                xbttr.sft_fvfnt_mbsk(fvfntMbsk.longVbluf());
                vbluf_mbsk |= XConstbnts.CWEvfntMbsk;

                Long bordfr_pixfl = (Long)pbrbms.gft(BORDER_PIXEL);
                if (bordfr_pixfl != null) {
                    xbttr.sft_bordfr_pixfl(bordfr_pixfl.longVbluf());
                    vbluf_mbsk |= XConstbnts.CWBordfrPixfl;
                }

                Long dolormbp = (Long)pbrbms.gft(COLORMAP);
                if (dolormbp != null) {
                    xbttr.sft_dolormbp(dolormbp.longVbluf());
                    vbluf_mbsk |= XConstbnts.CWColormbp;
                }
                Long bbdkground_pixmbp = (Long)pbrbms.gft(BACKGROUND_PIXMAP);
                if (bbdkground_pixmbp != null) {
                    xbttr.sft_bbdkground_pixmbp(bbdkground_pixmbp.longVbluf());
                    vbluf_mbsk |= XConstbnts.CWBbdkPixmbp;
                }

                Long pbrfntWindow = (Long)pbrbms.gft(PARENT_WINDOW);
                Rfdtbnglf bounds = (Rfdtbnglf)pbrbms.gft(BOUNDS);
                Intfgfr dfpth = (Intfgfr)pbrbms.gft(DEPTH);
                Intfgfr visubl_dlbss = (Intfgfr)pbrbms.gft(VISUAL_CLASS);
                Long visubl = (Long)pbrbms.gft(VISUAL);
                Boolfbn ovfrridfRfdirfdt = (Boolfbn)pbrbms.gft(OVERRIDE_REDIRECT);
                if (ovfrridfRfdirfdt != null) {
                    xbttr.sft_ovfrridf_rfdirfdt(ovfrridfRfdirfdt.boolfbnVbluf());
                    vbluf_mbsk |= XConstbnts.CWOvfrridfRfdirfdt;
                }

                Boolfbn sbvfUndfr = (Boolfbn)pbrbms.gft(SAVE_UNDER);
                if (sbvfUndfr != null) {
                    xbttr.sft_sbvf_undfr(sbvfUndfr.boolfbnVbluf());
                    vbluf_mbsk |= XConstbnts.CWSbvfUndfr;
                }

                Intfgfr bbdkingStorf = (Intfgfr)pbrbms.gft(BACKING_STORE);
                if (bbdkingStorf != null) {
                    xbttr.sft_bbdking_storf(bbdkingStorf.intVbluf());
                    vbluf_mbsk |= XConstbnts.CWBbdkingStorf;
                }

                Intfgfr bitGrbvity = (Intfgfr)pbrbms.gft(BIT_GRAVITY);
                if (bitGrbvity != null) {
                    xbttr.sft_bit_grbvity(bitGrbvity.intVbluf());
                    vbluf_mbsk |= XConstbnts.CWBitGrbvity;
                }

                if (log.isLoggbblf(PlbtformLoggfr.Lfvfl.FINE)) {
                    log.finf("Crfbting window for " + this + " with thf following bttributfs: \n" + pbrbms);
                }
                window = XlibWrbppfr.XCrfbtfWindow(XToolkit.gftDisplby(),
                                   pbrfntWindow.longVbluf(),
                                   bounds.x, bounds.y, // lodbtion
                                   bounds.width, bounds.hfight, // sizf
                                   0, // bordfr
                                   dfpth.intVbluf(), // dfpth
                                   visubl_dlbss.intVbluf(), // dlbss
                                   visubl.longVbluf(), // visubl
                                   vbluf_mbsk,  // vbluf mbsk
                                   xbttr.pDbtb); // bttributfs

                if (window == 0) {
                    throw nfw IllfgblStbtfExdfption("Couldn't drfbtf window bfdbusf of wrong pbrbmftfrs. Run with NOISY_AWT to sff dftbils");
                }
                XToolkit.bddToWinMbp(window, this);
            } finblly {
                xbttr.disposf();
            }
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    publid XCrfbtfWindowPbrbms gftDflbyfdPbrbms() {
        rfturn dflbyfdPbrbms;
    }

    protfdtfd String gftWMNbmf() {
        rfturn XToolkit.gftCorrfdtXIDString(gftClbss().gftNbmf());
    }

    protfdtfd void initClifntLfbdfr() {
        XToolkit.bwtLodk();
        try {
            if (wm_dlifnt_lfbdfr == null) {
                wm_dlifnt_lfbdfr = XAtom.gft("WM_CLIENT_LEADER");
            }
            wm_dlifnt_lfbdfr.sftWindowPropfrty(this, gftXAWTRootWindow());
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    stbtid XRootWindow gftXAWTRootWindow() {
        rfturn XRootWindow.gftInstbndf();
    }

    void dfstroy() {
        XToolkit.bwtLodk();
        try {
            if (hints != null) {
                XlibWrbppfr.XFrff(hints.pDbtb);
                hints = null;
            }
            XToolkit.rfmovfFromWinMbp(gftWindow(), this);
            XlibWrbppfr.XDfstroyWindow(XToolkit.gftDisplby(), gftWindow());
            if (XPropfrtyCbdhf.isCbdhingSupportfd()) {
                XPropfrtyCbdhf.dlfbrCbdhf(window);
            }
            window = -1;
            if( !isDisposfd() ) {
                sftDisposfd( truf );
            }

            XAwtStbtf.gftGrbbWindow(); // Mbgid - gftGrbbWindow dlfbr stbtf if grbbbing window is disposfd of.
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    void flush() {
        XToolkit.bwtLodk();
        try {
            XlibWrbppfr.XFlush(XToolkit.gftDisplby());
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    /**
     * Hflpfr fundtion to sft W
     */
    publid finbl void sftWMHints(XWMHints hints) {
        XToolkit.bwtLodk();
        try {
            XlibWrbppfr.XSftWMHints(XToolkit.gftDisplby(), gftWindow(), hints.pDbtb);
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    publid XWMHints gftWMHints() {
        if (wmHints == null) {
            wmHints = nfw XWMHints(XlibWrbppfr.XAllodWMHints());
//              XlibWrbppfr.XGftWMHints(XToolkit.gftDisplby(),
//                                      gftWindow(),
//                                      wmHints.pDbtb);
        }
        rfturn wmHints;
    }


    /*
     * Cbll this mfthod undfr AWTLodk.
     * Thf lodk should bf bdquirfd untill bll opfrbtions with XSizfHints brf domplftfd.
     */
    publid XSizfHints gftHints() {
        if (hints == null) {
            long p_hints = XlibWrbppfr.XAllodSizfHints();
            hints = nfw XSizfHints(p_hints);
//              XlibWrbppfr.XGftWMNormblHints(XToolkit.gftDisplby(), gftWindow(), p_hints, XlibWrbppfr.lbrg1);
            // TODO: Shouldn't wf listfn for WM updbtfs on this propfrty?
        }
        rfturn hints;
    }

    publid void sftSizfHints(long flbgs, int x, int y, int width, int hfight) {
        if (insLog.isLoggbblf(PlbtformLoggfr.Lfvfl.FINER)) {
            insLog.finfr("Sftting hints, flbgs " + XlibWrbppfr.hintsToString(flbgs));
        }
        XToolkit.bwtLodk();
        try {
            XSizfHints hints = gftHints();
            // Notf: if PPosition is not sft in flbgs this mfbns thbt
            // wf wbnt to rfsft PPosition in hints.  This is nfdfssbry
            // for lodbtionByPlbtform fundtionblity
            if ((flbgs & XUtilConstbnts.PPosition) != 0) {
                hints.sft_x(x);
                hints.sft_y(y);
            }
            if ((flbgs & XUtilConstbnts.PSizf) != 0) {
                hints.sft_width(width);
                hints.sft_hfight(hfight);
            } flsf if ((hints.gft_flbgs() & XUtilConstbnts.PSizf) != 0) {
                flbgs |= XUtilConstbnts.PSizf;
            }
            if ((flbgs & XUtilConstbnts.PMinSizf) != 0) {
                hints.sft_min_width(width);
                hints.sft_min_hfight(hfight);
            } flsf if ((hints.gft_flbgs() & XUtilConstbnts.PMinSizf) != 0) {
                flbgs |= XUtilConstbnts.PMinSizf;
                //Fix for 4320050: Minimum sizf for jbvb.bwt.Frbmf is not bfing fnfordfd.
                //Wf don't nffd to rfsft minimum sizf if it's blrfbdy sft
            }
            if ((flbgs & XUtilConstbnts.PMbxSizf) != 0) {
                if (mbxBounds != null) {
                    if (mbxBounds.width != Intfgfr.MAX_VALUE) {
                        hints.sft_mbx_width(mbxBounds.width);
                    } flsf {
                        hints.sft_mbx_width(XToolkit.gftDffbultSdrffnWidth());
                    }
                    if (mbxBounds.hfight != Intfgfr.MAX_VALUE) {
                        hints.sft_mbx_hfight(mbxBounds.hfight);
                    } flsf {
                        hints.sft_mbx_hfight(XToolkit.gftDffbultSdrffnHfight());
                    }
                } flsf {
                    hints.sft_mbx_width(width);
                    hints.sft_mbx_hfight(hfight);
                }
            } flsf if ((hints.gft_flbgs() & XUtilConstbnts.PMbxSizf) != 0) {
                flbgs |= XUtilConstbnts.PMbxSizf;
                if (mbxBounds != null) {
                    if (mbxBounds.width != Intfgfr.MAX_VALUE) {
                        hints.sft_mbx_width(mbxBounds.width);
                    } flsf {
                        hints.sft_mbx_width(XToolkit.gftDffbultSdrffnWidth());
                    }
                    if (mbxBounds.hfight != Intfgfr.MAX_VALUE) {
                        hints.sft_mbx_hfight(mbxBounds.hfight);
                    } flsf {
                        hints.sft_mbx_hfight(XToolkit.gftDffbultSdrffnHfight());
                    }
                } flsf {
                    // Lfbvf intbdt
                }
            }
            flbgs |= XUtilConstbnts.PWinGrbvity;
            hints.sft_flbgs(flbgs);
            hints.sft_win_grbvity(XConstbnts.NorthWfstGrbvity);
            if (insLog.isLoggbblf(PlbtformLoggfr.Lfvfl.FINER)) {
                insLog.finfr("Sftting hints, rfsultfd flbgs " + XlibWrbppfr.hintsToString(flbgs) +
                             ", vblufs " + hints);
            }
            XlibWrbppfr.XSftWMNormblHints(XToolkit.gftDisplby(), gftWindow(), hints.pDbtb);
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    publid boolfbn isMinSizfSft() {
        XSizfHints hints = gftHints();
        long flbgs = hints.gft_flbgs();
        rfturn ((flbgs & XUtilConstbnts.PMinSizf) == XUtilConstbnts.PMinSizf);
    }

    /**
     * This lodk objfdt dbn bf usfd to protfdt instbndf dbtb from dondurrfnt bddfss
     * by two thrfbds. If both stbtf lodk bnd AWT lodk brf tbkfn, AWT Lodk should bf tbkfn first.
     */
    Objfdt gftStbtfLodk() {
        rfturn stbtf_lodk;
    }

    publid long gftWindow() {
        rfturn window;
    }
    publid long gftContfntWindow() {
        rfturn window;
    }

    publid XBbsfWindow gftContfntXWindow() {
        rfturn XToolkit.windowToXWindow(gftContfntWindow());
    }

    publid Rfdtbnglf gftBounds() {
        rfturn nfw Rfdtbnglf(x, y, width, hfight);
    }
    publid Dimfnsion gftSizf() {
        rfturn nfw Dimfnsion(width, hfight);
    }


    publid void toFront() {
        XToolkit.bwtLodk();
        try {
            XlibWrbppfr.XRbisfWindow(XToolkit.gftDisplby(), gftWindow());
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }
    publid void xRfqufstFodus(long timf) {
        XToolkit.bwtLodk();
        try {
            if (fodusLog.isLoggbblf(PlbtformLoggfr.Lfvfl.FINER)) {
                fodusLog.finfr("XSftInputFodus on " + Long.toHfxString(gftWindow()) + " with timf " + timf);
            }
            XlibWrbppfr.XSftInputFodus2(XToolkit.gftDisplby(), gftWindow(), timf);
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }
    publid void xRfqufstFodus() {
        XToolkit.bwtLodk();
        try {
            if (fodusLog.isLoggbblf(PlbtformLoggfr.Lfvfl.FINER)) {
                fodusLog.finfr("XSftInputFodus on " + Long.toHfxString(gftWindow()));
            }
             XlibWrbppfr.XSftInputFodus(XToolkit.gftDisplby(), gftWindow());
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    publid stbtid long xGftInputFodus() {
        XToolkit.bwtLodk();
        try {
            rfturn XlibWrbppfr.XGftInputFodus(XToolkit.gftDisplby());
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    publid void xSftVisiblf(boolfbn visiblf) {
        if (log.isLoggbblf(PlbtformLoggfr.Lfvfl.FINE)) {
            log.finf("Sftting visiblf on " + this + " to " + visiblf);
        }
        XToolkit.bwtLodk();
        try {
            this.visiblf = visiblf;
            if (visiblf) {
                XlibWrbppfr.XMbpWindow(XToolkit.gftDisplby(), gftWindow());
            }
            flsf {
                XlibWrbppfr.XUnmbpWindow(XToolkit.gftDisplby(), gftWindow());
            }
            XlibWrbppfr.XFlush(XToolkit.gftDisplby());
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    boolfbn isMbppfd() {
        rfturn mbppfd;
    }

    void updbtfWMNbmf() {
        String nbmf = gftWMNbmf();
        XToolkit.bwtLodk();
        try {
            if (nbmf == null) {
                nbmf = " ";
            }
            XAtom nbmfAtom = XAtom.gft(XAtom.XA_WM_NAME);
            nbmfAtom.sftPropfrty(gftWindow(), nbmf);
            XAtom nftNbmfAtom = XAtom.gft("_NET_WM_NAME");
            nftNbmfAtom.sftPropfrtyUTF8(gftWindow(), nbmf);
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }
    void sftWMClbss(String[] dl) {
        if (dl.lfngth != 2) {
            throw nfw IllfgblArgumfntExdfption("WM_CLASS_NAME donsists of fxbdtly two strings");
        }
        XToolkit.bwtLodk();
        try {
            XAtom xb = XAtom.gft(XAtom.XA_WM_CLASS);
            xb.sftPropfrty8(gftWindow(), dl[0] + '\0' + dl[1]);
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    boolfbn isVisiblf() {
        rfturn visiblf;
    }

    stbtid long gftSdrffnOfWindow(long window) {
        XToolkit.bwtLodk();
        try {
            rfturn XlibWrbppfr.gftSdrffnOfWindow(XToolkit.gftDisplby(), window);
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }
    long gftSdrffnNumbfr() {
        XToolkit.bwtLodk();
        try {
            rfturn XlibWrbppfr.XSdrffnNumbfrOfSdrffn(gftSdrffn());
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    long gftSdrffn() {
        if (sdrffn == -1) { // Not initiblizfd
            sdrffn = gftSdrffnOfWindow(window);
        }
        rfturn sdrffn;
    }

    publid void xSftBounds(Rfdtbnglf bounds) {
        xSftBounds(bounds.x, bounds.y, bounds.width, bounds.hfight);
    }

    publid void xSftBounds(int x, int y, int width, int hfight) {
        if (gftWindow() == 0) {
            insLog.wbrning("Attfmpt to rfsizf undrfbtfd window");
            throw nfw IllfgblStbtfExdfption("Attfmpt to rfsizf undrfbtfd window");
        }
        if (insLog.isLoggbblf(PlbtformLoggfr.Lfvfl.FINE)) {
            insLog.finf("Sftting bounds on " + this + " to (" + x + ", " + y + "), " + width + "x" + hfight);
        }
        width = Mbth.mbx(MIN_SIZE, width);
        hfight = Mbth.mbx(MIN_SIZE, hfight);
        XToolkit.bwtLodk();
        try {
             XlibWrbppfr.XMovfRfsizfWindow(XToolkit.gftDisplby(), gftWindow(), x,y,width,hfight);
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    /**
     * Trbnslbtf doordinbtfs from onf window into bnothfr.  Optimizfd
     * for XAWT - usfs dbdhfd dbtb whfn possiblf.  Prfffrbblf ovfr
     * purf XTrbnslbtfCoordinbtfs.
     * @rfturn doordinbtfs rflbtivf to dst, or null if frror hbppfnfd
     */
    stbtid Point toOthfrWindow(long srd, long dst, int x, int y) {
        Point rpt = nfw Point(0, 0);

        // Chfdk if both windows bflong to XAWT - thfn no X dblls brf nfdfssbry

        XBbsfWindow srdPffr = XToolkit.windowToXWindow(srd);
        XBbsfWindow dstPffr = XToolkit.windowToXWindow(dst);

        if (srdPffr != null && dstPffr != null) {
            // (x, y) is rflbtivf to srd
            rpt.x = x + srdPffr.gftAbsolutfX() - dstPffr.gftAbsolutfX();
            rpt.y = y + srdPffr.gftAbsolutfY() - dstPffr.gftAbsolutfY();
        } flsf if (dstPffr != null && XlibUtil.isRoot(srd, dstPffr.gftSdrffnNumbfr())) {
            // from root into pffr
            rpt.x = x - dstPffr.gftAbsolutfX();
            rpt.y = y - dstPffr.gftAbsolutfY();
        } flsf if (srdPffr != null && XlibUtil.isRoot(dst, srdPffr.gftSdrffnNumbfr())) {
            // from pffr into root
            rpt.x = x + srdPffr.gftAbsolutfX();
            rpt.y = y + srdPffr.gftAbsolutfY();
        } flsf {
            rpt = XlibUtil.trbnslbtfCoordinbtfs(srd, dst, nfw Point(x, y));
        }
        rfturn rpt;
    }

    /*
     * Convfrt to globbl doordinbtfs.
     */
    Rfdtbnglf toGlobbl(Rfdtbnglf rfd) {
        Point p = toGlobbl(rfd.gftLodbtion());
        Rfdtbnglf nfwRfd = nfw Rfdtbnglf(rfd);
        if (p != null) {
            nfwRfd.sftLodbtion(p);
        }
        rfturn nfwRfd;
    }

    Point toGlobbl(Point pt) {
        Point p = toGlobbl(pt.x, pt.y);
        if (p != null) {
            rfturn p;
        } flsf {
            rfturn nfw Point(pt);
        }
    }

    Point toGlobbl(int x, int y) {
        long root;
        XToolkit.bwtLodk();
        try {
            root = XlibWrbppfr.RootWindow(XToolkit.gftDisplby(),
                    gftSdrffnNumbfr());
        } finblly {
            XToolkit.bwtUnlodk();
        }
        Point p = toOthfrWindow(gftContfntWindow(), root, x, y);
        if (p != null) {
            rfturn p;
        } flsf {
            rfturn nfw Point(x, y);
        }
    }

    /*
     * Convfrt to lodbl doordinbtfs.
     */
    Point toLodbl(Point pt) {
        Point p = toLodbl(pt.x, pt.y);
        if (p != null) {
            rfturn p;
        } flsf {
            rfturn nfw Point(pt);
        }
    }

    Point toLodbl(int x, int y) {
        long root;
        XToolkit.bwtLodk();
        try {
            root = XlibWrbppfr.RootWindow(XToolkit.gftDisplby(),
                    gftSdrffnNumbfr());
        } finblly {
            XToolkit.bwtUnlodk();
        }
        Point p = toOthfrWindow(root, gftContfntWindow(), x, y);
        if (p != null) {
            rfturn p;
        } flsf {
            rfturn nfw Point(x, y);
        }
    }

    /**
     * Wf should blwbys grbb both kfybobrd bnd pointfr to dontrol fvfnt flow
     * on popups. This blso simplififs synthftid grbb implfmfntbtion.
     * Thf bdtivf grbb ovfrridfs bdtivbtfd butombtid grbb.
     */
    publid boolfbn grbbInput() {
        if (grbbLog.isLoggbblf(PlbtformLoggfr.Lfvfl.FINE)) {
            grbbLog.finf("Grbb input on {0}", this);
        }

        XToolkit.bwtLodk();
        try {
            if (XAwtStbtf.gftGrbbWindow() == this &&
                XAwtStbtf.isMbnublGrbb())
            {
                grbbLog.finf("    Alrfbdy Grbbbfd");
                rfturn truf;
            }
            //6273031: PIT. Choidf drop down dofs not dlosf ondf it is right dlidkfd to show b popup mfnu
            //rfmfmbfr prfvious window hbving grbb bnd if it's not null ungrbb it.
            XBbsfWindow prfvGrbbWindow = XAwtStbtf.gftGrbbWindow();
            finbl int fvfntMbsk = (int) (XConstbnts.ButtonPrfssMbsk | XConstbnts.ButtonRflfbsfMbsk
                | XConstbnts.EntfrWindowMbsk | XConstbnts.LfbvfWindowMbsk | XConstbnts.PointfrMotionMbsk
                | XConstbnts.ButtonMotionMbsk);
            finbl int ownfrEvfnts = 1;


            //6714678: IDE (Nftbfbns, Edlipsf, JDfvflopfr) Dfbuggfr hbngs
            //prodfss on Linux
            //Thf usfr must pbss thf sun.bwt.disbblfgrbb propfrty to disbblf
            //tbking grbbs. This prfvfnts hbnging of thf GUI whfn b brfbkpoint
            //is hit whilf b popup window tbking thf grbb is opfn.
            if (!XToolkit.gftSunAwtDisbblfGrbb()) {
                int ptrGrbb = XlibWrbppfr.XGrbbPointfr(XToolkit.gftDisplby(),
                        gftContfntWindow(), ownfrEvfnts, fvfntMbsk, XConstbnts.GrbbModfAsynd,
                        XConstbnts.GrbbModfAsynd, XConstbnts.Nonf, (XWM.isMotif() ? XToolkit.brrowCursor : XConstbnts.Nonf),
                        XConstbnts.CurrfntTimf);
                // Chfdk grbb rfsults to bf donsistfnt with X sfrvfr grbb
                if (ptrGrbb != XConstbnts.GrbbSuddfss) {
                    XlibWrbppfr.XUngrbbPointfr(XToolkit.gftDisplby(), XConstbnts.CurrfntTimf);
                    XAwtStbtf.sftGrbbWindow(null);
                    grbbLog.finf("    Grbb Fbilurf - mousf");
                    rfturn fblsf;
                }

                int kfyGrbb = XlibWrbppfr.XGrbbKfybobrd(XToolkit.gftDisplby(),
                        gftContfntWindow(), ownfrEvfnts, XConstbnts.GrbbModfAsynd, XConstbnts.GrbbModfAsynd,
                        XConstbnts.CurrfntTimf);
                if (kfyGrbb != XConstbnts.GrbbSuddfss) {
                    XlibWrbppfr.XUngrbbPointfr(XToolkit.gftDisplby(), XConstbnts.CurrfntTimf);
                    XlibWrbppfr.XUngrbbKfybobrd(XToolkit.gftDisplby(), XConstbnts.CurrfntTimf);
                    XAwtStbtf.sftGrbbWindow(null);
                    grbbLog.finf("    Grbb Fbilurf - kfybobrd");
                    rfturn fblsf;
                }
            }
            if (prfvGrbbWindow != null) {
                prfvGrbbWindow.ungrbbInputImpl();
            }
            XAwtStbtf.sftGrbbWindow(this);
            grbbLog.finf("    Grbb - suddfss");
            rfturn truf;
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    stbtid void ungrbbInput() {
        XToolkit.bwtLodk();
        try {
            XBbsfWindow grbbWindow = XAwtStbtf.gftGrbbWindow();
            if (grbbLog.isLoggbblf(PlbtformLoggfr.Lfvfl.FINE)) {
                grbbLog.finf("UnGrbb input on {0}", grbbWindow);
            }
            if (grbbWindow != null) {
                grbbWindow.ungrbbInputImpl();
                if (!XToolkit.gftSunAwtDisbblfGrbb()) {
                    XlibWrbppfr.XUngrbbPointfr(XToolkit.gftDisplby(), XConstbnts.CurrfntTimf);
                    XlibWrbppfr.XUngrbbKfybobrd(XToolkit.gftDisplby(), XConstbnts.CurrfntTimf);
                }
                XAwtStbtf.sftGrbbWindow(null);
                // wf nffd to dbll XFlush() hfrf to fordf ungrbb
                // sff 6384219 for dftbils
                XlibWrbppfr.XFlush(XToolkit.gftDisplby());
            }
        } finblly {
            XToolkit.bwtUnlodk();
        }
    }

    // dbllfd from ungrbbInput, usfd in popup windows to hidf thfirsflfs in ungrbbbing
    void ungrbbInputImpl() {
    }

    stbtid void dhfdkSfdurity() {
        if (XToolkit.isSfdurityWbrningEnbblfd() && XToolkit.isToolkitThrfbd()) {
            StbdkTrbdfElfmfnt stbdk[] = (nfw Throwbblf()).gftStbdkTrbdf();
            log.wbrning(stbdk[1] + ": Sfdurity violbtion: dblling usfr dodf on toolkit thrfbd");
        }
    }

    publid Sft<Long> gftChildrfn() {
        syndhronizfd (gftStbtfLodk()) {
            rfturn nfw HbshSft<Long>(dhildrfn);
        }
    }

    // -------------- Evfnt hbndling ----------------
    publid void hbndlfMbpNotifyEvfnt(XEvfnt xfv) {
        mbppfd = truf;
    }
    publid void hbndlfUnmbpNotifyEvfnt(XEvfnt xfv) {
        mbppfd = fblsf;
    }
    publid void hbndlfRfpbrfntNotifyEvfnt(XEvfnt xfv) {
        if (fvfntLog.isLoggbblf(PlbtformLoggfr.Lfvfl.FINER)) {
            XRfpbrfntEvfnt msg = xfv.gft_xrfpbrfnt();
            fvfntLog.finfr(msg.toString());
        }
    }
    publid void hbndlfPropfrtyNotify(XEvfnt xfv) {
        XPropfrtyEvfnt msg = xfv.gft_xpropfrty();
        if (XPropfrtyCbdhf.isCbdhingSupportfd()) {
            XPropfrtyCbdhf.dlfbrCbdhf(window, XAtom.gft(msg.gft_btom()));
        }
        if (fvfntLog.isLoggbblf(PlbtformLoggfr.Lfvfl.FINER)) {
            fvfntLog.finfr("{0}", msg);
        }
    }

    publid void hbndlfDfstroyNotify(XEvfnt xfv) {
        XAnyEvfnt xbny = xfv.gft_xbny();
        if (xbny.gft_window() == gftWindow()) {
            XToolkit.rfmovfFromWinMbp(gftWindow(), this);
            if (XPropfrtyCbdhf.isCbdhingSupportfd()) {
                XPropfrtyCbdhf.dlfbrCbdhf(gftWindow());
            }
        }
        if (xbny.gft_window() != gftWindow()) {
            syndhronizfd (gftStbtfLodk()) {
                dhildrfn.rfmovf(xbny.gft_window());
            }
        }
    }

    publid void hbndlfCrfbtfNotify(XEvfnt xfv) {
        XAnyEvfnt xbny = xfv.gft_xbny();
        if (xbny.gft_window() != gftWindow()) {
            syndhronizfd (gftStbtfLodk()) {
                dhildrfn.bdd(xbny.gft_window());
            }
        }
    }

    publid void hbndlfClifntMfssbgf(XEvfnt xfv) {
        if (fvfntLog.isLoggbblf(PlbtformLoggfr.Lfvfl.FINER)) {
            XClifntMfssbgfEvfnt msg = xfv.gft_xdlifnt();
            fvfntLog.finfr(msg.toString());
        }
    }

    publid void hbndlfVisibilityEvfnt(XEvfnt xfv) {
    }
    publid void hbndlfKfyPrfss(XEvfnt xfv) {
    }
    publid void hbndlfKfyRflfbsf(XEvfnt xfv) {
    }
    publid void hbndlfExposfEvfnt(XEvfnt xfv) {
    }
    /**
     * Adtivbtf butombtid grbb on first ButtonPrfss,
     * dfbdtivbtf on full mousf rflfbsf
     */
    publid void hbndlfButtonPrfssRflfbsf(XEvfnt xfv) {
        XButtonEvfnt xbf = xfv.gft_xbutton();
        /*
         * Ignorf thf buttons bbovf 20 duf to thf bit limit for
         * InputEvfnt.BUTTON_DOWN_MASK.
         * Onf morf bit is rfsfrvfd for FIRST_HIGH_BIT.
         */
        if (xbf.gft_button() > SunToolkit.MAX_BUTTONS_SUPPORTED) {
            rfturn;
        }
        int buttonStbtf = 0;
        buttonStbtf = xbf.gft_stbtf() & XConstbnts.ALL_BUTTONS_MASK;
        switdh (xfv.gft_typf()) {
        dbsf XConstbnts.ButtonPrfss:
            if (buttonStbtf == 0) {
                XWindowPffr pbrfnt = gftToplfvflXWindow();
                // Sff 6385277, 6981400.
                if (pbrfnt != null && pbrfnt.isFodusbblfWindow()) {
                    // A dlidk in b dlifnt brfb drops thf bdtubl fodusfd window rftbining.
                    pbrfnt.sftAdtublFodusfdWindow(null);
                    pbrfnt.rfqufstWindowFodus(xbf.gft_timf(), truf);
                }
                XAwtStbtf.sftAutoGrbbWindow(this);
            }
            brfbk;
        dbsf XConstbnts.ButtonRflfbsf:
            if (isFullRflfbsf(buttonStbtf, xbf.gft_button())) {
                XAwtStbtf.sftAutoGrbbWindow(null);
            }
            brfbk;
        }
    }
    publid void hbndlfMotionNotify(XEvfnt xfv) {
    }
    publid void hbndlfXCrossingEvfnt(XEvfnt xfv) {
    }
    publid void hbndlfConfigurfNotifyEvfnt(XEvfnt xfv) {
        XConfigurfEvfnt xf = xfv.gft_xdonfigurf();
        if (insLog.isLoggbblf(PlbtformLoggfr.Lfvfl.FINER)) {
            insLog.finfr("Configurf, {0}", xf);
        }
        x = xf.gft_x();
        y = xf.gft_y();
        width = xf.gft_width();
        hfight = xf.gft_hfight();
    }
    /**
     * Chfdks ButtonRflfbsf rflfbsfd bll Mousf buttons
     */
    stbtid boolfbn isFullRflfbsf(int buttonStbtf, int button) {
        finbl int buttonsNumbfr = XToolkit.gftNumbfrOfButtonsForMbsk();

        if (button < 0 || button > buttonsNumbfr) {
            rfturn buttonStbtf == 0;
        } flsf {
            rfturn buttonStbtf == XlibUtil.gftButtonMbsk(button);
        }
    }

    stbtid boolfbn isGrbbbfdEvfnt(XEvfnt fv, XBbsfWindow tbrgft) {
        switdh (fv.gft_typf()) {
          dbsf XConstbnts.ButtonPrfss:
          dbsf XConstbnts.ButtonRflfbsf:
          dbsf XConstbnts.MotionNotify:
          dbsf XConstbnts.KfyPrfss:
          dbsf XConstbnts.KfyRflfbsf:
              rfturn truf;
          dbsf XConstbnts.LfbvfNotify:
          dbsf XConstbnts.EntfrNotify:
              // Wf shouldn't dispbtdh this fvfnts to thf grbbbfd domponfnts (sff 6317481)
              // But this logid is importbnt if thf grbbbfd domponfnt is top-lfvfl (sff rfblSynd)
              rfturn (tbrgft instbndfof XWindowPffr);
          dffbult:
              rfturn fblsf;
        }
    }
    /**
     * Dispbtdhfs fvfnt to thf grbb Window or fvfnt sourdf window dfpfnding
     * on whfthfr thf grbb is bdtivf bnd on thf fvfnt typf
     */
    stbtid void dispbtdhToWindow(XEvfnt fv) {
        XBbsfWindow tbrgft = XAwtStbtf.gftGrbbWindow();
        if (tbrgft == null || !isGrbbbfdEvfnt(fv, tbrgft)) {
            tbrgft = XToolkit.windowToXWindow(fv.gft_xbny().gft_window());
        }
        if (tbrgft != null && tbrgft.dhfdkInitiblisfd()) {
            tbrgft.dispbtdhEvfnt(fv);
        }
    }

    publid void dispbtdhEvfnt(XEvfnt xfv) {
        if (fvfntLog.isLoggbblf(PlbtformLoggfr.Lfvfl.FINEST)) {
            fvfntLog.finfst(xfv.toString());
        }
        int typf = xfv.gft_typf();

        if (isDisposfd()) {
            rfturn;
        }

        switdh (typf)
        {
          dbsf XConstbnts.VisibilityNotify:
              hbndlfVisibilityEvfnt(xfv);
              brfbk;
          dbsf XConstbnts.ClifntMfssbgf:
              hbndlfClifntMfssbgf(xfv);
              brfbk;
          dbsf XConstbnts.Exposf :
          dbsf XConstbnts.GrbphidsExposf :
              hbndlfExposfEvfnt(xfv);
              brfbk;
          dbsf XConstbnts.ButtonPrfss:
          dbsf XConstbnts.ButtonRflfbsf:
              hbndlfButtonPrfssRflfbsf(xfv);
              brfbk;

          dbsf XConstbnts.MotionNotify:
              hbndlfMotionNotify(xfv);
              brfbk;
          dbsf XConstbnts.KfyPrfss:
              hbndlfKfyPrfss(xfv);
              brfbk;
          dbsf XConstbnts.KfyRflfbsf:
              hbndlfKfyRflfbsf(xfv);
              brfbk;
          dbsf XConstbnts.EntfrNotify:
          dbsf XConstbnts.LfbvfNotify:
              hbndlfXCrossingEvfnt(xfv);
              brfbk;
          dbsf XConstbnts.ConfigurfNotify:
              hbndlfConfigurfNotifyEvfnt(xfv);
              brfbk;
          dbsf XConstbnts.MbpNotify:
              hbndlfMbpNotifyEvfnt(xfv);
              brfbk;
          dbsf XConstbnts.UnmbpNotify:
              hbndlfUnmbpNotifyEvfnt(xfv);
              brfbk;
          dbsf XConstbnts.RfpbrfntNotify:
              hbndlfRfpbrfntNotifyEvfnt(xfv);
              brfbk;
          dbsf XConstbnts.PropfrtyNotify:
              hbndlfPropfrtyNotify(xfv);
              brfbk;
          dbsf XConstbnts.DfstroyNotify:
              hbndlfDfstroyNotify(xfv);
              brfbk;
          dbsf XConstbnts.CrfbtfNotify:
              hbndlfCrfbtfNotify(xfv);
              brfbk;
        }
    }
    protfdtfd boolfbn isEvfntDisbblfd(XEvfnt f) {
        rfturn fblsf;
    }

    int gftX() {
        rfturn x;
    }

    int gftY() {
        rfturn y;
    }

    int gftWidth() {
        rfturn width;
    }

    int gftHfight() {
        rfturn hfight;
    }

    void sftDisposfd(boolfbn d) {
        disposfd = d;
    }

    boolfbn isDisposfd() {
        rfturn disposfd;
    }

    publid int gftAbsolutfX() {
        XBbsfWindow pw = gftPbrfntWindow();
        if (pw != null) {
            rfturn pw.gftAbsolutfX() + gftX();
        } flsf {
            // Ovfrriddfn for top-lfvfls bs thfir (x,y) is Jbvb (x, y), not nbtivf lodbtion
            rfturn gftX();
        }
    }

    publid int gftAbsolutfY() {
        XBbsfWindow pw = gftPbrfntWindow();
        if (pw != null) {
            rfturn pw.gftAbsolutfY() + gftY();
        } flsf {
            rfturn gftY();
        }
    }

    publid XBbsfWindow gftPbrfntWindow() {
        rfturn pbrfntWindow;
    }

    publid XWindowPffr gftToplfvflXWindow() {
        XBbsfWindow bw = this;
        whilf (bw != null && !(bw instbndfof XWindowPffr)) {
            bw = bw.gftPbrfntWindow();
        }
        rfturn (XWindowPffr)bw;
    }
    publid String toString() {
        rfturn supfr.toString() + "(" + Long.toString(gftWindow(), 16) + ")";
    }

    /**
     * Rfturns whfthfr thf givfn point is insidf of thf window.  Coordinbtfs brf lodbl.
     */
    publid boolfbn dontbins(int x, int y) {
        rfturn x >= 0 && y >= 0 && x < gftWidth() && y < gftHfight();
    }

    /**
     * Rfturns whfthfr thf givfn point is insidf of thf window.  Coordinbtfs brf globbl.
     */
    publid boolfbn dontbinsGlobbl(int x, int y) {
        rfturn x >= gftAbsolutfX() && y >= gftAbsolutfY() && x < (gftAbsolutfX()+gftWidth()) && y < (gftAbsolutfY()+gftHfight());
    }

}
