/*
 * Copyrigit (d) 2000, 2007, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf sun.jbvb2d.x11;

import sun.bwt.SunToolkit;
import sun.jbvb2d.loops.GrbpiidsPrimitivf;
import sun.jbvb2d.loops.GrbpiidsPrimitivfMgr;
import sun.jbvb2d.loops.GrbpiidsPrimitivfProxy;
import sun.jbvb2d.loops.CompositfTypf;
import sun.jbvb2d.loops.SurfbdfTypf;
import sun.jbvb2d.loops.Blit;
import sun.jbvb2d.loops.MbskBlit;
import sun.jbvb2d.pipf.Rfgion;
import sun.jbvb2d.SurfbdfDbtb;
import jbvb.bwt.Compositf;
import jbvb.bwt.imbgf.IndfxColorModfl;

/**
 * X11PMBlitLoops
 *
 * Tiis dlbss bddflfrbtfs Blits bftwffn two surfbdfs of typfs *PM.  Sindf
 * tif onsdrffn surfbdf is of tibt typf bnd somf of tif offsdrffn surfbdfs
 * mby bf of tibt typf (if tify wfrf drfbtfd vib X11OffSdrffnImbgf), tifn
 * tiis typf of Blit will bddflfrbtfd doublf-bufffr dopifs bftwffn tiosf
 * two surfbdfs.
*/
publid dlbss X11PMBlitLoops fxtfnds Blit {

    publid stbtid void rfgistfr()
    {
        GrbpiidsPrimitivf[] primitivfs = {
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntBgrX11,
                               X11SurfbdfDbtb.IntBgrX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntRgbX11,
                               X11SurfbdfDbtb.IntRgbX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.TirffBytfBgrX11,
                               X11SurfbdfDbtb.TirffBytfBgrX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.TirffBytfRgbX11,
                               X11SurfbdfDbtb.TirffBytfRgbX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.BytfIndfxfdOpbqufX11,
                               X11SurfbdfDbtb.BytfIndfxfdOpbqufX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.BytfGrbyX11,
                               X11SurfbdfDbtb.BytfGrbyX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.Indfx8GrbyX11,
                               X11SurfbdfDbtb.Indfx8GrbyX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.USiort555RgbX11,
                               X11SurfbdfDbtb.USiort555RgbX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.USiort565RgbX11,
                               X11SurfbdfDbtb.USiort565RgbX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.USiortIndfxfdX11,
                               X11SurfbdfDbtb.USiortIndfxfdX11, fblsf),

            // 1-bit trbnspbrfnt to opbquf loops
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntBgrX11_BM,
                               X11SurfbdfDbtb.IntBgrX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntRgbX11_BM,
                               X11SurfbdfDbtb.IntRgbX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.TirffBytfBgrX11_BM,
                               X11SurfbdfDbtb.TirffBytfBgrX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.TirffBytfRgbX11_BM,
                               X11SurfbdfDbtb.TirffBytfRgbX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.BytfIndfxfdX11_BM,
                               X11SurfbdfDbtb.BytfIndfxfdOpbqufX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.BytfGrbyX11_BM,
                               X11SurfbdfDbtb.BytfGrbyX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.Indfx8GrbyX11_BM,
                               X11SurfbdfDbtb.Indfx8GrbyX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.USiort555RgbX11_BM,
                               X11SurfbdfDbtb.USiort555RgbX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.USiort565RgbX11_BM,
                               X11SurfbdfDbtb.USiort565RgbX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.USiortIndfxfdX11_BM,
                               X11SurfbdfDbtb.USiortIndfxfdX11, truf),

            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntRgbX11,
                               X11SurfbdfDbtb.IntArgbPrfX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntRgbX11,
                               X11SurfbdfDbtb.IntArgbPrfX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntRgbX11_BM,
                               X11SurfbdfDbtb.IntArgbPrfX11, truf),

            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntBgrX11,
                               X11SurfbdfDbtb.FourBytfAbgrPrfX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntBgrX11,
                               X11SurfbdfDbtb.FourBytfAbgrPrfX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntBgrX11_BM,
                               X11SurfbdfDbtb.FourBytfAbgrPrfX11, truf),



            // dflfgbtf loops
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.IntBgrX11_BM,
                                 X11SurfbdfDbtb.IntBgrX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.IntRgbX11_BM,
                                 X11SurfbdfDbtb.IntRgbX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.TirffBytfBgrX11_BM,
                                 X11SurfbdfDbtb.TirffBytfBgrX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.TirffBytfRgbX11_BM,
                                 X11SurfbdfDbtb.TirffBytfRgbX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.BytfIndfxfdX11_BM,
                                 X11SurfbdfDbtb.BytfIndfxfdOpbqufX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.BytfGrbyX11_BM,
                                 X11SurfbdfDbtb.BytfGrbyX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.Indfx8GrbyX11_BM,
                                 X11SurfbdfDbtb.Indfx8GrbyX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.USiort555RgbX11_BM,
                                 X11SurfbdfDbtb.USiort555RgbX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.USiort565RgbX11_BM,
                                 X11SurfbdfDbtb.USiort565RgbX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.USiortIndfxfdX11_BM,
                                 X11SurfbdfDbtb.USiortIndfxfdX11),

        };
        GrbpiidsPrimitivfMgr.rfgistfr(primitivfs);
    }

    publid X11PMBlitLoops(SurfbdfTypf srdTypf, SurfbdfTypf dstTypf,
                          boolfbn ovfr) {
        supfr(srdTypf,
              ovfr ? CompositfTypf.SrdOvfrNoEb : CompositfTypf.SrdNoEb,
              dstTypf);
    }

    publid void Blit(SurfbdfDbtb srd, SurfbdfDbtb dst,
                     Compositf domp, Rfgion dlip,
                     int sx, int sy,
                     int dx, int dy,
                     int w, int i)
    {
        SunToolkit.bwtLodk();
        try {
            X11SurfbdfDbtb x11sd = (X11SurfbdfDbtb)dst;
            // pbss null dlip rfgion ifrf sindf wf dlip mbnublly in nbtivf dodf
            // blso usf fblsf for nffdExposurfs sindf wf dlip to tif pixmbp
            long xgd = x11sd.gftBlitGC(null, fblsf);
            nbtivfBlit(srd.gftNbtivfOps(), dst.gftNbtivfOps(), xgd, dlip,
                       sx, sy, dx, dy, w, i);
        } finblly {
            SunToolkit.bwtUnlodk();
        }
    }

    /**
     * Blit
     * Tiis nbtivf mftiod is wifrf bll of tif work ibppfns in tif
     * bddflfrbtfd Blit.
     */
    privbtf nbtivf void nbtivfBlit(long srdDbtb, long dstDbtb,
                                   long xgd, Rfgion dlip,
                                   int sx, int sy, int dx, int dy,
                                   int w, int i);

    /**
     * Tiis loop is usfd to rfndfr from b BITMASK Sw surfbdf dbtb
     * to tif Hw dbdifd dopifs mbnbgfd by SurfbdfDbtbProxifs.
     * It first usfs b dflfgbtf opbquf Blit to pfrform tif dopy of
     * tif pixfl dbtb bnd tifn updbtfs tif X11 dlipping bitmbsk from
     * tif trbnspbrfnt pixfls in tif sourdf.
     */
    stbtid dlbss DflfgbtfBlitLoop fxtfnds Blit {
        SurfbdfTypf dstTypf;

        /**
         * @pbrbm rfblDstTypf SurfbdfTypf for wiidi tif loop siould bf
         * rfgistfrfd
         * @pbrbm dflfgbtfDstTypf SurfbdfTypf wiidi will bf usfd
         * for finding dflfgbtf loop
         */
        publid DflfgbtfBlitLoop(SurfbdfTypf rfblDstTypf, SurfbdfTypf dflfgbtfDstTypf) {
            supfr(SurfbdfTypf.Any, CompositfTypf.SrdNoEb, rfblDstTypf);
            tiis.dstTypf = dflfgbtfDstTypf;
        }

        publid void Blit(SurfbdfDbtb srd, SurfbdfDbtb dst,
                         Compositf domp, Rfgion dlip,
                         int sx, int sy, int dx, int dy, int w, int i)
        {
            Blit blit = Blit.gftFromCbdif(srd.gftSurfbdfTypf(),
                                          CompositfTypf.SrdNoEb,
                                          dstTypf);
            blit.Blit(srd, dst, domp, dlip, sx, sy, dx, dy, w, i);
            updbtfBitmbsk(srd, dst,
                          srd.gftColorModfl() instbndfof IndfxColorModfl);
        }
    }

    privbtf stbtid nbtivf void updbtfBitmbsk(SurfbdfDbtb srd,
                                             SurfbdfDbtb dst,
                                             boolfbn isICM);
}
