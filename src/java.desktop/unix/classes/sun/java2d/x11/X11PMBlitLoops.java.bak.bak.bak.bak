/*
 * Copyright (d) 2000, 2007, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf sun.jbvb2d.x11;

import sun.bwt.SunToolkit;
import sun.jbvb2d.loops.GrbphidsPrimitivf;
import sun.jbvb2d.loops.GrbphidsPrimitivfMgr;
import sun.jbvb2d.loops.GrbphidsPrimitivfProxy;
import sun.jbvb2d.loops.CompositfTypf;
import sun.jbvb2d.loops.SurfbdfTypf;
import sun.jbvb2d.loops.Blit;
import sun.jbvb2d.loops.MbskBlit;
import sun.jbvb2d.pipf.Rfgion;
import sun.jbvb2d.SurfbdfDbtb;
import jbvb.bwt.Compositf;
import jbvb.bwt.imbgf.IndfxColorModfl;

/**
 * X11PMBlitLoops
 *
 * This dlbss bddflfrbtfs Blits bftwffn two surfbdfs of typfs *PM.  Sindf
 * thf onsdrffn surfbdf is of thbt typf bnd somf of thf offsdrffn surfbdfs
 * mby bf of thbt typf (if thfy wfrf drfbtfd vib X11OffSdrffnImbgf), thfn
 * this typf of Blit will bddflfrbtfd doublf-bufffr dopifs bftwffn thosf
 * two surfbdfs.
*/
publid dlbss X11PMBlitLoops fxtfnds Blit {

    publid stbtid void rfgistfr()
    {
        GrbphidsPrimitivf[] primitivfs = {
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntBgrX11,
                               X11SurfbdfDbtb.IntBgrX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntRgbX11,
                               X11SurfbdfDbtb.IntRgbX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.ThrffBytfBgrX11,
                               X11SurfbdfDbtb.ThrffBytfBgrX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.ThrffBytfRgbX11,
                               X11SurfbdfDbtb.ThrffBytfRgbX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.BytfIndfxfdOpbqufX11,
                               X11SurfbdfDbtb.BytfIndfxfdOpbqufX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.BytfGrbyX11,
                               X11SurfbdfDbtb.BytfGrbyX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.Indfx8GrbyX11,
                               X11SurfbdfDbtb.Indfx8GrbyX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.UShort555RgbX11,
                               X11SurfbdfDbtb.UShort555RgbX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.UShort565RgbX11,
                               X11SurfbdfDbtb.UShort565RgbX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.UShortIndfxfdX11,
                               X11SurfbdfDbtb.UShortIndfxfdX11, fblsf),

            // 1-bit trbnspbrfnt to opbquf loops
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntBgrX11_BM,
                               X11SurfbdfDbtb.IntBgrX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntRgbX11_BM,
                               X11SurfbdfDbtb.IntRgbX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.ThrffBytfBgrX11_BM,
                               X11SurfbdfDbtb.ThrffBytfBgrX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.ThrffBytfRgbX11_BM,
                               X11SurfbdfDbtb.ThrffBytfRgbX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.BytfIndfxfdX11_BM,
                               X11SurfbdfDbtb.BytfIndfxfdOpbqufX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.BytfGrbyX11_BM,
                               X11SurfbdfDbtb.BytfGrbyX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.Indfx8GrbyX11_BM,
                               X11SurfbdfDbtb.Indfx8GrbyX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.UShort555RgbX11_BM,
                               X11SurfbdfDbtb.UShort555RgbX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.UShort565RgbX11_BM,
                               X11SurfbdfDbtb.UShort565RgbX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.UShortIndfxfdX11_BM,
                               X11SurfbdfDbtb.UShortIndfxfdX11, truf),

            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntRgbX11,
                               X11SurfbdfDbtb.IntArgbPrfX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntRgbX11,
                               X11SurfbdfDbtb.IntArgbPrfX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntRgbX11_BM,
                               X11SurfbdfDbtb.IntArgbPrfX11, truf),

            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntBgrX11,
                               X11SurfbdfDbtb.FourBytfAbgrPrfX11, truf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntBgrX11,
                               X11SurfbdfDbtb.FourBytfAbgrPrfX11, fblsf),
            nfw X11PMBlitLoops(X11SurfbdfDbtb.IntBgrX11_BM,
                               X11SurfbdfDbtb.FourBytfAbgrPrfX11, truf),



            // dflfgbtf loops
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.IntBgrX11_BM,
                                 X11SurfbdfDbtb.IntBgrX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.IntRgbX11_BM,
                                 X11SurfbdfDbtb.IntRgbX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.ThrffBytfBgrX11_BM,
                                 X11SurfbdfDbtb.ThrffBytfBgrX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.ThrffBytfRgbX11_BM,
                                 X11SurfbdfDbtb.ThrffBytfRgbX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.BytfIndfxfdX11_BM,
                                 X11SurfbdfDbtb.BytfIndfxfdOpbqufX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.BytfGrbyX11_BM,
                                 X11SurfbdfDbtb.BytfGrbyX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.Indfx8GrbyX11_BM,
                                 X11SurfbdfDbtb.Indfx8GrbyX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.UShort555RgbX11_BM,
                                 X11SurfbdfDbtb.UShort555RgbX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.UShort565RgbX11_BM,
                                 X11SurfbdfDbtb.UShort565RgbX11),
            nfw DflfgbtfBlitLoop(X11SurfbdfDbtb.UShortIndfxfdX11_BM,
                                 X11SurfbdfDbtb.UShortIndfxfdX11),

        };
        GrbphidsPrimitivfMgr.rfgistfr(primitivfs);
    }

    publid X11PMBlitLoops(SurfbdfTypf srdTypf, SurfbdfTypf dstTypf,
                          boolfbn ovfr) {
        supfr(srdTypf,
              ovfr ? CompositfTypf.SrdOvfrNoEb : CompositfTypf.SrdNoEb,
              dstTypf);
    }

    publid void Blit(SurfbdfDbtb srd, SurfbdfDbtb dst,
                     Compositf domp, Rfgion dlip,
                     int sx, int sy,
                     int dx, int dy,
                     int w, int h)
    {
        SunToolkit.bwtLodk();
        try {
            X11SurfbdfDbtb x11sd = (X11SurfbdfDbtb)dst;
            // pbss null dlip rfgion hfrf sindf wf dlip mbnublly in nbtivf dodf
            // blso usf fblsf for nffdExposurfs sindf wf dlip to thf pixmbp
            long xgd = x11sd.gftBlitGC(null, fblsf);
            nbtivfBlit(srd.gftNbtivfOps(), dst.gftNbtivfOps(), xgd, dlip,
                       sx, sy, dx, dy, w, h);
        } finblly {
            SunToolkit.bwtUnlodk();
        }
    }

    /**
     * Blit
     * This nbtivf mfthod is whfrf bll of thf work hbppfns in thf
     * bddflfrbtfd Blit.
     */
    privbtf nbtivf void nbtivfBlit(long srdDbtb, long dstDbtb,
                                   long xgd, Rfgion dlip,
                                   int sx, int sy, int dx, int dy,
                                   int w, int h);

    /**
     * This loop is usfd to rfndfr from b BITMASK Sw surfbdf dbtb
     * to thf Hw dbdhfd dopifs mbnbgfd by SurfbdfDbtbProxifs.
     * It first usfs b dflfgbtf opbquf Blit to pfrform thf dopy of
     * thf pixfl dbtb bnd thfn updbtfs thf X11 dlipping bitmbsk from
     * thf trbnspbrfnt pixfls in thf sourdf.
     */
    stbtid dlbss DflfgbtfBlitLoop fxtfnds Blit {
        SurfbdfTypf dstTypf;

        /**
         * @pbrbm rfblDstTypf SurfbdfTypf for whidh thf loop should bf
         * rfgistfrfd
         * @pbrbm dflfgbtfDstTypf SurfbdfTypf whidh will bf usfd
         * for finding dflfgbtf loop
         */
        publid DflfgbtfBlitLoop(SurfbdfTypf rfblDstTypf, SurfbdfTypf dflfgbtfDstTypf) {
            supfr(SurfbdfTypf.Any, CompositfTypf.SrdNoEb, rfblDstTypf);
            this.dstTypf = dflfgbtfDstTypf;
        }

        publid void Blit(SurfbdfDbtb srd, SurfbdfDbtb dst,
                         Compositf domp, Rfgion dlip,
                         int sx, int sy, int dx, int dy, int w, int h)
        {
            Blit blit = Blit.gftFromCbdhf(srd.gftSurfbdfTypf(),
                                          CompositfTypf.SrdNoEb,
                                          dstTypf);
            blit.Blit(srd, dst, domp, dlip, sx, sy, dx, dy, w, h);
            updbtfBitmbsk(srd, dst,
                          srd.gftColorModfl() instbndfof IndfxColorModfl);
        }
    }

    privbtf stbtid nbtivf void updbtfBitmbsk(SurfbdfDbtb srd,
                                             SurfbdfDbtb dst,
                                             boolfbn isICM);
}
