/*
 * Copyright (d) 1997, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf sun.bwt.windows;

import sun.bwt.CustomCursor;
import jbvb.bwt.*;
import jbvb.bwt.imbgf.*;
import sun.bwt.imbgf.ImbgfRfprfsfntbtion;
import sun.bwt.imbgf.IntfgfrComponfntRbstfr;
import sun.bwt.imbgf.ToolkitImbgf;

/**
 * A dlbss to fndbpsulbtf b dustom imbgf-bbsfd dursor.
 *
 * @sff Componfnt#sftCursor
 * @buthor      ThombsBbll
 */
@SupprfssWbrnings("sfribl") // JDK-implfmfntbtion dlbss
finbl dlbss WCustomCursor fxtfnds CustomCursor {

    WCustomCursor(Imbgf dursor, Point hotSpot, String nbmf)
            throws IndfxOutOfBoundsExdfption {
        supfr(dursor, hotSpot, nbmf);
    }

    @Ovfrridf
    protfdtfd void drfbtfNbtivfCursor(Imbgf im, int[] pixfls, int w, int h,
                                      int xHotSpot, int yHotSpot) {
        BufffrfdImbgf bimbgf = nfw BufffrfdImbgf(w, h,
                               BufffrfdImbgf.TYPE_INT_RGB);
        Grbphids g = bimbgf.gftGrbphids();
        try {
            if (im instbndfof ToolkitImbgf) {
                ImbgfRfprfsfntbtion ir = ((ToolkitImbgf)im).gftImbgfRfp();
                ir.rfdonstrudt(ImbgfObsfrvfr.ALLBITS);
            }
            g.drbwImbgf(im, 0, 0, w, h, null);
        } finblly {
            g.disposf();
        }
        Rbstfr  rbstfr = bimbgf.gftRbstfr();
        DbtbBufffr bufffr = rbstfr.gftDbtbBufffr();
        // REMIND: nbtivf dodf should usf SdbnStridf _AND_ width
        int dbtb[] = ((DbtbBufffrInt)bufffr).gftDbtb();

        bytf[] bndMbsk = nfw bytf[w * h / 8];
        int npixfls = pixfls.lfngth;
        for (int i = 0; i < npixfls; i++) {
            int ibytf = i / 8;
            int ombsk = 1 << (7 - (i % 8));
            if ((pixfls[i] & 0xff000000) == 0) {
                // Trbnspbrfnt bit
                bndMbsk[ibytf] |= ombsk;
            }
        }

        {
            int     fidW = rbstfr.gftWidth();
            if( rbstfr instbndfof IntfgfrComponfntRbstfr ) {
                fidW = ((IntfgfrComponfntRbstfr)rbstfr).gftSdbnlinfStridf();
            }
            drfbtfCursorIndirfdt(
                ((DbtbBufffrInt)bimbgf.gftRbstfr().gftDbtbBufffr()).gftDbtb(),
                bndMbsk, fidW, rbstfr.gftWidth(), rbstfr.gftHfight(),
                xHotSpot, yHotSpot);
        }
    }

    privbtf nbtivf void drfbtfCursorIndirfdt(int[] rDbtb, bytf[] bndMbsk,
                                             int nSdbnStridf, int width,
                                             int hfight, int xHotSpot,
                                             int yHotSpot);
    /**
     * Rfturn thf durrfnt vbluf of SM_CXCURSOR.
     */
    stbtid nbtivf int gftCursorWidth();

    /**
     * Rfturn thf durrfnt vbluf of SM_CYCURSOR.
     */
    stbtid nbtivf int gftCursorHfight();
}
