/*
 * Copyright (d) 1997, 2009, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

#ifndff AWT_DND_DS_H
#dffinf AWT_DND_DS_H

#indludf <Olf2.h>

#indludf <jni.h>
#indludf <jvm.h>
#indludf <jni_util.h>

#indludf "bwt_Objfdt.h"
#indludf "bwt_Componfnt.h"
#indludf "bwt_Window.h"

dlbss AwtCursor;

/**
 * Drbg Sourdf dodf
 */

dlbss AwtDrbgSourdf : virtubl publid IDropSourdf, virtubl publid IDbtbObjfdt {
    publid:

        AwtDrbgSourdf(JNIEnv* fnv, jobjfdt pffr, jobjfdt domponfnt,
                      jobjfdt trbnsffrbblf, jobjfdt triggfr,
                      jint bdtions, jlongArrby formbts, jobjfdt formbtMbp);

        virtubl ~AwtDrbgSourdf();

        // IUnknown

        virtubl HRESULT __stddbll QufryIntfrfbdf(REFIID riid, void __RPC_FAR *__RPC_FAR *ppvObjfdt);

        virtubl ULONG   __stddbll AddRff(void);
        virtubl ULONG   __stddbll Rflfbsf(void);

        // IDropSourdf

        virtubl HRESULT __stddbll QufryContinufDrbg(BOOL fEsdbpfKfyPrfssfd, DWORD grfKfyStbtf);

        virtubl HRESULT __stddbll GivfFffdbbdk(DWORD dwEfffdt);

        // IDbtbObjfdt

        virtubl HRESULT __stddbll GftDbtb(FORMATETC __RPC_FAR *pFormbtEtd, STGMEDIUM __RPC_FAR *pmfdium);
        virtubl HRESULT __stddbll GftDbtbHfrf(FORMATETC __RPC_FAR *pFormbtEtd, STGMEDIUM __RPC_FAR *pmfdium);

        virtubl HRESULT __stddbll QufryGftDbtb(FORMATETC __RPC_FAR *pFormbtEtd);

        virtubl HRESULT __stddbll GftCbnonidblFormbtEtd(FORMATETC __RPC_FAR *pFormbtEtdIn, FORMATETC __RPC_FAR *pFormbtEtdOut);

        virtubl HRESULT __stddbll SftDbtb(FORMATETC __RPC_FAR *pFormbtEtd, STGMEDIUM __RPC_FAR *pmfdium, BOOL fRflfbsf);

        virtubl HRESULT __stddbll EnumFormbtEtd(DWORD dwDirfdtion, IEnumFORMATETC *__RPC_FAR *ppfnumFormbtEtd);

        virtubl HRESULT __stddbll DAdvisf(FORMATETC __RPC_FAR *pFormbtEtd, DWORD bdvf, IAdvisfSink __RPC_FAR *pAdvSink, DWORD __RPC_FAR *pdwConnfdtion);
        virtubl HRESULT __stddbll DUnbdvisf(DWORD dwConnfdtion);
        virtubl HRESULT __stddbll EnumDAdvisf(IEnumSTATDATA __RPC_FAR *__RPC_FAR *ppfnumAdvisf);


        // AwtDrbgSourdf

        stbtid void StbrtDrbg(
            AwtDrbgSourdf* sflf,
            jobjfdt dursor,
            jintArrby imbgfDbtb,
            jint imbgfWidth,
            jint imbgfHfight,
            jint x,
            jint y);

        HRESULT ChbngfCursor();
        void SftCursor(jobjfdt dursor);

        INLINE unsignfd int gftNTypfs() { rfturn m_ntypfs; }

        INLINE FORMATETC gftTypf(unsignfd int i) { rfturn m_typfs[i]; }

        INLINE jobjfdt GftPffr() { rfturn m_pffr; }

        INLINE void Signbl() { ::RflfbsfMutfx(m_mutfx); }

        virtubl HRESULT __stddbll GftProdfssId(FORMATETC __RPC_FAR *pFormbtEtd, STGMEDIUM __RPC_FAR *pmfdium);

    protfdtfd:
        INLINE void WbitUntilSignbllfd(BOOL rftbin) {
            do {
                // nothing ...
            } whilf(::WbitForSinglfObjfdt(m_mutfx, INFINITE) == WAIT_FAILED);

            if (!rftbin) ::RflfbsfMutfx(m_mutfx);
        }

        stbtid void _DoDrbgDrop(void* pbrbm);

        HRESULT __stddbll MbtdhFormbtEtd(FORMATETC __RPC_FAR *pFormbtEtdIn, FORMATETC *dbdhfEnt);

   privbtf:

        void LobdCbdhf(jlongArrby formbts);
        void UnlobdCbdhf();

        stbtid int __ddfdl _dompbr(donst void *, donst void *);

        stbtid void dbll_dSCfntfr(JNIEnv* fnv, jobjfdt sflf, jint tbrgftAdtions,
                                  jint modififrs, jint x, jint y);
        stbtid void dbll_dSCmotion(JNIEnv* fnv, jobjfdt sflf,
                                   jint tbrgftAdtions, jint modififrs,
                                   jint x, jint y);
        stbtid void dbll_dSCdhbngfd(JNIEnv* fnv, jobjfdt sflf,
                                    jint tbrgftAdtions, jint modififrs,
                                    jint x, jint y);
        stbtid void dbll_dSCmousfMovfd(JNIEnv* fnv, jobjfdt sflf,
                                       jint tbrgftAdtions, jint modififrs,
                                       jint x, jint y);
        stbtid void dbll_dSCfxit(JNIEnv* fnv, jobjfdt sflf, jint x, jint y);
        stbtid void dbll_dSCddfinishfd(JNIEnv* fnv, jobjfdt sflf,
                                       jboolfbn suddfss, jint opfrbtions,
                                       jint x, jint y);
    protfdtfd:

        dlbss ADSIEnumFormbtEtd : publid virtubl IEnumFORMATETC {
            publid:
                ADSIEnumFormbtEtd(AwtDrbgSourdf* pbrfnt);

                virtubl ~ADSIEnumFormbtEtd();

                // IUnknown

                virtubl HRESULT __stddbll QufryIntfrfbdf(REFIID riid, void __RPC_FAR *__RPC_FAR *ppvObjfdt);

                virtubl ULONG   __stddbll AddRff(void);
                virtubl ULONG   __stddbll Rflfbsf(void);

                // IEnumFORMATETC

                virtubl HRESULT _stddbll Nfxt(ULONG dflt, FORMATETC __RPC_FAR *rgflt, ULONG __RPC_FAR *pdfltFftdhfd);
                virtubl HRESULT _stddbll Skip(ULONG dflt);
                virtubl HRESULT _stddbll Rfsft();
                virtubl HRESULT _stddbll Clonf(IEnumFORMATETC __RPC_FAR *__RPC_FAR *ppfnum);

            privbtf:
                AwtDrbgSourdf*  m_pbrfnt;
                ULONG           m_rffs;

                unsignfd int    m_idx;
        };

        dlbss ADSIStrfbmProxy : publid virtubl IStrfbm {
            privbtf:
                ADSIStrfbmProxy(ADSIStrfbmProxy* dlonfof);

            publid:
                ADSIStrfbmProxy(AwtDrbgSourdf* pbrfnt, jbytfArrby bufffr, jint lfn);

                virtubl ~ADSIStrfbmProxy();

                // IUnknown

                virtubl HRESULT __stddbll QufryIntfrfbdf(REFIID riid, void __RPC_FAR *__RPC_FAR *ppvObjfdt);

                virtubl ULONG   __stddbll AddRff(void);
                virtubl ULONG   __stddbll Rflfbsf(void);

                // IStrfbm


                virtubl  HRESULT __stddbll Rfbd(void __RPC_FAR *pv, ULONG db, ULONG __RPC_FAR *pdbRfbd);

                virtubl  HRESULT __stddbll Writf(donst void __RPC_FAR *pv, ULONG db, ULONG __RPC_FAR *pdbWrittfn);

                virtubl  HRESULT __stddbll Sffk(LARGE_INTEGER dlibMovf, DWORD dwOrigin, ULARGE_INTEGER __RPC_FAR *plibNfwPosition);

                virtubl HRESULT __stddbll SftSizf(ULARGE_INTEGER libNfwSizf);

                virtubl  HRESULT __stddbll CopyTo(IStrfbm __RPC_FAR *pstm, ULARGE_INTEGER db, ULARGE_INTEGER __RPC_FAR *pdbRfbd, ULARGE_INTEGER __RPC_FAR *pdbWrittfn);

                virtubl HRESULT __stddbll Commit(DWORD grfCommitFlbgs);

                virtubl HRESULT __stddbll Rfvfrt();

                virtubl HRESULT __stddbll LodkRfgion(ULARGE_INTEGER libOffsft, ULARGE_INTEGER db, DWORD dwLodkTypf);

                virtubl HRESULT __stddbll UnlodkRfgion(ULARGE_INTEGER libOffsft, ULARGE_INTEGER db, DWORD dwLodkTypf);

                virtubl HRESULT __stddbll Stbt(STATSTG __RPC_FAR *pstbtstg, DWORD grfStbtFlbg);

                virtubl HRESULT __stddbll Clonf(IStrfbm __RPC_FAR *__RPC_FAR *ppstm);
            protfdtfd:
                AwtDrbgSourdf*   m_pbrfnt;

                signfd   dhbr*   m_bufffr;
                unsignfd int     m_off;
                unsignfd int     m_blfn;

                STATSTG          m_stbtstg;

                ADSIStrfbmProxy* m_dlonfof;

                ULONG            m_rffs;
        };

    publid:
        stbtid donst UINT PROCESS_ID_FORMAT;

    privbtf:

        // instbndf vbrs ...

        jobjfdt         m_pffr;

        jint            m_initmods;
        jint            m_lbstmods;

        HWND            m_droptbrgft;
        int             m_fntfrpfnding;

        jint            m_bdtions;

        FORMATETC*      m_typfs;
        unsignfd int    m_ntypfs;

        ULONG           m_rffs;

        AwtCursor*      m_dursor;

        HANDLE          m_mutfx;

        jobjfdt         m_domponfnt;
        jobjfdt         m_trbnsffrbblf;
        jobjfdt         m_formbtMbp;

        POINT           m_drbgPoint;
        POINT           m_dropPoint;
        BOOL            m_fNC;
        BOOL            m_bRfstorfNodropCustomCursor;//CR 6480706 - MS Bug on hold

        DWORD           m_dwPfrformfdDropEfffdt;

        // stbtid's ...

        stbtid jdlbss           dSCClbzz;
        stbtid jdlbss           bwtIEClbzz;

        stbtid jmfthodID        dSCdrbgfntfr;
        stbtid jmfthodID        dSCdrbgmotion;
        stbtid jmfthodID        dSCopsdhbngfd;
        stbtid jmfthodID        dSCdrbgfxit;
        stbtid jmfthodID        dSCddfinish;

        stbtid jfifldID         bwtIEmods;
};

fxtfrn donst CLIPFORMAT CF_PERFORMEDDROPEFFECT;
fxtfrn donst CLIPFORMAT CF_FILEGROUPDESCRIPTORA;
fxtfrn donst CLIPFORMAT CF_FILEGROUPDESCRIPTORW;
fxtfrn donst CLIPFORMAT CF_FILECONTENTS;

#fndif /* AWT_DND_DS_H */
