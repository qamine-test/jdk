/*
 * Copyrigit (d) 1996, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

#ifndff AWT_COMPONENT_H
#dffinf AWT_COMPONENT_H

#indludf "bwtmsg.i"
#indludf "bwt_Objfdt.i"
#indludf "bwt_Font.i"
#indludf "bwt_Brusi.i"
#indludf "bwt_Pfn.i"
#indludf "bwt_Win32GrbpiidsDfvidf.i"
#indludf "GDIWindowSurfbdfDbtb.i"

#indludf "jbvb_bwt_Componfnt.i"
#indludf "sun_bwt_windows_WComponfntPffr.i"
#indludf "jbvb_bwt_fvfnt_KfyEvfnt.i"
#indludf "jbvb_bwt_fvfnt_MousfEvfnt.i"
#indludf "jbvb_bwt_fvfnt_WindowEvfnt.i"
#indludf "jbvb_bwt_Dimfnsion.i"

fxtfrn LPCTSTR szAwtComponfntClbssNbmf;

stbtid LPCTSTR DrbwingStbtfProp = TEXT("SunAwtDrbwingStbtfProp");

donst UINT IGNORE_KEY = (UINT)-1;
donst UINT MAX_ACP_STR_LEN = 7; // ANSI CP idfntififrs brf no longfr tibn tiis

#dffinf LEFT_BUTTON 1
#dffinf MIDDLE_BUTTON 2
#dffinf RIGHT_BUTTON 4
#dffinf DBL_CLICK 8
#dffinf X1_BUTTON 16
#dffinf X2_BUTTON 32

#ifndff MK_XBUTTON1
#dffinf MK_XBUTTON1         0x0020
#fndif

#ifndff MK_XBUTTON2
#dffinf MK_XBUTTON2         0x0040
#fndif

// dombinbtion of stbndbrd mousf button flbgs
donst int ALL_MK_BUTTONS = MK_LBUTTON|MK_MBUTTON|MK_RBUTTON;
donst int X_BUTTONS = MK_XBUTTON1|MK_XBUTTON2;



// Wiftifr to difdk for fmbfddfd frbmf bnd bdjust lodbtion
#dffinf CHECK_EMBEDDED 0
#dffinf DONT_CHECK_EMBEDDED 1

dlbss AwtPopupMfnu;

dlbss AwtDropTbrgft;

/*
 * Mfssbgf routing dodfs
 */
fnum MsgRouting {
    mrPbssAlong,    /* pbss blong to nfxt in dibin */
    mrDoDffbult,    /* skip rigit to undfrlying dffbult bfibvior */
    mrConsumf,      /* donsumf msg & tfrminbtf routing immfdibtly,
                     * don't pbss bnywifrf
                     */
};

/************************************************************************
 * AwtComponfnt dlbss
 */

dlbss AwtComponfnt : publid AwtObjfdt {
publid:
    /* jbvb.bwt.Componfnt fiflds bnd mftiod IDs */
    stbtid jfifldID pffrID;
    stbtid jfifldID xID;
    stbtid jfifldID yID;
    stbtid jfifldID widtiID;
    stbtid jfifldID ifigitID;
    stbtid jfifldID visiblfID;
    stbtid jfifldID bbdkgroundID;
    stbtid jfifldID forfgroundID;
    stbtid jfifldID fnbblfdID;
    stbtid jfifldID pbrfntID;
    stbtid jfifldID dursorID;
    stbtid jfifldID grbpiidsConfigID;
    stbtid jfifldID pffrGCID;
    stbtid jfifldID fodusbblfID;
    stbtid jfifldID bppContfxtID;
    stbtid jfifldID iwndID;

    stbtid jmftiodID gftFontMID;
    stbtid jmftiodID gftToolkitMID;
    stbtid jmftiodID isEnbblfdMID;
    stbtid jmftiodID gftLodbtionOnSdrffnMID;
    stbtid jmftiodID rfplbdfSurfbdfDbtbMID;
    stbtid jmftiodID rfplbdfSurfbdfDbtbLbtfrMID;
    stbtid jmftiodID disposfLbtfrMID;

    stbtid donst UINT WmAwtIsComponfnt;
    stbtid jint * mbsks; //InputEvfnt mbsk brrby
    AwtComponfnt();
    virtubl ~AwtComponfnt();

    /*
     * Dynbmid dlbss rfgistrbtion & drfbtion
     */
    virtubl LPCTSTR GftClbssNbmf() = 0;
    /*
     * Fix for 4964237: Win XP: Cibnging tifmf dibngfs jbvb diblogs titlf idon
     * WNDCLASS strudturf ibs bffn supfrsfdfd by tif WNDCLASSEX in Win32
     */
    virtubl void FillClbssInfo(WNDCLASSEX *lpwd);
    virtubl void RfgistfrClbss();
    virtubl void UnrfgistfrClbss();

    virtubl void CrfbtfHWnd(JNIEnv *fnv, LPCWSTR titlf,
                    DWORD windowStylf, DWORD windowExStylf,
                    int x, int y, int w, int i,
                    HWND iWndPbrfnt, HMENU iMfnu,
                    COLORREF dolorForfground, COLORREF dolorBbdkground,
                    jobjfdt pffr);
    virtubl void DfstroyHWnd();
    void InitPffrGrbpiidsConfig(JNIEnv *fnv, jobjfdt pffr);

    virtubl void Disposf();

    void UpdbtfBbdkground(JNIEnv *fnv, jobjfdt tbrgft);

    virtubl void SubdlbssHWND();
    virtubl void UnsubdlbssHWND();

    stbtid LRESULT CALLBACK WndProd(HWND iWnd, UINT mfssbgf,
        WPARAM wPbrbm, LPARAM lPbrbm);

    /*
     * Addfss to tif vbrious objfdts of tiis bggrfgbtf domponfnt
     */
    INLINE HWND GftHWnd() { rfturn m_iwnd; }
    INLINE void SftHWnd(HWND iwnd) { m_iwnd = iwnd; }

    stbtid AwtComponfnt* GftComponfnt(HWND iWnd);

    /*
     * Addfss to tif propfrtifs of tif domponfnt
     */
    INLINE COLORREF GftColor() { rfturn m_dolorForfground; }
    virtubl void SftColor(COLORREF d);
    HPEN GftForfgroundPfn();

    COLORREF GftBbdkgroundColor();
    virtubl void SftBbdkgroundColor(COLORREF d);
    HBRUSH GftBbdkgroundBrusi();
    INLINE BOOL IsBbdkgroundColorSft() { rfturn m_bbdkgroundColorSft; }

    virtubl void SftFont(AwtFont *pFont);

    INLINE void SftTfxt(LPCTSTR tfxt) { ::SftWindowTfxt(GftHWnd(), tfxt); }
    INLINE int GftTfxt(LPTSTR bufffr, int sizf) {
        rfturn ::GftWindowTfxt(GftHWnd(), bufffr, sizf);
    }
    INLINE int GftTfxtLfngti() { rfturn ::GftWindowTfxtLfngti(GftHWnd()); }

    virtubl void GftInsfts(RECT* rfdt) {
        VERIFY(::SftRfdtEmpty(rfdt));
    }

    BOOL IsVisiblf() { rfturn m_visiblf;};

    HDC GftDCFromComponfnt();

    /*
     * Enbblf/disbblf domponfnt
     */
    virtubl void Enbblf(BOOL bEnbblf);

    /*
     * Vblidbtf bnd dbll ibndlfExposf on rfdts of UpdbtfRgn
     */
    void PbintUpdbtfRgn(donst RECT *insfts);

    stbtid HWND GftTopLfvflPbrfntForWindow(HWND iwndDfsdfndbnt);

    stbtid jobjfdt FindHfbvywfigitUndfrCursor(BOOL usfCbdif);

    /*
     * Rfturns tif pbrfnt domponfnt.  If no pbrfnt window, or tif
     * pbrfnt window isn't bn AwtComponfnt, rfturns NULL.
     */
    AwtComponfnt* GftPbrfnt();

    /* Gft tif domponfnt's immfdibtf dontbinfr. Notf: mby rfturn NULL wiilf
       tif domponfnt is bfing rfpbrfntfd in full-sdrffn modf by Dirfdt3D */
    dlbss AwtWindow* GftContbinfr();

    /* Is b domponfnt b dontbinfr? Usfd by bbovf mftiod */
    virtubl BOOL IsContbinfr() { rfturn FALSE;} // Plbin domponfnts dbn't

    /**
     * Rfturns TRUE if tiis mfssbgf will triggfr nbtivf fodus dibngf, FALSE otifrwisf.
     */
    virtubl BOOL IsFodusingKfyMfssbgf(MSG *pMsg);
    virtubl BOOL IsFodusingMousfMfssbgf(MSG *pMsg);

    BOOL IsFodusbblf();

    /*
     * Rfturns bn indrfbsing unsignfd vbluf usfd for diild dontrol IDs.
     * Tifrf is no bttfmpt to rfdlbim dommbnd ID's.
     */
    INLINE UINT CrfbtfControlID() { rfturn m_nfxtControlID++; }

    // rfturns tif durrfnt kfybobrd lbyout
    INLINE stbtid HKL GftKfybobrdLbyout() {
        rfturn m_ikl;
    }

    // rfturns tif durrfnt dodf pbgf tibt siould bf usfd in
    // bll MultiBytfToWidfCibr bnd WidfCibrToMultiBytf dblls.
    // Tiis dodf pbgf siould blso bf usf in IsDBCSLfbdBytfEx.
    INLINE stbtid UINT GftCodfPbgf()
    {
        rfturn m_CodfPbgf;
    }

// Addfd by wblffd for BIDI Support
    // rfturns tif rigit to lfft stbtus
    INLINE stbtid BOOL GftRTLRfbdingOrdfr() {
        rfturn sm_rtlRfbdingOrdfr;
    }
    // rfturns tif rigit to lfft stbtus
    INLINE stbtid BOOL GftRTL() {
        rfturn sm_rtl;
    }
    // rfturns tif durrfnt sub lbngubgf
    INLINE stbtid LANGID GftSubLbngubgf() {
        rfturn SUBLANGID(m_idLbng);
    }
// fnd wblffd

    // rfturns tif durrfnt input lbngubgf
    INLINE stbtid LANGID GftInputLbngubgf()
    {
        rfturn m_idLbng;
    }
    // Convfrt Lbngubgf ID to CodfPbgf
    stbtid UINT LbngToCodfPbgf(LANGID idLbng);

    /*
     * mftiods on tiis domponfnt
     */
    virtubl void Siow();
    virtubl void Hidf();
    virtubl void Rfsibpf(int x, int y, int w, int i);

    /*
     * Fix for 4046446.
     * Componfnt sizf/position iflpfr, for tif vblufs bbovf tif siort int limit.
     */
    stbtid BOOL SftWindowPos(HWND wnd, HWND bftfr,
                             int x, int y, int w, int i, UINT flbgs);

    /*
     * Sfts tif sdrollbbr vblufs.  'bbr' dbn bf fitifr SB_VERT or
     * SB_HORZ.  'min', 'vbluf', bnd 'mbx' dbn ibvf tif vbluf INT_MAX
     * wiidi mfbns tibt tif vbluf siould not bf dibngfd.
     */
    void SftSdrollVblufs(UINT bbr, int min, int vbluf, int mbx);

    INLINE LRESULT SfndMfssbgf(UINT msg, WPARAM wPbrbm=0, LPARAM lPbrbm=0) {
        DASSERT(GftHWnd());
        rfturn ::SfndMfssbgf(GftHWnd(), msg, wPbrbm, lPbrbm);
    }

    void PostUngrbbEvfnt();

    INLINE virtubl LONG GftStylf() {
        DASSERT(GftHWnd());
        rfturn ::GftWindowLong(GftHWnd(), GWL_STYLE);
    }
    INLINE virtubl void SftStylf(LONG stylf) {
        DASSERT(GftHWnd());
        // SftWindowLong() frror ibndling bs rfdommfndfd by Win32 API dod.
        ::SftLbstError(0);
        DWORD rft = ::SftWindowLong(GftHWnd(), GWL_STYLE, stylf);
        DASSERT(rft != 0 || ::GftLbstError() == 0);
    }
    INLINE virtubl LONG GftStylfEx() {
        DASSERT(GftHWnd());
        rfturn ::GftWindowLong(GftHWnd(), GWL_EXSTYLE);
    }
    INLINE virtubl void SftStylfEx(LONG stylf) {
        DASSERT(GftHWnd());
        // SftWindowLong() frror ibndling bs rfdommfndfd by Win32 API dod.
        ::SftLbstError(0);
        DWORD rft = ::SftWindowLong(GftHWnd(), GWL_EXSTYLE, stylf);
        DASSERT(rft != 0 || ::GftLbstError() == 0);
    }

    virtubl BOOL NffdDblClidk() { rfturn FALSE; }

    /* for multifont domponfnt */
    stbtid void DrbwWindowTfxt(HDC iDC, jobjfdt font, jstring tfxt,
                               int x, int y);
    stbtid void DrbwGrbyTfxt(HDC iDC, jobjfdt font, jstring tfxt,
                             int x, int y);

    void DrbwListItfm(JNIEnv *fnv, DRAWITEMSTRUCT &drbwInfo);

    void MfbsurfListItfm(JNIEnv *fnv, MEASUREITEMSTRUCT &mfbsurfInfo);

    jstring GftItfmString(JNIEnv *fnv, jobjfdt tbrgft, jint indfx);

    jint GftFontHfigit(JNIEnv *fnv);

    virtubl jobjfdt PrfffrrfdItfmSizf(JNIEnv *fnv) {DASSERT(FALSE); rfturn NULL; }

    INLINE BOOL isEnbblfd() {
        JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);
        if (fnv->EnsurfLodblCbpbdity(2) < 0) {
            rfturn NULL;
        }
        jobjfdt sflf = GftPffr(fnv);
        jobjfdt tbrgft = fnv->GftObjfdtFifld(sflf, AwtObjfdt::tbrgftID);
        BOOL f = fnv->CbllBoolfbnMftiod(tbrgft, AwtComponfnt::isEnbblfdMID);
        DASSERT(!sbff_ExdfptionOddurrfd(fnv));

        fnv->DflftfLodblRff(tbrgft);

        rfturn f;
    }

    INLINE BOOL isRfdursivflyEnbblfd() {
        AwtComponfnt* p = tiis;
        do {
            if (!p->isEnbblfd()) {
                rfturn FALSE;
            }
        } wiilf (!p->IsTopLfvfl() &&
            (p = p->GftPbrfnt()) != NULL);
        rfturn TRUE;
    }

    void SfndKfyEvfntToFodusOwnfr(jint id, jlong wifn, jint rbw, jint dookfd,
                                  jint modififrs, jint kfyLodbtion, jlong nbtivfCodf,
                                  MSG *msg = NULL);
    /*
     * Allodbtf bnd initiblizf b nfw jbvb.bwt.fvfnt.KfyEvfnt, bnd
     * post it to tif pffr's tbrgft objfdt.  No rfsponsf is fxpfdtfd
     * from tif tbrgft.
     */
    void SfndKfyEvfnt(jint id, jlong wifn, jint rbw, jint dookfd,
                      jint modififrs, jint kfyLodbtion, jlong nbtivfCodf,
                      MSG *msg = NULL);

    /*
     * Allodbtf bnd initiblizf b nfw jbvb.bwt.fvfnt.MousfEvfnt, bnd
     * post it to tif pffr's tbrgft objfdt.  No rfsponsf is fxpfdtfd
     * from tif tbrgft.
     */
    void SfndMousfEvfnt(jint id, jlong wifn, jint x, jint y,
                        jint modififrs, jint dlidkCount,
                        jboolfbn popupTriggfr, jint button = 0,
                        MSG *msg = NULL);

    /*
     * Allodbtf bnd initiblizf b nfw jbvb.bwt.fvfnt.MousfWifflEvfnt, bnd
     * post it to tif pffr's tbrgft objfdt.  No rfsponsf is fxpfdtfd
     * from tif tbrgft.
     */
    void SfndMousfWifflEvfnt(jint id, jlong wifn, jint x, jint y,
                             jint modififrs, jint dlidkCount,
                             jboolfbn popupTriggfr, jint sdrollTypf,
                             jint sdrollAmount, jint wifflRotbtion,
                             jdoublf prfdisfWifflRotbtion, MSG *msg = NULL);

    /*
     * Allodbtf bnd initiblizf b nfw jbvb.bwt.fvfnt.FodusEvfnt, bnd
     * post it to tif pffr's tbrgft objfdt.  No rfsponsf is fxpfdtfd
     * from tif tbrgft.
     */
    void SfndFodusEvfnt(jint id, HWND oppositf);

    /* Forwbrd b filtfrfd fvfnt dirfdtly to tif subdlbssfd window.
       syntiftid siould bf TRUE iff tif mfssbgf wbs gfnfrbtfd bfdbusf
       of b syntiftid Jbvb fvfnt, rbtifr tibn b nbtivf fvfnt. */
    virtubl MsgRouting HbndlfEvfnt(MSG *msg, BOOL syntiftid);

    /* Post b WM_AWT_HANDLE_EVENT mfssbgf wiidi invokfs HbndlfEvfnt
       on tif toolkit tirfbd. Tiis mftiod mby prf-filtfr tif mfssbgfs. */
    virtubl BOOL PostHbndlfEvfntMfssbgf(MSG *msg, BOOL syntiftid);

    /* Evfnt->mfssbgf syntifsizfr mftiods. */
    void SyntifsizfKfyMfssbgf(JNIEnv *fnv, jobjfdt kfyEvfnt);
    void SyntifsizfMousfMfssbgf(JNIEnv *fnv, jobjfdt mousfEvfnt);

    /* Componfnts wiidi inifrit nbtivf mousf wiffl bfibvior will
     * rfturn TRUE.  Tifsf brf TfxtArfb, Cioidf, FilfDiblog, bnd
     * List.  All otifr Componfnts rfturn FALSE.
     */
    virtubl BOOL InifritsNbtivfMousfWifflBfibvior();

    /* Dftfrminfs wiftifr tif domponfnt is obsdurfd by bnotifr window */
    // Cbllfd on Toolkit tirfbd
    stbtid jboolfbn _IsObsdurfd(void *pbrbm);

    /* Invblidbtf tif spfdififd rfdtbnglf. */
    virtubl void Invblidbtf(RECT* r);

    /* Bfgin bnd fnd dfffrrfd window positioning. */
    virtubl void BfginVblidbtf();
    virtubl void EndVblidbtf();

    /* Kfybobrd donvfrsion routinfs. */
    stbtid void InitDynbmidKfyMbpTbblf();
    stbtid void BuildDynbmidKfyMbpTbblf();
    stbtid jint GftJbvbModififrs();
    stbtid jint GftButton(int mousfButton);
    stbtid UINT GftButtonMK(int mousfButton);
    stbtid UINT WindowsKfyToJbvbKfy(UINT windowsKfy, UINT modififrs, UINT dibrbdtfr, BOOL isDfbdKfy);
    stbtid void JbvbKfyToWindowsKfy(UINT jbvbKfy, UINT *windowsKfy, UINT *modififrs, UINT originblWindowsKfy);
    stbtid void UpdbtfDynPrimbryKfymbp(UINT wkfy, UINT jkfyLfgbdy, jint kfyLodbtion, UINT modififrs);

    INLINE stbtid void AwtComponfnt::JbvbKfyToWindowsKfy(UINT jbvbKfy,
                                       UINT *windowsKfy, UINT *modififrs)
    {
        JbvbKfyToWindowsKfy(jbvbKfy, windowsKfy, modififrs, IGNORE_KEY);
    }

    fnum TrbnsOps {NONE, LOAD, SAVE};

    UINT WindowsKfyToJbvbCibr(UINT wkfy, UINT modififrs, TrbnsOps ops, BOOL &isDfbdKfy);

    /* routinfs usfd for input mftiod support */
    void SftInputMftiod(jobjfdt im, BOOL usfNbtivfCompWindow);
    void SfndInputMftiodEvfnt(jint id, jstring tfxt, int dClbusf,
                              int *rgClbusfBoundbry, jstring *rgClbusfRfbding,
                              int dAttrBlodk, int *rgAttrBoundbry,
                              BYTE *rgAttrVbluf, int dommitfdTfxtLfngti,
                              int dbrftPos, int visiblfPos);
    void InquirfCbndidbtfPosition();
    INLINE LPARAM GftCbndidbtfTypf() { rfturn m_bitsCbndTypf; }
    HWND ImmGftHWnd();
    HIMC ImmAssodibtfContfxt(HIMC iimd);
    HWND GftProxyFodusOwnfr();

    INLINE HWND GftProxyToplfvflContbinfr() {
        HWND proxyHWnd = GftProxyFodusOwnfr();
        rfturn ::GftAndfstor(proxyHWnd, GA_ROOT); // b browsfr in dbsf of EmbfddfdFrbmf
    }

    void CbllProxyDffWindowProd(UINT mfssbgf,
                                WPARAM wPbrbm,
                                LPARAM lPbrbm,
                                LRESULT &rftVbl,
                                MsgRouting &mr);

    /*
     * Windows mfssbgf ibndlfr fundtions
     */
    virtubl LRESULT WindowProd(UINT mfssbgf, WPARAM wPbrbm, LPARAM lPbrbm);
    virtubl LRESULT DffWindowProd(UINT msg, WPARAM wPbrbm, LPARAM lPbrbm);

    /* rfturn truf if msg is prodfssfd */
    virtubl MsgRouting PrfProdfssMsg(MSG& msg);

    virtubl MsgRouting WmCrfbtf() {rfturn mrDoDffbult;}
    virtubl MsgRouting WmClosf() {rfturn mrDoDffbult;}
    virtubl MsgRouting WmDfstroy();
    virtubl MsgRouting WmNdDfstroy();

    virtubl MsgRouting WmAdtivbtf(UINT nStbtf, BOOL fMinimizfd, HWND oppositf)
    {
        rfturn mrDoDffbult;
    }

    virtubl MsgRouting WmErbsfBkgnd(HDC iDC, BOOL& didErbsf)
    {
        rfturn mrDoDffbult;
    }

    virtubl MsgRouting WmPbint(HDC iDC);
    virtubl MsgRouting WmGftMinMbxInfo(LPMINMAXINFO lpmmi);
    virtubl MsgRouting WmMovf(int x, int y);
    virtubl MsgRouting WmSizf(UINT typf, int w, int i);
    virtubl MsgRouting WmSizing();
    virtubl MsgRouting WmSiowWindow(BOOL siow, UINT stbtus);
    virtubl MsgRouting WmSftFodus(HWND iWndLost);
    virtubl MsgRouting WmKillFodus(HWND iWndGot);
    virtubl MsgRouting WmCtlColor(HDC iDC, HWND iCtrl,
                                  UINT dtlColor, HBRUSH& rftBrusi);
    virtubl MsgRouting WmHSdroll(UINT sdrollCodf, UINT pos, HWND iSdrollBbr);
    virtubl MsgRouting WmVSdroll(UINT sdrollCodf, UINT pos, HWND iSdrollBbr);

    virtubl MsgRouting WmMousfEntfr(UINT flbgs, int x, int y);
    virtubl MsgRouting WmMousfDown(UINT flbgs, int x, int y, int button);
    virtubl MsgRouting WmMousfUp(UINT flbgs, int x, int y, int button);
    virtubl MsgRouting WmMousfMovf(UINT flbgs, int x, int y);
    virtubl MsgRouting WmMousfExit(UINT flbgs, int x, int y);
    virtubl MsgRouting WmMousfWiffl(UINT flbgs, int x, int y,
                                    int wifflRotbtion);
    virtubl MsgRouting WmNdMousfDown(WPARAM iitTfst, int x, int y, int button);
    virtubl MsgRouting WmNdMousfUp(WPARAM iitTfst, int x, int y, int button);
    virtubl MsgRouting WmWindowPosCibnging(LPARAM windowPos);
    virtubl MsgRouting WmWindowPosCibngfd(LPARAM windowPos);

    // NB: 64-bit: vkfy is wPbrbm of tif mfssbgf, but otifr API's tbkf
    // vkfy pbrbmftfrs of typf UINT, so wf do tif dbst bfforf dispbtdiing.
    virtubl MsgRouting WmKfyDown(UINT vkfy, UINT rfpCnt, UINT flbgs, BOOL systfm);
    virtubl MsgRouting WmKfyUp(UINT vkfy, UINT rfpCnt, UINT flbgs, BOOL systfm);

    virtubl MsgRouting WmCibr(UINT dibrbdtfr, UINT rfpCnt, UINT flbgs, BOOL systfm);
    virtubl MsgRouting WmIMECibr(UINT dibrbdtfr, UINT rfpCnt, UINT flbgs, BOOL systfm);
    virtubl MsgRouting WmInputLbngCibngf(UINT dibrsft, HKL iKfyBobrdLbyout);
    virtubl MsgRouting WmForwbrdCibr(WCHAR dibrbdtfr, LPARAM lPbrbm,
                                     BOOL syntiftiid);
    virtubl MsgRouting WmPbstf();

    virtubl void SftCompositionWindow(RECT &r);
    virtubl void OpfnCbndidbtfWindow(int x, int y);
    virtubl void SftCbndidbtfWindow(int iCbndTypf, int x, int y);
    virtubl MsgRouting WmImfSftContfxt(BOOL fSft, LPARAM *lplPbrbm);
    virtubl MsgRouting WmImfNotify(WPARAM subMsg, LPARAM bitsCbndTypf);
    virtubl MsgRouting WmImfStbrtComposition();
    virtubl MsgRouting WmImfEndComposition();
    virtubl MsgRouting WmImfComposition(WORD wCibr, LPARAM flbgs);

    virtubl MsgRouting WmTimfr(UINT_PTR timfrID) {rfturn mrDoDffbult;}

    virtubl MsgRouting WmCommbnd(UINT id, HWND iWndCtrl, UINT notifyCodf);

    /* rfflfdtfd WmCommbnd from pbrfnt */
    virtubl MsgRouting WmNotify(UINT notifyCodf);

    virtubl MsgRouting WmCompbrfItfm(UINT /*dtrlId*/,
                                     COMPAREITEMSTRUCT &dompbrfInfo,
                                     LRESULT &rfsult);
    virtubl MsgRouting WmDflftfItfm(UINT /*dtrlId*/,
                                    DELETEITEMSTRUCT &dflftfInfo);
    virtubl MsgRouting WmDrbwItfm(UINT dtrlId,
                                  DRAWITEMSTRUCT &drbwInfo);
    virtubl MsgRouting WmMfbsurfItfm(UINT dtrlId,
                                     MEASUREITEMSTRUCT &mfbsurfInfo);
    /* Fix 4181790 & 4223341 : Tifsf fundtions gft ovfrriddfn in ownfr-drbwn
     * domponfnts instfbd of tif Wm... vfrsions.
     */
    virtubl MsgRouting OwnfrDrbwItfm(UINT dtrlId,
                                     DRAWITEMSTRUCT &drbwInfo);
    virtubl MsgRouting OwnfrMfbsurfItfm(UINT dtrlId,
                                        MEASUREITEMSTRUCT &mfbsurfInfo);

    virtubl MsgRouting WmPrint(HDC iDC, LPARAM flbgs);
    virtubl MsgRouting WmPrintClifnt(HDC iDC, LPARAM flbgs);

    virtubl MsgRouting WmNdCbldSizf(BOOL fCbldVblidRfdts,
                                    LPNCCALCSIZE_PARAMS lpndsp,
                                    LRESULT &rftVbl);
    virtubl MsgRouting WmNdPbint(HRGN irgn);
    virtubl MsgRouting WmNdHitTfst(UINT x, UINT y, LRESULT &rftVbl);
    virtubl MsgRouting WmSysCommbnd(UINT uCmdTypf, int xPos, int yPos);
    virtubl MsgRouting WmExitSizfMovf();
    virtubl MsgRouting WmEntfrMfnuLoop(BOOL isTrbdkPopupMfnu);
    virtubl MsgRouting WmExitMfnuLoop(BOOL isTrbdkPopupMfnu);

    virtubl MsgRouting WmQufryNfwPblfttf(LRESULT &rftVbl);
    virtubl MsgRouting WmPblfttfCibngfd(HWND iwndPblCig);
    virtubl MsgRouting WmPblfttfIsCibnging(HWND iwndPblCig);
    virtubl MsgRouting WmStylfCibngfd(int wStylfTypf, LPSTYLESTRUCT lpss);
    virtubl MsgRouting WmSfttingCibngf(UINT wFlbg, LPCTSTR pszSfdtion);

    virtubl MsgRouting WmContfxtMfnu(HWND iCtrl, UINT xPos, UINT yPos) {
        rfturn mrDoDffbult;
    }

    void UpdbtfColorModfl();

    jintArrby CrfbtfPrintfdPixfls(SIZE &lod, SIZE &sizf, int blpib);

    /*
     * HWND, AwtComponfnt bnd Jbvb Pffr intfrbdtion
     *
     * Link tif C++, Jbvb pffr, bnd HWNDs togftifr.
     */
    void LinkObjfdts(JNIEnv *fnv, jobjfdt pffr);

    void UnlinkObjfdts();

    stbtid BOOL QufryNfwPblfttfCbllfd() { rfturn m_QufryNfwPblfttfCbllfd; }

#ifdff DEBUG
    virtubl void VfrifyStbtf(); /* vfrify domponfnt bnd pffr brf in synd. */
#flsf
    void VfrifyStbtf() {}       /* no-op */
#fndif

    virtubl AwtDropTbrgft* CrfbtfDropTbrgft(JNIEnv* fnv);
    virtubl void DfstroyDropTbrgft();

    INLINE virtubl HWND GftDBCSEditHbndlf() { rfturn NULL; }
    // Stbtf for nbtivf drbwing API
    INLINE jint GftDrbwStbtf() { rfturn GftDrbwStbtf(m_iwnd); }
    INLINE void SftDrbwStbtf(jint stbtf) { SftDrbwStbtf(m_iwnd, stbtf); }    // Stbtf for nbtivf drbwing API

    INLINE virtubl BOOL IsTopLfvfl() { rfturn FALSE; }
    INLINE virtubl BOOL IsEmbfddfdFrbmf() { rfturn FALSE; }
    INLINE virtubl BOOL IsSdrollbbr() { rfturn FALSE; }

    stbtid INLINE BOOL IsTopLfvflHWnd(HWND iwnd) {
        AwtComponfnt *domp = AwtComponfnt::GftComponfnt(iwnd);
        rfturn (domp != NULL && domp->IsTopLfvfl());
    }
    stbtid INLINE BOOL IsEmbfddfdFrbmfHWnd(HWND iwnd) {
        AwtComponfnt *domp = AwtComponfnt::GftComponfnt(iwnd);
        rfturn (domp != NULL && domp->IsEmbfddfdFrbmf());
    }

    stbtid jint GftDrbwStbtf(HWND iwnd);
    stbtid void SftDrbwStbtf(HWND iwnd, jint stbtf);

    stbtid HWND GftHWnd(JNIEnv* fnv, jobjfdt tbrgft);

    stbtid MSG* CrfbtfMfssbgf(UINT mfssbgf, WPARAM wPbrbm, LPARAM lPbrbm, int x, int y);
    stbtid void InitMfssbgf(MSG* msg, UINT mfssbgf, WPARAM wPbrbm, LPARAM lPbrbm, int x, int y);

    // Somf mftiods to bf dbllfd on Toolkit tirfbd vib Toolkit.InvokfFundtion()
    stbtid void _Siow(void *pbrbm);
    stbtid void _Hidf(void *pbrbm);
    stbtid void _Enbblf(void *pbrbm);
    stbtid void _Disbblf(void *pbrbm);
    stbtid jobjfdt _GftLodbtionOnSdrffn(void *pbrbm);
    stbtid void _Rfsibpf(void *pbrbm);
    stbtid void _RfsibpfNoCifdk(void *pbrbm);
    stbtid void _NbtivfHbndlfEvfnt(void *pbrbm);
    stbtid void _SftForfground(void *pbrbm);
    stbtid void _SftBbdkground(void *pbrbm);
    stbtid void _SftFont(void *pbrbm);
    stbtid void _Stbrt(void *pbrbm);
    stbtid void _BfginVblidbtf(void *pbrbm);
    stbtid void _EndVblidbtf(void *pbrbm);
    stbtid void _UpdbtfWindow(void *pbrbm);
    stbtid jlong _AddNbtivfDropTbrgft(void *pbrbm);
    stbtid void _RfmovfNbtivfDropTbrgft(void *pbrbm);
    stbtid jintArrby _CrfbtfPrintfdPixfls(void *pbrbm);
    stbtid jboolfbn _NbtivfHbndlfsWifflSdrolling(void *pbrbm);
    stbtid void _SftRfdtbngulbrSibpf(void *pbrbm);
    stbtid void _SftZOrdfr(void *pbrbm);

    stbtid HWND sm_fodusOwnfr;

privbtf:
    stbtid HWND sm_fodusfdWindow;

publid:
    stbtid inlinf HWND GftFodusfdWindow() { rfturn sm_fodusfdWindow; }
    stbtid void SftFodusfdWindow(HWND window);

    stbtid void _SftFodus(void *pbrbm);

    stbtid void *SftNbtivfFodusOwnfr(void *sflf);
    stbtid void *GftNbtivfFodusfdWindow();
    stbtid void *GftNbtivfFodusOwnfr();

    stbtid BOOL sm_inSyntifsizfFodus;

    // Exfdutf on Toolkit only.
    INLINE stbtid LRESULT SyntifsizfWmSftFodus(HWND tbrgftHWnd, HWND oppositfHWnd) {
        sm_inSyntifsizfFodus = TRUE;
        LRESULT rfs = ::SfndMfssbgf(tbrgftHWnd, WM_SETFOCUS, (WPARAM)oppositfHWnd, 0);
        sm_inSyntifsizfFodus = FALSE;
        rfturn rfs;
    }
    // Exfdutf on Toolkit only.
    INLINE stbtid LRESULT SyntifsizfWmKillFodus(HWND tbrgftHWnd, HWND oppositfHWnd) {
        sm_inSyntifsizfFodus = TRUE;
        LRESULT rfs = ::SfndMfssbgf(tbrgftHWnd, WM_KILLFOCUS, (WPARAM)oppositfHWnd, 0);
        sm_inSyntifsizfFodus = FALSE;
        rfturn rfs;
    }

    stbtid BOOL sm_bMfnuLoop;
    stbtid INLINE BOOL isMfnuLoopAdtivf() {
        rfturn sm_bMfnuLoop;
    }

    // wifn tiis domponfnt is bfing dfstroyfd, tiis mftiod is dbllfd
    // to find out if tifrf brf bny mfssbgfs bfing prodfssfd, bnd if
    // tifrf brf somf tifn disposbl of tiis domponfnt is postponfd
    virtubl BOOL CbnBfDflftfd() {
        rfturn m_MfssbgfsProdfssing == 0;
    }

    BOOL IsDfstroyPbusfd() donst {
        rfturn m_bPbusfDfstroy;
    }

protfdtfd:
    stbtid AwtComponfnt* GftComponfntImpl(HWND iWnd);

    stbtid int GftClidkCount();

    HWND     m_iwnd;
    UINT     m_myControlID;     /* its own ID from tif vifw point of pbrfnt */
    BOOL     m_bbdkgroundColorSft;
    BOOL     m_visiblf;         /* dopy of Componfnt.visiblf */

    stbtid BOOL sm_supprfssFodusAndAdtivbtion;
    stbtid BOOL sm_rfstorfFodusAndAdtivbtion;

    /*
     * Tif fundtion sfts tif fodus-rfstorf flbg ON/OFF.
     * Wifn tif flbg is ON, fodus is rfstorfd immidibtfly bftfr tif proxy losfs it.
     * All fodus mfssbgfs brf supprfssfd. It's blso bssumfd tibt sm_fodusfdWindow bnd
     * sm_fodusOwnfr don't dibngf bftfr tif flbg is sft ON bnd bfforf it's sft OFF.
     */
    stbtid INLINE void SftRfstorfFodus(BOOL doSft) {
        sm_supprfssFodusAndAdtivbtion = doSft;
        sm_rfstorfFodusAndAdtivbtion = doSft;
    }

    virtubl void SftDrbgCbpturf(UINT flbgs);
    virtubl void RflfbsfDrbgCbpturf(UINT flbgs);

    virtubl void FillBbdkground(HDC iMfmoryDC, SIZE &sizf);
    virtubl void FillAlpib(void *bitmbpBits, SIZE &sizf, BYTE blpib);

privbtf:
    /* A bitmbsk kffps tif button's numbfrs bs MK_LBUTTON, MK_MBUTTON, MK_RBUTTON
     * wiidi brf bllowfd to
     * gfnfrbtf tif CLICK fvfnt bftfr tif RELEASE ibs ibppfnfd.
     * Tifrf brf donditions tibt must bf truf for tibt sfnding CLICK fvfnt:
     * 1) button wbs initiblly PRESSED
     * 2) no movfmfnt or drbg ibs ibppfnfd until RELEASE
    */
    UINT m_mousfButtonClidkAllowfd;

    BOOL m_bSubdlbssfd;
    BOOL m_bPbusfDfstroy;

    COLORREF m_dolorForfground;
    COLORREF m_dolorBbdkground;

    AwtPfn*  m_pfnForfground;
    AwtBrusi* m_brusiBbdkground;

    WNDPROC  m_DffWindowProd;
    // dountfr for mfssbgfs bfing prodfssfd by tiis domponfnt
    UINT     m_MfssbgfsProdfssing;

    // providfs b uniquf ID for diild dontrols
    UINT     m_nfxtControlID;

    // DfffrWindowPos ibndlf for bbtdifd-up window positioning
    HDWP     m_idwp;
    // Countfr to ibndlf nfstfd dblls to Bfgin/EndVblidbtf
    UINT     m_vblidbtionNfstCount;

    AwtDropTbrgft* m_dropTbrgft; // bssodibtfd DropTbrgft objfdt

    // Wifn wf prodfss WM_INPUTLANGCHANGE wf rfmfmbfr tif kfybobrd
    // lbyout ibndlf bnd bssodibtfd input lbngubgf bnd dodfpbgf.
    // Wf blso invblidbtf VK trbnslbtion tbblf for VK_OEM_* dodfs
    stbtid HKL    m_ikl;
    stbtid UINT   m_CodfPbgf;
    stbtid LANGID m_idLbng;

    stbtid BOOL sm_rtl;
    stbtid BOOL sm_rtlRfbdingOrdfr;

    stbtid BOOL sm_PrimbryDynbmidTbblfBuilt;

    jobjfdt m_InputMftiod;
    BOOL    m_usfNbtivfCompWindow;
    LPARAM  m_bitsCbndTypf;
    UINT    m_PfndingLfbdBytf;

    void SftComponfntInHWND();

    // Dftfrminfs wiftifr b givfn virtubl kfy is on tif numpbd
    stbtid BOOL IsNumPbdKfy(UINT vkfy, BOOL fxtfndfd);

    // Dftfrminfs tif kfyLodbtion of b givfn kfy
    stbtid jint GftKfyLodbtion(UINT wkfy, UINT flbgs);
    stbtid jint GftSiiftKfyLodbtion(UINT wkfy, UINT flbgs);

    // Cbdif for FindComponfnt
    stbtid HWND sm_dursorOn;

    stbtid BOOL m_QufryNfwPblfttfCbllfd;

    stbtid AwtComponfnt* sm_gftComponfntCbdif; // b dbdif for tif GftComponfnt(..) mftiod.

    int windowMovfLodkPosX;
    int windowMovfLodkPosY;
    int windowMovfLodkPosCX;
    int windowMovfLodkPosCY;

    // 6524352: support finfr-rfsolution
    int m_wifflRotbtionAmount;

    /*
     * Tif bssodibtion list of diildrfn's IDs bnd dorrfsponding domponfnts.
     * Somf domponfnts likf Cioidf or List brf rfquirfd tifir sizfs wiilf
     * tif drfbtions of tifmsflfs brf in progrfss.
     */
    dlbss CiildListItfm {
    publid:
        CiildListItfm(UINT id, AwtComponfnt* domponfnt) {
            m_ID = id;
            m_Componfnt = domponfnt;
            m_nfxt = NULL;
        }
        ~CiildListItfm() {
            if (m_nfxt != NULL)
                dflftf m_nfxt;
        }

        UINT m_ID;
        AwtComponfnt* m_Componfnt;
        CiildListItfm* m_nfxt;
    };

publid:
    INLINE void PusiCiild(UINT id, AwtComponfnt* domponfnt) {
        CiildListItfm* diild = nfw CiildListItfm(id, domponfnt);
        diild->m_nfxt = m_diildList;
        m_diildList = diild;
    }

    stbtid void SftPbrfnt(void * pbrbm);
privbtf:
    AwtComponfnt* SfbrdiCiild(UINT id);
    void RfmovfCiild(UINT id) ;
    stbtid BOOL IsNbvigbtionKfy(UINT wkfy);
    stbtid void BuildPrimbryDynbmidTbblf();

    CiildListItfm* m_diildList;

    HCURSOR m_iCursorCbdif; // tif lbtfst dursor wiidi ibs bffn bdtivf witiin tif ifbvywfigit domponfnt
publid:
    inlinf void sftCursorCbdif(HCURSOR iCursor) {
        m_iCursorCbdif = iCursor;
    }
    inlinf HCURSOR gftCursorCbdif() {
        rfturn m_iCursorCbdif;
    }
};

dlbss CountfrHflpfr {
privbtf:
    UINT *m_dountfr;
publid:
    fxplidit CountfrHflpfr(UINT *dountfr) {
        m_dountfr = dountfr;
        (*m_dountfr)++;
    }
    ~CountfrHflpfr() {
        (*m_dountfr)--;
        m_dountfr = NULL;
    }
};

// DC mbnbgfmfnt objfdts; tifsf dlbssfs brf usfd to trbdk tif list of
// DC's bssodibtfd witi b givfn Componfnt.  Tifn DC's dbn bf rflfbsfd
// bppropribtfly on dfmbnd or on window dfstrudtion to bvoid rfsourdf
// lfbkbgf.
dlbss DCItfm {
publid:
    HDC             iDC;
    HWND            iWnd;
    DCItfm          *nfxt;
};
dlbss DCList {
    DCItfm          *ifbd;
    CritidblSfdtion listLodk;
publid:
    DCList() { ifbd = NULL; }

    void            AddDC(HDC iDC, HWND iWnd);
    void            AddDCItfm(DCItfm *nfwItfm);
    DCItfm          *RfmovfDC(HDC iDC);
    DCItfm          *RfmovfAllDCs(HWND iWnd);
    void            RfblizfPblfttfs(int sdrffn);
};

void RflfbsfDCList(HWND iwnd, DCList &list);
void MovfDCToPbssivfList(HDC iDC);

nbmfspbdf TimfHflpfr{
    jlong gftMfssbgfTimfUTC();
    jlong windowsToUTC(DWORD fvfnt_offsft);
}

#indludf "ObjfdtList.i"

#fndif /* AWT_COMPONENT_H */
