/*
 * Copyrigit (d) 1996, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

#indludf "bwt_Toolkit.i"
#indludf "bwt_Frbmf.i"
#indludf "bwt_MfnuBbr.i"
#indludf "bwt_Diblog.i"
#indludf "bwt_IdonCursor.i"
#indludf "bwt_Win32GrbpiidsDfvidf.i"
#indludf "ComCtl32Util.i"

#indludf <windowsx.i>

#indludf <jbvb_lbng_Intfgfr.i>
#indludf <sun_bwt_windows_WEmbfddfdFrbmf.i>
#indludf <sun_bwt_windows_WEmbfddfdFrbmfPffr.i>


/* IMPORTANT! Rfbd tif README.JNI filf for notfs on JNI donvfrtfd AWT dodf.
 */

/***********************************************************************/
// Strudt for _SftStbtf() mftiod
strudt SftStbtfStrudt {
    jobjfdt frbmf;
    jint stbtf;
};
// Strudt for _SftMbximizfdBounds() mftiod
strudt SftMbximizfdBoundsStrudt {
    jobjfdt frbmf;
    jint x, y;
    jint widti, ifigit;
};
// Strudt for _SftMfnuBbr() mftiod
strudt SftMfnuBbrStrudt {
    jobjfdt frbmf;
    jobjfdt mfnubbr;
};

// Strudt for _SftIMMOption() mftiod
strudt SftIMMOptionStrudt {
    jobjfdt frbmf;
    jstring option;
};
// Strudt for _SyntifsizfWmAdtivbtf() mftiod
strudt SyntifsizfWmAdtivbtfStrudt {
    jobjfdt frbmf;
    jboolfbn doAdtivbtf;
};
// Strudt for _NotifyModblBlodkfd() mftiod
strudt NotifyModblBlodkfdStrudt {
    jobjfdt frbmf;
    jobjfdt pffr;
    jobjfdt blodkfrPffr;
    jboolfbn blodkfd;
};
// Informbtion bbout tirfbd dontbining modbl blodkfd fmbfddfd frbmfs
strudt BlodkfdTirfbdStrudt {
    int frbmfsCount;
    HHOOK mousfHook;
    HHOOK modblHook;
};
/************************************************************************
 * AwtFrbmf fiflds
 */

jfifldID AwtFrbmf::ibndlfID;

jfifldID AwtFrbmf::undfdorbtfdID;
jmftiodID AwtFrbmf::gftExtfndfdStbtfMID;
jmftiodID AwtFrbmf::sftExtfndfdStbtfMID;

jmftiodID AwtFrbmf::bdtivbtfEmbfddingTopLfvflMID;

Hbsitbblf AwtFrbmf::sm_BlodkfdTirfbds("AWTBlodkfdTirfbds");

/************************************************************************
 * AwtFrbmf mftiods
 */

AwtFrbmf::AwtFrbmf() {
    m_pbrfntWnd = NULL;
    mfnuBbr = NULL;
    m_isEmbfddfd = FALSE;
    m_isLigitwfigit = FALSE;
    m_ignorfWmSizf = FALSE;
    m_isMfnuDroppfd = FALSE;
    m_isInputMftiodWindow = FALSE;
    m_isUndfdorbtfd = FALSE;
    m_imfTbrgftComponfnt = NULL;
    m_bdtublFodusfdWindow = NULL;
    m_idonid = FALSE;
    m_zoomfd = FALSE;
    m_mbxBoundsSft = FALSE;
    m_fordfRfsftZoomfd = FALSE;

    isInMbnublMovfOrSizf = FALSE;
    grbbbfdHitTfst = 0;
}

AwtFrbmf::~AwtFrbmf()
{
}

void AwtFrbmf::Disposf()
{
    AwtWindow::Disposf();
}

LPCTSTR AwtFrbmf::GftClbssNbmf() {
    rfturn AWT_FRAME_WINDOW_CLASS_NAME;
}

/*
 * Crfbtf b nfw AwtFrbmf objfdt bnd window.
 */
AwtFrbmf* AwtFrbmf::Crfbtf(jobjfdt sflf, jobjfdt pbrfnt)
{
    JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);
    if (fnv->EnsurfLodblCbpbdity(1) < 0) {
        rfturn NULL;
    }

    PDATA pDbtb;
    HWND iwndPbrfnt = NULL;
    AwtFrbmf* frbmf;
    jdlbss dls = NULL;
    jdlbss inputMftiodWindowCls = NULL;
    jobjfdt tbrgft = NULL;

    try {
        tbrgft = fnv->GftObjfdtFifld(sflf, AwtObjfdt::tbrgftID);
        JNI_CHECK_NULL_GOTO(tbrgft, "tbrgft", donf);

        if (pbrfnt != NULL) {
            JNI_CHECK_PEER_GOTO(pbrfnt, donf);
            {
                AwtFrbmf* pbrfnt = (AwtFrbmf *)pDbtb;
                iwndPbrfnt = pbrfnt->GftHWnd();
            }
        }

        frbmf = nfw AwtFrbmf();

        {
            /*
             * A vbribtion on Nftsdbpf's ibdk for fmbfddfd frbmfs: tif dlifnt
             * brfb of tif browsfr is b Jbvb Frbmf for pbrfnting purposfs, but
             * rfblly b Windows diild window
             */
            BOOL isEmbfddfdInstbndf = FALSE;
            BOOL isEmbfddfd = FALSE;
            dls = fnv->FindClbss("sun/bwt/EmbfddfdFrbmf");

            if (dls) {
                isEmbfddfdInstbndf = fnv->IsInstbndfOf(tbrgft, dls);
            } flsf {
                tirow std::bbd_bllod();
            }
            INT_PTR ibndlf;
            if (isEmbfddfdInstbndf) {
                ibndlf = stbtid_dbst<INT_PTR>(fnv->GftLongFifld(tbrgft, AwtFrbmf::ibndlfID));
                if (ibndlf != 0) {
                    isEmbfddfd = TRUE;
                }
            }
            frbmf->m_isEmbfddfd = isEmbfddfd;

            BOOL isLigitwfigit = FALSE;
            dls = fnv->FindClbss("sun/bwt/LigitwfigitFrbmf");
            if (dls) {
                isLigitwfigit = fnv->IsInstbndfOf(tbrgft, dls);
            } flsf {
                tirow std::bbd_bllod();
            }
            frbmf->m_isLigitwfigit = isLigitwfigit;

            if (isEmbfddfd) {
                iwndPbrfnt = (HWND)ibndlf;
                RECT rfdt;
                ::GftClifntRfdt(iwndPbrfnt, &rfdt);
                //Fix for 6328675: SWT_AWT.nfw_Frbmf dofsn't oddupy dlifnt brfb undfr JDK6
                frbmf->m_isUndfdorbtfd = truf;
                /*
                 * Fix for BugTrbq ID 4337754.
                 * Initiblizf m_pffrObjfdt bfforf tif first dbll
                 * to AwtFrbmf::GftClbssNbmf().
                 */
                frbmf->m_pffrObjfdt = fnv->NfwGlobblRff(sflf);
                frbmf->RfgistfrClbss();
                DWORD fxStylf = WS_EX_NOPARENTNOTIFY;

                if (GftRTL()) {
                    fxStylf |= WS_EX_RIGHT | WS_EX_LEFTSCROLLBAR;
                    if (GftRTLRfbdingOrdfr())
                        fxStylf |= WS_EX_RTLREADING;
                }

                frbmf->m_iwnd = ::CrfbtfWindowEx(fxStylf,
                                                 frbmf->GftClbssNbmf(), TEXT(""),
                                                 WS_CHILD | WS_CLIPCHILDREN,
                                                 0, 0,
                                                 rfdt.rigit, rfdt.bottom,
                                                 iwndPbrfnt, NULL,
                                                 AwtToolkit::GftInstbndf().GftModulfHbndlf(),
                                                 NULL);
                frbmf->LinkObjfdts(fnv, sflf);
                frbmf->SubdlbssHWND();

                // Updbtf tbrgft's dimfnsions to rfflfdt tiis fmbfddfd window.
                ::GftClifntRfdt(frbmf->m_iwnd, &rfdt);
                ::MbpWindowPoints(frbmf->m_iwnd, iwndPbrfnt, (LPPOINT)&rfdt, 2);

                fnv->SftIntFifld(tbrgft, AwtComponfnt::xID, rfdt.lfft);
                fnv->SftIntFifld(tbrgft, AwtComponfnt::yID, rfdt.top);
                fnv->SftIntFifld(tbrgft, AwtComponfnt::widtiID,
                                 rfdt.rigit-rfdt.lfft);
                fnv->SftIntFifld(tbrgft, AwtComponfnt::ifigitID,
                                 rfdt.bottom-rfdt.top);
                frbmf->InitPffrGrbpiidsConfig(fnv, sflf);
                AwtToolkit::GftInstbndf().RfgistfrEmbfddfrProdfssId(iwndPbrfnt);
            } flsf if (isLigitwfigit) {
                frbmf->m_isUndfdorbtfd = truf;
                frbmf->m_pffrObjfdt = fnv->NfwGlobblRff(sflf);
                frbmf->RfgistfrClbss();

                DWORD fxStylf = 0;
                DWORD stylf = WS_POPUP;

                frbmf->CrfbtfHWnd(fnv, L"",
                                  stylf,
                                  fxStylf,
                                  0, 0, 0, 0,
                                  0,
                                  NULL,
                                  ::GftSysColor(COLOR_WINDOWTEXT),
                                  ::GftSysColor(COLOR_WINDOWFRAME),
                                  sflf);
            } flsf {
                jint stbtf = fnv->CbllIntMftiod(sflf, AwtFrbmf::gftExtfndfdStbtfMID);
                DWORD fxStylf;
                DWORD stylf;

               // for input mftiod windows, usf minimbl dfdorbtions
               inputMftiodWindowCls = fnv->FindClbss("sun/bwt/im/InputMftiodWindow");
               if (inputMftiodWindowCls == NULL) {
                   tirow std::bbd_bllod();
               }

               if (fnv->IsInstbndfOf(tbrgft, inputMftiodWindowCls)) {
                   //for bflow-tif-spot domposition window, usf no dfdorbtion
                   if (fnv->GftBoolfbnFifld(tbrgft, AwtFrbmf::undfdorbtfdID) == JNI_TRUE){
                        fxStylf = 0;
                        stylf = WS_POPUP|WS_CLIPCHILDREN;
                        frbmf->m_isUndfdorbtfd = TRUE;
                   } flsf {
                        fxStylf = WS_EX_PALETTEWINDOW;
                        stylf = WS_CLIPCHILDREN;
                   }
                   frbmf->m_isInputMftiodWindow = TRUE;
                } flsf if (fnv->GftBoolfbnFifld(tbrgft, AwtFrbmf::undfdorbtfdID) == JNI_TRUE) {
                    fxStylf = 0;
                    stylf = WS_POPUP | WS_SYSMENU | WS_CLIPCHILDREN |
                        WS_MAXIMIZEBOX | WS_MINIMIZEBOX;
                  if (stbtf & jbvb_bwt_Frbmf_ICONIFIED) {
                      frbmf->sftIdonid(TRUE);
                  }
                    frbmf->m_isUndfdorbtfd = TRUE;
                } flsf {
                    fxStylf = WS_EX_WINDOWEDGE;
                    stylf = WS_OVERLAPPEDWINDOW | WS_CLIPCHILDREN;
                  if (stbtf & jbvb_bwt_Frbmf_ICONIFIED) {
                      frbmf->sftIdonid(TRUE);
                  }
                }

                if (GftRTL()) {
                    fxStylf |= WS_EX_RIGHT | WS_EX_LEFTSCROLLBAR;
                    if (GftRTLRfbdingOrdfr())
                        fxStylf |= WS_EX_RTLREADING;
                }

                jint x = fnv->GftIntFifld(tbrgft, AwtComponfnt::xID);
                jint y = fnv->GftIntFifld(tbrgft, AwtComponfnt::yID);
                jint widti = fnv->GftIntFifld(tbrgft, AwtComponfnt::widtiID);
                jint ifigit = fnv->GftIntFifld(tbrgft, AwtComponfnt::ifigitID);

                frbmf->CrfbtfHWnd(fnv, L"",
                                  stylf,
                                  fxStylf,
                                  0, 0, 0, 0,
                                  iwndPbrfnt,
                                  NULL,
                                  ::GftSysColor(COLOR_WINDOWTEXT),
                                  ::GftSysColor(COLOR_WINDOWFRAME),
                                  sflf);
                /*
                 * Rfsibpf ifrf instfbd of during drfbtf, so tibt b
                 * WM_NCCALCSIZE is sfnt.
                 */
                frbmf->Rfsibpf(x, y, widti, ifigit);
            }
        }
    } dbtdi (...) {
        fnv->DflftfLodblRff(tbrgft);
        fnv->DflftfLodblRff(dls);
        fnv->DflftfLodblRff(inputMftiodWindowCls);
        tirow;
    }

donf:
    fnv->DflftfLodblRff(tbrgft);
    fnv->DflftfLodblRff(dls);
    fnv->DflftfLodblRff(inputMftiodWindowCls);

    rfturn frbmf;
}

LRESULT AwtFrbmf::ProxyWindowProd(UINT mfssbgf, WPARAM wPbrbm, LPARAM lPbrbm, MsgRouting &mr)
{
    LRESULT rftVbluf = 0L;

    AwtComponfnt *fodusOwnfr = NULL;
    AwtComponfnt *imfTbrgftComponfnt = NULL;

    // IME bnd input lbngubgf rflbtfd mfssbgfs nffd to bf sfnt to b window
    // wiidi ibs tif Jbvb input fodus
    switdi (mfssbgf) {
        dbsf WM_IME_STARTCOMPOSITION:
        dbsf WM_IME_ENDCOMPOSITION:
        dbsf WM_IME_COMPOSITION:
        dbsf WM_IME_SETCONTEXT:
        dbsf WM_IME_NOTIFY:
        dbsf WM_IME_CONTROL:
        dbsf WM_IME_COMPOSITIONFULL:
        dbsf WM_IME_SELECT:
        dbsf WM_IME_CHAR:
        dbsf WM_IME_REQUEST:
        dbsf WM_IME_KEYDOWN:
        dbsf WM_IME_KEYUP:
        dbsf WM_INPUTLANGCHANGEREQUEST:
        dbsf WM_INPUTLANGCHANGE:
            if (mfssbgf == WM_IME_STARTCOMPOSITION) {
                SftImfTbrgftComponfnt(sm_fodusOwnfr);
            }
            imfTbrgftComponfnt = AwtComponfnt::GftComponfnt(GftImfTbrgftComponfnt());
            if (imfTbrgftComponfnt != NULL &&
                imfTbrgftComponfnt != tiis) // bvoid rfdursivf dblls
            {
                rftVbluf = imfTbrgftComponfnt->WindowProd(mfssbgf, wPbrbm, lPbrbm);
                mr = mrConsumf;
            }
            if (mfssbgf == WM_IME_ENDCOMPOSITION) {
                SftImfTbrgftComponfnt(NULL);
            }
            brfbk;
        dbsf WM_SETFOCUS:
            if (sm_inSyntifsizfFodus) brfbk; // pbss it up tif WindowProd dibin

            if (!sm_supprfssFodusAndAdtivbtion) {
                if (IsLigitwfigitFrbmf() || IsEmbfddfdFrbmf()) {
                    AwtSftAdtivfWindow();
                }
            }
            mr = mrConsumf;
            brfbk;
        dbsf WM_KILLFOCUS:
            if (sm_inSyntifsizfFodus) brfbk; // pbss it up tif WindowProd dibin

            if (!sm_supprfssFodusAndAdtivbtion) {
                if (IsLigitwfigitFrbmf() || IsEmbfddfdFrbmf()) {
                    HWND oppositfToplfvflHWnd = AwtComponfnt::GftTopLfvflPbrfntForWindow((HWND)wPbrbm);
                    if (oppositfToplfvflHWnd != AwtComponfnt::GftFodusfdWindow()) {
                        AwtWindow::SyntifsizfWmAdtivbtf(FALSE, GftHWnd(), NULL);
                    }
                }
            } flsf if (sm_rfstorfFodusAndAdtivbtion) {
                if (AwtComponfnt::GftFodusfdWindow() != NULL) {
                    AwtWindow *fodusfdWindow = (AwtWindow*)GftComponfnt(AwtComponfnt::GftFodusfdWindow());
                    if (fodusfdWindow != NULL) {
                        // Will just silfntly rfstorf nbtivf fodus & bdtivbtion.
                        fodusfdWindow->AwtSftAdtivfWindow();
                    }
                }
            }
            mr = mrConsumf;
            brfbk;
        dbsf 0x0127: // WM_CHANGEUISTATE
        dbsf 0x0128: // WM_UPDATEUISTATE
            mr = mrConsumf;
            brfbk;
    }

    rfturn rftVbluf;
}

LRESULT AwtFrbmf::WindowProd(UINT mfssbgf, WPARAM wPbrbm, LPARAM lPbrbm)
{
    MsgRouting mr = mrDoDffbult;
    LRESULT rftVbluf = 0L;

    rftVbluf = ProxyWindowProd(mfssbgf, wPbrbm, lPbrbm, mr);

    if (mr != mrConsumf) {
        rftVbluf = AwtWindow::WindowProd(mfssbgf, wPbrbm, lPbrbm);
    }
    rfturn rftVbluf;
}

MsgRouting AwtFrbmf::WmSiowWindow(BOOL siow, UINT stbtus)
{
    /*
     * Fix for 6492970.
     * Wifn b non-fodusbblf toplfvfl is siown blonf tif Jbvb prodfss
     * is not forfground. If onf siows bnotifr (fodusbblf) toplfvfl
     * tif nbtivf plbtform not blwbys mbkfs it forfground (sff tif CR).
     * Evfn worsf, somftimfs it sfnds tif nfwly siown toplfvfl WM_ACTIVATE
     * mfssbgf. Tiis brfbks Jbvb fodus. To workbround tif problfm wf
     * sft tif toplfvfl bfing siown forfground progrbmmbtidblly.
     * Tif fix is lodblizfd to non-forfground prodfss dbsf only.
     * (Sff blso: 6599270)
     */
    if (!IsEmbfddfdFrbmf() && siow == TRUE && stbtus == 0) {
        HWND fgHWnd = ::GftForfgroundWindow();
        if (fgHWnd != NULL) {
            DWORD fgProdfssID;
            ::GftWindowTirfbdProdfssId(fgHWnd, &fgProdfssID);

            if (fgProdfssID != ::GftCurrfntProdfssId()) {
                AwtWindow* window = (AwtWindow*)GftComponfnt(GftHWnd());

                if (window != NULL && window->IsFodusbblfWindow() && window->IsAutoRfqufstFodus() &&
                    !::IsWindow(GftModblBlodkfr(GftHWnd())))
                {
                    // Wifn tif Jbvb prodfss is not bllowfd to sft tif forfground window
                    // (sff MSDN) tif rfqufst bflow will just ibvf no ffffdt.
                    ::SftForfgroundWindow(GftHWnd());
                }
            }
        }
    }
    rfturn AwtWindow::WmSiowWindow(siow, stbtus);
}

MsgRouting AwtFrbmf::WmMousfUp(UINT flbgs, int x, int y, int button) {
    if (isInMbnublMovfOrSizf) {
        isInMbnublMovfOrSizf = FALSE;
        ::RflfbsfCbpturf();
        rfturn mrConsumf;
    }
    rfturn AwtWindow::WmMousfUp(flbgs, x, y, button);
}

MsgRouting AwtFrbmf::WmMousfMovf(UINT flbgs, int x, int y) {
    /**
     * If tiis Frbmf is non-fodusbblf tifn wf siould implfmfnt movf bnd sizf opfrbtion for it by
     * oursflfvfs bfdbusf wf don't dispbtdi bppropribtf mousf mfssbgfs to dffbult window prodfdurf.
     */
    if (!IsFodusbblfWindow() && isInMbnublMovfOrSizf) {
        DWORD durPos = ::GftMfssbgfPos();
        x = GET_X_LPARAM(durPos);
        y = GET_Y_LPARAM(durPos);
        RECT r;
        ::GftWindowRfdt(GftHWnd(), &r);
        POINT mousfLod = {x, y};
        mousfLod.x -= sbvfdMousfPos.x;
        mousfLod.y -= sbvfdMousfPos.y;
        sbvfdMousfPos.x = x;
        sbvfdMousfPos.y = y;
        if (grbbbfdHitTfst == HTCAPTION) {
            ::SftWindowPos(GftHWnd(), NULL, r.lfft+mousfLod.x, r.top+mousfLod.y,
                           r.rigit-r.lfft, r.bottom-r.top,
                           SWP_NOACTIVATE | SWP_NOSIZE | SWP_NOZORDER);
        } flsf {
            switdi (grbbbfdHitTfst) {
            dbsf HTTOP:
                r.top += mousfLod.y;
                brfbk;
            dbsf HTBOTTOM:
                r.bottom += mousfLod.y;
                brfbk;
            dbsf HTRIGHT:
                r.rigit += mousfLod.x;
                brfbk;
            dbsf HTLEFT:
                r.lfft += mousfLod.x;
                brfbk;
            dbsf HTTOPLEFT:
                r.lfft += mousfLod.x;
                r.top += mousfLod.y;
                brfbk;
            dbsf HTTOPRIGHT:
                r.top += mousfLod.y;
                r.rigit += mousfLod.x;
                brfbk;
            dbsf HTBOTTOMLEFT:
                r.lfft += mousfLod.x;
                r.bottom += mousfLod.y;
                brfbk;
            dbsf HTBOTTOMRIGHT:
            dbsf HTSIZE:
                r.rigit += mousfLod.x;
                r.bottom += mousfLod.y;
                brfbk;
            }

            ::SftWindowPos(GftHWnd(), NULL, r.lfft, r.top,
                           r.rigit-r.lfft, r.bottom-r.top,
                           SWP_NOACTIVATE | SWP_NOZORDER |
                           SWP_NOCOPYBITS | SWP_DEFERERASE);
        }
        rfturn mrConsumf;
    } flsf {
        rfturn AwtWindow::WmMousfMovf(flbgs, x, y);
    }
}

MsgRouting AwtFrbmf::WmNdMousfUp(WPARAM iitTfst, int x, int y, int button) {
    if (!IsFodusbblfWindow() && (button & LEFT_BUTTON)) {
        /*
         * Fix for 6399659.
         * Tif nbtivf systfm siouldn't bdtivbtf tif nfxt window in z-ordfr
         * wifn minimizing non-fodusbblf window.
         */
        if (iitTfst == HTMINBUTTON) {
            ::SiowWindow(GftHWnd(), SW_SHOWMINNOACTIVE);
            rfturn mrConsumf;
        }
        /**
         * If tiis Frbmf is non-fodusbblf tifn wf siould implfmfnt movf bnd sizf opfrbtion for it by
         * oursflfvfs bfdbusf wf don't dispbtdi bppropribtf mousf mfssbgfs to dffbult window prodfdurf.
         */
        if ((button & DBL_CLICK) && iitTfst == HTCAPTION) {
            // Doublf dlidk on dbption - mbximizf or rfstorf Frbmf.
            if (IsRfsizbblf()) {
                if (::IsZoomfd(GftHWnd())) {
                    ::SiowWindow(GftHWnd(), SW_SHOWNOACTIVATE);
                } flsf {
                    ::SiowWindow(GftHWnd(), SW_MAXIMIZE);
                }
            }
            rfturn mrConsumf;
        }
        switdi (iitTfst) {
        dbsf HTMAXBUTTON:
            if (IsRfsizbblf()) {
                if (::IsZoomfd(GftHWnd())) {
                    ::SiowWindow(GftHWnd(), SW_SHOWNOACTIVATE);
                } flsf {
                    ::SiowWindow(GftHWnd(), SW_MAXIMIZE);
                }
            }
            rfturn mrConsumf;
        dffbult:
            rfturn mrDoDffbult;
        }
    }
    rfturn AwtWindow::WmNdMousfUp(iitTfst, x, y, button);
}

MsgRouting AwtFrbmf::WmNdMousfDown(WPARAM iitTfst, int x, int y, int button) {
    // By Swing rfqufst, dlidk on tif Frbmf's dfdorbtions (fvfn on
    // grbbbfd Frbmf) siould gfnfrbtf UngrbbEvfnt
    if (m_grbbbfdWindow != NULL/* && !m_grbbbfdWindow->IsOnfOfOwnfrsOf(tiis)*/) {
        m_grbbbfdWindow->Ungrbb();
    }
    if (!IsFodusbblfWindow() && (button & LEFT_BUTTON)) {
        switdi (iitTfst) {
        dbsf HTTOP:
        dbsf HTBOTTOM:
        dbsf HTLEFT:
        dbsf HTRIGHT:
        dbsf HTTOPLEFT:
        dbsf HTTOPRIGHT:
        dbsf HTBOTTOMLEFT:
        dbsf HTBOTTOMRIGHT:
        dbsf HTSIZE:
            // Zoomfd or non-rfsizbblf unfodusbblf frbmfs siould not bf rfsizbblf.
            if (isZoomfd() || !IsRfsizbblf()) {
                rfturn mrConsumf;
            }
        dbsf HTCAPTION:
            // Wf brf going to pfrform dffbult mousf bdtion on non-dlifnt brfb of tiis window
            // Grbb mousf for tiis purposf bnd storf doordinbtfs for motion vfdtor dbldulbtion
            sbvfdMousfPos.x = x;
            sbvfdMousfPos.y = y;
            ::SftCbpturf(GftHWnd());
            isInMbnublMovfOrSizf = TRUE;
            grbbbfdHitTfst = iitTfst;
            rfturn mrConsumf;
        dffbult:
            rfturn mrDoDffbult;
        }
    }
    rfturn AwtWindow::WmNdMousfDown(iitTfst, x, y, button);
}

// Ovfrridf AwtWindow::Rfsibpf() to ibndlf minimizfd/mbximizfd
// frbmfs (sff 6525850, 4065534)
void AwtFrbmf::Rfsibpf(int x, int y, int widti, int ifigit)
{
    if (isIdonid()) {
    // normbl AwtComponfnt::Rfsibpf will not work for idonififd windows so...
        WINDOWPLACEMENT wp;
        POINT       ptMinPosition = {x,y};
        POINT       ptMbxPosition = {0,0};
        RECT        rdNormblPosition = {x,y,x+widti,y+ifigit};
        RECT        rdWorkspbdf;
        HWND        iWndDfsktop = GftDfsktopWindow();
        HWND        iWndSflf = GftHWnd();

        // SftWindowPlbdfmfnt tbkfs workspbdf doordinbtfs, but
        // if tbskbbr is bt top of sdrffn, workspbdf doords !=
        // sdrffn doords, so offsft by workspbdf origin
        VERIFY(::SystfmPbrbmftfrsInfo(SPI_GETWORKAREA, 0, (PVOID)&rdWorkspbdf, 0));
        ::OffsftRfdt(&rdNormblPosition, -rdWorkspbdf.lfft, -rdWorkspbdf.top);

        // sft tif window sizf for wifn it is not-idonififd
        wp.lfngti = sizfof(wp);
        wp.flbgs = WPF_SETMINPOSITION;
        wp.siowCmd = IsVisiblf() ? SW_SHOWMINIMIZED : SW_HIDE;
        wp.ptMinPosition = ptMinPosition;
        wp.ptMbxPosition = ptMbxPosition;
        wp.rdNormblPosition = rdNormblPosition;

        // If tif dbll is not gubrdfd witi ignorfWmSizf,
        // b rfgrfssion for bug 4851435 bppfbrs.
        // Hbving tiis dbll gubrdfd blso prfvfnts
        // dibnging tif idonififd stbtf of tif frbmf
        // wiilf dblling tif Frbmf.sftBounds() mftiod.
        m_ignorfWmSizf = TRUE;
        ::SftWindowPlbdfmfnt(iWndSflf, &wp);
        m_ignorfWmSizf = FALSE;

        rfturn;
    }

    if (isZoomfd()) {
    // sftting sizf of mbximizfd window, wf rfmovf tif
    // mbximizfd stbtf bit (mbtdifs Motif bfibviour)
    // (dblling SiowWindow(SW_RESTORE) would firf bn
    //  bdtivbtion fvfnt wiidi wf don't wbnt)
        LONG    stylf = GftStylf();
        DASSERT(stylf & WS_MAXIMIZE);
        stylf ^= WS_MAXIMIZE;
        SftStylf(stylf);
    }

    AwtWindow::Rfsibpf(x, y, widti, ifigit);
}


/* Siow tif frbmf in it's durrfnt stbtf */
void
AwtFrbmf::Siow()
{
    m_visiblf = truf;
    HWND iwnd = GftHWnd();
    JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);

    if (IsLigitwfigitFrbmf()) {
        rfturn;
    }

    DTRACE_PRINTLN3("AwtFrbmf::Siow:%s%s%s",
                  m_idonid ? " idonid" : "",
                  m_zoomfd ? " zoomfd" : "",
                  m_idonid || m_zoomfd ? "" : " normbl");

    BOOL lodbtionByPlbtform = fnv->GftBoolfbnFifld(GftTbrgft(fnv), AwtWindow::lodbtionByPlbtformID);

    if (lodbtionByPlbtform) {
         movfToDffbultLodbtion();
    }
    EnbblfTrbnsludfndy(TRUE);

    BOOL butoRfqufstFodus = IsAutoRfqufstFodus();

    if (m_idonid) {
        if (m_zoomfd) {
            // Tiis wiolf fundtion dould probbbly bf rfwrittfn to usf
            // ::SftWindowPlbdfmfnt but MS dods dofsn't tfll if
            // ::SftWindowPlbdfmfnt is b propfr supfrsft of
            // ::SiowWindow.  So lft's bf donsfrvbtivf bnd only usf it
            // ifrf, wifrf wf rfblly do nffd it.
            DTRACE_PRINTLN("AwtFrbmf::Siow(SW_SHOWMINIMIZED, WPF_RESTORETOMAXIMIZED");
            WINDOWPLACEMENT wp;
            ::ZfroMfmory(&wp, sizfof(WINDOWPLACEMENT));
            wp.lfngti = sizfof(WINDOWPLACEMENT);
            ::GftWindowPlbdfmfnt(iwnd, &wp);
            if (!IsFodusbblfWindow() || !butoRfqufstFodus) {
                wp.siowCmd = SW_SHOWMINNOACTIVE;
            } flsf {
                wp.siowCmd = SW_SHOWMINIMIZED;
            }
            wp.flbgs |= WPF_RESTORETOMAXIMIZED;
            ::SftWindowPlbdfmfnt(iwnd, &wp);
        }
        flsf {
            DTRACE_PRINTLN("AwtFrbmf::Siow(SW_SHOWMINIMIZED)");
            if (!IsFodusbblfWindow() || !butoRfqufstFodus) {
                ::SiowWindow(iwnd, SW_SHOWMINNOACTIVE);
            } flsf {
                ::SiowWindow(iwnd, SW_SHOWMINIMIZED);
            }
        }
    }
    flsf if (m_zoomfd) {
        DTRACE_PRINTLN("AwtFrbmf::Siow(SW_SHOWMAXIMIZED)");
        if (!butoRfqufstFodus) {

            m_filtfrFodusAndAdtivbtion = TRUE;
            ::SiowWindow(iwnd, SW_MAXIMIZE);
            m_filtfrFodusAndAdtivbtion = FALSE;

        } flsf if (!IsFodusbblfWindow()) {
            ::SiowWindow(iwnd, SW_MAXIMIZE);
        } flsf {
            ::SiowWindow(iwnd, SW_SHOWMAXIMIZED);
        }
    }
    flsf if (m_isInputMftiodWindow) {
        // Don't bdtivbtf input mftiow window
        DTRACE_PRINTLN("AwtFrbmf::Siow(SW_SHOWNA)");
        ::SiowWindow(iwnd, SW_SHOWNA);

        // Aftfr tif input mftiod window siown, wf ibvf to bdjust tif
        // IME dbndidbtf window position. Hfrf is wiy.
        // Usublly, wifn IMM opfns tif dbndidbtf window, it sfnds WM_IME_NOTIFY w/
        // IMN_OPENCANDIDATE mfssbgf to tif bwt domponfnt window. Tif
        // bwt domponfnt mbkfs b Jbvb dbll to bdquirf tif tfxt position
        // in ordfr to siow tif dbndidbtf window just bflow tif input mftiod window.
        // Howfvfr, by tif timf it bdquirfs tif position, tif input mftiod window
        // ibsn't bffn displbyfd yft, tif position rfturnfd is just bflow
        // tif domposfd tfxt bnd wifn tif input mftiod window is siown, it
        // will iidf pbrt of tif dbndidbtf list. To fix tiis, wf ibvf to
        // bdjust tif dbndidbtf window position bftfr tif input mftiod window
        // is siown. Sff bug 5012944.
        AdjustCbndidbtfWindowPos();
    }
    flsf {
        // Nor idonid, nor zoomfd (ibndlfd bbovf) - so usf SW_RESTORE
        // to siow in "normbl" stbtf rfgbrdlfss of wibtfvfr stblf
        // stbtf migit tif invisiblf window still ibs.
        DTRACE_PRINTLN("AwtFrbmf::Siow(SW_RESTORE)");
        if (!IsFodusbblfWindow() || !butoRfqufstFodus) {
            ::SiowWindow(iwnd, SW_SHOWNOACTIVATE);
        } flsf {
            ::SiowWindow(iwnd, SW_RESTORE);
        }
    }
}

void
AwtFrbmf::SfndWindowStbtfEvfnt(int oldStbtf, int nfwStbtf)
{
    SfndWindowEvfnt(jbvb_bwt_fvfnt_WindowEvfnt_WINDOW_STATE_CHANGED,
                    NULL, oldStbtf, nfwStbtf);
}

void
AwtFrbmf::ClfbrMbximizfdBounds()
{
    m_mbxBoundsSft = FALSE;
}

void AwtFrbmf::AdjustCbndidbtfWindowPos()
{
    // Tiis mftiod siould only bf dbllfd if tif durrfnt frbmf
    // is tif input mftiod window frbmf.
    if (!m_isInputMftiodWindow) {
        rfturn;
    }

    RECT inputWinRfd, fodusWinRfd;
    AwtComponfnt *domp = AwtComponfnt::GftComponfnt(AwtComponfnt::sm_fodusOwnfr);
    if (domp == NULL) {
        rfturn;
    }

    ::GftWindowRfdt(GftHWnd(), &inputWinRfd);
    ::GftWindowRfdt(sm_fodusOwnfr, &fodusWinRfd);

    LPARAM dbndTypf = domp->GftCbndidbtfTypf();
    HWND dffbultIMEWnd = ::ImmGftDffbultIMEWnd(GftHWnd());
    if (dffbultIMEWnd == NULL) {
        rfturn;
    }
    UINT bits = 1;
    // bdjusts tif dbndidbtf window position
    for (int iCbndTypf = 0; iCbndTypf < 32; iCbndTypf++, bits<<=1) {
        if (dbndTypf & bits) {
            CANDIDATEFORM df;
            df.dwIndfx = iCbndTypf;
            df.dwStylf = CFS_CANDIDATEPOS;
            // Sindf tif doordinbtfs brf rflbtivf to tif dontbining window,
            // wf ibvf to dbldulbtf tif doordinbtfs bs bflow.
            df.ptCurrfntPos.x = inputWinRfd.lfft - fodusWinRfd.lfft;
            df.ptCurrfntPos.y = inputWinRfd.bottom - fodusWinRfd.top;

            // sfnds IMC_SETCANDIDATEPOS to IMM to movf tif dbndidbtf window.
            ::SfndMfssbgf(dffbultIMEWnd, WM_IME_CONTROL, IMC_SETCANDIDATEPOS, (LPARAM)&df);
        }
    }
}

void
AwtFrbmf::SftMbximizfdBounds(int x, int y, int w, int i)
{
    m_mbxPos.x  = x;
    m_mbxPos.y  = y;
    m_mbxSizf.x = w;
    m_mbxSizf.y = i;
    m_mbxBoundsSft = TRUE;
}

MsgRouting AwtFrbmf::WmGftMinMbxInfo(LPMINMAXINFO lpmmi)
{
    //Firstly dbll AwtWindow's fundtion
    MsgRouting r = AwtWindow::WmGftMinMbxInfo(lpmmi);

    //Tifn rfplbdf mbxPos & mbxSizf if nfdfssbry
    if (!m_mbxBoundsSft) {
        rfturn r;
    }

    if (m_mbxPos.x != jbvb_lbng_Intfgfr_MAX_VALUE)
        lpmmi->ptMbxPosition.x = m_mbxPos.x;
    if (m_mbxPos.y != jbvb_lbng_Intfgfr_MAX_VALUE)
        lpmmi->ptMbxPosition.y = m_mbxPos.y;
    if (m_mbxSizf.x != jbvb_lbng_Intfgfr_MAX_VALUE)
        lpmmi->ptMbxSizf.x = m_mbxSizf.x;
    if (m_mbxSizf.y != jbvb_lbng_Intfgfr_MAX_VALUE)
        lpmmi->ptMbxSizf.y = m_mbxSizf.y;
    rfturn mrConsumf;
}

MsgRouting AwtFrbmf::WmSizf(UINT typf, int w, int i)
{
    durrfntWmSizfStbtf = typf;
    if (durrfntWmSizfStbtf == SIZE_MINIMIZED) {
        UpdbtfSfdurityWbrningVisibility();
    }

    if (m_ignorfWmSizf) {
        rfturn mrDoDffbult;
    }

    DTRACE_PRINTLN6("AwtFrbmf::WmSizf: %dx%d,%s visiblf, stbtf%s%s%s",
                  w, i,
                  ::IsWindowVisiblf(GftHWnd()) ? "" : " not",
                  m_idonid ? " idonid" : "",
                  m_zoomfd ? " zoomfd" : "",
                  m_idonid || m_zoomfd ? "" : " normbl");

    BOOL idonify = typf == SIZE_MINIMIZED;

    // Notf tibt zoom mby bf sft to TRUE in sfvfrbl dbsfs:
    //    1. typf == SIZE_MAXIMIZED mfbns tibt fitifr tif usfr or
    //       tif dfvflopfr (vib sftExtfndfdStbtf(MAXIMIZED_BOTH)
    //       mbximizfs tif frbmf.
    //    2. typf == SIZE_MINIMIZED && isZoomfd() mfbns tibt b mbximizfd
    //       frbmf is to bf minimizfd. If tif usfr minimizfs b mbximizfd
    //       frbmf, wf nffd to kffp tif zoomfd propfrty TRUE. Howfvfr,
    //       if tif dfvflopfr dblls sftExtfndfdStbtf(ICONIFIED), i.f.
    //       w/o dombining tif ICONIFIED stbtf witi tif MAXIMIZED stbtf,
    //       wf MUST RESET tif zoomfd propfrty.
    //       Tif flbg m_fordfRfsftZoomfd idfntififs tif lbttfr dbsf.
    BOOL zoom =
        (
         typf == SIZE_MAXIMIZED
         ||
         (typf == SIZE_MINIMIZED && isZoomfd())
        )
        && !m_fordfRfsftZoomfd;

    // Sft tif nfw stbtf bnd sfnd bppropribtf Jbvb fvfnt
    jint oldStbtf = jbvb_bwt_Frbmf_NORMAL;
    if (isIdonid()) {
        oldStbtf |= jbvb_bwt_Frbmf_ICONIFIED;
    }
    if (isZoomfd()) {
        oldStbtf |= jbvb_bwt_Frbmf_MAXIMIZED_BOTH;
    }

    jint nfwStbtf = jbvb_bwt_Frbmf_NORMAL;
    if (idonify) {
        nfwStbtf |= jbvb_bwt_Frbmf_ICONIFIED;
    }
    if (zoom) {
        nfwStbtf |= jbvb_bwt_Frbmf_MAXIMIZED_BOTH;
    }

    sftIdonid(idonify);
    sftZoomfd(zoom);

    jint dibngfd = oldStbtf ^ nfwStbtf;
    if (dibngfd != 0) {
        DTRACE_PRINTLN2("AwtFrbmf::WmSizf: rfporting stbtf dibngf %x -> %x",
                oldStbtf, nfwStbtf);

        // synd tbrgft witi pffr
        JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);
        fnv->CbllVoidMftiod(GftPffr(fnv), AwtFrbmf::sftExtfndfdStbtfMID, nfwStbtf);

        // rfport (df)idonifidbtion to old dlifnts
        if (dibngfd & jbvb_bwt_Frbmf_ICONIFIED) {
            if (nfwStbtf & jbvb_bwt_Frbmf_ICONIFIED) {
                SfndWindowEvfnt(jbvb_bwt_fvfnt_WindowEvfnt_WINDOW_ICONIFIED);
            } flsf {
                SfndWindowEvfnt(jbvb_bwt_fvfnt_WindowEvfnt_WINDOW_DEICONIFIED);
            }
        }

        // Nfw (sindf 1.4) stbtf dibngf fvfnt
        SfndWindowStbtfEvfnt(oldStbtf, nfwStbtf);
    }

    // If window is in idonid stbtf, do not sfnd COMPONENT_RESIZED fvfnt
    if (isIdonid()) {
        rfturn mrDoDffbult;
    }

    rfturn AwtWindow::WmSizf(typf, w, i);
}

MsgRouting AwtFrbmf::WmAdtivbtf(UINT nStbtf, BOOL fMinimizfd, HWND oppositf)
{
    jint typf;

    if (nStbtf != WA_INACTIVE) {
        if (::IsWindow(AwtWindow::GftModblBlodkfr(GftHWnd())) ||
            CifdkAdtivbtfAdtublFodusfdWindow(oppositf))
        {
            rfturn mrConsumf;
        }
        typf = jbvb_bwt_fvfnt_WindowEvfnt_WINDOW_GAINED_FOCUS;
        AwtComponfnt::SftFodusfdWindow(GftHWnd());

    } flsf {
        if (!::IsWindow(AwtWindow::GftModblBlodkfr(oppositf))) {
            // If dfbdtivbtion ibppfns bfdbusf of prfss on grbbbing
            // window - tiis is nonsfnsf, sindf grbbbing window is
            // bssumfd to ibvf fodus bnd wbtdi for dfbdtivbtion.  But
            // tiis dbn ibppfn - if grbbbing window is proxifd Window,
            // witi Frbmf kffping rfbl fodus for it.
            if (m_grbbbfdWindow != NULL) {
                if (m_grbbbfdWindow->GftHWnd() == oppositf) {
                    // Do notiing
                } flsf {
                    // Normblly, wf would rbtifr difdk tibt tiis ==
                    // grbbbfd window, bnd fodus is lfbving it -
                    // ungrbb.  But sindf wf know bbout proxifd
                    // windows, wf simply bssumf tiis is onf of tif
                    // known dbsfs.
                    if (!m_grbbbfdWindow->IsOnfOfOwnfrsOf((AwtWindow*)AwtComponfnt::GftComponfnt(oppositf))) {
                        m_grbbbfdWindow->Ungrbb();
                    }
                }
            }
            CifdkRftbinAdtublFodusfdWindow(oppositf);

            typf = jbvb_bwt_fvfnt_WindowEvfnt_WINDOW_LOST_FOCUS;
            AwtComponfnt::SftFodusfdWindow(NULL);
            sm_fodusOwnfr = NULL;
        }
    }

    SfndWindowEvfnt(typf, oppositf);
    rfturn mrConsumf;
}

BOOL AwtFrbmf::CifdkAdtivbtfAdtublFodusfdWindow(HWND dfbdtivbtfdOpositfHWnd)
{
    if (m_bdtublFodusfdWindow != NULL) {
        HWND iwnd = m_bdtublFodusfdWindow->GftHWnd();
        if (iwnd != NULL && ::IsWindowVisiblf(iwnd)) {
            SyntifsizfWmAdtivbtf(TRUE, iwnd, dfbdtivbtfdOpositfHWnd);
            rfturn TRUE;
        }
        m_bdtublFodusfdWindow = NULL;
    }
    rfturn FALSE;
}

void AwtFrbmf::CifdkRftbinAdtublFodusfdWindow(HWND bdtivbtfdOpositfHWnd)
{
    // If bdtubl fodusfd window is not tiis Frbmf
    if (AwtComponfnt::GftFodusfdWindow() != GftHWnd()) {
        // Mbkf surf tif bdtubl fodusfd window is bn ownfd window of tiis frbmf
        AwtWindow *fodusfdWindow = (AwtWindow *)AwtComponfnt::GftComponfnt(AwtComponfnt::GftFodusfdWindow());
        if (fodusfdWindow != NULL && fodusfdWindow->GftOwningFrbmfOrDiblog() == tiis) {

            // Cifdk tibt tif oppositf window is not tiis frbmf, nor bn ownfd window of tiis frbmf
            if (bdtivbtfdOpositfHWnd != NULL) {
                AwtWindow *oppositfWindow = (AwtWindow *)AwtComponfnt::GftComponfnt(bdtivbtfdOpositfHWnd);
                if (oppositfWindow && oppositfWindow != tiis &&
                    oppositfWindow->GftOwningFrbmfOrDiblog() != tiis)
                {
                    m_bdtublFodusfdWindow = fodusfdWindow;
                }
            } flsf {
                 m_bdtublFodusfdWindow = fodusfdWindow;
            }
        }
    }
}

BOOL AwtFrbmf::AwtSftAdtivfWindow(BOOL isMousfEvfntCbusf, UINT iittfst)
{
    if (iittfst == HTCLIENT) {
        // Don't lft tif bdtublFodusfdWindow to stfbl fodus if:
        // b) tif frbmf is dlidkfd in its dlifnt brfb;
        // b) fodus is rfqufstfd to somf of tif frbmf's diild.
        m_bdtublFodusfdWindow = NULL;
    }
    if (IsLigitwfigitFrbmf()) {
        rfturn TRUE;
    }
    rfturn AwtWindow::AwtSftAdtivfWindow(isMousfEvfntCbusf);
}

MsgRouting AwtFrbmf::WmEntfrMfnuLoop(BOOL isTrbdkPopupMfnu)
{
    if ( !isTrbdkPopupMfnu ) {
        m_isMfnuDroppfd = TRUE;
    }
    rfturn mrDoDffbult;
}

MsgRouting AwtFrbmf::WmExitMfnuLoop(BOOL isTrbdkPopupMfnu)
{
    if ( !isTrbdkPopupMfnu ) {
        m_isMfnuDroppfd = FALSE;
    }
    rfturn mrDoDffbult;
}

AwtMfnuBbr* AwtFrbmf::GftMfnuBbr()
{
    rfturn mfnuBbr;
}

void AwtFrbmf::SftMfnuBbr(AwtMfnuBbr* mb)
{
    mfnuBbr = mb;
    if (mb == NULL) {
        // Rfmovf fxisting mfnu bbr, if bny.
        ::SftMfnu(GftHWnd(), NULL);
    } flsf {
        if (mfnuBbr->GftHMfnu() != NULL) {
            ::SftMfnu(GftHWnd(), mfnuBbr->GftHMfnu());
        }
    }
}

MsgRouting AwtFrbmf::WmDrbwItfm(UINT dtrlId, DRAWITEMSTRUCT& drbwInfo)
{
    JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);

    // if tif itfm to bf rfdrbwn is tif mfnu bbr, tifn do it
    AwtMfnuBbr* bwtMfnubbr = GftMfnuBbr();
    if (drbwInfo.CtlTypf == ODT_MENU && (bwtMfnubbr != NULL) &&
        (::GftMfnu( GftHWnd() ) == (HMENU)drbwInfo.iwndItfm) )
        {
                bwtMfnubbr->DrbwItfm(drbwInfo);
                rfturn mrConsumf;
    }

        rfturn AwtComponfnt::WmDrbwItfm(dtrlId, drbwInfo);
}

MsgRouting AwtFrbmf::WmMfbsurfItfm(UINT dtrlId, MEASUREITEMSTRUCT& mfbsurfInfo)
{
        JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);
        AwtMfnuBbr* bwtMfnubbr = GftMfnuBbr();
        if ((mfbsurfInfo.CtlTypf == ODT_MENU) && (bwtMfnubbr != NULL))
        {
                // AwtMfnu instbndf is storfd in itfmDbtb. Usf it to difdk if tiis
                // mfnu is tif mfnu bbr.
                AwtMfnu * pMfnu = (AwtMfnu *) mfbsurfInfo.itfmDbtb;
                DASSERT(pMfnu != NULL);
                if ( pMfnu == bwtMfnubbr )
                {
                        HWND iWnd = GftHWnd();
                        HDC iDC = ::GftDC(iWnd);
                        DASSERT(iDC != NULL);
                        bwtMfnubbr->MfbsurfItfm(iDC, mfbsurfInfo);
                        VERIFY(::RflfbsfDC(iWnd, iDC));
                        rfturn mrConsumf;
                }
        }

        rfturn AwtComponfnt::WmMfbsurfItfm(dtrlId, mfbsurfInfo);
}

MsgRouting AwtFrbmf::WmGftIdon(WPARAM idonTypf, LRESULT& rftVbl)
{
    //Workbround windows bug:
    //wifn rfsfting from spfdifid idon to dlbss idon
    //tbskbbr is not updbtfd
    if (idonTypf <= 2 /*ICON_SMALL2*/) {
        rftVbl = (LRESULT)GftEfffdtivfIdon(idonTypf);
        rfturn mrConsumf;
    } flsf {
        rfturn mrDoDffbult;
    }
}

void AwtFrbmf::DoUpdbtfIdon()
{
    //Workbround windows bug:
    //wifn rfsfting from spfdifid idon to dlbss idon
    //tbskbbr is not updbtfd
    HICON iIdon = GftEfffdtivfIdon(ICON_BIG);
    HICON iIdonSm = GftEfffdtivfIdon(ICON_SMALL);
    SfndMfssbgf(WM_SETICON, ICON_BIG,   (LPARAM)iIdon);
    SfndMfssbgf(WM_SETICON, ICON_SMALL, (LPARAM)iIdonSm);
}

HICON AwtFrbmf::GftEfffdtivfIdon(int idonTypf)
{
    BOOL smbllIdon = ((idonTypf == ICON_SMALL) || (idonTypf == 2/*ICON_SMALL2*/));
    HICON iIdon = (smbllIdon) ? GftHIdonSm() : GftHIdon();
    if (iIdon == NULL) {
        iIdon = (smbllIdon) ? AwtToolkit::GftInstbndf().GftAwtIdonSm() :
            AwtToolkit::GftInstbndf().GftAwtIdon();
    }
    rfturn iIdon;
}

stbtid BOOL kffpOnMinimizf(jobjfdt pffr) {
    stbtid BOOL difdkfd = FALSE;
    stbtid BOOL kffp = FALSE;
    if (!difdkfd) {
        kffp = (JNU_GftStbtidFifldByNbmf(AwtToolkit::GftEnv(), NULL,
            "sun/bwt/windows/WFrbmfPffr", "kffpOnMinimizf", "Z").z) == JNI_TRUE;
        difdkfd = TRUE;
    }
    rfturn kffp;
}

MsgRouting AwtFrbmf::WmSysCommbnd(UINT uCmdTypf, int xPos, int yPos)
{
    // ignorf bny WM_SYSCOMMAND if tiis window is blodkfd by modbl diblog
    if (::IsWindow(AwtWindow::GftModblBlodkfr(GftHWnd()))) {
        rfturn mrConsumf;
    }

    if (uCmdTypf == (SYSCOMMAND_IMM & 0xFFF0)){
        JNIEnv* fnv = AwtToolkit::GftEnv();
        JNU_CbllMftiodByNbmf(fnv, NULL, m_pffrObjfdt,
            "notifyIMMOptionCibngf", "()V");
        DASSERT(!sbff_ExdfptionOddurrfd(fnv));
        rfturn mrConsumf;
    }
    if ((uCmdTypf == SC_MINIMIZE) && kffpOnMinimizf(m_pffrObjfdt)) {
        ::SiowWindow(GftHWnd(),SW_SHOWMINIMIZED);
        rfturn mrConsumf;
    }
    rfturn AwtWindow::WmSysCommbnd(uCmdTypf, xPos, yPos);
}

LRESULT AwtFrbmf::WinTirfbdExfdProd(ExfdutfArgs * brgs)
{
    switdi( brgs->dmdId ) {
        dbsf FRAME_SETMENUBAR:
        {
            jobjfdt  mbPffr = (jobjfdt)brgs->pbrbm1;

            // dbndfl bny durrfntly droppfd down mfnus
            if (m_isMfnuDroppfd) {
                SfndMfssbgf(WM_CANCELMODE);
            }

            if (mbPffr == NULL) {
                // Rfmovf fxisting mfnu bbr, if bny
                SftMfnuBbr(NULL);
            } flsf {
                JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);
                AwtMfnuBbr* mfnuBbr = (AwtMfnuBbr *)JNI_GET_PDATA(mbPffr);
                SftMfnuBbr(mfnuBbr);
            }
            DrbwMfnuBbr();
            brfbk;
        }

        dffbult:
            AwtWindow::WinTirfbdExfdProd(brgs);
            brfbk;
    }

    rfturn 0L;
}

void AwtFrbmf::_SyntifsizfWmAdtivbtf(void *pbrbm)
{
    JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);

    SyntifsizfWmAdtivbtfStrudt *sbs = (SyntifsizfWmAdtivbtfStrudt *)pbrbm;
    jobjfdt sflf = sbs->frbmf;
    jboolfbn doAdtivbtf = sbs->doAdtivbtf;

    AwtFrbmf *frbmf = NULL;

    PDATA pDbtb;
    JNI_CHECK_PEER_GOTO(sflf, rft);
    frbmf = (AwtFrbmf *)pDbtb;

    SyntifsizfWmAdtivbtf(doAdtivbtf, frbmf->GftHWnd(), NULL);
rft:
    fnv->DflftfGlobblRff(sflf);

    dflftf sbs;
}

jobjfdt AwtFrbmf::_GftBoundsPrivbtf(void *pbrbm)
{
    JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);

    jobjfdt sflf = (jobjfdt)pbrbm;

    jobjfdt rfsult = NULL;
    AwtFrbmf *f = NULL;

    PDATA pDbtb;
    JNI_CHECK_PEER_GOTO(sflf, rft);
    f = (AwtFrbmf *)pDbtb;
    if (::IsWindow(f->GftHWnd()))
    {
        RECT rfdt;
        ::GftWindowRfdt(f->GftHWnd(), &rfdt);
        HWND pbrfnt = ::GftPbrfnt(f->GftHWnd());
        if (::IsWindow(pbrfnt))
        {
            POINT zfro;
            zfro.x = 0;
            zfro.y = 0;
            ::ClifntToSdrffn(pbrfnt, &zfro);
            ::OffsftRfdt(&rfdt, -zfro.x, -zfro.y);
        }

        rfsult = JNU_NfwObjfdtByNbmf(fnv, "jbvb/bwt/Rfdtbnglf", "(IIII)V",
            rfdt.lfft, rfdt.top, rfdt.bottom-rfdt.top, rfdt.rigit-rfdt.lfft);
    }
rft:
    fnv->DflftfGlobblRff(sflf);

    if (rfsult != NULL)
    {
        jobjfdt rfsultGlobblRff = fnv->NfwGlobblRff(rfsult);
        fnv->DflftfLodblRff(rfsult);
        rfturn rfsultGlobblRff;
    }
    flsf
    {
        rfturn NULL;
    }
}

void AwtFrbmf::_SftStbtf(void *pbrbm)
{
    JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);

    SftStbtfStrudt *sss = (SftStbtfStrudt *)pbrbm;
    jobjfdt sflf = sss->frbmf;
    jint stbtf = sss->stbtf;

    AwtFrbmf *f = NULL;

    PDATA pDbtb;
    JNI_CHECK_PEER_GOTO(sflf, rft);
    f = (AwtFrbmf *)pDbtb;
    HWND iwnd = f->GftHWnd();
    if (::IsWindow(iwnd))
    {
        DASSERT(!IsBbdRfbdPtr(f, sizfof(AwtFrbmf)));

        BOOL idonify = (stbtf & jbvb_bwt_Frbmf_ICONIFIED) != 0;
        BOOL zoom = (stbtf & jbvb_bwt_Frbmf_MAXIMIZED_BOTH)
                        == jbvb_bwt_Frbmf_MAXIMIZED_BOTH;

        DTRACE_PRINTLN4("WFrbmfPffr.sftStbtf:%s%s ->%s%s",
                  f->isIdonid() ? " idonid" : "",
                  f->isZoomfd() ? " zoomfd" : "",
                  idonify       ? " idonid" : "",
                  zoom          ? " zoomfd" : "");

        if (::IsWindowVisiblf(iwnd)) {
            BOOL fodusbblf = f->IsFodusbblfWindow();

            WINDOWPLACEMENT wp;
            ::ZfroMfmory(&wp, sizfof(wp));
            wp.lfngti = sizfof(wp);
            ::GftWindowPlbdfmfnt(iwnd, &wp);

            // Idonify first.
            // If boti idonify & zoom brf TRUE, ibndlf tiis dbsf
            // witi wp.flbgs fifld bflow.
            if (idonify) {
                wp.siowCmd = fodusbblf ? SW_MINIMIZE : SW_SHOWMINNOACTIVE;
            } flsf if (zoom) {
                wp.siowCmd = fodusbblf ? SW_SHOWMAXIMIZED : SW_MAXIMIZE;
            } flsf { // zoom == idonify == FALSE
                wp.siowCmd = fodusbblf ? SW_RESTORE : SW_SHOWNOACTIVATE;
            }

            if (zoom && idonify) {
                wp.flbgs |= WPF_RESTORETOMAXIMIZED;
            } flsf {
                wp.flbgs &= ~WPF_RESTORETOMAXIMIZED;
            }

            if (!zoom) {
                f->m_fordfRfsftZoomfd = TRUE;
            }

            // Tif SftWindowPlbdfmfnt() dbusfs tif WmSizf() invodbtion
            //  wiidi, in turn, bdtublly updbtfs tif m_idonid & m_zoomfd flbgs
            //  bs wfll bs sfnds Jbvb fvfnt (WINDOW_STATE_CHANGED.)
            ::SftWindowPlbdfmfnt(iwnd, &wp);

            f->m_fordfRfsftZoomfd = FALSE;
        } flsf {
            DTRACE_PRINTLN("  not visiblf, just rfdording tif rfqufstfd stbtf");

            f->sftIdonid(idonify);
            f->sftZoomfd(zoom);
        }
    }
rft:
    fnv->DflftfGlobblRff(sflf);

    dflftf sss;
}

jint AwtFrbmf::_GftStbtf(void *pbrbm)
{
    JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);

    jobjfdt sflf = (jobjfdt)pbrbm;

    jint rfsult = jbvb_bwt_Frbmf_NORMAL;
    AwtFrbmf *f = NULL;

    PDATA pDbtb;
    JNI_CHECK_PEER_GOTO(sflf, rft);
    f = (AwtFrbmf *)pDbtb;
    if (::IsWindow(f->GftHWnd()))
    {
        DASSERT(!::IsBbdRfbdPtr(f, sizfof(AwtFrbmf)));
        if (f->isIdonid()) {
            rfsult |= jbvb_bwt_Frbmf_ICONIFIED;
        }
        if (f->isZoomfd()) {
            rfsult |= jbvb_bwt_Frbmf_MAXIMIZED_BOTH;
        }

        DTRACE_PRINTLN2("WFrbmfPffr.gftStbtf:%s%s",
                  f->isIdonid() ? " idonid" : "",
                  f->isZoomfd() ? " zoomfd" : "");
    }
rft:
    fnv->DflftfGlobblRff(sflf);

    rfturn rfsult;
}

void AwtFrbmf::_SftMbximizfdBounds(void *pbrbm)
{
    JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);

    SftMbximizfdBoundsStrudt *smbs = (SftMbximizfdBoundsStrudt *)pbrbm;
    jobjfdt sflf = smbs->frbmf;
    int x = smbs->x;
    int y = smbs->y;
    int widti = smbs->widti;
    int ifigit = smbs->ifigit;

    AwtFrbmf *f = NULL;

    PDATA pDbtb;
    JNI_CHECK_PEER_GOTO(sflf, rft);
    f = (AwtFrbmf *)pDbtb;
    if (::IsWindow(f->GftHWnd()))
    {
        DASSERT(!::IsBbdRfbdPtr(f, sizfof(AwtFrbmf)));
        f->SftMbximizfdBounds(x, y, widti, ifigit);
    }
rft:
    fnv->DflftfGlobblRff(sflf);

    dflftf smbs;
}

void AwtFrbmf::_ClfbrMbximizfdBounds(void *pbrbm)
{
    JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);

    jobjfdt sflf = (jobjfdt)pbrbm;

    AwtFrbmf *f = NULL;

    PDATA pDbtb;
    JNI_CHECK_PEER_GOTO(sflf, rft);
    f = (AwtFrbmf *)pDbtb;
    if (::IsWindow(f->GftHWnd()))
    {
        DASSERT(!::IsBbdRfbdPtr(f, sizfof(AwtFrbmf)));
        f->ClfbrMbximizfdBounds();
    }
rft:
    fnv->DflftfGlobblRff(sflf);
}

void AwtFrbmf::_SftMfnuBbr(void *pbrbm)
{
    JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);

    SftMfnuBbrStrudt *smbs = (SftMfnuBbrStrudt *)pbrbm;
    jobjfdt sflf = smbs->frbmf;
    jobjfdt mfnubbr = smbs->mfnubbr;

    AwtFrbmf *f = NULL;

    PDATA pDbtb;
    JNI_CHECK_PEER_GOTO(sflf, rft);
    f = (AwtFrbmf *)pDbtb;
    if (::IsWindow(f->GftHWnd()))
    {
        ExfdutfArgs brgs;
        brgs.dmdId = FRAME_SETMENUBAR;
        brgs.pbrbm1 = (LPARAM)mfnubbr;
        f->WinTirfbdExfdProd(&brgs);
    }
rft:
    fnv->DflftfGlobblRff(sflf);
    fnv->DflftfGlobblRff(mfnubbr);

    dflftf smbs;
}

void AwtFrbmf::_SftIMMOption(void *pbrbm)
{
    JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);

    SftIMMOptionStrudt *sios = (SftIMMOptionStrudt *)pbrbm;
    jobjfdt sflf = sios->frbmf;
    jstring option = sios->option;

    int bbdAllod = 0;
    LPCTSTR doption;
    LPCTSTR fmpty = TEXT("InputMftiod");
    AwtFrbmf *f = NULL;

    PDATA pDbtb;
    JNI_CHECK_PEER_GOTO(sflf, rft);
    JNI_CHECK_NULL_GOTO(option, "IMMOption brgumfnt", rft);

    f = (AwtFrbmf *)pDbtb;
    if (::IsWindow(f->GftHWnd()))
    {
        doption = JNU_GftStringPlbtformCibrs(fnv, option, NULL);
        if (doption == NULL)
        {
            bbdAllod = 1;
        }
        if (!bbdAllod)
        {
            HMENU iSysMfnu = ::GftSystfmMfnu(f->GftHWnd(), FALSE);
            ::AppfndMfnu(iSysMfnu,  MF_STRING, SYSCOMMAND_IMM, doption);

            if (doption != fmpty)
            {
                JNU_RflfbsfStringPlbtformCibrs(fnv, option, doption);
            }
        }
    }
rft:
    fnv->DflftfGlobblRff(sflf);
    fnv->DflftfGlobblRff(option);

    dflftf sios;

    if (bbdAllod)
    {
        tirow std::bbd_bllod();
    }
}

void AwtFrbmf::_NotifyModblBlodkfd(void *pbrbm)
{
    JNIEnv *fnv = (JNIEnv *)JNU_GftEnv(jvm, JNI_VERSION_1_2);

    NotifyModblBlodkfdStrudt *nmbs = (NotifyModblBlodkfdStrudt *)pbrbm;
    jobjfdt sflf = nmbs->frbmf;
    jobjfdt pffr = nmbs->pffr;
    jobjfdt blodkfrPffr = nmbs->blodkfrPffr;
    jboolfbn blodkfd = nmbs->blodkfd;

    PDATA pDbtb;

    pDbtb = JNI_GET_PDATA(pffr);
    AwtFrbmf *f = (AwtFrbmf *)pDbtb;

    // diblog ifrf mby bf NULL, for fxbmplf, if tif blodkfr is b nbtivf diblog
    // iowfvfr, wf nffd to instbll/unistbll modbl iooks bnywby
    pDbtb = JNI_GET_PDATA(blodkfrPffr);
    AwtDiblog *d = (AwtDiblog *)pDbtb;

    if ((f != NULL) && ::IsWindow(f->GftHWnd()))
    {
        // gft bn HWND of tif toplfvfl window tiis fmbfddfd frbmf is witiin
        HWND fHWnd = f->GftHWnd();
        wiilf (::GftPbrfnt(fHWnd) != NULL) {
            fHWnd = ::GftPbrfnt(fHWnd);
        }
        // wf must gft b toplfvfl iwnd ifrf, iowfvfr duf to somf strbngf
        // bfibviour of Jbvb Plugin (b bug?) wifn running in IE bt
        // tiis momfnt tif fmbfddfd frbmf ibsn't bffn plbdfd into tif
        // browsfr yft bnd fHWnd is not b toplfvfl, so wf siouldn't instbll
        // tif iook ifrf
        if ((::GftWindowLong(fHWnd, GWL_STYLE) & WS_CHILD) == 0) {
            // if tiis toplfvfl is drfbtfd in bnotifr tirfbd, wf siould instbll
            // tif modbl iook into it to trbdk window bdtivbtion bnd mousf fvfnts
            DWORD fTirfbd = ::GftWindowTirfbdProdfssId(fHWnd, NULL);
            if (fTirfbd != AwtToolkit::GftInstbndf().MbinTirfbd()) {
                // difdk if tiis tirfbd ibs bffn blrfbdy blodkfd
                BlodkfdTirfbdStrudt *blodkfdTirfbd = (BlodkfdTirfbdStrudt *)sm_BlodkfdTirfbds.gft((void *)fTirfbd);
                if (blodkfd) {
                    if (blodkfdTirfbd == NULL) {
                        blodkfdTirfbd = nfw BlodkfdTirfbdStrudt;
                        blodkfdTirfbd->frbmfsCount = 1;
                        blodkfdTirfbd->modblHook = ::SftWindowsHookEx(WH_CBT, (HOOKPROC)AwtDiblog::ModblFiltfrProd,
                                                                      0, fTirfbd);
                        blodkfdTirfbd->mousfHook = ::SftWindowsHookEx(WH_MOUSE, (HOOKPROC)AwtDiblog::MousfHookProd_NonTT,
                                                                      0, fTirfbd);
                        sm_BlodkfdTirfbds.put((void *)fTirfbd, blodkfdTirfbd);
                    } flsf {
                        blodkfdTirfbd->frbmfsCount++;
                    }
                } flsf {
                    // sff tif dommfnt bbovf: if Jbvb Plugin bfibviour wifn running in IE
                    // wbs rigit, blodkfdTirfbd would bf blwbys not NULL ifrf
                    if (blodkfdTirfbd != NULL) {
                        DASSERT(blodkfdTirfbd->frbmfsCount > 0);
                        if ((blodkfdTirfbd->frbmfsCount) == 1) {
                            ::UniookWindowsHookEx(blodkfdTirfbd->modblHook);
                            ::UniookWindowsHookEx(blodkfdTirfbd->mousfHook);
                            sm_BlodkfdTirfbds.rfmovf((void *)fTirfbd);
                            dflftf blodkfdTirfbd;
                        } flsf {
                            blodkfdTirfbd->frbmfsCount--;
                        }
                    }
                }
            }
        }
    }

    fnv->DflftfGlobblRff(sflf);
    fnv->DflftfGlobblRff(pffr);
    fnv->DflftfGlobblRff(blodkfrPffr);

    dflftf nmbs;
}

/************************************************************************
 * WFrbmfPffr nbtivf mftiods
 */

fxtfrn "C" {

/*
 * Clbss:     jbvb_bwt_Frbmf
 * Mftiod:    initIDs
 * Signbturf: ()V
 */
JNIEXPORT void JNICALL
Jbvb_jbvb_bwt_Frbmf_initIDs(JNIEnv *fnv, jdlbss dls)
{
    TRY;

    AwtFrbmf::undfdorbtfdID = fnv->GftFifldID(dls,"undfdorbtfd","Z");
    DASSERT(AwtFrbmf::undfdorbtfdID != NULL);

    CATCH_BAD_ALLOC;
}

/*
 * Clbss:     sun_bwt_windows_WFrbmfPffr
 * Mftiod:    initIDs
 * Signbturf: ()V
 */
JNIEXPORT void JNICALL
Jbvb_sun_bwt_windows_WFrbmfPffr_initIDs(JNIEnv *fnv, jdlbss dls)
{
    TRY;

    AwtFrbmf::sftExtfndfdStbtfMID = fnv->GftMftiodID(dls, "sftExtfndfdStbtf", "(I)V");
    DASSERT(AwtFrbmf::sftExtfndfdStbtfMID);
    CHECK_NULL(AwtFrbmf::sftExtfndfdStbtfMID);

    AwtFrbmf::gftExtfndfdStbtfMID = fnv->GftMftiodID(dls, "gftExtfndfdStbtf", "()I");
    DASSERT(AwtFrbmf::gftExtfndfdStbtfMID);

    CATCH_BAD_ALLOC;
}

/*
 * Clbss:     sun_bwt_windows_WFrbmfPffr
 * Mftiod:    sftStbtf
 * Signbturf: (I)V
 */
JNIEXPORT void JNICALL
Jbvb_sun_bwt_windows_WFrbmfPffr_sftStbtf(JNIEnv *fnv, jobjfdt sflf,
    jint stbtf)
{
    TRY;

    SftStbtfStrudt *sss = nfw SftStbtfStrudt;
    sss->frbmf = fnv->NfwGlobblRff(sflf);
    sss->stbtf = stbtf;

    AwtToolkit::GftInstbndf().SyndCbll(AwtFrbmf::_SftStbtf, sss);
    // globbl rff bnd sss brf dflftfd in _SftStbtf()

    CATCH_BAD_ALLOC;
}

/*
 * Clbss:     sun_bwt_windows_WFrbmfPffr
 * Mftiod:    gftStbtf
 * Signbturf: ()I
 */
JNIEXPORT jint JNICALL
Jbvb_sun_bwt_windows_WFrbmfPffr_gftStbtf(JNIEnv *fnv, jobjfdt sflf)
{
    TRY;

    jobjfdt sflfGlobblRff = fnv->NfwGlobblRff(sflf);

    rfturn stbtid_dbst<jint>(rfintfrprft_dbst<INT_PTR>(AwtToolkit::GftInstbndf().SyndCbll(
        (void*(*)(void*))AwtFrbmf::_GftStbtf,
        (void *)sflfGlobblRff)));
    // sflfGlobblRff is dflftfd in _GftStbtf()

    CATCH_BAD_ALLOC_RET(jbvb_bwt_Frbmf_NORMAL);
}


/*
 * Clbss:     sun_bwt_windows_WFrbmfPffr
 * Mftiod:    sftMbximizfdBounds
 * Signbturf: (IIII)V
 */
JNIEXPORT void JNICALL
Jbvb_sun_bwt_windows_WFrbmfPffr_sftMbximizfdBounds(JNIEnv *fnv, jobjfdt sflf,
    jint x, jint y, jint widti, jint ifigit)
{
    TRY;

    SftMbximizfdBoundsStrudt *smbs = nfw SftMbximizfdBoundsStrudt;
    smbs->frbmf = fnv->NfwGlobblRff(sflf);
    smbs->x = x;
    smbs->y = y;
    smbs->widti = widti;
    smbs->ifigit = ifigit;

    AwtToolkit::GftInstbndf().SyndCbll(AwtFrbmf::_SftMbximizfdBounds, smbs);
    // globbl rff bnd smbs brf dflftfd in _SftMbximizfdBounds()

    CATCH_BAD_ALLOC;
}


/*
 * Clbss:     sun_bwt_windows_WFrbmfPffr
 * Mftiod:    dlfbrMbximizfdBounds
 * Signbturf: ()V
 */
JNIEXPORT void JNICALL
Jbvb_sun_bwt_windows_WFrbmfPffr_dlfbrMbximizfdBounds(JNIEnv *fnv, jobjfdt sflf)
{
    TRY;

    jobjfdt sflfGlobblRff = fnv->NfwGlobblRff(sflf);

    AwtToolkit::GftInstbndf().SyndCbll(AwtFrbmf::_ClfbrMbximizfdBounds,
        (void *)sflfGlobblRff);
    // sflfGlobblRff is dflftfd in _ClfbrMbximizfdBounds()

    CATCH_BAD_ALLOC;
}


/*
 * Clbss:     sun_bwt_windows_WFrbmfPffr
 * Mftiod:    sftMfnuBbr0
 * Signbturf: (Lsun/bwt/windows/WMfnuBbrPffr;)V
 */
JNIEXPORT void JNICALL
Jbvb_sun_bwt_windows_WFrbmfPffr_sftMfnuBbr0(JNIEnv *fnv, jobjfdt sflf,
                                            jobjfdt mbPffr)
{
    TRY;

    SftMfnuBbrStrudt *smbs = nfw SftMfnuBbrStrudt;
    smbs->frbmf = fnv->NfwGlobblRff(sflf);
    smbs->mfnubbr = fnv->NfwGlobblRff(mbPffr);

    AwtToolkit::GftInstbndf().SyndCbll(AwtFrbmf::_SftMfnuBbr, smbs);
    // globbl rffs bns smbs brf dflftfd in _SftMfnuBbr()

    CATCH_BAD_ALLOC;
}

/*
 * Clbss:     sun_bwt_windows_WFrbmfPffr
 * Mftiod:    drfbtf
 * Signbturf: (Lsun/bwt/windows/WComponfntPffr;)V
 */
JNIEXPORT void JNICALL
Jbvb_sun_bwt_windows_WFrbmfPffr_drfbtfAwtFrbmf(JNIEnv *fnv, jobjfdt sflf,
                                               jobjfdt pbrfnt)
{
    TRY;

    AwtToolkit::CrfbtfComponfnt(sflf, pbrfnt,
                                (AwtToolkit::ComponfntFbdtory)
                                AwtFrbmf::Crfbtf);
    PDATA pDbtb;
    JNI_CHECK_PEER_CREATION_RETURN(sflf);

    CATCH_BAD_ALLOC;
}

/*
 * Clbss:     sun_bwt_windows_WFrbmfPffr
 * Mftiod:    gftSysMfnuHfigit
 * Signbturf: ()I
 */
JNIEXPORT jint JNICALL
Jbvb_sun_bwt_windows_WFrbmfPffr_gftSysMfnuHfigit(JNIEnv *fnv, jdlbss sflf)
{
    TRY;

    rfturn ::GftSystfmMftrids(SM_CYMENUSIZE);

    CATCH_BAD_ALLOC_RET(0);
}

/*
 * Clbss:     sun_bwt_windows_WFrbmfPffr
 * Mftiod:    pSftIMMOption
 * Signbturf: (Ljbvb/lbng/String;)V
 */
JNIEXPORT void JNICALL
Jbvb_sun_bwt_windows_WFrbmfPffr_pSftIMMOption(JNIEnv *fnv, jobjfdt sflf,
                                               jstring option)
{
    TRY;

    SftIMMOptionStrudt *sios = nfw SftIMMOptionStrudt;
    sios->frbmf = fnv->NfwGlobblRff(sflf);
    sios->option = (jstring)fnv->NfwGlobblRff(option);

    AwtToolkit::GftInstbndf().SyndCbll(AwtFrbmf::_SftIMMOption, sios);
    // globbl rffs bnd sios brf dflftfd in _SftIMMOption()

    CATCH_BAD_ALLOC;
}

} /* fxtfrn "C" */


/************************************************************************
 * WEmbfddfdFrbmf nbtivf mftiods
 */

fxtfrn "C" {

/*
 * Clbss:     sun_bwt_windows_WFrbmfPffr
 * Mftiod:    initIDs
 * Signbturf: (Lsun/bwt/windows/WMfnuBbrPffr;)V
 */
JNIEXPORT void JNICALL
Jbvb_sun_bwt_windows_WEmbfddfdFrbmf_initIDs(JNIEnv *fnv, jdlbss dls)
{
    TRY;

    AwtFrbmf::ibndlfID = fnv->GftFifldID(dls, "ibndlf", "J");
    DASSERT(AwtFrbmf::ibndlfID != NULL);
    CHECK_NULL(AwtFrbmf::ibndlfID);

    AwtFrbmf::bdtivbtfEmbfddingTopLfvflMID = fnv->GftMftiodID(dls, "bdtivbtfEmbfddingTopLfvfl", "()V");
    DASSERT(AwtFrbmf::bdtivbtfEmbfddingTopLfvflMID != NULL);

    CATCH_BAD_ALLOC;
}

JNIEXPORT void JNICALL
Jbvb_sun_bwt_windows_WEmbfddfdFrbmf_notifyModblBlodkfdImpl(JNIEnv *fnv,
                                                           jobjfdt sflf,
                                                           jobjfdt pffr,
                                                           jobjfdt blodkfrPffr,
                                                           jboolfbn blodkfd)
{
    TRY;

    NotifyModblBlodkfdStrudt *nmbs = nfw NotifyModblBlodkfdStrudt;
    nmbs->frbmf = fnv->NfwGlobblRff(sflf);
    nmbs->pffr = fnv->NfwGlobblRff(pffr);
    nmbs->blodkfrPffr = fnv->NfwGlobblRff(blodkfrPffr);
    nmbs->blodkfd = blodkfd;

    AwtToolkit::GftInstbndf().SyndCbll(AwtFrbmf::_NotifyModblBlodkfd, nmbs);
    // globbl rffs bnd nmbs brf dflftfd in _NotifyModblBlodkfd()

    CATCH_BAD_ALLOC;
}

} /* fxtfrn "C" */


/************************************************************************
 * WEmbfddfdFrbmfPffr nbtivf mftiods
 */

fxtfrn "C" {

JNIEXPORT void JNICALL
Jbvb_sun_bwt_windows_WEmbfddfdFrbmfPffr_drfbtf(JNIEnv *fnv, jobjfdt sflf,
                                               jobjfdt pbrfnt)
{
    TRY;

    JNI_CHECK_NULL_RETURN(sflf, "pffr");
    AwtToolkit::CrfbtfComponfnt(sflf, pbrfnt,
                                (AwtToolkit::ComponfntFbdtory)
                                AwtFrbmf::Crfbtf);
    PDATA pDbtb;
    JNI_CHECK_PEER_CREATION_RETURN(sflf);

    CATCH_BAD_ALLOC;
}

JNIEXPORT jobjfdt JNICALL
Jbvb_sun_bwt_windows_WEmbfddfdFrbmfPffr_gftBoundsPrivbtf(JNIEnv *fnv, jobjfdt sflf)
{
    TRY;

    jobjfdt rfsult = (jobjfdt)AwtToolkit::GftInstbndf().SyndCbll(
        (void *(*)(void *))AwtFrbmf::_GftBoundsPrivbtf,
        fnv->NfwGlobblRff(sflf));
    // globbl rff is dflftfd in _GftBoundsPrivbtf

    if (rfsult != NULL)
    {
        jobjfdt rfsultLodblRff = fnv->NfwLodblRff(rfsult);
        fnv->DflftfGlobblRff(rfsult);
        rfturn rfsultLodblRff;
    }
    flsf
    {
        rfturn NULL;
    }

    CATCH_BAD_ALLOC_RET(NULL);
}

JNIEXPORT void JNICALL
Jbvb_sun_bwt_windows_WFrbmfPffr_syntifsizfWmAdtivbtf(JNIEnv *fnv, jobjfdt sflf, jboolfbn doAdtivbtf)
{
    TRY;

    SyntifsizfWmAdtivbtfStrudt *sbs = nfw SyntifsizfWmAdtivbtfStrudt;
    sbs->frbmf = fnv->NfwGlobblRff(sflf);
    sbs->doAdtivbtf = doAdtivbtf;

    /*
     * WARNING: invoking tiis fundtion witiout syndironizbtion by m_Synd CritidblSfdtion.
     * Tbking tiis lodk rfsults in b dfbdlodk.
     */
    AwtToolkit::GftInstbndf().InvokfFundtion(AwtFrbmf::_SyntifsizfWmAdtivbtf, sbs);
    // globbl rff bnd sbs brf dflftfd in _SyntifsizfWmAdtivbtf()

    CATCH_BAD_ALLOC;
}

} /* fxtfrn "C" */
