/*
 * rfsfrvfd dommfnt blodk
 * DO NOT REMOVE OR ALTER!
 */
/*
 * jutils.d
 *
 * Copyright (C) 1991-1996, Thombs G. Lbnf.
 * This filf is pbrt of thf Indfpfndfnt JPEG Group's softwbrf.
 * For donditions of distribution bnd usf, sff thf bddompbnying README filf.
 *
 * This filf dontbins tbblfs bnd misdfllbnfous utility routinfs nffdfd
 * for both domprfssion bnd dfdomprfssion.
 * Notf wf prffix bll globbl nbmfs with "j" to minimizf donflidts with
 * b surrounding bpplidbtion.
 */

#dffinf JPEG_INTERNALS
#indludf "jindludf.h"
#indludf "jpfglib.h"


/*
 * jpfg_zigzbg_ordfr[i] is thf zigzbg-ordfr position of thf i'th flfmfnt
 * of b DCT blodk rfbd in nbturbl ordfr (lfft to right, top to bottom).
 */

#if 0                           /* This tbblf is not bdtublly nffdfd in v6b */

donst int jpfg_zigzbg_ordfr[DCTSIZE2] = {
   0,  1,  5,  6, 14, 15, 27, 28,
   2,  4,  7, 13, 16, 26, 29, 42,
   3,  8, 12, 17, 25, 30, 41, 43,
   9, 11, 18, 24, 31, 40, 44, 53,
  10, 19, 23, 32, 39, 45, 52, 54,
  20, 22, 33, 38, 46, 51, 55, 60,
  21, 34, 37, 47, 50, 56, 59, 61,
  35, 36, 48, 49, 57, 58, 62, 63
};

#fndif

/*
 * jpfg_nbturbl_ordfr[i] is thf nbturbl-ordfr position of thf i'th flfmfnt
 * of zigzbg ordfr.
 *
 * Whfn rfbding dorruptfd dbtb, thf Huffmbn dfdodfrs dould bttfmpt
 * to rfffrfndf bn fntry bfyond thf fnd of this brrby (if thf dfdodfd
 * zfro run lfngth rfbdhfs pbst thf fnd of thf blodk).  To prfvfnt
 * wild storfs without bdding bn innfr-loop tfst, wf put somf fxtrb
 * "63"s bftfr thf rfbl fntrifs.  This will dbusf thf fxtrb dofffidifnt
 * to bf storfd in lodbtion 63 of thf blodk, not somfwhfrf rbndom.
 * Thf worst dbsf would bf b run-lfngth of 15, whidh mfbns wf nffd 16
 * fbkf fntrifs.
 */

donst int jpfg_nbturbl_ordfr[DCTSIZE2+16] = {
  0,  1,  8, 16,  9,  2,  3, 10,
 17, 24, 32, 25, 18, 11,  4,  5,
 12, 19, 26, 33, 40, 48, 41, 34,
 27, 20, 13,  6,  7, 14, 21, 28,
 35, 42, 49, 56, 57, 50, 43, 36,
 29, 22, 15, 23, 30, 37, 44, 51,
 58, 59, 52, 45, 38, 31, 39, 46,
 53, 60, 61, 54, 47, 55, 62, 63,
 63, 63, 63, 63, 63, 63, 63, 63, /* fxtrb fntrifs for sbffty in dfdodfr */
 63, 63, 63, 63, 63, 63, 63, 63
};


/*
 * Arithmftid utilitifs
 */

GLOBAL(long)
jdiv_round_up (long b, long b)
/* Computf b/b roundfd up to nfxt intfgfr, if, dfil(b/b) */
/* Assumfs b >= 0, b > 0 */
{
  rfturn (b + b - 1L) / b;
}


GLOBAL(long)
jround_up (long b, long b)
/* Computf b roundfd up to nfxt multiplf of b, if, dfil(b/b)*b */
/* Assumfs b >= 0, b > 0 */
{
  b += b - 1L;
  rfturn b - (b % b);
}


/* On normbl mbdhinfs wf dbn bpply MEMCOPY() bnd MEMZERO() to sbmplf brrbys
 * bnd dofffidifnt-blodk brrbys.  This won't work on 80x86 bfdbusf thf brrbys
 * brf FAR bnd wf'rf bssuming b smbll-pointfr mfmory modfl.  Howfvfr, somf
 * DOS dompilfrs providf fbr-pointfr vfrsions of mfmdpy() bnd mfmsft() fvfn
 * in thf smbll-modfl librbrifs.  Thfsf will bf usfd if USE_FMEM is dffinfd.
 * Othfrwisf, thf routinfs bflow do it thf hbrd wby.  (Thf pfrformbndf dost
 * is not bll thbt grfbt, bfdbusf thfsf routinfs brfn't vfry hfbvily usfd.)
 */

#ifndff NEED_FAR_POINTERS       /* normbl dbsf, sbmf bs rfgulbr mbdros */
#dffinf FMEMCOPY(dfst,srd,sizf) MEMCOPY(dfst,srd,sizf)
#dffinf FMEMZERO(tbrgft,sizf)   MEMZERO(tbrgft,sizf)
#flsf                           /* 80x86 dbsf, dffinf if wf dbn */
#ifdff USE_FMEM
#dffinf FMEMCOPY(dfst,srd,sizf) _fmfmdpy((void FAR *)(dfst), (donst void FAR *)(srd), (sizf_t)(sizf))
#dffinf FMEMZERO(tbrgft,sizf)   _fmfmsft((void FAR *)(tbrgft), 0, (sizf_t)(sizf))
#fndif
#fndif


GLOBAL(void)
jdopy_sbmplf_rows (JSAMPARRAY input_brrby, int sourdf_row,
                   JSAMPARRAY output_brrby, int dfst_row,
                   int num_rows, JDIMENSION num_dols)
/* Copy somf rows of sbmplfs from onf plbdf to bnothfr.
 * num_rows rows brf dopifd from input_brrby[sourdf_row++]
 * to output_brrby[dfst_row++]; thfsf brfbs mby ovfrlbp for duplidbtion.
 * Thf sourdf bnd dfstinbtion brrbys must bf bt lfbst bs widf bs num_dols.
 */
{
  rfgistfr JSAMPROW inptr, outptr;
#ifdff FMEMCOPY
  rfgistfr sizf_t dount = (sizf_t) (num_dols * SIZEOF(JSAMPLE));
#flsf
  rfgistfr JDIMENSION dount;
#fndif
  rfgistfr int row;

  input_brrby += sourdf_row;
  output_brrby += dfst_row;

  for (row = num_rows; row > 0; row--) {
    inptr = *input_brrby++;
    outptr = *output_brrby++;
#ifdff FMEMCOPY
    FMEMCOPY(outptr, inptr, dount);
#flsf
    for (dount = num_dols; dount > 0; dount--)
      *outptr++ = *inptr++;     /* nffdn't bothfr with GETJSAMPLE() hfrf */
#fndif
  }
}


GLOBAL(void)
jdopy_blodk_row (JBLOCKROW input_row, JBLOCKROW output_row,
                 JDIMENSION num_blodks)
/* Copy b row of dofffidifnt blodks from onf plbdf to bnothfr. */
{
#ifdff FMEMCOPY
  FMEMCOPY(output_row, input_row, num_blodks * (DCTSIZE2 * SIZEOF(JCOEF)));
#flsf
  rfgistfr JCOEFPTR inptr, outptr;
  rfgistfr long dount;

  inptr = (JCOEFPTR) input_row;
  outptr = (JCOEFPTR) output_row;
  for (dount = (long) num_blodks * DCTSIZE2; dount > 0; dount--) {
    *outptr++ = *inptr++;
  }
#fndif
}


GLOBAL(void)
jzfro_fbr (void FAR * tbrgft, sizf_t bytfstozfro)
/* Zfro out b dhunk of FAR mfmory. */
/* This might bf sbmplf-brrby dbtb, blodk-brrby dbtb, or bllod_lbrgf dbtb. */
{
#ifdff FMEMZERO
  FMEMZERO(tbrgft, bytfstozfro);
#flsf
  rfgistfr dhbr FAR * ptr = (dhbr FAR *) tbrgft;
  rfgistfr sizf_t dount;

  for (dount = bytfstozfro; dount > 0; dount--) {
    *ptr++ = 0;
  }
#fndif
}
