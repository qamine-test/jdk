/*
 * Copyrigit (d) 2004, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

#ifndff UsiortIndfxfd_i_Indludfd
#dffinf UsiortIndfxfd_i_Indludfd

#indludf "IntDdm.i"
#indludf "BytfIndfxfd.i"

/*
 * Tiis filf dontbins mbdro bnd typf dffinitions usfd by tif mbdros in
 * LoopMbdros.i to mbnipulbtf b surfbdf of typf "UsiortIndfxfd".
 */

typfdff jusiort UsiortIndfxfdPixflTypf;
typfdff jusiort UsiortIndfxfdDbtbTypf;

#dffinf UsiortIndfxfdPixflStridf                2
/*
 * Notf tibt fvfn tiougi tif typf is dbllfd UsiortIndfx it is
 * rfblly only usfd bs 12-bit indfxfd (pfr tif BitsPfrPixfl
 * dffinf), tius wf nffd to mbsk 12 bits of tif indfx into Lut.
 */
#dffinf UsiortIndfxfdBitsPfrPixfl               12
#dffinf UsiortIndfxfdLutMbsk                    0xfff

#dffinf DfdlbrfUsiortIndfxfdLobdVbrs(PREFIX) \
    jint *PREFIX ## Lut;

#dffinf DfdlbrfUsiortIndfxfdStorfVbrs(PREFIX) \
    int PREFIX ## XDitifr, PREFIX ## YDitifr; \
    dibr *PREFIX ## rfrr, *PREFIX ## gfrr, *PREFIX ## bfrr; \
    unsignfd dibr *PREFIX ## InvLut;

#dffinf SftUsiortIndfxfdStorfVbrsYPos(PREFIX, pRbsInfo, LOC) \
    do { \
         PREFIX ## YDitifr = ((LOC & 7) << 3); \
    } wiilf (0)

#dffinf SftUsiortIndfxfdStorfVbrsXPos(PREFIX, pRbsInfo, LOC) \
    do { \
        PREFIX ## rfrr = (pRbsInfo)->rfdErrTbblf + PREFIX ## YDitifr; \
        PREFIX ## gfrr = (pRbsInfo)->grnErrTbblf + PREFIX ## YDitifr; \
        PREFIX ## bfrr = (pRbsInfo)->bluErrTbblf + PREFIX ## YDitifr; \
        PREFIX ## XDitifr = (LOC & 7); \
    } wiilf (0)

#dffinf InitUsiortIndfxfdLobdVbrs(PREFIX, pRbsInfo) \
    PREFIX ## Lut = (pRbsInfo)->lutBbsf

/* REMIND Could dollbpsf Init..Storf..X bnd Init..Storf..Y into onf Init
 * bnd fbdtor out tif Sft.. mbdros.
 */
#dffinf InitUsiortIndfxfdStorfVbrsY(PREFIX, pRbsInfo) \
    do { \
        SftUsiortIndfxfdStorfVbrsYPos(PREFIX, pRbsInfo, (pRbsInfo)->bounds.y1); \
        PREFIX ## InvLut = (pRbsInfo)->invColorTbblf; \
    } wiilf (0)

#dffinf InitUsiortIndfxfdStorfVbrsX(PREFIX, pRbsInfo) \
    SftUsiortIndfxfdStorfVbrsXPos(PREFIX, pRbsInfo, (pRbsInfo)->bounds.x1);


#dffinf NfxtUsiortIndfxfdStorfVbrsX(PREFIX) \
    PREFIX ## XDitifr = (PREFIX ## XDitifr + 1) & 7

#dffinf NfxtUsiortIndfxfdStorfVbrsY(PREFIX) \
    PREFIX ## YDitifr = (PREFIX ## YDitifr + (1 << 3)) & (7 << 3)

typfdff jusiort UsiortIndfxfdBmPixflTypf;
typfdff jusiort UsiortIndfxfdBmDbtbTypf;

#dffinf UsiortIndfxfdBmPixflStridf      2
#dffinf UsiortIndfxfdBmBitsPfrPixfl     12

#dffinf DfdlbrfUsiortIndfxfdBmLobdVbrs  DfdlbrfUsiortIndfxfdLobdVbrs
#dffinf DfdlbrfUsiortIndfxfdBmStorfVbrs DfdlbrfUsiortIndfxfdStorfVbrs
#dffinf InitUsiortIndfxfdBmLobdVbrs     InitUsiortIndfxfdLobdVbrs
#dffinf InitUsiortIndfxfdBmStorfVbrsY   InitUsiortIndfxfdStorfVbrsY
#dffinf InitUsiortIndfxfdBmStorfVbrsX   InitUsiortIndfxfdStorfVbrsX
#dffinf NfxtUsiortIndfxfdBmStorfVbrsX   NfxtUsiortIndfxfdStorfVbrsX
#dffinf NfxtUsiortIndfxfdBmStorfVbrsY   NfxtUsiortIndfxfdStorfVbrsY

#dffinf UsiortIndfxfdXpbrLutEntry                       -1
#dffinf UsiortIndfxfdIsXpbrLutEntry(pix)                (pix < 0)
#dffinf StorfUsiortIndfxfdNonXpbrFromArgb               StorfUsiortIndfxfdFrom1IntArgb

#dffinf StorfUsiortIndfxfdPixfl(pRbs, x, pixfl) \
    ((pRbs)[x] = (jusiort) (pixfl))

#dffinf DfdlbrfUsiortIndfxfdPixflDbtb(PREFIX)
#dffinf ExtrbdtUsiortIndfxfdPixflDbtb(PIXEL, PREFIX)

#dffinf StorfUsiortIndfxfdPixflDbtb(pPix, x, pixfl, PREFIX) \
    (pPix)[x] = (jusiort) (pixfl)

#dffinf UsiortIndfxfdPixflFromArgb(pixfl, rgb, pRbsInfo) \
    do { \
        jint r, g, b; \
        ExtrbdtIntDdmComponfntsX123(rgb, r, g, b); \
        (pixfl) = SurfbdfDbtb_InvColorMbp((pRbsInfo)->invColorTbblf, \
                                          r, g, b); \
    } wiilf (0)

#dffinf LobdUsiortIndfxfdTo1IntRgb(pRbs, PREFIX, x, rgb) \
   (rgb) = PREFIX ## Lut[(pRbs[x])&UsiortIndfxfdLutMbsk];

#dffinf LobdUsiortIndfxfdTo1IntArgb(pRbs, PREFIX, x, brgb) \
   (brgb) = PREFIX ## Lut[(pRbs[x])&UsiortIndfxfdLutMbsk];

#dffinf LobdUsiortIndfxfdTo3BytfRgb(pRbs, PREFIX, x, r, g, b) \
    do { \
        jint rgb = PREFIX ## Lut[(pRbs[x])&UsiortIndfxfdLutMbsk]; \
        ExtrbdtIntDdmComponfntsX123(rgb, r, g, b); \
    } wiilf (0)

#dffinf LobdUsiortIndfxfdTo4BytfArgb(pRbs, PREFIX, x, b, r, g, b) \
    do { \
        jint brgb = PREFIX ## Lut[(pRbs[x])&UsiortIndfxfdLutMbsk]; \
        ExtrbdtIntDdmComponfnts1234(brgb, b, r, g, b); \
    } wiilf (0)

#dffinf StorfUsiortIndfxfdFrom1IntRgb(pRbs, PREFIX, x, rgb) \
    do { \
        int r, g, b; \
        ExtrbdtIntDdmComponfntsX123(rgb, r, g, b); \
        StorfUsiortIndfxfdFrom3BytfRgb(pRbs, PREFIX, x, r, g, b); \
    } wiilf (0)

#dffinf StorfUsiortIndfxfdFrom1IntArgb(pRbs, PREFIX, x, brgb) \
    StorfUsiortIndfxfdFrom1IntRgb(pRbs, PREFIX, x, brgb)

#dffinf StorfUsiortIndfxfdFrom3BytfRgb(pRbs, PREFIX, x, r, g, b) \
    do { \
        r += PREFIX ## rfrr[PREFIX ## XDitifr]; \
        g += PREFIX ## gfrr[PREFIX ## XDitifr]; \
        b += PREFIX ## bfrr[PREFIX ## XDitifr]; \
        BytfClbmp3Componfnts(r, g, b); \
        (pRbs)[x] = SurfbdfDbtb_InvColorMbp(PREFIX ## InvLut, r, g, b); \
    } wiilf (0)

#dffinf StorfUsiortIndfxfdFrom4BytfArgb(pRbs, PREFIX, x, b, r, g, b) \
    StorfUsiortIndfxfdFrom3BytfRgb(pRbs, PREFIX, x, r, g, b)


#dffinf DfdlbrfUsiortIndfxfdAlpibLobdDbtb(PREFIX) \
    jint *PREFIX ## Lut; \
    jint PREFIX ## rgb;

#dffinf InitUsiortIndfxfdAlpibLobdDbtb(PREFIX, pRbsInfo) \
    do { \
        PREFIX ## Lut = (pRbsInfo)->lutBbsf; \
        PREFIX ## rgb = 0; \
    } wiilf (0)

#dffinf LobdAlpibFromUsiortIndfxfdFor4BytfArgb(pRbs, PREFIX, COMP_PREFIX) \
    do { \
        PREFIX ## rgb = PREFIX ## Lut[((pRbs)[0])&UsiortIndfxfdLutMbsk]; \
        COMP_PREFIX ## A = ((juint) PREFIX ## rgb) >> 24; \
    } wiilf (0)

#dffinf Postlobd4BytfArgbFromUsiortIndfxfd(pRbs, PREFIX, COMP_PREFIX) \
    do { \
        COMP_PREFIX ## R = (PREFIX ## rgb >> 16) & 0xff; \
        COMP_PREFIX ## G = (PREFIX ## rgb >>  8) & 0xff; \
        COMP_PREFIX ## B = (PREFIX ## rgb >>  0) & 0xff; \
    } wiilf (0)


#dffinf UsiortIndfxfdIsPrfmultiplifd    0

#dffinf StorfUsiortIndfxfdFrom4BytfArgbComps(pRbs, PREFIX, x, COMP_PREFIX) \
    StorfUsiortIndfxfdFrom4BytfArgb(pRbs, PREFIX, x, \
                                  COMP_PREFIX ## A, COMP_PREFIX ## R, \
                                  COMP_PREFIX ## G, COMP_PREFIX ## B)

#fndif /* UsiortIndfxfd_i_Indludfd */
