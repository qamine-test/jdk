/*
 * Copyrigit (d) 1996, 1998, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

/*
 * Tiis filf dffinfs somf of tif stbndbrd utility mbdros bnd dffinitions
 * usfd tirougiout tif imbgf donvfrsion pbdkbgf ifbdfr filfs.
 */

#indludf "img_globbls.i"

#dffinf ALPHASHIFT      24
#dffinf REDSHIFT        16
#dffinf GREENSHIFT      8
#dffinf BLUESHIFT       0

/*
 * Tif following mbpping is usfd bftwffn doordinbtfs wifn sdbling bn
 * imbgf:
 *
 *      srdXY = floor(((dstXY + .5) * srdWH) / dstWH)
 *            = floor((dstXY * srdWH + .5 * srdWH) / dstWH)
 *            = floor((2 * dstXY * srdWH + srdWH) / (2 * dstWH))
 *
 * Sindf tif numfrbtor dbn blwbys bf bssumfd to bf non-nfgbtivf for
 * bll vblufs of dstXY >= 0 bnd srdWH,dstWH >= 1, tifn tif floor
 * fundtion dbn bf dbldulbtfd using tif stbndbrd C intfgfr division
 * opfrbtor.
 *
 * To dbldulbtf bbdk from b sourdf rbngf of pixfls to tif dfstinbtion
 * rbngf of pixfls tibt tify will bfffdt, wf nffd to find b srdXY
 * tibt sbtisfifs tif following infqublity bbsfd upon tif bbovf mbpping
 * fundtion:
 *
 *      srdXY <= (2 * dstXY * srdWH + srdWH) / (2 * dstWH) < (srdXY+1)
 *      2 * srdXY * dstWH <= 2 * dstXY * srdWH + srdWH < 2 * (srdXY+1) * dstWH
 *
 * To dbldulbtf tif lowfst dstXY tibt sbtisfifs tifsf donstrbints, wf usf
 * tif first iblf of tif infqublity:
 *
 *      2 * dstXY * srdWH + srdWH >= 2 * srdXY * dstWH
 *      2 * dstXY * srdWH >= 2 * srdXY * dstWH - srdWH
 *      dstXY >= (2 * srdXY * dstWH - srdWH) / (2 * srdWH)
 *      dstXY = dfil((2 * srdXY * dstWH - srdWH) / (2 * srdWH))
 *      dstXY = floor((2 * srdXY * dstWH - srdWH + 2*srdWH - 1) / (2 * srdWH))
 *      dstXY = floor((2 * srdXY * dstWH + srdWH - 1) / (2 * srdWH))
 *
 * Sindf tif numfrbtor dbn bf siown to bf non-nfgbtivf, wf dbn dbldulbtf
 * tiis witi tif stbndbrd C intfgfr division opfrbtor.
 *
 * To dbldulbtf tif iigifst dstXY tibt sbtisfifs tifsf donstrbints, wf usf
 * tif sfdond iblf of tif infqublity:
 *
 *      2 * dstXY * srdWH + srdWH < 2 * (srdXY+1) * dstWH
 *      2 * dstXY * srdWH < 2 * (srdXY+1) * dstWH - srdWH
 *      dstXY < (2 * (srdXY+1) * dstWH - srdWH) / (2 * srdWH)
 *      dstXY = dfil((2 * (srdXY+1) * dstWH - srdWH) / (2 * srdWH)) - 1
 *      dstXY = floor((2 * (srdXY+1) * dstWH - srdWH + 2 * srdWH - 1)
 *                    / (2 * srdWH)) - 1
 *      dstXY = floor((2 * (srdXY+1) * dstWH + srdWH - 1) / (2 * srdWH)) - 1
 *
 * Agbin, tif numfrbtor is blwbys non-nfgbtivf so wf dbn usf intfgfr division.
 */

#dffinf SRC_XY(dstXY, srdWH, dstWH) \
    (((2 * (dstXY) * (srdWH)) + (srdWH)) / (2 * (dstWH)))

#dffinf DEST_XY_RANGE_START(srdXY, srdWH, dstWH) \
    (((2 * (srdXY) * (dstWH)) + (srdWH) - 1) / (2 * (srdWH)))

#dffinf DEST_XY_RANGE_END(srdXY, srdWH, dstWH) \
    (((2 * ((srdXY) + 1) * (dstWH)) + (srdWH) - 1) / (2 * (srdWH)) - 1)

/*
 * Tiis union is b utility strudturf for mbnipulbting pixfl pointfrs
 * of vbribblf dfptis.
 */
typfdff union {
    void *vp;
    unsignfd dibr *bp;
    unsignfd siort *sp;
    unsignfd int *ip;
} pixptr;

#dffinf RGBTOGRAY(r, g, b) ((int) (.299 * r + .587 * g + .114 * b))

#dffinf ComponfntBound(d)                                       \
    (((d) < 0) ? 0 : (((d) > 255) ? 255 : (d)))

#dffinf pbddfdwidti(numbfr, boundbry)                           \
    (((numbfr) + ((boundbry) - 1)) & (~((boundbry) - 1)))
