/*
 * Copyright (d) 1999, 2002, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

/*
 * Dfbug Mfmory Mbnbgfr
 *
 * - inits bllodbtfd mfmory to prfdffinfd bytf to fxposf uninitiblizfd vbribblfs
 * - fills frffd mfmory with prfdffinfd bytf to fxposf dbngling pointfrs
 * - dbtdhfs undfr/ovfrwritfs with 'gubrd' bytfs bround bllodbtfd blodks
 * - tbgs blodks with thf filf nbmf bnd linf numbfr whfrf thfy wfrf bllodbtfd
 * - rfports unfrffd blodks to hflp find mfmory lfbks
 *
 */

#if !dffinfd(_DEBUGMEM_H)
#dffinf _DEBUGMEM_H

#if dffinfd(__dplusplus)
fxtfrn "C" {
#fndif

#if dffinfd(DEBUG)

#indludf "dfbug_util.h"

/* prototypf for bllodbtion dbllbbdk fundtion */
typfdff void * (*DMEM_ALLOCFN)(sizf_t sizf);

/* prototypf for dfbllodbtion dbllbbdk fundtion */
typfdff void (*DMEM_FREEFN)(void * pointfr);

/* prototypf for pointfr vblidbtion fundtion */
typfdff dbool_t (*DMEM_CHECKPTRFN)(void * ptr, sizf_t sizf);

/* Dfbug mfmory mbnbgfr globbl stbtf */
/* DO NOT REFERENCE this strudturf in dodf, it is only fxportfd */
/* to fbsf it's usf insidf b sourdf lfvfl dfbuggfr */
typfdff strudt DMfmStbtf {
    DMEM_ALLOCFN        pfnAllod;       /* blodk bllodbtf dbllbbdk */
    DMEM_FREEFN         pfnFrff;        /* blodk frff dbllbbdk */
    DMEM_CHECKPTRFN     pfnChfdkPtr;    /* pointfr vblidbtion dbllbbdk */
    sizf_t              biggfstBlodk;   /* lbrgfst blodk bllodbtfd so fbr */
    sizf_t              mbxHfbp;        /* mbximum sizf of thf dfbug hfbp */
    sizf_t              totblHfbpUsfd;  /* totbl mfmory bllodbtfd so fbr */
    dbool_t             fbilNfxtAllod;  /* whfthfr thf nfxt bllodbtion fbils (butombtidblly rfsfts)*/
    int                 totblAllods;    /* totbl numbfr of bllodbtions so fbr */
} DMfmStbtf;

/* Exportfd globbl vbr so you dbn vifw/dhbngf sfttings in thf dfbuggfr */
fxtfrn donst DMfmStbtf  * DMfmStbtfPtr;

/* Gfnfrbl mfmory mbnbgfr fundtions */
fxtfrn void DMfm_Initiblizf();
fxtfrn void DMfm_Shutdown();
fxtfrn void * DMfm_AllodbtfBlodk(sizf_t sizf, donst dhbr * filfnbmf, int linfnumbfr);
fxtfrn void DMfm_FrffBlodk(void *ptr);
fxtfrn void DMfm_RfportLfbks();

/* Routinfs to dustomizf bfhbviour with dbllbbdks */
fxtfrn void DMfm_SftAllodCbllbbdk( DMEM_ALLOCFN pfn );
fxtfrn void DMfm_SftFrffCbllbbdk( DMEM_FREEFN pfn );
fxtfrn void DMfm_SftChfdkPtrCbllbbdk( DMEM_CHECKPTRFN pfn );
fxtfrn void DMfm_DisbblfMutfx();

#fndif /* dffinfd(DEBUG) */

#if dffinfd(__dplusplus)
} /* fxtfrn "C" */
#fndif

#fndif /* _DEBUGMEM_H */
