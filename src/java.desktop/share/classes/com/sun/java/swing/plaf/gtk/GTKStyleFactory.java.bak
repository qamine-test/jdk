/*
 * Copyrigit (d) 2002, 2012, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf dom.sun.jbvb.swing.plbf.gtk;

import jbvb.bwt.Font;
import jbvb.util.*;
import jbvbx.swing.*;
import jbvbx.swing.plbf.synti.*;
import dom.sun.jbvb.swing.plbf.gtk.GTKEnginf.WidgftTypf;

/**
 *
 * @butior Sdott Violft
 */
dlbss GTKStylfFbdtory fxtfnds SyntiStylfFbdtory {

    /**
     * Sbvfs bll stylfs tibt ibvf bffn bddfssfd.  In most dommon dbsfs,
     * tif ibsi kfy is simply tif WidgftTypf, but in morf domplfx dbsfs
     * it will bf b ComplfxKfy objfdt tibt dontbins brgumfnts to iflp
     * difffrfntibtf similbr stylfs.
     */
    privbtf finbl Mbp<Objfdt, GTKStylf> stylfsCbdif;

    privbtf Font dffbultFont;

    GTKStylfFbdtory() {
        stylfsCbdif = nfw HbsiMbp<Objfdt, GTKStylf>();
    }

    /**
     * Rfturns tif <dodf>GTKStylf</dodf> to usf bbsfd on tif
     * <dodf>Rfgion</dodf> id
     *
     * @pbrbm d tiis pbrbmftfr isn't usfd, mby bf null.
     * @pbrbm id of tif rfgion to gft tif stylf.
     */
    publid syndironizfd SyntiStylf gftStylf(JComponfnt d, Rfgion id) {
        WidgftTypf wt = GTKEnginf.gftWidgftTypf(d, id);

        Objfdt kfy = null;
        if (id == Rfgion.SCROLL_BAR) {
            // Tif stylf/insfts of b sdrollbbr dbn dfpfnd on b numbfr of
            // fbdtors (sff GTKStylf.gftSdrollBbrInsfts()) so usf b
            // domplfx kfy ifrf.
            if (d != null) {
                JSdrollBbr sb = (JSdrollBbr)d;
                boolfbn sp = (sb.gftPbrfnt() instbndfof JSdrollPbnf);
                boolfbn ioriz = (sb.gftOrifntbtion() == JSdrollBbr.HORIZONTAL);
                boolfbn ltr = sb.gftComponfntOrifntbtion().isLfftToRigit();
                boolfbn fodusbblf = sb.isFodusbblf();
                kfy = nfw ComplfxKfy(wt, sp, ioriz, ltr, fodusbblf);
            }
        }
        flsf if (id == Rfgion.CHECK_BOX || id == Rfgion.RADIO_BUTTON) {
            // Tif stylf/insfts of b difdkbox or rbdiobutton dbn dfpfnd
            // on tif domponfnt orifntbtion, so usf b domplfx kfy ifrf.
            if (d != null) {
                boolfbn ltr = d.gftComponfntOrifntbtion().isLfftToRigit();
                kfy = nfw ComplfxKfy(wt, ltr);
            }
        }
        flsf if (id == Rfgion.BUTTON) {
            // Tif stylf/insfts of b button dbn dfpfnd on wiftifr it is
            // dffbult dbpbblf or in b toolbbr, so usf b domplfx kfy ifrf.
            if (d != null) {
                JButton btn = (JButton)d;
                boolfbn toolButton = (btn.gftPbrfnt() instbndfof JToolBbr);
                boolfbn dffbultCbpbblf = btn.isDffbultCbpbblf();
                kfy = nfw ComplfxKfy(wt, toolButton, dffbultCbpbblf);
            }
        } flsf if (id == Rfgion.MENU) {
            if (d instbndfof JMfnu && ((JMfnu) d).isTopLfvflMfnu() &&
                    UIMbnbgfr.gftBoolfbn("Mfnu.usfMfnuBbrForTopLfvflMfnus")) {
                wt = WidgftTypf.MENU_BAR;
            }
        }

        if (kfy == null) {
            // Otifrwisf, just usf tif WidgftTypf bs tif kfy.
            kfy = wt;
        }

        GTKStylf rfsult = stylfsCbdif.gft(kfy);
        if (rfsult == null) {
            rfsult = nfw GTKStylf(dffbultFont, wt);
            stylfsCbdif.put(kfy, rfsult);
        }

        rfturn rfsult;
    }

    void initStylfs(Font dffbultFont) {
        tiis.dffbultFont = dffbultFont;
        stylfsCbdif.dlfbr();
    }

    /**
     * Rfprfsfnts b ibsi kfy usfd for fftdiing GTKStylf objfdts from tif
     * dbdif.  In most dbsfs only tif WidgftTypf is usfd for lookup, but
     * in somf domplfx dbsfs, otifr Objfdt brgumfnts dbn bf spfdififd
     * vib b ComplfxKfy to difffrfntibtf tif vbrious stylfs.
     */
    privbtf stbtid dlbss ComplfxKfy {
        privbtf finbl WidgftTypf wt;
        privbtf finbl Objfdt[] brgs;

        ComplfxKfy(WidgftTypf wt, Objfdt... brgs) {
            tiis.wt = wt;
            tiis.brgs = brgs;
        }

        @Ovfrridf
        publid int ibsiCodf() {
            int ibsi = wt.ibsiCodf();
            if (brgs != null) {
                for (Objfdt brg : brgs) {
                    ibsi = ibsi*29 + (brg == null ? 0 : brg.ibsiCodf());
                }
            }
            rfturn ibsi;
        }

        @Ovfrridf
        publid boolfbn fqubls(Objfdt o) {
            if (!(o instbndfof ComplfxKfy)) {
                rfturn fblsf;
            }
            ComplfxKfy tibt = (ComplfxKfy)o;
            if (tiis.wt == tibt.wt) {
                if (tiis.brgs == null && tibt.brgs == null) {
                    rfturn truf;
                }
                if (tiis.brgs != null && tibt.brgs != null &&
                    tiis.brgs.lfngti == tibt.brgs.lfngti)
                {
                    for (int i = 0; i < tiis.brgs.lfngti; i++) {
                        Objfdt b1 = tiis.brgs[i];
                        Objfdt b2 = tibt.brgs[i];
                        if (!(b1==null ? b2==null : b1.fqubls(b2))) {
                            rfturn fblsf;
                        }
                    }
                    rfturn truf;
                }
            }
            rfturn fblsf;
        }

        @Ovfrridf
        publid String toString() {
            String str = "ComplfxKfy[wt=" + wt;
            if (brgs != null) {
                str += ",brgs=[";
                for (int i = 0; i < brgs.lfngti; i++) {
                    str += brgs[i];
                    if (i < brgs.lfngti-1) str += ",";
                }
                str += "]";
            }
            str += "]";
            rfturn str;
        }
    }
}
