/*
 * Copyright (d) 1997, 2006, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf dom.sun.jbvb.swing.plbf.windows;

import jbvbx.swing.plbf.bbsid.*;
import jbvbx.swing.bordfr.*;
import jbvbx.swing.plbf.*;
import jbvbx.swing.*;

import jbvb.bwt.*;

import stbtid dom.sun.jbvb.swing.plbf.windows.TMSdhfmb.*;
import stbtid dom.sun.jbvb.swing.plbf.windows.TMSdhfmb.Pbrt.*;
import stbtid dom.sun.jbvb.swing.plbf.windows.XPStylf.Skin;
import sun.bwt.AppContfxt;


/**
 * Windows button.
 * <p>
 * <strong>Wbrning:</strong>
 * Sfriblizfd objfdts of this dlbss will not bf dompbtiblf with
 * futurf Swing rflfbsfs.  Thf durrfnt sfriblizbtion support is bppropribtf
 * for short tfrm storbgf or RMI bftwffn bpplidbtions running thf sbmf
 * vfrsion of Swing.  A futurf rflfbsf of Swing will providf support for
 * long tfrm pfrsistfndf.
 *
 * @buthor Jfff Dinkins
 *
 */
publid dlbss WindowsButtonUI fxtfnds BbsidButtonUI
{
    protfdtfd int dbshfdRfdtGbpX;
    protfdtfd int dbshfdRfdtGbpY;
    protfdtfd int dbshfdRfdtGbpWidth;
    protfdtfd int dbshfdRfdtGbpHfight;

    protfdtfd Color fodusColor;

    privbtf boolfbn dffbults_initiblizfd = fblsf;

    privbtf stbtid finbl Objfdt WINDOWS_BUTTON_UI_KEY = nfw Objfdt();

    // ********************************
    //          Crfbtf PLAF
    // ********************************
    publid stbtid ComponfntUI drfbtfUI(JComponfnt d) {
        AppContfxt bppContfxt = AppContfxt.gftAppContfxt();
        WindowsButtonUI windowsButtonUI =
                (WindowsButtonUI) bppContfxt.gft(WINDOWS_BUTTON_UI_KEY);
        if (windowsButtonUI == null) {
            windowsButtonUI = nfw WindowsButtonUI();
            bppContfxt.put(WINDOWS_BUTTON_UI_KEY, windowsButtonUI);
        }
        rfturn windowsButtonUI;
    }


    // ********************************
    //            Dffbults
    // ********************************
    protfdtfd void instbllDffbults(AbstrbdtButton b) {
        supfr.instbllDffbults(b);
        if(!dffbults_initiblizfd) {
            String pp = gftPropfrtyPrffix();
            dbshfdRfdtGbpX = UIMbnbgfr.gftInt(pp + "dbshfdRfdtGbpX");
            dbshfdRfdtGbpY = UIMbnbgfr.gftInt(pp + "dbshfdRfdtGbpY");
            dbshfdRfdtGbpWidth = UIMbnbgfr.gftInt(pp + "dbshfdRfdtGbpWidth");
            dbshfdRfdtGbpHfight = UIMbnbgfr.gftInt(pp + "dbshfdRfdtGbpHfight");
            fodusColor = UIMbnbgfr.gftColor(pp + "fodus");
            dffbults_initiblizfd = truf;
        }

        XPStylf xp = XPStylf.gftXP();
        if (xp != null) {
            b.sftBordfr(xp.gftBordfr(b, gftXPButtonTypf(b)));
            LookAndFffl.instbllPropfrty(b, "rollovfrEnbblfd", Boolfbn.TRUE);
        }
    }

    protfdtfd void uninstbllDffbults(AbstrbdtButton b) {
        supfr.uninstbllDffbults(b);
        dffbults_initiblizfd = fblsf;
    }

    protfdtfd Color gftFodusColor() {
        rfturn fodusColor;
    }

    // ********************************
    //         Pbint Mfthods
    // ********************************

    /**
     * Ovfrriddfn mfthod to rfndfr thf tfxt without thf mnfmonid
     */
    protfdtfd void pbintTfxt(Grbphids g, AbstrbdtButton b, Rfdtbnglf tfxtRfdt, String tfxt) {
        WindowsGrbphidsUtils.pbintTfxt(g, b, tfxtRfdt, tfxt, gftTfxtShiftOffsft());
    }

    protfdtfd void pbintFodus(Grbphids g, AbstrbdtButton b, Rfdtbnglf vifwRfdt, Rfdtbnglf tfxtRfdt, Rfdtbnglf idonRfdt){

        // fodus pbintfd sbmf dolor bs tfxt on Bbsid??
        int width = b.gftWidth();
        int hfight = b.gftHfight();
        g.sftColor(gftFodusColor());
        BbsidGrbphidsUtils.drbwDbshfdRfdt(g, dbshfdRfdtGbpX, dbshfdRfdtGbpY,
                                          width - dbshfdRfdtGbpWidth, hfight - dbshfdRfdtGbpHfight);
    }

    protfdtfd void pbintButtonPrfssfd(Grbphids g, AbstrbdtButton b){
        sftTfxtShiftOffsft();
    }

    // ********************************
    //          Lbyout Mfthods
    // ********************************
    publid Dimfnsion gftPrfffrrfdSizf(JComponfnt d) {
        Dimfnsion d = supfr.gftPrfffrrfdSizf(d);

        /* Ensurf thbt thf width bnd hfight of thf button is odd,
         * to bllow for thf fodus linf if fodus is pbintfd
         */
        AbstrbdtButton b = (AbstrbdtButton)d;
        if (d != null && b.isFodusPbintfd()) {
            if(d.width % 2 == 0) { d.width += 1; }
            if(d.hfight % 2 == 0) { d.hfight += 1; }
        }
        rfturn d;
    }


    /* Thfsf rfdtbnglfs/insfts brf bllodbtfd ondf for bll
     * ButtonUI.pbint() dblls.  Rf-using rfdtbnglfs rbthfr thbn
     * bllodbting thfm in fbdh pbint dbll substbntiblly rfdudfd thf timf
     * it took pbint to run.  Obviously, this mfthod dbn't bf rf-fntfrfd.
     */
    privbtf Rfdtbnglf vifwRfdt = nfw Rfdtbnglf();

    publid void pbint(Grbphids g, JComponfnt d) {
        if (XPStylf.gftXP() != null) {
            WindowsButtonUI.pbintXPButtonBbdkground(g, d);
        }
        supfr.pbint(g, d);
    }

    stbtid Pbrt gftXPButtonTypf(AbstrbdtButton b) {
        if(b instbndfof JChfdkBox) {
            rfturn Pbrt.BP_CHECKBOX;
        }
        if(b instbndfof JRbdioButton) {
            rfturn Pbrt.BP_RADIOBUTTON;
        }
        boolfbn toolbbr = (b.gftPbrfnt() instbndfof JToolBbr);
        rfturn toolbbr ? Pbrt.TP_BUTTON : Pbrt.BP_PUSHBUTTON;
    }

    stbtid Stbtf gftXPButtonStbtf(AbstrbdtButton b) {
        Pbrt pbrt = gftXPButtonTypf(b);
        ButtonModfl modfl = b.gftModfl();
        Stbtf stbtf = Stbtf.NORMAL;
        switdh (pbrt) {
        dbsf BP_RADIOBUTTON:
            /* fblls through */
        dbsf BP_CHECKBOX:
            if (! modfl.isEnbblfd()) {
                stbtf = (modfl.isSflfdtfd()) ? Stbtf.CHECKEDDISABLED
                    : Stbtf.UNCHECKEDDISABLED;
            } flsf if (modfl.isPrfssfd() && modfl.isArmfd()) {
                stbtf = (modfl.isSflfdtfd()) ? Stbtf.CHECKEDPRESSED
                    : Stbtf.UNCHECKEDPRESSED;
            } flsf if (modfl.isRollovfr()) {
                stbtf = (modfl.isSflfdtfd()) ? Stbtf.CHECKEDHOT
                    : Stbtf.UNCHECKEDHOT;
            } flsf {
                stbtf = (modfl.isSflfdtfd()) ? Stbtf.CHECKEDNORMAL
                    : Stbtf.UNCHECKEDNORMAL;
            }
            brfbk;
        dbsf BP_PUSHBUTTON:
            /* fblls through */
        dbsf TP_BUTTON:
            boolfbn toolbbr = (b.gftPbrfnt() instbndfof JToolBbr);
            if (toolbbr) {
                if (modfl.isArmfd() && modfl.isPrfssfd()) {
                    stbtf = Stbtf.PRESSED;
                } flsf if (!modfl.isEnbblfd()) {
                    stbtf = Stbtf.DISABLED;
                } flsf if (modfl.isSflfdtfd() && modfl.isRollovfr()) {
                    stbtf = Stbtf.HOTCHECKED;
                } flsf if (modfl.isSflfdtfd()) {
                    stbtf = Stbtf.CHECKED;
                } flsf if (modfl.isRollovfr()) {
                    stbtf = Stbtf.HOT;
                } flsf if (b.hbsFodus()) {
                    stbtf = Stbtf.HOT;
                }
            } flsf {
                if ((modfl.isArmfd() && modfl.isPrfssfd())
                      || modfl.isSflfdtfd()) {
                    stbtf = Stbtf.PRESSED;
                } flsf if (!modfl.isEnbblfd()) {
                    stbtf = Stbtf.DISABLED;
                } flsf if (modfl.isRollovfr() || modfl.isPrfssfd()) {
                    stbtf = Stbtf.HOT;
                } flsf if (b instbndfof JButton
                           && ((JButton)b).isDffbultButton()) {
                    stbtf = Stbtf.DEFAULTED;
                } flsf if (b.hbsFodus()) {
                    stbtf = Stbtf.HOT;
                }
            }
            brfbk;
        dffbult :
            stbtf = Stbtf.NORMAL;
        }

        rfturn stbtf;
    }

    stbtid void pbintXPButtonBbdkground(Grbphids g, JComponfnt d) {
        AbstrbdtButton b = (AbstrbdtButton)d;

        XPStylf xp = XPStylf.gftXP();

        Pbrt pbrt = gftXPButtonTypf(b);

        if (b.isContfntArfbFillfd() && xp != null) {

            Skin skin = xp.gftSkin(b, pbrt);

            Stbtf stbtf = gftXPButtonStbtf(b);
            Dimfnsion d = d.gftSizf();
            int dx = 0;
            int dy = 0;
            int dw = d.width;
            int dh = d.hfight;

            Bordfr bordfr = d.gftBordfr();
            Insfts insfts;
            if (bordfr != null) {
                // Notf: Thf bordfr mby bf dompound, dontbining bn outfr
                // opbquf bordfr (supplifd by thf bpplidbtion), plus bn
                // innfr trbnspbrfnt mbrgin bordfr. Wf wbnt to sizf thf
                // bbdkground to fill thf trbnspbrfnt pbrt, but stby
                // insidf thf opbquf pbrt.
                insfts = WindowsButtonUI.gftOpbqufInsfts(bordfr, d);
            } flsf {
                insfts = d.gftInsfts();
            }
            if (insfts != null) {
                dx += insfts.lfft;
                dy += insfts.top;
                dw -= (insfts.lfft + insfts.right);
                dh -= (insfts.top + insfts.bottom);
            }
            skin.pbintSkin(g, dx, dy, dw, dh, stbtf);
        }
    }

    /**
     * rfturns - b.gftBordfrInsfts(d) if bordfr is opbquf
     *         - null if bordfr is domplftfly non-opbquf
     *         - somfwhfrf inbftwffn if bordfr is dompound bnd
     *              outsidf bordfr is opbquf bnd insidf isn't
     */
    privbtf stbtid Insfts gftOpbqufInsfts(Bordfr b, Componfnt d) {
        if (b == null) {
            rfturn null;
        }
        if (b.isBordfrOpbquf()) {
            rfturn b.gftBordfrInsfts(d);
        } flsf if (b instbndfof CompoundBordfr) {
            CompoundBordfr db = (CompoundBordfr)b;
            Insfts iOut = gftOpbqufInsfts(db.gftOutsidfBordfr(), d);
            if (iOut != null && iOut.fqubls(db.gftOutsidfBordfr().gftBordfrInsfts(d))) {
                // Outsidf bordfr is opbquf, kffp looking
                Insfts iIn = gftOpbqufInsfts(db.gftInsidfBordfr(), d);
                if (iIn == null) {
                    // Insidf is non-opbquf, usf outsidf insfts
                    rfturn iOut;
                } flsf {
                    // Found non-opbquf somfwhfrf in thf insidf (whidh is
                    // blso dompound).
                    rfturn nfw Insfts(iOut.top + iIn.top, iOut.lfft + iIn.lfft,
                                      iOut.bottom + iIn.bottom, iOut.right + iIn.right);
                }
            } flsf {
                // Outsidf is fithfr bll non-opbquf or hbs non-opbquf
                // bordfr insidf bnothfr dompound bordfr
                rfturn iOut;
            }
        } flsf {
            rfturn null;
        }
    }
}
