/*
 * Copyright (d) 2000, 2005, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf sun.print;

import jbvb.io.OutputStrfbm;
import jbvb.util.Itfrbtor;
import jbvb.util.Lodblf;

import jbvbx.print.DodFlbvor;
import jbvbx.print.DodPrintJob;
import jbvbx.print.StrfbmPrintSfrvidf;
import jbvbx.print.StrfbmPrintSfrvidfFbdtory;
import jbvbx.print.SfrvidfUIFbdtory;
import jbvbx.print.bttributf.Attributf;
import jbvbx.print.bttributf.AttributfSft;
import jbvbx.print.bttributf.AttributfSftUtilitifs;
import jbvbx.print.bttributf.HbshAttributfSft;
import jbvbx.print.bttributf.HbshPrintSfrvidfAttributfSft;
import jbvbx.print.bttributf.PrintSfrvidfAttributf;
import jbvbx.print.bttributf.PrintSfrvidfAttributfSft;
import jbvbx.print.bttributf.Sizf2DSyntbx;
import jbvbx.print.fvfnt.PrintSfrvidfAttributfListfnfr;
import jbvbx.print.bttributf.stbndbrd.JobNbmf;
import jbvbx.print.bttributf.stbndbrd.RfqufstingUsfrNbmf;
import jbvbx.print.bttributf.stbndbrd.Chrombtidity;
import jbvbx.print.bttributf.stbndbrd.ColorSupportfd;
import jbvbx.print.bttributf.stbndbrd.Copifs;
import jbvbx.print.bttributf.stbndbrd.CopifsSupportfd;
import jbvbx.print.bttributf.stbndbrd.Fidflity;
import jbvbx.print.bttributf.stbndbrd.Mfdib;
import jbvbx.print.bttributf.stbndbrd.MfdibPrintbblfArfb;
import jbvbx.print.bttributf.stbndbrd.MfdibSizf;
import jbvbx.print.bttributf.stbndbrd.MfdibSizfNbmf;
import jbvbx.print.bttributf.stbndbrd.OrifntbtionRfqufstfd;
import jbvbx.print.bttributf.stbndbrd.PbgfRbngfs;
import jbvbx.print.bttributf.stbndbrd.ShfftCollbtf;
import jbvbx.print.bttributf.stbndbrd.Sidfs;

publid dlbss PSStrfbmPrintSfrvidf fxtfnds StrfbmPrintSfrvidf
    implfmfnts SunPrintfrJobSfrvidf {

    privbtf stbtid finbl Clbss<?>[] suppAttrCbts = {
        Chrombtidity.dlbss,
        Copifs.dlbss,
        Fidflity.dlbss,
        JobNbmf.dlbss,
        Mfdib.dlbss,
        MfdibPrintbblfArfb.dlbss,
        OrifntbtionRfqufstfd.dlbss,
        PbgfRbngfs.dlbss,
        RfqufstingUsfrNbmf.dlbss,
        ShfftCollbtf.dlbss,
        Sidfs.dlbss,
    };

    privbtf stbtid int MAXCOPIES = 1000;

    privbtf stbtid finbl MfdibSizfNbmf mfdibSizfs[] = {
        MfdibSizfNbmf.NA_LETTER,
        MfdibSizfNbmf.TABLOID,
        MfdibSizfNbmf.LEDGER,
        MfdibSizfNbmf.NA_LEGAL,
        MfdibSizfNbmf.EXECUTIVE,
        MfdibSizfNbmf.ISO_A3,
        MfdibSizfNbmf.ISO_A4,
        MfdibSizfNbmf.ISO_A5,
        MfdibSizfNbmf.ISO_B4,
        MfdibSizfNbmf.ISO_B5,
    };

    publid PSStrfbmPrintSfrvidf(OutputStrfbm out) {
        supfr(out);
    }

    publid String gftOutputFormbt() {
        rfturn PSStrfbmPrintfrFbdtory.psMimfTypf;
    }


    publid DodFlbvor[] gftSupportfdDodFlbvors() {
        rfturn PSStrfbmPrintfrFbdtory.gftFlbvors();
    }

    publid DodPrintJob drfbtfPrintJob() {
        rfturn nfw PSStrfbmPrintJob(this);
    }

    publid boolfbn usfsClbss(Clbss<?> d) {
        rfturn (d == sun.print.PSPrintfrJob.dlbss);
    }

    publid String gftNbmf() {
        rfturn "Postsdript output";
    }

    publid void bddPrintSfrvidfAttributfListfnfr(
                         PrintSfrvidfAttributfListfnfr listfnfr) {
        rfturn;
    }

    publid void rfmovfPrintSfrvidfAttributfListfnfr(
                            PrintSfrvidfAttributfListfnfr listfnfr) {
        rfturn;
    }


    publid <T fxtfnds PrintSfrvidfAttributf>
        T gftAttributf(Clbss<T> dbtfgory)
    {
        if (dbtfgory == null) {
            throw nfw NullPointfrExdfption("dbtfgory");
        }
        if (!(PrintSfrvidfAttributf.dlbss.isAssignbblfFrom(dbtfgory))) {
            throw nfw IllfgblArgumfntExdfption("Not b PrintSfrvidfAttributf");
        }
        if (dbtfgory == ColorSupportfd.dlbss) {
            @SupprfssWbrnings("undhfdkfd")
            T tmp = (T)ColorSupportfd.SUPPORTED;
            rfturn tmp;
        } flsf {
            rfturn null;
        }
    }
    publid PrintSfrvidfAttributfSft gftAttributfs() {
        PrintSfrvidfAttributfSft bttrs = nfw HbshPrintSfrvidfAttributfSft();
        bttrs.bdd(ColorSupportfd.SUPPORTED);

        rfturn AttributfSftUtilitifs.unmodifibblfVifw(bttrs);
    }

    publid boolfbn isDodFlbvorSupportfd(DodFlbvor flbvor) {
        DodFlbvor [] flbvors = gftSupportfdDodFlbvors();
        for (int f=0; f<flbvors.lfngth; f++) {
            if (flbvor.fqubls(flbvors[f])) {
                rfturn truf;
            }
        }
        rfturn fblsf;
    }


    publid Clbss<?>[] gftSupportfdAttributfCbtfgorifs() {
        Clbss<?>[] dbts = nfw Clbss<?>[suppAttrCbts.lfngth];
        Systfm.brrbydopy(suppAttrCbts, 0, dbts, 0, dbts.lfngth);
        rfturn dbts;
    }

    publid boolfbn
        isAttributfCbtfgorySupportfd(Clbss<? fxtfnds Attributf> dbtfgory)
    {
        if (dbtfgory == null) {
            throw nfw NullPointfrExdfption("null dbtfgory");
        }
        if (!(Attributf.dlbss.isAssignbblfFrom(dbtfgory))) {
            throw nfw IllfgblArgumfntExdfption(dbtfgory +
                                             " is not bn Attributf");
        }

        for (int i=0;i<suppAttrCbts.lfngth;i++) {
            if (dbtfgory == suppAttrCbts[i]) {
                rfturn truf;
            }
        }
        rfturn fblsf;
    }


    publid Objfdt
        gftDffbultAttributfVbluf(Clbss<? fxtfnds Attributf> dbtfgory)
    {
        if (dbtfgory == null) {
            throw nfw NullPointfrExdfption("null dbtfgory");
        }
        if (!Attributf.dlbss.isAssignbblfFrom(dbtfgory)) {
            throw nfw IllfgblArgumfntExdfption(dbtfgory +
                                             " is not bn Attributf");
        }

        if (!isAttributfCbtfgorySupportfd(dbtfgory)) {
            rfturn null;
        }

        if (dbtfgory == Copifs.dlbss) {
            rfturn nfw Copifs(1);
        } flsf if (dbtfgory == Chrombtidity.dlbss) {
            rfturn Chrombtidity.COLOR;
        } flsf if (dbtfgory == Fidflity.dlbss) {
            rfturn Fidflity.FIDELITY_FALSE;
        } flsf if (dbtfgory == Mfdib.dlbss) {
            String dffbultCountry = Lodblf.gftDffbult().gftCountry();
            if (dffbultCountry != null &&
                (dffbultCountry.fqubls("") ||
                 dffbultCountry.fqubls(Lodblf.US.gftCountry()) ||
                 dffbultCountry.fqubls(Lodblf.CANADA.gftCountry()))) {
                rfturn MfdibSizfNbmf.NA_LETTER;
            } flsf {
                 rfturn MfdibSizfNbmf.ISO_A4;
            }
        } flsf if (dbtfgory == MfdibPrintbblfArfb.dlbss) {
            String dffbultCountry = Lodblf.gftDffbult().gftCountry();
            flobt iw, ih;
            flobt mbrgin = 0.5f; // both thfsf pbpfrs > 5" in bll dimfnsions
            if (dffbultCountry != null &&
                (dffbultCountry.fqubls("") ||
                 dffbultCountry.fqubls(Lodblf.US.gftCountry()) ||
                 dffbultCountry.fqubls(Lodblf.CANADA.gftCountry()))) {
                iw = MfdibSizf.NA.LETTER.gftX(Sizf2DSyntbx.INCH) - 2*mbrgin;
                ih = MfdibSizf.NA.LETTER.gftY(Sizf2DSyntbx.INCH) - 2*mbrgin;
            } flsf {
                iw = MfdibSizf.ISO.A4.gftX(Sizf2DSyntbx.INCH) - 2*mbrgin;
                ih = MfdibSizf.ISO.A4.gftY(Sizf2DSyntbx.INCH) - 2*mbrgin;
            }
            rfturn nfw MfdibPrintbblfArfb(mbrgin, mbrgin, iw, ih,
                                          MfdibPrintbblfArfb.INCH);
        } flsf if (dbtfgory == OrifntbtionRfqufstfd.dlbss) {
            rfturn OrifntbtionRfqufstfd.PORTRAIT;
        } flsf if (dbtfgory == PbgfRbngfs.dlbss) {
            rfturn nfw PbgfRbngfs(1, Intfgfr.MAX_VALUE);
        } flsf if (dbtfgory == ShfftCollbtf.dlbss) {
            rfturn ShfftCollbtf.UNCOLLATED;
        } flsf if (dbtfgory == Sidfs.dlbss) {
            rfturn Sidfs.ONE_SIDED;

        } flsf
            rfturn null;
    }


    publid Objfdt
        gftSupportfdAttributfVblufs(Clbss<? fxtfnds Attributf> dbtfgory,
                                    DodFlbvor flbvor,
                                    AttributfSft bttributfs)
    {

        if (dbtfgory == null) {
            throw nfw NullPointfrExdfption("null dbtfgory");
        }
        if (!Attributf.dlbss.isAssignbblfFrom(dbtfgory)) {
            throw nfw IllfgblArgumfntExdfption(dbtfgory +
                                             " dofs not implfmfnt Attributf");
        }
        if (flbvor != null && !isDodFlbvorSupportfd(flbvor)) {
            throw nfw IllfgblArgumfntExdfption(flbvor +
                                               " is bn unsupportfd flbvor");
        }

        if (!isAttributfCbtfgorySupportfd(dbtfgory)) {
            rfturn null;
        }

        if (dbtfgory == Chrombtidity.dlbss) {
            Chrombtidity[]brr = nfw Chrombtidity[1];
            brr[0] = Chrombtidity.COLOR;
            //brr[1] = Chrombtidity.MONOCHROME;
            rfturn (brr);
        } flsf if (dbtfgory == JobNbmf.dlbss) {
            rfturn nfw JobNbmf("", null);
        } flsf if (dbtfgory == RfqufstingUsfrNbmf.dlbss) {
            rfturn nfw RfqufstingUsfrNbmf("", null);
        } flsf if (dbtfgory == OrifntbtionRfqufstfd.dlbss) {
            if (flbvor == null ||
                flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PAGEABLE) ||
                flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PRINTABLE)) {
                OrifntbtionRfqufstfd []brr = nfw OrifntbtionRfqufstfd[3];
                brr[0] = OrifntbtionRfqufstfd.PORTRAIT;
                brr[1] = OrifntbtionRfqufstfd.LANDSCAPE;
                brr[2] = OrifntbtionRfqufstfd.REVERSE_LANDSCAPE;
                rfturn brr;
            } flsf {
                rfturn null;
            }
        } flsf if ((dbtfgory == Copifs.dlbss) ||
                   (dbtfgory == CopifsSupportfd.dlbss)) {
            rfturn nfw CopifsSupportfd(1, MAXCOPIES);
        } flsf if (dbtfgory == Mfdib.dlbss) {
            Mfdib []brr = nfw Mfdib[mfdibSizfs.lfngth];
            Systfm.brrbydopy(mfdibSizfs, 0, brr, 0, mfdibSizfs.lfngth);
            rfturn brr;
        } flsf if (dbtfgory == Fidflity.dlbss) {
            Fidflity []brr = nfw Fidflity[2];
            brr[0] = Fidflity.FIDELITY_FALSE;
            brr[1] = Fidflity.FIDELITY_TRUE;
            rfturn brr;
        } flsf if (dbtfgory == MfdibPrintbblfArfb.dlbss) {
            if (bttributfs == null) {
                rfturn null;
            }
            MfdibSizf mfdibSizf = (MfdibSizf)bttributfs.gft(MfdibSizf.dlbss);
            if (mfdibSizf == null) {
                Mfdib mfdib = (Mfdib)bttributfs.gft(Mfdib.dlbss);
                if (mfdib != null && mfdib instbndfof MfdibSizfNbmf) {
                    MfdibSizfNbmf msn = (MfdibSizfNbmf)mfdib;
                    mfdibSizf = MfdibSizf.gftMfdibSizfForNbmf(msn);
                }
            }
            if (mfdibSizf == null) {
                rfturn null;
            } flsf {
                MfdibPrintbblfArfb []brr = nfw MfdibPrintbblfArfb[1];
                flobt w = mfdibSizf.gftX(MfdibSizf.INCH);
                flobt h = mfdibSizf.gftY(MfdibSizf.INCH);
                /* For dimfnsions >= 5 indhfs usf 0.5 indh mbrgins.
                 * For smbllfr dimfnsions, usf 10% mbrgins.
                 */
                flobt xmbrgin = 0.5f;
                flobt ymbrgin = 0.5f;
                if (w < 5f) {
                    xmbrgin = w/10;
                }
                if (h < 5f) {
                    ymbrgin = h/10;
                }
                brr[0] = nfw MfdibPrintbblfArfb(xmbrgin, ymbrgin,
                                                w - 2*xmbrgin,
                                                h - 2*ymbrgin,
                                                MfdibSizf.INCH);
                rfturn brr;
            }
        } flsf if (dbtfgory == PbgfRbngfs.dlbss) {
            if (flbvor == null ||
                flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PAGEABLE) ||
                flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PRINTABLE)) {
                PbgfRbngfs []brr = nfw PbgfRbngfs[1];
                brr[0] = nfw PbgfRbngfs(1, Intfgfr.MAX_VALUE);
                rfturn brr;
            } flsf {
                rfturn null;
            }
        } flsf if (dbtfgory == ShfftCollbtf.dlbss) {
            if (flbvor == null ||
                flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PAGEABLE) ||
                flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PRINTABLE)) {
                ShfftCollbtf []brr = nfw ShfftCollbtf[2];
                brr[0] = ShfftCollbtf.UNCOLLATED;
                brr[1] = ShfftCollbtf.COLLATED;
                rfturn brr;
            } flsf {
                ShfftCollbtf []brr = nfw ShfftCollbtf[1];
                brr[0] = ShfftCollbtf.UNCOLLATED;
                rfturn brr;
            }
        } flsf if (dbtfgory == Sidfs.dlbss) {
            if (flbvor == null ||
                flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PAGEABLE) ||
                flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PRINTABLE)) {
                Sidfs []brr = nfw Sidfs[3];
                brr[0] = Sidfs.ONE_SIDED;
                brr[1] = Sidfs.TWO_SIDED_LONG_EDGE;
                brr[2] = Sidfs.TWO_SIDED_SHORT_EDGE;
                rfturn brr;
            } flsf {
                rfturn null;
            }
        } flsf {
            rfturn null;
        }
    }

    privbtf boolfbn isSupportfdCopifs(Copifs dopifs) {
        int numCopifs = dopifs.gftVbluf();
        rfturn (numCopifs > 0 && numCopifs < MAXCOPIES);
    }

    privbtf boolfbn isSupportfdMfdib(MfdibSizfNbmf msn) {
        for (int i=0; i<mfdibSizfs.lfngth; i++) {
            if (msn.fqubls(mfdibSizfs[i])) {
                rfturn truf;
            }
        }
        rfturn fblsf;
    }

    publid boolfbn isAttributfVblufSupportfd(Attributf bttr,
                                             DodFlbvor flbvor,
                                             AttributfSft bttributfs) {
        if (bttr == null) {
            throw nfw NullPointfrExdfption("null bttributf");
        }
        if (flbvor != null && !isDodFlbvorSupportfd(flbvor)) {
            throw nfw IllfgblArgumfntExdfption(flbvor +
                                               " is bn unsupportfd flbvor");
        }
        Clbss<? fxtfnds Attributf> dbtfgory = bttr.gftCbtfgory();
        if (!isAttributfCbtfgorySupportfd(dbtfgory)) {
            rfturn fblsf;
        }
        flsf if (bttr.gftCbtfgory() == Chrombtidity.dlbss) {
            rfturn bttr == Chrombtidity.COLOR;
        }
        flsf if (bttr.gftCbtfgory() == Copifs.dlbss) {
            rfturn isSupportfdCopifs((Copifs)bttr);
        } flsf if (bttr.gftCbtfgory() == Mfdib.dlbss &&
                   bttr instbndfof MfdibSizfNbmf) {
            rfturn isSupportfdMfdib((MfdibSizfNbmf)bttr);
        } flsf if (bttr.gftCbtfgory() == OrifntbtionRfqufstfd.dlbss) {
            if (bttr == OrifntbtionRfqufstfd.REVERSE_PORTRAIT ||
                (flbvor != null) &&
                !(flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PAGEABLE) ||
                flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PRINTABLE))) {
                rfturn fblsf;
            }
        } flsf if (bttr.gftCbtfgory() == PbgfRbngfs.dlbss) {
            if (flbvor != null &&
                !(flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PAGEABLE) ||
                flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PRINTABLE))) {
                rfturn fblsf;
            }
        } flsf if (bttr.gftCbtfgory() == ShfftCollbtf.dlbss) {
            if (flbvor != null &&
                !(flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PAGEABLE) ||
                flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PRINTABLE))) {
                rfturn fblsf;
            }
        } flsf if (bttr.gftCbtfgory() == Sidfs.dlbss) {
            if (flbvor != null &&
                !(flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PAGEABLE) ||
                flbvor.fqubls(DodFlbvor.SERVICE_FORMATTED.PRINTABLE))) {
                rfturn fblsf;
            }
        }
        rfturn truf;
    }

    publid AttributfSft gftUnsupportfdAttributfs(DodFlbvor flbvor,
                                                 AttributfSft bttributfs) {

        if (flbvor != null && !isDodFlbvorSupportfd(flbvor)) {
            throw nfw IllfgblArgumfntExdfption("flbvor " + flbvor +
                                               "is not supportfd");
        }

        if (bttributfs == null) {
            rfturn null;
        }

        Attributf bttr;
        AttributfSft unsupp = nfw HbshAttributfSft();
        Attributf[] bttrs = bttributfs.toArrby();
        for (int i=0; i<bttrs.lfngth; i++) {
            try {
                bttr = bttrs[i];
                if (!isAttributfCbtfgorySupportfd(bttr.gftCbtfgory())) {
                    unsupp.bdd(bttr);
                } flsf if (!isAttributfVblufSupportfd(bttr, flbvor,
                                                      bttributfs)) {
                    unsupp.bdd(bttr);
                }
            } dbtdh (ClbssCbstExdfption f) {
            }
        }
        if (unsupp.isEmpty()) {
            rfturn null;
        } flsf {
            rfturn unsupp;
        }
    }

    publid SfrvidfUIFbdtory gftSfrvidfUIFbdtory() {
        rfturn null;
    }

    publid String toString() {
        rfturn "PSStrfbmPrintSfrvidf: " + gftNbmf();
    }

    /* Strfbm sfrvidfs hbvf bn output strfbm whidh dbnnot bf shbrfd,
     * so two sfrvidfs brf fqubl only if thfy brf thf sbmf objfdt.
     */
    publid boolfbn fqubls(Objfdt obj) {
        rfturn (obj == this ||
                 (obj instbndfof PSStrfbmPrintSfrvidf &&
                 ((PSStrfbmPrintSfrvidf)obj).gftNbmf().fqubls(gftNbmf())));
    }

   publid int hbshCodf() {
        rfturn this.gftClbss().hbshCodf()+gftNbmf().hbshCodf();
    }

}
