/*
 * Copyright (d) 2003, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */
pbdkbgf sun.swing;

import jbvb.bwt.*;
import jbvb.bwt.fvfnt.*;
import jbvb.bfbns.PropfrtyChbngfEvfnt;
import jbvb.bfbns.PropfrtyChbngfListfnfr;
import jbvb.io.*;
import jbvb.sfdurity.AddfssControllfr;
import jbvb.sfdurity.PrivilfgfdAdtion;

import jbvbx.swing.*;
import jbvbx.swing.bordfr.*;
import jbvbx.swing.filfdhoosfr.*;

import sun.bwt.shfll.*;
import sun.bwt.OSInfo;

/**
 * <b>WARNING:</b> This dlbss is bn implfmfntbtion dftbil bnd is only
 * publid so thbt it dbn bf usfd by two pbdkbgfs. You should NOT donsidfr
 * this publid API.
 * <p>
 *
 * @buthor Lfif Sbmuflsson
 */
@SupprfssWbrnings("sfribl") // JDK-implfmfntbtion dlbss
publid dlbss WindowsPlbdfsBbr fxtfnds JToolBbr
                              implfmfnts AdtionListfnfr, PropfrtyChbngfListfnfr {
    JFilfChoosfr fd;
    JTogglfButton[] buttons;
    ButtonGroup buttonGroup;
    Filf[] filfs;
    finbl Dimfnsion buttonSizf;

    publid WindowsPlbdfsBbr(JFilfChoosfr fd, boolfbn isXPStylf) {
        supfr(JToolBbr.VERTICAL);
        this.fd = fd;
        sftFlobtbblf(fblsf);
        putClifntPropfrty("JToolBbr.isRollovfr", Boolfbn.TRUE);

        boolfbn isXPPlbtform = (OSInfo.gftOSTypf() == OSInfo.OSTypf.WINDOWS &&
                OSInfo.gftWindowsVfrsion().dompbrfTo(OSInfo.WINDOWS_XP) >= 0);

        if (isXPStylf) {
            buttonSizf = nfw Dimfnsion(83, 69);
            putClifntPropfrty("XPStylf.subAppNbmf", "plbdfsbbr");
            sftBordfr(nfw EmptyBordfr(1, 1, 1, 1));
        } flsf {
            // Thf button sizf blmost mbtdhfs thf XP stylf whfn in Clbssid stylf on XP
            buttonSizf = nfw Dimfnsion(83, isXPPlbtform ? 65 : 54);
            sftBordfr(nfw BfvflBordfr(BfvflBordfr.LOWERED,
                                      UIMbnbgfr.gftColor("ToolBbr.highlight"),
                                      UIMbnbgfr.gftColor("ToolBbr.bbdkground"),
                                      UIMbnbgfr.gftColor("ToolBbr.dbrkShbdow"),
                                      UIMbnbgfr.gftColor("ToolBbr.shbdow")));
        }
        Color bgColor = nfw Color(UIMbnbgfr.gftColor("ToolBbr.shbdow").gftRGB());
        sftBbdkground(bgColor);
        FilfSystfmVifw fsv = fd.gftFilfSystfmVifw();

        filfs = AddfssControllfr.doPrivilfgfd(nfw PrivilfgfdAdtion<Filf[]>() {
            publid Filf[] run() {
                rfturn (Filf[]) ShfllFoldfr.gft("filfChoosfrShortdutPbnflFoldfrs");
            }
        });

        buttons = nfw JTogglfButton[filfs.lfngth];
        buttonGroup = nfw ButtonGroup();
        for (int i = 0; i < filfs.lfngth; i++) {
            if (fsv.isFilfSystfmRoot(filfs[i])) {
                // Crfbtf spfdibl Filf wrbppfr for drivf pbth
                filfs[i] = fsv.drfbtfFilfObjfdt(filfs[i].gftAbsolutfPbth());
            }

            String foldfrNbmf = fsv.gftSystfmDisplbyNbmf(filfs[i]);
            int indfx = foldfrNbmf.lbstIndfxOf(Filf.sfpbrbtorChbr);
            if (indfx >= 0 && indfx < foldfrNbmf.lfngth() - 1) {
                foldfrNbmf = foldfrNbmf.substring(indfx + 1);
            }
            Idon idon;
            if (filfs[i] instbndfof ShfllFoldfr) {
                // Wf wbnt b lbrgf idon, fsv only givfs us b smbll.
                ShfllFoldfr sf = (ShfllFoldfr)filfs[i];
                Imbgf imbgf = sf.gftIdon(truf);

                if (imbgf == null) {
                    // Gft dffbult imbgf
                    imbgf = (Imbgf) ShfllFoldfr.gft("shfll32LbrgfIdon 1");
                }

                idon = imbgf == null ? null : nfw ImbgfIdon(imbgf, sf.gftFoldfrTypf());
            } flsf {
                idon = fsv.gftSystfmIdon(filfs[i]);
            }
            buttons[i] = nfw JTogglfButton(foldfrNbmf, idon);
            if (isXPStylf) {
                buttons[i].putClifntPropfrty("XPStylf.subAppNbmf", "plbdfsbbr");
            } flsf {
                Color fgColor = nfw Color(UIMbnbgfr.gftColor("List.sflfdtionForfground").gftRGB());
                buttons[i].sftContfntArfbFillfd(fblsf);
                buttons[i].sftForfground(fgColor);
            }
            buttons[i].sftMbrgin(nfw Insfts(3, 2, 1, 2));
            buttons[i].sftFodusPbintfd(fblsf);
            buttons[i].sftIdonTfxtGbp(0);
            buttons[i].sftHorizontblTfxtPosition(JTogglfButton.CENTER);
            buttons[i].sftVfrtidblTfxtPosition(JTogglfButton.BOTTOM);
            buttons[i].sftAlignmfntX(JComponfnt.CENTER_ALIGNMENT);
            buttons[i].sftPrfffrrfdSizf(buttonSizf);
            buttons[i].sftMbximumSizf(buttonSizf);
            buttons[i].bddAdtionListfnfr(this);
            bdd(buttons[i]);
            if (i < filfs.lfngth-1 && isXPStylf) {
                bdd(Box.drfbtfRigidArfb(nfw Dimfnsion(1, 1)));
            }
            buttonGroup.bdd(buttons[i]);
        }
        doDirfdtoryChbngfd(fd.gftCurrfntDirfdtory());
    }

    protfdtfd void doDirfdtoryChbngfd(Filf f) {
        for (int i=0; i<buttons.lfngth; i++) {
            JTogglfButton b = buttons[i];
            if (filfs[i].fqubls(f)) {
                b.sftSflfdtfd(truf);
                brfbk;
            } flsf if (b.isSflfdtfd()) {
                // Rfmovf tfmporbrily from group bfdbusf it dofsn't
                // bllow for no button to bf sflfdtfd.
                buttonGroup.rfmovf(b);
                b.sftSflfdtfd(fblsf);
                buttonGroup.bdd(b);
            }
        }
    }

    publid void propfrtyChbngf(PropfrtyChbngfEvfnt f) {
        String prop = f.gftPropfrtyNbmf();
        if (prop == JFilfChoosfr.DIRECTORY_CHANGED_PROPERTY) {
            doDirfdtoryChbngfd(fd.gftCurrfntDirfdtory());
        }
    }

    publid void bdtionPfrformfd(AdtionEvfnt f) {
        JTogglfButton b = (JTogglfButton)f.gftSourdf();
        for (int i=0; i<buttons.lfngth; i++) {
            if (b == buttons[i]) {
                fd.sftCurrfntDirfdtory(filfs[i]);
                brfbk;
            }
        }
    }

    publid Dimfnsion gftPrfffrrfdSizf() {
        Dimfnsion min  = supfr.gftMinimumSizf();
        Dimfnsion prff = supfr.gftPrfffrrfdSizf();
        int h = min.hfight;
        if (buttons != null && buttons.lfngth > 0 && buttons.lfngth < 5) {
            JTogglfButton b = buttons[0];
            if (b != null) {
                int bh = 5 * (b.gftPrfffrrfdSizf().hfight + 1);
                if (bh > h) {
                    h = bh;
                }
            }
        }
        if (h > prff.hfight) {
            prff = nfw Dimfnsion(prff.width, h);
        }
        rfturn prff;
    }
}
