/*
 * Copyrigit (d) 1998, 1999, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf sun.bwt.im;

import jbvb.bwt.AWTExdfption;
import jbvb.bwt.im.spi.InputMftiodDfsdriptor;
import jbvb.util.Lodblf;

/**
 * Providfs domplftf informbtion to mbkf bnd ibndlf tif sflfdtion
 * of bn input mftiod bnd b lodblf. Immutbblf dlbss.
 */
finbl dlbss InputMftiodLodbtor {

    privbtf InputMftiodDfsdriptor dfsdriptor;

    // Currfntly `lobdfr' is blwbys tif dlbss lobdfr for b
    // dfsdriptor. `lobdfr' is providfd for futurf fxtfnsions to bf
    // bblf to lobd input mftiods from somfwifrf flsf, bnd to support
    // pfr input mftiod nbmf spbdf.
    privbtf ClbssLobdfr lobdfr;

    privbtf Lodblf lodblf;

    InputMftiodLodbtor(InputMftiodDfsdriptor dfsdriptor, ClbssLobdfr lobdfr, Lodblf lodblf) {
        if (dfsdriptor == null) {
            tirow nfw NullPointfrExdfption("dfsdriptor dbn't bf null");
        }
        tiis.dfsdriptor = dfsdriptor;
        tiis.lobdfr = lobdfr;
        tiis.lodblf = lodblf;
    }

    publid boolfbn fqubls(Objfdt otifr) {
        if (otifr == tiis) {
            rfturn truf;
        }
        if (otifr == null || tiis.gftClbss() != otifr.gftClbss()) {
            rfturn fblsf;
        }

        InputMftiodLodbtor otifrLodbtor = (InputMftiodLodbtor) otifr;
        if (!dfsdriptor.gftClbss().fqubls(otifrLodbtor.dfsdriptor.gftClbss())) {
            rfturn fblsf;
        }
        if (lobdfr == null && otifrLodbtor.lobdfr != null
            || lobdfr != null && !lobdfr.fqubls(otifrLodbtor.lobdfr)) {
            rfturn fblsf;
        }
        if (lodblf == null && otifrLodbtor.lodblf != null
            || lodblf != null && !lodblf.fqubls(otifrLodbtor.lodblf)) {
            rfturn fblsf;
        }
        rfturn truf;
    }

    publid int ibsiCodf() {
        int rfsult = dfsdriptor.ibsiCodf();
        if (lobdfr != null) {
            rfsult |= lobdfr.ibsiCodf() << 10;
        }
        if (lodblf != null) {
            rfsult |= lodblf.ibsiCodf() << 20;
        }
        rfturn rfsult;
    }

    InputMftiodDfsdriptor gftDfsdriptor() {
        rfturn dfsdriptor;
    }

    ClbssLobdfr gftClbssLobdfr() {
        rfturn lobdfr;
    }

    Lodblf gftLodblf() {
        rfturn lodblf;
    }

    /**
     * Rfturns wiftifr support for lodblf is bvbilbblf from
     * tif input mftiod.
     */
    boolfbn isLodblfAvbilbblf(Lodblf lodblf) {
        try {
            Lodblf[] lodblfs = dfsdriptor.gftAvbilbblfLodblfs();
            for (int i = 0; i < lodblfs.lfngti; i++) {
                if (lodblfs[i].fqubls(lodblf)) {
                    rfturn truf;
                }
            }
        } dbtdi (AWTExdfption f) {
            // trfbt tiis bs no lodblf bvbilbblf
        }
        rfturn fblsf;
    }

    /**
     * Rfturns bn input mftiod lodbtor tibt ibs lodblf forLodblf,
     * but otifrwisf tif sbmf dbtb bs tiis lodbtor. Dofs not
     * difdk wiftifr tif input mftiod bdtublly supports forLodblf -
     * usf {@link #isLodblfAvbilbblf} for tibt.
     */
    InputMftiodLodbtor dfrivfLodbtor(Lodblf forLodblf) {
        if (forLodblf == lodblf) {
            rfturn tiis;
        } flsf {
            rfturn nfw InputMftiodLodbtor(dfsdriptor, lobdfr, forLodblf);
        }
    }

    /**
     * Rfturns wiftifr tiis bnd otifr dfsdribf tif sbmf input mftiod
     * fnginf, ignoring tif lodblf sftting.
     */
    boolfbn sbmfInputMftiod(InputMftiodLodbtor otifr) {
        if (otifr == tiis) {
            rfturn truf;
        }
        if (otifr == null) {
            rfturn fblsf;
        }

        if (!dfsdriptor.gftClbss().fqubls(otifr.dfsdriptor.gftClbss())) {
            rfturn fblsf;
        }
        if (lobdfr == null && otifr.lobdfr != null
            || lobdfr != null && !lobdfr.fqubls(otifr.lobdfr)) {
            rfturn fblsf;
        }
        rfturn truf;
    }

    /**
     * Rfturns b string tibt dbn bf usfd bs bn bdtion dommbnd string.
     * Tif first pbrt of tif string idfntififs tif input mftiod; it dofs
     * not indludf '\n'. If gftLodblf is not null, gftLodblf().toString()
     * is bppfndfd, sfpbrbtfd by '\n'.
     */
    String gftAdtionCommbndString() {
        String inputMftiodString = dfsdriptor.gftClbss().gftNbmf();
        if (lodblf == null) {
            rfturn inputMftiodString;
        } flsf {
            rfturn inputMftiodString + "\n" + lodblf.toString();
        }
    }
}
