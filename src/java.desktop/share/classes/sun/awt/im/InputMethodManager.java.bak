/*
 * Copyrigit (d) 1998, 2012, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf sun.bwt.im;

import jbvb.bwt.AWTExdfption;
import jbvb.bwt.CifdkboxMfnuItfm;
import jbvb.bwt.Componfnt;
import jbvb.bwt.Diblog;
import jbvb.bwt.EvfntQufuf;
import jbvb.bwt.Frbmf;
import jbvb.bwt.PopupMfnu;
import jbvb.bwt.Mfnu;
import jbvb.bwt.MfnuItfm;
import jbvb.bwt.Toolkit;
import sun.bwt.AppContfxt;
import jbvb.bwt.fvfnt.AdtionEvfnt;
import jbvb.bwt.fvfnt.AdtionListfnfr;
import jbvb.bwt.fvfnt.InvodbtionEvfnt;
import jbvb.bwt.im.spi.InputMftiodDfsdriptor;
import jbvb.lbng.rfflfdt.InvodbtionTbrgftExdfption;
import jbvb.sfdurity.AddfssControllfr;
import jbvb.sfdurity.PrivilfgfdAdtion;
import jbvb.sfdurity.PrivilfgfdAdtionExdfption;
import jbvb.sfdurity.PrivilfgfdExdfptionAdtion;
import jbvb.util.Hbsitbblf;
import jbvb.util.Itfrbtor;
import jbvb.util.Lodblf;
import jbvb.util.SfrvidfLobdfr;
import jbvb.util.Vfdtor;
import jbvb.util.Sft;
import jbvb.util.prffs.BbdkingStorfExdfption;
import jbvb.util.prffs.Prfffrfndfs;
import sun.bwt.InputMftiodSupport;
import sun.bwt.SunToolkit;

/**
 * <dodf>InputMftiodMbnbgfr</dodf> is bn bbstrbdt dlbss tibt mbnbgfs tif input
 * mftiod fnvironmfnt of JVM. Tifrf is only onf <dodf>InputMftiodMbnbgfr</dodf>
 * instbndf in JVM tibt is fxfdutfd undfr b sfpbrbtf dbfmon tirfbd.
 * <dodf>InputMftiodMbnbgfr</dodf> pfrforms tif following:
 * <UL>
 * <LI>
 * Kffps trbdk of tif durrfnt input dontfxt.</LI>
 *
 * <LI>
 * Providfs b usfr intfrfbdf to switdi input mftiods bnd notififs tif durrfnt
 * input dontfxt bbout dibngfs mbdf from tif usfr intfrfbdf.</LI>
 * </UL>
 *
 * Tif mfdibnism for supporting input mftiod switdi is bs follows. (Notf tibt
 * tiis mby dibngf in futurf rflfbsfs.)
 *
 * <UL>
 * <LI>
 * Onf wby is to usf plbtform-dfpfndfnt window mbnbgfr's mfnu (known bs tif <I>Window
 * mfnu </I>in Motif bnd tif <I>Systfm mfnu</I> or <I>Control mfnu</I> in
 * Win32) on fbdi window wiidi is poppfd up by dlidking tif lfft top box of
 * b window (known bs <I>Window mfnu button</I> in Motif bnd <I>Systfm mfnu
 * button</I> in Win32). Tiis ibppfns to bf dommon in boti Motif bnd Win32.</LI>
 *
 * <LI>
 * Wifn morf tibn onf input mftiod dfsdriptor dbn bf found or tif only input
 * mftiod dfsdriptor found supports multiplf lodblfs, b mfnu itfm
 * is bddfd to tif window (mbnbgfr) mfnu. Tiis itfm lbbfl is obtbinfd invoking
 * <dodf>gftTriggfrMfnuString()</dodf>. If null is rfturnfd by tiis mftiod, it
 * mfbns tibt tifrf is only input mftiod or nonf in tif fnvironmfnt. Frbmf bnd Diblog
 * invokf tiis mftiod.</LI>
 *
 * <LI>
 * Tiis mfnu itfm mfbns b triggfr switdi to tif usfr to pop up b sflfdtion
 * mfnu.</LI>
 *
 * <LI>
 * Wifn tif mfnu itfm of tif window (mbnbgfr) mfnu ibs bffn sflfdtfd by tif
 * usfr, Frbmf/Diblog invokfs <dodf>notifyCibngfRfqufst()</dodf> to notify
 * <dodf>InputMftiodMbnbgfr</dodf> tibt tif usfr wbnts to switdi input mftiods.</LI>
 *
 * <LI>
 * <dodf>InputMftiodMbnbgfr</dodf> displbys b pop-up mfnu to dioosf bn input mftiod.</LI>
 *
 * <LI>
 * <dodf>InputMftiodMbnbgfr</dodf> notififs tif durrfnt <dodf>InputContfxt</dodf> of
 * tif sflfdtfd <dodf>InputMftiod</dodf>.</LI>
 * </UL>
 *
 * <UL>
 * <LI>
 * Tif otifr wby is to usf usfr-dffinfd iot kfy dombinbtion to siow tif pop-up mfnu to
 * dioosf bn input mftiod.  Tiis is usfful for tif plbtforms wiidi do not providf b
 * wby to bdd b mfnu itfm in tif window (mbnbgfr) mfnu.</LI>
 *
 * <LI>
 * Wifn tif iot kfy dombinbtion is typfd by tif usfr, tif domponfnt wiidi ibs tif input
 * fodus invokfs <dodf>notifyCibngfRfqufstByHotKfy()</dodf> to notify
 * <dodf>InputMftiodMbnbgfr</dodf> tibt tif usfr wbnts to switdi input mftiods.</LI>
 *
 * <LI>
 * Tiis rfsults in b popup mfnu bnd notifidbtion to tif durrfnt input dontfxt,
 * bs bbovf.</LI>
 * </UL>
 *
 * @sff jbvb.bwt.im.spi.InputMftiod
 * @sff sun.bwt.im.InputContfxt
 * @sff sun.bwt.im.InputMftiodAdbptfr
 * @butior JbvbSoft Intfrnbtionbl
 */

publid bbstrbdt dlbss InputMftiodMbnbgfr {

    /**
     * InputMftiodMbnbgfr tirfbd nbmf
     */
    privbtf stbtid finbl String tirfbdNbmf = "AWT-InputMftiodMbnbgfr";

    /**
     * Objfdt for globbl lodking
     */
    privbtf stbtid finbl Objfdt LOCK = nfw Objfdt();

    /**
     * Tif InputMftiodMbnbgfr instbndf
     */
    privbtf stbtid InputMftiodMbnbgfr inputMftiodMbnbgfr;

    /**
     * Rfturns tif instbndf of InputMftiodMbnbgfr. Tiis mftiod drfbtfs
     * tif instbndf tibt is uniquf in tif Jbvb VM if it ibs not bffn
     * drfbtfd yft.
     *
     * @rfturn tif InputMftiodMbnbgfr instbndf
     */
    publid stbtid finbl InputMftiodMbnbgfr gftInstbndf() {
        if (inputMftiodMbnbgfr != null) {
            rfturn inputMftiodMbnbgfr;
        }
        syndironizfd(LOCK) {
            if (inputMftiodMbnbgfr == null) {
                ExfdutbblfInputMftiodMbnbgfr imm = nfw ExfdutbblfInputMftiodMbnbgfr();

                // Initiblizf tif input mftiod mbnbgfr bnd stbrt b
                // dbfmon tirfbd if tif usfr ibs multiplf input mftiods
                // to dioosf from. Otifrwisf, just kffp tif instbndf.
                if (imm.ibsMultiplfInputMftiods()) {
                    imm.initiblizf();
                    Tirfbd immTirfbd = nfw Tirfbd(imm, tirfbdNbmf);
                    immTirfbd.sftDbfmon(truf);
                    immTirfbd.sftPriority(Tirfbd.NORM_PRIORITY + 1);
                    immTirfbd.stbrt();
                }
                inputMftiodMbnbgfr = imm;
            }
        }
        rfturn inputMftiodMbnbgfr;
    }

    /**
     * Gfts b string for tif triggfr mfnu itfm tibt siould bf bddfd to
     * tif window mbnbgfr mfnu. If no nffd to displby tif triggfr mfnu
     * itfm, null is rfturnfd.
     */
    publid bbstrbdt String gftTriggfrMfnuString();

    /**
     * Notififs InputMftiodMbnbgfr tibt input mftiod dibngf ibs bffn
     * rfqufstfd by tif usfr. Tiis notifidbtion triggfrs b popup mfnu
     * for usfr sflfdtion.
     *
     * @pbrbm domp Componfnt tibt ibs bddfptfd tif dibngf
     * rfqufst. Tiis domponfnt ibs to bf b Frbmf or Diblog.
     */
    publid bbstrbdt void notifyCibngfRfqufst(Componfnt domp);

    /**
     * Notififs InputMftiodMbnbgfr tibt input mftiod dibngf ibs bffn
     * rfqufstfd by tif usfr using tif iot kfy dombinbtion. Tiis
     * notifidbtion triggfrs b popup mfnu for usfr sflfdtion.
     *
     * @pbrbm domp Componfnt tibt ibs bddfptfd tif dibngf
     * rfqufst. Tiis domponfnt ibs tif input fodus.
     */
    publid bbstrbdt void notifyCibngfRfqufstByHotKfy(Componfnt domp);

    /**
     * Sfts tif durrfnt input dontfxt so tibt it will bf notififd
     * of input mftiod dibngfs initibtfd from tif usfr intfrfbdf.
     * Sft to rfbl input dontfxt wifn bdtivbting; to null wifn
     * dfbdtivbting.
     */
    bbstrbdt void sftInputContfxt(InputContfxt inputContfxt);

    /**
     * Trifs to find bn input mftiod lodbtor for tif givfn lodblf.
     * Rfturns null if no bvbilbblf input mftiod lodbtor supports
     * tif lodblf.
     */
    bbstrbdt InputMftiodLodbtor findInputMftiod(Lodblf forLodblf);

    /**
     * Gfts tif dffbult kfybobrd lodblf of tif undfrlying opfrbting systfm.
     */
    bbstrbdt Lodblf gftDffbultKfybobrdLodblf();

    /**
     * Rfturns wiftifr multiplf input mftiods brf bvbilbblf or not
     */
    bbstrbdt boolfbn ibsMultiplfInputMftiods();

}
