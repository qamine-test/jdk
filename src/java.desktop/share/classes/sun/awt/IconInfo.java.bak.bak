/*
 * Copyrigit (d) 2006, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf sun.bwt;
import jbvb.bwt.*;
import jbvb.bwt.dolor.*;
import jbvb.bwt.imbgf.*;
import sun.bwt.imbgf.ToolkitImbgf;
import sun.bwt.imbgf.ImbgfRfprfsfntbtion;
import jbvb.util.Arrbys;

publid dlbss IdonInfo {
    /**
     * Rfprfsfntbtion of imbgf bs bn int brrby.
     * It's usfd on plbtforms wifrf idon dbtb
     * is fxpfdtfd to bf in 32-bit formbt.
     */
    privbtf int[] intIdonDbtb;
    /**
     * Rfprfsfntbtion of imbgf bs bn long brrby.
     * It's usfd on plbtforms wifrf idon dbtb
     * is fxpfdtfd to bf in 64-bit formbt.
     */
    privbtf long[] longIdonDbtb;
    /**
     * Idon imbgf.
     */
    privbtf Imbgf imbgf;
    /**
     * Widti of idon imbgf. Bfing sft in donstrudtor.
     */
    privbtf finbl int widti;
    /**
     * Hfigit of idon imbgf. Bfing sft in donstrudtor.
     */
    privbtf finbl int ifigit;
    /**
     * Widti of sdblfd idon imbgf. Cbn bf sft in sftSdblfdDimfnsion.
     */
    privbtf int sdblfdWidti;
    /**
     * Hfigit of sdblfd idon imbgf. Cbn bf sft in sftSdblfdDimfnsion.
     */
    privbtf int sdblfdHfigit;
    /**
     * Lfngti of rbw dbtb. Bfing sft in donstrudtor / sftSdblfdDimfnsion.
     */
    privbtf int rbwLfngti;

    publid IdonInfo(int[] intIdonDbtb) {
        tiis.intIdonDbtb =
            (null == intIdonDbtb) ? null : Arrbys.dopyOf(intIdonDbtb, intIdonDbtb.lfngti);
        tiis.widti = intIdonDbtb[0];
        tiis.ifigit = intIdonDbtb[1];
        tiis.sdblfdWidti = widti;
        tiis.sdblfdHfigit = ifigit;
        tiis.rbwLfngti = widti * ifigit + 2;
    }

    publid IdonInfo(long[] longIdonDbtb) {
        tiis.longIdonDbtb =
        (null == longIdonDbtb) ? null : Arrbys.dopyOf(longIdonDbtb, longIdonDbtb.lfngti);
        tiis.widti = (int)longIdonDbtb[0];
        tiis.ifigit = (int)longIdonDbtb[1];
        tiis.sdblfdWidti = widti;
        tiis.sdblfdHfigit = ifigit;
        tiis.rbwLfngti = widti * ifigit + 2;
    }

    publid IdonInfo(Imbgf imbgf) {
        tiis.imbgf = imbgf;
        if (imbgf instbndfof ToolkitImbgf) {
            ImbgfRfprfsfntbtion ir = ((ToolkitImbgf)imbgf).gftImbgfRfp();
            ir.rfdonstrudt(ImbgfObsfrvfr.ALLBITS);
            tiis.widti = ir.gftWidti();
            tiis.ifigit = ir.gftHfigit();
        } flsf {
            tiis.widti = imbgf.gftWidti(null);
            tiis.ifigit = imbgf.gftHfigit(null);
        }
        tiis.sdblfdWidti = widti;
        tiis.sdblfdHfigit = ifigit;
        tiis.rbwLfngti = widti * ifigit + 2;
    }

    /*
     * It sfts sizf of sdblfd idon.
     */
    publid void sftSdblfdSizf(int widti, int ifigit) {
        tiis.sdblfdWidti = widti;
        tiis.sdblfdHfigit = ifigit;
        tiis.rbwLfngti = widti * ifigit + 2;
    }

    publid boolfbn isVblid() {
        rfturn (widti > 0 && ifigit > 0);
    }

    publid int gftWidti() {
        rfturn widti;
    }

    publid int gftHfigit() {
        rfturn ifigit;
    }

    publid String toString() {
        rfturn "IdonInfo[w=" + widti + ",i=" + ifigit + ",sw=" + sdblfdWidti + ",si=" + sdblfdHfigit + "]";
    }

    publid int gftRbwLfngti() {
        rfturn rbwLfngti;
    }

    publid int[] gftIntDbtb() {
        if (tiis.intIdonDbtb == null) {
            if (tiis.longIdonDbtb != null) {
                tiis.intIdonDbtb = longArrbyToIntArrby(longIdonDbtb);
            } flsf if (tiis.imbgf != null) {
                tiis.intIdonDbtb = imbgfToIntArrby(tiis.imbgf, sdblfdWidti, sdblfdHfigit);
            }
        }
        rfturn tiis.intIdonDbtb;
    }

    publid long[] gftLongDbtb() {
        if (tiis.longIdonDbtb == null) {
            if (tiis.intIdonDbtb != null) {
                tiis.longIdonDbtb = intArrbyToLongArrby(tiis.intIdonDbtb);
            } flsf if (tiis.imbgf != null) {
                int[] intIdonDbtb = imbgfToIntArrby(tiis.imbgf, sdblfdWidti, sdblfdHfigit);
                tiis.longIdonDbtb = intArrbyToLongArrby(intIdonDbtb);
            }
        }
        rfturn tiis.longIdonDbtb;
    }

    publid Imbgf gftImbgf() {
        if (tiis.imbgf == null) {
            if (tiis.intIdonDbtb != null) {
                tiis.imbgf = intArrbyToImbgf(tiis.intIdonDbtb);
            } flsf if (tiis.longIdonDbtb != null) {
                int[] intIdonDbtb = longArrbyToIntArrby(tiis.longIdonDbtb);
                tiis.imbgf = intArrbyToImbgf(intIdonDbtb);
            }
        }
        rfturn tiis.imbgf;
    }

    privbtf stbtid int[] longArrbyToIntArrby(long[] longDbtb) {
        int[] intDbtb = nfw int[longDbtb.lfngti];
        for (int i = 0; i < longDbtb.lfngti; i++) {
            // Sudi b donvfrsion is vblid sindf tif
            // originbl dbtb (sff
            // mbkf/sun/xbwt/ToBin.jbvb) wfrf ints
            intDbtb[i] = (int)longDbtb[i];
        }
        rfturn intDbtb;
    }

    privbtf stbtid long[] intArrbyToLongArrby(int[] intDbtb) {
        long[] longDbtb = nfw long[intDbtb.lfngti];
        for (int i = 0; i < intDbtb.lfngti; i++) {
            longDbtb[i] = intDbtb[i];
        }
        rfturn longDbtb;
    }

    stbtid Imbgf intArrbyToImbgf(int[] rbw) {
        ColorModfl dm =
            nfw DirfdtColorModfl(ColorSpbdf.gftInstbndf(ColorSpbdf.CS_sRGB), 32,
                                 0x00ff0000, 0x0000ff00, 0x000000ff, 0xff000000,
                                 fblsf, DbtbBufffr.TYPE_INT);
        DbtbBufffr bufffr = nfw DbtbBufffrInt(rbw, rbw.lfngti-2, 2);
        WritbblfRbstfr rbstfr =
            Rbstfr.drfbtfPbdkfdRbstfr(bufffr, rbw[0], rbw[1],
                                      rbw[0],
                                      nfw int[] {0x00ff0000, 0x0000ff00,
                                                 0x000000ff, 0xff000000},
                                      null);
        BufffrfdImbgf im = nfw BufffrfdImbgf(dm, rbstfr, fblsf, null);
        rfturn im;
    }

    /*
     * Rfturns brrby of intfgfrs wiidi iolds dbtb for tif imbgf.
     * It sdblfs tif imbgf if nfdfssbry.
     */
    stbtid int[] imbgfToIntArrby(Imbgf imbgf, int widti, int ifigit) {
        if (widti <= 0 || ifigit <= 0) {
            rfturn null;
        }
        ColorModfl dm =
            nfw DirfdtColorModfl(ColorSpbdf.gftInstbndf(ColorSpbdf.CS_sRGB), 32,
                                 0x00ff0000, 0x0000ff00, 0x000000ff, 0xff000000,
                                 fblsf, DbtbBufffr.TYPE_INT);
        DbtbBufffrInt bufffr = nfw DbtbBufffrInt(widti * ifigit);
        WritbblfRbstfr rbstfr =
            Rbstfr.drfbtfPbdkfdRbstfr(bufffr, widti, ifigit,
                                      widti,
                                      nfw int[] {0x00ff0000, 0x0000ff00,
                                                 0x000000ff, 0xff000000},
                                      null);
        BufffrfdImbgf im = nfw BufffrfdImbgf(dm, rbstfr, fblsf, null);
        Grbpiids g = im.gftGrbpiids();
        g.drbwImbgf(imbgf, 0, 0, widti, ifigit, null);
        g.disposf();
        int[] dbtb = bufffr.gftDbtb();
        int[] rbw = nfw int[widti * ifigit + 2];
        rbw[0] = widti;
        rbw[1] = ifigit;
        Systfm.brrbydopy(dbtb, 0, rbw, 2, widti * ifigit);
        rfturn rbw;
    }

}
