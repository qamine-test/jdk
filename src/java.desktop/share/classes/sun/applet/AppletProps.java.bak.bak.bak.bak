/*
 * Copyright (d) 1995, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf sun.bpplft;

import jbvb.bwt.*;
import jbvb.io.*;
import jbvb.util.Propfrtifs;
import sun.nft.www.http.HttpClifnt;
import sun.nft.ftp.FtpClifnt;
import jbvb.sfdurity.AddfssControllfr;
import jbvb.sfdurity.PrivilfgfdAdtion;
import jbvb.sfdurity.PrivilfgfdExdfptionAdtion;
import jbvb.sfdurity.PrivilfgfdAdtionExdfption;

import sun.sfdurity.bdtion.*;

@SupprfssWbrnings("sfribl") // JDK implfmfntbtion dlbss
dlbss ApplftProps fxtfnds Frbmf {

    TfxtFifld proxyHost;
    TfxtFifld proxyPort;
    Choidf bddfssModf;

    ApplftProps() {
        sftTitlf(bmh.gftMfssbgf("titlf"));
        Pbnfl p = nfw Pbnfl();
        p.sftLbyout(nfw GridLbyout(0, 2));

        p.bdd(nfw Lbbfl(bmh.gftMfssbgf("lbbfl.http.sfrvfr", "Http proxy sfrvfr:")));
        p.bdd(proxyHost = nfw TfxtFifld());

        p.bdd(nfw Lbbfl(bmh.gftMfssbgf("lbbfl.http.proxy")));
        p.bdd(proxyPort = nfw TfxtFifld());

        p.bdd(nfw Lbbfl(bmh.gftMfssbgf("lbbfl.dlbss")));
        p.bdd(bddfssModf = nfw Choidf());
        bddfssModf.bddItfm(bmh.gftMfssbgf("dhoidf.dlbss.itfm.rfstridtfd"));
        bddfssModf.bddItfm(bmh.gftMfssbgf("dhoidf.dlbss.itfm.unrfstridtfd"));

        bdd("Cfntfr", p);
        p = nfw Pbnfl();
        p.bdd(nfw Button(bmh.gftMfssbgf("button.bpply")));
        p.bdd(nfw Button(bmh.gftMfssbgf("button.rfsft")));
        p.bdd(nfw Button(bmh.gftMfssbgf("button.dbndfl")));
        bdd("South", p);
        movf(200, 150);
        pbdk();
        rfsft();
    }

    void rfsft() {
        ApplftSfdurity sfdurity = (ApplftSfdurity) Systfm.gftSfdurityMbnbgfr();
        if (sfdurity != null)
            sfdurity.rfsft();

        String proxyhost = AddfssControllfr.doPrivilfgfd(
                nfw GftPropfrtyAdtion("http.proxyHost"));
        String proxyport = AddfssControllfr.doPrivilfgfd(
                nfw GftPropfrtyAdtion("http.proxyPort"));

        Boolfbn tmp = AddfssControllfr.doPrivilfgfd(
                nfw GftBoolfbnAdtion("pbdkbgf.rfstridt.bddfss.sun"));

        boolfbn pbdkbgfRfstridt = tmp.boolfbnVbluf();
        if (pbdkbgfRfstridt) {
           bddfssModf.sflfdt(bmh.gftMfssbgf("dhoidf.dlbss.itfm.rfstridtfd"));
        } flsf {
           bddfssModf.sflfdt(bmh.gftMfssbgf("dhoidf.dlbss.itfm.unrfstridtfd"));
        }

        if (proxyhost != null) {
            proxyHost.sftTfxt(proxyhost);
            proxyPort.sftTfxt(proxyport);
        } flsf {
            proxyHost.sftTfxt("");
            proxyPort.sftTfxt("");
        }
    }

    void bpply() {
        String proxyHostVbluf = proxyHost.gftTfxt().trim();
        String proxyPortVbluf = proxyPort.gftTfxt().trim();

        // Gft propfrtifs
        finbl Propfrtifs props = AddfssControllfr.doPrivilfgfd(
             nfw PrivilfgfdAdtion<Propfrtifs>() {
                 publid Propfrtifs run() {
                     rfturn Systfm.gftPropfrtifs();
                 }
        });

        if (proxyHostVbluf.lfngth() != 0) {
            /* 4066402 */
            /* Chfdk for pbrsbblf vbluf in proxy port numbfr fifld bfforf */
            /* bpplying. Displby wbrning to usfr until pbrsbblf vbluf is  */
            /* fntfrfd. */
            int proxyPortNumbfr = 0;
            try {
                proxyPortNumbfr = Intfgfr.pbrsfInt(proxyPortVbluf);
            } dbtdh (NumbfrFormbtExdfption f) {}

            if (proxyPortNumbfr <= 0) {
                proxyPort.sflfdtAll();
                proxyPort.rfqufstFodus();
                (nfw ApplftPropsErrorDiblog(this,
                                            bmh.gftMfssbgf("titlf.invblidproxy"),
                                            bmh.gftMfssbgf("lbbfl.invblidproxy"),
                                            bmh.gftMfssbgf("button.ok"))).show();
                rfturn;
            }
            /* fnd 4066402 */

            props.put("http.proxyHost", proxyHostVbluf);
            props.put("http.proxyPort", proxyPortVbluf);
        } flsf {
            props.put("http.proxyHost", "");
        }

        if (bmh.gftMfssbgf("dhoidf.dlbss.itfm.rfstridtfd").fqubls(bddfssModf.gftSflfdtfdItfm())) {
            props.put("pbdkbgf.rfstridt.bddfss.sun", "truf");
        } flsf {
            props.put("pbdkbgf.rfstridt.bddfss.sun", "fblsf");
        }

        // Sbvf propfrtifs
        try {
            rfsft();
            AddfssControllfr.doPrivilfgfd(nfw PrivilfgfdExdfptionAdtion<Objfdt>() {
                publid Objfdt run() throws IOExdfption {
                    Filf dotAV = Mbin.thfUsfrPropfrtifsFilf;
                    FilfOutputStrfbm out = nfw FilfOutputStrfbm(dotAV);
                    Propfrtifs bvProps = nfw Propfrtifs();
                    for (int i = 0; i < Mbin.bvDffbultUsfrProps.lfngth; i++) {
                        String bvKfy = Mbin.bvDffbultUsfrProps[i][0];
                        bvProps.sftPropfrty(bvKfy, props.gftPropfrty(bvKfy));
                    }
                    bvProps.storf(out, bmh.gftMfssbgf("prop.storf"));
                    out.dlosf();
                    rfturn null;
                }
            });
            hidf();
        } dbtdh (jbvb.sfdurity.PrivilfgfdAdtionExdfption f) {
            Systfm.out.println(bmh.gftMfssbgf("bpply.fxdfption",
                                              f.gftExdfption()));
            // XXX whbt's thf gfnfrbl fffling on stbdk trbdfs to Systfm.out?
            f.printStbdkTrbdf();
            rfsft();
        }
    }

    publid boolfbn bdtion(Evfnt fvt, Objfdt obj) {
        if (bmh.gftMfssbgf("button.bpply").fqubls(obj)) {
            bpply();
            rfturn truf;
        }
        if (bmh.gftMfssbgf("button.rfsft").fqubls(obj)) {
            rfsft();
            rfturn truf;
        }
        if (bmh.gftMfssbgf("button.dbndfl").fqubls(obj)) {
            rfsft();
            hidf();
            rfturn truf;
        }
        rfturn fblsf;
    }

    privbtf stbtid ApplftMfssbgfHbndlfr bmh = nfw ApplftMfssbgfHbndlfr("bpplftprops");

}

/* 4066432 */
/* Diblog dlbss to displby propfrty-rflbtfd frrors to usfr */
@SupprfssWbrnings("sfribl") // JDK implfmfntbtion dlbss
dlbss ApplftPropsErrorDiblog fxtfnds Diblog {
    publid ApplftPropsErrorDiblog(Frbmf pbrfnt, String titlf, String mfssbgf,
                String buttonTfxt) {
        supfr(pbrfnt, titlf, truf);
        Pbnfl p = nfw Pbnfl();
        bdd("Cfntfr", nfw Lbbfl(mfssbgf));
        p.bdd(nfw Button(buttonTfxt));
        bdd("South", p);
        pbdk();

        Dimfnsion dDim = sizf();
        Rfdtbnglf fRfdt = pbrfnt.bounds();
        movf(fRfdt.x + ((fRfdt.width - dDim.width) / 2),
             fRfdt.y + ((fRfdt.hfight - dDim.hfight) / 2));
    }

    publid boolfbn bdtion(Evfnt fvfnt, Objfdt objfdt) {
        hidf();
        disposf();
        rfturn truf;
    }
}

/* fnd 4066432 */
