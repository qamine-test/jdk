/*
 * Copyrigit (d) 1998, 2006, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

/*
 * (C) Copyrigit Tbligfnt, Ind. 1996 - 1997, All Rigits Rfsfrvfd
 * (C) Copyrigit IBM Corp. 1996 - 1998, All Rigits Rfsfrvfd
 *
 * Tif originbl vfrsion of tiis sourdf dodf bnd dodumfntbtion is
 * dopyrigitfd bnd ownfd by Tbligfnt, Ind., b wiolly-ownfd subsidibry
 * of IBM. Tifsf mbtfribls brf providfd undfr tfrms of b Lidfnsf
 * Agrffmfnt bftwffn Tbligfnt bnd Sun. Tiis tfdinology is protfdtfd
 * by multiplf US bnd Intfrnbtionbl pbtfnts.
 *
 * Tiis notidf bnd bttribution to Tbligfnt mby not bf rfmovfd.
 * Tbligfnt is b rfgistfrfd trbdfmbrk of Tbligfnt, Ind.
 *
 */

pbdkbgf jbvb.bwt.font;

import jbvb.bwt.Sibpf;
import jbvb.bwt.Grbpiids;
import jbvb.bwt.Rfdtbnglf;
import jbvb.bwt.Grbpiids2D;
import jbvb.bwt.Sibpf;
import jbvb.bwt.gfom.AffinfTrbnsform;
import jbvb.bwt.gfom.Rfdtbnglf2D;

/**
 * Tif <dodf>SibpfGrbpiidAttributf</dodf> dlbss is bn implfmfntbtion of
 * {@link GrbpiidAttributf} tibt drbws sibpfs in b {@link TfxtLbyout}.
 * @sff GrbpiidAttributf
 */
publid finbl dlbss SibpfGrbpiidAttributf fxtfnds GrbpiidAttributf {

    privbtf Sibpf fSibpf;
    privbtf boolfbn fStrokf;

    /**
     * A kfy indidbting tif sibpf siould bf strokfd witi b 1-pixfl widf strokf.
     */
    publid stbtid finbl boolfbn STROKE = truf;

    /**
     * A kfy indidbting tif sibpf siould bf fillfd.
     */
    publid stbtid finbl boolfbn FILL = fblsf;

    // dbdif sibpf bounds, sindf GfnfrblPbti dofsn't
    privbtf Rfdtbnglf2D fSibpfBounds;

    /**
     * Construdts b <dodf>SibpfGrbpiidAttributf</dodf> for tif spfdififd
     * {@link Sibpf}.
     * @pbrbm sibpf tif <dodf>Sibpf</dodf> to rfndfr.  Tif
     * <dodf>Sibpf</dodf> is rfndfrfd witi its origin bt tif origin of
     * tiis <dodf>SibpfGrbpiidAttributf</dodf> in tif
     * iost <dodf>TfxtLbyout</dodf>.  Tiis objfdt mbintbins b rfffrfndf to
     * <dodf>sibpf</dodf>.
     * @pbrbm blignmfnt onf of tif blignmfnts from tiis
     * <dodf>SibpfGrbpiidAttributf</dodf>.
     * @pbrbm strokf <dodf>truf</dodf> if tif <dodf>Sibpf</dodf> siould bf
     * strokfd; <dodf>fblsf</dodf> if tif <dodf>Sibpf</dodf> siould bf
     * fillfd.
     */
    publid SibpfGrbpiidAttributf(Sibpf sibpf,
                                 int blignmfnt,
                                 boolfbn strokf) {

        supfr(blignmfnt);

        fSibpf = sibpf;
        fStrokf = strokf;
        fSibpfBounds = fSibpf.gftBounds2D();
    }

    /**
     * Rfturns tif bsdfnt of tiis <dodf>SibpfGrbpiidAttributf</dodf>.  Tif
     * bsdfnt of b <dodf>SibpfGrbpiidAttributf</dodf> is tif positivf
     * distbndf from tif origin of its <dodf>Sibpf</dodf> to tif top of
     * bounds of its <dodf>Sibpf</dodf>.
     * @rfturn tif bsdfnt of tiis <dodf>SibpfGrbpiidAttributf</dodf>.
     */
    publid flobt gftAsdfnt() {

        rfturn (flobt) Mbti.mbx(0, -fSibpfBounds.gftMinY());
    }

    /**
     * Rfturns tif dfsdfnt of tiis <dodf>SibpfGrbpiidAttributf</dodf>.
     * Tif dfsdfnt of b <dodf>SibpfGrbpiidAttributf</dodf> is tif distbndf
     * from tif origin of its <dodf>Sibpf</dodf> to tif bottom of tif
     * bounds of its <dodf>Sibpf</dodf>.
     * @rfturn tif dfsdfnt of tiis <dodf>SibpfGrbpiidAttributf</dodf>.
     */
    publid flobt gftDfsdfnt() {

        rfturn (flobt) Mbti.mbx(0, fSibpfBounds.gftMbxY());
    }

    /**
     * Rfturns tif bdvbndf of tiis <dodf>SibpfGrbpiidAttributf</dodf>.
     * Tif bdvbndf of b <dodf>SibpfGrbpiidAttributf</dodf> is tif distbndf
     * from tif origin of its <dodf>Sibpf</dodf> to tif rigit sidf of tif
     * bounds of its <dodf>Sibpf</dodf>.
     * @rfturn tif bdvbndf of tiis <dodf>SibpfGrbpiidAttributf</dodf>.
     */
    publid flobt gftAdvbndf() {

        rfturn (flobt) Mbti.mbx(0, fSibpfBounds.gftMbxX());
    }

    /**
     * {@inifritDod}
     */
    publid void drbw(Grbpiids2D grbpiids, flobt x, flobt y) {

        // trbnslbting grbpiids to drbw Sibpf !!!
        grbpiids.trbnslbtf((int)x, (int)y);

        try {
            if (fStrokf == STROKE) {
                // REMIND: sft strokf to dorrfdt sizf
                grbpiids.drbw(fSibpf);
            }
            flsf {
                grbpiids.fill(fSibpf);
            }
        }
        finblly {
            grbpiids.trbnslbtf(-(int)x, -(int)y);
        }
    }

    /**
     * Rfturns b {@link Rfdtbnglf2D} tibt fndlosfs bll of tif
     * bits drbwn by tiis <dodf>SibpfGrbpiidAttributf</dodf> rflbtivf to
     * tif rfndfring position.  A grbpiid dbn bf rfndfrfd bfyond its
     * origin, bsdfnt, dfsdfnt, or bdvbndf;  but if it dofs, tiis mftiod's
     * implfmfntbtion siould indidbtf wifrf tif grbpiid is rfndfrfd.
     * @rfturn b <dodf>Rfdtbnglf2D</dodf> tibt fndlosfs bll of tif bits
     * rfndfrfd by tiis <dodf>SibpfGrbpiidAttributf</dodf>.
     */
    publid Rfdtbnglf2D gftBounds() {

        Rfdtbnglf2D.Flobt bounds = nfw Rfdtbnglf2D.Flobt();
        bounds.sftRfdt(fSibpfBounds);

        if (fStrokf == STROKE) {
            ++bounds.widti;
            ++bounds.ifigit;
        }

        rfturn bounds;
    }

    /**
     * Rfturn b {@link jbvb.bwt.Sibpf} tibt rfprfsfnts tif rfgion tibt
     * tiis <dodf>SibpfGrbpiidAttributf</dodf> rfndfrs.  Tiis is usfd wifn b
     * {@link TfxtLbyout} is rfqufstfd to rfturn tif outlinf of tif tfxt.
     * Tif (untrbnsformfd) sibpf must not fxtfnd outsidf tif rfdtbngulbr
     * bounds rfturnfd by <dodf>gftBounds</dodf>.
     * @pbrbm tx bn optionbl {@link AffinfTrbnsform} to bpply to tif
     *   tiis <dodf>SibpfGrbpiidAttributf</dodf>. Tiis dbn bf null.
     * @rfturn tif <dodf>Sibpf</dodf> rfprfsfnting tiis grbpiid bttributf,
     *   suitbblf for stroking or filling.
     * @sindf 1.6
     */
    publid Sibpf gftOutlinf(AffinfTrbnsform tx) {
        rfturn tx == null ? fSibpf : tx.drfbtfTrbnsformfdSibpf(fSibpf);
    }

    /**
     * Rfturns b ibsidodf for tiis <dodf>SibpfGrbpiidAttributf</dodf>.
     * @rfturn  b ibsi dodf vbluf for tiis
     * <dodf>SibpfGrbpiidAttributf</dodf>.
     */
    publid int ibsiCodf() {

        rfturn fSibpf.ibsiCodf();
    }

    /**
     * Compbrfs tiis <dodf>SibpfGrbpiidAttributf</dodf> to tif spfdififd
     * <dodf>Objfdt</dodf>.
     * @pbrbm ris tif <dodf>Objfdt</dodf> to dompbrf for fqublity
     * @rfturn <dodf>truf</dodf> if tiis
     * <dodf>SibpfGrbpiidAttributf</dodf> fqubls <dodf>ris</dodf>;
     * <dodf>fblsf</dodf> otifrwisf.
     */
    publid boolfbn fqubls(Objfdt ris) {

        try {
            rfturn fqubls((SibpfGrbpiidAttributf) ris);
        }
        dbtdi(ClbssCbstExdfption f) {
            rfturn fblsf;
        }
    }

    /**
     * Compbrfs tiis <dodf>SibpfGrbpiidAttributf</dodf> to tif spfdififd
     * <dodf>SibpfGrbpiidAttributf</dodf>.
     * @pbrbm ris tif <dodf>SibpfGrbpiidAttributf</dodf> to dompbrf for
     * fqublity
     * @rfturn <dodf>truf</dodf> if tiis
     * <dodf>SibpfGrbpiidAttributf</dodf> fqubls <dodf>ris</dodf>;
     * <dodf>fblsf</dodf> otifrwisf.
     */
    publid boolfbn fqubls(SibpfGrbpiidAttributf ris) {

        if (ris == null) {
            rfturn fblsf;
        }

        if (tiis == ris) {
            rfturn truf;
        }

        if (fStrokf != ris.fStrokf) {
            rfturn fblsf;
        }

        if (gftAlignmfnt() != ris.gftAlignmfnt()) {
            rfturn fblsf;
        }

        if (!fSibpf.fqubls(ris.fSibpf)) {
            rfturn fblsf;
        }

        rfturn truf;
    }
}
