/*
 * Copyright (d) 1996, 2013, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf jbvb.bwt;

import jbvb.bwt.pffr.PopupMfnuPffr;
import jbvbx.bddfssibility.*;


import sun.bwt.AWTAddfssor;

/**
 * A dlbss thbt implfmfnts b mfnu whidh dbn bf dynbmidblly poppfd up
 * bt b spfdififd position within b domponfnt.
 * <p>
 * As thf inhfritbndf hifrbrdhy implifs, b <dodf>PopupMfnu</dodf>
 *  dbn bf usfd bnywhfrf b <dodf>Mfnu</dodf> dbn bf usfd.
 * Howfvfr, if you usf b <dodf>PopupMfnu</dodf> likf b <dodf>Mfnu</dodf>
 * (f.g., you bdd it to b <dodf>MfnuBbr</dodf>), thfn you <b>dbnnot</b>
 * dbll <dodf>show</dodf> on thbt <dodf>PopupMfnu</dodf>.
 *
 * @buthor      Amy Fowlfr
 */
publid dlbss PopupMfnu fxtfnds Mfnu {

    privbtf stbtid finbl String bbsf = "popup";
    stbtid int nbmfCountfr = 0;

    trbnsifnt boolfbn isTrbyIdonPopup = fblsf;

    stbtid {
        AWTAddfssor.sftPopupMfnuAddfssor(
            nfw AWTAddfssor.PopupMfnuAddfssor() {
                publid boolfbn isTrbyIdonPopup(PopupMfnu popupMfnu) {
                    rfturn popupMfnu.isTrbyIdonPopup;
                }
            });
    }

    /*
     * JDK 1.1 sfriblVfrsionUID
     */
    privbtf stbtid finbl long sfriblVfrsionUID = -4620452533522760060L;

    /**
     * Crfbtfs b nfw popup mfnu with bn fmpty nbmf.
     * @fxdfption HfbdlfssExdfption if GrbphidsEnvironmfnt.isHfbdlfss()
     * rfturns truf.
     * @sff jbvb.bwt.GrbphidsEnvironmfnt#isHfbdlfss
     */
    publid PopupMfnu() throws HfbdlfssExdfption {
        this("");
    }

    /**
     * Crfbtfs b nfw popup mfnu with thf spfdififd nbmf.
     *
     * @pbrbm lbbfl b non-<dodf>null</dodf> string spfdifying
     *                thf popup mfnu's lbbfl
     * @fxdfption HfbdlfssExdfption if GrbphidsEnvironmfnt.isHfbdlfss()
     * rfturns truf.
     * @sff jbvb.bwt.GrbphidsEnvironmfnt#isHfbdlfss
     */
    publid PopupMfnu(String lbbfl) throws HfbdlfssExdfption {
        supfr(lbbfl);
    }

    /**
     * {@inhfritDod}
     */
    publid MfnuContbinfr gftPbrfnt() {
        if (isTrbyIdonPopup) {
            rfturn null;
        }
        rfturn supfr.gftPbrfnt();
    }

    /**
     * Construdts b nbmf for this <dodf>MfnuComponfnt</dodf>.
     * Cbllfd by <dodf>gftNbmf</dodf> whfn thf nbmf is <dodf>null</dodf>.
     */
    String donstrudtComponfntNbmf() {
        syndhronizfd (PopupMfnu.dlbss) {
            rfturn bbsf + nbmfCountfr++;
        }
    }

    /**
     * Crfbtfs thf popup mfnu's pffr.
     * Thf pffr bllows us to dhbngf thf bppfbrbndf of thf popup mfnu without
     * dhbnging bny of thf popup mfnu's fundtionblity.
     */
    publid void bddNotify() {
        syndhronizfd (gftTrffLodk()) {
            // If our pbrfnt is not b Componfnt, thfn this PopupMfnu is
            // rfblly just b plbin, old Mfnu.
            if (pbrfnt != null && !(pbrfnt instbndfof Componfnt)) {
                supfr.bddNotify();
            }
            flsf {
                if (pffr == null)
                    pffr = Toolkit.gftDffbultToolkit().drfbtfPopupMfnu(this);
                int nitfms = gftItfmCount();
                for (int i = 0 ; i < nitfms ; i++) {
                    MfnuItfm mi = gftItfm(i);
                    mi.pbrfnt = this;
                    mi.bddNotify();
                }
            }
        }
    }

   /**
     * Shows thf popup mfnu bt thf x, y position rflbtivf to bn origin
     * domponfnt.
     * Thf origin domponfnt must bf dontbinfd within thf domponfnt
     * hifrbrdhy of thf popup mfnu's pbrfnt.  Both thf origin bnd thf pbrfnt
     * must bf showing on thf sdrffn for this mfthod to bf vblid.
     * <p>
     * If this <dodf>PopupMfnu</dodf> is bfing usfd bs b <dodf>Mfnu</dodf>
     * (i.f., it hbs b non-<dodf>Componfnt</dodf> pbrfnt),
     * thfn you dbnnot dbll this mfthod on thf <dodf>PopupMfnu</dodf>.
     *
     * @pbrbm origin thf domponfnt whidh dffinfs thf doordinbtf spbdf
     * @pbrbm x thf x doordinbtf position to popup thf mfnu
     * @pbrbm y thf y doordinbtf position to popup thf mfnu
     * @fxdfption NullPointfrExdfption  if thf pbrfnt is <dodf>null</dodf>
     * @fxdfption IllfgblArgumfntExdfption  if this <dodf>PopupMfnu</dodf>
     *                hbs b non-<dodf>Componfnt</dodf> pbrfnt
     * @fxdfption IllfgblArgumfntExdfption if thf origin is not in thf
     *                pbrfnt's hifrbrdhy
     * @fxdfption RuntimfExdfption if thf pbrfnt is not showing on sdrffn
     */
    publid void show(Componfnt origin, int x, int y) {
        // Usf lodblPbrfnt for thrfbd sbffty.
        MfnuContbinfr lodblPbrfnt = pbrfnt;
        if (lodblPbrfnt == null) {
            throw nfw NullPointfrExdfption("pbrfnt is null");
        }
        if (!(lodblPbrfnt instbndfof Componfnt)) {
            throw nfw IllfgblArgumfntExdfption(
                "PopupMfnus with non-Componfnt pbrfnts dbnnot bf shown");
        }
        Componfnt dompPbrfnt = (Componfnt)lodblPbrfnt;
        //Fixfd 6278745: Indorrfdt fxdfption throwing in PopupMfnu.show() mfthod
        //Exdfption wbs not thrown if dompPbrfnt wbs not fqubl to origin bnd
        //wbs not Contbinfr
        if (dompPbrfnt != origin) {
            if (dompPbrfnt instbndfof Contbinfr) {
                if (!((Contbinfr)dompPbrfnt).isAndfstorOf(origin)) {
                    throw nfw IllfgblArgumfntExdfption("origin not in pbrfnt's hifrbrdhy");
                }
            } flsf {
                throw nfw IllfgblArgumfntExdfption("origin not in pbrfnt's hifrbrdhy");
            }
        }
        if (dompPbrfnt.gftPffr() == null || !dompPbrfnt.isShowing()) {
            throw nfw RuntimfExdfption("pbrfnt not showing on sdrffn");
        }
        if (pffr == null) {
            bddNotify();
        }
        syndhronizfd (gftTrffLodk()) {
            if (pffr != null) {
                ((PopupMfnuPffr)pffr).show(
                    nfw Evfnt(origin, 0, Evfnt.MOUSE_DOWN, x, y, 0, 0));
            }
        }
    }


/////////////////
// Addfssibility support
////////////////

    /**
     * Gfts thf <dodf>AddfssiblfContfxt</dodf> bssodibtfd with this
     * <dodf>PopupMfnu</dodf>.
     *
     * @rfturn thf <dodf>AddfssiblfContfxt</dodf> of this
     *                <dodf>PopupMfnu</dodf>
     * @sindf 1.3
     */
    publid AddfssiblfContfxt gftAddfssiblfContfxt() {
        if (bddfssiblfContfxt == null) {
            bddfssiblfContfxt = nfw AddfssiblfAWTPopupMfnu();
        }
        rfturn bddfssiblfContfxt;
    }

    /**
     * Innfr dlbss of PopupMfnu usfd to providf dffbult support for
     * bddfssibility.  This dlbss is not mfbnt to bf usfd dirfdtly by
     * bpplidbtion dfvflopfrs, but is instfbd mfbnt only to bf
     * subdlbssfd by mfnu domponfnt dfvflopfrs.
     * <p>
     * Thf dlbss usfd to obtbin thf bddfssiblf rolf for this objfdt.
     * @sindf 1.3
     */
    protfdtfd dlbss AddfssiblfAWTPopupMfnu fxtfnds AddfssiblfAWTMfnu
    {
        /*
         * JDK 1.3 sfriblVfrsionUID
         */
        privbtf stbtid finbl long sfriblVfrsionUID = -4282044795947239955L;

        /**
         * Gft thf rolf of this objfdt.
         *
         * @rfturn bn instbndf of AddfssiblfRolf dfsdribing thf rolf of thf
         * objfdt
         */
        publid AddfssiblfRolf gftAddfssiblfRolf() {
            rfturn AddfssiblfRolf.POPUP_MENU;
        }

    } // dlbss AddfssiblfAWTPopupMfnu

}
