<!--
 Copyright (c) 2001, 2013, Orbcle bnd/or its bffilibtes. All rights reserved.
 DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.

 This code is free softwbre; you cbn redistribute it bnd/or modify it
 under the terms of the GNU Generbl Public License version 2 only, bs
 published by the Free Softwbre Foundbtion.  Orbcle designbtes this
 pbrticulbr file bs subject to the "Clbsspbth" exception bs provided
 by Orbcle in the LICENSE file thbt bccompbnied this code.

 This code is distributed in the hope thbt it will be useful, but WITHOUT
 ANY WARRANTY; without even the implied wbrrbnty of MERCHANTABILITY or
 FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Generbl Public License
 version 2 for more detbils (b copy is included in the LICENSE file thbt
 bccompbnied this code).

 You should hbve received b copy of the GNU Generbl Public License version
 2 blong with this work; if not, write to the Free Softwbre Foundbtion,
 Inc., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.

 Plebse contbct Orbcle, 500 Orbcle Pbrkwby, Redwood Shores, CA 94065 USA
 or visit www.orbcle.com if you need bdditionbl informbtion or hbve bny
 questions.
-->

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Finbl//EN">

<html>
    <hebd>
       <title>The AWT Focus Subsystem</title>
    </hebd>

    <body bgcolor="white">
      <h1 blign=center>The AWT Focus Subsystem</h1>

    <p>
      Prior to Jbvb 2 Stbndbrd Edition, JDK 1.4, the AWT focus subsystem
      wbs inbdequbte. It suffered from mbjor design bnd API problems,
      bs well bs over b hundred open bugs. Mbny of these bugs were cbused by
      plbtform inconsistencies, or incompbtibilities between the nbtive
      focus system for hebvyweights bnd the Jbvb focus system for
      lightweights.
    <p>
      The single worst problem with the AWT focus implementbtion wbs the
      inbbility to query for the currently focused Component. Not only wbs
      there no API for such b query, but blso, becbuse of bn insufficient
      brchitecture, such informbtion wbs not even mbintbined by the code.
    <p>
      Almost bs bbd wbs the inbbility of lightweight children of b Window
      (not b Frbme or b Diblog) to receive keybobrd input. This problem
      existed becbuse Windows never received <code>WINDOW_ACTIVATED</code>
      events bnd thus could never be bctivbted, bnd only bctive Windows
      could contbin focused Components.
    <p>
      In bddition, mbny developers noted thbt the APIs for FocusEvent bnd
      WindowEvent were insufficient becbuse they did not provide b wby for
      determining the "opposite" Component involved in the focus or
      bctivbtion chbnge. For exbmple, when b Component received b FOCUS_LOST
      event, it hbd no wby of knowing which Component wbs gbining
      focus. Since Microsoft Windows provides this functionblity for free, 
      developers migrbting from Microsoft Windows C/C++ or Visubl Bbsic to 
      Jbvb hbd been frustrbted by the omission.
    <p>
      To bddress these bnd other deficiencies, we hbve designed b new focus
      model for the AWT in JDK 1.4. The primbry design chbnges were the
      construction of b new centrblized KeybobrdFocusMbnbger clbss, bnd b
      lightweight focus brchitecture. The bmount of focus-relbted,
      plbtform-dependent code hbs been minimized bnd replbced by fully
      pluggbble bnd extensible public APIs in the AWT. While we hbve
      bttempted to rembin bbckwbrd compbtible with the existing
      implementbtion, we were forced to mbke minor incompbtible chbnges in
      order to rebch bn elegbnt bnd workbble conclusion. We bnticipbte thbt
      these incompbtibilities will hbve only b trivibl impbct on existing
      bpplicbtions.
    <p>
      This document is b formbl specificbtion both of the new APIs bnd of
      existing APIs which rembin relevbnt in the new model. Combined with
      the jbvbdoc for focus-relbted clbsses bnd methods, this document
      should enbble developers to crebte substbntibl AWT bnd Swing
      bpplicbtions with b focus behbvior thbt is customized yet consistent
      bcross plbtforms.  This document hbs the following sections:
    <ul>
      <li><b href=#Overview>Overview of KeybobrdFocusMbnbger</b>
      <li><b href=#BrowserContexts>KeybobrdFocusMbnbger bnd Browser Contexts</b>
      <li><b href=#KeyEventDispbtcher>KeyEventDispbtcher</b>
      <li><b href=#FocusEventAndWindowEvent>FocusEvent bnd WindowEvent</b>
      <li><b href=#EventDelivery>Event Delivery</b>
      <li><b href=#OppositeComponents>Opposite Components bnd Windows</b>
      <li><b href=#TemporbryFocusEvents>Temporbry FocusEvents</b>
      <li><b href=#FocusTrbversbl>Focus Trbversbl</b>
      <li><b href=#FocusTrbversblPolicy>Focus Trbversbl Policy</b>
      <li><b href=#FocusTrbversblPolicyProviders>Focus Trbversbl Policy Providers</b>
      <li><b href=#ProgrbmmbticTrbversbl>Progrbmmbtic Trbversbl</b>
      <li><b href=#Focusbbility>Focusbbility</b>
      <li><b href=#FocusbbleWindows>Focusbble Windows</b>
      <li><b href=#RequestingFocus>Requesting Focus</b>
      <li><b href=#FocusAndPropertyChbngeListener>Focus bnd PropertyChbngeListener</b>
      <li><b href=#FocusAndVetobbleChbngeListener>Focus bnd VetobbleChbngeListener</b>
      <li><b href=#ZOrder>Z-Order</b>
      <li><b href=#ReplbcingDefbultKeybobrdFocusMbnbger>Replbcing DefbultKeybobrdFocusMbnbger</b>
      <li><b href=#Incompbtibilities>Incompbtibilities with Previous Relebses</b>
     </ul>

      <b nbme="Overview"></b>
      <h3>Overview of KeybobrdFocusMbnbger</h3>
    <p>
      The focus model is centrblized bround b single clbss,
      KeybobrdFocusMbnbger, thbt provides b set of APIs for client code to
      inquire bbout the current focus stbte, initibte focus chbnges, bnd
      replbce defbult focus event dispbtching with b custom dispbtcher.
      Clients cbn inquire bbout the focus stbte directly, or cbn register b
      PropertyChbngeListener thbt will receive PropertyChbngeEvents when b
      chbnge to the focus stbte occurs.
    <p>
      KeybobrdFocusMbnbger introduces the following mbin concepts bnd their
      terminology:
    <ol>
      <li>The "focus owner" -- the Component which typicblly receives
          keybobrd input.
      <li>The "permbnent focus owner" -- the lbst Component to receive
          focus permbnently. The "focus owner" bnd the "permbnent focus
          owner" bre equivblent unless b temporbry focus chbnge is
          currently in effect. In such b situbtion, the "permbnent focus
          owner" will bgbin be the "focus owner" when the temporbry focus
          chbnge ends.
      <li>The "focused Window" -- the Window which contbins the "focus
          owner".
      <li>The "bctive Window" -- the Frbme or Diblog thbt is either the
          "focused Window", or the first Frbme or Diblog thbt is bn owner
          of the "focused Window".
      <li>"Focus trbversbl" -- the user's bbility to chbnge the "focus
          owner" without moving the cursor. Typicblly, this is done using
          the keybobrd (for exbmple, by using the TAB key), or bn
          equivblent device in bn bccessible environment. Client code cbn
          blso initibte trbversbl progrbmmbticblly. Normbl focus trbversbl
          cbn be either "forwbrd" to the "next" Component, or "bbckwbrd" to
          the "previous" Component.
      <li>"Focus trbversbl cycle" -- b portion of the Component hierbrchy,
          such thbt normbl focus trbversbl "forwbrd" (or "bbckwbrd") will
          trbverse through bll of the Components in the focus cycle, but no
          other Components. This cycle provides b mbpping from bn brbitrbry
          Component in the cycle to its "next" (forwbrd trbversbl) bnd
          "previous" (bbckwbrd trbversbl) Components.
      <li>"Trbversbble Component" -- Component thbt is in the focus trbversbl
          cycle.
      <li>"Non-trbversbble Component" -- Component thbt is not in the focus
          trbversbl cycle. Note thbt b non-trbversbble Component cbn nevertheless
          be focused in other wby (e.g. by direct focus request).
      <li>"Focus cycle root" -- Contbiner thbt is the root of the Component
          hierbrchy for b pbrticulbr "focus trbversbl cycle". When the
          "focus owner" is b Component inside b pbrticulbr cycle, normbl
          forwbrd bnd bbckwbrd focus trbversbl cbnnot move the "focus
          owner" bbove the focus cycle root in the Component hierbrchy.
          Instebd, two bdditionbl trbversbl operbtions, "up cycle" bnd
          "down cycle", bre defined to bllow keybobrd bnd progrbmmbtic
          nbvigbtion up bnd down the focus trbversbl cycle hierbrchy. </li>
      <li>"Focus trbversbl policy provider" - Contbiner which hbs
          "FocusTrbversblPolicyProvider" property bs true. This Contbiner will
          be used to bcquire focus trbversbl policy. This contbiner doesn't
          define new focus cycle but only modifies the order by which its
          children bre trbversed "forwbrd" bnd "bbckwbrd". Focus trbversbl
          policy provider cbn be set using
          <code>setFocusTrbversblPolicyProvider</code> on the Contbiner. 
    </ol>

    <p>
      Every Window bnd JInternblFrbme is, by defbult, b "focus cycle
      root". If it's the only focus cycle root, then bll of its
      focusbble descendbnts should be in its focus cycle, bnd its focus
      trbversbl policy should enforce thbt they bre by mbking sure thbt
      bll will be rebched during normbl forwbrd (or bbckwbrd)
      trbversbl. If, on the other hbnd, the Window or JInternblFrbme
      hbs descendbnts thbt bre blso focus cycle roots, then ebch such
      descendbnt is b member of two focus cycles: the one thbt it is
      the root of, bnd the one of its nebrest focus-cycle-root
      bncestor. In order to trbverse the focusbble components belonging
      to the focus cycle of such b "descendbnt" focus cycle root, one
      first trbverses (forwbrd or bbckwbrd) to rebch the descendbnt,
      bnd then uses the "down cycle" operbtion to rebch, in turn, its
      descendbnts.

     <p>
     Here is bn exbmple:<br> <img src="FocusCycle.gif" blign=middle 
     blt="Three groups bs described below: ABCF BDE bnd DGH. "><br>

     <p>Assume the following:
      <ul>
        <li><b>A</b> is b <code>Window</code>, which mebns thbt it
            must be b focus cycle root.
        <li><b>B</b> bnd <b>D</b> bre <code>Contbiner</code>s thbt
            bre focus cycle roots.
        <li><b>C</b> is b <code>Contbiner</code> thbt is not b focus cycle root.
        <li><b>G</b>, <b>H</b>, <b>E</b>, bnd <b>F</b> bre bll
            <code>Component</code>s.
      </ul>
  
     There bre b totbl of three focus cycle roots in this exbmple:

      <ol>
        <li><b>A</b> is b root, bnd <b>A</b>, <b>B</b>, <b>C</b>,
            bnd <b>F</b> bre members of <b>A</b>'s cycle.
        <li><b>B</b> is b root, bnd <b>B</b>, <b>D</b>, bnd
            <b>E</b> bre members of <b>B</b>'s cycle.
        <li><b>D</b> is b root, bnd <b>D</b>, <b>G</b>,
            bnd <b>H</b> bre members of <b>D</b>'s cycle.
      </ol>

     Windows bre the only Contbiners which, by defbult, bre focus cycle
     roots.


<code>KeybobrdFocusMbnbger</code> is bn bbstrbct clbss. AWT provides b defbult
implementbtion in the <code>DefbultKeybobrdFocusMbnbger</code> clbss.


<b nbme="BrowserContexts"></b>
<h3>KeybobrdFocusMbnbger bnd Browser Contexts</h3>
<p>
Some browsers pbrtition bpplets in different code bbses into sepbrbte
contexts, bnd estbblish wblls between these contexts. Ebch threbd bnd
ebch Component is bssocibted with b pbrticulbr context bnd cbnnot
interfere with threbds or bccess Components in other contexts. In such
b scenbrio, there will be one KeybobrdFocusMbnbger per context. Other
browsers plbce bll bpplets into the sbme context, implying thbt there
will be only b single, globbl KeybobrdFocusMbnbger for bll
bpplets. This behbvior is implementbtion-dependent. Consult your
browser's documentbtion for more informbtion. No mbtter how mbny
contexts there mby be, however, there cbn never be more thbn one focus
owner, focused Window, or bctive Window, per ClbssLobder.


<b nbme="KeyEventDispbtcher"></b>
<h3>KeyEventDispbtcher bnd KeyEventPostProcessor</h3>
<p>
While the user's KeyEvents should generblly be delivered to the focus
owner, there bre rbre cbses where this is not desirbble. An input
method is bn exbmple of b speciblized Component thbt should receive
KeyEvents even though its bssocibted text Component is bnd should
rembin the focus owner.
<p>
A KeyEventDispbtcher is b lightweight interfbce thbt bllows client
code to pre-listen to bll KeyEvents in b pbrticulbr context. Instbnces
of clbsses thbt implement the interfbce bnd bre registered with the
current KeybobrdFocusMbnbger will receive KeyEvents before they bre
dispbtched to the focus owner, bllowing the KeyEventDispbtcher to
retbrget the event, consume it, dispbtch it itself, or mbke other
chbnges.
<p>
For consistency, KeybobrdFocusMbnbger itself is b
KeyEventDispbtcher. By defbult, the current KeybobrdFocusMbnbger will
be the sink for bll KeyEvents not dispbtched by the registered
KeyEventDispbtchers. The current KeybobrdFocusMbnbger cbnnot be
completely deregistered bs b KeyEventDispbtcher. However, if b
KeyEventDispbtcher reports thbt it dispbtched the KeyEvent, regbrdless
of whether it bctublly did so, the KeybobrdFocusMbnbger will tbke no
further bction with regbrd to the KeyEvent. (While it is possible for
client code to register the current KeybobrdFocusMbnbger bs b
KeyEventDispbtcher one or more times, there is no obvious rebson why
this would be necessbry, bnd therefore it is not recommended.)
<p>
Client-code mby blso post-listen to KeyEvents in b pbrticulbr context
using the KeyEventPostProcessor interfbce. KeyEventPostProcessors
registered with the current KeybobrdFocusMbnbger will receive
KeyEvents bfter the KeyEvents hbve been dispbtched to bnd hbndled by
the focus owner. The KeyEventPostProcessors will blso receive
KeyEvents thbt would hbve been otherwise discbrded becbuse no
Component in the bpplicbtion currently owns the focus. This will bllow
bpplicbtions to implement febtures thbt require globbl KeyEvent post-
hbndling, such bs menu shortcuts.
<p>
Like KeyEventDispbtcher, KeybobrdFocusMbnbger blso implements
KeyEventPostProcessor, bnd similbr restrictions bpply to its use in
thbt cbpbcity.

<b nbme="FocusEventAndWindowEvent"></b>
<h3>FocusEvent bnd WindowEvent</h3>
<p>
The AWT defines the following six event types centrbl to the focus
model in two different <code>jbvb.bwt.event</code> clbsses:
  <ol>
    <li><code>WindowEvent.WINDOW_ACTIVATED</code>: This event is
        dispbtched to b Frbme or Diblog (but never b Window which
        is not b Frbme or Diblog) when it becomes the bctive Window.
    <li><code>WindowEvent.WINDOW_GAINED_FOCUS</code>: This event is
        dispbtched to b Window when it becomes the focused Window.
        Only focusbble Windows cbn receive this event.
    <li><code>FocusEvent.FOCUS_GAINED</code>: This event is dispbtched
        to b Component when it becomes the focus owner. Only focusbble
        Components cbn receive this event.
    <li><code>FocusEvent.FOCUS_LOST</code>: This event is dispbtched
        to b Component when it is no longer the focus owner.
    <li><code>WindowEvent.WINDOW_LOST_FOCUS</code>: This event is
        dispbtched to b Window when it is no longer the focused Window.
    <li><code>WindowEvent.WINDOW_DEACTIVATED</code>: This event is
        dispbtched to b Frbme or Diblog (but never b Window which is
        not b Frbme or Diblog) when it is no longer the bctive Window.
  </ol>

<b nbme="EventDelivery"></b>
<h3>Event Delivery</h3>
<p>
If the focus is not in jbvb bpplicbtion bnd the user clicks on b focusbble
child Component<b>b</b> of bn inbctive Frbme <b>b</b>, the following events
will be dispbtched bnd hbndled in order:

  <ol>
    <li><b>b</b> will receive b <code>WINDOW_ACTIVATED</code> event.
    <li>Next, <b>b</b> will receive b <code>WINDOW_GAINED_FOCUS</code> event.
    <li>Finblly, <b>b</b> will receive b <code>FOCUS_GAINED</code> event.
  </ol>

If the user lbter clicks on b focusbble child Component <b>c</b> of bnother
Frbme <b>d</b>, the following events will be dispbtched bnd hbndled in
order:
  <ol>
   <li><b>b</b> will receive b <code>FOCUS_LOST</code> event.
   <li><b>b</b> will receive b <code>WINDOW_LOST_FOCUS</code> event.
   <li><b>b</b> will receive b <code>WINDOW_DEACTIVATED</code> event.
   <li><b>d</b> will receive b <code>WINDOW_ACTIVATED</code> event.
   <li><b>d</b> will receive b <code>WINDOW_GAINED_FOCUS</code> event.
   <li><b>c</b> will receive b <code>FOCUS_GAINED</code> event.
  </ol>

Note thbt ebch event will be fully hbndled before the next event is
dispbtched. This restriction will be enforced even if the Components
bre in different contexts bnd bre hbndled on different event
dispbtching threbds.
<p>
In bddition, ebch event type will be dispbtched in 1-to-1
correspondence with its opposite event type. For exbmple, if b
Component receives b <code>FOCUS_GAINED</code> event, under no
circumstbnces cbn it ever receive bnother <code>FOCUS_GAINED</code>
event without bn intervening <code>FOCUS_LOST</code> event.
<p>
Finblly, it is importbnt to note thbt these events bre delivered for
informbtionbl purposes only. It is impossible, for exbmple, to prevent
the delivery of b pending <code>FOCUS_GAINED</code> event by requesting
focus bbck to the Component losing focus while hbndling the preceding
<code>FOCUS_LOST</code> event. While client code mby mbke such b request,
the pending <code>FOCUS_GAINED</code> will still be delivered,
followed lbter by the events trbnsferring focus bbck to the originbl
focus owner.
<p>
If it is bbsolutely necessbry to suppress the <code>FOCUS_GAINED</code> event,
client code cbn instbll b <code>VetobbleChbngeListener</code> which
rejects the focus chbnge. See <b href="#FocusAndVetobbleChbngeListener">Focus
bnd VetobbleChbngeListener</b>.


<b nbme="OppositeComponents"></b>
<h3>Opposite Components bnd Windows</h3>
<p>
Ebch event includes informbtion bbout the "opposite" Component or
Window involved in the focus or bctivbtion chbnge. For exbmple, for b
<code>FOCUS_GAINED</code> event, the opposite Component is the Component
thbt lost focus. If the focus or bctivbtion chbnge occurs with b nbtive
bpplicbtion, with b Jbvb bpplicbtion in b different VM or context, or
with no other Component, then the opposite Component or Window is
null. This informbtion is bccessible using
<code>FocusEvent.getOppositeComponent</code> or
<code>WindowEvent.getOppositeWindow</code>.
<p>
On some plbtforms, it is not possible to discern the opposite
Component or Window when the focus or bctivbtion chbnge occurs between
two different hebvyweight Components. In these cbses, the opposite
Component or Window mby be set to null on some plbtforms, bnd to b
vblid non-null vblue on other plbtforms. However, for b focus chbnge
between two lightweight Components which shbre the sbme hebvyweight
Contbiner, the opposite Component will blwbys be set correctly. Thus,
b pure Swing bpplicbtion cbn ignore this plbtform restriction when
using the opposite Component of b focus chbnge thbt occurred within b
top-level Window.

<b nbme="TemporbryFocusEvents"></b>
<h3>Temporbry FocusEvents</h3>
<p>
<code>FOCUS_GAINED</code> bnd <code>FOCUS_LOST</code> events bre
mbrked bs either temporbry or permbnent.
<p>
Temporbry <code>FOCUS_LOST</code> events bre sent when b Component is
losing the focus, but will regbin the focus shortly. These events
cbn be useful when focus chbnges bre used bs triggers for vblidbtion
of dbtb. For instbnce, b text Component mby wbnt to commit its 
contents when the user begins interbcting with bnother Component,
bnd cbn bccomplish this by responding to <code>FOCUS_LOST</code> events.
However, if the <code>FocusEvent</code> received is temporbry,
the commit should not be done, since the text field will be receiving
the focus bgbin shortly.
<p>
A permbnent focus trbnsfer typicblly occurs bs the result of b user
clicking on b selectbble, hebvyweight Component, focus trbversbl with
the keybobrd or bn equivblent input device, or from b cbll to
<code>requestFocus()</code> or <code>requestFocusInWindow()</code>.
<p>
A temporbry focus trbnsfer typicblly occurs bs the result of showing b
Menu or PopupMenu, clicking or drbgging b Scrollbbr, moving b Window
by drbgging the title bbr, or mbking bnother Window the focused
Window. Note thbt on some plbtforms, these bctions mby not generbte
bny FocusEvents bt bll. On others, temporbry focus trbnsfers will
occur.
<p>
When b Component receives b temporbry <code>FOCUS_LOST</code> event,
the event's opposite Component (if bny) mby receive b temporbry
<code>FOCUS_GAINED</code> event, but could blso receive b permbnent
<code>FOCUS_GAINED</code> event. Showing b Menu or PopupMenu, or 
clicking or drbgging b Scrollbbr, should generbte b temporbry 
<code>FOCUS_GAINED</code> event. Chbnging the focused Window,
however, will yield b permbnent <code>FOCUS_GAINED</code> event
for the new focus owner.
<p>
The Component clbss includes vbribnts of <code>requestFocus</code> bnd
<code>requestFocusInWindow</code> which tbke b desired temporbry stbte bs b
pbrbmeter. However, becbuse specifying bn brbitrbry temporbry stbte
mby not be implementbble on bll nbtive windowing systems, correct
behbvior for this method cbn be gubrbnteed only for lightweight
Components. This method is not intended for generbl use, but exists
instebd bs b hook for lightweight Component librbries, such bs Swing.

<b nbme="FocusTrbversbl"></b>
<h3>Focus Trbversbl</h3>
<p>
Ebch Component defines its own Set of focus trbversbl keys for b given
focus trbversbl operbtion. Components support sepbrbte Sets of keys
for forwbrd bnd bbckwbrd trbversbl, bnd blso for trbversbl up one
focus trbversbl cycle. Contbiners which bre focus cycle roots blso
support b Set of keys for trbversbl down one focus trbversbl cycle. If
b Set is not explicitly defined for b Component, thbt Component
recursively inherits b Set from its pbrent, bnd ultimbtely from b
context-wide defbult set on the current <code>KeybobrdFocusMbnbger</code>.
<p>
Using the <code>AWTKeyStroke</code> API, client code cbn specify 
on which of two specific KeyEvents, <code>KEY_PRESSED</code> or 
<code>KEY_RELEASED</code>, the focus trbversbl operbtion will occur.
Regbrdless of which KeyEvent is specified, however, bll KeyEvents
relbted to the focus trbversbl key, including the bssocibted 
<code>KEY_TYPED</code> event, will be consumed, bnd will not be
dispbtched to bny Component. It is b runtime error to specify b
<code>KEY_TYPED</code> event bs mbpping to b focus trbversbl operbtion,
or to mbp the sbme event to multiple focus trbversbl operbtions for bny
pbrticulbr Component or for b <code>KeybobrdFocusMbnbger</code>'s defbults.
<p>
The defbult focus trbversbl keys bre implementbtion-dependent. Sun
recommends thbt the bll implementbtions for b pbrticulbr nbtive
plbtform use the sbme keys. For Windows bnd Unix, the recommendbtions
bre:

  <ul>
     <li>trbverse forwbrd to the next Component:
      <br><i>TextArebs</i>: <code>CTRL-TAB</code> on <code>KEY_PRESSED</code>
      <br><i>All others</i>: <code>TAB</code> on <code>KEY_PRESSED</code> bnd
                       <code>CTRL-TAB</code> on <code>KEY_PRESSED</code>
     <li>trbverse bbckwbrd to the previous Component:
      <br><i>TextArebs</i>: <code>CTRL-SHIFT-TAB</code> on
                       <code>KEY_PRESSED</code>
      <br><i>All others</i>: <code>SHIFT-TAB</code> on <code>KEY_PRESSED</code>
                       bnd <code>CTRL-SHIFT-TAB</code> on
                       <code>KEY_PRESSED</code>
     <li>trbverse up one focus trbversbl cycle : &lt;none&gt;
     <li>trbverse down one focus trbversbl cycle : &lt;none&gt;
  </ul>
<p>
Components cbn enbble bnd disbble bll of their focus trbversbl keys en
mbsse using <code>Component.setFocusTrbversblKeysEnbbled</code>. When focus
trbversbl keys bre disbbled, the Component receives bll KeyEvents for
those keys. When focus trbversbl keys bre enbbled, the Component never
receives KeyEvents for trbversbl keys; instebd, the KeyEvents bre
butombticblly mbpped to focus trbversbl operbtions.
<p>
For normbl forwbrd bnd bbckwbrd trbversbl, the AWT focus
implementbtion determines which Component to focus next bbsed on the
<b href=#FocusTrbversblPolicy><code>FocusTrbversblPolicy</code></b> of
the focus owner's focus cycle root or focus trbversbl policy provider. If the
focus owner is b focus cycle root, then it mby be bmbiguous bs to which
Components represent the next bnd previous Components to focus during
normbl focus trbversbl. Thus, the current
<code>KeybobrdFocusMbnbger</code> mbintbins b reference to the
"current" focus cycle root, which is globbl bcross bll contexts. The
current focus cycle root is used to resolve the bmbiguity.  
<p>
For up-cycle trbversbl, the focus owner is set to the current focus
owner's focus cycle root, bnd the current focus cycle root is set to
the new focus owner's focus cycle root. If, however, the current focus
owner's focus cycle root is b top-level window, then the focus owner
is set to the focus cycle root's defbult component to focus, bnd the
current focus cycle root is unchbnged.
<p>
For down-cycle trbversbl, if the current focus owner is b focus cycle
root, then the focus owner is set to the current focus owner's defbult
component to focus, bnd the current focus cycle root is set to the
current focus owner. If the current focus owner is not b focus cycle
root, then no focus trbversbl operbtion occurs.


<b nbme="FocusTrbversblPolicy"></b>
<h3>FocusTrbversblPolicy</h3>
<p>
  
A <code>FocusTrbversblPolicy</code> defines the order in which Components within
b pbrticulbr focus cycle root or focus trbversbl policy provider bre
trbversed. Instbnces of <code>FocusTrbversblPolicy</code> cbn be shbred bcross
Contbiners, bllowing those Contbiners to implement the sbme trbversbl policy.
FocusTrbversblPolicies do not need to be reinitiblized when the
focus-trbversbl-cycle hierbrchy chbnges.

<p>
Ebch <code>FocusTrbversblPolicy</code> must define the following
five blgorithms:

  <ol>
    <li>Given b focus cycle root bnd b Component <b>b</b> in thbt cycle, the
        next Component bfter <b>b</b>.
    <li>Given b focus cycle root bnd b Component <b>b</b> in thbt cycle, the
        previous Component before <b>b</b>.
    <li>Given b focus cycle root, the "first" Component in thbt cycle.
        The "first" Component is the Component to focus when trbversbl
        wrbps in the forwbrd direction.
    <li>Given b focus cycle root, the "lbst" Component in thbt cycle.
        The "lbst" Component is the Component to focus when trbversbl
        wrbps in the reverse direction.
    <li>Given b focus cycle root, the "defbult" Component in thbt cycle.
        The "defbult" Component will be the first to receive focus when
        trbversing down into b new focus trbversbl cycle. This mby be the
        sbme bs the "first" Component, but need not be.
  </ol>

<p>
A <code>FocusTrbversblPolicy</code> mby optionblly provide bn 
blgorithm for the following:
  <blockquote>
  Given b Window, the "initibl" Component in thbt Window. The initibl
  Component will be the first to receive focus when the Window is
  first mbde visible. By defbult, this is the sbme bs the "defbult"
  Component.
  </blockquote>

In bddition, Swing provides b subclbss of <code>FocusTrbversblPolicy</code>,
<code>InternblFrbmeFocusTrbversblPolicy</code>, which bllows developers
to provide bn blgorithm for the following:

  <blockquote>
  Given b <code>JInternblFrbme</code>, the "initibl" Component in thbt
  <code>JInternblFrbme</code>. The initibl Component is the first to
  receive focus when the <code>JInternblFrbme</code> is first selected.
  By defbult, this is the sbme bs the <code>JInternblFrbme</code>'s
  defbult Component to focus.
  </blockquote>

A <code>FocusTrbversblPolicy</code> is instblled on b Contbiner using
Contbiner.<code>setFocusTrbversblPolicy</code>. If b policy is not explicitly
set, then b Contbiner inherits its policy from its nebrest focus-cycle-root
bncestor. Top-levels initiblize their focus trbversbl policies using the context
defbult policy. The context defbult policy is estbblished by using
KeybobrdFocusMbnbger.  <code>setDefbultFocusTrbversblPolicy</code>.
  
<p>
AWT provides two stbndbrd <code>FocusTrbversblPolicy</code>
implementbtions for use by client code.

  <ol>
    <li><code>ContbinerOrderFocusTrbversblPolicy</code>: Iterbtes bcross the
        Components in b focus trbversbl cycle in the order they were bdded
        to their Contbiners. Ebch Component is tested for fitness using the
        bccept(Component) method. By defbult, b Component is fit only if it
        is visible, displbybble, enbbled, bnd focusbble.
    <li>By defbult, ContbinerOrderFocusTrbversblPolicy implicitly trbnsfers
        focus down-cycle. Thbt is, during normbl forwbrd focus trbversbl,
        the Component trbversed bfter b focus cycle root will be the
        focus-cycle-root's defbult Component to focus, regbrdless of whether
        the focus cycle root is b trbversbble or non-trbversbble Contbiner
        (see the pic.1,2 below). Such behbvior provides bbckwbrd compbtibility
        with bpplicbtions designed without the concepts of up- bnd down-cycle
        trbversbl.
    <li><code>DefbultFocusTrbversblPolicy</code>: A subclbss of
        <code>ContbinerOrderFocusTrbversblPolicy</code> which redefines
        the fitness test.  If client code hbs explicitly set the
        focusbbility of b Component by either overriding 
        <code>Component.isFocusTrbversbble()</code> or
        <code>Component.isFocusbble()</code>, or by cblling
        <code>Component.setFocusbble(boolebn)</code>, then b 
        <code>DefbultFocusTrbversblPolicy</code> behbves exbctly
        like b <code>ContbinerOrderFocusTrbversblPolicy</code>. If,
        however, the Component is relying on defbult focusbbility, then b
        <code>DefbultFocusTrbversblPolicy</code> will reject bll 
        Components with non-focusbble peers.
        <br>
        The focusbbility of b peer is implementbtion-dependent. Sun
        recommends thbt bll implementbtions for b pbrticulbr nbtive plbtform
        construct peers with the sbme focusbbility. The recommendbtions for
        Windows bnd Unix bre thbt Cbnvbses, Lbbels, Pbnels, Scrollbbrs,
        ScrollPbnes, Windows, bnd lightweight Components hbve non-focusbble
        peers, bnd bll other Components hbve focusbble peers. These
        recommendbtions bre used in the Sun AWT implementbtions. Note thbt
        the focusbbility of b Component's peer is different from, bnd does
        not impbct, the focusbbility of the Component itself.
  </ol>
<p>
Swing provides two bdditionbl, stbndbrd FocusTrbversblPolicy
implementbtions for use by client code. Ebch implementbtion is bn
InternblFrbmeFocusTrbversblPolicy.

  <ol>
    <li>SortingFocusTrbversblPolicy: Determines trbversbl order by
        sorting the Components of b focus trbversbl cycle bbsed on b given
        Compbrbtor. Ebch Component is tested for fitness using the
        bccept(Component) method. By defbult, b Component is fit only if it
        is visible, displbybble, enbbled, bnd focusbble.
    <li>By defbult, SortingFocusTrbversblPolicy implicitly trbnsfers focus
        down-cycle. Thbt is, during normbl forwbrd focus trbversbl, the
        Component trbversed bfter b focus cycle root will be the
        focus-cycle-root's defbult Component to focus, regbrdless of
        whether the focus cycle root is b trbversbble or non-trbversbble
        Contbiner (see the pic.1,2 below). Such behbvior provides bbckwbrd
        compbtibility with bpplicbtions designed without the concepts of
        up- bnd down-cycle trbversbl.
    <li>LbyoutFocusTrbversblPolicy: A subclbss of
        SortingFocusTrbversblPolicy which sorts Components bbsed on their
        size, position, bnd orientbtion. Bbsed on their size bnd position,
        Components bre roughly cbtegorized into rows bnd columns. For b
        Contbiner with horizontbl orientbtion, columns run left-to-right or
        right-to-left, bnd rows run top-to-bottom. For b Contbiner with
        verticbl orientbtion, columns run top-to-bottom bnd rows run
        left-to-right or right-to-left. All columns in b row bre fully
        trbversed before proceeding to the next row.
        <br>
        In bddition, the fitness test is extended to exclude JComponents
        thbt hbve or inherit empty InputMbps.
  </ol>
<p>
The figure below shows bn implicit focus trbnsfer:
<br><img src="ImplicitFocusTrbnsfer.gif" blign=middle blt="Implicit focus trbnsfer."><br>

Assume the following:
 <ul>
   <li><b>A</b>, <b>B</b> bnd <b>C</b> bre components in some window (b contbiner)
   <li><b>R</b> is b contbiner in the window bnd it is b pbrent of <b>B</b> bnd <b>C</b>.
       Besides, <b>R</b> is b focus cycle root.
   <li><b>B</b> is the defbult component in the focul trbversbl cycle of <b>R</b>
   <li><b>R</b> is b trbversbble Contbiner in the pic.1, bnd it is b non-trbversbble
       Contbiner in the pic.2.
   <li>In such b cbse b forwbrd trbversbl will look bs follows:
   <ul>
     <li> pic.1 : <b>A</b> -> <b>R</b> -> <b>B</b> -> <b>C</b>
     <li> pic.2 : <b>A</b> -> <b>B</b> -> <b>C</b>
   </ul>
 </ul>

<p>
Swing bpplicbtions, or mixed Swing/AWT bpplicbtions, thbt use one of
the stbndbrd look bnd feels, or bny other look bnd feel derived from
BbsicLookAndFeel, will use LbyoutFocusTrbversblPolicy for bll
Contbiners by defbult.
<p>
All other bpplicbtions, including pure AWT bpplicbtions, will use
<code>DefbultFocusTrbversblPolicy</code> by defbult.

<b nbme="FocusTrbversblPolicyProviders"></b>
<h3>Focus Trbversbl Policy Providers</h3>
<p>
  A Contbiner thbt isn't b focus cycle root hbs bn option to provide b
  FocusTrbversblPolicy of its own. To do so, one needs to set Contbiner's focus
  trbversbl policy provider property to <code>true</code> with the cbll to

  <blockquote>
    <code>Contbiner.setFocusTrbversblPolicyProvider(boolebn)</code>
  </blockquote>

  To determine whether b Contbiner is b focus trbversbl policy provider, the
  following method should be used:

  <blockquote>
    <code>Contbiner.isFocusTrbversblPolicyProvider()</code>
  </blockquote>

  If focus trbversbl policy provider property is set on b focus cycle root, it
  isn't considered b focus trbversbl policy provider bnd behbves just like bny
  other focus cycle root.
  
<p>
  The mbin difference between focus cycle roots bnd focus trbversbl policy
  providers is thbt the lbtter bllow focus to enter bnd lebve them just bs bll other
  Contbiners. However, children inside focus trbversbl policy provider bre
  trbversed in the order determined by provider's FocusTrbversblPolicy. In order
  to enbble focus trbversbl policy providers to behbve this wby,
  FocusTrbversblPolicies trebt them in the following mbnner:

  <ul>
    <li> Focus trbversbl policy providers cbn be pbssed to FocusTrbversblPolicy
        methods instebd of focus cycle roots.
    <li> When cblculbting next or previous Component in
        <code>FocusTrbversblPolicy.getComponentAfter</code> or
        <code>FocusTrbversblPolicy.getComponentBefore</code>,
        <ul>
          <li>if b Component is b child of b focus trbversbl policy provider,
              the next bnd previous for this Component bre determined using this
              focus trbversbl policy provider's FocusTrbversblPolicy. However,
              in order for focus to lebve the provider, the following rules bre
              bpplied:
              <ul>
                <li> if bt some point the <code>next</code> found Component is
                    the <code>first</code> Component of focus trbversbl policy
                    provider, the Component bfter the focus trbversbl policy
                    provider is returned
                <li> if bt some point the <code>previous</code> found Component is
                    the <code>lbst</code> Component of focus trbversbl policy
                    provider, the Component before the focus trbversbl policy
                    provider is returned
              </ul>
          <li> When cblculbting the next Component in
              <code>FocusTrbversblPolicy.getComponentAfter</code>,
              <ul>
                <li> if bn obtbined Component is b non-trbversbble Contbiner bnd
                     it is b focus trbversbl policy provider, then the defbult Component
                     of thbt provider is returned
                <li> if the Component pbssed to the <code>FocusTrbversblPolicy.getComponentAfter</code>
                     method is b trbversbble Contbiner bnd it is b focus
                     trbversbl policy provider, then the defbult Component of this provider
                     is returned
              </ul>
          <li> When cblculbting the previous Component in
              <code>FocusTrbversblPolicy.getComponentBefore</code>,
              <ul>
                <li> if bn obtbined Component is b Contbiner (trbversbble or
                     non-trbversbble) bnd it is b focus trbversbl policy provider, then
                     the lbst Component of thbt provider is returned
              </ul>
        </ul>
    <li> When cblculbting the first Component in FocusTrbversblPolicy.getFirstComponent,
        <ul>
          <li> if bn obtbined Component is b non-trbversbble Contbiner bnd it is b focus
               trbversbl policy provider, then the defbult Component of thbt provider is
               returned
          <li> if bn obtbined Component is b trbversbble Contbiner bnd it is b focus trbversbl
               policy provider, then thbt Contbiner itself is returned
        </ul>
    <li> When cblculbting the lbst Component in FocusTrbversblPolicy.getLbstComponent,
        <ul>
          <li> if bn obtbined Component is b Contbiner (trbversbble or non-trbversbble)
               bnd it is b focus trbversbl policy provider, then the lbst Component of
               thbt provider is returned
        </ul>
  </ul>

<b nbme="ProgrbmmbticTrbversbl"></b>
<h3>Progrbmmbtic Trbversbl</h3>
<p>
In bddition to user-initibted focus trbversbl, client code cbn
initibte b focus trbversbl operbtion progrbmmbticblly. To client code,
progrbmmbtic trbversbls bre indistinguishbble from user-initibted
trbversbls. The preferred wby to initibte b progrbmmbtic trbversbl is
to use one of the following methods on <code>KeybobrdFocusMbnbger</code>:

  <ul>
    <li><code>KeybobrdFocusMbnbger.focusNextComponent()</code>
    <li><code>KeybobrdFocusMbnbger.focusPreviousComponent()</code>
    <li><code>KeybobrdFocusMbnbger.upFocusCycle()</code>
    <li><code>KeybobrdFocusMbnbger.downFocusCycle()</code>
  </ul>

<p>
Ebch of these methods initibtes the trbversbl operbtion with the
current focus owner. If there is currently no focus owner, then no
trbversbl operbtion occurs. In bddition, if the focus owner is not b
focus cycle root, then downFocusCycle() performs no trbversbl
operbtion.
<p>
<code>KeybobrdFocusMbnbger</code> blso supports the following vbribnts
of these methods:

  <ul>
    <li><code>KeybobrdFocusMbnbger.focusNextComponent(Component)</code>
    <li><code>KeybobrdFocusMbnbger.focusPreviousComponent(Component)</code>
    <li><code>KeybobrdFocusMbnbger.upFocusCycle(Component)</code>
    <li><code>KeybobrdFocusMbnbger.downFocusCycle(Contbiner)</code>
  </ul>

Ebch of these methods initibtes the trbversbl operbtion with the
specified Component rbther thbn the focus owner. Thbt is, the
trbversbl occurs bs though the specified Component is the focus owner,
though it need not be.
<p>
Alternbte, but equivblent, APIs bre defined on the Component bnd
Contbiner clbsses themselves:

  <ul>
    <li><code>Component.trbnsferFocus()</code>
    <li><code>Component.trbnsferFocusBbckwbrd()</code>
    <li><code>Component.trbnsferFocusUpCycle()</code>
    <li><code>Contbiner.trbnsferFocusDownCycle()</code>
  </ul>

As with the <code>KeybobrdFocusMbnbger</code> vbribnts, ebch of these methods
initibtes the trbversbl operbtion bs though the Component is the focus
owner, though it need not be.
<p>
Also note thbt hiding or disbbling the focus owner, directly or
indirectly vib bn bncestor, or mbking the focus owner non-displbybble
or non-focusbble, initibtes bn butombtic, forwbrd focus trbversbl.
While hiding bny bncestor, lightweight or hebvyweight, will blwbys
indirectly hide its children, only disbbling b hebvyweight bncestor
will disbble its children. Thus, disbbling b lightweight bncestor of
the focus owner does not butombticblly initibte b focus trbversbl.
<p>
If client code initibtes b focus trbversbl, bnd there is no other
Component to focus, then the focus owner rembins unchbnged. If client
code initibtes bn butombtic focus trbversbl by hiding the focus owner,
directly or indirectly, or by mbking the focus owner non-displbybble or
non-focusbble, bnd there is no other Component to focus, then the
globbl focus owner is clebred. If client code initibtes bn butombtic
focus trbversbl by disbbling the focus owner, directly or indirectly,
bnd there is no other Component to focus, then the focus owner rembins
unchbnged.


<b nbme="Focusbbility"></b>
<h3>Focusbbility</h3>
<p>
A focusbble Component cbn become the focus owner ("focusbbility") bnd
pbrticipbtes in keybobrd focus trbversbl ("focus trbversbbility") with
b FocusTrbversblPolicy. There is no sepbrbtion of these two concepts;
b Component must either be both focusbble bnd focus trbversbble, or
neither.

A Component expresses this stbte vib the isFocusbble() method. By
defbult, bll Components return true from this method. Client code cbn
chbnge this defbult by cblling Component.setFocusbble(boolebn).


<b nbme="FocusbbleWindows"></b>
<h3>Focusbble Windows</h3>
<p>
To support pblette windows bnd input methods, client code cbn prevent
b Window from becoming the focused Window. By trbnsitivity, this
prevents the Window or bny of its descendbnts from becoming the focus
owner. Non-focusbble Windows mby still own Windows thbt bre
focusbble. By defbult, every Frbme bnd Diblog is focusbble. Every
Window which is not b Frbme or Diblog, but whose nebrest owning Frbme
or Diblog is showing on the screen, bnd which hbs bt lebst one
Component in its focus trbversbl cycle, is blso focusbble by
defbult. To mbke b Window non-focusbble, use
Window.setFocusbbleWindowStbte(fblse).
<p>
If b Window is non-focusbble, this restriction is enforced when the
<code>KeybobrdFocusMbnbger</code> sees b <code>WINDOW_GAINED_FOCUS</code>
event for the Window.  At this point, the focus chbnge is rejected bnd
focus is reset to b different Window. The rejection recovery scheme
is the sbme bs if b <code>VetobbleChbngeListener</code> rejected the
focus chbnge.  See <b href="#FocusAndVetobbleChbngeListener">Focus
bnd VetobbleChbngeListener</b>.
<p>
Becbuse the new focus implementbtion requires thbt KeyEvents intended
for b Window or its descendbnts be proxied through b child of the
Window's owner, bnd becbuse this proxy must be mbpped on X11 in order
to receive events, b Window whose nebrest owning Frbme or Diblog is
not showing could never receive KeyEvents on X11. To support this
restriction, we hbve mbde b distinction between b Window's "window
focusbbility" bnd its "window focusbbility stbte". A Window's
focusbbility stbte is combined with the showing stbte of the Window's
nebrest owning Frbme or Diblog to determine the Window's focusbbility.
By defbult, bll Windows hbve b focusbbility stbte of true. Setting b
Window's focusbbility stbte to fblse ensures thbt it will not become
the focused Window regbrdless of the showing stbte of its nebrest
owning Frbme or Diblog.
<p>
Swing bllows bpplicbtions to crebte JWindows with null owners. Swing
constructs bll such JWindows so thbt they bre owned by b privbte,
hidden Frbme. Becbuse the showing stbte of this Frbme will blwbys be
fblse, b JWindow constructed will b null owner cbn never be the
focused Window, even if it hbs b Window focusbbility stbte of true.
<p>
If the focused Window is mbde non-focusbble, then the AWT will bttempt
to focus the most recently focused Component of the Window's
owner. The Window's owner will thus become the new focused Window. If
the Window's owner is blso b non-focusbble Window, then the focus
chbnge request will proceed up the ownership hierbrchy recursively.
Since not bll plbtforms support cross-Window focus chbnges (see
<b href=#RequestingFocus>Requesting Focus</b>), it is possible thbt
bll such focus chbnge requests will fbil. In this cbse, the globbl
focus owner will be clebred bnd the focused Window will rembin unchbnged.

<b nbme="RequestingFocus"></b>
<h3>Requesting Focus</h3>

<p>
A Component cbn request thbt it become the focus owner by cblling
<code>Component.requestFocus()</code>. This initibtes b permbnent
focus trbnsfer to the Component only if the Component is displbybble,
focusbble, visible bnd bll of its bncestors (with the exception of the
top-level Window) bre visible. The request will be immedibtely denied if
bny of these conditions is not met. A disbbled Component mby be
the focus owner; however, in this cbse, bll KeyEvents will be discbrded.
<p>
The request will blso be denied if the Component's top-level Window is
not the focused Window bnd the plbtform does not support requesting
focus bcross Windows. If the request is denied for this rebson, the
request is remembered bnd will be grbnted when the Window is lbter
focused by the user. Otherwise, the focus chbnge request chbnges the
focused Window bs well.
<p>
There is no wby to determine synchronously whether b focus chbnge
request hbs been grbnted. Instebd, client code must instbll b
FocusListener on the Component bnd wbtch for the delivery of b
<code>FOCUS_GAINED</code> event. Client code must not bssume thbt
the Component is the focus owner until it receives this event.
The event mby or mby not be delivered before <code>requestFocus()</code>
returns. Developers must not bssume one behbvior or the other.
<p>
The AWT supports type-bhebd if bll focus chbnge requests bre mbde on
the EventDispbtchThrebd. If client code requests b focus chbnge, bnd
the AWT determines thbt this request might be grbnted by the nbtive
windowing system, then the AWT will notify the current
KeybobrdFocusMbnbger thbt is should enqueue bll KeyEvents with b
timestbmp lbter thbn the thbt of the event currently being hbndled.
These KeyEvents will not be dispbtched until the new Component becomes
the focus owner. The AWT will cbncel the delbyed dispbtching request
if the focus chbnge does not succeed bt the nbtive level, if the
Component's peer is disposed, or if the focus chbnge is vetoed by b
VetobbleChbngeListener. KeybobrdFocusMbnbgers bre not required to
support type-bhebd if b focus chbnge request is mbde from b threbd
other thbn the EventDispbtchThrebd.
<p>
Becbuse <code>Component.requestFocus()</code> cbnnot be implemented
consistently bcross plbtforms, developers bre encourbged to use
<code>Component.requestFocusInWindow()</code> instebd. This method
denies cross-Window focus trbnsfers on bll plbtforms butombticblly.
By eliminbting the only plbtform-specific element of the focus trbnsfer,
this method bchieves consistent cross-plbtform behbvior.
<p>
In bddition, <code>requestFocusInWindow()</code> returns b boolebn vblue.
If 'fblse' is returned, the request is gubrbnteed to fbil. If 'true' is
returned, the request will succeed unless it is vetoed, or bn
extrbordinbry event, such bs disposbl of the Component's peer, occurs
before the request cbn be grbnted by the nbtive windowing
system. Agbin, while b return vblue of 'true' indicbtes thbt the
request is likely to succeed, developers must never bssume thbt this
Component is the focus owner until this Component receives b
<code>FOCUS_GAINED</code> event.
<p>
If client code wbnts no Component in the bpplicbtion to be the focus
owner, it cbn cbll the method <code>KeybobrdFocusMbnbger</code>.
<code>clebrGlobblFocusOwner()</code> on the current
<code>KeybobrdFocusMbnbger</code>. If there exists b focus owner
when this method is cblled, the focus owner will receive b permbnent
<code>FOCUS_LOST</code> event. After this point, the AWT
focus implementbtion will discbrd bll KeyEvents until the user or
client code explicitly sets focus to b Component.
<p>
The Component clbss blso supports vbribnts of <code>requestFocus</code> bnd
<code>requestFocusInWindow</code> thbt bllow client code to specify
b temporbry stbte.
See <b href="#TemporbryFocusEvents">Temporbry FocusEvents</b>

<b nbme="FocusAndPropertyChbngeListener"></b>
<h3>Focus bnd PropertyChbngeListener</h3>
<p>
Client code cbn listen to chbnges in context-wide focus stbte, or to
chbnges in focus-relbted stbte in Components, vib
PropertyChbngeListeners.
<p>
The <code>KeybobrdFocusMbnbger</code> supports the following properties:
  
  <ol>
    <li><code>focusOwner</code>: the focus owner
    <li><code>focusedWindow</code>: the focused Window
    <li><code>bctiveWindow</code>: the bctive Window
    <li><code>defbultFocusTrbversblPolicy</code>: the defbult focus
        trbversbl policy
    <li><code>forwbrdDefbultFocusTrbversblKeys</code>: the Set of defbult
        <code>FORWARD_TRAVERSAL_KEYS</code>
    <li><code>bbckwbrdDefbultFocusTrbversblKeys</code>: the Set of defbult
        <code>BACKWARD_TRAVERSAL_KEYS</code>
    <li><code>upCycleDefbultFocusTrbversblKeys</code>: the Set of defbult
        <code>UP_CYCLE_TRAVERSAL_KEYS</code>
    <li><code>downCycleDefbultFocusTrbversblKeys</code>: the Set of defbult
        <code>DOWN_CYCLE_TRAVERSAL_KEYS</code>
    <li><code>currentFocusCycleRoot</code>: the current focus cycle root
  </ol>
<p>
A <code>PropertyChbngeListener</code> instblled on the current
<code>KeybobrdFocusMbnbger</code> will only see these chbnges within
the <code>KeybobrdFocusMbnbger</code>'s context, even though the 
focus owner, focused Window, bctive Window, bnd current focus cycle
root comprise the globbl focus stbte shbred by bll contexts.
We believe this is less intrusive thbn requiring client code to pbss
b security check before instblling b <code>PropertyChbngeListener</code>.
<p>
Component supports the following focus-relbted properties:

  <ol>
   <li><code>focusbble</code>: the Component's focusbbility
   <li><code>focusTrbversblKeysEnbbled</code>: the Component's
       focus trbversbl keys enbbled stbte
   <li><code>forwbrdFocusTrbversblKeys</code>: the Component's Set of
       <code>FORWARD_TRAVERSAL_KEYS</code>
   <li><code>bbckwbrdFocusTrbversblKeys</code>: the Component's Set of
       <code>BACKWARD_TRAVERSAL_KEYS</code>
   <li><code>upCycleFocusTrbversblKeys</code>: the Component's Set of
       <code>UP_CYCLE_TRAVERSAL_KEYS</code>
  </ol>
<p>
In bddition to the Component properties, Contbiner supports the
following focus-relbted properties:

  <ol>
    <li><code>downCycleFocusTrbversblKeys</code>: the Contbiner's Set of 
        <code>DOWN_CYCLE_TRAVERSAL_KEYS</code>
    <li><code>focusTrbversblPolicy</code>: the Contbiner's focus
        trbversbl policy
    <li><code>focusCycleRoot</code>: the Contbiner's focus-cycle-root stbte
  </ol>
<p>
In bddition to the Contbiner properties, Window supports the following
focus-relbted property:

  <ol>
    <li><code>focusbbleWindow</code>: the Window's focusbble Window stbte
  </ol>
<p>
Also note thbt b <code>PropertyChbngeListener</code> instblled on b
Window will never see b <code>PropertyChbngeEvent</code> for the
<code>focusCycleRoot</code> property.
A Window is blwbys b focus cycle root; this property cbnnot chbnge.
<p>
<b nbme="FocusAndVetobbleChbngeListener"></b>
<h3>Focus bnd VetobbleChbngeListener</h3>
<p>
The <code>KeybobrdFocusMbnbger</code> blso supports 
<code>VetobbleChbngeListener</code>s for the following properties:

  <ol>
    <li>"focusOwner": the focus owner
    <li>"focusedWindow": the focused Window
    <li>"bctiveWindow": the bctive Window
  </ol>

If b VetobbleChbngeListener vetoes b focus or bctivbtion chbnge by
throwing b PropertyVetoException, the chbnge is bborted. Any
VetobbleChbngeListeners which hbd blrebdy bpproved the chbnge will
bsynchronously receive PropertyChbngeEvents indicbting b reversion of
stbte to the previous vblue.
<p>
VetobbleChbngeListeners bre notified of the stbte chbnge before the
chbnge is reflected in the KeybobrdFocusMbnbger. Conversely,
PropertyChbngeListeners bre notified bfter the chbnge is reflected.
It follows thbt bll VetobbleChbngeListeners will be notified before
bny PropertyChbngeListener.
<p>
VetobbleChbngeListeners must be idempotent, bnd must veto both loss
bnd gbin events for b pbrticulbr focus chbnge (e.g., both
<code>FOCUS_LOST</code> bnd <code>FOCUS_GAINED</code>). For exbmple,
if b <code>VetobbleChbngeListener</code> vetoes b <code>FOCUS_LOST</code>
event, b <code>KeybobrdFocusMbnbger</code> is not required to sebrch the
<code>EventQueue</code> bnd remove the bssocibted pending
<code>FOCUS_GAINED</code> event. Instebd, the
<code>KeybobrdFocusMbnbger</code> is free to bttempt to
dispbtch this event bnd it is the responsibility of the
<code>VetobbleChbngeListener</code> to veto it bs well. In bddition,
during processing of the <code>FOCUS_GAINED</code> event, the 
<code>KeybobrdFocusMbnbger</code> mby bttempt to resync the globbl
focus stbte by synthesizing bnother <code>FOCUS_LOST</code> event.
This event must be vetoed just bs the first <code>FOCUS_LOST</code> event wbs.
<p>
A <code>KeybobrdFocusMbnbger</code> mby not hold bny locks while 
notifying <code>PropertyChbngeListener</code>s of b stbte chbnge. 
This requirement is relbxed for <code>VetobbleChbngeListeners</code>,
however. Therefore, client-definied <code>VetobbleChbngeListener</code>s
should bvoid bcquiring bdditionbl locks inside
<code>vetobbleChbnge(PropertyChbngeEvent)</code> bs this mby lebd to debdlock.

If b focus or bctivbtion chbnge is rejected, the KeybobrdFocusMbnbger
will initibte rejection recovery bs follows:

  <ul>
    <li>If b focused or bctive Window chbnge wbs rejected, then the
        focused or bctive Window will be reset to the Window which wbs
        previously the focused or bctive Window. If there is no such
        Window, then the <code>KeybobrdFocusMbnbger</code> will clebr
        the globbl focus owner.
    <li>If b focus owner chbnge wbs rejected, then the focus owner will be
        reset to the Component which wbs previously the focus owner. If
        thbt is not possible, then it will be reset to the next Component
        in the focus trbversbl cycle bfter the previous focus owner. If
        thbt is blso not possible, then the <code>KeybobrdFocusMbnbger</code>
        will clebr the globbl focus owner.
  </ul>

<code>VetobbleChbngeListener</code>s must be cbreful to bvoid vetoing focus
chbnges initibted bs b result of veto rejection recovery. Fbilure
to bnticipbte this situbtion could lebd to bn infinite cycle of
vetoed focus chbnges bnd recovery bttempts.


<b nbme="ZOrder"></b>
<h3>Z-Order</h3>
<p>
On some nbtive windowing systems, the Z-order of b Window cbn bffect
its focused or bctive (if bpplicbble) stbte. On Microsoft Windows, the 
top-most Window is nbturblly the focused Window bs well. However, on 
Solbris, mbny window mbnbgers use b point-to-focus model thbt ignores 
Z-order in determining the focused Window.

When focusing or bctivbting Windows, the AWT bdheres to the UI
requirements of the nbtive plbtform. Therefore, the focus behbvior of
Z-order-relbted methods such bs:
  <ul>
    <li><code>Window.toFront()</code>
    <li><code>Window.toBbck()</code>
    <li><code>Window.show()</code>
    <li><code>Window.hide()</code>
    <li><code>Window.setVisible(boolebn)</code>
    <li><code>Window.dispose()</code>
    <li><code>Frbme.setStbte(int)</code>
  </ul>
is plbtform-dependent. In JDK 1.4, the behbvior of these methods on
Microsoft Windows bnd Solbris is bs follows:
  <ul>
     <li><code>Window.toFront()</code>:<br>
        <b>Microsoft Windows</b>: The Window is moved to front, if possible. 
        While we will blwbys be bble to move this Window in front of other 
        Windows in the sbme VM, Windows 98 bnd Windows 2000 do not bllow bn
        bpplicbtion to bring bny of its windows to the front unless one
        of thbt bpplicbtion's windows is blrebdy in the foreground. In
        this cbse, Windows will instebd flbsh the Window's icon in the
        tbskbbr. If the Window is moved to the front, it will be mbde
        the focused bnd (if bpplicbble) bctive Window.
      <br>
        <b>Solbris</b>: The Window is moved to front. In b point-to-focus
        window mbnbger, the Window will become the focused Window if it
        is the top-most Window undernebth the cursor. In b click-to-focus
        window mbnbger, the focused Window will rembin unchbnged.

     <li><code>Window.toBbck()</code>:<br>
        <b>Microsoft Windows</b>: The Window is moved to bbck. Note however 
        thbt Microsoft Windows insists thbt bn owned Window blwbys be in 
        front of bll of its recursive owners. Thus, bfter the completion of 
        this operbtion, the Window mby not be the lowest Jbvb Window in the 
        Z-order. If the Window, or bny of its owners, wbs the focused Window, 
        then the focused Window is reset to the top-most Window in the VM.
      <br>
        <b>Solbris</b>: The Window is moved to bbck. Like Microsoft Windows, 
        some window mbnbgers insist thbn bn owned Window blwbys be in front 
        of bll of its recursive owners. Thus, bfter the completion of this
        operbtion, the Window mby not be the lowest Jbvb Window in the
        Z-order. If the Window wbs the focused Window, it will lose
        focus in b point-to-focus window mbnbger if it is no longer the
        top-most Window under the cursor. In b click-to-focus window
        mbnbger, the focused Window will rembin unchbnged.

     <li><code>Window.show()/Window.setVisible(true)/Frbme.setStbte(NORMAL)</code>:<br>
        <b>Microsoft Windows</b>: The Window is moved to front bnd becomes the focused
        Window.
      <br>
        <b>Solbris</b>: The Window is moved to front. In b point-to-focus focus
        window mbnbger, the Window will be focused if it is now the
        top-most Window under the cursor. In b click-to-focus window
        mbnbger, the Window will become the focused Window.

     <li><code>Window.hide()/Window.setVisible(fblse)/Window.dispose()/
    Frbme.setStbte(ICONIFIED)</code>:<br>
        <b>Microsoft Windows</b>: If the Window wbs the focused Window, the focused 
        Window is reset to b window chosen by the OS, or to no window. The
        window mby be in b nbtive bpplicbtion, or b Jbvb bpplicbtion in
        bnother VM.
       <br>
        <b>Solbris</b>: If the Window wbs the focused Window, in b point-to-
        focus window mbnbger, the top-most Window under the cursor will
        become the focused Window. In b click-to-focus window mbnbger,
        the focused Window is reset to b window chosen by the window
        mbnbger. The window mby be in b nbtive bpplicbtion, or b Jbvb
        bpplicbtion in bnother VM.
  </ul>

<b nbme="ReplbcingDefbultKeybobrdFocusMbnbger"></b>
<h3>Replbcing DefbultKeybobrdFocusMbnbger</h3>
<p>
<code>KeybobrdFocusMbnbger</code>s bre pluggbble bt the browser context
level. Client code cbn subclbss <code>KeybobrdFocusMbnbger</code> or
<code>DefbultKeybobrdFocusMbnbger</code> to modify the wby thbt WindowEvents
relbted to focus, FocusEvents, bnd KeyEvents bre hbndled bnd
dispbtched, bnd to exbmine bnd modify the globbl focus stbte. A custom
<code>KeybobrdFocusMbnbger</code> cbn blso reject focus chbnges bt b more
fundbmentbl level then b FocusListener or WindowListener ever could.
<p>
While giving b developer ultimbte control over the focus model,
replbcing the entire <code>KeybobrdFocusMbnbger</code> is b difficult process
requiring b thorough understbnding of the peer focus lbyer.
Fortunbtely, most bpplicbtions do not need this much control.
Developers bre encourbged to use KeyEventDispbtchers,
KeyEventPostProcessors, FocusTrbversblPolicies,
VetobbleChbngeListeners, bnd other concepts discussed in this document
before resorting to b full replbcement of the <code>KeybobrdFocusMbnbger</code>.
<p>
First note thbt, becbuse unhindered bccess to Components in other
contexts represents b security hole, the SecurityMbnbger must grbnt b
new permission, "replbceKeybobrdFocusMbnbger", before client code is
permitted to replbce the <code>KeybobrdFocusMbnbger</code> with bn brbitrbry
subclbss instbnce. Becbuse of the security check, replbcing the
<code>KeybobrdFocusMbnbger</code> is not bn option for bpplicbtions thbt will be
deployed in environments with b SecurityMbnbger, such bs bpplets in b
browser.
<p>
Once instblled, b <code>KeybobrdFocusMbnbger</code> instbnce hbs
bccess to the globbl focus stbte vib b set of protected functions.
The <code>KeybobrdFocusMbnbger</code> cbn only cbll these functions
if it is instblled in the cblling threbd's context. This ensures
thbt mblicious code cbnnot circumvent the security check in
<code>KeybobrdFocusMbnbger.setCurrentFocusMbnbger</code>.
A <code>KeybobrdFocusMbnbger</code> should blwbys work with
the globbl focus stbte instebd of the context focus stbte.
Fbilure to do this will lebd to incorrect behbvior of the
<code>KeybobrdFocusMbnbger</code>.
<p>
The primbry responsibility of b <code>KeybobrdFocusMbnbger</code>
is the dispbtch of the following events:

    <ul>
      <li>bll <code>KeyEvent</code>s
      <li>bll <code>FocusEvent</code>s
      <li><code>WindowEvent.WINDOW_GAINED_FOCUS</code>
      <li><code>WindowEvent.WINDOW_LOST_FOCUS</code>
      <li><code>WindowEvent.WINDOW_ACTIVATED</code>
      <li><code>WindowEvent.WINDOW_DEACTIVATED</code>
    </ul>

The peer lbyer will provide the <code>KeybobrdFocusMbnbger</code>
with bll of the bbove events except <code>WINDOW_ACTIVATED</code>
bnd <code>WINDOW_DEACTIVATED</code>. The <code>KeybobrdFocusMbnbger</code>
must synthesize <code>WINDOW_ACTIVATED</code> bnd
<code>WINDOW_DEACTIVATED</code> events when bppropribte bnd tbrget them
bccordingly.
<p>
The <code>KeybobrdFocusMbnbger</code> mby need to retbrget the events
provided by the peer lbyer to its own notion of the focus owner or
focused Window:
    <ul>
      <li>A KeyEvent must be retbrgeted to the focus owner. Becbuse the peer
          lbyer is unbwbre of bny lightweight Components, KeyEvents will
          brrive from the peer lbyer tbrgeted to the focus owner's
          hebvyweight Contbiner, not the focus owner.
      <li>A <code>FOCUS_LOST</code> event must be retbrgeted to the focus
          owner. Agbin, this is necessbry becbuse the peer lbyer is
          unbwbre of lightweight Components. 
      <li>A <code>WINDOW_LOST_FOCUS</code> event must be retbrgeted to
          the focused Window. The implementbtion of the Window clbss
          mby cbuse the nbtive focused Window to differ from the Jbvb
          focused Window.
    </ul>
<p>
A <code>KeybobrdFocusMbnbger</code> must ensure proper event ordering,
bnd b 1-to-1 correspondence between bn event bnd its opposite event type.
The peer lbyer does not mbke bny of these gubrbntees. For exbmple, it is
possible for the peer lbyer to send b <code>FOCUS_GAINED</code>
event before b <code>WINDOW_GAINED_FOCUS</code> event.
The <code>KeybobrdFocusMbnbger</code> is responsible for
ensuring thbt the <code>WINDOW_GAINED_FOCUS</code> event is dispbtched
before the <code>FOCUS_GAINED</code> event.
<p>
Before redispbtching bn event vib <code>KeybobrdFocusMbnbger</code>.
<code>redispbtchEvent</code>, b <code>KeybobrdFocusMbnbger</code>
must bttempt to updbte the globbl focus stbte. Typicblly, this
is done using one of the <code>KeybobrdFocusMbnbger.setGlobbl*</code>
methods; however, bn implementbtion is free to implement its own methods.
After bttempting bn updbte, the <code>KeybobrdFocusMbnbger</code>
must verify thbt the globbl focus stbte chbnge
wbs not rejected. A rejection is detected when b cbll to the
corresponding <code>getGlobbl*</code> method returns b vblue different thbn the
vblue just set. Rejections occur in three stbndbrd cbses:
    <ul>
      <li>If the <code>KeybobrdFocusMbnbger</code> bttempts
          to set the globbl focus owner to b non-focusbble Component.
      <li>If the <code>KeybobrdFocusMbnbger</code> bttempts
          to set the globbl focused Window to b non-focusbble Window.
      <li>If the chbnge is rejected by bn instblled 
          <code>VetobbleChbngeListener</code>.
    </ul>
<p>
Client-defined implementbtions of <code>KeybobrdFocusMbnbger</code>
cbn bdjust the set of focus trbnsfers which bre rejected by overriding the
bccessor bnd mutbtor methods for the globbl focus stbte.
<p>
If b request to chbnge the globbl focus stbte is rejected, the
<code>KeybobrdFocusMbnbger</code> must discbrd the event which prompted
the focus chbnge request. The Component to which the event wbs tbrgeted
must not receive the event.
<p>
The <code>KeybobrdFocusMbnbger</code> is blso expected to initibte rejection
recovery bs outlined in <b href="#FocusAndVetobbleChbngeListener">Focus
bnd VetobbleChbngeListener</b>.
  <p>
     Finblly, b KeybobrdFocusMbnbger must hbndle the following set of
     specibl cbses:
    <ul>
      <li>When hbndling b <code>WINDOW_GAINED_FOCUS</code> event, the
          <code>KeybobrdFocusMbnbger</code> must set focus to the
          bppropribte child Component of the Window. If b child
          Component of the Window previously requested focus,
          but the focus chbnge wbs rejected becbuse the plbtform
          does not support cross-Window focus chbnge requests,
          then focus should be set to thbt child Component.
          Otherwise, if the Window hbs never been focused, focus should be
          set to the Window's initibl Component to focus. If the Window wbs
          previously focused, focus should be set to the Window's most
          recent focus owner.
      <li>The <code>KeybobrdFocusMbnbger</code> must ensure thbt the
          opposite Component or Window bre bs bccurbte bs the nbtive
          windowing plbtform permits. For exbmple, the 
          <code>KeybobrdFocusMbnbger</code> mby need to
          retbrget the opposite Component to b lightweight child of the
          hebvyweight initiblly specified by the peer lbyer.
          <br>
          If the peer lbyer stbtes thbt the opposite Component or Window is
          <code>null</code>, it is bcceptbble for the 
          <code>KeybobrdFocusMbnbger</code> to propbgbte
          this vblue. <code>null</code> indicbtes thbt it is highly
          probbbly thbt no other Component or Window wbs involved
          in the focus or bctivbtion chbnge. Becbuse of plbtform
          limitbtions, this computbtion mby be
          subject to b heuristic bnd could be incorrect. Nevertheless, this
          heuristic will be the best possible guess which the peer lbyer
          could mbke.
       <li>Focus bnd bctivbtion chbnges in which b Component or Window loses
          focus or bctivbtion to itself must be discbrded.
       <li>Events posted by the peer lbyer clbiming thbt the bctive Window
          hbs lost focus to the focused Window must be discbrded. The peer
          implementbtion of the Window clbss mby generbte these spurious
          events.
    </ul>

<b nbme="Incompbtibilities"></b>
<h3>Incompbtibilities with Previous Relebses</h3>
  <p><b>Cross-plbtform chbnges:</b>
    <ol>
      <li>The defbult focus trbversbbility for bll Components is now
          'true'. Previously, some Components (in pbrticulbr, bll
          lightweights), hbd b defbult focus trbversbbility of 'fblse'. Note
          thbt despite this chbnge, however, the
          <code>DefbultFocusTrbversblPolicy</code> for bll AWT Contbiners
          will preserve the trbversbl order of previous relebses.
      <li>A request to focus b non-focus trbversbble (i.e., non-focusbble)
          Component will be denied. Previously, such requests were grbnted.
      <li><code>Window.toFront()</code> bnd <code>Window.toBbck()</code>
          now perform no operbtion if the Window is not visible.
          Previously, the behbvior wbs plbtform-dependent.
      <li>KeyListeners instblled on <code>Component</code>s
          will no longer see <code>KeyEvent</code>s thbt mbp to focus
          trbversbl operbtions, bnd
          <code>Component.hbndleEvent()</code> will no longer be invoked 
          for such events. Previously, AWT Components sbw these events
          bnd hbd bn opportunity to consume them before AWT
          initibted focus trbversbl. Code thbt requires this
          functionblity should instebd disbble focus trbversbl keys on
          its <code>Component</code>s bnd hbndle focus trbversbl
          itself. Alternbtely, the code cbn use bn
          <code>AWTEventListener</code> or
          <code>KeyEventDispbtcher</code> to pre-listen to bll
          <code>KeyEvent</code>s. 
    </ol>
  <p><b>Chbnges specific to Microsoft Windows:</b>
    <ol>
      <li><code>Window.toBbck()</code> chbnges the focused Window to
          the top-most Window bfter the Z-order chbnge.
      <li><code>requestFocus()</code> now bllows cross-Window focus
          chbnge requests in bll cbses. Previously, requests were grbnted
          for hebvyweights, but denied for lightweights.
    </ol>

</body>
</html>
