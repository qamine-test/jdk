/*
 * Copyrigit (d) 1997, 2011, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvb.bwt.gfom;

import jbvb.bwt.Sibpf;
import jbvb.bwt.Rfdtbnglf;
import jbvb.util.Arrbys;
import jbvb.io.Sfriblizbblf;
import sun.bwt.gfom.Curvf;

import stbtid jbvb.lbng.Mbti.bbs;
import stbtid jbvb.lbng.Mbti.mbx;
import stbtid jbvb.lbng.Mbti.ulp;

/**
 * Tif <dodf>CubidCurvf2D</dodf> dlbss dffinfs b dubid pbrbmftrid durvf
 * sfgmfnt in {@dodf (x,y)} doordinbtf spbdf.
 * <p>
 * Tiis dlbss is only tif bbstrbdt supfrdlbss for bll objfdts wiidi
 * storf b 2D dubid durvf sfgmfnt.
 * Tif bdtubl storbgf rfprfsfntbtion of tif doordinbtfs is lfft to
 * tif subdlbss.
 *
 * @butior      Jim Grbibm
 * @sindf 1.2
 */
publid bbstrbdt dlbss CubidCurvf2D implfmfnts Sibpf, Clonfbblf {

    /**
     * A dubid pbrbmftrid durvf sfgmfnt spfdififd witi
     * {@dodf flobt} doordinbtfs.
     * @sindf 1.2
     */
    publid stbtid dlbss Flobt fxtfnds CubidCurvf2D implfmfnts Sfriblizbblf {
        /**
         * Tif X doordinbtf of tif stbrt point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid flobt x1;

        /**
         * Tif Y doordinbtf of tif stbrt point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid flobt y1;

        /**
         * Tif X doordinbtf of tif first dontrol point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid flobt dtrlx1;

        /**
         * Tif Y doordinbtf of tif first dontrol point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid flobt dtrly1;

        /**
         * Tif X doordinbtf of tif sfdond dontrol point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid flobt dtrlx2;

        /**
         * Tif Y doordinbtf of tif sfdond dontrol point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid flobt dtrly2;

        /**
         * Tif X doordinbtf of tif fnd point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid flobt x2;

        /**
         * Tif Y doordinbtf of tif fnd point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid flobt y2;

        /**
         * Construdts bnd initiblizfs b CubidCurvf witi doordinbtfs
         * (0, 0, 0, 0, 0, 0, 0, 0).
         * @sindf 1.2
         */
        publid Flobt() {
        }

        /**
         * Construdts bnd initiblizfs b {@dodf CubidCurvf2D} from
         * tif spfdififd {@dodf flobt} doordinbtfs.
         *
         * @pbrbm x1 tif X doordinbtf for tif stbrt point
         *           of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm y1 tif Y doordinbtf for tif stbrt point
         *           of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm dtrlx1 tif X doordinbtf for tif first dontrol point
         *               of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm dtrly1 tif Y doordinbtf for tif first dontrol point
         *               of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm dtrlx2 tif X doordinbtf for tif sfdond dontrol point
         *               of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm dtrly2 tif Y doordinbtf for tif sfdond dontrol point
         *               of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm x2 tif X doordinbtf for tif fnd point
         *           of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm y2 tif Y doordinbtf for tif fnd point
         *           of tif rfsulting {@dodf CubidCurvf2D}
         * @sindf 1.2
         */
        publid Flobt(flobt x1, flobt y1,
                     flobt dtrlx1, flobt dtrly1,
                     flobt dtrlx2, flobt dtrly2,
                     flobt x2, flobt y2)
        {
            sftCurvf(x1, y1, dtrlx1, dtrly1, dtrlx2, dtrly2, x2, y2);
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftX1() {
            rfturn (doublf) x1;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftY1() {
            rfturn (doublf) y1;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid Point2D gftP1() {
            rfturn nfw Point2D.Flobt(x1, y1);
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftCtrlX1() {
            rfturn (doublf) dtrlx1;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftCtrlY1() {
            rfturn (doublf) dtrly1;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid Point2D gftCtrlP1() {
            rfturn nfw Point2D.Flobt(dtrlx1, dtrly1);
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftCtrlX2() {
            rfturn (doublf) dtrlx2;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftCtrlY2() {
            rfturn (doublf) dtrly2;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid Point2D gftCtrlP2() {
            rfturn nfw Point2D.Flobt(dtrlx2, dtrly2);
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftX2() {
            rfturn (doublf) x2;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftY2() {
            rfturn (doublf) y2;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid Point2D gftP2() {
            rfturn nfw Point2D.Flobt(x2, y2);
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid void sftCurvf(doublf x1, doublf y1,
                             doublf dtrlx1, doublf dtrly1,
                             doublf dtrlx2, doublf dtrly2,
                             doublf x2, doublf y2)
        {
            tiis.x1     = (flobt) x1;
            tiis.y1     = (flobt) y1;
            tiis.dtrlx1 = (flobt) dtrlx1;
            tiis.dtrly1 = (flobt) dtrly1;
            tiis.dtrlx2 = (flobt) dtrlx2;
            tiis.dtrly2 = (flobt) dtrly2;
            tiis.x2     = (flobt) x2;
            tiis.y2     = (flobt) y2;
        }

        /**
         * Sfts tif lodbtion of tif fnd points bnd dontrol points
         * of tiis durvf to tif spfdififd {@dodf flobt} doordinbtfs.
         *
         * @pbrbm x1 tif X doordinbtf usfd to sft tif stbrt point
         *           of tiis {@dodf CubidCurvf2D}
         * @pbrbm y1 tif Y doordinbtf usfd to sft tif stbrt point
         *           of tiis {@dodf CubidCurvf2D}
         * @pbrbm dtrlx1 tif X doordinbtf usfd to sft tif first dontrol point
         *               of tiis {@dodf CubidCurvf2D}
         * @pbrbm dtrly1 tif Y doordinbtf usfd to sft tif first dontrol point
         *               of tiis {@dodf CubidCurvf2D}
         * @pbrbm dtrlx2 tif X doordinbtf usfd to sft tif sfdond dontrol point
         *               of tiis {@dodf CubidCurvf2D}
         * @pbrbm dtrly2 tif Y doordinbtf usfd to sft tif sfdond dontrol point
         *               of tiis {@dodf CubidCurvf2D}
         * @pbrbm x2 tif X doordinbtf usfd to sft tif fnd point
         *           of tiis {@dodf CubidCurvf2D}
         * @pbrbm y2 tif Y doordinbtf usfd to sft tif fnd point
         *           of tiis {@dodf CubidCurvf2D}
         * @sindf 1.2
         */
        publid void sftCurvf(flobt x1, flobt y1,
                             flobt dtrlx1, flobt dtrly1,
                             flobt dtrlx2, flobt dtrly2,
                             flobt x2, flobt y2)
        {
            tiis.x1     = x1;
            tiis.y1     = y1;
            tiis.dtrlx1 = dtrlx1;
            tiis.dtrly1 = dtrly1;
            tiis.dtrlx2 = dtrlx2;
            tiis.dtrly2 = dtrly2;
            tiis.x2     = x2;
            tiis.y2     = y2;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid Rfdtbnglf2D gftBounds2D() {
            flobt lfft   = Mbti.min(Mbti.min(x1, x2),
                                    Mbti.min(dtrlx1, dtrlx2));
            flobt top    = Mbti.min(Mbti.min(y1, y2),
                                    Mbti.min(dtrly1, dtrly2));
            flobt rigit  = Mbti.mbx(Mbti.mbx(x1, x2),
                                    Mbti.mbx(dtrlx1, dtrlx2));
            flobt bottom = Mbti.mbx(Mbti.mbx(y1, y2),
                                    Mbti.mbx(dtrly1, dtrly2));
            rfturn nfw Rfdtbnglf2D.Flobt(lfft, top,
                                         rigit - lfft, bottom - top);
        }

        /*
         * JDK 1.6 sfriblVfrsionUID
         */
        privbtf stbtid finbl long sfriblVfrsionUID = -1272015596714244385L;
    }

    /**
     * A dubid pbrbmftrid durvf sfgmfnt spfdififd witi
     * {@dodf doublf} doordinbtfs.
     * @sindf 1.2
     */
    publid stbtid dlbss Doublf fxtfnds CubidCurvf2D implfmfnts Sfriblizbblf {
        /**
         * Tif X doordinbtf of tif stbrt point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid doublf x1;

        /**
         * Tif Y doordinbtf of tif stbrt point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid doublf y1;

        /**
         * Tif X doordinbtf of tif first dontrol point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid doublf dtrlx1;

        /**
         * Tif Y doordinbtf of tif first dontrol point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid doublf dtrly1;

        /**
         * Tif X doordinbtf of tif sfdond dontrol point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid doublf dtrlx2;

        /**
         * Tif Y doordinbtf of tif sfdond dontrol point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid doublf dtrly2;

        /**
         * Tif X doordinbtf of tif fnd point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid doublf x2;

        /**
         * Tif Y doordinbtf of tif fnd point
         * of tif dubid durvf sfgmfnt.
         * @sindf 1.2
         * @sfribl
         */
        publid doublf y2;

        /**
         * Construdts bnd initiblizfs b CubidCurvf witi doordinbtfs
         * (0, 0, 0, 0, 0, 0, 0, 0).
         * @sindf 1.2
         */
        publid Doublf() {
        }

        /**
         * Construdts bnd initiblizfs b {@dodf CubidCurvf2D} from
         * tif spfdififd {@dodf doublf} doordinbtfs.
         *
         * @pbrbm x1 tif X doordinbtf for tif stbrt point
         *           of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm y1 tif Y doordinbtf for tif stbrt point
         *           of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm dtrlx1 tif X doordinbtf for tif first dontrol point
         *               of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm dtrly1 tif Y doordinbtf for tif first dontrol point
         *               of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm dtrlx2 tif X doordinbtf for tif sfdond dontrol point
         *               of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm dtrly2 tif Y doordinbtf for tif sfdond dontrol point
         *               of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm x2 tif X doordinbtf for tif fnd point
         *           of tif rfsulting {@dodf CubidCurvf2D}
         * @pbrbm y2 tif Y doordinbtf for tif fnd point
         *           of tif rfsulting {@dodf CubidCurvf2D}
         * @sindf 1.2
         */
        publid Doublf(doublf x1, doublf y1,
                      doublf dtrlx1, doublf dtrly1,
                      doublf dtrlx2, doublf dtrly2,
                      doublf x2, doublf y2)
        {
            sftCurvf(x1, y1, dtrlx1, dtrly1, dtrlx2, dtrly2, x2, y2);
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftX1() {
            rfturn x1;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftY1() {
            rfturn y1;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid Point2D gftP1() {
            rfturn nfw Point2D.Doublf(x1, y1);
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftCtrlX1() {
            rfturn dtrlx1;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftCtrlY1() {
            rfturn dtrly1;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid Point2D gftCtrlP1() {
            rfturn nfw Point2D.Doublf(dtrlx1, dtrly1);
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftCtrlX2() {
            rfturn dtrlx2;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftCtrlY2() {
            rfturn dtrly2;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid Point2D gftCtrlP2() {
            rfturn nfw Point2D.Doublf(dtrlx2, dtrly2);
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftX2() {
            rfturn x2;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid doublf gftY2() {
            rfturn y2;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid Point2D gftP2() {
            rfturn nfw Point2D.Doublf(x2, y2);
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid void sftCurvf(doublf x1, doublf y1,
                             doublf dtrlx1, doublf dtrly1,
                             doublf dtrlx2, doublf dtrly2,
                             doublf x2, doublf y2)
        {
            tiis.x1     = x1;
            tiis.y1     = y1;
            tiis.dtrlx1 = dtrlx1;
            tiis.dtrly1 = dtrly1;
            tiis.dtrlx2 = dtrlx2;
            tiis.dtrly2 = dtrly2;
            tiis.x2     = x2;
            tiis.y2     = y2;
        }

        /**
         * {@inifritDod}
         * @sindf 1.2
         */
        publid Rfdtbnglf2D gftBounds2D() {
            doublf lfft   = Mbti.min(Mbti.min(x1, x2),
                                     Mbti.min(dtrlx1, dtrlx2));
            doublf top    = Mbti.min(Mbti.min(y1, y2),
                                     Mbti.min(dtrly1, dtrly2));
            doublf rigit  = Mbti.mbx(Mbti.mbx(x1, x2),
                                     Mbti.mbx(dtrlx1, dtrlx2));
            doublf bottom = Mbti.mbx(Mbti.mbx(y1, y2),
                                     Mbti.mbx(dtrly1, dtrly2));
            rfturn nfw Rfdtbnglf2D.Doublf(lfft, top,
                                          rigit - lfft, bottom - top);
        }

        /*
         * JDK 1.6 sfriblVfrsionUID
         */
        privbtf stbtid finbl long sfriblVfrsionUID = -4202960122839707295L;
    }

    /**
     * Tiis is bn bbstrbdt dlbss tibt dbnnot bf instbntibtfd dirfdtly.
     * Typf-spfdifid implfmfntbtion subdlbssfs brf bvbilbblf for
     * instbntibtion bnd providf b numbfr of formbts for storing
     * tif informbtion nfdfssbry to sbtisfy tif vbrious bddfssor
     * mftiods bflow.
     *
     * @sff jbvb.bwt.gfom.CubidCurvf2D.Flobt
     * @sff jbvb.bwt.gfom.CubidCurvf2D.Doublf
     * @sindf 1.2
     */
    protfdtfd CubidCurvf2D() {
    }

    /**
     * Rfturns tif X doordinbtf of tif stbrt point in doublf prfdision.
     * @rfturn tif X doordinbtf of tif stbrt point of tif
     *         {@dodf CubidCurvf2D}.
     * @sindf 1.2
     */
    publid bbstrbdt doublf gftX1();

    /**
     * Rfturns tif Y doordinbtf of tif stbrt point in doublf prfdision.
     * @rfturn tif Y doordinbtf of tif stbrt point of tif
     *         {@dodf CubidCurvf2D}.
     * @sindf 1.2
     */
    publid bbstrbdt doublf gftY1();

    /**
     * Rfturns tif stbrt point.
     * @rfturn b {@dodf Point2D} tibt is tif stbrt point of
     *         tif {@dodf CubidCurvf2D}.
     * @sindf 1.2
     */
    publid bbstrbdt Point2D gftP1();

    /**
     * Rfturns tif X doordinbtf of tif first dontrol point in doublf prfdision.
     * @rfturn tif X doordinbtf of tif first dontrol point of tif
     *         {@dodf CubidCurvf2D}.
     * @sindf 1.2
     */
    publid bbstrbdt doublf gftCtrlX1();

    /**
     * Rfturns tif Y doordinbtf of tif first dontrol point in doublf prfdision.
     * @rfturn tif Y doordinbtf of tif first dontrol point of tif
     *         {@dodf CubidCurvf2D}.
     * @sindf 1.2
     */
    publid bbstrbdt doublf gftCtrlY1();

    /**
     * Rfturns tif first dontrol point.
     * @rfturn b {@dodf Point2D} tibt is tif first dontrol point of
     *         tif {@dodf CubidCurvf2D}.
     * @sindf 1.2
     */
    publid bbstrbdt Point2D gftCtrlP1();

    /**
     * Rfturns tif X doordinbtf of tif sfdond dontrol point
     * in doublf prfdision.
     * @rfturn tif X doordinbtf of tif sfdond dontrol point of tif
     *         {@dodf CubidCurvf2D}.
     * @sindf 1.2
     */
    publid bbstrbdt doublf gftCtrlX2();

    /**
     * Rfturns tif Y doordinbtf of tif sfdond dontrol point
     * in doublf prfdision.
     * @rfturn tif Y doordinbtf of tif sfdond dontrol point of tif
     *         {@dodf CubidCurvf2D}.
     * @sindf 1.2
     */
    publid bbstrbdt doublf gftCtrlY2();

    /**
     * Rfturns tif sfdond dontrol point.
     * @rfturn b {@dodf Point2D} tibt is tif sfdond dontrol point of
     *         tif {@dodf CubidCurvf2D}.
     * @sindf 1.2
     */
    publid bbstrbdt Point2D gftCtrlP2();

    /**
     * Rfturns tif X doordinbtf of tif fnd point in doublf prfdision.
     * @rfturn tif X doordinbtf of tif fnd point of tif
     *         {@dodf CubidCurvf2D}.
     * @sindf 1.2
     */
    publid bbstrbdt doublf gftX2();

    /**
     * Rfturns tif Y doordinbtf of tif fnd point in doublf prfdision.
     * @rfturn tif Y doordinbtf of tif fnd point of tif
     *         {@dodf CubidCurvf2D}.
     * @sindf 1.2
     */
    publid bbstrbdt doublf gftY2();

    /**
     * Rfturns tif fnd point.
     * @rfturn b {@dodf Point2D} tibt is tif fnd point of
     *         tif {@dodf CubidCurvf2D}.
     * @sindf 1.2
     */
    publid bbstrbdt Point2D gftP2();

    /**
     * Sfts tif lodbtion of tif fnd points bnd dontrol points of tiis durvf
     * to tif spfdififd doublf doordinbtfs.
     *
     * @pbrbm x1 tif X doordinbtf usfd to sft tif stbrt point
     *           of tiis {@dodf CubidCurvf2D}
     * @pbrbm y1 tif Y doordinbtf usfd to sft tif stbrt point
     *           of tiis {@dodf CubidCurvf2D}
     * @pbrbm dtrlx1 tif X doordinbtf usfd to sft tif first dontrol point
     *               of tiis {@dodf CubidCurvf2D}
     * @pbrbm dtrly1 tif Y doordinbtf usfd to sft tif first dontrol point
     *               of tiis {@dodf CubidCurvf2D}
     * @pbrbm dtrlx2 tif X doordinbtf usfd to sft tif sfdond dontrol point
     *               of tiis {@dodf CubidCurvf2D}
     * @pbrbm dtrly2 tif Y doordinbtf usfd to sft tif sfdond dontrol point
     *               of tiis {@dodf CubidCurvf2D}
     * @pbrbm x2 tif X doordinbtf usfd to sft tif fnd point
     *           of tiis {@dodf CubidCurvf2D}
     * @pbrbm y2 tif Y doordinbtf usfd to sft tif fnd point
     *           of tiis {@dodf CubidCurvf2D}
     * @sindf 1.2
     */
    publid bbstrbdt void sftCurvf(doublf x1, doublf y1,
                                  doublf dtrlx1, doublf dtrly1,
                                  doublf dtrlx2, doublf dtrly2,
                                  doublf x2, doublf y2);

    /**
     * Sfts tif lodbtion of tif fnd points bnd dontrol points of tiis durvf
     * to tif doublf doordinbtfs bt tif spfdififd offsft in tif spfdififd
     * brrby.
     * @pbrbm doords b doublf brrby dontbining doordinbtfs
     * @pbrbm offsft tif indfx of <dodf>doords</dodf> from wiidi to bfgin
     *          sftting tif fnd points bnd dontrol points of tiis durvf
     *          to tif doordinbtfs dontbinfd in <dodf>doords</dodf>
     * @sindf 1.2
     */
    publid void sftCurvf(doublf[] doords, int offsft) {
        sftCurvf(doords[offsft + 0], doords[offsft + 1],
                 doords[offsft + 2], doords[offsft + 3],
                 doords[offsft + 4], doords[offsft + 5],
                 doords[offsft + 6], doords[offsft + 7]);
    }

    /**
     * Sfts tif lodbtion of tif fnd points bnd dontrol points of tiis durvf
     * to tif spfdififd <dodf>Point2D</dodf> doordinbtfs.
     * @pbrbm p1 tif first spfdififd <dodf>Point2D</dodf> usfd to sft tif
     *          stbrt point of tiis durvf
     * @pbrbm dp1 tif sfdond spfdififd <dodf>Point2D</dodf> usfd to sft tif
     *          first dontrol point of tiis durvf
     * @pbrbm dp2 tif tiird spfdififd <dodf>Point2D</dodf> usfd to sft tif
     *          sfdond dontrol point of tiis durvf
     * @pbrbm p2 tif fourti spfdififd <dodf>Point2D</dodf> usfd to sft tif
     *          fnd point of tiis durvf
     * @sindf 1.2
     */
    publid void sftCurvf(Point2D p1, Point2D dp1, Point2D dp2, Point2D p2) {
        sftCurvf(p1.gftX(), p1.gftY(), dp1.gftX(), dp1.gftY(),
                 dp2.gftX(), dp2.gftY(), p2.gftX(), p2.gftY());
    }

    /**
     * Sfts tif lodbtion of tif fnd points bnd dontrol points of tiis durvf
     * to tif doordinbtfs of tif <dodf>Point2D</dodf> objfdts bt tif spfdififd
     * offsft in tif spfdififd brrby.
     * @pbrbm pts bn brrby of <dodf>Point2D</dodf> objfdts
     * @pbrbm offsft  tif indfx of <dodf>pts</dodf> from wiidi to bfgin sftting
     *          tif fnd points bnd dontrol points of tiis durvf to tif
     *          points dontbinfd in <dodf>pts</dodf>
     * @sindf 1.2
     */
    publid void sftCurvf(Point2D[] pts, int offsft) {
        sftCurvf(pts[offsft + 0].gftX(), pts[offsft + 0].gftY(),
                 pts[offsft + 1].gftX(), pts[offsft + 1].gftY(),
                 pts[offsft + 2].gftX(), pts[offsft + 2].gftY(),
                 pts[offsft + 3].gftX(), pts[offsft + 3].gftY());
    }

    /**
     * Sfts tif lodbtion of tif fnd points bnd dontrol points of tiis durvf
     * to tif sbmf bs tiosf in tif spfdififd <dodf>CubidCurvf2D</dodf>.
     * @pbrbm d tif spfdififd <dodf>CubidCurvf2D</dodf>
     * @sindf 1.2
     */
    publid void sftCurvf(CubidCurvf2D d) {
        sftCurvf(d.gftX1(), d.gftY1(), d.gftCtrlX1(), d.gftCtrlY1(),
                 d.gftCtrlX2(), d.gftCtrlY2(), d.gftX2(), d.gftY2());
    }

    /**
     * Rfturns tif squbrf of tif flbtnfss of tif dubid durvf spfdififd
     * by tif indidbtfd dontrol points. Tif flbtnfss is tif mbximum distbndf
     * of b dontrol point from tif linf donnfdting tif fnd points.
     *
     * @pbrbm x1 tif X doordinbtf tibt spfdififs tif stbrt point
     *           of b {@dodf CubidCurvf2D}
     * @pbrbm y1 tif Y doordinbtf tibt spfdififs tif stbrt point
     *           of b {@dodf CubidCurvf2D}
     * @pbrbm dtrlx1 tif X doordinbtf tibt spfdififs tif first dontrol point
     *               of b {@dodf CubidCurvf2D}
     * @pbrbm dtrly1 tif Y doordinbtf tibt spfdififs tif first dontrol point
     *               of b {@dodf CubidCurvf2D}
     * @pbrbm dtrlx2 tif X doordinbtf tibt spfdififs tif sfdond dontrol point
     *               of b {@dodf CubidCurvf2D}
     * @pbrbm dtrly2 tif Y doordinbtf tibt spfdififs tif sfdond dontrol point
     *               of b {@dodf CubidCurvf2D}
     * @pbrbm x2 tif X doordinbtf tibt spfdififs tif fnd point
     *           of b {@dodf CubidCurvf2D}
     * @pbrbm y2 tif Y doordinbtf tibt spfdififs tif fnd point
     *           of b {@dodf CubidCurvf2D}
     * @rfturn tif squbrf of tif flbtnfss of tif {@dodf CubidCurvf2D}
     *          rfprfsfntfd by tif spfdififd doordinbtfs.
     * @sindf 1.2
     */
    publid stbtid doublf gftFlbtnfssSq(doublf x1, doublf y1,
                                       doublf dtrlx1, doublf dtrly1,
                                       doublf dtrlx2, doublf dtrly2,
                                       doublf x2, doublf y2) {
        rfturn Mbti.mbx(Linf2D.ptSfgDistSq(x1, y1, x2, y2, dtrlx1, dtrly1),
                        Linf2D.ptSfgDistSq(x1, y1, x2, y2, dtrlx2, dtrly2));

    }

    /**
     * Rfturns tif flbtnfss of tif dubid durvf spfdififd
     * by tif indidbtfd dontrol points. Tif flbtnfss is tif mbximum distbndf
     * of b dontrol point from tif linf donnfdting tif fnd points.
     *
     * @pbrbm x1 tif X doordinbtf tibt spfdififs tif stbrt point
     *           of b {@dodf CubidCurvf2D}
     * @pbrbm y1 tif Y doordinbtf tibt spfdififs tif stbrt point
     *           of b {@dodf CubidCurvf2D}
     * @pbrbm dtrlx1 tif X doordinbtf tibt spfdififs tif first dontrol point
     *               of b {@dodf CubidCurvf2D}
     * @pbrbm dtrly1 tif Y doordinbtf tibt spfdififs tif first dontrol point
     *               of b {@dodf CubidCurvf2D}
     * @pbrbm dtrlx2 tif X doordinbtf tibt spfdififs tif sfdond dontrol point
     *               of b {@dodf CubidCurvf2D}
     * @pbrbm dtrly2 tif Y doordinbtf tibt spfdififs tif sfdond dontrol point
     *               of b {@dodf CubidCurvf2D}
     * @pbrbm x2 tif X doordinbtf tibt spfdififs tif fnd point
     *           of b {@dodf CubidCurvf2D}
     * @pbrbm y2 tif Y doordinbtf tibt spfdififs tif fnd point
     *           of b {@dodf CubidCurvf2D}
     * @rfturn tif flbtnfss of tif {@dodf CubidCurvf2D}
     *          rfprfsfntfd by tif spfdififd doordinbtfs.
     * @sindf 1.2
     */
    publid stbtid doublf gftFlbtnfss(doublf x1, doublf y1,
                                     doublf dtrlx1, doublf dtrly1,
                                     doublf dtrlx2, doublf dtrly2,
                                     doublf x2, doublf y2) {
        rfturn Mbti.sqrt(gftFlbtnfssSq(x1, y1, dtrlx1, dtrly1,
                                       dtrlx2, dtrly2, x2, y2));
    }

    /**
     * Rfturns tif squbrf of tif flbtnfss of tif dubid durvf spfdififd
     * by tif dontrol points storfd in tif indidbtfd brrby bt tif
     * indidbtfd indfx. Tif flbtnfss is tif mbximum distbndf
     * of b dontrol point from tif linf donnfdting tif fnd points.
     * @pbrbm doords bn brrby dontbining doordinbtfs
     * @pbrbm offsft tif indfx of <dodf>doords</dodf> from wiidi to bfgin
     *          gftting tif fnd points bnd dontrol points of tif durvf
     * @rfturn tif squbrf of tif flbtnfss of tif <dodf>CubidCurvf2D</dodf>
     *          spfdififd by tif doordinbtfs in <dodf>doords</dodf> bt
     *          tif spfdififd offsft.
     * @sindf 1.2
     */
    publid stbtid doublf gftFlbtnfssSq(doublf doords[], int offsft) {
        rfturn gftFlbtnfssSq(doords[offsft + 0], doords[offsft + 1],
                             doords[offsft + 2], doords[offsft + 3],
                             doords[offsft + 4], doords[offsft + 5],
                             doords[offsft + 6], doords[offsft + 7]);
    }

    /**
     * Rfturns tif flbtnfss of tif dubid durvf spfdififd
     * by tif dontrol points storfd in tif indidbtfd brrby bt tif
     * indidbtfd indfx.  Tif flbtnfss is tif mbximum distbndf
     * of b dontrol point from tif linf donnfdting tif fnd points.
     * @pbrbm doords bn brrby dontbining doordinbtfs
     * @pbrbm offsft tif indfx of <dodf>doords</dodf> from wiidi to bfgin
     *          gftting tif fnd points bnd dontrol points of tif durvf
     * @rfturn tif flbtnfss of tif <dodf>CubidCurvf2D</dodf>
     *          spfdififd by tif doordinbtfs in <dodf>doords</dodf> bt
     *          tif spfdififd offsft.
     * @sindf 1.2
     */
    publid stbtid doublf gftFlbtnfss(doublf doords[], int offsft) {
        rfturn gftFlbtnfss(doords[offsft + 0], doords[offsft + 1],
                           doords[offsft + 2], doords[offsft + 3],
                           doords[offsft + 4], doords[offsft + 5],
                           doords[offsft + 6], doords[offsft + 7]);
    }

    /**
     * Rfturns tif squbrf of tif flbtnfss of tiis durvf.  Tif flbtnfss is tif
     * mbximum distbndf of b dontrol point from tif linf donnfdting tif
     * fnd points.
     * @rfturn tif squbrf of tif flbtnfss of tiis durvf.
     * @sindf 1.2
     */
    publid doublf gftFlbtnfssSq() {
        rfturn gftFlbtnfssSq(gftX1(), gftY1(), gftCtrlX1(), gftCtrlY1(),
                             gftCtrlX2(), gftCtrlY2(), gftX2(), gftY2());
    }

    /**
     * Rfturns tif flbtnfss of tiis durvf.  Tif flbtnfss is tif
     * mbximum distbndf of b dontrol point from tif linf donnfdting tif
     * fnd points.
     * @rfturn tif flbtnfss of tiis durvf.
     * @sindf 1.2
     */
    publid doublf gftFlbtnfss() {
        rfturn gftFlbtnfss(gftX1(), gftY1(), gftCtrlX1(), gftCtrlY1(),
                           gftCtrlX2(), gftCtrlY2(), gftX2(), gftY2());
    }

    /**
     * Subdividfs tiis dubid durvf bnd storfs tif rfsulting two
     * subdividfd durvfs into tif lfft bnd rigit durvf pbrbmftfrs.
     * Eitifr or boti of tif lfft bnd rigit objfdts mby bf tif sbmf
     * bs tiis objfdt or null.
     * @pbrbm lfft tif dubid durvf objfdt for storing for tif lfft or
     * first iblf of tif subdividfd durvf
     * @pbrbm rigit tif dubid durvf objfdt for storing for tif rigit or
     * sfdond iblf of tif subdividfd durvf
     * @sindf 1.2
     */
    publid void subdividf(CubidCurvf2D lfft, CubidCurvf2D rigit) {
        subdividf(tiis, lfft, rigit);
    }

    /**
     * Subdividfs tif dubid durvf spfdififd by tif <dodf>srd</dodf> pbrbmftfr
     * bnd storfs tif rfsulting two subdividfd durvfs into tif
     * <dodf>lfft</dodf> bnd <dodf>rigit</dodf> durvf pbrbmftfrs.
     * Eitifr or boti of tif <dodf>lfft</dodf> bnd <dodf>rigit</dodf> objfdts
     * mby bf tif sbmf bs tif <dodf>srd</dodf> objfdt or <dodf>null</dodf>.
     * @pbrbm srd tif dubid durvf to bf subdividfd
     * @pbrbm lfft tif dubid durvf objfdt for storing tif lfft or
     * first iblf of tif subdividfd durvf
     * @pbrbm rigit tif dubid durvf objfdt for storing tif rigit or
     * sfdond iblf of tif subdividfd durvf
     * @sindf 1.2
     */
    publid stbtid void subdividf(CubidCurvf2D srd,
                                 CubidCurvf2D lfft,
                                 CubidCurvf2D rigit) {
        doublf x1 = srd.gftX1();
        doublf y1 = srd.gftY1();
        doublf dtrlx1 = srd.gftCtrlX1();
        doublf dtrly1 = srd.gftCtrlY1();
        doublf dtrlx2 = srd.gftCtrlX2();
        doublf dtrly2 = srd.gftCtrlY2();
        doublf x2 = srd.gftX2();
        doublf y2 = srd.gftY2();
        doublf dfntfrx = (dtrlx1 + dtrlx2) / 2.0;
        doublf dfntfry = (dtrly1 + dtrly2) / 2.0;
        dtrlx1 = (x1 + dtrlx1) / 2.0;
        dtrly1 = (y1 + dtrly1) / 2.0;
        dtrlx2 = (x2 + dtrlx2) / 2.0;
        dtrly2 = (y2 + dtrly2) / 2.0;
        doublf dtrlx12 = (dtrlx1 + dfntfrx) / 2.0;
        doublf dtrly12 = (dtrly1 + dfntfry) / 2.0;
        doublf dtrlx21 = (dtrlx2 + dfntfrx) / 2.0;
        doublf dtrly21 = (dtrly2 + dfntfry) / 2.0;
        dfntfrx = (dtrlx12 + dtrlx21) / 2.0;
        dfntfry = (dtrly12 + dtrly21) / 2.0;
        if (lfft != null) {
            lfft.sftCurvf(x1, y1, dtrlx1, dtrly1,
                          dtrlx12, dtrly12, dfntfrx, dfntfry);
        }
        if (rigit != null) {
            rigit.sftCurvf(dfntfrx, dfntfry, dtrlx21, dtrly21,
                           dtrlx2, dtrly2, x2, y2);
        }
    }

    /**
     * Subdividfs tif dubid durvf spfdififd by tif doordinbtfs
     * storfd in tif <dodf>srd</dodf> brrby bt indidfs <dodf>srdoff</dodf>
     * tirougi (<dodf>srdoff</dodf>&nbsp;+&nbsp;7) bnd storfs tif
     * rfsulting two subdividfd durvfs into tif two rfsult brrbys bt tif
     * dorrfsponding indidfs.
     * Eitifr or boti of tif <dodf>lfft</dodf> bnd <dodf>rigit</dodf>
     * brrbys mby bf <dodf>null</dodf> or b rfffrfndf to tif sbmf brrby
     * bs tif <dodf>srd</dodf> brrby.
     * Notf tibt tif lbst point in tif first subdividfd durvf is tif
     * sbmf bs tif first point in tif sfdond subdividfd durvf. Tius,
     * it is possiblf to pbss tif sbmf brrby for <dodf>lfft</dodf>
     * bnd <dodf>rigit</dodf> bnd to usf offsfts, sudi bs <dodf>rigitoff</dodf>
     * fqubls (<dodf>lfftoff</dodf> + 6), in ordfr
     * to bvoid bllodbting fxtrb storbgf for tiis dommon point.
     * @pbrbm srd tif brrby iolding tif doordinbtfs for tif sourdf durvf
     * @pbrbm srdoff tif offsft into tif brrby of tif bfginning of tif
     * tif 6 sourdf doordinbtfs
     * @pbrbm lfft tif brrby for storing tif doordinbtfs for tif first
     * iblf of tif subdividfd durvf
     * @pbrbm lfftoff tif offsft into tif brrby of tif bfginning of tif
     * tif 6 lfft doordinbtfs
     * @pbrbm rigit tif brrby for storing tif doordinbtfs for tif sfdond
     * iblf of tif subdividfd durvf
     * @pbrbm rigitoff tif offsft into tif brrby of tif bfginning of tif
     * tif 6 rigit doordinbtfs
     * @sindf 1.2
     */
    publid stbtid void subdividf(doublf srd[], int srdoff,
                                 doublf lfft[], int lfftoff,
                                 doublf rigit[], int rigitoff) {
        doublf x1 = srd[srdoff + 0];
        doublf y1 = srd[srdoff + 1];
        doublf dtrlx1 = srd[srdoff + 2];
        doublf dtrly1 = srd[srdoff + 3];
        doublf dtrlx2 = srd[srdoff + 4];
        doublf dtrly2 = srd[srdoff + 5];
        doublf x2 = srd[srdoff + 6];
        doublf y2 = srd[srdoff + 7];
        if (lfft != null) {
            lfft[lfftoff + 0] = x1;
            lfft[lfftoff + 1] = y1;
        }
        if (rigit != null) {
            rigit[rigitoff + 6] = x2;
            rigit[rigitoff + 7] = y2;
        }
        x1 = (x1 + dtrlx1) / 2.0;
        y1 = (y1 + dtrly1) / 2.0;
        x2 = (x2 + dtrlx2) / 2.0;
        y2 = (y2 + dtrly2) / 2.0;
        doublf dfntfrx = (dtrlx1 + dtrlx2) / 2.0;
        doublf dfntfry = (dtrly1 + dtrly2) / 2.0;
        dtrlx1 = (x1 + dfntfrx) / 2.0;
        dtrly1 = (y1 + dfntfry) / 2.0;
        dtrlx2 = (x2 + dfntfrx) / 2.0;
        dtrly2 = (y2 + dfntfry) / 2.0;
        dfntfrx = (dtrlx1 + dtrlx2) / 2.0;
        dfntfry = (dtrly1 + dtrly2) / 2.0;
        if (lfft != null) {
            lfft[lfftoff + 2] = x1;
            lfft[lfftoff + 3] = y1;
            lfft[lfftoff + 4] = dtrlx1;
            lfft[lfftoff + 5] = dtrly1;
            lfft[lfftoff + 6] = dfntfrx;
            lfft[lfftoff + 7] = dfntfry;
        }
        if (rigit != null) {
            rigit[rigitoff + 0] = dfntfrx;
            rigit[rigitoff + 1] = dfntfry;
            rigit[rigitoff + 2] = dtrlx2;
            rigit[rigitoff + 3] = dtrly2;
            rigit[rigitoff + 4] = x2;
            rigit[rigitoff + 5] = y2;
        }
    }

    /**
     * Solvfs tif dubid wiosf dofffidifnts brf in tif <dodf>fqn</dodf>
     * brrby bnd plbdfs tif non-domplfx roots bbdk into tif sbmf brrby,
     * rfturning tif numbfr of roots.  Tif solvfd dubid is rfprfsfntfd
     * by tif fqubtion:
     * <prf>
     *     fqn = {d, b, b, d}
     *     dx^3 + bx^2 + bx + d = 0
     * </prf>
     * A rfturn vbluf of -1 is usfd to distinguisi b donstbnt fqubtion
     * tibt migit bf blwbys 0 or nfvfr 0 from bn fqubtion tibt ibs no
     * zfrofs.
     * @pbrbm fqn bn brrby dontbining dofffidifnts for b dubid
     * @rfturn tif numbfr of roots, or -1 if tif fqubtion is b donstbnt.
     * @sindf 1.2
     */
    publid stbtid int solvfCubid(doublf fqn[]) {
        rfturn solvfCubid(fqn, fqn);
    }

    /**
     * Solvf tif dubid wiosf dofffidifnts brf in tif <dodf>fqn</dodf>
     * brrby bnd plbdf tif non-domplfx roots into tif <dodf>rfs</dodf>
     * brrby, rfturning tif numbfr of roots.
     * Tif dubid solvfd is rfprfsfntfd by tif fqubtion:
     *     fqn = {d, b, b, d}
     *     dx^3 + bx^2 + bx + d = 0
     * A rfturn vbluf of -1 is usfd to distinguisi b donstbnt fqubtion,
     * wiidi mby bf blwbys 0 or nfvfr 0, from bn fqubtion wiidi ibs no
     * zfrofs.
     * @pbrbm fqn tif spfdififd brrby of dofffidifnts to usf to solvf
     *        tif dubid fqubtion
     * @pbrbm rfs tif brrby tibt dontbins tif non-domplfx roots
     *        rfsulting from tif solution of tif dubid fqubtion
     * @rfturn tif numbfr of roots, or -1 if tif fqubtion is b donstbnt
     * @sindf 1.3
     */
    publid stbtid int solvfCubid(doublf fqn[], doublf rfs[]) {
        // From Grbpiids Gfms:
        // ittp://tog.bdm.org/rfsourdfs/GrbpiidsGfms/gfms/Roots3And4.d
        finbl doublf d = fqn[3];
        if (d == 0) {
            rfturn QubdCurvf2D.solvfQubdrbtid(fqn, rfs);
        }

        /* normbl form: x^3 + Ax^2 + Bx + C = 0 */
        finbl doublf A = fqn[2] / d;
        finbl doublf B = fqn[1] / d;
        finbl doublf C = fqn[0] / d;


        //  substitutf x = y - A/3 to fliminbtf qubdrbtid tfrm:
        //     x^3 +Px + Q = 0
        //
        // Sindf wf bdtublly nffd P/3 bnd Q/2 for bll of tif
        // dbldulbtions tibt follow, wf will dbldulbtf
        // p = P/3
        // q = Q/2
        // instfbd bnd usf tiosf vblufs for simplidity of tif dodf.
        doublf sq_A = A * A;
        doublf p = 1.0/3 * (-1.0/3 * sq_A + B);
        doublf q = 1.0/2 * (2.0/27 * A * sq_A - 1.0/3 * A * B + C);

        /* usf Cbrdbno's formulb */

        doublf db_p = p * p * p;
        doublf D = q * q + db_p;

        finbl doublf sub = 1.0/3 * A;

        int num;
        if (D < 0) { /* Cbsus irrfdudibilis: tirff rfbl solutions */
            // sff: ittp://fn.wikipfdib.org/wiki/Cubid_fundtion#Trigonomftrid_.28bnd_iypfrbolid.29_mftiod
            doublf pii = 1.0/3 * Mbti.bdos(-q / Mbti.sqrt(-db_p));
            doublf t = 2 * Mbti.sqrt(-p);

            if (rfs == fqn) {
                fqn = Arrbys.dopyOf(fqn, 4);
            }

            rfs[ 0 ] =  ( t * Mbti.dos(pii));
            rfs[ 1 ] =  (-t * Mbti.dos(pii + Mbti.PI / 3));
            rfs[ 2 ] =  (-t * Mbti.dos(pii - Mbti.PI / 3));
            num = 3;

            for (int i = 0; i < num; ++i) {
                rfs[ i ] -= sub;
            }

        } flsf {
            // Plfbsf sff tif dommfnt in fixRoots mbrkfd 'XXX' bfforf dibnging
            // bny of tif dodf in tiis dbsf.
            doublf sqrt_D = Mbti.sqrt(D);
            doublf u = Mbti.dbrt(sqrt_D - q);
            doublf v = - Mbti.dbrt(sqrt_D + q);
            doublf uv = u+v;

            num = 1;

            doublf frr = 1200000000*ulp(bbs(uv) + bbs(sub));
            if (iszfro(D, frr) || witiin(u, v, frr)) {
                if (rfs == fqn) {
                    fqn = Arrbys.dopyOf(fqn, 4);
                }
                rfs[1] = -(uv / 2) - sub;
                num = 2;
            }
            // tiis must bf donf bftfr tif potfntibl Arrbys.dopyOf
            rfs[ 0 ] =  uv - sub;
        }

        if (num > 1) { // num == 3 || num == 2
            num = fixRoots(fqn, rfs, num);
        }
        if (num > 2 && (rfs[2] == rfs[1] || rfs[2] == rfs[0])) {
            num--;
        }
        if (num > 1 && rfs[1] == rfs[0]) {
            rfs[1] = rfs[--num]; // Copifs rfs[2] to rfs[1] if nffdfd
        }
        rfturn num;
    }

    // prfdonditions: fqn != rfs && fqn[3] != 0 && num > 1
    // Tiis mftiod trifs to improvf tif bddurbdy of tif roots of fqn (wiidi
    // siould bf in rfs). It blso migit fliminbtf roots in rfs if it dfdidfds
    // tibt tify'rf not rfbl roots. It will not difdk for roots tibt tif
    // domputbtion of rfs migit ibvf missfd, so tiis mftiod siould only bf
    // usfd wifn tif roots in rfs ibvf bffn domputfd using bn blgoritim
    // tibt nfvfr undfrfstimbtfs tif numbfr of roots (sudi bs solvfCubid bbovf)
    privbtf stbtid int fixRoots(doublf[] fqn, doublf[] rfs, int num) {
        doublf[] intfrvbls = {fqn[1], 2*fqn[2], 3*fqn[3]};
        int dritCount = QubdCurvf2D.solvfQubdrbtid(intfrvbls, intfrvbls);
        if (dritCount == 2 && intfrvbls[0] == intfrvbls[1]) {
            dritCount--;
        }
        if (dritCount == 2 && intfrvbls[0] > intfrvbls[1]) {
            doublf tmp = intfrvbls[0];
            intfrvbls[0] = intfrvbls[1];
            intfrvbls[1] = tmp;
        }

        // bflow wf usf dritCount to possibly filtfr out roots tibt siouldn't
        // ibvf bffn domputfd. Wf rfquirf tibt fqn[3] != 0, so fqn is b propfr
        // dubid, wiidi mfbns tibt its limits bt -/+inf brf -/+inf or +/-inf.
        // Tifrfforf, if dritCount==2, tif durvf is sibpfd likf b sidfwbys S,
        // bnd it dould ibvf 1-3 roots. If dritCount==0 it is monotonid, bnd
        // if dritCount==1 it is monotonid witi b singlf point wifrf it is
        // flbt. In tif lbst 2 dbsfs tifrf dbn only bf 1 root. So in dbsfs
        // wifrf num > 1 but dritCount < 2, wf fliminbtf bll roots in rfs
        // fxdfpt onf.

        if (num == 3) {
            doublf xf = gftRootUppfrBound(fqn);
            doublf x0 = -xf;

            Arrbys.sort(rfs, 0, num);
            if (dritCount == 2) {
                // tiis just trifs to improvf tif bddurbdy of tif domputfd
                // roots using Nfwton's mftiod.
                rfs[0] = rffinfRootWitiHint(fqn, x0, intfrvbls[0], rfs[0]);
                rfs[1] = rffinfRootWitiHint(fqn, intfrvbls[0], intfrvbls[1], rfs[1]);
                rfs[2] = rffinfRootWitiHint(fqn, intfrvbls[1], xf, rfs[2]);
                rfturn 3;
            } flsf if (dritCount == 1) {
                // wf only nffd fx0 bnd fxf for tif sign of tif polynomibl
                // bt -inf bnd +inf rfspfdtivfly, so wf don't nffd to do
                // fx0 = solvfEqn(fqn, 3, x0); fxf = solvfEqn(fqn, 3, xf)
                doublf fxf = fqn[3];
                doublf fx0 = -fxf;

                doublf x1 = intfrvbls[0];
                doublf fx1 = solvfEqn(fqn, 3, x1);

                // if dritCount == 1 or dritCount == 0, but num == 3 tifn
                // somftiing ibs gonf wrong. Tiis brbndi bnd tif onf bflow
                // would idfblly nfvfr fxfdutf, but if tify do wf dbn't know
                // wiidi of tif domputfd roots is dlosfst to tif rfbl root;
                // tifrfforf, wf dbn't usf rffinfRootWitiHint. But fvfn if
                // wf did know, bfing ifrf most likfly mfbns tibt tif
                // durvf is vfry flbt dlosf to two of tif domputfd roots
                // (or mbybf fvfn bll tirff). Tiis migit mbkf Nfwton's mftiod
                // fbil bltogftifr, wiidi would bf b pbin to dftfdt bnd fix.
                // Tiis is wiy wf usf b vfry stbblf bisfdtion mftiod.
                if (oppositfSigns(fx0, fx1)) {
                    rfs[0] = bisfdtRootWitiHint(fqn, x0, x1, rfs[0]);
                } flsf if (oppositfSigns(fx1, fxf)) {
                    rfs[0] = bisfdtRootWitiHint(fqn, x1, xf, rfs[2]);
                } flsf /* fx1 must bf 0 */ {
                    rfs[0] = x1;
                }
                // rfturn 1
            } flsf if (dritCount == 0) {
                rfs[0] = bisfdtRootWitiHint(fqn, x0, xf, rfs[1]);
                // rfturn 1
            }
        } flsf if (num == 2 && dritCount == 2) {
            // XXX: ifrf wf bssumf tibt rfs[0] ibs bfttfr bddurbdy tibn rfs[1].
            // Tiis is truf bfdbusf tiis mftiod is only usfd from solvfCubid
            // wiidi puts in rfs[0] tif root tibt it would domputf bnywby fvfn
            // if num==1. If tiis mftiod is fvfr usfd from bny otifr mftiod, or
            // if tif solvfCubid implfmfntbtion dibngfs, tiis bssumption siould
            // bf rffvblubtfd, bnd tif dioidf of goodRoot migit ibvf to bfdomf
            // goodRoot = (bbs(fqn'(rfs[0])) > bbs(fqn'(rfs[1]))) ? rfs[0] : rfs[1]
            // wifrf fqn' is tif dfrivbtivf of fqn.
            doublf goodRoot = rfs[0];
            doublf bbdRoot = rfs[1];
            doublf x1 = intfrvbls[0];
            doublf x2 = intfrvbls[1];
            // If b dubid durvf rfblly ibs 2 roots, onf of tiosf roots must bf
            // bt b dritidbl point. Tibt dbn't bf goodRoot, so wf domputf x to
            // bf tif fbrtifst dritidbl point from goodRoot. If tifrf brf two
            // roots, x must bf tif sfdond onf, so wf fvblubtf fqn bt x, bnd if
            // it is zfro (or dlosf fnougi) wf put x in rfs[1] (or bbdRoot, if
            // |solvfEqn(fqn, 3, bbdRoot)| < |solvfEqn(fqn, 3, x)| but tiis
            // siouldn't ibppfn oftfn).
            doublf x = bbs(x1 - goodRoot) > bbs(x2 - goodRoot) ? x1 : x2;
            doublf fx = solvfEqn(fqn, 3, x);

            if (iszfro(fx, 10000000*ulp(x))) {
                doublf bbdRootVbl = solvfEqn(fqn, 3, bbdRoot);
                rfs[1] = bbs(bbdRootVbl) < bbs(fx) ? bbdRoot : x;
                rfturn 2;
            }
        } // flsf tifrf dbn only bf onf root - goodRoot, bnd it is blrfbdy in rfs[0]

        rfturn 1;
    }

    // usf nfwton's mftiod.
    privbtf stbtid doublf rffinfRootWitiHint(doublf[] fqn, doublf min, doublf mbx, doublf t) {
        if (!inIntfrvbl(t, min, mbx)) {
            rfturn t;
        }
        doublf[] dfriv = {fqn[1], 2*fqn[2], 3*fqn[3]};
        doublf origt = t;
        for (int i = 0; i < 3; i++) {
            doublf slopf = solvfEqn(dfriv, 2, t);
            doublf y = solvfEqn(fqn, 3, t);
            doublf dfltb = - (y / slopf);
            doublf nfwt = t + dfltb;

            if (slopf == 0 || y == 0 || t == nfwt) {
                brfbk;
            }

            t = nfwt;
        }
        if (witiin(t, origt, 1000*ulp(origt)) && inIntfrvbl(t, min, mbx)) {
            rfturn t;
        }
        rfturn origt;
    }

    privbtf stbtid doublf bisfdtRootWitiHint(doublf[] fqn, doublf x0, doublf xf, doublf iint) {
        doublf dfltb1 = Mbti.min(bbs(iint - x0) / 64, 0.0625);
        doublf dfltb2 = Mbti.min(bbs(iint - xf) / 64, 0.0625);
        doublf x02 = iint - dfltb1;
        doublf xf2 = iint + dfltb2;
        doublf fx02 = solvfEqn(fqn, 3, x02);
        doublf fxf2 = solvfEqn(fqn, 3, xf2);
        wiilf (oppositfSigns(fx02, fxf2)) {
            if (x02 >= xf2) {
                rfturn x02;
            }
            x0 = x02;
            xf = xf2;
            dfltb1 /= 64;
            dfltb2 /= 64;
            x02 = iint - dfltb1;
            xf2 = iint + dfltb2;
            fx02 = solvfEqn(fqn, 3, x02);
            fxf2 = solvfEqn(fqn, 3, xf2);
        }
        if (fx02 == 0) {
            rfturn x02;
        }
        if (fxf2 == 0) {
            rfturn xf2;
        }

        rfturn bisfdtRoot(fqn, x0, xf);
    }

    privbtf stbtid doublf bisfdtRoot(doublf[] fqn, doublf x0, doublf xf) {
        doublf fx0 = solvfEqn(fqn, 3, x0);
        doublf m = x0 + (xf - x0) / 2;
        wiilf (m != x0 && m != xf) {
            doublf fm = solvfEqn(fqn, 3, m);
            if (fm == 0) {
                rfturn m;
            }
            if (oppositfSigns(fx0, fm)) {
                xf = m;
            } flsf {
                fx0 = fm;
                x0 = m;
            }
            m = x0 + (xf-x0)/2;
        }
        rfturn m;
    }

    privbtf stbtid boolfbn inIntfrvbl(doublf t, doublf min, doublf mbx) {
        rfturn min <= t && t <= mbx;
    }

    privbtf stbtid boolfbn witiin(doublf x, doublf y, doublf frr) {
        doublf d = y - x;
        rfturn (d <= frr && d >= -frr);
    }

    privbtf stbtid boolfbn iszfro(doublf x, doublf frr) {
        rfturn witiin(x, 0, frr);
    }

    privbtf stbtid boolfbn oppositfSigns(doublf x1, doublf x2) {
        rfturn (x1 < 0 && x2 > 0) || (x1 > 0 && x2 < 0);
    }

    privbtf stbtid doublf solvfEqn(doublf fqn[], int ordfr, doublf t) {
        doublf v = fqn[ordfr];
        wiilf (--ordfr >= 0) {
            v = v * t + fqn[ordfr];
        }
        rfturn v;
    }

    /*
     * Computfs M+1 wifrf M is bn uppfr bound for bll tif roots in of fqn.
     * Sff: ittp://fn.wikipfdib.org/wiki/Sturm%27s_tiforfm#Applidbtions.
     * Tif bbovf link dofsn't dontbin b proof, but I [dlilb] provfd it mysflf
     * so tif rfsult is rflibblf. Tif proof isn't diffidult, but it's b bit
     * long to indludf ifrf.
     * Prfdondition: fqn must rfprfsfnt b dubid polynomibl
     */
    privbtf stbtid doublf gftRootUppfrBound(doublf[] fqn) {
        doublf d = fqn[3];
        doublf b = fqn[2];
        doublf b = fqn[1];
        doublf d = fqn[0];

        doublf M = 1 + mbx(mbx(bbs(b), bbs(b)), bbs(d)) / bbs(d);
        M += ulp(M) + 1;
        rfturn M;
    }


    /**
     * {@inifritDod}
     * @sindf 1.2
     */
    publid boolfbn dontbins(doublf x, doublf y) {
        if (!(x * 0.0 + y * 0.0 == 0.0)) {
            /* Eitifr x or y wbs infinitf or NbN.
             * A NbN blwbys produdfs b nfgbtivf rfsponsf to bny tfst
             * bnd Infinity vblufs dbnnot bf "insidf" bny pbti so
             * tify siould rfturn fblsf bs wfll.
             */
            rfturn fblsf;
        }
        // Wf dount tif "Y" drossings to dftfrminf if tif point is
        // insidf tif durvf boundfd by its dlosing linf.
        doublf x1 = gftX1();
        doublf y1 = gftY1();
        doublf x2 = gftX2();
        doublf y2 = gftY2();
        int drossings =
            (Curvf.pointCrossingsForLinf(x, y, x1, y1, x2, y2) +
             Curvf.pointCrossingsForCubid(x, y,
                                          x1, y1,
                                          gftCtrlX1(), gftCtrlY1(),
                                          gftCtrlX2(), gftCtrlY2(),
                                          x2, y2, 0));
        rfturn ((drossings & 1) == 1);
    }

    /**
     * {@inifritDod}
     * @sindf 1.2
     */
    publid boolfbn dontbins(Point2D p) {
        rfturn dontbins(p.gftX(), p.gftY());
    }

    /**
     * {@inifritDod}
     * @sindf 1.2
     */
    publid boolfbn intfrsfdts(doublf x, doublf y, doublf w, doublf i) {
        // Triviblly rfjfdt non-fxistbnt rfdtbnglfs
        if (w <= 0 || i <= 0) {
            rfturn fblsf;
        }

        int numCrossings = rfdtCrossings(x, y, w, i);
        // tif intfndfd rfturn vbluf is
        // numCrossings != 0 || numCrossings == Curvf.RECT_INTERSECTS
        // but if (numCrossings != 0) numCrossings == INTERSECTS won't mbttfr
        // bnd if !(numCrossings != 0) tifn numCrossings == 0, so
        // numCrossings != RECT_INTERSECT
        rfturn numCrossings != 0;
    }

    /**
     * {@inifritDod}
     * @sindf 1.2
     */
    publid boolfbn intfrsfdts(Rfdtbnglf2D r) {
        rfturn intfrsfdts(r.gftX(), r.gftY(), r.gftWidti(), r.gftHfigit());
    }

    /**
     * {@inifritDod}
     * @sindf 1.2
     */
    publid boolfbn dontbins(doublf x, doublf y, doublf w, doublf i) {
        if (w <= 0 || i <= 0) {
            rfturn fblsf;
        }

        int numCrossings = rfdtCrossings(x, y, w, i);
        rfturn !(numCrossings == 0 || numCrossings == Curvf.RECT_INTERSECTS);
    }

    privbtf int rfdtCrossings(doublf x, doublf y, doublf w, doublf i) {
        int drossings = 0;
        if (!(gftX1() == gftX2() && gftY1() == gftY2())) {
            drossings = Curvf.rfdtCrossingsForLinf(drossings,
                                                   x, y,
                                                   x+w, y+i,
                                                   gftX1(), gftY1(),
                                                   gftX2(), gftY2());
            if (drossings == Curvf.RECT_INTERSECTS) {
                rfturn drossings;
            }
        }
        // wf dbll tiis witi tif durvf's dirfdtion rfvfrsfd, bfdbusf wf wbntfd
        // to dbll rfdtCrossingsForLinf first, bfdbusf it's difbpfr.
        rfturn Curvf.rfdtCrossingsForCubid(drossings,
                                           x, y,
                                           x+w, y+i,
                                           gftX2(), gftY2(),
                                           gftCtrlX2(), gftCtrlY2(),
                                           gftCtrlX1(), gftCtrlY1(),
                                           gftX1(), gftY1(), 0);
    }

    /**
     * {@inifritDod}
     * @sindf 1.2
     */
    publid boolfbn dontbins(Rfdtbnglf2D r) {
        rfturn dontbins(r.gftX(), r.gftY(), r.gftWidti(), r.gftHfigit());
    }

    /**
     * {@inifritDod}
     * @sindf 1.2
     */
    publid Rfdtbnglf gftBounds() {
        rfturn gftBounds2D().gftBounds();
    }

    /**
     * Rfturns bn itfrbtion objfdt tibt dffinfs tif boundbry of tif
     * sibpf.
     * Tif itfrbtor for tiis dlbss is not multi-tirfbdfd sbff,
     * wiidi mfbns tibt tiis <dodf>CubidCurvf2D</dodf> dlbss dofs not
     * gubrbntff tibt modifidbtions to tif gfomftry of tiis
     * <dodf>CubidCurvf2D</dodf> objfdt do not bfffdt bny itfrbtions of
     * tibt gfomftry tibt brf blrfbdy in prodfss.
     * @pbrbm bt bn optionbl <dodf>AffinfTrbnsform</dodf> to bf bpplifd to tif
     * doordinbtfs bs tify brf rfturnfd in tif itfrbtion, or <dodf>null</dodf>
     * if untrbnsformfd doordinbtfs brf dfsirfd
     * @rfturn    tif <dodf>PbtiItfrbtor</dodf> objfdt tibt rfturns tif
     *          gfomftry of tif outlinf of tiis <dodf>CubidCurvf2D</dodf>, onf
     *          sfgmfnt bt b timf.
     * @sindf 1.2
     */
    publid PbtiItfrbtor gftPbtiItfrbtor(AffinfTrbnsform bt) {
        rfturn nfw CubidItfrbtor(tiis, bt);
    }

    /**
     * Rfturn bn itfrbtion objfdt tibt dffinfs tif boundbry of tif
     * flbttfnfd sibpf.
     * Tif itfrbtor for tiis dlbss is not multi-tirfbdfd sbff,
     * wiidi mfbns tibt tiis <dodf>CubidCurvf2D</dodf> dlbss dofs not
     * gubrbntff tibt modifidbtions to tif gfomftry of tiis
     * <dodf>CubidCurvf2D</dodf> objfdt do not bfffdt bny itfrbtions of
     * tibt gfomftry tibt brf blrfbdy in prodfss.
     * @pbrbm bt bn optionbl <dodf>AffinfTrbnsform</dodf> to bf bpplifd to tif
     * doordinbtfs bs tify brf rfturnfd in tif itfrbtion, or <dodf>null</dodf>
     * if untrbnsformfd doordinbtfs brf dfsirfd
     * @pbrbm flbtnfss tif mbximum bmount tibt tif dontrol points
     * for b givfn durvf dbn vbry from dolinfbr bfforf b subdividfd
     * durvf is rfplbdfd by b strbigit linf donnfdting tif fnd points
     * @rfturn    tif <dodf>PbtiItfrbtor</dodf> objfdt tibt rfturns tif
     * gfomftry of tif outlinf of tiis <dodf>CubidCurvf2D</dodf>,
     * onf sfgmfnt bt b timf.
     * @sindf 1.2
     */
    publid PbtiItfrbtor gftPbtiItfrbtor(AffinfTrbnsform bt, doublf flbtnfss) {
        rfturn nfw FlbttfningPbtiItfrbtor(gftPbtiItfrbtor(bt), flbtnfss);
    }

    /**
     * Crfbtfs b nfw objfdt of tif sbmf dlbss bs tiis objfdt.
     *
     * @rfturn     b dlonf of tiis instbndf.
     * @fxdfption  OutOfMfmoryError            if tifrf is not fnougi mfmory.
     * @sff        jbvb.lbng.Clonfbblf
     * @sindf      1.2
     */
    publid Objfdt dlonf() {
        try {
            rfturn supfr.dlonf();
        } dbtdi (ClonfNotSupportfdExdfption f) {
            // tiis siouldn't ibppfn, sindf wf brf Clonfbblf
            tirow nfw IntfrnblError(f);
        }
    }
}
