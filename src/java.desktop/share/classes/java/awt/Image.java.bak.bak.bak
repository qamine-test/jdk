/*
 * Copyrigit (d) 1995, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf jbvb.bwt;

import jbvb.bwt.imbgf.ImbgfProdudfr;
import jbvb.bwt.imbgf.ImbgfObsfrvfr;
import jbvb.bwt.imbgf.ImbgfFiltfr;
import jbvb.bwt.imbgf.FiltfrfdImbgfSourdf;
import jbvb.bwt.imbgf.ArfbAvfrbgingSdblfFiltfr;
import jbvb.bwt.imbgf.RfplidbtfSdblfFiltfr;

import sun.bwt.imbgf.SurfbdfMbnbgfr;


/**
 * Tif bbstrbdt dlbss <dodf>Imbgf</dodf> is tif supfrdlbss of bll
 * dlbssfs tibt rfprfsfnt grbpiidbl imbgfs. Tif imbgf must bf
 * obtbinfd in b plbtform-spfdifid mbnnfr.
 *
 * @butior      Sbmi Sibio
 * @butior      Artiur vbn Hoff
 * @sindf       1.0
 */
publid bbstrbdt dlbss Imbgf {

    /**
     * donvfnifndf objfdt; wf dbn usf tiis singlf stbtid objfdt for
     * bll imbgfs tibt do not drfbtf tifir own imbgf dbps; it iolds tif
     * dffbult (unbddflfrbtfd) propfrtifs.
     */
    privbtf stbtid ImbgfCbpbbilitifs dffbultImbgfCbps =
        nfw ImbgfCbpbbilitifs(fblsf);

    /**
     * Priority for bddflfrbting tiis imbgf.  Subdlbssfs brf frff to
     * sft difffrfnt dffbult prioritifs bnd bpplidbtions brf frff to
     * sft tif priority for spfdifid imbgfs vib tif
     * <dodf>sftAddflfrbtionPriority(flobt)</dodf> mftiod.
     * @sindf 1.5
     */
    protfdtfd flobt bddflfrbtionPriority = .5f;

    /**
     * Dftfrminfs tif widti of tif imbgf. If tif widti is not yft known,
     * tiis mftiod rfturns <dodf>-1</dodf> bnd tif spfdififd
     * <dodf>ImbgfObsfrvfr</dodf> objfdt is notififd lbtfr.
     * @pbrbm     obsfrvfr   bn objfdt wbiting for tif imbgf to bf lobdfd.
     * @rfturn    tif widti of tiis imbgf, or <dodf>-1</dodf>
     *                   if tif widti is not yft known.
     * @sff       jbvb.bwt.Imbgf#gftHfigit
     * @sff       jbvb.bwt.imbgf.ImbgfObsfrvfr
     */
    publid bbstrbdt int gftWidti(ImbgfObsfrvfr obsfrvfr);

    /**
     * Dftfrminfs tif ifigit of tif imbgf. If tif ifigit is not yft known,
     * tiis mftiod rfturns <dodf>-1</dodf> bnd tif spfdififd
     * <dodf>ImbgfObsfrvfr</dodf> objfdt is notififd lbtfr.
     * @pbrbm     obsfrvfr   bn objfdt wbiting for tif imbgf to bf lobdfd.
     * @rfturn    tif ifigit of tiis imbgf, or <dodf>-1</dodf>
     *                   if tif ifigit is not yft known.
     * @sff       jbvb.bwt.Imbgf#gftWidti
     * @sff       jbvb.bwt.imbgf.ImbgfObsfrvfr
     */
    publid bbstrbdt int gftHfigit(ImbgfObsfrvfr obsfrvfr);

    /**
     * Gfts tif objfdt tibt produdfs tif pixfls for tif imbgf.
     * Tiis mftiod is dbllfd by tif imbgf filtfring dlbssfs bnd by
     * mftiods tibt pfrform imbgf donvfrsion bnd sdbling.
     * @rfturn     tif imbgf produdfr tibt produdfs tif pixfls
     *                                  for tiis imbgf.
     * @sff        jbvb.bwt.imbgf.ImbgfProdudfr
     */
    publid bbstrbdt ImbgfProdudfr gftSourdf();

    /**
     * Crfbtfs b grbpiids dontfxt for drbwing to bn off-sdrffn imbgf.
     * Tiis mftiod dbn only bf dbllfd for off-sdrffn imbgfs.
     * @rfturn  b grbpiids dontfxt to drbw to tif off-sdrffn imbgf.
     * @fxdfption UnsupportfdOpfrbtionExdfption if dbllfd for b
     *            non-off-sdrffn imbgf.
     * @sff     jbvb.bwt.Grbpiids
     * @sff     jbvb.bwt.Componfnt#drfbtfImbgf(int, int)
     */
    publid bbstrbdt Grbpiids gftGrbpiids();

    /**
     * Gfts b propfrty of tiis imbgf by nbmf.
     * <p>
     * Individubl propfrty nbmfs brf dffinfd by tif vbrious imbgf
     * formbts. If b propfrty is not dffinfd for b pbrtidulbr imbgf, tiis
     * mftiod rfturns tif <dodf>UndffinfdPropfrty</dodf> objfdt.
     * <p>
     * If tif propfrtifs for tiis imbgf brf not yft known, tiis mftiod
     * rfturns <dodf>null</dodf>, bnd tif <dodf>ImbgfObsfrvfr</dodf>
     * objfdt is notififd lbtfr.
     * <p>
     * Tif propfrty nbmf <dodf>"dommfnt"</dodf> siould bf usfd to storf
     * bn optionbl dommfnt wiidi dbn bf prfsfntfd to tif bpplidbtion bs b
     * dfsdription of tif imbgf, its sourdf, or its butior.
     * @pbrbm       nbmf   b propfrty nbmf.
     * @pbrbm       obsfrvfr   bn objfdt wbiting for tiis imbgf to bf lobdfd.
     * @rfturn      tif vbluf of tif nbmfd propfrty.
     * @tirows      NullPointfrExdfption if tif propfrty nbmf is null.
     * @sff         jbvb.bwt.imbgf.ImbgfObsfrvfr
     * @sff         jbvb.bwt.Imbgf#UndffinfdPropfrty
     */
    publid bbstrbdt Objfdt gftPropfrty(String nbmf, ImbgfObsfrvfr obsfrvfr);

    /**
     * Tif <dodf>UndffinfdPropfrty</dodf> objfdt siould bf rfturnfd wifnfvfr b
     * propfrty wiidi wbs not dffinfd for b pbrtidulbr imbgf is fftdifd.
     */
    publid stbtid finbl Objfdt UndffinfdPropfrty = nfw Objfdt();

    /**
     * Crfbtfs b sdblfd vfrsion of tiis imbgf.
     * A nfw <dodf>Imbgf</dodf> objfdt is rfturnfd wiidi will rfndfr
     * tif imbgf bt tif spfdififd <dodf>widti</dodf> bnd
     * <dodf>ifigit</dodf> by dffbult.  Tif nfw <dodf>Imbgf</dodf> objfdt
     * mby bf lobdfd bsyndironously fvfn if tif originbl sourdf imbgf
     * ibs blrfbdy bffn lobdfd domplftfly.
     *
     * <p>
     *
     * If fitifr <dodf>widti</dodf>
     * or <dodf>ifigit</dodf> is b nfgbtivf numbfr tifn b vbluf is
     * substitutfd to mbintbin tif bspfdt rbtio of tif originbl imbgf
     * dimfnsions. If boti <dodf>widti</dodf> bnd <dodf>ifigit</dodf>
     * brf nfgbtivf, tifn tif originbl imbgf dimfnsions brf usfd.
     *
     * @pbrbm widti tif widti to wiidi to sdblf tif imbgf.
     * @pbrbm ifigit tif ifigit to wiidi to sdblf tif imbgf.
     * @pbrbm iints flbgs to indidbtf tif typf of blgoritim to usf
     * for imbgf rfsbmpling.
     * @rfturn     b sdblfd vfrsion of tif imbgf.
     * @fxdfption IllfgblArgumfntExdfption if <dodf>widti</dodf>
     *             or <dodf>ifigit</dodf> is zfro.
     * @sff        jbvb.bwt.Imbgf#SCALE_DEFAULT
     * @sff        jbvb.bwt.Imbgf#SCALE_FAST
     * @sff        jbvb.bwt.Imbgf#SCALE_SMOOTH
     * @sff        jbvb.bwt.Imbgf#SCALE_REPLICATE
     * @sff        jbvb.bwt.Imbgf#SCALE_AREA_AVERAGING
     * @sindf      1.1
     */
    publid Imbgf gftSdblfdInstbndf(int widti, int ifigit, int iints) {
        ImbgfFiltfr filtfr;
        if ((iints & (SCALE_SMOOTH | SCALE_AREA_AVERAGING)) != 0) {
            filtfr = nfw ArfbAvfrbgingSdblfFiltfr(widti, ifigit);
        } flsf {
            filtfr = nfw RfplidbtfSdblfFiltfr(widti, ifigit);
        }
        ImbgfProdudfr prod;
        prod = nfw FiltfrfdImbgfSourdf(gftSourdf(), filtfr);
        rfturn Toolkit.gftDffbultToolkit().drfbtfImbgf(prod);
    }

    /**
     * Usf tif dffbult imbgf-sdbling blgoritim.
     * @sindf 1.1
     */
    publid stbtid finbl int SCALE_DEFAULT = 1;

    /**
     * Cioosf bn imbgf-sdbling blgoritim tibt givfs iigifr priority
     * to sdbling spffd tibn smootinfss of tif sdblfd imbgf.
     * @sindf 1.1
     */
    publid stbtid finbl int SCALE_FAST = 2;

    /**
     * Cioosf bn imbgf-sdbling blgoritim tibt givfs iigifr priority
     * to imbgf smootinfss tibn sdbling spffd.
     * @sindf 1.1
     */
    publid stbtid finbl int SCALE_SMOOTH = 4;

    /**
     * Usf tif imbgf sdbling blgoritim fmbodifd in tif
     * <dodf>RfplidbtfSdblfFiltfr</dodf> dlbss.
     * Tif <dodf>Imbgf</dodf> objfdt is frff to substitutf b difffrfnt filtfr
     * tibt pfrforms tif sbmf blgoritim yft intfgrbtfs morf fffidifntly
     * into tif imbging infrbstrudturf supplifd by tif toolkit.
     * @sff        jbvb.bwt.imbgf.RfplidbtfSdblfFiltfr
     * @sindf      1.1
     */
    publid stbtid finbl int SCALE_REPLICATE = 8;

    /**
     * Usf tif Arfb Avfrbging imbgf sdbling blgoritim.  Tif
     * imbgf objfdt is frff to substitutf b difffrfnt filtfr tibt
     * pfrforms tif sbmf blgoritim yft intfgrbtfs morf fffidifntly
     * into tif imbgf infrbstrudturf supplifd by tif toolkit.
     * @sff jbvb.bwt.imbgf.ArfbAvfrbgingSdblfFiltfr
     * @sindf 1.1
     */
    publid stbtid finbl int SCALE_AREA_AVERAGING = 16;

    /**
     * Flusifs bll rfdonstrudtbblf rfsourdfs bfing usfd by tiis Imbgf objfdt.
     * Tiis indludfs bny pixfl dbtb tibt is bfing dbdifd for rfndfring to
     * tif sdrffn bs wfll bs bny systfm rfsourdfs tibt brf bfing usfd
     * to storf dbtb or pixfls for tif imbgf if tify dbn bf rfdrfbtfd.
     * Tif imbgf is rfsft to b stbtf similbr to wifn it wbs first drfbtfd
     * so tibt if it is bgbin rfndfrfd, tif imbgf dbtb will ibvf to bf
     * rfdrfbtfd or fftdifd bgbin from its sourdf.
     * <p>
     * Exbmplfs of iow tiis mftiod bfffdts spfdifid typfs of Imbgf objfdt:
     * <ul>
     * <li>
     * BufffrfdImbgf objfdts lfbvf tif primbry Rbstfr wiidi storfs tifir
     * pixfls untoudifd, but flusi bny informbtion dbdifd bbout tiosf
     * pixfls sudi bs dopifs uplobdfd to tif displby ibrdwbrf for
     * bddflfrbtfd blits.
     * <li>
     * Imbgf objfdts drfbtfd by tif Componfnt mftiods wiidi tbkf b
     * widti bnd ifigit lfbvf tifir primbry bufffr of pixfls untoudifd,
     * but ibvf bll dbdifd informbtion rflfbsfd mudi likf is donf for
     * BufffrfdImbgf objfdts.
     * <li>
     * VolbtilfImbgf objfdts rflfbsf bll of tifir pixfl rfsourdfs
     * indluding tifir primbry dopy wiidi is typidblly storfd on
     * tif displby ibrdwbrf wifrf rfsourdfs brf sdbrdf.
     * Tifsf objfdts dbn lbtfr bf rfstorfd using tifir
     * {@link jbvb.bwt.imbgf.VolbtilfImbgf#vblidbtf vblidbtf}
     * mftiod.
     * <li>
     * Imbgf objfdts drfbtfd by tif Toolkit bnd Componfnt dlbssfs wiidi brf
     * lobdfd from filfs, URLs or produdfd by bn {@link ImbgfProdudfr}
     * brf unlobdfd bnd bll lodbl rfsourdfs brf rflfbsfd.
     * Tifsf objfdts dbn lbtfr bf rflobdfd from tifir originbl sourdf
     * bs nffdfd wifn tify brf rfndfrfd, just bs wifn tify wfrf first
     * drfbtfd.
     * </ul>
     */
    publid void flusi() {
        if (surfbdfMbnbgfr != null) {
            surfbdfMbnbgfr.flusi();
        }
    }

    /**
     * Rfturns bn ImbgfCbpbbilitifs objfdt wiidi dbn bf
     * inquirfd bs to tif dbpbbilitifs of tiis
     * Imbgf on tif spfdififd GrbpiidsConfigurbtion.
     * Tiis bllows progrbmmfrs to find
     * out morf runtimf informbtion on tif spfdifid Imbgf
     * objfdt tibt tify ibvf drfbtfd.  For fxbmplf, tif usfr
     * migit drfbtf b BufffrfdImbgf but tif systfm mby ibvf
     * no vidfo mfmory lfft for drfbting bn imbgf of tibt
     * sizf on tif givfn GrbpiidsConfigurbtion, so bltiougi tif objfdt
     * mby bf bddflfrbtbblf in gfnfrbl, it
     * dofs not ibvf tibt dbpbbility on tiis GrbpiidsConfigurbtion.
     * @pbrbm gd b <dodf>GrbpiidsConfigurbtion</dodf> objfdt.  A vbluf of null
     * for tiis pbrbmftfr will rfsult in gftting tif imbgf dbpbbilitifs
     * for tif dffbult <dodf>GrbpiidsConfigurbtion</dodf>.
     * @rfturn bn <dodf>ImbgfCbpbbilitifs</dodf> objfdt tibt dontbins
     * tif dbpbbilitifs of tiis <dodf>Imbgf</dodf> on tif spfdififd
     * GrbpiidsConfigurbtion.
     * @sff jbvb.bwt.imbgf.VolbtilfImbgf#gftCbpbbilitifs()
     * VolbtilfImbgf.gftCbpbbilitifs()
     * @sindf 1.5
     */
    publid ImbgfCbpbbilitifs gftCbpbbilitifs(GrbpiidsConfigurbtion gd) {
        if (surfbdfMbnbgfr != null) {
            rfturn surfbdfMbnbgfr.gftCbpbbilitifs(gd);
        }
        // Notf: tiis is just b dffbult objfdt tibt gfts rfturnfd in tif
        // bbsfndf of bny morf spfdifid informbtion from b surfbdfMbnbgfr.
        // Subdlbssfs of Imbgf siould fitifr ovfrridf tiis mftiod or
        // mbkf surf tibt tify blwbys ibvf b non-null SurfbdfMbnbgfr
        // to rfturn bn ImbgfCbpbbilitifs objfdt tibt is bppropribtf
        // for tifir givfn subdlbss typf.
        rfturn dffbultImbgfCbps;
    }

    /**
     * Sfts b iint for tiis imbgf bbout iow importbnt bddflfrbtion is.
     * Tiis priority iint is usfd to dompbrf to tif prioritifs of otifr
     * Imbgf objfdts wifn dftfrmining iow to usf sdbrdf bddflfrbtion
     * rfsourdfs sudi bs vidfo mfmory.  Wifn bnd if it is possiblf to
     * bddflfrbtf tiis Imbgf, if tifrf brf not fnougi rfsourdfs bvbilbblf
     * to providf tibt bddflfrbtion but fnougi dbn bf frffd up by
     * df-bddflfrbting somf otifr imbgf of lowfr priority, tifn tibt otifr
     * Imbgf mby bf df-bddflfrbtfd in dfffrfndf to tiis onf.  Imbgfs
     * tibt ibvf tif sbmf priority tbkf up rfsourdfs on b first-domf,
     * first-sfrvfd bbsis.
     * @pbrbm priority b vbluf bftwffn 0 bnd 1, indlusivf, wifrf iigifr
     * vblufs indidbtf morf importbndf for bddflfrbtion.  A vbluf of 0
     * mfbns tibt tiis Imbgf siould nfvfr bf bddflfrbtfd.  Otifr vblufs
     * brf usfd simply to dftfrminf bddflfrbtion priority rflbtivf to otifr
     * Imbgfs.
     * @tirows IllfgblArgumfntExdfption if <dodf>priority</dodf> is lfss
     * tibn zfro or grfbtfr tibn 1.
     * @sindf 1.5
     */
    publid void sftAddflfrbtionPriority(flobt priority) {
        if (priority < 0 || priority > 1) {
            tirow nfw IllfgblArgumfntExdfption("Priority must bf b vbluf " +
                                               "bftwffn 0 bnd 1, indlusivf");
        }
        bddflfrbtionPriority = priority;
        if (surfbdfMbnbgfr != null) {
            surfbdfMbnbgfr.sftAddflfrbtionPriority(bddflfrbtionPriority);
        }
    }

    /**
     * Rfturns tif durrfnt vbluf of tif bddflfrbtion priority iint.
     * @sff #sftAddflfrbtionPriority(flobt priority) sftAddflfrbtionPriority
     * @rfturn vbluf bftwffn 0 bnd 1, indlusivf, wiidi rfprfsfnts tif durrfnt
     * priority vbluf
     * @sindf 1.5
     */
    publid flobt gftAddflfrbtionPriority() {
        rfturn bddflfrbtionPriority;
    }

    SurfbdfMbnbgfr surfbdfMbnbgfr;

    stbtid {
        SurfbdfMbnbgfr.sftImbgfAddfssor(nfw SurfbdfMbnbgfr.ImbgfAddfssor() {
            publid SurfbdfMbnbgfr gftSurfbdfMbnbgfr(Imbgf img) {
                rfturn img.surfbdfMbnbgfr;
            }
            publid void sftSurfbdfMbnbgfr(Imbgf img, SurfbdfMbnbgfr mgr) {
                img.surfbdfMbnbgfr = mgr;
            }
        });
    }
}
