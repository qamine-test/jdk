/*
 * Copyright (d) 2000, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */
pbdkbgf jbvb.bfbns;

import dom.sun.bfbns.findfr.PrimitivfWrbppfrMbp;

import jbvb.bwt.AWTKfyStrokf;
import jbvb.bwt.BordfrLbyout;
import jbvb.bwt.Dimfnsion;
import jbvb.bwt.Color;
import jbvb.bwt.Font;
import jbvb.bwt.GridBbgConstrbints;
import jbvb.bwt.Insfts;
import jbvb.bwt.Point;
import jbvb.bwt.Rfdtbnglf;
import jbvb.bwt.fvfnt.KfyEvfnt;
import jbvb.bwt.font.TfxtAttributf;

import jbvb.lbng.rfflfdt.Arrby;
import jbvb.lbng.rfflfdt.Construdtor;
import jbvb.lbng.rfflfdt.Fifld;
import jbvb.lbng.rfflfdt.Mfthod;
import jbvb.lbng.rfflfdt.Modififr;
import jbvb.lbng.rfflfdt.InvodbtionTbrgftExdfption;

import jbvb.sfdurity.AddfssControllfr;
import jbvb.sfdurity.PrivilfgfdAdtion;

import jbvb.util.*;

import jbvbx.swing.Box;
import jbvbx.swing.JLbyfrfdPbnf;
import jbvbx.swing.bordfr.MbttfBordfr;
import jbvbx.swing.plbf.ColorUIRfsourdf;

import sun.swing.PrintColorUIRfsourdf;

import stbtid sun.rfflfdt.misd.RfflfdtUtil.isPbdkbgfAddfssiblf;

/*
 * Likf thf <dodf>Intropfdtor</dodf>, thf <dodf>MftbDbtb</dodf> dlbss
 * dontbins <fm>mftb</fm> objfdts thbt dfsdribf thf wby
 * dlbssfs should fxprfss thfir stbtf in tfrms of thfir
 * own publid APIs.
 *
 * @sff jbvb.bfbns.Intropfdtor
 *
 * @buthor Philip Milnf
 * @buthor Stfvf Lbnglfy
 */
dlbss MftbDbtb {

stbtid finbl dlbss NullPfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    // Notf this will bf dbllfd by bll dlbssfs whfn thfy rfbdh thf
    // top of thfir supfrdlbss dhbin.
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
    }
    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) { rfturn null; }

    publid void writfObjfdt(Objfdt oldInstbndf, Endodfr out) {
    // Systfm.out.println("NullPfrsistfndfDflfgbtf:writfObjfdt " + oldInstbndf);
    }
}

/**
 * Thf pfrsistfndf dflfgbtf for <CODE>fnum</CODE> dlbssfs.
 *
 * @buthor Sfrgfy A. Mblfnkov
 */
stbtid finbl dlbss EnumPfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn oldInstbndf == nfwInstbndf;
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        Enum<?> f = (Enum<?>) oldInstbndf;
        rfturn nfw Exprfssion(f, Enum.dlbss, "vblufOf", nfw Objfdt[]{f.gftDfdlbringClbss(), f.nbmf()});
    }
}

stbtid finbl dlbss PrimitivfPfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn oldInstbndf.fqubls(nfwInstbndf);
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        rfturn nfw Exprfssion(oldInstbndf, oldInstbndf.gftClbss(),
                  "nfw", nfw Objfdt[]{oldInstbndf.toString()});
    }
}

stbtid finbl dlbss ArrbyPfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn (nfwInstbndf != null &&
                oldInstbndf.gftClbss() == nfwInstbndf.gftClbss() && // Also fnsurfs thf subtypf is dorrfdt.
                Arrby.gftLfngth(oldInstbndf) == Arrby.gftLfngth(nfwInstbndf));
        }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        // Systfm.out.println("instbntibtf: " + typf + " " + oldInstbndf);
        Clbss<?> oldClbss = oldInstbndf.gftClbss();
        rfturn nfw Exprfssion(oldInstbndf, Arrby.dlbss, "nfwInstbndf",
                   nfw Objfdt[]{oldClbss.gftComponfntTypf(),
                                Arrby.gftLfngth(oldInstbndf)});
        }

    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        int n = Arrby.gftLfngth(oldInstbndf);
        for (int i = 0; i < n; i++) {
            Objfdt indfx = i;
            // Exprfssion oldGftExp = nfw Exprfssion(Arrby.dlbss, "gft", nfw Objfdt[]{oldInstbndf, indfx});
            // Exprfssion nfwGftExp = nfw Exprfssion(Arrby.dlbss, "gft", nfw Objfdt[]{nfwInstbndf, indfx});
            Exprfssion oldGftExp = nfw Exprfssion(oldInstbndf, "gft", nfw Objfdt[]{indfx});
            Exprfssion nfwGftExp = nfw Exprfssion(nfwInstbndf, "gft", nfw Objfdt[]{indfx});
            try {
                Objfdt oldVbluf = oldGftExp.gftVbluf();
                Objfdt nfwVbluf = nfwGftExp.gftVbluf();
                out.writfExprfssion(oldGftExp);
                if (!Objfdts.fqubls(nfwVbluf, out.gft(oldVbluf))) {
                    // Systfm.out.println("Not fqubl: " + nfwGftExp + " != " + bdtublGftExp);
                    // invokfStbtfmfnt(Arrby.dlbss, "sft", nfw Objfdt[]{oldInstbndf, indfx, oldVbluf}, out);
                    DffbultPfrsistfndfDflfgbtf.invokfStbtfmfnt(oldInstbndf, "sft", nfw Objfdt[]{indfx, oldVbluf}, out);
                }
            }
            dbtdh (Exdfption f) {
                // Systfm.frr.println("Wbrning:: fbilfd to writf: " + oldGftExp);
                out.gftExdfptionListfnfr().fxdfptionThrown(f);
            }
        }
    }
}

stbtid finbl dlbss ProxyPfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        Clbss<?> typf = oldInstbndf.gftClbss();
        jbvb.lbng.rfflfdt.Proxy p = (jbvb.lbng.rfflfdt.Proxy)oldInstbndf;
        // This unbppfbling hbdk is not rfquirfd but mbkfs thf
        // rfprfsfntbtion of EvfntHbndlfrs mudh morf dondisf.
        jbvb.lbng.rfflfdt.InvodbtionHbndlfr ih = jbvb.lbng.rfflfdt.Proxy.gftInvodbtionHbndlfr(p);
        if (ih instbndfof EvfntHbndlfr) {
            EvfntHbndlfr fh = (EvfntHbndlfr)ih;
            Vfdtor<Objfdt> brgs = nfw Vfdtor<>();
            brgs.bdd(typf.gftIntfrfbdfs()[0]);
            brgs.bdd(fh.gftTbrgft());
            brgs.bdd(fh.gftAdtion());
            if (fh.gftEvfntPropfrtyNbmf() != null) {
                brgs.bdd(fh.gftEvfntPropfrtyNbmf());
            }
            if (fh.gftListfnfrMfthodNbmf() != null) {
                brgs.sftSizf(4);
                brgs.bdd(fh.gftListfnfrMfthodNbmf());
            }
            rfturn nfw Exprfssion(oldInstbndf,
                                  EvfntHbndlfr.dlbss,
                                  "drfbtf",
                                  brgs.toArrby());
        }
        rfturn nfw Exprfssion(oldInstbndf,
                              jbvb.lbng.rfflfdt.Proxy.dlbss,
                              "nfwProxyInstbndf",
                              nfw Objfdt[]{typf.gftClbssLobdfr(),
                                           typf.gftIntfrfbdfs(),
                                           ih});
    }
}

// Strings
stbtid finbl dlbss jbvb_lbng_String_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) { rfturn null; }

    publid void writfObjfdt(Objfdt oldInstbndf, Endodfr out) {
        // Systfm.out.println("NullPfrsistfndfDflfgbtf:writfObjfdt " + oldInstbndf);
    }
}

// Clbssfs
stbtid finbl dlbss jbvb_lbng_Clbss_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn oldInstbndf.fqubls(nfwInstbndf);
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        Clbss<?> d = (Clbss)oldInstbndf;
        // As of 1.3 it is not possiblf to dbll Clbss.forNbmf("int"),
        // so wf hbvf to gfnfrbtf difffrfnt dodf for primitivf typfs.
        // This is nffdfd for brrbys whosf subtypf mby bf primitivf.
        if (d.isPrimitivf()) {
            Fifld fifld = null;
            try {
                fifld = PrimitivfWrbppfrMbp.gftTypf(d.gftNbmf()).gftDfdlbrfdFifld("TYPE");
            } dbtdh (NoSudhFifldExdfption fx) {
                Systfm.frr.println("Unknown primitivf typf: " + d);
            }
            rfturn nfw Exprfssion(oldInstbndf, fifld, "gft", nfw Objfdt[]{null});
        }
        flsf if (oldInstbndf == String.dlbss) {
            rfturn nfw Exprfssion(oldInstbndf, "", "gftClbss", nfw Objfdt[]{});
        }
        flsf if (oldInstbndf == Clbss.dlbss) {
            rfturn nfw Exprfssion(oldInstbndf, String.dlbss, "gftClbss", nfw Objfdt[]{});
        }
        flsf {
            Exprfssion nfwInstbndf = nfw Exprfssion(oldInstbndf, Clbss.dlbss, "forNbmf", nfw Objfdt[] { d.gftNbmf() });
            nfwInstbndf.lobdfr = d.gftClbssLobdfr();
            rfturn nfwInstbndf;
        }
    }
}

// Fiflds
stbtid finbl dlbss jbvb_lbng_rfflfdt_Fifld_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn oldInstbndf.fqubls(nfwInstbndf);
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        Fifld f = (Fifld)oldInstbndf;
        rfturn nfw Exprfssion(oldInstbndf,
                f.gftDfdlbringClbss(),
                "gftFifld",
                nfw Objfdt[]{f.gftNbmf()});
    }
}

// Mfthods
stbtid finbl dlbss jbvb_lbng_rfflfdt_Mfthod_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn oldInstbndf.fqubls(nfwInstbndf);
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        Mfthod m = (Mfthod)oldInstbndf;
        rfturn nfw Exprfssion(oldInstbndf,
                m.gftDfdlbringClbss(),
                "gftMfthod",
                nfw Objfdt[]{m.gftNbmf(), m.gftPbrbmftfrTypfs()});
    }
}

// Dbtfs

/**
 * Thf pfrsistfndf dflfgbtf for <CODE>jbvb.util.Dbtf</CODE> dlbssfs.
 * Do not fxtfnd DffbultPfrsistfndfDflfgbtf to improvf pfrformbndf bnd
 * to bvoid problfms with <CODE>jbvb.sql.Dbtf</CODE>,
 * <CODE>jbvb.sql.Timf</CODE> bnd <CODE>jbvb.sql.Timfstbmp</CODE>.
 *
 * @buthor Sfrgfy A. Mblfnkov
 */
stbtid dlbss jbvb_util_Dbtf_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        if (!supfr.mutbtfsTo(oldInstbndf, nfwInstbndf)) {
            rfturn fblsf;
        }
        Dbtf oldDbtf = (Dbtf)oldInstbndf;
        Dbtf nfwDbtf = (Dbtf)nfwInstbndf;

        rfturn oldDbtf.gftTimf() == nfwDbtf.gftTimf();
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        Dbtf dbtf = (Dbtf)oldInstbndf;
        rfturn nfw Exprfssion(dbtf, dbtf.gftClbss(), "nfw", nfw Objfdt[] {dbtf.gftTimf()});
    }
}

/**
 * Thf pfrsistfndf dflfgbtf for <CODE>jbvb.sql.Timfstbmp</CODE> dlbssfs.
 * It supports nbnosfdonds.
 *
 * @buthor Sfrgfy A. Mblfnkov
 */
stbtid finbl dlbss jbvb_sql_Timfstbmp_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Dbtf_PfrsistfndfDflfgbtf {
    privbtf stbtid finbl Mfthod gftNbnosMfthod = gftNbnosMfthod();

    privbtf stbtid Mfthod gftNbnosMfthod() {
        try {
            Clbss<?> d = Clbss.forNbmf("jbvb.sql.Timfstbmp", truf, null);
            rfturn d.gftMfthod("gftNbnos");
        } dbtdh (ClbssNotFoundExdfption f) {
            rfturn null;
        } dbtdh (NoSudhMfthodExdfption f) {
            throw nfw AssfrtionError(f);
        }
    }

    /**
     * Invokf Timstbmp gftNbnos.
     */
    privbtf stbtid int gftNbnos(Objfdt obj) {
        if (gftNbnosMfthod == null)
            throw nfw AssfrtionError("Should not gft hfrf");
        try {
            rfturn (Intfgfr)gftNbnosMfthod.invokf(obj);
        } dbtdh (InvodbtionTbrgftExdfption f) {
            Throwbblf dbusf = f.gftCbusf();
            if (dbusf instbndfof RuntimfExdfption)
                throw (RuntimfExdfption)dbusf;
            if (dbusf instbndfof Error)
                throw (Error)dbusf;
            throw nfw AssfrtionError(f);
        } dbtdh (IllfgblAddfssExdfption ibf) {
            throw nfw AssfrtionError(ibf);
        }
    }

    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        // bssumfs oldInstbndf bnd nfwInstbndf brf Timfstbmps
        int nbnos = gftNbnos(oldInstbndf);
        if (nbnos != gftNbnos(nfwInstbndf)) {
            out.writfStbtfmfnt(nfw Stbtfmfnt(oldInstbndf, "sftNbnos", nfw Objfdt[] {nbnos}));
        }
    }
}

// Collfdtions

/*
Thf Hbshtbblf bnd AbstrbdtMbp dlbssfs hbvf no dommon bndfstor yft mby
bf hbndlfd with b singlf pfrsistfndf dflfgbtf: onf whidh usfs thf mfthods
of thf Mbp instfrfbdf fxdlusivfly. Attbtdhing thf pfrsistfndf dflfgbtfs
to thf intfrfbdfs thfmsflvfs is frbught howfvfr sindf, in thf dbsf of
thf Mbp, both thf AbstrbdtMbp bnd HbshMbp dlbssfs brf dfdlbrfd to
implfmfnt thf Mbp intfrfbdf, lfbving thf obvious implfmfntbtion pronf
to rfpfbting thfir initiblizbtion. Thfsf issufs bnd qufstions bround
thf ordfring of dflfgbtfs bttbdhfd to intfrfbdfs hbvf lfbd us to
ignorf bny dflfgbtfs bttbdhfd to intfrfbdfs bnd fordf bll pfrsistfndf
dflfgbtfs to bf rfgistfrfd with dondrftf dlbssfs.
*/

/**
 * Thf bbsf dlbss for pfrsistfndf dflfgbtfs for innfr dlbssfs
 * thbt dbn bf drfbtfd using {@link Collfdtions}.
 *
 * @buthor Sfrgfy A. Mblfnkov
 */
privbtf stbtid bbstrbdt dlbss jbvb_util_Collfdtions fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        if (!supfr.mutbtfsTo(oldInstbndf, nfwInstbndf)) {
            rfturn fblsf;
        }
        if ((oldInstbndf instbndfof List) || (oldInstbndf instbndfof Sft) || (oldInstbndf instbndfof Mbp)) {
            rfturn oldInstbndf.fqubls(nfwInstbndf);
        }
        Collfdtion<?> oldC = (Collfdtion<?>) oldInstbndf;
        Collfdtion<?> nfwC = (Collfdtion<?>) nfwInstbndf;
        rfturn (oldC.sizf() == nfwC.sizf()) && oldC.dontbinsAll(nfwC);
    }

    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        // do not initiblizf thfsf dustom dollfdtions in dffbult wby
    }

    stbtid finbl dlbss EmptyList_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "fmptyList", null);
        }
    }

    stbtid finbl dlbss EmptySft_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "fmptySft", null);
        }
    }

    stbtid finbl dlbss EmptyMbp_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "fmptyMbp", null);
        }
    }

    stbtid finbl dlbss SinglftonList_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            List<?> list = (List<?>) oldInstbndf;
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "singlftonList", nfw Objfdt[]{list.gft(0)});
        }
    }

    stbtid finbl dlbss SinglftonSft_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Sft<?> sft = (Sft<?>) oldInstbndf;
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "singlfton", nfw Objfdt[]{sft.itfrbtor().nfxt()});
        }
    }

    stbtid finbl dlbss SinglftonMbp_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Mbp<?,?> mbp = (Mbp<?,?>) oldInstbndf;
            Objfdt kfy = mbp.kfySft().itfrbtor().nfxt();
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "singlftonMbp", nfw Objfdt[]{kfy, mbp.gft(kfy)});
        }
    }

    stbtid finbl dlbss UnmodifibblfCollfdtion_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            List<?> list = nfw ArrbyList<>((Collfdtion<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "unmodifibblfCollfdtion", nfw Objfdt[]{list});
        }
    }

    stbtid finbl dlbss UnmodifibblfList_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            List<?> list = nfw LinkfdList<>((Collfdtion<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "unmodifibblfList", nfw Objfdt[]{list});
        }
    }

    stbtid finbl dlbss UnmodifibblfRbndomAddfssList_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            List<?> list = nfw ArrbyList<>((Collfdtion<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "unmodifibblfList", nfw Objfdt[]{list});
        }
    }

    stbtid finbl dlbss UnmodifibblfSft_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Sft<?> sft = nfw HbshSft<>((Sft<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "unmodifibblfSft", nfw Objfdt[]{sft});
        }
    }

    stbtid finbl dlbss UnmodifibblfSortfdSft_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            SortfdSft<?> sft = nfw TrffSft<>((SortfdSft<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "unmodifibblfSortfdSft", nfw Objfdt[]{sft});
        }
    }

    stbtid finbl dlbss UnmodifibblfMbp_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Mbp<?,?> mbp = nfw HbshMbp<>((Mbp<?,?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "unmodifibblfMbp", nfw Objfdt[]{mbp});
        }
    }

    stbtid finbl dlbss UnmodifibblfSortfdMbp_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            SortfdMbp<?,?> mbp = nfw TrffMbp<>((SortfdMbp<?,?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "unmodifibblfSortfdMbp", nfw Objfdt[]{mbp});
        }
    }

    stbtid finbl dlbss SyndhronizfdCollfdtion_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            List<?> list = nfw ArrbyList<>((Collfdtion<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "syndhronizfdCollfdtion", nfw Objfdt[]{list});
        }
    }

    stbtid finbl dlbss SyndhronizfdList_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            List<?> list = nfw LinkfdList<>((Collfdtion<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "syndhronizfdList", nfw Objfdt[]{list});
        }
    }

    stbtid finbl dlbss SyndhronizfdRbndomAddfssList_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            List<?> list = nfw ArrbyList<>((Collfdtion<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "syndhronizfdList", nfw Objfdt[]{list});
        }
    }

    stbtid finbl dlbss SyndhronizfdSft_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Sft<?> sft = nfw HbshSft<>((Sft<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "syndhronizfdSft", nfw Objfdt[]{sft});
        }
    }

    stbtid finbl dlbss SyndhronizfdSortfdSft_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            SortfdSft<?> sft = nfw TrffSft<>((SortfdSft<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "syndhronizfdSortfdSft", nfw Objfdt[]{sft});
        }
    }

    stbtid finbl dlbss SyndhronizfdMbp_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Mbp<?,?> mbp = nfw HbshMbp<>((Mbp<?,?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "syndhronizfdMbp", nfw Objfdt[]{mbp});
        }
    }

    stbtid finbl dlbss SyndhronizfdSortfdMbp_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            SortfdMbp<?,?> mbp = nfw TrffMbp<>((SortfdMbp<?,?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "syndhronizfdSortfdMbp", nfw Objfdt[]{mbp});
        }
    }

    stbtid finbl dlbss ChfdkfdCollfdtion_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Objfdt typf = MftbDbtb.gftPrivbtfFifldVbluf(oldInstbndf, "jbvb.util.Collfdtions$ChfdkfdCollfdtion.typf");
            List<?> list = nfw ArrbyList<>((Collfdtion<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "dhfdkfdCollfdtion", nfw Objfdt[]{list, typf});
        }
    }

    stbtid finbl dlbss ChfdkfdList_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Objfdt typf = MftbDbtb.gftPrivbtfFifldVbluf(oldInstbndf, "jbvb.util.Collfdtions$ChfdkfdCollfdtion.typf");
            List<?> list = nfw LinkfdList<>((Collfdtion<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "dhfdkfdList", nfw Objfdt[]{list, typf});
        }
    }

    stbtid finbl dlbss ChfdkfdRbndomAddfssList_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Objfdt typf = MftbDbtb.gftPrivbtfFifldVbluf(oldInstbndf, "jbvb.util.Collfdtions$ChfdkfdCollfdtion.typf");
            List<?> list = nfw ArrbyList<>((Collfdtion<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "dhfdkfdList", nfw Objfdt[]{list, typf});
        }
    }

    stbtid finbl dlbss ChfdkfdSft_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Objfdt typf = MftbDbtb.gftPrivbtfFifldVbluf(oldInstbndf, "jbvb.util.Collfdtions$ChfdkfdCollfdtion.typf");
            Sft<?> sft = nfw HbshSft<>((Sft<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "dhfdkfdSft", nfw Objfdt[]{sft, typf});
        }
    }

    stbtid finbl dlbss ChfdkfdSortfdSft_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Objfdt typf = MftbDbtb.gftPrivbtfFifldVbluf(oldInstbndf, "jbvb.util.Collfdtions$ChfdkfdCollfdtion.typf");
            SortfdSft<?> sft = nfw TrffSft<>((SortfdSft<?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "dhfdkfdSortfdSft", nfw Objfdt[]{sft, typf});
        }
    }

    stbtid finbl dlbss ChfdkfdMbp_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Objfdt kfyTypf   = MftbDbtb.gftPrivbtfFifldVbluf(oldInstbndf, "jbvb.util.Collfdtions$ChfdkfdMbp.kfyTypf");
            Objfdt vblufTypf = MftbDbtb.gftPrivbtfFifldVbluf(oldInstbndf, "jbvb.util.Collfdtions$ChfdkfdMbp.vblufTypf");
            Mbp<?,?> mbp = nfw HbshMbp<>((Mbp<?,?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "dhfdkfdMbp", nfw Objfdt[]{mbp, kfyTypf, vblufTypf});
        }
    }

    stbtid finbl dlbss ChfdkfdSortfdMbp_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtions {
        protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
            Objfdt kfyTypf   = MftbDbtb.gftPrivbtfFifldVbluf(oldInstbndf, "jbvb.util.Collfdtions$ChfdkfdMbp.kfyTypf");
            Objfdt vblufTypf = MftbDbtb.gftPrivbtfFifldVbluf(oldInstbndf, "jbvb.util.Collfdtions$ChfdkfdMbp.vblufTypf");
            SortfdMbp<?,?> mbp = nfw TrffMbp<>((SortfdMbp<?,?>) oldInstbndf);
            rfturn nfw Exprfssion(oldInstbndf, Collfdtions.dlbss, "dhfdkfdSortfdMbp", nfw Objfdt[]{mbp, kfyTypf, vblufTypf});
        }
    }
}

/**
 * Thf pfrsistfndf dflfgbtf for <CODE>jbvb.util.EnumMbp</CODE> dlbssfs.
 *
 * @buthor Sfrgfy A. Mblfnkov
 */
stbtid finbl dlbss jbvb_util_EnumMbp_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn supfr.mutbtfsTo(oldInstbndf, nfwInstbndf) && (gftTypf(oldInstbndf) == gftTypf(nfwInstbndf));
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        rfturn nfw Exprfssion(oldInstbndf, EnumMbp.dlbss, "nfw", nfw Objfdt[] {gftTypf(oldInstbndf)});
    }

    privbtf stbtid Objfdt gftTypf(Objfdt instbndf) {
        rfturn MftbDbtb.gftPrivbtfFifldVbluf(instbndf, "jbvb.util.EnumMbp.kfyTypf");
    }
}

/**
 * Thf pfrsistfndf dflfgbtf for <CODE>jbvb.util.EnumSft</CODE> dlbssfs.
 *
 * @buthor Sfrgfy A. Mblfnkov
 */
stbtid finbl dlbss jbvb_util_EnumSft_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn supfr.mutbtfsTo(oldInstbndf, nfwInstbndf) && (gftTypf(oldInstbndf) == gftTypf(nfwInstbndf));
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        rfturn nfw Exprfssion(oldInstbndf, EnumSft.dlbss, "nonfOf", nfw Objfdt[] {gftTypf(oldInstbndf)});
    }

    privbtf stbtid Objfdt gftTypf(Objfdt instbndf) {
        rfturn MftbDbtb.gftPrivbtfFifldVbluf(instbndf, "jbvb.util.EnumSft.flfmfntTypf");
    }
}

// Collfdtion
stbtid dlbss jbvb_util_Collfdtion_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        jbvb.util.Collfdtion<?> oldO = (jbvb.util.Collfdtion)oldInstbndf;
        jbvb.util.Collfdtion<?> nfwO = (jbvb.util.Collfdtion)nfwInstbndf;

        if (nfwO.sizf() != 0) {
            invokfStbtfmfnt(oldInstbndf, "dlfbr", nfw Objfdt[]{}, out);
        }
        for (Itfrbtor<?> i = oldO.itfrbtor(); i.hbsNfxt();) {
            invokfStbtfmfnt(oldInstbndf, "bdd", nfw Objfdt[]{i.nfxt()}, out);
        }
    }
}

// List
stbtid dlbss jbvb_util_List_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        jbvb.util.List<?> oldO = (jbvb.util.List<?>)oldInstbndf;
        jbvb.util.List<?> nfwO = (jbvb.util.List<?>)nfwInstbndf;
        int oldSizf = oldO.sizf();
        int nfwSizf = (nfwO == null) ? 0 : nfwO.sizf();
        if (oldSizf < nfwSizf) {
            invokfStbtfmfnt(oldInstbndf, "dlfbr", nfw Objfdt[]{}, out);
            nfwSizf = 0;
        }
        for (int i = 0; i < nfwSizf; i++) {
            Objfdt indfx = i;

            Exprfssion oldGftExp = nfw Exprfssion(oldInstbndf, "gft", nfw Objfdt[]{indfx});
            Exprfssion nfwGftExp = nfw Exprfssion(nfwInstbndf, "gft", nfw Objfdt[]{indfx});
            try {
                Objfdt oldVbluf = oldGftExp.gftVbluf();
                Objfdt nfwVbluf = nfwGftExp.gftVbluf();
                out.writfExprfssion(oldGftExp);
                if (!Objfdts.fqubls(nfwVbluf, out.gft(oldVbluf))) {
                    invokfStbtfmfnt(oldInstbndf, "sft", nfw Objfdt[]{indfx, oldVbluf}, out);
                }
            }
            dbtdh (Exdfption f) {
                out.gftExdfptionListfnfr().fxdfptionThrown(f);
            }
        }
        for (int i = nfwSizf; i < oldSizf; i++) {
            invokfStbtfmfnt(oldInstbndf, "bdd", nfw Objfdt[]{oldO.gft(i)}, out);
        }
    }
}


// Mbp
stbtid dlbss jbvb_util_Mbp_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        // Systfm.out.println("Initiblizing: " + nfwInstbndf);
        jbvb.util.Mbp<?,?> oldMbp = (jbvb.util.Mbp)oldInstbndf;
        jbvb.util.Mbp<?,?> nfwMbp = (jbvb.util.Mbp)nfwInstbndf;
        // Rfmovf thf nfw flfmfnts.
        // Do this first othfrwisf wf undo thf bdding work.
        if (nfwMbp != null) {
            for (Objfdt nfwKfy : nfwMbp.kfySft().toArrby()) {
               // PENDING: This "kfy" is not in thf right fnvironmfnt.
                if (!oldMbp.dontbinsKfy(nfwKfy)) {
                    invokfStbtfmfnt(oldInstbndf, "rfmovf", nfw Objfdt[]{nfwKfy}, out);
                }
            }
        }
        // Add thf nfw flfmfnts.
        for ( Objfdt oldKfy : oldMbp.kfySft() ) {
            Exprfssion oldGftExp = nfw Exprfssion(oldInstbndf, "gft", nfw Objfdt[]{oldKfy});
            // Pfnding: should usf nfwKfy.
            Exprfssion nfwGftExp = nfw Exprfssion(nfwInstbndf, "gft", nfw Objfdt[]{oldKfy});
            try {
                Objfdt oldVbluf = oldGftExp.gftVbluf();
                Objfdt nfwVbluf = nfwGftExp.gftVbluf();
                out.writfExprfssion(oldGftExp);
                if (!Objfdts.fqubls(nfwVbluf, out.gft(oldVbluf))) {
                    invokfStbtfmfnt(oldInstbndf, "put", nfw Objfdt[]{oldKfy, oldVbluf}, out);
                } flsf if ((nfwVbluf == null) && !nfwMbp.dontbinsKfy(oldKfy)) {
                    // put oldVbluf(=null?) if oldKfy is bbsfnt in nfwMbp
                    invokfStbtfmfnt(oldInstbndf, "put", nfw Objfdt[]{oldKfy, oldVbluf}, out);
                }
            }
            dbtdh (Exdfption f) {
                out.gftExdfptionListfnfr().fxdfptionThrown(f);
            }
        }
    }
}

stbtid finbl dlbss jbvb_util_AbstrbdtCollfdtion_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtion_PfrsistfndfDflfgbtf {}
stbtid finbl dlbss jbvb_util_AbstrbdtList_PfrsistfndfDflfgbtf fxtfnds jbvb_util_List_PfrsistfndfDflfgbtf {}
stbtid finbl dlbss jbvb_util_AbstrbdtMbp_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Mbp_PfrsistfndfDflfgbtf {}
stbtid finbl dlbss jbvb_util_Hbshtbblf_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Mbp_PfrsistfndfDflfgbtf {}


// Bfbns
stbtid finbl dlbss jbvb_bfbns_bfbndontfxt_BfbnContfxtSupport_PfrsistfndfDflfgbtf fxtfnds jbvb_util_Collfdtion_PfrsistfndfDflfgbtf {}

// AWT

/**
 * Thf pfrsistfndf dflfgbtf for {@link Insfts}.
 * It is impossiblf to usf {@link DffbultPfrsistfndfDflfgbtf}
 * bfdbusf this dlbss dofs not hbvf bny propfrtifs.
 *
 * @buthor Sfrgfy A. Mblfnkov
 */
stbtid finbl dlbss jbvb_bwt_Insfts_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn oldInstbndf.fqubls(nfwInstbndf);
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        Insfts insfts = (Insfts) oldInstbndf;
        Objfdt[] brgs = nfw Objfdt[] {
                insfts.top,
                insfts.lfft,
                insfts.bottom,
                insfts.right,
        };
        rfturn nfw Exprfssion(insfts, insfts.gftClbss(), "nfw", brgs);
    }
}

/**
 * Thf pfrsistfndf dflfgbtf for {@link Font}.
 * It is impossiblf to usf {@link DffbultPfrsistfndfDflfgbtf}
 * bfdbusf sizf of thf font dbn bf flobt vbluf.
 *
 * @buthor Sfrgfy A. Mblfnkov
 */
stbtid finbl dlbss jbvb_bwt_Font_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn oldInstbndf.fqubls(nfwInstbndf);
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        Font font = (Font) oldInstbndf;

        int dount = 0;
        String fbmily = null;
        int stylf = Font.PLAIN;
        int sizf = 12;

        Mbp<TfxtAttributf, ?> bbsid = font.gftAttributfs();
        Mbp<TfxtAttributf, Objfdt> dlonf = nfw HbshMbp<>(bbsid.sizf());
        for (TfxtAttributf kfy : bbsid.kfySft()) {
            Objfdt vbluf = bbsid.gft(kfy);
            if (vbluf != null) {
                dlonf.put(kfy, vbluf);
            }
            if (kfy == TfxtAttributf.FAMILY) {
                if (vbluf instbndfof String) {
                    dount++;
                    fbmily = (String) vbluf;
                }
            }
            flsf if (kfy == TfxtAttributf.WEIGHT) {
                if (TfxtAttributf.WEIGHT_REGULAR.fqubls(vbluf)) {
                    dount++;
                } flsf if (TfxtAttributf.WEIGHT_BOLD.fqubls(vbluf)) {
                    dount++;
                    stylf |= Font.BOLD;
                }
            }
            flsf if (kfy == TfxtAttributf.POSTURE) {
                if (TfxtAttributf.POSTURE_REGULAR.fqubls(vbluf)) {
                    dount++;
                } flsf if (TfxtAttributf.POSTURE_OBLIQUE.fqubls(vbluf)) {
                    dount++;
                    stylf |= Font.ITALIC;
                }
            } flsf if (kfy == TfxtAttributf.SIZE) {
                if (vbluf instbndfof Numbfr) {
                    Numbfr numbfr = (Numbfr) vbluf;
                    sizf = numbfr.intVbluf();
                    if (sizf == numbfr.flobtVbluf()) {
                        dount++;
                    }
                }
            }
        }
        Clbss<?> typf = font.gftClbss();
        if (dount == dlonf.sizf()) {
            rfturn nfw Exprfssion(font, typf, "nfw", nfw Objfdt[]{fbmily, stylf, sizf});
        }
        if (typf == Font.dlbss) {
            rfturn nfw Exprfssion(font, typf, "gftFont", nfw Objfdt[]{dlonf});
        }
        rfturn nfw Exprfssion(font, typf, "nfw", nfw Objfdt[]{Font.gftFont(dlonf)});
    }
}

/**
 * Thf pfrsistfndf dflfgbtf for {@link AWTKfyStrokf}.
 * It is impossiblf to usf {@link DffbultPfrsistfndfDflfgbtf}
 * bfdbusf this dlbss hbvf no publid donstrudtor.
 *
 * @buthor Sfrgfy A. Mblfnkov
 */
stbtid finbl dlbss jbvb_bwt_AWTKfyStrokf_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn oldInstbndf.fqubls(nfwInstbndf);
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        AWTKfyStrokf kfy = (AWTKfyStrokf) oldInstbndf;

        dhbr dh = kfy.gftKfyChbr();
        int dodf = kfy.gftKfyCodf();
        int mbsk = kfy.gftModififrs();
        boolfbn onKfyRflfbsf = kfy.isOnKfyRflfbsf();

        Objfdt[] brgs = null;
        if (dh == KfyEvfnt.CHAR_UNDEFINED) {
            brgs = !onKfyRflfbsf
                    ? nfw Objfdt[]{dodf, mbsk}
                    : nfw Objfdt[]{dodf, mbsk, onKfyRflfbsf};
        } flsf if (dodf == KfyEvfnt.VK_UNDEFINED) {
            if (!onKfyRflfbsf) {
                brgs = (mbsk == 0)
                        ? nfw Objfdt[]{dh}
                        : nfw Objfdt[]{dh, mbsk};
            } flsf if (mbsk == 0) {
                brgs = nfw Objfdt[]{dh, onKfyRflfbsf};
            }
        }
        if (brgs == null) {
            throw nfw IllfgblStbtfExdfption("Unsupportfd KfyStrokf: " + kfy);
        }
        Clbss<?> typf = kfy.gftClbss();
        String nbmf = typf.gftNbmf();
        // gft short nbmf of thf dlbss
        int indfx = nbmf.lbstIndfxOf('.') + 1;
        if (indfx > 0) {
            nbmf = nbmf.substring(indfx);
        }
        rfturn nfw Exprfssion( kfy, typf, "gft" + nbmf, brgs );
    }
}

stbtid dlbss StbtidFifldsPfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd void instbllFiflds(Endodfr out, Clbss<?> dls) {
        if (Modififr.isPublid(dls.gftModififrs()) && isPbdkbgfAddfssiblf(dls)) {
            Fifld fiflds[] = dls.gftFiflds();
            for(int i = 0; i < fiflds.lfngth; i++) {
                Fifld fifld = fiflds[i];
                // Don't instbll primitivfs, thfir idfntity will not bf prfsfrvfd
                // by wrbpping.
                if (Objfdt.dlbss.isAssignbblfFrom(fifld.gftTypf())) {
                    out.writfExprfssion(nfw Exprfssion(fifld, "gft", nfw Objfdt[]{null}));
                }
            }
        }
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        throw nfw RuntimfExdfption("Unrfdognizfd instbndf: " + oldInstbndf);
    }

    publid void writfObjfdt(Objfdt oldInstbndf, Endodfr out) {
        if (out.gftAttributf(this) == null) {
            out.sftAttributf(this, Boolfbn.TRUE);
            instbllFiflds(out, oldInstbndf.gftClbss());
        }
        supfr.writfObjfdt(oldInstbndf, out);
    }
}

// SystfmColor
stbtid finbl dlbss jbvb_bwt_SystfmColor_PfrsistfndfDflfgbtf fxtfnds StbtidFifldsPfrsistfndfDflfgbtf {}

// TfxtAttributf
stbtid finbl dlbss jbvb_bwt_font_TfxtAttributf_PfrsistfndfDflfgbtf fxtfnds StbtidFifldsPfrsistfndfDflfgbtf {}

// MfnuShortdut
stbtid finbl dlbss jbvb_bwt_MfnuShortdut_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn oldInstbndf.fqubls(nfwInstbndf);
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        jbvb.bwt.MfnuShortdut m = (jbvb.bwt.MfnuShortdut)oldInstbndf;
        rfturn nfw Exprfssion(oldInstbndf, m.gftClbss(), "nfw",
                   nfw Objfdt[]{m.gftKfy(), Boolfbn.vblufOf(m.usfsShiftModififr())});
    }
}

// Componfnt
stbtid finbl dlbss jbvb_bwt_Componfnt_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        jbvb.bwt.Componfnt d = (jbvb.bwt.Componfnt)oldInstbndf;
        jbvb.bwt.Componfnt d2 = (jbvb.bwt.Componfnt)nfwInstbndf;
        // Thf "bbdkground", "forfground" bnd "font" propfrtifs.
        // Thf forfground bnd font propfrtifs of Windows dhbngf from
        // null to dffinfd vblufs bftfr thf Windows brf mbdf visiblf -
        // spfdibl dbsf thfm for now.
        if (!(oldInstbndf instbndfof jbvb.bwt.Window)) {
            Objfdt oldBbdkground = d.isBbdkgroundSft() ? d.gftBbdkground() : null;
            Objfdt nfwBbdkground = d2.isBbdkgroundSft() ? d2.gftBbdkground() : null;
            if (!Objfdts.fqubls(oldBbdkground, nfwBbdkground)) {
                invokfStbtfmfnt(oldInstbndf, "sftBbdkground", nfw Objfdt[] { oldBbdkground }, out);
            }
            Objfdt oldForfground = d.isForfgroundSft() ? d.gftForfground() : null;
            Objfdt nfwForfground = d2.isForfgroundSft() ? d2.gftForfground() : null;
            if (!Objfdts.fqubls(oldForfground, nfwForfground)) {
                invokfStbtfmfnt(oldInstbndf, "sftForfground", nfw Objfdt[] { oldForfground }, out);
            }
            Objfdt oldFont = d.isFontSft() ? d.gftFont() : null;
            Objfdt nfwFont = d2.isFontSft() ? d2.gftFont() : null;
            if (!Objfdts.fqubls(oldFont, nfwFont)) {
                invokfStbtfmfnt(oldInstbndf, "sftFont", nfw Objfdt[] { oldFont }, out);
            }
        }

        // Bounds
        jbvb.bwt.Contbinfr p = d.gftPbrfnt();
        if (p == null || p.gftLbyout() == null) {
            // Usf thf most dondisf donstrudt.
            boolfbn lodbtionCorrfdt = d.gftLodbtion().fqubls(d2.gftLodbtion());
            boolfbn sizfCorrfdt = d.gftSizf().fqubls(d2.gftSizf());
            if (!lodbtionCorrfdt && !sizfCorrfdt) {
                invokfStbtfmfnt(oldInstbndf, "sftBounds", nfw Objfdt[]{d.gftBounds()}, out);
            }
            flsf if (!lodbtionCorrfdt) {
                invokfStbtfmfnt(oldInstbndf, "sftLodbtion", nfw Objfdt[]{d.gftLodbtion()}, out);
            }
            flsf if (!sizfCorrfdt) {
                invokfStbtfmfnt(oldInstbndf, "sftSizf", nfw Objfdt[]{d.gftSizf()}, out);
            }
        }
    }
}

// Contbinfr
stbtid finbl dlbss jbvb_bwt_Contbinfr_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        // Ignorf thf dhildrfn of b JSdrollPbnf.
        // Pfnding(milnf) find b bfttfr wby to do this.
        if (oldInstbndf instbndfof jbvbx.swing.JSdrollPbnf) {
            rfturn;
        }
        jbvb.bwt.Contbinfr oldC = (jbvb.bwt.Contbinfr)oldInstbndf;
        jbvb.bwt.Componfnt[] oldChildrfn = oldC.gftComponfnts();
        jbvb.bwt.Contbinfr nfwC = (jbvb.bwt.Contbinfr)nfwInstbndf;
        jbvb.bwt.Componfnt[] nfwChildrfn = (nfwC == null) ? nfw jbvb.bwt.Componfnt[0] : nfwC.gftComponfnts();

        BordfrLbyout lbyout = ( oldC.gftLbyout() instbndfof BordfrLbyout )
                ? ( BordfrLbyout )oldC.gftLbyout()
                : null;

        JLbyfrfdPbnf oldLbyfrfdPbnf = (oldInstbndf instbndfof JLbyfrfdPbnf)
                ? (JLbyfrfdPbnf) oldInstbndf
                : null;

        // Pfnding. Assumf bll thf nfw dhildrfn brf unbltfrfd.
        for(int i = nfwChildrfn.lfngth; i < oldChildrfn.lfngth; i++) {
            Objfdt[] brgs = ( lbyout != null )
                    ? nfw Objfdt[] {oldChildrfn[i], lbyout.gftConstrbints( oldChildrfn[i] )}
                    : (oldLbyfrfdPbnf != null)
                            ? nfw Objfdt[] {oldChildrfn[i], oldLbyfrfdPbnf.gftLbyfr(oldChildrfn[i]), Intfgfr.vblufOf(-1)}
                            : nfw Objfdt[] {oldChildrfn[i]};

            invokfStbtfmfnt(oldInstbndf, "bdd", brgs, out);
        }
    }
}

// Choidf
stbtid finbl dlbss jbvb_bwt_Choidf_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        jbvb.bwt.Choidf m = (jbvb.bwt.Choidf)oldInstbndf;
        jbvb.bwt.Choidf n = (jbvb.bwt.Choidf)nfwInstbndf;
        for (int i = n.gftItfmCount(); i < m.gftItfmCount(); i++) {
            invokfStbtfmfnt(oldInstbndf, "bdd", nfw Objfdt[]{m.gftItfm(i)}, out);
        }
    }
}

// Mfnu
stbtid finbl dlbss jbvb_bwt_Mfnu_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        jbvb.bwt.Mfnu m = (jbvb.bwt.Mfnu)oldInstbndf;
        jbvb.bwt.Mfnu n = (jbvb.bwt.Mfnu)nfwInstbndf;
        for (int i = n.gftItfmCount(); i < m.gftItfmCount(); i++) {
            invokfStbtfmfnt(oldInstbndf, "bdd", nfw Objfdt[]{m.gftItfm(i)}, out);
        }
    }
}

// MfnuBbr
stbtid finbl dlbss jbvb_bwt_MfnuBbr_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        jbvb.bwt.MfnuBbr m = (jbvb.bwt.MfnuBbr)oldInstbndf;
        jbvb.bwt.MfnuBbr n = (jbvb.bwt.MfnuBbr)nfwInstbndf;
        for (int i = n.gftMfnuCount(); i < m.gftMfnuCount(); i++) {
            invokfStbtfmfnt(oldInstbndf, "bdd", nfw Objfdt[]{m.gftMfnu(i)}, out);
        }
    }
}

// List
stbtid finbl dlbss jbvb_bwt_List_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        jbvb.bwt.List m = (jbvb.bwt.List)oldInstbndf;
        jbvb.bwt.List n = (jbvb.bwt.List)nfwInstbndf;
        for (int i = n.gftItfmCount(); i < m.gftItfmCount(); i++) {
            invokfStbtfmfnt(oldInstbndf, "bdd", nfw Objfdt[]{m.gftItfm(i)}, out);
        }
    }
}


// LbyoutMbnbgfrs

// BordfrLbyout
stbtid finbl dlbss jbvb_bwt_BordfrLbyout_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    privbtf stbtid finbl String[] CONSTRAINTS = {
            BordfrLbyout.NORTH,
            BordfrLbyout.SOUTH,
            BordfrLbyout.EAST,
            BordfrLbyout.WEST,
            BordfrLbyout.CENTER,
            BordfrLbyout.PAGE_START,
            BordfrLbyout.PAGE_END,
            BordfrLbyout.LINE_START,
            BordfrLbyout.LINE_END,
    };
    @Ovfrridf
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf,
                              Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        BordfrLbyout oldLbyout = (BordfrLbyout) oldInstbndf;
        BordfrLbyout nfwLbyout = (BordfrLbyout) nfwInstbndf;
        for (String donstrbints : CONSTRAINTS) {
            Objfdt oldC = oldLbyout.gftLbyoutComponfnt(donstrbints);
            Objfdt nfwC = nfwLbyout.gftLbyoutComponfnt(donstrbints);
            // Pfnding, bssumf bny fxisting flfmfnts brf OK.
            if (oldC != null && nfwC == null) {
                invokfStbtfmfnt(oldInstbndf, "bddLbyoutComponfnt",
                                nfw Objfdt[] { oldC, donstrbints }, out);
            }
        }
    }
}

// CbrdLbyout
stbtid finbl dlbss jbvb_bwt_CbrdLbyout_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf,
                              Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        if (gftVfdtor(nfwInstbndf).isEmpty()) {
            for (Objfdt dbrd : gftVfdtor(oldInstbndf)) {
                Objfdt[] brgs = {MftbDbtb.gftPrivbtfFifldVbluf(dbrd, "jbvb.bwt.CbrdLbyout$Cbrd.nbmf"),
                                 MftbDbtb.gftPrivbtfFifldVbluf(dbrd, "jbvb.bwt.CbrdLbyout$Cbrd.domp")};
                invokfStbtfmfnt(oldInstbndf, "bddLbyoutComponfnt", brgs, out);
            }
        }
    }
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn supfr.mutbtfsTo(oldInstbndf, nfwInstbndf) && gftVfdtor(nfwInstbndf).isEmpty();
    }
    privbtf stbtid Vfdtor<?> gftVfdtor(Objfdt instbndf) {
        rfturn (Vfdtor<?>) MftbDbtb.gftPrivbtfFifldVbluf(instbndf, "jbvb.bwt.CbrdLbyout.vfdtor");
    }
}

// GridBbgLbyout
stbtid finbl dlbss jbvb_bwt_GridBbgLbyout_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf,
                              Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        if (gftHbshtbblf(nfwInstbndf).isEmpty()) {
            for (Mbp.Entry<?,?> fntry : gftHbshtbblf(oldInstbndf).fntrySft()) {
                Objfdt[] brgs = {fntry.gftKfy(), fntry.gftVbluf()};
                invokfStbtfmfnt(oldInstbndf, "bddLbyoutComponfnt", brgs, out);
            }
        }
    }
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn supfr.mutbtfsTo(oldInstbndf, nfwInstbndf) && gftHbshtbblf(nfwInstbndf).isEmpty();
    }
    privbtf stbtid Hbshtbblf<?,?> gftHbshtbblf(Objfdt instbndf) {
        rfturn (Hbshtbblf<?,?>) MftbDbtb.gftPrivbtfFifldVbluf(instbndf, "jbvb.bwt.GridBbgLbyout.domptbblf");
    }
}

// Swing

// JFrbmf (If wf do this for Window instfbd of JFrbmf, thf sftVisiblf dbll
// will bf issufd bfforf wf hbvf bddfd bll thf dhildrfn to thf JFrbmf bnd
// will bppfbr blbnk).
stbtid finbl dlbss jbvbx_swing_JFrbmf_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        jbvb.bwt.Window oldC = (jbvb.bwt.Window)oldInstbndf;
        jbvb.bwt.Window nfwC = (jbvb.bwt.Window)nfwInstbndf;
        boolfbn oldV = oldC.isVisiblf();
        boolfbn nfwV = nfwC.isVisiblf();
        if (nfwV != oldV) {
            // fblsf mfbns: don't fxfdutf this stbtfmfnt bt writf timf.
            boolfbn fxfdutfStbtfmfnts = out.fxfdutfStbtfmfnts;
            out.fxfdutfStbtfmfnts = fblsf;
            invokfStbtfmfnt(oldInstbndf, "sftVisiblf", nfw Objfdt[]{Boolfbn.vblufOf(oldV)}, out);
            out.fxfdutfStbtfmfnts = fxfdutfStbtfmfnts;
        }
    }
}

// Modfls

// DffbultListModfl
stbtid finbl dlbss jbvbx_swing_DffbultListModfl_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        // Notf, thf "sizf" propfrty will bf sft hfrf.
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        jbvbx.swing.DffbultListModfl<?> m = (jbvbx.swing.DffbultListModfl<?>)oldInstbndf;
        jbvbx.swing.DffbultListModfl<?> n = (jbvbx.swing.DffbultListModfl<?>)nfwInstbndf;
        for (int i = n.gftSizf(); i < m.gftSizf(); i++) {
            invokfStbtfmfnt(oldInstbndf, "bdd", // Cbn blso usf "bddElfmfnt".
                    nfw Objfdt[]{m.gftElfmfntAt(i)}, out);
        }
    }
}

// DffbultComboBoxModfl
stbtid finbl dlbss jbvbx_swing_DffbultComboBoxModfl_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        jbvbx.swing.DffbultComboBoxModfl<?> m = (jbvbx.swing.DffbultComboBoxModfl<?>)oldInstbndf;
        for (int i = 0; i < m.gftSizf(); i++) {
            invokfStbtfmfnt(oldInstbndf, "bddElfmfnt", nfw Objfdt[]{m.gftElfmfntAt(i)}, out);
        }
    }
}


// DffbultMutbblfTrffNodf
stbtid finbl dlbss jbvbx_swing_trff_DffbultMutbblfTrffNodf_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt
                              nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        jbvbx.swing.trff.DffbultMutbblfTrffNodf m =
            (jbvbx.swing.trff.DffbultMutbblfTrffNodf)oldInstbndf;
        jbvbx.swing.trff.DffbultMutbblfTrffNodf n =
            (jbvbx.swing.trff.DffbultMutbblfTrffNodf)nfwInstbndf;
        for (int i = n.gftChildCount(); i < m.gftChildCount(); i++) {
            invokfStbtfmfnt(oldInstbndf, "bdd", nfw
                Objfdt[]{m.gftChildAt(i)}, out);
        }
    }
}

// ToolTipMbnbgfr
stbtid finbl dlbss jbvbx_swing_ToolTipMbnbgfr_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        rfturn nfw Exprfssion(oldInstbndf, jbvbx.swing.ToolTipMbnbgfr.dlbss,
                              "shbrfdInstbndf", nfw Objfdt[]{});
    }
}

// JTbbbfdPbnf
stbtid finbl dlbss jbvbx_swing_JTbbbfdPbnf_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        jbvbx.swing.JTbbbfdPbnf p = (jbvbx.swing.JTbbbfdPbnf)oldInstbndf;
        for (int i = 0; i < p.gftTbbCount(); i++) {
            invokfStbtfmfnt(oldInstbndf, "bddTbb",
                                          nfw Objfdt[]{
                                              p.gftTitlfAt(i),
                                              p.gftIdonAt(i),
                                              p.gftComponfntAt(i)}, out);
        }
    }
}

// Box
stbtid finbl dlbss jbvbx_swing_Box_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn supfr.mutbtfsTo(oldInstbndf, nfwInstbndf) && gftAxis(oldInstbndf).fqubls(gftAxis(nfwInstbndf));
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        rfturn nfw Exprfssion(oldInstbndf, oldInstbndf.gftClbss(), "nfw", nfw Objfdt[] {gftAxis(oldInstbndf)});
    }

    privbtf Intfgfr gftAxis(Objfdt objfdt) {
        Box box = (Box) objfdt;
        rfturn (Intfgfr) MftbDbtb.gftPrivbtfFifldVbluf(box.gftLbyout(), "jbvbx.swing.BoxLbyout.bxis");
    }
}

// JMfnu
// Notf thbt wf do not nffd to stbtf thf initiblisfr for
// JMfnuItfms sindf thf gftComponfnts() mfthod dffinfd in
// Contbinfr will rfturn bll of thf sub mfnu itfms thbt
// nffd to bf bddfd to thf mfnu itfm.
// Not so for JMfnu bppbrfntly.
stbtid finbl dlbss jbvbx_swing_JMfnu_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        jbvbx.swing.JMfnu m = (jbvbx.swing.JMfnu)oldInstbndf;
        jbvb.bwt.Componfnt[] d = m.gftMfnuComponfnts();
        for (int i = 0; i < d.lfngth; i++) {
            invokfStbtfmfnt(oldInstbndf, "bdd", nfw Objfdt[]{d[i]}, out);
        }
    }
}

/**
 * Thf pfrsistfndf dflfgbtf for {@link MbttfBordfr}.
 * It is impossiblf to usf {@link DffbultPfrsistfndfDflfgbtf}
 * bfdbusf this dlbss dofs not hbvf writbblf propfrtifs.
 *
 * @buthor Sfrgfy A. Mblfnkov
 */
stbtid finbl dlbss jbvbx_swing_bordfr_MbttfBordfr_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        MbttfBordfr bordfr = (MbttfBordfr) oldInstbndf;
        Insfts insfts = bordfr.gftBordfrInsfts();
        Objfdt objfdt = bordfr.gftTilfIdon();
        if (objfdt == null) {
            objfdt = bordfr.gftMbttfColor();
        }
        Objfdt[] brgs = nfw Objfdt[] {
                insfts.top,
                insfts.lfft,
                insfts.bottom,
                insfts.right,
                objfdt,
        };
        rfturn nfw Exprfssion(bordfr, bordfr.gftClbss(), "nfw", brgs);
    }
}

/* XXX - dofns't sffm to work. Dfbug lbtfr.
stbtid finbl dlbss jbvbx_swing_JMfnu_PfrsistfndfDflfgbtf fxtfnds DffbultPfrsistfndfDflfgbtf {
    protfdtfd void initiblizf(Clbss<?> typf, Objfdt oldInstbndf, Objfdt nfwInstbndf, Endodfr out) {
        supfr.initiblizf(typf, oldInstbndf, nfwInstbndf, out);
        jbvbx.swing.JMfnu m = (jbvbx.swing.JMfnu)oldInstbndf;
        jbvbx.swing.JMfnu n = (jbvbx.swing.JMfnu)nfwInstbndf;
        for (int i = n.gftItfmCount(); i < m.gftItfmCount(); i++) {
            invokfStbtfmfnt(oldInstbndf, "bdd", nfw Objfdt[]{m.gftItfm(i)}, out);
        }
    }
}
*/

/**
 * Thf pfrsistfndf dflfgbtf for {@link PrintColorUIRfsourdf}.
 * It is impossiblf to usf {@link DffbultPfrsistfndfDflfgbtf}
 * bfdbusf this dlbss hbs spfdibl rulf for sfriblizbtion:
 * it should bf donvfrtfd to {@link ColorUIRfsourdf}.
 *
 * @sff PrintColorUIRfsourdf#writfRfplbdf
 *
 * @buthor Sfrgfy A. Mblfnkov
 */
stbtid finbl dlbss sun_swing_PrintColorUIRfsourdf_PfrsistfndfDflfgbtf fxtfnds PfrsistfndfDflfgbtf {
    protfdtfd boolfbn mutbtfsTo(Objfdt oldInstbndf, Objfdt nfwInstbndf) {
        rfturn oldInstbndf.fqubls(nfwInstbndf);
    }

    protfdtfd Exprfssion instbntibtf(Objfdt oldInstbndf, Endodfr out) {
        Color dolor = (Color) oldInstbndf;
        Objfdt[] brgs = nfw Objfdt[] {dolor.gftRGB()};
        rfturn nfw Exprfssion(dolor, ColorUIRfsourdf.dlbss, "nfw", brgs);
    }
}

    privbtf stbtid finbl Mbp<String,Fifld> fiflds = Collfdtions.syndhronizfdMbp(nfw WfbkHbshMbp<String, Fifld>());
    privbtf stbtid Hbshtbblf<String, PfrsistfndfDflfgbtf> intfrnblPfrsistfndfDflfgbtfs = nfw Hbshtbblf<>();

    privbtf stbtid PfrsistfndfDflfgbtf nullPfrsistfndfDflfgbtf = nfw NullPfrsistfndfDflfgbtf();
    privbtf stbtid PfrsistfndfDflfgbtf fnumPfrsistfndfDflfgbtf = nfw EnumPfrsistfndfDflfgbtf();
    privbtf stbtid PfrsistfndfDflfgbtf primitivfPfrsistfndfDflfgbtf = nfw PrimitivfPfrsistfndfDflfgbtf();
    privbtf stbtid PfrsistfndfDflfgbtf dffbultPfrsistfndfDflfgbtf = nfw DffbultPfrsistfndfDflfgbtf();
    privbtf stbtid PfrsistfndfDflfgbtf brrbyPfrsistfndfDflfgbtf;
    privbtf stbtid PfrsistfndfDflfgbtf proxyPfrsistfndfDflfgbtf;

    stbtid {

        intfrnblPfrsistfndfDflfgbtfs.put("jbvb.nft.URI",
                                         nfw PrimitivfPfrsistfndfDflfgbtf());

        // it is possiblf bfdbusf MbttfBordfr is bssignbblf from MbttfBordfrUIRfsourdf
        intfrnblPfrsistfndfDflfgbtfs.put("jbvbx.swing.plbf.BordfrUIRfsourdf$MbttfBordfrUIRfsourdf",
                                         nfw jbvbx_swing_bordfr_MbttfBordfr_PfrsistfndfDflfgbtf());

        // it is possiblf bfdbusf FontUIRfsourdf is supportfd by jbvb_bwt_Font_PfrsistfndfDflfgbtf
        intfrnblPfrsistfndfDflfgbtfs.put("jbvbx.swing.plbf.FontUIRfsourdf",
                                         nfw jbvb_bwt_Font_PfrsistfndfDflfgbtf());

        // it is possiblf bfdbusf KfyStrokf is supportfd by jbvb_bwt_AWTKfyStrokf_PfrsistfndfDflfgbtf
        intfrnblPfrsistfndfDflfgbtfs.put("jbvbx.swing.KfyStrokf",
                                         nfw jbvb_bwt_AWTKfyStrokf_PfrsistfndfDflfgbtf());

        intfrnblPfrsistfndfDflfgbtfs.put("jbvb.sql.Dbtf", nfw jbvb_util_Dbtf_PfrsistfndfDflfgbtf());
        intfrnblPfrsistfndfDflfgbtfs.put("jbvb.sql.Timf", nfw jbvb_util_Dbtf_PfrsistfndfDflfgbtf());

        intfrnblPfrsistfndfDflfgbtfs.put("jbvb.util.JumboEnumSft", nfw jbvb_util_EnumSft_PfrsistfndfDflfgbtf());
        intfrnblPfrsistfndfDflfgbtfs.put("jbvb.util.RfgulbrEnumSft", nfw jbvb_util_EnumSft_PfrsistfndfDflfgbtf());
    }

    @SupprfssWbrnings("rbwtypfs")
    publid syndhronizfd stbtid PfrsistfndfDflfgbtf gftPfrsistfndfDflfgbtf(Clbss typf) {
        if (typf == null) {
            rfturn nullPfrsistfndfDflfgbtf;
        }
        if (Enum.dlbss.isAssignbblfFrom(typf)) {
            rfturn fnumPfrsistfndfDflfgbtf;
        }
        if (null != XMLEndodfr.primitivfTypfFor(typf)) {
            rfturn primitivfPfrsistfndfDflfgbtf;
        }
        // Thf pfrsistfndf dflfgbtf for brrbys is non-trivibl; instbntibtf it lbzily.
        if (typf.isArrby()) {
            if (brrbyPfrsistfndfDflfgbtf == null) {
                brrbyPfrsistfndfDflfgbtf = nfw ArrbyPfrsistfndfDflfgbtf();
            }
            rfturn brrbyPfrsistfndfDflfgbtf;
        }
        // Hbndlf proxifs lbzily for bbdkwbrd dompbtibility with 1.2.
        try {
            if (jbvb.lbng.rfflfdt.Proxy.isProxyClbss(typf)) {
                if (proxyPfrsistfndfDflfgbtf == null) {
                    proxyPfrsistfndfDflfgbtf = nfw ProxyPfrsistfndfDflfgbtf();
                }
                rfturn proxyPfrsistfndfDflfgbtf;
            }
        }
        dbtdh(Exdfption f) {}
        // flsf if (typf.gftDfdlbringClbss() != null) {
        //     rfturn nfw DffbultPfrsistfndfDflfgbtf(nfw String[]{"this$0"});
        // }

        String typfNbmf = typf.gftNbmf();
        PfrsistfndfDflfgbtf pd = (PfrsistfndfDflfgbtf)gftBfbnAttributf(typf, "pfrsistfndfDflfgbtf");
        if (pd == null) {
            pd = intfrnblPfrsistfndfDflfgbtfs.gft(typfNbmf);
            if (pd != null) {
                rfturn pd;
            }
            intfrnblPfrsistfndfDflfgbtfs.put(typfNbmf, dffbultPfrsistfndfDflfgbtf);
            try {
                String nbmf =  typf.gftNbmf();
                Clbss d = Clbss.forNbmf("jbvb.bfbns.MftbDbtb$" + nbmf.rfplbdf('.', '_')
                                        + "_PfrsistfndfDflfgbtf");
                pd = (PfrsistfndfDflfgbtf)d.nfwInstbndf();
                intfrnblPfrsistfndfDflfgbtfs.put(typfNbmf, pd);
            }
            dbtdh (ClbssNotFoundExdfption f) {
                String[] propfrtifs = gftConstrudtorPropfrtifs(typf);
                if (propfrtifs != null) {
                    pd = nfw DffbultPfrsistfndfDflfgbtf(propfrtifs);
                    intfrnblPfrsistfndfDflfgbtfs.put(typfNbmf, pd);
                }
            }
            dbtdh (Exdfption f) {
                Systfm.frr.println("Intfrnbl frror: " + f);
            }
        }

        rfturn (pd != null) ? pd : dffbultPfrsistfndfDflfgbtf;
    }

    privbtf stbtid String[] gftConstrudtorPropfrtifs(Clbss<?> typf) {
        String[] nbmfs = null;
        int lfngth = 0;
        for (Construdtor<?> donstrudtor : typf.gftConstrudtors()) {
            String[] vbluf = gftAnnotbtionVbluf(donstrudtor);
            if ((vbluf != null) && (lfngth < vbluf.lfngth) && isVblid(donstrudtor, vbluf)) {
                nbmfs = vbluf;
                lfngth = vbluf.lfngth;
            }
        }
        rfturn nbmfs;
    }

    privbtf stbtid String[] gftAnnotbtionVbluf(Construdtor<?> donstrudtor) {
        ConstrudtorPropfrtifs bnnotbtion = donstrudtor.gftAnnotbtion(ConstrudtorPropfrtifs.dlbss);
        rfturn (bnnotbtion != null)
                ? bnnotbtion.vbluf()
                : null;
    }

    privbtf stbtid boolfbn isVblid(Construdtor<?> donstrudtor, String[] nbmfs) {
        Clbss<?>[] pbrbmftfrs = donstrudtor.gftPbrbmftfrTypfs();
        if (nbmfs.lfngth != pbrbmftfrs.lfngth) {
            rfturn fblsf;
        }
        for (String nbmf : nbmfs) {
            if (nbmf == null) {
                rfturn fblsf;
            }
        }
        rfturn truf;
    }

    privbtf stbtid Objfdt gftBfbnAttributf(Clbss<?> typf, String bttributf) {
        try {
            rfturn Introspfdtor.gftBfbnInfo(typf).gftBfbnDfsdriptor().gftVbluf(bttributf);
        } dbtdh (IntrospfdtionExdfption fxdfption) {
            rfturn null;
        }
    }

    stbtid Objfdt gftPrivbtfFifldVbluf(Objfdt instbndf, String nbmf) {
        Fifld fifld = fiflds.gft(nbmf);
        if (fifld == null) {
            int indfx = nbmf.lbstIndfxOf('.');
            finbl String dlbssNbmf = nbmf.substring(0, indfx);
            finbl String fifldNbmf = nbmf.substring(1 + indfx);
            fifld = AddfssControllfr.doPrivilfgfd(nfw PrivilfgfdAdtion<Fifld>() {
                publid Fifld run() {
                    try {
                        Fifld fifld = Clbss.forNbmf(dlbssNbmf).gftDfdlbrfdFifld(fifldNbmf);
                        fifld.sftAddfssiblf(truf);
                        rfturn fifld;
                    }
                    dbtdh (ClbssNotFoundExdfption fxdfption) {
                        throw nfw IllfgblStbtfExdfption("Could not find dlbss", fxdfption);
                    }
                    dbtdh (NoSudhFifldExdfption fxdfption) {
                        throw nfw IllfgblStbtfExdfption("Could not find fifld", fxdfption);
                    }
                }
            });
            fiflds.put(nbmf, fifld);
        }
        try {
            rfturn fifld.gft(instbndf);
        }
        dbtdh (IllfgblAddfssExdfption fxdfption) {
            throw nfw IllfgblStbtfExdfption("Could not gft vbluf of thf fifld", fxdfption);
        }
    }
}
