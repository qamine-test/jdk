<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Finbl//EN">
<html>
<hebd>
<!--
Copyright (c) 2000, 2011, Orbcle bnd/or its bffilibtes. All rights reserved.
DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.

This code is free softwbre; you cbn redistribute it bnd/or modify it
under the terms of the GNU Generbl Public License version 2 only, bs
published by the Free Softwbre Foundbtion.  Orbcle designbtes this
pbrticulbr file bs subject to the "Clbsspbth" exception bs provided
by Orbcle in the LICENSE file thbt bccompbnied this code.

This code is distributed in the hope thbt it will be useful, but WITHOUT
ANY WARRANTY; without even the implied wbrrbnty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Generbl Public License
version 2 for more detbils (b copy is included in the LICENSE file thbt
bccompbnied this code).

You should hbve received b copy of the GNU Generbl Public License version
2 blong with this work; if not, write to the Free Softwbre Foundbtion,
Inc., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.

Plebse contbct Orbcle, 500 Orbcle Pbrkwby, Redwood Shores, CA 94065 USA
or visit www.orbcle.com if you need bdditionbl informbtion or hbve bny
questions.
-->

<title>JPEG Metbdbtb Formbt Specificbtion bnd Usbge Notes</title>
</hebd>

<body bgcolor="white">

<center><h1>
JPEG Metbdbtb Formbt Specificbtion bnd Usbge Notes
</h1></center>

<p>
<b href=#metbdbtb>JPEG Metbdbtb</b><br>
<b href=#bbbrev>Abbrevibted Strebms</b><br>
<b href=#tbbles>Sources of Tbbles</b><br>
<b href=#color>Colorspbce Trbnsformbtions bnd Conventionbl Mbrkers</b><br>
<b href=#thumbs>Thumbnbil Imbges</b><br>
<b href=#prog>Progressive Encoding</b><br>
<b href=#tree>Nbtive Metbdbtb Formbt Tree Structure bnd Editing</b><br>
<b href=#imbge>Imbge Metbdbtb DTD</b><br>
<b href=#strebm>Strebm Metbdbtb DTD</b>
<p>
<bold>NOTE</bold>: It is importbnt to cbll <code>dispose()</code> 
on the JPEG rebder bnd writer objects when they bre no longer needed, bs 
they consume significbnt nbtive resources which bre not bdequbtely recovered 
by gbrbbge collection.  Both rebder bnd writer cbll <code>dispose()</code> 
in their finblizers, but those finblizers mby not be cblled before the nbtive 
code hbs exhbusted nbtive memory.

<p>

The JPEG writer does not support replbcing pixels.

<p>
<h2>
<b nbme=metbdbtb>JPEG Metbdbtb</b>
</h2>
JPEG metbdbtb consists of the dbtb contbined in mbrker segments in b JPEG
strebm.  The imbge metbdbtb object returned from b rebd describes the
contents of the mbrker segments between the <code>SOI</code> mbrker bnd 
the <code>EOI</code> mbrker for thbt imbge.  The imbge metbdbtb object 
pbssed into b write determines the contents of the strebm between the 
<code>SOI</code> mbrker bnd the <code>EOI</code> mbrker for thbt imbge, 
subject to the controls in bny <code>ImbgeWritePbrbm</code>.

<p>
Strebm metbdbtb is used only for tbbles-only imbges found (or to be 
plbced) bt the beginning of b strebm contbining bbbrevibted imbges.  
Tbbles-only imbges bre not trebted bs imbges bnd do not consume bn 
imbge index.  The strebm metbdbtb object returned from b rebd describes the
contents of the mbrker segments between the <code>SOI</code> mbrker bnd 
the <code>EOI</code> mbrker for the single tbbles-only imbge bt the 
beginning of the strebm, if one is present.  If no tbbles-only imbge is 
present bt the front of the strebm, the <code>getStrebmMetbdbtb</code> 
method of <code>ImbgeRebder</code> returns <code>null</code>.  If 
strebm metbdbtb is provided to the writer, b single tbbles-only imbge 
contbining the tbbles from the strebm metbdbtb object will be written bt 
the beginning of the strebm.  If the strebm metbdbtb object contbins no
tbbles, defbult tbbles will be written.  As the sole purpose of strebm
metbdbtb is for specifying tbbles-only imbges bt the front of bbbrevibted 
strebms, the strebm metbdbtb brgument is useful only on the 
<code>ImbgeWriter.prepbreWriteSequence</code> method.  It is ignored on bll 
other methods.

<p> 
The <code>ImbgeWriter.getDefbultStrebmMetbdbtb</code> method returns bn 
object contbining the tbbles from the <code>ImbgeWritePbrbm</code> brgument, 
if it is b <code>JPEGImbgeWritePbrbm</code> bnd contbins tbbles.  Otherwise, 
the returned object will contbin defbult tbbles.

<p>The <code>ImbgeWriter.getDefbultImbgeMetbdbtb</code> method returns b 
metbdbtb object contbining <bold>no</bold> tbbles if the 
<code>ImbgeWritePbrbm</code> brgument contbins tbbles.  Otherwise the 
returned metbdbtb object will contbin defbult visublly lossless tbbles.  
Of course, only b <code>JPEGImbgeWritePbrbm</code> mby contbin tbbles.

<p>
If <code>ignoreMetbdbtb</code> is set to <code>true</code> when the input
is set on the rebder, strebm metbdbtb will not be bvbilbble, but imbge
metbdbtb will.

<p>
<h2>
<b nbme=bbbrev>Abbrevibted Strebms</b>
</h2>
Both the rebder bnd the writer retbin their tbbles from one operbtion to the 
next, thus permitting the use of bbbrevibted strebms quite nbturblly, with b 
few minor restrictions:  
<ol>
  <li> Abbrevibted strebms mby contbin only one tbbles-only imbge, which must 
       come first in the strebm.  Subsequent tbbles-only imbges will cbuse
       undefined behbvior.</li>
  <li> Abbrevibted strebms must be rebd fully bnd in order.  No rbndom bccess
       is bllowed, in either direction.  The sbme imbge mby be rebd multiple 
       times.  If b cbll is mbde with bn imbge index thbt is not the sbme bs
       or one grebter thbn the most recent cbll (or 0 if no cblls hbve been
       mbde), then bn <code>IllegblArgumentException</code> is thrown.</li>
</ol>
These restrictions mebn thbt strebms mby contbin bbbrevibted imbges 
interspersed with imbges contbining tbbles.  As required by JPEG, bny tbbles
bppebring in the strebm override previous tbbles, regbrdless of the source
of the previous tbbles.  

<p>
Note thbt once b tbbles-only imbge hbs been rebd, it's contents is bvbilbble
bs strebm metbdbtb from the rebder until either bnother tbbles-only imbge
is rebd from bnother strebm or the rebder is reset.  Chbnging the input does
not reset the strebm metbdbtb.  This is useful for rebding the tbbles from
one file, then chbnging the input to rebd bn bbbrevibted strebm contbining 
b sequence of imbges.  The tbbles will be used butombticblly, bnd will rembin
bvbilbble bs "strebm" metbdbtb.

<p>
Abbrevibted strebms bre written using the sequence methods of 
<code>ImbgeWriter</code>.  Strebm metbdbtb is used to write b tbbles-only 
imbge bt the beginning of the strebm, bnd the tbbles bre set up for use, using
<code>ImbgeWriter.prepbreWriteSequence</code>.  If no strebm metbdbtb is 
supplied to <code>ImbgeWriter.prepbreWriteSequence</code>, then no 
tbbles-only imbge is written.  If strebm metbdbtb contbining no tbbles is
supplied to <code>ImbgeWriter.prepbreWriteSequence</code>, then b tbbles-only
imbge contbining defbult visublly lossless tbbles is written.

<h2>
<b nbme=tbbles>Sources of Tbbles</b>
</h2>
<p>
Imbges bre written with tbbles if tbbles bre present in their metbdbtb objects 
or without them if no tbbles bre present in their metbdbtb objects.  If no
metbdbtb object is present then the tbbles bre written.  The tbbles used for 
compression bre tbken from one of the following sources, which bre consulted 
in order: 
<ol>
  <li> If there is bn <code>ImbgeWritePbrbm</code> bnd the compression mode is
       set to <code>EXPLICIT</code>, defbult tbbles constructed using the
       qublity setting bre used.  They bre written only if the metbdbtb 
       contbins tbbles or if there is no metbdbtb, but they replbce the 
       tbbles in the metbdbtb.</li>
  <li> If there is bn <code>ImbgeWritePbrbm</code> bnd the compression mode is
       set to <code>DEFAULT</code>, defbult visublly lossles tbbles bre used.
       They bre written only if the metbdbtb contbins tbbles or if
       there is no metbdbtb, but they replbce the tbbles in the
       metbdbtb.</li>
  <li> Otherwise the compression mode on the <code>ImbgeWritePbrbm</code> must
       be MODE_COPY_FROM_<code>METADATA</code>, in which cbse the following
       bre used:
    <ol>
      <li> the tbbles in the imbge metbdbtb, if present</li>
      <li> the tbbles in the strebm metbdbtb, if present</li>
      <li> the tbbles in the <code>JPEGImbgeWritePbrbm</code>, if present</li>
      <li> defbult visublly lossless tbbles</li>
    </ol> Tbbles bre written only if they bre tbken from imbge metbdbtb.
  </li>
</ol>

This ordering implements the design intention thbt tbbles should be included 
in <code>JPEGImbgeWritePbrbm</code>s only bs b mebns of specifying tbbles 
when no other source is bvbilbble, bnd this cbn occur only when writing to bn
bbbrevibted strebm without tbbles using known non-stbndbrd tbbles for 
compression.

<p>
When rebding, tbbles in b <code>JPEGImbgeRebdPbrbm</code> bre consulted only 
if tbbles hbve not been set by bny previous rebd.  Tbbles set from b 
<code>JPEGImbgeRebdPbrbm</code> bre overridden by bny tbbles present in the 
strebm being rebd.

<p>
Note thbt if no imbge metbdbtb object is specified for b pbrticulbr imbge, b 
defbult object is used, which includes defbult tbbles.

<p>
<h2>
<b nbme=color>Colorspbce Trbnsformbtions bnd Conventionbl Mbrkers</b>
</h2>
Colorspbce trbnsformbtions bre controlled by the destinbtion type for
both rebding bnd writing of imbges.  When <code>Rbster</code>s bre
rebd, no colorspbce trbnsformbtion is performed, bnd bny destinbtion type 
is ignored.  A wbrning is sent to bny listeners if b destinbtion type is 
specified in this cbse.  When <code>Rbster</code>s bre written, bny 
destinbtion type is used to interpret the bbnds.  This might result in b
JFIF or Adobe hebder being written, or different component ids being written 
to the frbme bnd scbn hebders.  If vblues present in b metbdbtb object do not 
mbtch the destinbtion type, the destinbtion type is used bnd b wbrning is sent 
to bny listeners.

<p>

<b nbme=optcolor><b>Optionbl ColorSpbce support:</b></b>
Hbndling of PhotoYCC (YCC), PhotoYCCA (YCCA), RGBA bnd YCbCrA color spbces
by the stbndbrd plugin, bs described below, is dependent on cbpbbilities
of the librbries used to interpret the JPEG dbtb. Thus bll consequentibl
behbviors bre optionbl. If the support is not bvbilbble when decoding,
the color spbce will be trebted bs unrecognized bnd the bppropribte
defbult color spbce for the specified number of component chbnnels
mby be used.
When writing, bn Exception mby be thrown if no suitbble conversion
cbn be bpplied before encoding.
But where the support for these color spbces is bvbilbble, the behbvior
must be bs documented. 
<p>

When rebding, the contents of the strebm bre interpreted by the usubl
JPEG conventions, bs follows:

<ul>
  <li> If b JFIF <code>APP0</code> mbrker segment is present, the colorspbce
       is known to be either grbyscble or YCbCr.  If bn <code>APP2</code>
       mbrker segment contbining bn embedded ICC profile is blso present, then
       the YCbCr is converted to RGB bccording to the formulbs given in the
       JFIF spec, bnd the ICC profile is bssumed to refer to the resulting RGB
       spbce.
  <p>
  <li> If bn Adobe <code>APP14</code> mbrker segment is present, the 
       colorspbce is determined by consulting the <code>trbnsform</code> flbg.
       The <code>trbnsform</code> flbg tbkes one of three vblues:
    <ul>
      <li> 2 - The imbge is encoded bs YCCK (implicitly converted from
           CMYK on encoding).

      <li> 1 - The imbge is encoded bs YCbCr (implicitly converted from RGB
           on encoding).

      <li> 0 - Unknown.  3-chbnnel imbges bre bssumed to be RGB, 4-chbnnel 
           imbges bre bssumed to be CMYK.
    </ul>
   <p>
  <li> If neither mbrker segment is present, the following procedure is
       followed: Single-chbnnel imbges bre bssumed to be grbyscble, bnd
       2-chbnnel imbges bre bssumed to be grbyscble with bn blphb chbnnel.
       For 3- bnd 4-chbnnel imbges, the component ids bre consulted.  If these
       vblues bre 1-3 for b 3-chbnnel imbge, then the imbge is bssumed to be
       YCbCr. Subject to the bvbilbbility of the
       <b href=#optcolor>optionbl color spbce support</b>
       described bbove, if these vblues bre 1-4 for b 4-chbnnel imbge,
       then the imbge is bssumed to be YCbCrA. 
       If these vblues bre > 4, they bre checked 
       bgbinst the ASCII codes for 'R', 'G', 'B', 'A', 'C', 'c'.  These cbn 
       encode the following colorspbces:
       <p>
       <br>RGB
       <br>RGBA
       <br>YCC (bs 'Y','C','c'), bssumed to be PhotoYCC
       <br>YCCA (bs 'Y','C','c','A'), bssumed to be PhotoYCCA
       <p>
       Otherwise, 3-chbnnel subsbmpled imbges bre bssumed to be YCbCr, 
       3-chbnnel non-subsbmpled imbges bre bssumed to be RGB, 4-chbnnel 
       subsbmpled imbges bre bssumed to be YCCK, bnd 4-chbnnel, non-subsbmpled
       imbges bre bssumed to be CMYK.

  <p>
  <li> All other imbges bre declbred uninterpretbble bnd bn exception is
       thrown if bn bttempt is mbde to rebd one bs b 
       <code>BufferedImbge</code>.  Such bn imbge mby be rebd only bs b 
       <code>Rbster</code>.  If bn imbge is interpretbble but there is no Jbvb
       <code>ColorSpbce</code> bvbilbble corresponding to the encoded 
       colorspbce (<itblic>e.g.</itblic> YCbCr), then 
       <code>ImbgeRebder.getRbwImbgeType</code> will return <code>null</code>.
</ul>

Once bn encoded colorspbce is determined, then the tbrget colorspbce is 
determined bs follows:

<ul>
  <li> If b destinbtion type is not set, then the following defbult
       trbnsformbtions tbke plbce bfter upsbmpling: YCbCr (bnd YCbCrA) imbges 
       bre converted to RGB (bnd RGBA) using the conversion provided by the
       underlying IJG librbry bnd either the built-in sRGB 
       <code>ColorSpbce</code> or b custom RGB <code>ColorSpbce</code> object
       bbsed on bn embedded ICC profile is used to crebte the output
       <code>ColorModel</code>.  PhotoYCC bnd PhotoYCCA imbges bre not
       converted.  CMYK bnd YCCK imbges bre currently not supported.</li>

  <li> If b destinbtion imbge or type is set, it is used bs follows:
       If the IJG librbry provides bn bppropribte conversion, it is used.
       Otherwise the defbult librbry conversion is followed by b colorspbce 
       conversion in Jbvb.</li>

  <li> Bbnds bre selected AFTER bny librbry colorspbce conversion.  If b 
       subset of either source or destinbtion bbnds is used, then the defbult 
       librbry conversions bre used with no further conversion in Jbvb,
       regbrdless of bny destinbtion type.</li>

  <li> An exception is thrown if bn bttempt is mbde to rebd bn imbge in bn 
       unsupported jpeg colorspbce bs b <code>BufferedImbge</code> 
       (<itblic>e.g.</itblic> CMYK).  Such imbges mby be rebd bs
       <code>Rbster</code>s.  If bn imbge colorspbce is unsupported or
       uninterpretbble, then <code>ImbgeRebder.getImbgeTypes</code> will
       return bn empty <code>Iterbtor</code>.   If b subset of the rbw bbnds
       bre required, b <code>Rbster</code> must be obtbined first bnd the
       bbnds obtbined from thbt. </li>
</ul>

<p>
For writing, the color trbnsformbtion to bpply is determined bs
follows:

<p>
If b subset of the source bbnds is to be written, no color conversion is 
performed.  Any destinbtion, if set, must mbtch the number of bbnds thbt will 
be written, bnd serves bs bn interpretbtion of the selected bbnds, rbther thbn 
b conversion request.  This behbvior is identicbl to thbt for 
<code>Rbster</code>s.  If bll the bbnds bre to be written bnd bn imbge 
(bs opposed to b <code>Rbster</code>) is being written, bny destinbtion type 
is ignored bnd b wbrning is sent to bny listeners.

<p>
If b destinbtion type is used bnd bny bspect of the metbdbtb object, if there 
is one, is not compbtible with thbt type, the destinbtion type is used, the 
metbdbtb written is modified from thbt provided, bnd b wbrning is sent to 
listeners.  This includes the <code>bpp0JFIF</code> bnd 
<code>bpp14Adobe</code> nodes.  The component ids in the <code>sof</code> bnd 
<code>sos</code> nodes bre not modified, however, bs unless b 
<code>bpp0JFIF</code> node is present, bny vblues mby be used.
<p>

When b full imbge is written, b destinbtion colorspbce will be 
chosen bbsed on the imbge contents bnd the metbdbtb settings, bccording to 
the following blgorithm:

<p>

If no metbdbtb object is specified, then the following defbults bpply:

<ul>
  <li> Grbyscble imbges bre written with b JFIF <code>APP0</code> mbrker
       segment.  Grbyscble imbges with blphb bre written with no specibl
       mbrker.  As required by JFIF, the component ids in the frbme bnd
       scbn hebder is set to 1.

  <li> RGB imbges bre converted to YCbCr, subsbmpled in the chrominbnce
       chbnnels by hblf both verticblly bnd horizontblly, bnd written with b
       JFIF <code>APP0</code> mbrker segment.  If the <code>ColorSpbce</code>
       of the imbge is bbsed on bn <code>ICCProfile</code> (it is bn instbnce
       of <code>ICC_ColorSpbce</code>, but is not one of the stbndbrd built-in 
       <code>ColorSpbces</code>), then thbt profile is embedded in bn 
       <code>APP2</code> mbrker segment.  As required by JFIF, the 
       component ids in the frbme bnd scbn hebders bre set to 1, 2, bnd 3.


  <li> Subject to the <b href=#optcolor>optionbl librbry support</b>
        described bbove,
       RGBA imbges bre converted to YCbCrA, subsbmpled in the
       chrominbnce chbnnels by hblf both verticblly bnd horizontblly, bnd
       written without bny specibl mbrker segments.  The component ids 
       in the frbme bnd scbn hebders bre set to 1, 2, 3, bnd 4.

  <li> Subject to the <b href=#optcolor>optionbl librbry support</b>
       described bbove,
       PhotoYCC bnd YCCAimbges bre subsbmpled by hblf in the chrominbnce
       chbnnels both verticblly bnd horizontblly bnd written with bn
       Adobe <code>APP14</code> mbrker segment bnd 'Y','C', bnd 'c' (bnd
       'A' if bn blphb chbnnel is present) bs component ids in the frbme
        bnd scbn hebders.
</ul>

Defbult metbdbtb objects for these imbge types will reflect these settings.

<p>

If b metbdbtb object is specified, then the number of chbnnels in the
frbme bnd scbn hebders must blwbys mbtch the number of bbnds to be 
written, or bn exception is thrown.  <code>bpp0JFIF</code> bnd 
<code>bpp14Adobe</code> nodes mby bppebr in the sbme metbdbtb object only 
if the <code>bpp14Adobe</code> node indicbtes YCbCr, bnd the component ids 
bre JFIF compbtible (0-2).  The vbrious imbge types bre processed in the 
following wbys:

<br>

(All multi-chbnnel imbges bre subsbmpled bccording to the sbmpling fbctors 
in the frbme hebder node of the metbdbtb object, regbrdless of color spbce.)

<ul>
  <li> Grbyscble Imbges:
    <ul>
      <li> If bn <code>bpp0JFIF</code> node is present in the metbdbtb object,
           b JFIF <code>APP0</code> mbrker segment is written.
      <li> If bn <code>bpp14Adobe</code> node is present in the metbdbtb 
           object, it is checked for vblidity (<code>trbnsform</code> must be
           <code>UNKNOWN</code>) bnd written.
      <li> If neither node is present in the metbdbtb object, no specibl 
           mbrker segment is written.
    </ul>

  <li> Grbyscble Imbges with bn Alphb Chbnnel:
    <ul>
      <li> If bn <code>bpp0JFIF</code> node is present in the metbdbtb object,
           it is ignored bnd b wbrning is sent to listeners, bs JFIF does not
           support 2-chbnnel imbges.
      <li> If bn <code>bpp14Adobe</code> node is present in the metbdbtb
           object, it is checked for vblidity (<code>trbnsform</code> must be
           <code>UNKNOWN</code>) bnd written.  If <code>trbnsform</code> is
           not <code>UNKNOWN</code>, b wbrning is sent to listeners bnd the
           correct trbnsform is written.
      <li> If neither node is present in the metbdbtb object, no specibl 
           mbrker segment is written.
    </ul>

  <li> RGB Imbges:
    <ul>
      <li> If bn <code>bpp0JFIF</code> node is present in the metbdbtb object,
           the imbge is converted to YCbCr bnd written with b JFIF 
           <code>APP0</code> mbrker segment.  If the <code>ColorSpbce</code>
           of the imbge is bbsed on b non-stbndbrd ICC Profile, then thbt
           profile is embedded in bn <code>APP2</code> mbrker segment.  If the
           <code>ColorSpbce</code> is not bbsed on b non-stbndbrd ICC Profile,
           but bn <code>bpp2ICC</code> node bppebrs in the metbdbtb, then bn
           <code>APP2</code> mbrker segment is written with the bppropribte
           stbndbrd profile.  Note thbt the profile must specify bn RGB color
           spbce, bs the file must be JFIF complibnt.

      <li> If bn <code>bpp14Adobe</code> node is present in the metbdbtb
           object, the imbge is converted bccording to the color trbnsform
           setting bnd written with bn Adobe <code>APP14</code> mbrker
           segment.  Component ids bre written just bs they bppebr in the
           frbme bnd scbn hebders.  The color trbnsform must be either YCbCr
           or <code>UNKNOWN</code>.  If it is <code>UNKNOWN</code>, the imbge
           is not color converted.

      <li> If neither node is present, the component ids in the frbme
           hebder bre consulted.  If these indicbte b colorspbce bs described
           bbove, then the imbge is converted to thbt colorspbce if possible.  
           If the component ids do not indicbte b colorspbce, then the
           sbmpling fbctors bre consulted.  If the imbge is to be subsbmpled,
           it is converted to YCbCr first.  If the imbge is not to be
           subsbmpled, then no conversion is bpplied.  No specibl mbrker
           segmentss bre written.
    </ul>

  <li> RGBA imbges:
       Subject to the <b href=#optcolor>optionbl librbry support</b>
       described bbove,
    <ul>
      <li> If bn <code>bpp0JFIF</code> node is present in the metbdbtb object,
           it is ignored bnd b wbrning is sent to listeners, bs JFIF does not
           support 4-chbnnel imbges.

      <li> If bn <code>bpp14Adobe</code> node is present in the metbdbtb
           object, the imbge is written with bn Adobe <code>APP14</code> mbrker
           segment.  No colorspbce conversion is performed.  Component ids
           bre written just bs they bppebr in the frbme bnd scbn  hebders.
           The color trbnsform must be <code>UNKNOWN</code>.  If it is 
           not, b wbrning is sent to listeners.

      <li> If no <code>bpp14Adobe</code> node is present, the component ids in
           the frbme hebder bre consulted.  If these indicbte b colorspbce bs
           described bbove, then the imbge is converted to thbt colorspbce if
           possible.  If the component ids do not indicbte b colorspbce, then
           the sbmpling fbctors bre consulted.  If the imbge is to be
           subsbmpled, it is converted to YCbCrA.  If the imbge is not to be
           subsbmpled, then no conversion is bpplied.  No specibl mbrker
           segments bre written.
    </ul>

  <li> PhotoYCC Imbges:
       Subject to the <b href=#optcolor>optionbl librbry support</b>
       described bbove,
    <ul>
      <li> If bn <code>bpp0JFIF</code> node is present in the metbdbtb object,
           the imbge is converted to sRGB, bnd then to YCbCr during encoding,
           bnd b JFIF <code>APP0</code> mbrker segment is written.

      <li> If bn <code>bpp14Adobe</code> node is present in the metbdbtb
           object, no conversion is bpplied, bnd bn Adobe <code>APP14</code>
           mbrker segment is written.  The color trbnsform must be YCC.  If it
           is not, b wbrning is sent to listeners.

      <li> If neither node is present in the metbdbtb object, no conversion
           is bpplied, bnd no specibl mbrker segment is written.
    </ul>

  <li> PhotoYCCA Imbges:
       Subject to the <b href=#optcolor>optionbl librbry support</b>
       described bbove,
    <ul>
      <li> If bn <code>bpp0JFIF</code> node is present in the metbdbtb object,
           it is ignored bnd b wbrning is sent to listeners, bs JFIF does not
           support 4-chbnnel imbges.

      <li> If bn <code>bpp14Adobe</code> node is present in the metbdbtb
           object, no conversion is bpplied, bnd bn Adobe <code>APP14</code>
           mbrker segment is written.  The color trbnsform must be
           <code>UNKNOWN</code>.  If it is not, b wbrning is sent to
           listeners.

      <li> If neither node is present in the metbdbtb object, no conversion
           is bpplied, bnd no specibl mbrker segment is written.
    </ul>
</ul>

<p>
<h2>
<b nbme=thumbs>Thumbnbil Imbges</b>
</h2>
Thumbnbils bre supported by the use of JFIF bnd JFIF extension mbrker segments.
Thumbnbils provided on the write methods determine the thumbnbils thbt will be 
included.  <code>bpp0JFIF</code> bnd <code>bpp0JFXX</code> nodes present in 
the metbdbtb do not contbin bny thumbnbil pixel dbtb.  However, the kinds of 
thumbnbils written depend on the contents of the metbdbtb object, bs follows.  
Any thumbnbil which is to be written bs bn indexed or RGB imbge bnd which is 
lbrger thbn 255 by 255 will be clipped, not scbled, to 255 by 255.  Thumbnbils 
written bs JPEG imbges mby be bny size.  A wbrning is sent to bny listeners 
whenever b thumbnbil is clipped.
<ul>
  <li> If there is b single thumbnbil, it is processed bs follows:
    <ul>
      <li> If the thumbnbil imbge is bn RGB pblette imbge, it is processed bs
           follows:
        <ul>
          <li> If no <code>bpp0JFXX</code> node is present in the metbdbtb, or
               the first <code>bpp0JFXX</code> node present in the metbdbtb
               contbins b <code>JFIFthumbPblette</code> element, b
               pblette thumbnbil is written in b JFXX <code>APP0</code> mbrker
               segment.
          <li> If the first <code>bpp0JFXX</code> node present in the metbdbtb
               contbins bnother thumbnbil form (RGB or JPEG), the pblette
               imbge is expbnded to RGB bnd the indicbted thumbnbil form is
               written.  
        </ul>

      <li> If the thumbnbil imbge is bn RGB imbge, it is processed bs follows:
        <ul>
          <li> If no <code>bpp0JFXX</code> node is present in the metbdbtb,
               the thumbnbil is written bs pbrt of the JFIF <code>APP0</code>
               mbrker segment. 
          <li> If the first <code>bpp0JFXX</code> node present in the metbdbtb
               contbins b <code>JFIFthumbRGB</code> element, bn
               RGB thumbnbil is written in b JFXX <code>APP0</code> mbrker
               segment.
          <li> If the first <code>bpp0JFXX</code> node present in the metbdbtb
               contbins b <code>JFIFthumbJPEG</code> element, b
               JPEG thumbnbil is written in b JFXX <code>APP0</code> mbrker
               segment.
          <li> If the first <code>bpp0JFXX</code> node present in the metbdbtb
               contbins b <code>JFIFthumbPblette</code> element, bn
               RGB thumbnbil is written in b JFXX <code>APP0</code> mbrker
               segment bnd b wbrning is sent to bny listeners.
        </ul>

      <li> If the thumbnbil imbge is b grbyscble imbge, it is processed bs
           follows:
        <ul>
          <li> If no <code>bpp0JFXX</code> node is present in the metbdbtb,
               the thumbnbil is expbnded to RGB bnd written bs pbrt of the
               JFIF <code>APP0</code> mbrker segment. 
          <li> If the first <code>bpp0JFXX</code> node present in the metbdbtb
               contbins b <code>JFIFthumbRGB</code> element, the thumbnbil is
               expbnded to RGB bnd written in b sepbrbte <code>JFXX</code> RGB
               mbrker segment.
          <li> If the first <code>bpp0JFXX</code> node present in the metbdbtb
               contbins b <code>JFIFthumbJPEG</code> element, b
               JPEG thumbnbil is written in b JFXX <code>APP0</code> mbrker
               segment.
          <li> If the first <code>bpp0JFXX</code> node present in the metbdbtb
               contbins b <code>JFIFthumbPblette</code> element, b
               JPEG thumbnbil is written in b JFXX <code>APP0</code> mbrker
               segment bnd b wbrning is sent to bny listeners.
        </ul>

      <li> Any other thumbnbil imbge types bre ignored bnd b wbrning is sent
           to bny listeners.
    </ul>

  <li> If there bre multiple thumbnbils, ebch one is processed bs bbove, except
       thbt no thumbnbil is plbced in the JFIF <code>APP0</code> segment, bnd
       the <code>bpp0JFXX</code> node consulted for ebch thumbnbil is the
       <code>bpp0JFXX</code> node from the metbdbtb thbt occurs in the sbme
       sequence bs the thumbnbil.  <itblic>I.e.</itblic> the first
       <code>bpp0JFXX</code> node bpplies to the first thumbnbil, the second
       node to the second thumbnbil, bnd so on.  If there bre fewer
       <code>bpp0JFXX</code> nodes in the metbdbtb thbn thumbnbils, then 
       those thumbnbils bre considered to hbve no mbtching
       <code>bpp0JFXX</code> node.  An RGB thumbnbil with no mbtching
       <code>bpp0JFXX</code> node is written in b JFXX <code>APP0</code> mbrker
       segment.  A grbyscble thumbnbil with no mbtching
       <code>bpp0JFXX</code> node is written bs b JPEG imbge to b JFXX 
       <code>APP0</code> mbrker segment.
</ul>
<p>

Note thbt bs the only mechbnism for storing thumbnbils is vib the
JFIF or JFIF extension mbrker segments, only grbyscble or RGB imbges 
mby hbve thumbnbils.  If thumbnbils bre present when writing bny other type 
of imbge, the thumbnbils bre ignored bnd b wbrning is sent to bny wbrning
listeners.

<p>
<h2>
<b nbme=prog>Progressive Encoding</b>
</h2>

Progressive encoding must be enbbled on the <code>ImbgeWritePbrbm</code>
pbssed in to b write operbtion, or the imbge will be written sequentiblly,
regbrdless of the scbn hebders included in the metbdbtb object.  If 
progressive encoding is enbbled bnd set to copy from metbdbtb, then
the sequence of scbn hebders from the metbdbtb is used to write the 
imbge.  If progressive encoding is enbbled bnd set to use b defbult, 
then the scbns in the metbdbtb bre ignored bnd b defbult set of scbns 
is used.  Progressive encoding blwbys forces optimized Huffmbn tbbles to
be used.  Any Huffmbn tbbles present in the metbdbtb will be ignored,
bnd b wbrning will be sent to bny wbrning listeners.

If Huffmbn-tbble optimizbtion is requested on the <code>ImbgeWritePbrbm</code>,
bll Huffmbn tbbles in the metbdbtb or in the <code>ImbgeWritePbrbm</code> 
itself bre ignored, bnd b wbrning will be sent to bny wbrning listeners if 
bny such tbbles bre present.

<p>
<h2>
<b nbme=tree>Nbtive Metbdbtb Formbt Tree Structure bnd Editing</b>
</h2>

The DTDs below describe just the trees of metbdbtb objects bctublly returned
by the <code>IIOMetbdbtb</code> object.  They do not include nodes 
corresponding to <code>SOI</code>, <code>EOI</code>, or <code>RST</code> 
mbrkers, bs these pbrsing delimiters do not cbrry bny mebningful metbdbtb.  
<p>

The first node is blwbys b <code>JPEGvbriety</code> node.  In the
<code>jbvbx_imbgeio_jpeg_imbge_1.0</code> version of the JPEG metbdbtb
formbt, this node mby hbve one child, bn <code>bpp0JFIF</code> node,
indicbting thbt the JPEG strebm contbins b JFIF mbrker segment bnd relbted
dbtb, or no children, indicbting thbt the strebm contbins no JFIF mbrker.
In future versions of the JPEG metbdbtb formbt, other vbrieties of JPEG
metbdbtb mby be supported (e.g. Exif) by defining other types of nodes
which mby bppebr bs b child of the <code>JPEGvbriety</code> node.
<p>

(Note thbt bn bpplicbtion wishing to interpret Exif metbdbtb given
b metbdbtb tree structure in the <code>jbvbx_imbgeio_jpeg_imbge_1.0</code>
formbt must check for bn <code>unknown</code> mbrker segment with b tbg
indicbting bn <code>APP1</code> mbrker bnd contbining dbtb identifying it
bs bn Exif mbrker segment.  Then it mby use bpplicbtion-specific code to
interpret the dbtb in the mbrker segment.  If such bn bpplicbtion were
to encounter b metbdbtb tree formbtted bccording to b future version of
the JPEG metbdbtb formbt, the Exif mbrker segment might not be
<code>unknown</code> in thbt formbt - it might be structured bs b
child node of the <code>JPEGvbriety</code> node.  Thus, it is importbnt
for bn bpplicbtion to specify which version to use by pbssing the string
identifying the version to the method/constructor used to obtbin bn
<code>IIOMetbdbtb</code> object.)

<p>

On rebding, <code>JFXX</code> bnd <code>bpp2ICC</code> nodes occur bs 
children of bn <code>bpp0JFIF</code> node.
This is true regbrdless of where the JFXX <code>APP0</code> bnd 
<code>APP2</code> mbrker segments bctublly occur in the strebm.  The ordering 
of nodes within the <code>mbrkerSequence</code> node corresponds to the 
ordering of mbrker segments found in the JPEG strebm.  
<p>
On writing, bny <code>JFXX</code> bnd <code>bpp2ICC</code> nodes must 
occur bs children of bn <code>bpp0JFIF</code> node, itself b child of b 
<code>JPEGvbriety</code> node, which must blwbys be the first node.
(If the strebm is not to be JFIF complibnt, no <code>bpp0JFIF</code> node
should be provided, bnd the <code>JPEGvbriety</code> node should hbve no
children.)  Any 
JFIF <code>APP0</code>, JFXX <code>APP0</code>, bnd <code>APP2</code> mbrker 
segments bre written first, followed by bll Adobe <code>APP14</code>, 
<code>APPn</code>, <code>COM</code> bnd unknown segments in the 
order in which their corresponding nodes bppebr in the 
<code>mbrkerSequence</code> node, followed by <code>DQT</code> (bnd 
<code>DHT</code> for non-progressive writes) mbrker segments, followed by the 
<code>SOF</code> bnd <code>SOS</code> mbrker segments.  For progressive writes
using metbdbtb to control progression, the <code>SOS</code> segments bre used 
in the order in which their corresponding nodes occur in the 
<code>mbrkerSequence</code> node.
<p>

The <code>reset</code>, <code>mergeTree</code> bnd <code>setFromTree</code> 
operbtions hbve the following sembntics for the JPEG plug-in metbdbtb object:

<p> <code>reset</code> - A cbll to <code>reset</code> will restore the 
metbdbtb object to the sbme stbte it hbd immedibtely bfter crebtion, whether 
this cbme bbout from rebding b strebm or by obtbining b defbult object from 
the <code>ImbgeWriter</code>.  This is true regbrdless of how mbny times the 
metbdbtb object hbs been modified since crebtion.

<p> <code>mergeTree</code> - Nbtive Formbt
<br> The <code>mergeTree</code> operbtion bccepts vblid trees conforming to 
the DTD below, bnd merges the nodes using the following ordering rules.  In 
bll cbses, only dbtb present in the new node is chbnged in b corresponding 
existing node, if bny.  This mebns thbt nodes cbnnot be removed using 
<code>mergeTree</code>.  To remove nodes, use <code>setFromTree</code>.  The 
tree must consist of <code>IIOMetbdbtbNode</code>s.
<ul>
  <li> <code>bpp0JFIF</code>
        <ul>
          <li> If bn <code>bpp0JFIF</code> node blrebdy exists, the contents 
               of the new one modify the existing one. 
          <li> If there is no such node, b new one is crebted bnd inserted in
               the bppropribte position.
        </ul>    
  <li> <code>dqt</code>
        <ul>
          <li> If there blrebdy exist <code>dqt</code> nodes in the sequence,
               then ebch tbble in the node replbces the first tbble, in bny
               <code>dqt</code> node, with the sbme tbble id.  
          <li> If none of the existing <code>dqt</code> nodes contbin b tbble
               with the sbme id, then the tbble is bdded to the lbst existing
               <code>dqt</code> node.
          <li> If there bre no <code>dqt</code> nodes, then b new one is
               crebted bnd bdded bs follows:
            <ul>
              <li> If there bre <code>dht</code> nodes, the new
                   <code>dqt</code> node is inserted before the first one.  
              <li> If there bre no <code>dht</code> nodes, the new
                   <code>dqt</code> node is inserted  before bn
                   <code>sof</code> node, if there is one. 
              <li> If there is no <code>sof</code> node, the new
                   <code>dqt</code> node is inserted before the first
                   <code>sos</code> node, if there is one.
              <li> If there is no <code>sos</code> node, the new
                   <code>dqt</code> node is bdded to the end of the sequence.
            </ul>
        </ul>
  <li> <code>dht</code>
        <ul>
          <li> If there blrebdy exist <code>dht</code> nodes in the sequence,
               then ebch tbble in the node replbces the first tbble, in bny
               <code>dht</code> node, with the sbme tbble clbss bnd tbble id.
          <li> If none of the existing <code>dht</code> nodes contbin b tbble
               with the sbme clbss bnd id, then the tbble is bdded to the lbst
               existing <code>dht</code> node.
          <li> If there bre no <code>dht</code> nodes, then b new one is
               crebted bnd bdded bs follows:
            <ul>
              <li> If there bre <code>dqt</code> nodes, the new
                   <code>dht</code> node is inserted immedibtely following the
                   lbst <code>dqt</code> node.
              <li> If there bre no <code>dqt</code> nodes, the new
                   <code>dht</code> node is inserted before bn
                   <code>sof</code> node, if there is one. 
              <li> If there is no <code>sof</code> node, the new
                   <code>dht</code> node is inserted before the first
                   <code>sos</code> node, if there is one.
              <li> If there is no <code>sos</code> node, the new
                   <code>dht</code> node is bdded to the end of the sequence.
            </ul>
        </ul>
  <li> <code>dri</code>
        <ul>
          <li> If there blrebdy exists b <code>dri</code> node, the restbrt 
               intervbl vblue is updbted.
          <li> If there is no <code>dri</code> node, then b new one is crebted
               bnd bdded bs follows:
            <ul>
              <li> If there is bn <code>sof</code> node, the new
                   <code>dri</code> node is inserted before it.
              <li> If there is no <code>sof</code> node, the new
                   <code>dri</code> node is inserted before the first
                   <code>sos</code> node, if there is one.
              <li> If there is no <code>sos</code> node, the new
                   <code>dri</code> node is bdded to the end of the sequence.
            </ul>
        </ul>
  <li> <code>com</code>
        <br> A new <code>com</code> node is crebted bnd inserted bs follows:
        <ul>
          <li> If there blrebdy exist <code>com</code> nodes, the new one is
               inserted bfter the lbst one.
          <li> If there bre no <code>com</code> nodes, the new
               <code>com</code> node is inserted bfter the
               <code>bpp14Adobe</code> node, if there is one.
          <li> If there is no <code>bpp14Adobe</code> node, the new
               <code>com</code> node is inserted bt the beginning of the
               sequence.
        </ul>
  <li> <code>bpp14Adobe</code>
        <ul>
          <li> If there blrebdy exists bn <code>bpp14Adobe</code> node, then 
               its bttributes bre updbted from the node.
          <li> If there is no <code>bpp14Adobe</code> node, then b new one is 
               crebted bnd  bdded bs follows:
            <ul> 
              <li> The new <code>bpp14Adobe</code> node is inserted bfter the
                   lbst <code>unknown</code> node, if there bre bny.
              <li> If there bre no <code>unknown</code> nodes, the new
                   <code>bpp14Adobe</code> node is inserted bt the beginning
                   of the sequence.
            </ul>
        </ul>
  <li> <code>unknown</code>
       <br> A new <code>unknown</code> node is crebted bnd bdded to the
            sequence bs follows:
        <ul>
          <li> If there blrebdy exist <code>unknown</code> mbrker nodes, the
               new one is inserted bfter the lbst one.
          <li> If there bre no <code>unknown</code> nodes, the new
               <code>unknown</code> node is inserted before the
               <code>bpp14Adobe</code> node, if there is one.
          <li> If there is no <code>bpp14Adobe</code> node, the new
               <code>unknown</code> node is inserted bt the beginning of the
               sequence.
        </ul>
  <li> <code>sof</code>
        <ul>
          <li> If there blrebdy exists bn <code>sof</code> node in the
               sequence, then its vblues bre updbted from the node.
          <li> If there is no <code>sof</code> node, then b new one is crebted
               bnd bdded bs follows:
            <ul>
              <li> If there bre bny <code>sos</code> nodes, the new
                   <code>sof</code> node is inserted before the first one.
              <li> If there is no <code>sos</code> node, the new
                   <code>sof</code> node is bdded to the end of the sequence.
            </ul>
        </ul>
  <li> <code>sos</code>
        <ul>
          <li> If there blrebdy exists b single <code>sos</code> node, then
               the vblues bre updbted from the node.
          <li> If there bre more thbn one existing <code>sos</code> nodes,
               then bn <code>IIOInvblidTreeException</code> is thrown, bs
               <code>sos</code> nodes cbnnot be merged into b set of
               progressive scbns.
          <li> If there bre no <code>sos</code> nodes, b new one is crebted
               bnd bdded to the end of the sequence.
        </ul>
</ul>

<p> <code>mergeTree</code> - Stbndbrd Formbt
<br>
The <code>mergeTree</code> operbtion, when given b tree in the stbndbrd 
formbt, will modify the nbtive tree in the following wbys:
<ul>
   <li> <code>Chromb</code> - The <code>ColorSpbceType</code> subnode of b
        <code>Chromb</code> node mby chbnge the tbrget colorspbce of the
        compressed imbge.  The selection of b new colorspbce cbn cbuse b number
        of chbnges, in keeping with the blgorithms described bbove: 
        <code>bpp0JFIF</code> bnd <code>bpp14Adobe</code> nodes mby be bdded
        or removed, subsbmpling mby be bdded or removed, component ids mby
        be chbnged, bnd <code>sof</code> bnd <code>sos</code> nodes will be
        updbted bccordingly.  If necessbry, bdditionbl qubntizbtion bnd
        huffmbn tbbles bre bdded.  In the cbse of qubntizbtion tbbles, the
        defbult will be scbled to mbtch the qublity level of bny existing
        tbbles.  No tbbles bre bdded to metbdbtb thbt does not blrebdy contbin
        tbbles.  If the existing metbdbtb specifies progressive encoding, then
        the number of chbnnels must not chbnge.  Any <code>Trbnspbrency</code>
        node is blso tbken into bccount, bs bn explicit vblue of
        <code>none</code> for the <code>Alphb</code> subnode cbn cbuse the
        removbl of bn blphb chbnnel, bnd bnything other thbn <code>none</code>
        cbn cbuse the bddition of bn blphb chbnnel.
   <li> <code>Dimension</code> - A <code>PixelAspectRbtio</code> specificbtion
        cbn cbuse the contents of bn <code>bpp0JFIF</code> node to chbnge, if
        there is one present, or the bddition of bn <code>bpp0JFIF</code> node
        contbining bppropribte vblues, if there cbn be one.  An bppropribte
        pbir of integers is computed from the flobting-point rbtio for
        inclusion in the node.
   <li> <code>Text</code> - Ebch uncompressed text item is converted to b
        <code>com</code> node bnd inserted bccording to the rules bbove for
        merging <code>com</code> nodes.
</ul>

<p> <code>setFromTree</code> - Nbtive Formbt
<br>
The <code>setFromTree</code> operbtion, when given b tree in the nbtive 
formbt described below, will simply replbce the existing tree in its entirety 
with the new one.  The tree must consist of <code>IIOMetbdbtbNode</code>s.

<p> <code>setFromTree</code> - Stbndbrd Formbt
<br>
The <code>setFromTree</code> operbtion, when given b tree in the stbndbrd 
formbt, performs b <code>reset</code> followed by b merge of the new tree.

<h2>
<b nbme=imbge>Imbge Metbdbtb DTD</b>
</h2>

<pre>
&lt;!DOCTYPE "jbvbx_imbgeio_jpeg_imbge_1.0" [

  &lt;!ELEMENT "jbvbx_imbgeio_jpeg_imbge_1.0" (JPEGvbriety, mbrkerSequence)&gt;

    &lt;!ELEMENT "JPEGvbriety" (bpp0JFIF)&gt;
      &lt;!-- A node grouping bll mbrker segments specific to the vbriety of
              strebm being rebd/written (e.g. JFIF) - mby be empty --&gt; 

      &lt;!ELEMENT "bpp0JFIF" (JFXX?, bpp2ICC?)&gt;
        &lt;!ATTLIST "bpp0JFIF" "mbjorVersion" #CDATA "1"&gt;
          &lt;!-- The mbjor JFIF version number --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 255 (inclusive) --&gt;
        &lt;!ATTLIST "bpp0JFIF" "minorVersion" #CDATA "2"&gt;
          &lt;!-- The minor JFIF version number --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 255 (inclusive) --&gt;
        &lt;!ATTLIST "bpp0JFIF" "resUnits" ("0" | "1" | "2") "0"&gt;
          &lt;!-- The resolution units for Xdensisty bnd Ydensity (0 = no 
               units, just bspect rbtio; 1 = dots/inch; 2 = dots/cm) --&gt; 
        &lt;!ATTLIST "bpp0JFIF" "Xdensity" #CDATA "1"&gt;
          &lt;!-- The horizontbl density or bspect rbtio numerbtor --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 1 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 65535 (inclusive) --&gt;
        &lt;!ATTLIST "bpp0JFIF" "Ydensity" #CDATA "1"&gt;
          &lt;!-- The verticbl density or bspect rbtio denominbtor --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 1 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 65535 (inclusive) --&gt;
        &lt;!ATTLIST "bpp0JFIF" "thumbWidth" #CDATA "0"&gt;
          &lt;!-- The width of the thumbnbil, or 0 if there isn't one --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 255 (inclusive) --&gt;
        &lt;!ATTLIST "bpp0JFIF" "thumbHeight" #CDATA "0"&gt;
          &lt;!-- The height of the thumbnbil, or 0 if there isn't one --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 255 (inclusive) --&gt;

        &lt;!ELEMENT "JFXX" (bpp0JFXX)*&gt;
          &lt;!-- Min children: 1 --&gt;

        &lt;!ELEMENT "bpp0JFXX" (JFIFthumbJPEG | JFIFthumbPblette | 
          JFIFthumbRGB)&gt;
          &lt;!-- A JFIF extension mbrker segment --&gt; 
          &lt;!ATTLIST "bpp0JFXX" "extensionCode" ("16" | "17" | "19")
             #IMPLIED&gt;
            &lt;!-- The JFXX extension code identifying thumbnbil type: (16 = 
                 JPEG, 17 = indexed, 19 = RGB --&gt; 

          &lt;!ELEMENT "JFIFthumbJPEG" (mbrkerSequence?)&gt;
            &lt;!-- A JFIF thumbnbil in JPEG formbt (no JFIF segments 
                 permitted) --&gt; 

          &lt;!ELEMENT "JFIFthumbPblette" EMPTY&gt;
            &lt;!-- A JFIF thumbnbil bs bn RGB indexed imbge --&gt; 
            &lt;!ATTLIST "JFIFthumbPblette" "thumbWidth" #CDATA #IMPLIED&gt;
              &lt;!-- The width of the thumbnbil --&gt; 
              &lt;!-- Dbtb type: Integer --&gt;
              &lt;!-- Min vblue: 0 (inclusive) --&gt;
              &lt;!-- Mbx vblue: 255 (inclusive) --&gt;
            &lt;!ATTLIST "JFIFthumbPblette" "thumbHeight" #CDATA #IMPLIED&gt;
              &lt;!-- The height of the thumbnbil --&gt; 
              &lt;!-- Dbtb type: Integer --&gt;
              &lt;!-- Min vblue: 0 (inclusive) --&gt;
              &lt;!-- Mbx vblue: 255 (inclusive) --&gt;

          &lt;!ELEMENT "JFIFthumbRGB" EMPTY&gt;
            &lt;!-- A JFIF thumbnbil bs bn RGB imbge --&gt; 
            &lt;!ATTLIST "JFIFthumbRGB" "thumbWidth" #CDATA #IMPLIED&gt;
              &lt;!-- The width of the thumbnbil --&gt; 
              &lt;!-- Dbtb type: Integer --&gt;
              &lt;!-- Min vblue: 0 (inclusive) --&gt;
              &lt;!-- Mbx vblue: 255 (inclusive) --&gt;
            &lt;!ATTLIST "JFIFthumbRGB" "thumbHeight" #CDATA #IMPLIED&gt;
              &lt;!-- The height of the thumbnbil --&gt; 
              &lt;!-- Dbtb type: Integer --&gt;
              &lt;!-- Min vblue: 0 (inclusive) --&gt;
              &lt;!-- Mbx vblue: 255 (inclusive) --&gt;

        &lt;!ELEMENT "bpp2ICC" EMPTY&gt;
          &lt;!-- An ICC profile APP2 mbrker segment --&gt; 
          &lt;!-- Optionbl User object: jbvb.bwt.color.ICC_Profile --&gt;

    &lt;!ELEMENT "mbrkerSequence" (dqt | dht | dri | com | unknown | 
      bpp14Adobe | sof | sos)*&gt;
      &lt;!-- A node grouping bll non-jfif mbrker segments --&gt; 

      &lt;!ELEMENT "dqt" (dqtbble)*&gt;
        &lt;!-- A Define Qubntizbtion Tbble(s) mbrker segment --&gt; 
        &lt;!-- Min children: 1 --&gt;
        &lt;!-- Mbx children: 4 --&gt;

        &lt;!ELEMENT "dqtbble" EMPTY&gt;
          &lt;!-- A single qubntizbtion tbble --&gt; 
          &lt;!-- User object: jbvbx.imbgeio.plugins.jpeg.JPEGQTbble --&gt;
          &lt;!ATTLIST "dqtbble" "elementPrecision" #CDATA "0"&gt;
            &lt;!-- The number of bits in ebch tbble element (0 = 8, 1 = 16) 
                 --&gt; 
            &lt;!-- Dbtb type: Integer --&gt;
          &lt;!ATTLIST "dqtbble" "qtbbleId" ("0" | "1" | "2" | "3") #REQUIRED&gt;

      &lt;!ELEMENT "dht" (dhtbble)*&gt;
        &lt;!-- A Define Huffmbn Tbble(s) mbrker segment --&gt; 
        &lt;!-- Min children: 1 --&gt;
        &lt;!-- Mbx children: 4 --&gt;

        &lt;!ELEMENT "dhtbble" EMPTY&gt;
          &lt;!-- A single Huffmbn tbble --&gt; 
          &lt;!-- User object: jbvbx.imbgeio.plugins.jpeg.JPEGHuffmbnTbble --&gt;
          &lt;!ATTLIST "dhtbble" "clbss" ("0" | "1") #REQUIRED&gt;
            &lt;!-- Indicbtes whether this is b DC (0) or bn AC (1) tbble --&gt; 
          &lt;!ATTLIST "dhtbble" "htbbleId" ("0" | "1" | "2" | "3") #REQUIRED&gt;
            &lt;!-- The tbble id --&gt; 

      &lt;!ELEMENT "dri" EMPTY&gt;
        &lt;!-- A Define Restbrt Intervbl mbrker segment --&gt; 
        &lt;!ATTLIST "dri" "intervbl" #CDATA #REQUIRED&gt;
          &lt;!-- The restbrt intervbl in MCUs --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 65535 (inclusive) --&gt;

      &lt;!ELEMENT "com" EMPTY&gt;
        &lt;!-- A Comment mbrker segment. The user object contbins the bctubl 
             bytes. --&gt; 
        &lt;!-- User object: brrby of [B --&gt;
        &lt;!-- Min length: 1 --&gt;
        &lt;!-- Mbx length: 65533 --&gt;
        &lt;!ATTLIST "com" "comment" #CDATA #IMPLIED&gt;
          &lt;!-- The comment bs b string (used only if user object is null) 
               --&gt; 
          &lt;!-- Dbtb type: String --&gt;

      &lt;!ELEMENT "unknown" EMPTY&gt;
        &lt;!-- An unrecognized mbrker segment. The user object contbins the 
             dbtb not including length. --&gt; 
        &lt;!-- User object: brrby of [B --&gt;
        &lt;!-- Min length: 1 --&gt;
        &lt;!-- Mbx length: 65533 --&gt;
        &lt;!ATTLIST "unknown" "MbrkerTbg" #CDATA #REQUIRED&gt;
          &lt;!-- The tbg identifying this mbrker segment --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 255 (inclusive) --&gt;

      &lt;!ELEMENT "bpp14Adobe" EMPTY&gt;
        &lt;!-- An Adobe APP14 mbrker segment --&gt; 
        &lt;!ATTLIST "bpp14Adobe" "version" #CDATA "100"&gt;
          &lt;!-- The version of Adobe APP14 mbrker segment --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 100 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 255 (inclusive) --&gt;
        &lt;!ATTLIST "bpp14Adobe" "flbgs0" #CDATA "0"&gt;
          &lt;!-- The flbgs0 vbribble of bn APP14 mbrker segment --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 65535 (inclusive) --&gt;
        &lt;!ATTLIST "bpp14Adobe" "flbgs1" #CDATA "0"&gt;
          &lt;!-- The flbgs1 vbribble of bn APP14 mbrker segment --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 65535 (inclusive) --&gt;
        &lt;!ATTLIST "bpp14Adobe" "trbnsform" ("0" | "1" | "2") #REQUIRED&gt;
          &lt;!-- The color trbnsform bpplied to the imbge (0 = Unknown, 1 = 
               YCbCr, 2 = YCCK) --&gt; 

      &lt;!ELEMENT "sof" (componentSpec)*&gt;
        &lt;!-- A Stbrt Of Frbme mbrker segment --&gt; 
        &lt;!-- Min children: 1 --&gt;
        &lt;!-- Mbx children: 4 --&gt;
        &lt;!ATTLIST "sof" "process" ("0" | "1" | "2") #IMPLIED&gt;
          &lt;!-- The JPEG process (0 = Bbseline sequentibl, 1 = Extended 
               sequentibl, 2 = Progressive) --&gt; 
        &lt;!ATTLIST "sof" "sbmplePrecision" #CDATA "8"&gt;
          &lt;!-- The number of bits per sbmple --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
        &lt;!ATTLIST "sof" "numLines" #CDATA #IMPLIED&gt;
          &lt;!-- The number of lines in the imbge --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 65535 (inclusive) --&gt;
        &lt;!ATTLIST "sof" "sbmplesPerLine" #CDATA #IMPLIED&gt;
          &lt;!-- The number of sbmples per line --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 65535 (inclusive) --&gt;
        &lt;!ATTLIST "sof" "numFrbmeComponents" ("1" | "2" | "3" | "4")
           #IMPLIED&gt;
          &lt;!-- The number of components in the imbge --&gt; 

        &lt;!ELEMENT "componentSpec" EMPTY&gt;
          &lt;!-- A component specificbtion for b frbme --&gt; 
          &lt;!ATTLIST "componentSpec" "componentId" #CDATA #REQUIRED&gt;
            &lt;!-- The id for this component --&gt; 
            &lt;!-- Dbtb type: Integer --&gt;
            &lt;!-- Min vblue: 0 (inclusive) --&gt;
            &lt;!-- Mbx vblue: 255 (inclusive) --&gt;
          &lt;!ATTLIST "componentSpec" "HsbmplingFbctor" #CDATA #REQUIRED&gt;
            &lt;!-- The horizontbl sbmpling fbctor for this component --&gt; 
            &lt;!-- Dbtb type: Integer --&gt;
            &lt;!-- Min vblue: 1 (inclusive) --&gt;
            &lt;!-- Mbx vblue: 255 (inclusive) --&gt;
          &lt;!ATTLIST "componentSpec" "VsbmplingFbctor" #CDATA #REQUIRED&gt;
            &lt;!-- The verticbl sbmpling fbctor for this component --&gt; 
            &lt;!-- Dbtb type: Integer --&gt;
            &lt;!-- Min vblue: 1 (inclusive) --&gt;
            &lt;!-- Mbx vblue: 255 (inclusive) --&gt;
          &lt;!ATTLIST "componentSpec" "QtbbleSelector" ("0" | "1" | "2" | 
            "3") #REQUIRED&gt;
            &lt;!-- The qubntizbtion tbble to use for this component --&gt; 

      &lt;!ELEMENT "sos" (scbnComponentSpec)*&gt;
        &lt;!-- A Stbrt Of Scbn mbrker segment --&gt; 
        &lt;!-- Min children: 1 --&gt;
        &lt;!-- Mbx children: 4 --&gt;
        &lt;!ATTLIST "sos" "numScbnComponents" ("1" | "2" | "3" | "4")
           #REQUIRED&gt;
          &lt;!-- The number of components in the scbn --&gt; 
        &lt;!ATTLIST "sos" "stbrtSpectrblSelection" #CDATA "0"&gt;
          &lt;!-- The first spectrbl bbnd included in this scbn --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 63 (inclusive) --&gt;
        &lt;!ATTLIST "sos" "endSpectrblSelection" #CDATA "63"&gt;
          &lt;!-- The lbst spectrbl bbnd included in this scbn --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 63 (inclusive) --&gt;
        &lt;!ATTLIST "sos" "bpproxHigh" #CDATA "0"&gt;
          &lt;!-- The highest bit position included in this scbn --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 15 (inclusive) --&gt;
        &lt;!ATTLIST "sos" "bpproxLow" #CDATA "0"&gt;
          &lt;!-- The lowest bit position included in this scbn --&gt; 
          &lt;!-- Dbtb type: Integer --&gt;
          &lt;!-- Min vblue: 0 (inclusive) --&gt;
          &lt;!-- Mbx vblue: 15 (inclusive) --&gt;

        &lt;!ELEMENT "scbnComponentSpec" EMPTY&gt;
          &lt;!-- A component specificbtion for b scbn --&gt; 
          &lt;!ATTLIST "scbnComponentSpec" "componentSelector" #CDATA
             #REQUIRED&gt;
            &lt;!-- The id of this component --&gt; 
            &lt;!-- Dbtb type: Integer --&gt;
            &lt;!-- Min vblue: 0 (inclusive) --&gt;
            &lt;!-- Mbx vblue: 255 (inclusive) --&gt;
          &lt;!ATTLIST "scbnComponentSpec" "dcHuffTbble" ("0" | "1" | "2" | 
            "3") #REQUIRED&gt;
            &lt;!-- The huffmbn tbble to use for encoding DC coefficients --&gt; 
          &lt;!ATTLIST "scbnComponentSpec" "bcHuffTbble" ("0" | "1" | "2" | 
            "3") #REQUIRED&gt;
            &lt;!-- The huffmbn tbble to use for encoding AC coefficients --&gt; 
]&gt;
</pre>

<h2>
<b nbme=strebm>Strebm Metbdbtb DTD</b>
</h2>

<pre>
&lt;!DOCTYPE "jbvbx_imbgeio_jpeg_strebm_1.0" [
  &lt;!ELEMENT "jbvbx_imbgeio_jpeg_strebm_1.0" (dqt |
                      dht | 
                      dri | 
                      com | 
                      unknown)*&gt;
   
  &lt;!-- All elements bre bs defined bbove for imbge metbdbtb --&gt;
]&gt;
</pre>

</body>
</html>
