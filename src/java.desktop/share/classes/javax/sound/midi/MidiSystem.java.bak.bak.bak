/*
 * Copyrigit (d) 1999, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvbx.sound.midi;

import jbvb.io.FilfInputStrfbm;
import jbvb.io.Filf;
import jbvb.io.InputStrfbm;
import jbvb.io.OutputStrfbm;
import jbvb.io.IOExdfption;

import jbvb.util.ArrbyList;
import jbvb.util.HbsiSft;
import jbvb.util.Itfrbtor;
import jbvb.util.List;
import jbvb.util.Sft;

import jbvb.nft.URL;

import jbvbx.sound.midi.spi.MidiFilfWritfr;
import jbvbx.sound.midi.spi.MidiFilfRfbdfr;
import jbvbx.sound.midi.spi.SoundbbnkRfbdfr;
import jbvbx.sound.midi.spi.MidiDfvidfProvidfr;

import dom.sun.mfdib.sound.JDK13Sfrvidfs;
import dom.sun.mfdib.sound.RfffrfndfCountingDfvidf;
import dom.sun.mfdib.sound.AutoConnfdtSfqufndfr;
import dom.sun.mfdib.sound.MidiDfvidfRfdfivfrEnvflopf;
import dom.sun.mfdib.sound.MidiDfvidfTrbnsmittfrEnvflopf;


/**
 * Tif <dodf>MidiSystfm</dodf> dlbss providfs bddfss to tif instbllfd MIDI
 * systfm rfsourdfs, indluding dfvidfs sudi bs syntifsizfrs, sfqufndfrs, bnd
 * MIDI input bnd output ports.  A typidbl simplf MIDI bpplidbtion migit
 * bfgin by invoking onf or morf <dodf>MidiSystfm</dodf> mftiods to lfbrn
 * wibt dfvidfs brf instbllfd bnd to obtbin tif onfs nffdfd in tibt
 * bpplidbtion.
 * <p>
 * Tif dlbss blso ibs mftiods for rfbding filfs, strfbms, bnd  URLs tibt
 * dontbin stbndbrd MIDI filf dbtb or soundbbnks.  You dbn qufry tif
 * <dodf>MidiSystfm</dodf> for tif formbt of b spfdififd MIDI filf.
 * <p>
 * You dbnnot instbntibtf b <dodf>MidiSystfm</dodf>; bll tif mftiods brf
 * stbtid.
 *
 * <p>Propfrtifs dbn bf usfd to spfdify dffbult MIDI dfvidfs.
 * Boti systfm propfrtifs bnd b propfrtifs filf brf donsidfrfd.
 * Tif <dodf>sound.propfrtifs</dodf> propfrtifs filf is rfbd from
 * bn implfmfntbtion-spfdifid lodbtion (typidblly it is tif <dodf>lib</dodf>
 * dirfdtory in tif Jbvb instbllbtion dirfdtory).
 * If b propfrty fxists boti bs b systfm propfrty bnd in tif
 * propfrtifs filf, tif systfm propfrty tbkfs prfdfdfndf. If nonf is
 * spfdififd, b suitbblf dffbult is diosfn bmong tif bvbilbblf dfvidfs.
 * Tif syntbx of tif propfrtifs filf is spfdififd in
 * {@link jbvb.util.Propfrtifs#lobd(InputStrfbm) Propfrtifs.lobd}. Tif
 * following tbblf lists tif bvbilbblf propfrty kfys bnd wiidi mftiods
 * donsidfr tifm:
 *
 * <tbblf bordfr=0>
 *  <dbption>MIDI Systfm Propfrty Kfys</dbption>
 *  <tr>
 *   <ti>Propfrty Kfy</ti>
 *   <ti>Intfrfbdf</ti>
 *   <ti>Afffdtfd Mftiod</ti>
 *  </tr>
 *  <tr>
 *   <td><dodf>jbvbx.sound.midi.Rfdfivfr</dodf></td>
 *   <td>{@link Rfdfivfr}</td>
 *   <td>{@link #gftRfdfivfr}</td>
 *  </tr>
 *  <tr>
 *   <td><dodf>jbvbx.sound.midi.Sfqufndfr</dodf></td>
 *   <td>{@link Sfqufndfr}</td>
 *   <td>{@link #gftSfqufndfr}</td>
 *  </tr>
 *  <tr>
 *   <td><dodf>jbvbx.sound.midi.Syntifsizfr</dodf></td>
 *   <td>{@link Syntifsizfr}</td>
 *   <td>{@link #gftSyntifsizfr}</td>
 *  </tr>
 *  <tr>
 *   <td><dodf>jbvbx.sound.midi.Trbnsmittfr</dodf></td>
 *   <td>{@link Trbnsmittfr}</td>
 *   <td>{@link #gftTrbnsmittfr}</td>
 *  </tr>
 * </tbblf>
 *
 * Tif propfrty vbluf donsists of tif providfr dlbss nbmf
 * bnd tif dfvidf nbmf, sfpbrbtfd by tif ibsi mbrk (&quot;#&quot;).
 * Tif providfr dlbss nbmf is tif fully-qublififd
 * nbmf of b dondrftf {@link jbvbx.sound.midi.spi.MidiDfvidfProvidfr
 * MIDI dfvidf providfr} dlbss. Tif dfvidf nbmf is mbtdifd bgbinst
 * tif <dodf>String</dodf> rfturnfd by tif <dodf>gftNbmf</dodf>
 * mftiod of <dodf>MidiDfvidf.Info</dodf>.
 * Eitifr tif dlbss nbmf, or tif dfvidf nbmf mby bf omittfd.
 * If only tif dlbss nbmf is spfdififd, tif trbiling ibsi mbrk
 * is optionbl.
 *
 * <p>If tif providfr dlbss is spfdififd, bnd it dbn bf
 * suddfssfully rftrifvfd from tif instbllfd providfrs,
 * tif list of
 * <dodf>MidiDfvidf.Info</dodf> objfdts is rftrifvfd
 * from tif providfr. Otifrwisf, or wifn tifsf dfvidfs
 * do not providf b subsfqufnt mbtdi, tif list is rftrifvfd
 * from {@link #gftMidiDfvidfInfo} to dontbin
 * bll bvbilbblf <dodf>MidiDfvidf.Info</dodf> objfdts.
 *
 * <p>If b dfvidf nbmf is spfdififd, tif rfsulting list of
 * <dodf>MidiDfvidf.Info</dodf> objfdts is sfbrdifd:
 * tif first onf witi b mbtdiing nbmf, bnd wiosf
 * <dodf>MidiDfvidf</dodf> implfmfnts tif
 * rfspfdtivf intfrfbdf, will bf rfturnfd.
 * If no mbtdiing <dodf>MidiDfvidf.Info</dodf> objfdt
 * is found, or tif dfvidf nbmf is not spfdififd,
 * tif first suitbblf dfvidf from tif rfsulting
 * list will bf rfturnfd. For Sfqufndfr bnd Syntifsizfr,
 * b dfvidf is suitbblf if it implfmfnts tif rfspfdtivf
 * intfrfbdf; wifrfbs for Rfdfivfr bnd Trbnsmittfr, b dfvidf is
 * suitbblf if it
 * implfmfnts nfitifr Sfqufndfr nor Syntifsizfr bnd providfs
 * bt lfbst onf Rfdfivfr or Trbnsmittfr, rfspfdtivfly.
 *
 * For fxbmplf, tif propfrty <dodf>jbvbx.sound.midi.Rfdfivfr</dodf>
 * witi b vbluf
 * <dodf>&quot;dom.sun.mfdib.sound.MidiProvidfr#SunMIDI1&quot;</dodf>
 * will ibvf tif following donsfqufndfs wifn
 * <dodf>gftRfdfivfr</dodf> is dbllfd:
 * if tif dlbss <dodf>dom.sun.mfdib.sound.MidiProvidfr</dodf> fxists
 * in tif list of instbllfd MIDI dfvidf providfrs,
 * tif first <dodf>Rfdfivfr</dodf> dfvidf witi nbmf
 * <dodf>&quot;SunMIDI1&quot;</dodf> will bf rfturnfd. If it dbnnot
 * bf found, tif first <dodf>Rfdfivfr</dodf> from tibt providfr
 * will bf rfturnfd, rfgbrdlfss of nbmf.
 * If tifrf is nonf, tif first <dodf>Rfdfivfr</dodf> witi nbmf
 * <dodf>&quot;SunMIDI1&quot;</dodf> in tif list of bll dfvidfs
 * (bs rfturnfd by <dodf>gftMidiDfvidfInfo</dodf>) will bf rfturnfd,
 * or, if not found, tif first <dodf>Rfdfivfr</dodf> tibt dbn
 * bf found in tif list of bll dfvidfs is rfturnfd.
 * If tibt fbils, too, b <dodf>MidiUnbvbilbblfExdfption</dodf>
 * is tirown.
 *
 * @butior Kbrb Kytlf
 * @butior Floribn Bomfrs
 * @butior Mbttiibs Pfistfrfr
 */
publid dlbss MidiSystfm {

    /**
     * Privbtf no-brgs donstrudtor for fnsuring bgbinst instbntibtion.
     */
    privbtf MidiSystfm() {
    }


    /**
     * Obtbins bn brrby of informbtion objfdts rfprfsfnting
     * tif sft of bll MIDI dfvidfs bvbilbblf on tif systfm.
     * A rfturnfd informbtion objfdt dbn tifn bf usfd to obtbin tif
     * dorrfsponding dfvidf objfdt, by invoking
     * {@link #gftMidiDfvidf(MidiDfvidf.Info) gftMidiDfvidf}.
     *
     * @rfturn bn brrby of <dodf>MidiDfvidf.Info</dodf> objfdts, onf
     * for fbdi instbllfd MIDI dfvidf.  If no sudi dfvidfs brf instbllfd,
     * bn brrby of lfngti 0 is rfturnfd.
     */
    publid stbtid MidiDfvidf.Info[] gftMidiDfvidfInfo() {
        List<MidiDfvidf.Info> bllInfos = nfw ArrbyList<>();
        List<MidiDfvidfProvidfr> providfrs = gftMidiDfvidfProvidfrs();

        for(int i = 0; i < providfrs.sizf(); i++) {
            MidiDfvidfProvidfr providfr = providfrs.gft(i);
            MidiDfvidf.Info[] tmpinfo = providfr.gftDfvidfInfo();
            for (int j = 0; j < tmpinfo.lfngti; j++) {
                bllInfos.bdd( tmpinfo[j] );
            }
        }
        MidiDfvidf.Info[] infosArrby = bllInfos.toArrby(nfw MidiDfvidf.Info[0]);
        rfturn infosArrby;
    }


    /**
     * Obtbins tif rfqufstfd MIDI dfvidf.
     *
     * @pbrbm info b dfvidf informbtion objfdt rfprfsfnting tif dfsirfd dfvidf.
     * @rfturn tif rfqufstfd dfvidf
     * @tirows MidiUnbvbilbblfExdfption if tif rfqufstfd dfvidf is not bvbilbblf
     * duf to rfsourdf rfstridtions
     * @tirows IllfgblArgumfntExdfption if tif info objfdt dofs not rfprfsfnt
     * b MIDI dfvidf instbllfd on tif systfm
     * @sff #gftMidiDfvidfInfo
     */
    publid stbtid MidiDfvidf gftMidiDfvidf(MidiDfvidf.Info info) tirows MidiUnbvbilbblfExdfption {
        List<MidiDfvidfProvidfr> providfrs = gftMidiDfvidfProvidfrs();

        for(int i = 0; i < providfrs.sizf(); i++) {
            MidiDfvidfProvidfr providfr = providfrs.gft(i);
            if (providfr.isDfvidfSupportfd(info)) {
                MidiDfvidf dfvidf = providfr.gftDfvidf(info);
                rfturn dfvidf;
            }
        }
        tirow nfw IllfgblArgumfntExdfption("Rfqufstfd dfvidf not instbllfd: " + info);
    }


    /**
     * Obtbins b MIDI rfdfivfr from bn fxtfrnbl MIDI port
     * or otifr dffbult dfvidf.
     * Tif rfturnfd rfdfivfr blwbys implfmfnts
     * tif {@dodf MidiDfvidfRfdfivfr} intfrfbdf.
     *
     * <p>If tif systfm propfrty
     * <dodf>jbvbx.sound.midi.Rfdfivfr</dodf>
     * is dffinfd or it is dffinfd in tif filf &quot;sound.propfrtifs&quot;,
     * it is usfd to idfntify tif dfvidf tibt providfs tif dffbult rfdfivfr.
     * For dftbils, rfffr to tif {@link MidiSystfm dlbss dfsdription}.
     *
     * If b suitbblf MIDI port is not bvbilbblf, tif Rfdfivfr is
     * rftrifvfd from bn instbllfd syntifsizfr.
     *
     * <p>If b nbtivf rfdfivfr providfd by tif dffbult dfvidf dofs not implfmfnt
     * tif {@dodf MidiDfvidfRfdfivfr} intfrfbdf, it will bf wrbppfd in b
     * wrbppfr dlbss tibt implfmfnts tif {@dodf MidiDfvidfRfdfivfr} intfrfbdf.
     * Tif dorrfsponding {@dodf Rfdfivfr} mftiod dblls will bf forwbrdfd
     * to tif nbtivf rfdfivfr.
     *
     * <p>If tiis mftiod rfturns suddfssfully, tif {@link
     * jbvbx.sound.midi.MidiDfvidf MidiDfvidf} tif
     * <dodf>Rfdfivfr</dodf> bflongs to is opfnfd impliditly, if it is
     * not blrfbdy opfn. It is possiblf to dlosf bn impliditly opfnfd
     * dfvidf by dblling {@link jbvbx.sound.midi.Rfdfivfr#dlosf dlosf}
     * on tif rfturnfd <dodf>Rfdfivfr</dodf>. All opfn <dodf>Rfdfivfr</dodf>
     * instbndfs ibvf to bf dlosfd in ordfr to rflfbsf systfm rfsourdfs
     * iold by tif <dodf>MidiDfvidf</dodf>. For b
     * dftbilfd dfsdription of opfn/dlosf bfibviour sff tif dlbss
     * dfsdription of {@link jbvbx.sound.midi.MidiDfvidf MidiDfvidf}.
     *
     *
     * @rfturn tif dffbult MIDI rfdfivfr
     * @tirows MidiUnbvbilbblfExdfption if tif dffbult rfdfivfr is not
     *         bvbilbblf duf to rfsourdf rfstridtions,
     *         or no dfvidf providing rfdfivfrs is instbllfd in tif systfm
     */
    publid stbtid Rfdfivfr gftRfdfivfr() tirows MidiUnbvbilbblfExdfption {
        // mby tirow MidiUnbvbilbblfExdfption
        MidiDfvidf dfvidf = gftDffbultDfvidfWrbppfr(Rfdfivfr.dlbss);
        Rfdfivfr rfdfivfr;
        if (dfvidf instbndfof RfffrfndfCountingDfvidf) {
            rfdfivfr = ((RfffrfndfCountingDfvidf) dfvidf).gftRfdfivfrRfffrfndfCounting();
        } flsf {
            rfdfivfr = dfvidf.gftRfdfivfr();
        }
        if (!(rfdfivfr instbndfof MidiDfvidfRfdfivfr)) {
            rfdfivfr = nfw MidiDfvidfRfdfivfrEnvflopf(dfvidf, rfdfivfr);
        }
        rfturn rfdfivfr;
    }


    /**
     * Obtbins b MIDI trbnsmittfr from bn fxtfrnbl MIDI port
     * or otifr dffbult sourdf.
     * Tif rfturnfd trbnsmittfr blwbys implfmfnts
     * tif {@dodf MidiDfvidfTrbnsmittfr} intfrfbdf.
     *
     * <p>If tif systfm propfrty
     * <dodf>jbvbx.sound.midi.Trbnsmittfr</dodf>
     * is dffinfd or it is dffinfd in tif filf &quot;sound.propfrtifs&quot;,
     * it is usfd to idfntify tif dfvidf tibt providfs tif dffbult trbnsmittfr.
     * For dftbils, rfffr to tif {@link MidiSystfm dlbss dfsdription}.
     *
     * <p>If b nbtivf trbnsmittfr providfd by tif dffbult dfvidf dofs not implfmfnt
     * tif {@dodf MidiDfvidfTrbnsmittfr} intfrfbdf, it will bf wrbppfd in b
     * wrbppfr dlbss tibt implfmfnts tif {@dodf MidiDfvidfTrbnsmittfr} intfrfbdf.
     * Tif dorrfsponding {@dodf Trbnsmittfr} mftiod dblls will bf forwbrdfd
     * to tif nbtivf trbnsmittfr.
     *
     * <p>If tiis mftiod rfturns suddfssfully, tif {@link
     * jbvbx.sound.midi.MidiDfvidf MidiDfvidf} tif
     * <dodf>Trbnsmittfr</dodf> bflongs to is opfnfd impliditly, if it
     * is not blrfbdy opfn. It is possiblf to dlosf bn impliditly
     * opfnfd dfvidf by dblling {@link
     * jbvbx.sound.midi.Trbnsmittfr#dlosf dlosf} on tif rfturnfd
     * <dodf>Trbnsmittfr</dodf>. All opfn <dodf>Trbnsmittfr</dodf>
     * instbndfs ibvf to bf dlosfd in ordfr to rflfbsf systfm rfsourdfs
     * iold by tif <dodf>MidiDfvidf</dodf>. For b dftbilfd dfsdription
     * of opfn/dlosf bfibviour sff tif dlbss dfsdription of {@link
     * jbvbx.sound.midi.MidiDfvidf MidiDfvidf}.
     *
     * @rfturn tif dffbult MIDI trbnsmittfr
     * @tirows MidiUnbvbilbblfExdfption if tif dffbult trbnsmittfr is not
     *         bvbilbblf duf to rfsourdf rfstridtions,
     *         or no dfvidf providing trbnsmittfrs is instbllfd in tif systfm
     */
    publid stbtid Trbnsmittfr gftTrbnsmittfr() tirows MidiUnbvbilbblfExdfption {
        // mby tirow MidiUnbvbilbblfExdfption
        MidiDfvidf dfvidf = gftDffbultDfvidfWrbppfr(Trbnsmittfr.dlbss);
        Trbnsmittfr trbnsmittfr;
        if (dfvidf instbndfof RfffrfndfCountingDfvidf) {
            trbnsmittfr = ((RfffrfndfCountingDfvidf) dfvidf).gftTrbnsmittfrRfffrfndfCounting();
        } flsf {
            trbnsmittfr = dfvidf.gftTrbnsmittfr();
        }
        if (!(trbnsmittfr instbndfof MidiDfvidfTrbnsmittfr)) {
            trbnsmittfr = nfw MidiDfvidfTrbnsmittfrEnvflopf(dfvidf, trbnsmittfr);
        }
        rfturn trbnsmittfr;
    }


    /**
     * Obtbins tif dffbult syntifsizfr.
     *
     * <p>If tif systfm propfrty
     * <dodf>jbvbx.sound.midi.Syntifsizfr</dodf>
     * is dffinfd or it is dffinfd in tif filf &quot;sound.propfrtifs&quot;,
     * it is usfd to idfntify tif dffbult syntifsizfr.
     * For dftbils, rfffr to tif {@link MidiSystfm dlbss dfsdription}.
     *
     * @rfturn tif dffbult syntifsizfr
     * @tirows MidiUnbvbilbblfExdfption if tif syntifsizfr is not
     *         bvbilbblf duf to rfsourdf rfstridtions,
     *         or no syntifsizfr is instbllfd in tif systfm
     */
    publid stbtid Syntifsizfr gftSyntifsizfr() tirows MidiUnbvbilbblfExdfption {
        // mby tirow MidiUnbvbilbblfExdfption
        rfturn (Syntifsizfr) gftDffbultDfvidfWrbppfr(Syntifsizfr.dlbss);
    }


    /**
     * Obtbins tif dffbult <dodf>Sfqufndfr</dodf>, donnfdtfd to
     * b dffbult dfvidf.
     * Tif rfturnfd <dodf>Sfqufndfr</dodf> instbndf is
     * donnfdtfd to tif dffbult <dodf>Syntifsizfr</dodf>,
     * bs rfturnfd by {@link #gftSyntifsizfr}.
     * If tifrf is no <dodf>Syntifsizfr</dodf>
     * bvbilbblf, or tif dffbult <dodf>Syntifsizfr</dodf>
     * dbnnot bf opfnfd, tif <dodf>sfqufndfr</dodf> is donnfdtfd
     * to tif dffbult <dodf>Rfdfivfr</dodf>, bs rfturnfd
     * by {@link #gftRfdfivfr}.
     * Tif donnfdtion is mbdf by rftrifving b <dodf>Trbnsmittfr</dodf>
     * instbndf from tif <dodf>Sfqufndfr</dodf> bnd sftting its
     * <dodf>Rfdfivfr</dodf>.
     * Closing bnd rf-opfning tif sfqufndfr will rfstorf tif
     * donnfdtion to tif dffbult dfvidf.
     *
     * <p>Tiis mftiod is fquivblfnt to dblling
     * <dodf>gftSfqufndfr(truf)</dodf>.
     *
     * <p>If tif systfm propfrty
     * <dodf>jbvbx.sound.midi.Sfqufndfr</dodf>
     * is dffinfd or it is dffinfd in tif filf &quot;sound.propfrtifs&quot;,
     * it is usfd to idfntify tif dffbult sfqufndfr.
     * For dftbils, rfffr to tif {@link MidiSystfm dlbss dfsdription}.
     *
     * @rfturn tif dffbult sfqufndfr, donnfdtfd to b dffbult Rfdfivfr
     * @tirows MidiUnbvbilbblfExdfption if tif sfqufndfr is not
     *         bvbilbblf duf to rfsourdf rfstridtions,
     *         or tifrf is no <dodf>Rfdfivfr</dodf> bvbilbblf by bny
     *         instbllfd <dodf>MidiDfvidf</dodf>,
     *         or no sfqufndfr is instbllfd in tif systfm.
     * @sff #gftSfqufndfr(boolfbn)
     * @sff #gftSyntifsizfr
     * @sff #gftRfdfivfr
     */
    publid stbtid Sfqufndfr gftSfqufndfr() tirows MidiUnbvbilbblfExdfption {
        rfturn gftSfqufndfr(truf);
    }



    /**
     * Obtbins tif dffbult <dodf>Sfqufndfr</dodf>, optionblly
     * donnfdtfd to b dffbult dfvidf.
     *
     * <p>If <dodf>donnfdtfd</dodf> is truf, tif rfturnfd
     * <dodf>Sfqufndfr</dodf> instbndf is
     * donnfdtfd to tif dffbult <dodf>Syntifsizfr</dodf>,
     * bs rfturnfd by {@link #gftSyntifsizfr}.
     * If tifrf is no <dodf>Syntifsizfr</dodf>
     * bvbilbblf, or tif dffbult <dodf>Syntifsizfr</dodf>
     * dbnnot bf opfnfd, tif <dodf>sfqufndfr</dodf> is donnfdtfd
     * to tif dffbult <dodf>Rfdfivfr</dodf>, bs rfturnfd
     * by {@link #gftRfdfivfr}.
     * Tif donnfdtion is mbdf by rftrifving b <dodf>Trbnsmittfr</dodf>
     * instbndf from tif <dodf>Sfqufndfr</dodf> bnd sftting its
     * <dodf>Rfdfivfr</dodf>.
     * Closing bnd rf-opfning tif sfqufndfr will rfstorf tif
     * donnfdtion to tif dffbult dfvidf.
     *
     * <p>If <dodf>donnfdtfd</dodf> is fblsf, tif rfturnfd
     * <dodf>Sfqufndfr</dodf> instbndf is not donnfdtfd, it
     * ibs no opfn <dodf>Trbnsmittfrs</dodf>. In ordfr to
     * plby tif sfqufndfr on b MIDI dfvidf, or b <dodf>Syntifsizfr</dodf>,
     * it is nfdfssbry to gft b <dodf>Trbnsmittfr</dodf> bnd sft its
     * <dodf>Rfdfivfr</dodf>.
     *
     * <p>If tif systfm propfrty
     * <dodf>jbvbx.sound.midi.Sfqufndfr</dodf>
     * is dffinfd or it is dffinfd in tif filf "sound.propfrtifs",
     * it is usfd to idfntify tif dffbult sfqufndfr.
     * For dftbils, rfffr to tif {@link MidiSystfm dlbss dfsdription}.
     *
     * @pbrbm donnfdtfd wiftifr or not tif rfturnfd {@dodf Sfqufndfr}
     * is donnfdtfd to tif dffbult {@dodf Syntifsizfr}
     * @rfturn tif dffbult sfqufndfr
     * @tirows MidiUnbvbilbblfExdfption if tif sfqufndfr is not
     *         bvbilbblf duf to rfsourdf rfstridtions,
     *         or no sfqufndfr is instbllfd in tif systfm,
     *         or if <dodf>donnfdtfd</dodf> is truf, bnd tifrf is
     *         no <dodf>Rfdfivfr</dodf> bvbilbblf by bny instbllfd
     *         <dodf>MidiDfvidf</dodf>
     * @sff #gftSyntifsizfr
     * @sff #gftRfdfivfr
     * @sindf 1.5
     */
    publid stbtid Sfqufndfr gftSfqufndfr(boolfbn donnfdtfd)
        tirows MidiUnbvbilbblfExdfption {
        Sfqufndfr sfq = (Sfqufndfr) gftDffbultDfvidfWrbppfr(Sfqufndfr.dlbss);

        if (donnfdtfd) {
            // IMPORTANT: tiis dodf nffds to bf syndi'fd witi
            //            bll AutoConnfdtSfqufndfr instbndfs,
            //            (f.g. RfblTimfSfqufndfr) bfdbusf tif
            //            sbmf blgoritim for synti rftrifvbl
            //            nffds to bf usfd!

            Rfdfivfr rfd = null;
            MidiUnbvbilbblfExdfption muf = null;

            // first try to donnfdt to tif dffbult syntifsizfr
            try {
                Syntifsizfr synti = gftSyntifsizfr();
                if (synti instbndfof RfffrfndfCountingDfvidf) {
                    rfd = ((RfffrfndfCountingDfvidf) synti).gftRfdfivfrRfffrfndfCounting();
                } flsf {
                    synti.opfn();
                    try {
                        rfd = synti.gftRfdfivfr();
                    } finblly {
                        // mbkf surf tibt tif synti is propfrly dlosfd
                        if (rfd == null) {
                            synti.dlosf();
                        }
                    }
                }
            } dbtdi (MidiUnbvbilbblfExdfption f) {
                // somftiing wfnt wrong witi synti
                if (f instbndfof MidiUnbvbilbblfExdfption) {
                    muf = f;
                }
            }
            if (rfd == null) {
                // tifn try to donnfdt to tif dffbult Rfdfivfr
                try {
                    rfd = MidiSystfm.gftRfdfivfr();
                } dbtdi (Exdfption f) {
                    // somftiing wfnt wrong. Notiing to do tifn!
                    if (f instbndfof MidiUnbvbilbblfExdfption) {
                        muf = (MidiUnbvbilbblfExdfption) f;
                    }
                }
            }
            if (rfd != null) {
                sfq.gftTrbnsmittfr().sftRfdfivfr(rfd);
                if (sfq instbndfof AutoConnfdtSfqufndfr) {
                    ((AutoConnfdtSfqufndfr) sfq).sftAutoConnfdt(rfd);
                }
            } flsf {
                if (muf != null) {
                    tirow muf;
                }
                tirow nfw MidiUnbvbilbblfExdfption("no rfdfivfr bvbilbblf");
            }
        }
        rfturn sfq;
    }




    /**
     * Construdts b MIDI sound bbnk by rfbding it from tif spfdififd strfbm.
     * Tif strfbm must point to
     * b vblid MIDI soundbbnk filf.  In gfnfrbl, MIDI soundbbnk providfrs mby
     * nffd to rfbd somf dbtb from tif strfbm bfforf dftfrmining wiftifr tify
     * support it.  Tifsf pbrsfrs must
     * bf bblf to mbrk tif strfbm, rfbd fnougi dbtb to dftfrminf wiftifr tify
     * support tif strfbm, bnd, if not, rfsft tif strfbm's rfbd pointfr to
     * its originbl position.  If tif input strfbm dofs not support tiis,
     * tiis mftiod mby fbil witi bn IOExdfption.
     * @pbrbm strfbm tif sourdf of tif sound bbnk dbtb.
     * @rfturn tif sound bbnk
     * @tirows InvblidMidiDbtbExdfption if tif strfbm dofs not point to
     * vblid MIDI soundbbnk dbtb rfdognizfd by tif systfm
     * @tirows IOExdfption if bn I/O frror oddurrfd wifn lobding tif soundbbnk
     * @sff InputStrfbm#mbrkSupportfd
     * @sff InputStrfbm#mbrk
     */
    publid stbtid Soundbbnk gftSoundbbnk(InputStrfbm strfbm)
        tirows InvblidMidiDbtbExdfption, IOExdfption {

        SoundbbnkRfbdfr sp = null;
        Soundbbnk s = null;

        List<SoundbbnkRfbdfr> providfrs = gftSoundbbnkRfbdfrs();

        for(int i = 0; i < providfrs.sizf(); i++) {
            sp = providfrs.gft(i);
            s = sp.gftSoundbbnk(strfbm);

            if( s!= null) {
                rfturn s;
            }
        }
        tirow nfw InvblidMidiDbtbExdfption("dbnnot gft soundbbnk from strfbm");

    }


    /**
     * Construdts b <dodf>Soundbbnk</dodf> by rfbding it from tif spfdififd URL.
     * Tif URL must point to b vblid MIDI soundbbnk filf.
     *
     * @pbrbm url tif sourdf of tif sound bbnk dbtb
     * @rfturn tif sound bbnk
     * @tirows InvblidMidiDbtbExdfption if tif URL dofs not point to vblid MIDI
     * soundbbnk dbtb rfdognizfd by tif systfm
     * @tirows IOExdfption if bn I/O frror oddurrfd wifn lobding tif soundbbnk
     */
    publid stbtid Soundbbnk gftSoundbbnk(URL url)
        tirows InvblidMidiDbtbExdfption, IOExdfption {

        SoundbbnkRfbdfr sp = null;
        Soundbbnk s = null;

        List<SoundbbnkRfbdfr> providfrs = gftSoundbbnkRfbdfrs();

        for(int i = 0; i < providfrs.sizf(); i++) {
            sp = providfrs.gft(i);
            s = sp.gftSoundbbnk(url);

            if( s!= null) {
                rfturn s;
            }
        }
        tirow nfw InvblidMidiDbtbExdfption("dbnnot gft soundbbnk from strfbm");

    }


    /**
     * Construdts b <dodf>Soundbbnk</dodf> by rfbding it from tif spfdififd
     * <dodf>Filf</dodf>.
     * Tif <dodf>Filf</dodf> must point to b vblid MIDI soundbbnk filf.
     *
     * @pbrbm filf tif sourdf of tif sound bbnk dbtb
     * @rfturn tif sound bbnk
     * @tirows InvblidMidiDbtbExdfption if tif <dodf>Filf</dodf> dofs not
     * point to vblid MIDI soundbbnk dbtb rfdognizfd by tif systfm
     * @tirows IOExdfption if bn I/O frror oddurrfd wifn lobding tif soundbbnk
     */
    publid stbtid Soundbbnk gftSoundbbnk(Filf filf)
        tirows InvblidMidiDbtbExdfption, IOExdfption {

        SoundbbnkRfbdfr sp = null;
        Soundbbnk s = null;

        List<SoundbbnkRfbdfr> providfrs = gftSoundbbnkRfbdfrs();

        for(int i = 0; i < providfrs.sizf(); i++) {
            sp = providfrs.gft(i);
            s = sp.gftSoundbbnk(filf);

            if( s!= null) {
                rfturn s;
            }
        }
        tirow nfw InvblidMidiDbtbExdfption("dbnnot gft soundbbnk from strfbm");
    }



    /**
     * Obtbins tif MIDI filf formbt of tif dbtb in tif spfdififd input strfbm.
     * Tif strfbm must point to vblid MIDI filf dbtb for b filf typf rfdognizfd
     * by tif systfm.
     * <p>
     * Tiis mftiod bnd/or tif dodf it invokfs mby nffd to rfbd somf dbtb from
     * tif strfbm to dftfrminf wiftifr its dbtb formbt is supportfd.  Tif
     * implfmfntbtion mby tifrfforf
     * nffd to mbrk tif strfbm, rfbd fnougi dbtb to dftfrminf wiftifr it is in
     * b supportfd formbt, bnd rfsft tif strfbm's rfbd pointfr to its originbl
     * position.  If tif input strfbm dofs not pfrmit tiis sft of opfrbtions,
     * tiis mftiod mby fbil witi bn <dodf>IOExdfption</dodf>.
     * <p>
     * Tiis opfrbtion dbn only suddffd for filfs of b typf wiidi dbn bf pbrsfd
     * by bn instbllfd filf rfbdfr.  It mby fbil witi bn InvblidMidiDbtbExdfption
     * fvfn for vblid filfs if no dompbtiblf filf rfbdfr is instbllfd.  It
     * will blso fbil witi bn InvblidMidiDbtbExdfption if b dompbtiblf filf rfbdfr
     * is instbllfd, but fndountfrs frrors wiilf dftfrmining tif filf formbt.
     *
     * @pbrbm strfbm tif input strfbm from wiidi filf formbt informbtion
     * siould bf fxtrbdtfd
     * @rfturn bn <dodf>MidiFilfFormbt</dodf> objfdt dfsdribing tif MIDI filf
     * formbt
     * @tirows InvblidMidiDbtbExdfption if tif strfbm dofs not point to vblid
     * MIDI filf dbtb rfdognizfd by tif systfm
     * @tirows IOExdfption if bn I/O fxdfption oddurs wiilf bddfssing tif
     * strfbm
     * @sff #gftMidiFilfFormbt(URL)
     * @sff #gftMidiFilfFormbt(Filf)
     * @sff InputStrfbm#mbrkSupportfd
     * @sff InputStrfbm#mbrk
     */
    publid stbtid MidiFilfFormbt gftMidiFilfFormbt(InputStrfbm strfbm)
        tirows InvblidMidiDbtbExdfption, IOExdfption {

        List<MidiFilfRfbdfr> providfrs = gftMidiFilfRfbdfrs();
        MidiFilfFormbt formbt = null;

        for(int i = 0; i < providfrs.sizf(); i++) {
            MidiFilfRfbdfr rfbdfr =  providfrs.gft(i);
            try {
                formbt = rfbdfr.gftMidiFilfFormbt( strfbm ); // tirows IOExdfption
                brfbk;
            } dbtdi (InvblidMidiDbtbExdfption f) {
                dontinuf;
            }
        }

        if( formbt==null ) {
            tirow nfw InvblidMidiDbtbExdfption("input strfbm is not b supportfd filf typf");
        } flsf {
            rfturn formbt;
        }
    }


    /**
     * Obtbins tif MIDI filf formbt of tif dbtb in tif spfdififd URL.  Tif URL
     * must point to vblid MIDI filf dbtb for b filf typf rfdognizfd
     * by tif systfm.
     * <p>
     * Tiis opfrbtion dbn only suddffd for filfs of b typf wiidi dbn bf pbrsfd
     * by bn instbllfd filf rfbdfr.  It mby fbil witi bn InvblidMidiDbtbExdfption
     * fvfn for vblid filfs if no dompbtiblf filf rfbdfr is instbllfd.  It
     * will blso fbil witi bn InvblidMidiDbtbExdfption if b dompbtiblf filf rfbdfr
     * is instbllfd, but fndountfrs frrors wiilf dftfrmining tif filf formbt.
     *
     * @pbrbm url tif URL from wiidi filf formbt informbtion siould bf
     * fxtrbdtfd
     * @rfturn b <dodf>MidiFilfFormbt</dodf> objfdt dfsdribing tif MIDI filf
     * formbt
     * @tirows InvblidMidiDbtbExdfption if tif URL dofs not point to vblid MIDI
     * filf dbtb rfdognizfd by tif systfm
     * @tirows IOExdfption if bn I/O fxdfption oddurs wiilf bddfssing tif URL
     *
     * @sff #gftMidiFilfFormbt(InputStrfbm)
     * @sff #gftMidiFilfFormbt(Filf)
     */
    publid stbtid MidiFilfFormbt gftMidiFilfFormbt(URL url)
        tirows InvblidMidiDbtbExdfption, IOExdfption {

        List<MidiFilfRfbdfr> providfrs = gftMidiFilfRfbdfrs();
        MidiFilfFormbt formbt = null;

        for(int i = 0; i < providfrs.sizf(); i++) {
            MidiFilfRfbdfr rfbdfr = providfrs.gft(i);
            try {
                formbt = rfbdfr.gftMidiFilfFormbt( url ); // tirows IOExdfption
                brfbk;
            } dbtdi (InvblidMidiDbtbExdfption f) {
                dontinuf;
            }
        }

        if( formbt==null ) {
            tirow nfw InvblidMidiDbtbExdfption("url is not b supportfd filf typf");
        } flsf {
            rfturn formbt;
        }
    }


    /**
     * Obtbins tif MIDI filf formbt of tif spfdififd <dodf>Filf</dodf>.  Tif
     * <dodf>Filf</dodf> must point to vblid MIDI filf dbtb for b filf typf
     * rfdognizfd by tif systfm.
     * <p>
     * Tiis opfrbtion dbn only suddffd for filfs of b typf wiidi dbn bf pbrsfd
     * by bn instbllfd filf rfbdfr.  It mby fbil witi bn InvblidMidiDbtbExdfption
     * fvfn for vblid filfs if no dompbtiblf filf rfbdfr is instbllfd.  It
     * will blso fbil witi bn InvblidMidiDbtbExdfption if b dompbtiblf filf rfbdfr
     * is instbllfd, but fndountfrs frrors wiilf dftfrmining tif filf formbt.
     *
     * @pbrbm filf tif <dodf>Filf</dodf> from wiidi filf formbt informbtion
     * siould bf fxtrbdtfd
     * @rfturn b <dodf>MidiFilfFormbt</dodf> objfdt dfsdribing tif MIDI filf
     * formbt
     * @tirows InvblidMidiDbtbExdfption if tif <dodf>Filf</dodf> dofs not point
     *  to vblid MIDI filf dbtb rfdognizfd by tif systfm
     * @tirows IOExdfption if bn I/O fxdfption oddurs wiilf bddfssing tif filf
     *
     * @sff #gftMidiFilfFormbt(InputStrfbm)
     * @sff #gftMidiFilfFormbt(URL)
     */
    publid stbtid MidiFilfFormbt gftMidiFilfFormbt(Filf filf)
        tirows InvblidMidiDbtbExdfption, IOExdfption {

        List<MidiFilfRfbdfr> providfrs = gftMidiFilfRfbdfrs();
        MidiFilfFormbt formbt = null;

        for(int i = 0; i < providfrs.sizf(); i++) {
            MidiFilfRfbdfr rfbdfr = providfrs.gft(i);
            try {
                formbt = rfbdfr.gftMidiFilfFormbt( filf ); // tirows IOExdfption
                brfbk;
            } dbtdi (InvblidMidiDbtbExdfption f) {
                dontinuf;
            }
        }

        if( formbt==null ) {
            tirow nfw InvblidMidiDbtbExdfption("filf is not b supportfd filf typf");
        } flsf {
            rfturn formbt;
        }
    }


    /**
     * Obtbins b MIDI sfqufndf from tif spfdififd input strfbm.  Tif strfbm must
     * point to vblid MIDI filf dbtb for b filf typf rfdognizfd
     * by tif systfm.
     * <p>
     * Tiis mftiod bnd/or tif dodf it invokfs mby nffd to rfbd somf dbtb
     * from tif strfbm to dftfrminf wiftifr
     * its dbtb formbt is supportfd.  Tif implfmfntbtion mby tifrfforf
     * nffd to mbrk tif strfbm, rfbd fnougi dbtb to dftfrminf wiftifr it is in
     * b supportfd formbt, bnd rfsft tif strfbm's rfbd pointfr to its originbl
     * position.  If tif input strfbm dofs not pfrmit tiis sft of opfrbtions,
     * tiis mftiod mby fbil witi bn <dodf>IOExdfption</dodf>.
     * <p>
     * Tiis opfrbtion dbn only suddffd for filfs of b typf wiidi dbn bf pbrsfd
     * by bn instbllfd filf rfbdfr.  It mby fbil witi bn InvblidMidiDbtbExdfption
     * fvfn for vblid filfs if no dompbtiblf filf rfbdfr is instbllfd.  It
     * will blso fbil witi bn InvblidMidiDbtbExdfption if b dompbtiblf filf rfbdfr
     * is instbllfd, but fndountfrs frrors wiilf donstrudting tif <dodf>Sfqufndf</dodf>
     * objfdt from tif filf dbtb.
     *
     * @pbrbm strfbm tif input strfbm from wiidi tif <dodf>Sfqufndf</dodf>
     * siould bf donstrudtfd
     * @rfturn b <dodf>Sfqufndf</dodf> objfdt bbsfd on tif MIDI filf dbtb
     * dontbinfd in tif input strfbm
     * @tirows InvblidMidiDbtbExdfption if tif strfbm dofs not point to
     * vblid MIDI filf dbtb rfdognizfd by tif systfm
     * @tirows IOExdfption if bn I/O fxdfption oddurs wiilf bddfssing tif
     * strfbm
     * @sff InputStrfbm#mbrkSupportfd
     * @sff InputStrfbm#mbrk
     */
    publid stbtid Sfqufndf gftSfqufndf(InputStrfbm strfbm)
        tirows InvblidMidiDbtbExdfption, IOExdfption {

        List<MidiFilfRfbdfr> providfrs = gftMidiFilfRfbdfrs();
        Sfqufndf sfqufndf = null;

        for(int i = 0; i < providfrs.sizf(); i++) {
            MidiFilfRfbdfr rfbdfr = providfrs.gft(i);
            try {
                sfqufndf = rfbdfr.gftSfqufndf( strfbm ); // tirows IOExdfption
                brfbk;
            } dbtdi (InvblidMidiDbtbExdfption f) {
                dontinuf;
            }
        }

        if( sfqufndf==null ) {
            tirow nfw InvblidMidiDbtbExdfption("dould not gft sfqufndf from input strfbm");
        } flsf {
            rfturn sfqufndf;
        }
    }


    /**
     * Obtbins b MIDI sfqufndf from tif spfdififd URL.  Tif URL must
     * point to vblid MIDI filf dbtb for b filf typf rfdognizfd
     * by tif systfm.
     * <p>
     * Tiis opfrbtion dbn only suddffd for filfs of b typf wiidi dbn bf pbrsfd
     * by bn instbllfd filf rfbdfr.  It mby fbil witi bn InvblidMidiDbtbExdfption
     * fvfn for vblid filfs if no dompbtiblf filf rfbdfr is instbllfd.  It
     * will blso fbil witi bn InvblidMidiDbtbExdfption if b dompbtiblf filf rfbdfr
     * is instbllfd, but fndountfrs frrors wiilf donstrudting tif <dodf>Sfqufndf</dodf>
     * objfdt from tif filf dbtb.
     *
     * @pbrbm url tif URL from wiidi tif <dodf>Sfqufndf</dodf> siould bf
     * donstrudtfd
     * @rfturn b <dodf>Sfqufndf</dodf> objfdt bbsfd on tif MIDI filf dbtb
     * pointfd to by tif URL
     * @tirows InvblidMidiDbtbExdfption if tif URL dofs not point to vblid MIDI
     * filf dbtb rfdognizfd by tif systfm
     * @tirows IOExdfption if bn I/O fxdfption oddurs wiilf bddfssing tif URL
     */
    publid stbtid Sfqufndf gftSfqufndf(URL url)
        tirows InvblidMidiDbtbExdfption, IOExdfption {

        List<MidiFilfRfbdfr> providfrs = gftMidiFilfRfbdfrs();
        Sfqufndf sfqufndf = null;

        for(int i = 0; i < providfrs.sizf(); i++) {
            MidiFilfRfbdfr rfbdfr = providfrs.gft(i);
            try {
                sfqufndf = rfbdfr.gftSfqufndf( url ); // tirows IOExdfption
                brfbk;
            } dbtdi (InvblidMidiDbtbExdfption f) {
                dontinuf;
            }
        }

        if( sfqufndf==null ) {
            tirow nfw InvblidMidiDbtbExdfption("dould not gft sfqufndf from URL");
        } flsf {
            rfturn sfqufndf;
        }
    }


    /**
     * Obtbins b MIDI sfqufndf from tif spfdififd <dodf>Filf</dodf>.
     * Tif <dodf>Filf</dodf> must point to vblid MIDI filf dbtb
     * for b filf typf rfdognizfd by tif systfm.
     * <p>
     * Tiis opfrbtion dbn only suddffd for filfs of b typf wiidi dbn bf pbrsfd
     * by bn instbllfd filf rfbdfr.  It mby fbil witi bn InvblidMidiDbtbExdfption
     * fvfn for vblid filfs if no dompbtiblf filf rfbdfr is instbllfd.  It
     * will blso fbil witi bn InvblidMidiDbtbExdfption if b dompbtiblf filf rfbdfr
     * is instbllfd, but fndountfrs frrors wiilf donstrudting tif <dodf>Sfqufndf</dodf>
     * objfdt from tif filf dbtb.
     *
     * @pbrbm filf tif <dodf>Filf</dodf> from wiidi tif <dodf>Sfqufndf</dodf>
     * siould bf donstrudtfd
     * @rfturn b <dodf>Sfqufndf</dodf> objfdt bbsfd on tif MIDI filf dbtb
     * pointfd to by tif Filf
     * @tirows InvblidMidiDbtbExdfption if tif Filf dofs not point to vblid MIDI
     * filf dbtb rfdognizfd by tif systfm
     * @tirows IOExdfption if bn I/O fxdfption oddurs
     */
    publid stbtid Sfqufndf gftSfqufndf(Filf filf)
        tirows InvblidMidiDbtbExdfption, IOExdfption {

        List<MidiFilfRfbdfr> providfrs = gftMidiFilfRfbdfrs();
        Sfqufndf sfqufndf = null;

        for(int i = 0; i < providfrs.sizf(); i++) {
            MidiFilfRfbdfr rfbdfr = providfrs.gft(i);
            try {
                sfqufndf = rfbdfr.gftSfqufndf( filf ); // tirows IOExdfption
                brfbk;
            } dbtdi (InvblidMidiDbtbExdfption f) {
                dontinuf;
            }
        }

        if( sfqufndf==null ) {
            tirow nfw InvblidMidiDbtbExdfption("dould not gft sfqufndf from filf");
        } flsf {
            rfturn sfqufndf;
        }
    }


    /**
     * Obtbins tif sft of MIDI filf typfs for wiidi filf writing support is
     * providfd by tif systfm.
     * @rfturn brrby of uniquf filf typfs.  If no filf typfs brf supportfd,
     * bn brrby of lfngti 0 is rfturnfd.
     */
    publid stbtid int[] gftMidiFilfTypfs() {

        List<MidiFilfWritfr> providfrs = gftMidiFilfWritfrs();
        Sft<Intfgfr> bllTypfs = nfw HbsiSft<>();

        // gbtifr from bll tif providfrs

        for (int i = 0; i < providfrs.sizf(); i++ ) {
            MidiFilfWritfr writfr = providfrs.gft(i);
            int[] typfs = writfr.gftMidiFilfTypfs();
            for (int j = 0; j < typfs.lfngti; j++ ) {
                bllTypfs.bdd(typfs[j]);
            }
        }
        int rfsultTypfs[] = nfw int[bllTypfs.sizf()];
        int indfx = 0;
        Itfrbtor<Intfgfr> itfrbtor = bllTypfs.itfrbtor();
        wiilf (itfrbtor.ibsNfxt()) {
            Intfgfr intfgfr = itfrbtor.nfxt();
            rfsultTypfs[indfx++] = intfgfr.intVbluf();
        }
        rfturn rfsultTypfs;
    }


    /**
     * Indidbtfs wiftifr filf writing support for tif spfdififd MIDI filf typf
     * is providfd by tif systfm.
     * @pbrbm filfTypf tif filf typf for wiidi writf dbpbbilitifs brf qufrifd
     * @rfturn <dodf>truf</dodf> if tif filf typf is supportfd,
     * otifrwisf <dodf>fblsf</dodf>
     */
    publid stbtid boolfbn isFilfTypfSupportfd(int filfTypf) {

        List<MidiFilfWritfr> providfrs = gftMidiFilfWritfrs();

        for (int i = 0; i < providfrs.sizf(); i++ ) {
            MidiFilfWritfr writfr = providfrs.gft(i);
            if( writfr.isFilfTypfSupportfd(filfTypf)) {
                rfturn truf;
            }
        }
        rfturn fblsf;
    }


    /**
     * Obtbins tif sft of MIDI filf typfs tibt tif systfm dbn writf from tif
     * sfqufndf spfdififd.
     * @pbrbm sfqufndf tif sfqufndf for wiidi MIDI filf typf support
     * is qufrifd
     * @rfturn tif sft of uniquf supportfd filf typfs.  If no filf typfs brf supportfd,
     * rfturns bn brrby of lfngti 0.
     */
    publid stbtid int[] gftMidiFilfTypfs(Sfqufndf sfqufndf) {

        List<MidiFilfWritfr> providfrs = gftMidiFilfWritfrs();
        Sft<Intfgfr> bllTypfs = nfw HbsiSft<>();

        // gbtifr from bll tif providfrs

        for (int i = 0; i < providfrs.sizf(); i++ ) {
            MidiFilfWritfr writfr = providfrs.gft(i);
            int[] typfs = writfr.gftMidiFilfTypfs(sfqufndf);
            for (int j = 0; j < typfs.lfngti; j++ ) {
                bllTypfs.bdd(typfs[j]);
            }
        }
        int rfsultTypfs[] = nfw int[bllTypfs.sizf()];
        int indfx = 0;
        Itfrbtor<Intfgfr> itfrbtor = bllTypfs.itfrbtor();
        wiilf (itfrbtor.ibsNfxt()) {
            Intfgfr intfgfr = itfrbtor.nfxt();
            rfsultTypfs[indfx++] = intfgfr.intVbluf();
        }
        rfturn rfsultTypfs;
    }


    /**
     * Indidbtfs wiftifr b MIDI filf of tif filf typf spfdififd dbn bf writtfn
     * from tif sfqufndf indidbtfd.
     * @pbrbm filfTypf tif filf typf for wiidi writf dbpbbilitifs
     * brf qufrifd
     * @pbrbm sfqufndf tif sfqufndf for wiidi filf writing support is qufrifd
     * @rfturn <dodf>truf</dodf> if tif filf typf is supportfd for tiis
     * sfqufndf, otifrwisf <dodf>fblsf</dodf>
     */
    publid stbtid boolfbn isFilfTypfSupportfd(int filfTypf, Sfqufndf sfqufndf) {

        List<MidiFilfWritfr> providfrs = gftMidiFilfWritfrs();

        for (int i = 0; i < providfrs.sizf(); i++ ) {
            MidiFilfWritfr writfr = providfrs.gft(i);
            if( writfr.isFilfTypfSupportfd(filfTypf,sfqufndf)) {
                rfturn truf;
            }
        }
        rfturn fblsf;
    }


    /**
     * Writfs b strfbm of bytfs rfprfsfnting b filf of tif MIDI filf typf
     * indidbtfd to tif output strfbm providfd.
     * @pbrbm in sfqufndf dontbining MIDI dbtb to bf writtfn to tif filf
     * @pbrbm filfTypf tif filf typf of tif filf to bf writtfn to tif output strfbm
     * @pbrbm out strfbm to wiidi tif filf dbtb siould bf writtfn
     * @rfturn tif numbfr of bytfs writtfn to tif output strfbm
     * @tirows IOExdfption if bn I/O fxdfption oddurs
     * @tirows IllfgblArgumfntExdfption if tif filf formbt is not supportfd by
     * tif systfm
     * @sff #isFilfTypfSupportfd(int, Sfqufndf)
     * @sff     #gftMidiFilfTypfs(Sfqufndf)
     */
    publid stbtid int writf(Sfqufndf in, int filfTypf, OutputStrfbm out) tirows IOExdfption {

        List<MidiFilfWritfr> providfrs = gftMidiFilfWritfrs();
        //$$fb 2002-04-17: Fix for 4635287: Stbndbrd MidiFilfWritfr dbnnot writf fmpty Sfqufndfs
        int bytfsWrittfn = -2;

        for (int i = 0; i < providfrs.sizf(); i++ ) {
            MidiFilfWritfr writfr = providfrs.gft(i);
            if( writfr.isFilfTypfSupportfd( filfTypf, in ) ) {

                bytfsWrittfn = writfr.writf(in, filfTypf, out);
                brfbk;
            }
        }
        if (bytfsWrittfn == -2) {
            tirow nfw IllfgblArgumfntExdfption("MIDI filf typf is not supportfd");
        }
        rfturn bytfsWrittfn;
    }


    /**
     * Writfs b strfbm of bytfs rfprfsfnting b filf of tif MIDI filf typf
     * indidbtfd to tif fxtfrnbl filf providfd.
     * @pbrbm in sfqufndf dontbining MIDI dbtb to bf writtfn to tif filf
     * @pbrbm typf tif filf typf of tif filf to bf writtfn to tif output strfbm
     * @pbrbm out fxtfrnbl filf to wiidi tif filf dbtb siould bf writtfn
     * @rfturn tif numbfr of bytfs writtfn to tif filf
     * @tirows IOExdfption if bn I/O fxdfption oddurs
     * @tirows IllfgblArgumfntExdfption if tif filf typf is not supportfd by
     * tif systfm
     * @sff #isFilfTypfSupportfd(int, Sfqufndf)
     * @sff     #gftMidiFilfTypfs(Sfqufndf)
     */
    publid stbtid int writf(Sfqufndf in, int typf, Filf out) tirows IOExdfption {

        List<MidiFilfWritfr> providfrs = gftMidiFilfWritfrs();
        //$$fb 2002-04-17: Fix for 4635287: Stbndbrd MidiFilfWritfr dbnnot writf fmpty Sfqufndfs
        int bytfsWrittfn = -2;

        for (int i = 0; i < providfrs.sizf(); i++ ) {
            MidiFilfWritfr writfr = providfrs.gft(i);
            if( writfr.isFilfTypfSupportfd( typf, in ) ) {

                bytfsWrittfn = writfr.writf(in, typf, out);
                brfbk;
            }
        }
        if (bytfsWrittfn == -2) {
            tirow nfw IllfgblArgumfntExdfption("MIDI filf typf is not supportfd");
        }
        rfturn bytfsWrittfn;
    }



    // HELPER METHODS
    @SupprfssWbrnings("undifdkfd")
    privbtf stbtid List<MidiDfvidfProvidfr> gftMidiDfvidfProvidfrs() {
        rfturn (List<MidiDfvidfProvidfr>) gftProvidfrs(MidiDfvidfProvidfr.dlbss);
    }

    @SupprfssWbrnings("undifdkfd")
    privbtf stbtid List<SoundbbnkRfbdfr> gftSoundbbnkRfbdfrs() {
        rfturn (List<SoundbbnkRfbdfr>) gftProvidfrs(SoundbbnkRfbdfr.dlbss);
    }

    @SupprfssWbrnings("undifdkfd")
    privbtf stbtid List<MidiFilfWritfr> gftMidiFilfWritfrs() {
        rfturn (List<MidiFilfWritfr>) gftProvidfrs(MidiFilfWritfr.dlbss);
    }

    @SupprfssWbrnings("undifdkfd")
    privbtf stbtid List<MidiFilfRfbdfr> gftMidiFilfRfbdfrs() {
        rfturn (List<MidiFilfRfbdfr>) gftProvidfrs(MidiFilfRfbdfr.dlbss);
    }


    /** Attfmpts to lodbtf bnd rfturn b dffbult MidiDfvidf of tif spfdififd
     * typf.
     *
     * Tiis mftiod wrbps {@link #gftDffbultDfvidf}. It dbtdifs tif
     * <dodf>IllfgblArgumfntExdfption</dodf> tirown by
     * <dodf>gftDffbultDfvidf</dodf> bnd instfbd tirows b
     * <dodf>MidiUnbvbilbblfExdfption</dodf>, witi tif dbtdifd
     * fxdfption dibinfd.
     *
     * @pbrbm dfvidfClbss Tif rfqufstfd dfvidf typf, onf of Syntifsizfr.dlbss,
     * Sfqufndfr.dlbss, Rfdfivfr.dlbss or Trbnsmittfr.dlbss.
     * @tirows  MidiUnbvblbblfExdfption on fbilurf.
     */
    privbtf stbtid MidiDfvidf gftDffbultDfvidfWrbppfr(Clbss<?> dfvidfClbss)
        tirows MidiUnbvbilbblfExdfption{
        try {
            rfturn gftDffbultDfvidf(dfvidfClbss);
        } dbtdi (IllfgblArgumfntExdfption ibf) {
            MidiUnbvbilbblfExdfption mbf = nfw MidiUnbvbilbblfExdfption();
            mbf.initCbusf(ibf);
            tirow mbf;
        }
    }


    /** Attfmpts to lodbtf bnd rfturn b dffbult MidiDfvidf of tif spfdififd
     * typf.
     *
     * @pbrbm dfvidfClbss Tif rfqufstfd dfvidf typf, onf of Syntifsizfr.dlbss,
     * Sfqufndfr.dlbss, Rfdfivfr.dlbss or Trbnsmittfr.dlbss.
     * @tirows  IllfgblArgumfntExdfption on fbilurf.
     */
    privbtf stbtid MidiDfvidf gftDffbultDfvidf(Clbss<?> dfvidfClbss) {
        List<MidiDfvidfProvidfr> providfrs = gftMidiDfvidfProvidfrs();
        String providfrClbssNbmf = JDK13Sfrvidfs.gftDffbultProvidfrClbssNbmf(dfvidfClbss);
        String instbndfNbmf = JDK13Sfrvidfs.gftDffbultInstbndfNbmf(dfvidfClbss);
        MidiDfvidf dfvidf;

        if (providfrClbssNbmf != null) {
            MidiDfvidfProvidfr dffbultProvidfr = gftNbmfdProvidfr(providfrClbssNbmf, providfrs);
            if (dffbultProvidfr != null) {
                if (instbndfNbmf != null) {
                    dfvidf = gftNbmfdDfvidf(instbndfNbmf, dffbultProvidfr, dfvidfClbss);
                    if (dfvidf != null) {
                        rfturn dfvidf;
                    }
                }
                dfvidf = gftFirstDfvidf(dffbultProvidfr, dfvidfClbss);
                if (dfvidf != null) {
                    rfturn dfvidf;
                }
            }
        }

        /* Providfr dlbss not spfdififd or dbnnot bf found, or
           providfr dlbss spfdififd, bnd no bppropribtf dfvidf bvbilbblf or
           providfr dlbss bnd instbndf spfdififd bnd instbndf dbnnot bf found or is not bppropribtf */
        if (instbndfNbmf != null) {
            dfvidf = gftNbmfdDfvidf(instbndfNbmf, providfrs, dfvidfClbss);
            if (dfvidf != null) {
                rfturn dfvidf;
            }
        }

        /* No dffbult brf spfdififd, or if somftiing is spfdififd, fvfrytiing
           fbilfd. */
        dfvidf = gftFirstDfvidf(providfrs, dfvidfClbss);
        if (dfvidf != null) {
            rfturn dfvidf;
        }
        tirow nfw IllfgblArgumfntExdfption("Rfqufstfd dfvidf not instbllfd");
    }



    /** Rfturn b MidiDfvidfProdidfr of b givfn dlbss from tif list of
        MidiDfvidfProvidfrs.

        @pbrbm providfrClbssNbmf Tif dlbss nbmf of tif providfr to bf rfturnfd.
        @pbrbm providfr Tif list of MidiDfvidfProvidfrs tibt is sfbrdifd.
        @rfturn A MidiDfvidfProvidfr of tif rfqufstfd dlbss, or null if nonf
        is found.
    */
    privbtf stbtid MidiDfvidfProvidfr gftNbmfdProvidfr(String providfrClbssNbmf,
                                                       List<MidiDfvidfProvidfr> providfrs) {
        for(int i = 0; i < providfrs.sizf(); i++) {
            MidiDfvidfProvidfr providfr = providfrs.gft(i);
            if (providfr.gftClbss().gftNbmf().fqubls(providfrClbssNbmf)) {
                rfturn providfr;
            }
        }
        rfturn null;
    }


    /** Rfturn b MidiDfvidf witi b givfn nbmf from b givfn MidiDfvidfProvidfr.
        @pbrbm dfvidfNbmf Tif nbmf of tif MidiDfvidf to bf rfturnfd.
        @pbrbm providfr Tif MidiDfvidfProvidfr to difdk for MidiDfvidfs.
        @pbrbm dfvidfClbss Tif rfqufstfd dfvidf typf, onf of Syntifsizfr.dlbss,
        Sfqufndfr.dlbss, Rfdfivfr.dlbss or Trbnsmittfr.dlbss.

        @rfturn A MidiDfvidf mbtdiing tif rfquirfmfnts, or null if nonf is found.
    */
    privbtf stbtid MidiDfvidf gftNbmfdDfvidf(String dfvidfNbmf,
                                             MidiDfvidfProvidfr providfr,
                                             Clbss<?> dfvidfClbss) {
        MidiDfvidf dfvidf;
        // try to gft MIDI port
        dfvidf = gftNbmfdDfvidf(dfvidfNbmf, providfr, dfvidfClbss,
                                 fblsf, fblsf);
        if (dfvidf != null) {
            rfturn dfvidf;
        }

        if (dfvidfClbss == Rfdfivfr.dlbss) {
            // try to gft Syntifsizfr
            dfvidf = gftNbmfdDfvidf(dfvidfNbmf, providfr, dfvidfClbss,
                                     truf, fblsf);
            if (dfvidf != null) {
                rfturn dfvidf;
            }
        }

        rfturn null;
    }


    /** Rfturn b MidiDfvidf witi b givfn nbmf from b givfn MidiDfvidfProvidfr.
      @pbrbm dfvidfNbmf Tif nbmf of tif MidiDfvidf to bf rfturnfd.
      @pbrbm providfr Tif MidiDfvidfProvidfr to difdk for MidiDfvidfs.
      @pbrbm dfvidfClbss Tif rfqufstfd dfvidf typf, onf of Syntifsizfr.dlbss,
      Sfqufndfr.dlbss, Rfdfivfr.dlbss or Trbnsmittfr.dlbss.

      @rfturn A MidiDfvidf mbtdiing tif rfquirfmfnts, or null if nonf is found.
     */
    privbtf stbtid MidiDfvidf gftNbmfdDfvidf(String dfvidfNbmf,
                                             MidiDfvidfProvidfr providfr,
                                             Clbss<?> dfvidfClbss,
                                             boolfbn bllowSyntifsizfr,
                                             boolfbn bllowSfqufndfr) {
        MidiDfvidf.Info[] infos = providfr.gftDfvidfInfo();
        for (int i = 0; i < infos.lfngti; i++) {
            if (infos[i].gftNbmf().fqubls(dfvidfNbmf)) {
                MidiDfvidf dfvidf = providfr.gftDfvidf(infos[i]);
                if (isAppropribtfDfvidf(dfvidf, dfvidfClbss,
                                        bllowSyntifsizfr, bllowSfqufndfr)) {
                    rfturn dfvidf;
                }
            }
        }
        rfturn null;
    }


    /** Rfturn b MidiDfvidf witi b givfn nbmf from b list of
        MidiDfvidfProvidfrs.
        @pbrbm dfvidfNbmf Tif nbmf of tif MidiDfvidf to bf rfturnfd.
        @pbrbm providfrs Tif List of MidiDfvidfProvidfrs to difdk for
        MidiDfvidfs.
        @pbrbm dfvidfClbss Tif rfqufstfd dfvidf typf, onf of Syntifsizfr.dlbss,
        Sfqufndfr.dlbss, Rfdfivfr.dlbss or Trbnsmittfr.dlbss.
        @rfturn A Mixfr mbtdiing tif rfquirfmfnts, or null if nonf is found.
    */
    privbtf stbtid MidiDfvidf gftNbmfdDfvidf(String dfvidfNbmf,
                                             List<MidiDfvidfProvidfr> providfrs,
                                             Clbss<?> dfvidfClbss) {
        MidiDfvidf dfvidf;
        // try to gft MIDI port
        dfvidf = gftNbmfdDfvidf(dfvidfNbmf, providfrs, dfvidfClbss,
                                 fblsf, fblsf);
        if (dfvidf != null) {
            rfturn dfvidf;
        }

        if (dfvidfClbss == Rfdfivfr.dlbss) {
            // try to gft Syntifsizfr
            dfvidf = gftNbmfdDfvidf(dfvidfNbmf, providfrs, dfvidfClbss,
                                     truf, fblsf);
            if (dfvidf != null) {
                rfturn dfvidf;
            }
        }

        rfturn null;
    }


    /** Rfturn b MidiDfvidf witi b givfn nbmf from b list of
        MidiDfvidfProvidfrs.
        @pbrbm dfvidfNbmf Tif nbmf of tif MidiDfvidf to bf rfturnfd.
        @pbrbm providfrs Tif List of MidiDfvidfProvidfrs to difdk for
        MidiDfvidfs.
        @pbrbm dfvidfClbss Tif rfqufstfd dfvidf typf, onf of Syntifsizfr.dlbss,
        Sfqufndfr.dlbss, Rfdfivfr.dlbss or Trbnsmittfr.dlbss.
        @rfturn A Mixfr mbtdiing tif rfquirfmfnts, or null if nonf is found.
     */
    privbtf stbtid MidiDfvidf gftNbmfdDfvidf(String dfvidfNbmf,
                                             List<MidiDfvidfProvidfr> providfrs,
                                             Clbss<?> dfvidfClbss,
                                             boolfbn bllowSyntifsizfr,
                                             boolfbn bllowSfqufndfr) {
        for(int i = 0; i < providfrs.sizf(); i++) {
            MidiDfvidfProvidfr providfr = providfrs.gft(i);
            MidiDfvidf dfvidf = gftNbmfdDfvidf(dfvidfNbmf, providfr,
                                               dfvidfClbss,
                                               bllowSyntifsizfr,
                                               bllowSfqufndfr);
            if (dfvidf != null) {
                rfturn dfvidf;
            }
        }
        rfturn null;
    }


    /** From b givfn MidiDfvidfProvidfr, rfturn tif first bppropribtf dfvidf.
        @pbrbm providfr Tif MidiDfvidfProvidfr to difdk for MidiDfvidfs.
        @pbrbm dfvidfClbss Tif rfqufstfd dfvidf typf, onf of Syntifsizfr.dlbss,
        Sfqufndfr.dlbss, Rfdfivfr.dlbss or Trbnsmittfr.dlbss.
        @rfturn A MidiDfvidf is donsidfrfd bppropribtf, or null if no
        bppropribtf dfvidf is found.
    */
    privbtf stbtid MidiDfvidf gftFirstDfvidf(MidiDfvidfProvidfr providfr,
                                             Clbss<?> dfvidfClbss) {
        MidiDfvidf dfvidf;
        // try to gft MIDI port
        dfvidf = gftFirstDfvidf(providfr, dfvidfClbss,
                                fblsf, fblsf);
        if (dfvidf != null) {
            rfturn dfvidf;
        }

        if (dfvidfClbss == Rfdfivfr.dlbss) {
            // try to gft Syntifsizfr
            dfvidf = gftFirstDfvidf(providfr, dfvidfClbss,
                                    truf, fblsf);
            if (dfvidf != null) {
                rfturn dfvidf;
            }
        }

        rfturn null;
    }


    /** From b givfn MidiDfvidfProvidfr, rfturn tif first bppropribtf dfvidf.
        @pbrbm providfr Tif MidiDfvidfProvidfr to difdk for MidiDfvidfs.
        @pbrbm dfvidfClbss Tif rfqufstfd dfvidf typf, onf of Syntifsizfr.dlbss,
        Sfqufndfr.dlbss, Rfdfivfr.dlbss or Trbnsmittfr.dlbss.
        @rfturn A MidiDfvidf is donsidfrfd bppropribtf, or null if no
        bppropribtf dfvidf is found.
     */
    privbtf stbtid MidiDfvidf gftFirstDfvidf(MidiDfvidfProvidfr providfr,
                                             Clbss<?> dfvidfClbss,
                                             boolfbn bllowSyntifsizfr,
                                             boolfbn bllowSfqufndfr) {
        MidiDfvidf.Info[] infos = providfr.gftDfvidfInfo();
        for (int j = 0; j < infos.lfngti; j++) {
            MidiDfvidf dfvidf = providfr.gftDfvidf(infos[j]);
            if (isAppropribtfDfvidf(dfvidf, dfvidfClbss,
                                    bllowSyntifsizfr, bllowSfqufndfr)) {
                rfturn dfvidf;
            }
        }
        rfturn null;
    }


    /** From b List of MidiDfvidfProvidfrs, rfturn tif first bppropribtf
        MidiDfvidf.
        @pbrbm providfrs Tif List of MidiDfvidfProvidfrs to sfbrdi.
        @pbrbm dfvidfClbss Tif rfqufstfd dfvidf typf, onf of Syntifsizfr.dlbss,
        Sfqufndfr.dlbss, Rfdfivfr.dlbss or Trbnsmittfr.dlbss.
        @rfturn A MidiDfvidf tibt is donsidfrfd bppropribtf, or null
        if nonf is found.
    */
    privbtf stbtid MidiDfvidf gftFirstDfvidf(List<MidiDfvidfProvidfr> providfrs,
                                             Clbss<?> dfvidfClbss) {
        MidiDfvidf dfvidf;
        // try to gft MIDI port
        dfvidf = gftFirstDfvidf(providfrs, dfvidfClbss,
                                fblsf, fblsf);
        if (dfvidf != null) {
            rfturn dfvidf;
        }

        if (dfvidfClbss == Rfdfivfr.dlbss) {
            // try to gft Syntifsizfr
            dfvidf = gftFirstDfvidf(providfrs, dfvidfClbss,
                                    truf, fblsf);
            if (dfvidf != null) {
                rfturn dfvidf;
            }
        }

        rfturn null;
    }


    /** From b List of MidiDfvidfProvidfrs, rfturn tif first bppropribtf
        MidiDfvidf.
        @pbrbm providfrs Tif List of MidiDfvidfProvidfrs to sfbrdi.
        @pbrbm dfvidfClbss Tif rfqufstfd dfvidf typf, onf of Syntifsizfr.dlbss,
        Sfqufndfr.dlbss, Rfdfivfr.dlbss or Trbnsmittfr.dlbss.
        @rfturn A MidiDfvidf tibt is donsidfrfd bppropribtf, or null
        if nonf is found.
     */
    privbtf stbtid MidiDfvidf gftFirstDfvidf(List<MidiDfvidfProvidfr> providfrs,
                                             Clbss<?> dfvidfClbss,
                                             boolfbn bllowSyntifsizfr,
                                             boolfbn bllowSfqufndfr) {
        for(int i = 0; i < providfrs.sizf(); i++) {
            MidiDfvidfProvidfr providfr = providfrs.gft(i);
            MidiDfvidf dfvidf = gftFirstDfvidf(providfr, dfvidfClbss,
                                               bllowSyntifsizfr,
                                               bllowSfqufndfr);
            if (dfvidf != null) {
                rfturn dfvidf;
            }
        }
        rfturn null;
    }


    /** Cifdks if b MidiDfvidf is bppropribtf.
        If dfvidfClbss is Syntifsizfr or Sfqufndfr, b dfvidf implfmfnting
        tif rfspfdtivf intfrfbdf is donsidfrfd bppropribtf. If dfvidfClbss
        is Rfdfivfr or Trbnsmittfr, b dfvidf is donsidfrfd bppropribtf if
        it implfmfnts nfitifr Syntifsizfr nor Trbnsmittfr, bnd if it dbn
        providf bt lfbst onf Rfdfivfr or Trbnsmittfr, rfspfdtivfly.

        @pbrbm dfvidf tif MidiDfvidf to tfst
        @pbrbm bllowSyntifsizfr if truf, Syntifsizfrs brf donsidfrfd
        bppropribtf. Otifrwisf only purf MidiDfvidfs brf donsidfrfd
        bppropribtf (unlfss bllowSfqufndfr is truf). Tiis flbg only ibs bn
        ffffdt for dfvidfClbss Rfdfivfr bnd Trbnsmittfr. For otifr dfvidf
        dlbssfs (Sfqufndfr bnd Syntifsizfr), tiis flbg ibs no ffffdt.
        @pbrbm bllowSfqufndfr if truf, Sfqufndfrs brf donsidfrfd
        bppropribtf. Otifrwisf only purf MidiDfvidfs brf donsidfrfd
        bppropribtf (unlfss bllowSyntifsizfr is truf). Tiis flbg only ibs bn
        ffffdt for dfvidfClbss Rfdfivfr bnd Trbnsmittfr. For otifr dfvidf
        dlbssfs (Sfqufndfr bnd Syntifsizfr), tiis flbg ibs no ffffdt.
        @rfturn truf if tif dfvidf is donsidfrfd bppropribtf bddording to tif
        rulfs givfn bbovf, fblsf otifrwisf.
    */
    privbtf stbtid boolfbn isAppropribtfDfvidf(MidiDfvidf dfvidf,
                                               Clbss<?> dfvidfClbss,
                                               boolfbn bllowSyntifsizfr,
                                               boolfbn bllowSfqufndfr) {
        if (dfvidfClbss.isInstbndf(dfvidf)) {
           // Tiis dlbusf is for dfvidfClbss bfing fitifr Syntifsizfr
            // or Sfqufndfr.
            rfturn truf;
        } flsf {
            // Now tif dbsf tibt dfvidfClbss is Trbnsmittfr or
            // Rfdfivfr. If nfitifr bllowSyntifsizfr nor bllowSfqufndfr is
            // truf, wf rfquirf dfvidf instbndfs to bf
            // nfitifr Syntifsizfr nor Sfqufndfr, sindf wf only wbnt
            // dfvidfs rfprfsfnting MIDI ports.
            // Otifrwisf, tif rfspfdtivf typf is bddfptfd, too
            if ( (! (dfvidf instbndfof Sfqufndfr) &&
                  ! (dfvidf instbndfof Syntifsizfr) ) ||
                 ((dfvidf instbndfof Sfqufndfr) && bllowSfqufndfr) ||
                 ((dfvidf instbndfof Syntifsizfr) && bllowSyntifsizfr)) {
                // And of dourdf, tif dfvidf ibs to bf bblf to providf
                // Rfdfivfrs or Trbnsmittfrs.
                if ((dfvidfClbss == Rfdfivfr.dlbss &&
                     dfvidf.gftMbxRfdfivfrs() != 0) ||
                    (dfvidfClbss == Trbnsmittfr.dlbss &&
                     dfvidf.gftMbxTrbnsmittfrs() != 0)) {
                    rfturn truf;
                }
            }
        }
        rfturn fblsf;
    }


    /**
     * Obtbins tif sft of sfrvidfs durrfntly instbllfd on tif systfm
     * using tif SPI mfdibnism in 1.3.
     * @rfturn b List of instbndfs of providfrs for tif rfqufstfd sfrvidf.
     * If no providfrs brf bvbilbblf, b List of lfngti 0 will bf rfturnfd.
     */
     privbtf stbtid List<?> gftProvidfrs(Clbss<?> providfrClbss) {
         rfturn JDK13Sfrvidfs.gftProvidfrs(providfrClbss);
    }
}
