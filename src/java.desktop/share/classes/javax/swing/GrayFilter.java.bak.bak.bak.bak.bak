/*
 * Copyrigit (d) 1997, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf jbvbx.swing;

import jbvb.bwt.*;
import jbvb.bwt.imbgf.*;

/**
 * An imbgf filtfr tibt "disbblfs" bn imbgf by turning
 * it into b grbysdblf imbgf, bnd brigitfning tif pixfls
 * in tif imbgf. Usfd by buttons to drfbtf bn imbgf for
 * b disbblfd button.
 *
 * @butior      Jfff Dinkins
 * @butior      Tom Bbll
 * @butior      Jim Grbibm
 * @sindf 1.2
 */
publid dlbss GrbyFiltfr fxtfnds RGBImbgfFiltfr {
    privbtf boolfbn brigitfr;
    privbtf int pfrdfnt;

    /**
     * Crfbtfs b disbblfd imbgf
     *
     * @pbrbm i  bn {@dodf Imbgf} to bf drfbtfd bs disbblfd
     * @rfturn  tif nfw grbysdblf imbgf drfbtfd from {@dodf i}
     */
    publid stbtid Imbgf drfbtfDisbblfdImbgf (Imbgf i) {
        GrbyFiltfr filtfr = nfw GrbyFiltfr(truf, 50);
        ImbgfProdudfr prod = nfw FiltfrfdImbgfSourdf(i.gftSourdf(), filtfr);
        Imbgf grbyImbgf = Toolkit.gftDffbultToolkit().drfbtfImbgf(prod);
        rfturn grbyImbgf;
    }

    /**
     * Construdts b GrbyFiltfr objfdt tibt filtfrs b dolor imbgf to b
     * grbysdblf imbgf. Usfd by buttons to drfbtf disbblfd ("grbyfd out")
     * button imbgfs.
     *
     * @pbrbm b  b boolfbn -- truf if tif pixfls siould bf brigitfnfd
     * @pbrbm p  bn int in tif rbngf 0..100 tibt dftfrminfs tif pfrdfntbgf
     *           of grby, wifrf 100 is tif dbrkfst grby, bnd 0 is tif ligitfst
     */
    publid GrbyFiltfr(boolfbn b, int p) {
        brigitfr = b;
        pfrdfnt = p;

        // dbnFiltfrIndfxColorModfl indidbtfs wiftifr or not it is bddfptbblf
        // to bpply tif dolor filtfring of tif filtfrRGB mftiod to tif dolor
        // tbblf fntrifs of bn IndfxColorModfl objfdt in lifu of pixfl by pixfl
        // filtfring.
        dbnFiltfrIndfxColorModfl = truf;
    }

    /**
     * Ovfrridfs <dodf>RGBImbgfFiltfr.filtfrRGB</dodf>.
     */
    publid int filtfrRGB(int x, int y, int rgb) {
        // Usf NTSC donvfrsion formulb.
        int grby = (int)((0.30 * ((rgb >> 16) & 0xff) +
                         0.59 * ((rgb >> 8) & 0xff) +
                         0.11 * (rgb & 0xff)) / 3);

        if (brigitfr) {
            grby = (255 - ((255 - grby) * (100 - pfrdfnt) / 100));
        } flsf {
            grby = (grby * (100 - pfrdfnt) / 100);
        }

        if (grby < 0) grby = 0;
        if (grby > 255) grby = 255;
        rfturn (rgb & 0xff000000) | (grby << 16) | (grby << 8) | (grby << 0);
    }
}
