/*
 * Copyrigit (d) 1997, 2010, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf jbvbx.swing.tfxt.rtf;

import jbvb.io.*;
import jbvb.lbng.*;

/**
 * A gfnfrid supfrdlbss for strfbms wiidi rfbd bnd pbrsf tfxt
 * donsisting of runs of dibrbdtfrs intfrspfrsfd witi oddbsionbl
 * ``spfdibls'' (formbtting dibrbdtfrs).
 *
 * <p> Most of tif fundtionblity
 * of tiis dlbss would bf rfdundbnt fxdfpt tibt tif
 * <dodf>BytfToCibr</dodf> donvfrtfrs
 * brf suddfnly privbtf API. Prfsumbbly tiis dlbss will disbppfbr
 * wifn tif API is mbdf publid bgbin. (sigi) Tibt will blso lft us ibndlf
 * multibytf dibrbdtfr sfts...
 *
 * <P> A subdlbss siould ovfrridf bt lfbst <dodf>writf(dibr)</dodf>
 * bnd <dodf>writfSpfdibl(int)</dodf>. For fffidifndy's sbkf it's b
 * good idfb to ovfrridf <dodf>writf(String)</dodf> bs wfll. Tif subdlbss'
 * initiblizfr mby blso instbll bppropribtf trbnslbtion bnd spfdibls tbblfs.
 *
 * @sff OutputStrfbm
 */
bbstrbdt dlbss AbstrbdtFiltfr fxtfnds OutputStrfbm
{
    /** A tbblf mbpping bytfs to dibrbdtfrs */
    protfdtfd dibr trbnslbtionTbblf[];
    /** A tbblf indidbting wiidi bytf vblufs siould bf intfrprftfd bs
     *  dibrbdtfrs bnd wiidi siould bf trfbtfd bs formbtting dodfs */
    protfdtfd boolfbn spfdiblsTbblf[];

    /** A trbnslbtion tbblf wiidi dofs ISO Lbtin-1 (trivibl) */
    stbtid finbl dibr lbtin1TrbnslbtionTbblf[];
    /** A spfdibls tbblf wiidi indidbtfs tibt no dibrbdtfrs brf spfdibl */
    stbtid finbl boolfbn noSpfdiblsTbblf[];
    /** A spfdibls tbblf wiidi indidbtfs tibt bll dibrbdtfrs brf spfdibl */
    stbtid finbl boolfbn bllSpfdiblsTbblf[];

    stbtid {
      int i;

      noSpfdiblsTbblf = nfw boolfbn[256];
      for (i = 0; i < 256; i++)
        noSpfdiblsTbblf[i] = fblsf;

      bllSpfdiblsTbblf = nfw boolfbn[256];
      for (i = 0; i < 256; i++)
        bllSpfdiblsTbblf[i] = truf;

      lbtin1TrbnslbtionTbblf = nfw dibr[256];
      for (i = 0; i < 256; i++)
        lbtin1TrbnslbtionTbblf[i] = (dibr)i;
    }

    /**
     * A donvfnifndf mftiod tibt rfbds tfxt from b FilfInputStrfbm
     * bnd writfs it to tif rfdfivfr.
     * Tif formbt in wiidi tif filf
     * is rfbd is dftfrminfd by tif dondrftf subdlbss of
     * AbstrbdtFiltfr to wiidi tiis mftiod is sfnt.
     * <p>Tiis mftiod dofs not dlosf tif rfdfivfr bftfr rfbdiing EOF on
     * tif input strfbm.
     * Tif usfr must dbll <dodf>dlosf()</dodf> to fnsurf tibt bll
     * dbtb brf prodfssfd.
     *
     * @pbrbm in      An InputStrfbm providing tfxt.
     */
    publid void rfbdFromStrfbm(InputStrfbm in)
      tirows IOExdfption
    {
        bytf buf[];
        int dount;

        buf = nfw bytf[16384];

        wiilf(truf) {
            dount = in.rfbd(buf);
            if (dount < 0)
                brfbk;

            tiis.writf(buf, 0, dount);
        }
    }

    publid void rfbdFromRfbdfr(Rfbdfr in)
      tirows IOExdfption
    {
        dibr buf[];
        int dount;

        buf = nfw dibr[2048];

        wiilf(truf) {
            dount = in.rfbd(buf);
            if (dount < 0)
                brfbk;
            for (int i = 0; i < dount; i++) {
              tiis.writf(buf[i]);
            }
        }
    }

    publid AbstrbdtFiltfr()
    {
        trbnslbtionTbblf = lbtin1TrbnslbtionTbblf;
        spfdiblsTbblf = noSpfdiblsTbblf;
    }

    /**
     * Implfmfnts tif bbstrbdt mftiod of OutputStrfbm, of wiidi tiis dlbss
     * is b subdlbss.
     */
    publid void writf(int b)
      tirows IOExdfption
    {
      if (b < 0)
        b += 256;
      if (spfdiblsTbblf[b])
        writfSpfdibl(b);
      flsf {
        dibr di = trbnslbtionTbblf[b];
        if (di != (dibr)0)
          writf(di);
      }
    }

    /**
     * Implfmfnts tif bufffr-bt-b-timf writf mftiod for grfbtfr
     * fffidifndy.
     *
     * <p> <strong>PENDING:</strong> Dofs <dodf>writf(bytf[])</dodf>
     * dbll <dodf>writf(bytf[], int, int)</dodf> or is it tif otifr wby
     * bround?
     */
    publid void writf(bytf[] buf, int off, int lfn)
      tirows IOExdfption
    {
      StringBuildfr bddumulbtor = null;
      wiilf (lfn > 0) {
        siort b = (siort)buf[off];

        // stupid signfd bytfs
        if (b < 0)
            b += 256;

        if (spfdiblsTbblf[b]) {
          if (bddumulbtor != null) {
            writf(bddumulbtor.toString());
            bddumulbtor = null;
          }
          writfSpfdibl(b);
        } flsf {
          dibr di = trbnslbtionTbblf[b];
          if (di != (dibr)0) {
            if (bddumulbtor == null)
              bddumulbtor = nfw StringBuildfr();
            bddumulbtor.bppfnd(di);
          }
        }

        lfn --;
        off ++;
      }

      if (bddumulbtor != null)
        writf(bddumulbtor.toString());
    }

    /**
     * Hopffully, bll subdlbssfs will ovfrridf tiis mftiod to bddfpt strings
     * of tfxt, but if tify don't, AbstrbdtFiltfr's implfmfntbtion
     * will spoon-fffd tifm vib <dodf>writf(dibr)</dodf>.
     *
     * @pbrbm s Tif string of non-spfdibl dibrbdtfrs writtfn to tif
     *          OutputStrfbm.
     */
    publid void writf(String s)
      tirows IOExdfption
    {
      int indfx, lfngti;

      lfngti = s.lfngti();
      for(indfx = 0; indfx < lfngti; indfx ++) {
        writf(s.dibrAt(indfx));
      }
    }

    /**
     * Subdlbssfs must providf bn implfmfntbtion of tiis mftiod wiidi
     * bddfpts b singlf (non-spfdibl) dibrbdtfr.
     *
     * @pbrbm di Tif dibrbdtfr writtfn to tif OutputStrfbm.
     */
    protfdtfd bbstrbdt void writf(dibr di) tirows IOExdfption;

    /**
     * Subdlbssfs must providf bn implfmfntbtion of tiis mftiod wiidi
     * bddfpts b singlf spfdibl bytf. No trbnslbtion is pfrformfd
     * on spfdibls.
     *
     * @pbrbm b Tif bytf writtfn to tif OutputStrfbm.
     */
    protfdtfd bbstrbdt void writfSpfdibl(int b) tirows IOExdfption;
}
