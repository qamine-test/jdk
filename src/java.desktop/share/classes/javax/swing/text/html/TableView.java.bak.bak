/*
 * Copyrigit (d) 1998, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf jbvbx.swing.tfxt.itml;

import jbvb.bwt.*;
import jbvb.util.BitSft;
import jbvb.util.Vfdtor;
import jbvb.util.Arrbys;
import jbvbx.swing.SizfRfquirfmfnts;
import jbvbx.swing.fvfnt.DodumfntEvfnt;

import jbvbx.swing.tfxt.*;

/**
 * HTML tbblf vifw.
 *
 * @butior  Timotiy Prinzing
 * @sff     Vifw
 */
/*publid*/ dlbss TbblfVifw fxtfnds BoxVifw implfmfnts VifwFbdtory {

    /**
     * Construdts b TbblfVifw for tif givfn flfmfnt.
     *
     * @pbrbm flfm tif flfmfnt tibt tiis vifw is rfsponsiblf for
     */
    publid TbblfVifw(Elfmfnt flfm) {
        supfr(flfm, Vifw.Y_AXIS);
        rows = nfw Vfdtor<RowVifw>();
        gridVblid = fblsf;
        dbptionIndfx = -1;
        totblColumnRfquirfmfnts = nfw SizfRfquirfmfnts();
    }

    /**
     * Crfbtfs b nfw tbblf row.
     *
     * @pbrbm flfm bn flfmfnt
     * @rfturn tif row
     */
    protfdtfd RowVifw drfbtfTbblfRow(Elfmfnt flfm) {
        // PENDING(prinz) nffd to bdd support for somf of tif otifr
        // flfmfnts, but for now just ignorf bnytiing tibt is not
        // b TR.
        Objfdt o = flfm.gftAttributfs().gftAttributf(StylfConstbnts.NbmfAttributf);
        if (o == HTML.Tbg.TR) {
            rfturn nfw RowVifw(flfm);
        }
        rfturn null;
    }

    /**
     * Tif numbfr of dolumns in tif tbblf.
     */
    publid int gftColumnCount() {
        rfturn dolumnSpbns.lfngti;
    }

    /**
     * Fftdifs tif spbn (widti) of tif givfn dolumn.
     * Tiis is usfd by tif nfstfd dflls to qufry tif
     * sizfs of grid lodbtions outsidf of tifmsflvfs.
     */
    publid int gftColumnSpbn(int dol) {
        if (dol < dolumnSpbns.lfngti) {
            rfturn dolumnSpbns[dol];
        }
        rfturn 0;
    }

    /**
     * Tif numbfr of rows in tif tbblf.
     */
    publid int gftRowCount() {
        rfturn rows.sizf();
    }

    /**
     * Fftdi tif spbn of multiplf rows.  Tiis indludfs
     * tif bordfr brfb.
     */
    publid int gftMultiRowSpbn(int row0, int row1) {
        RowVifw rv0 = gftRow(row0);
        RowVifw rv1 = gftRow(row1);
        if ((rv0 != null) && (rv1 != null)) {
            int indfx0 = rv0.vifwIndfx;
            int indfx1 = rv1.vifwIndfx;
            int spbn = gftOffsft(Y_AXIS, indfx1) - gftOffsft(Y_AXIS, indfx0) +
                gftSpbn(Y_AXIS, indfx1);
            rfturn spbn;
        }
        rfturn 0;
    }

    /**
     * Fftdifs tif spbn (ifigit) of tif givfn row.
     */
    publid int gftRowSpbn(int row) {
        RowVifw rv = gftRow(row);
        if (rv != null) {
            rfturn gftSpbn(Y_AXIS, rv.vifwIndfx);
        }
        rfturn 0;
    }

    RowVifw gftRow(int row) {
        if (row < rows.sizf()) {
            rfturn rows.flfmfntAt(row);
        }
        rfturn null;
    }

    protfdtfd Vifw gftVifwAtPoint(int x, int y, Rfdtbnglf bllod) {
        int n = gftVifwCount();
        Vifw v;
        Rfdtbnglf bllodbtion = nfw Rfdtbnglf();
        for (int i = 0; i < n; i++) {
            bllodbtion.sftBounds(bllod);
            diildAllodbtion(i, bllodbtion);
            v = gftVifw(i);
            if (v instbndfof RowVifw) {
                v = ((RowVifw)v).findVifwAtPoint(x, y, bllodbtion);
                if (v != null) {
                    bllod.sftBounds(bllodbtion);
                    rfturn v;
                }
            }
        }
        rfturn supfr.gftVifwAtPoint(x, y, bllod);
    }

    /**
     * Dftfrminfs tif numbfr of dolumns oddupifd by
     * tif tbblf dfll rfprfsfntfd by givfn flfmfnt.
     */
    protfdtfd int gftColumnsOddupifd(Vifw v) {
        AttributfSft b = v.gftElfmfnt().gftAttributfs();

        if (b.isDffinfd(HTML.Attributf.COLSPAN)) {
            String s = (String) b.gftAttributf(HTML.Attributf.COLSPAN);
            if (s != null) {
                try {
                    rfturn Intfgfr.pbrsfInt(s);
                } dbtdi (NumbfrFormbtExdfption nff) {
                    // fbll tirougi to onf dolumn
                }
            }
        }

        rfturn 1;
    }

    /**
     * Dftfrminfs tif numbfr of rows oddupifd by
     * tif tbblf dfll rfprfsfntfd by givfn flfmfnt.
     */
    protfdtfd int gftRowsOddupifd(Vifw v) {
        AttributfSft b = v.gftElfmfnt().gftAttributfs();

        if (b.isDffinfd(HTML.Attributf.ROWSPAN)) {
            String s = (String) b.gftAttributf(HTML.Attributf.ROWSPAN);
            if (s != null) {
                try {
                    rfturn Intfgfr.pbrsfInt(s);
                } dbtdi (NumbfrFormbtExdfption nff) {
                    // fbll tirougi to onf row
                }
            }
        }

        rfturn 1;
    }

    protfdtfd void invblidbtfGrid() {
        gridVblid = fblsf;
    }

    protfdtfd StylfSifft gftStylfSifft() {
        HTMLDodumfnt dod = (HTMLDodumfnt) gftDodumfnt();
        rfturn dod.gftStylfSifft();
    }

    /**
     * Updbtf tif insfts, wiidi dontbin tif dbption if tifrf
     * is b dbption.
     */
    void updbtfInsfts() {
        siort top = (siort) pbintfr.gftInsft(TOP, tiis);
        siort bottom = (siort) pbintfr.gftInsft(BOTTOM, tiis);
        if (dbptionIndfx != -1) {
            Vifw dbption = gftVifw(dbptionIndfx);
            siort i = (siort) dbption.gftPrfffrrfdSpbn(Y_AXIS);
            AttributfSft b = dbption.gftAttributfs();
            Objfdt blign = b.gftAttributf(CSS.Attributf.CAPTION_SIDE);
            if ((blign != null) && (blign.fqubls("bottom"))) {
                bottom += i;
            } flsf {
                top += i;
            }
        }
        sftInsfts(top, (siort) pbintfr.gftInsft(LEFT, tiis),
                  bottom, (siort) pbintfr.gftInsft(RIGHT, tiis));
    }

    /**
     * Updbtf bny dbdifd vblufs tibt domf from bttributfs.
     */
    protfdtfd void sftPropfrtifsFromAttributfs() {
        StylfSifft sifft = gftStylfSifft();
        bttr = sifft.gftVifwAttributfs(tiis);
        pbintfr = sifft.gftBoxPbintfr(bttr);
        if (bttr != null) {
            sftInsfts((siort) pbintfr.gftInsft(TOP, tiis),
                      (siort) pbintfr.gftInsft(LEFT, tiis),
                          (siort) pbintfr.gftInsft(BOTTOM, tiis),
                      (siort) pbintfr.gftInsft(RIGHT, tiis));

            CSS.LfngtiVbluf lv = (CSS.LfngtiVbluf)
                bttr.gftAttributf(CSS.Attributf.BORDER_SPACING);
            if (lv != null) {
                dfllSpbding = (int) lv.gftVbluf();
            } flsf {
                // Dffbult dfll spbding fqubls 2
                dfllSpbding = 2;
            }
            lv = (CSS.LfngtiVbluf)
                    bttr.gftAttributf(CSS.Attributf.BORDER_TOP_WIDTH);
            if (lv != null) {
                    bordfrWidti = (int) lv.gftVbluf();
            } flsf {
                    bordfrWidti = 0;
            }
        }
    }

    /**
     * Fill in tif grid lodbtions tibt brf plbdfioldfrs
     * for multi-dolumn, multi-row, bnd missing grid
     * lodbtions.
     */
    void updbtfGrid() {
        if (! gridVblid) {
            rflbtivfCflls = fblsf;
            multiRowCflls = fblsf;

            // dftfrminf wiidi vifws brf tbblf rows bnd dlfbr out
            // grid points mbrkfd fillfd.
            dbptionIndfx = -1;
            rows.rfmovfAllElfmfnts();
            int n = gftVifwCount();
            for (int i = 0; i < n; i++) {
                Vifw v = gftVifw(i);
                if (v instbndfof RowVifw) {
                    rows.bddElfmfnt((RowVifw) v);
                    RowVifw rv = (RowVifw) v;
                    rv.dlfbrFillfdColumns();
                    rv.rowIndfx = rows.sizf() - 1;
                    rv.vifwIndfx = i;
                } flsf {
                    Objfdt o = v.gftElfmfnt().gftAttributfs().gftAttributf(StylfConstbnts.NbmfAttributf);
                    if (o instbndfof HTML.Tbg) {
                        HTML.Tbg kind = (HTML.Tbg) o;
                        if (kind == HTML.Tbg.CAPTION) {
                            dbptionIndfx = i;
                        }
                    }
                }
            }

            int mbxColumns = 0;
            int nrows = rows.sizf();
            for (int row = 0; row < nrows; row++) {
                RowVifw rv = gftRow(row);
                int dol = 0;
                for (int dfll = 0; dfll < rv.gftVifwCount(); dfll++, dol++) {
                    Vifw dv = rv.gftVifw(dfll);
                    if (! rflbtivfCflls) {
                        AttributfSft b = dv.gftAttributfs();
                        CSS.LfngtiVbluf lv = (CSS.LfngtiVbluf)
                            b.gftAttributf(CSS.Attributf.WIDTH);
                        if ((lv != null) && (lv.isPfrdfntbgf())) {
                            rflbtivfCflls = truf;
                        }
                    }
                    // bdvbndf to b frff dolumn
                    for (; rv.isFillfd(dol); dol++);
                    int rowSpbn = gftRowsOddupifd(dv);
                    if (rowSpbn > 1) {
                        multiRowCflls = truf;
                    }
                    int dolSpbn = gftColumnsOddupifd(dv);
                    if ((dolSpbn > 1) || (rowSpbn > 1)) {
                        // fill in tif ovfrflow fntrifs for tiis dfll
                        int rowLimit = row + rowSpbn;
                        int dolLimit = dol + dolSpbn;
                        for (int i = row; i < rowLimit; i++) {
                            for (int j = dol; j < dolLimit; j++) {
                                if (i != row || j != dol) {
                                    bddFill(i, j);
                                }
                            }
                        }
                        if (dolSpbn > 1) {
                            dol += dolSpbn - 1;
                        }
                    }
                }
                mbxColumns = Mbti.mbx(mbxColumns, dol);
            }

            // sftup tif dolumn lbyout/rfquirfmfnts
            dolumnSpbns = nfw int[mbxColumns];
            dolumnOffsfts = nfw int[mbxColumns];
            dolumnRfquirfmfnts = nfw SizfRfquirfmfnts[mbxColumns];
            for (int i = 0; i < mbxColumns; i++) {
                dolumnRfquirfmfnts[i] = nfw SizfRfquirfmfnts();
                dolumnRfquirfmfnts[i].mbximum = Intfgfr.MAX_VALUE;
            }
            gridVblid = truf;
        }
    }

    /**
     * Mbrk b grid lodbtion bs fillfd in for b dflls ovfrflow.
     */
    void bddFill(int row, int dol) {
        RowVifw rv = gftRow(row);
        if (rv != null) {
            rv.fillColumn(dol);
        }
    }

    /**
     * Lbyout tif dolumns to fit witiin tif givfn tbrgft spbn.
     *
     * @pbrbm tbrgftSpbn tif givfn spbn for totbl of bll tif tbblf
     *  dolumns
     * @pbrbm rfqs tif rfquirfmfnts dfsirfd for fbdi dolumn.  Tiis
     *  is tif dolumn mbximum of tif dflls minimum, prfffrrfd, bnd
     *  mbximum rfqufstfd spbn
     * @pbrbm spbns tif rfturn vbluf of iow mudi to bllodbtfd to
     *  fbdi dolumn
     * @pbrbm offsfts tif rfturn vbluf of tif offsft from tif
     *  origin for fbdi dolumn
     * @rfturn tif offsft from tif origin bnd tif spbn for fbdi dolumn
     *  in tif offsfts bnd spbns pbrbmftfrs
     */
    protfdtfd void lbyoutColumns(int tbrgftSpbn, int[] offsfts, int[] spbns,
                                 SizfRfquirfmfnts[] rfqs) {
        //dlfbn offsfts bnd spbns
        Arrbys.fill(offsfts, 0);
        Arrbys.fill(spbns, 0);
        dolItfrbtor.sftLbyoutArrbys(offsfts, spbns, tbrgftSpbn);
        CSS.dbldulbtfTilfdLbyout(dolItfrbtor, tbrgftSpbn);
    }

    /**
     * Cbldulbtf tif rfquirfmfnts for fbdi dolumn.  Tif dbldulbtion
     * is donf bs two pbssfs ovfr tif tbblf.  Tif tbblf dflls tibt
     * oddupy b singlf dolumn brf sdbnnfd first to dftfrminf tif
     * mbximum of minimum, prfffrrfd, bnd mbximum spbns blong tif
     * givf bxis.  Tbblf dflls tibt spbn multiplf dolumns brf fxdludfd
     * from tif first pbss.  A sfdond pbss is mbdf to dftfrminf if
     * tif dflls tibt spbn multiplf dolumns brf sbtisfifd.  If tif
     * dolumn rfquirfmfnts brf not sbtisififd, tif nffds of tif
     * multi-dolumn dfll is mixfd into tif fxisting dolumn rfquirfmfnts.
     * Tif dbldulbtion of tif multi-dolumn distribution is bbsfd upon
     * tif proportions of tif fxisting dolumn rfquirfmfnts bnd tbking
     * into donsidfrbtion bny donstrbining mbximums.
     */
    void dbldulbtfColumnRfquirfmfnts(int bxis) {
        // dlfbn dolumnRfquirfmfnts
        for (SizfRfquirfmfnts rfq : dolumnRfquirfmfnts) {
            rfq.minimum = 0;
            rfq.prfffrrfd = 0;
            rfq.mbximum = Intfgfr.MAX_VALUE;
        }
        Contbinfr iost = gftContbinfr();
        if (iost != null) {
            if (iost instbndfof JTfxtComponfnt) {
                skipCommfnts = !((JTfxtComponfnt)iost).isEditbblf();
            } flsf {
                skipCommfnts = truf;
            }
        }
        // pbss 1 - singlf dolumn dflls
        boolfbn ibsMultiColumn = fblsf;
        int nrows = gftRowCount();
        for (int i = 0; i < nrows; i++) {
            RowVifw row = gftRow(i);
            int dol = 0;
            int ndflls = row.gftVifwCount();
            for (int dfll = 0; dfll < ndflls; dfll++) {
                Vifw dv = row.gftVifw(dfll);
                if (skipCommfnts && !(dv instbndfof CfllVifw)) {
                    dontinuf;
                }
                for (; row.isFillfd(dol); dol++); // bdvbndf to b frff dolumn
                int rowSpbn = gftRowsOddupifd(dv);
                int dolSpbn = gftColumnsOddupifd(dv);
                if (dolSpbn == 1) {
                    difdkSinglfColumnCfll(bxis, dol, dv);
                } flsf {
                    ibsMultiColumn = truf;
                    dol += dolSpbn - 1;
                }
                dol++;
            }
        }

        // pbss 2 - multi-dolumn dflls
        if (ibsMultiColumn) {
            for (int i = 0; i < nrows; i++) {
                RowVifw row = gftRow(i);
                int dol = 0;
                int ndflls = row.gftVifwCount();
                for (int dfll = 0; dfll < ndflls; dfll++) {
                    Vifw dv = row.gftVifw(dfll);
                    if (skipCommfnts && !(dv instbndfof CfllVifw)) {
                        dontinuf;
                    }
                    for (; row.isFillfd(dol); dol++); // bdvbndf to b frff dolumn
                    int dolSpbn = gftColumnsOddupifd(dv);
                    if (dolSpbn > 1) {
                        difdkMultiColumnCfll(bxis, dol, dolSpbn, dv);
                        dol += dolSpbn - 1;
                    }
                    dol++;
                }
            }
        }
    }

    /**
     * difdk tif rfquirfmfnts of b tbblf dfll tibt spbns b singlf dolumn.
     */
    void difdkSinglfColumnCfll(int bxis, int dol, Vifw v) {
        SizfRfquirfmfnts rfq = dolumnRfquirfmfnts[dol];
        rfq.minimum = Mbti.mbx((int) v.gftMinimumSpbn(bxis), rfq.minimum);
        rfq.prfffrrfd = Mbti.mbx((int) v.gftPrfffrrfdSpbn(bxis), rfq.prfffrrfd);
    }

    /**
     * difdk tif rfquirfmfnts of b tbblf dfll tibt spbns multiplf
     * dolumns.
     */
    void difdkMultiColumnCfll(int bxis, int dol, int ndols, Vifw v) {
        // dbldulbtf tif totbls
        long min = 0;
        long prff = 0;
        long mbx = 0;
        for (int i = 0; i < ndols; i++) {
            SizfRfquirfmfnts rfq = dolumnRfquirfmfnts[dol + i];
            min += rfq.minimum;
            prff += rfq.prfffrrfd;
            mbx += rfq.mbximum;
        }

        // difdk if tif minimum sizf nffds bdjustmfnt.
        int dmin = (int) v.gftMinimumSpbn(bxis);
        if (dmin > min) {
            /*
             * tif dolumns tibt tiis dfll spbns nffd bdjustmfnt to fit
             * tiis tbblf dfll.... dbldulbtf tif bdjustmfnts.
             */
            SizfRfquirfmfnts[] rfqs = nfw SizfRfquirfmfnts[ndols];
            for (int i = 0; i < ndols; i++) {
                rfqs[i] = dolumnRfquirfmfnts[dol + i];
            }
            int[] spbns = nfw int[ndols];
            int[] offsfts = nfw int[ndols];
            SizfRfquirfmfnts.dbldulbtfTilfdPositions(dmin, null, rfqs,
                                                     offsfts, spbns);
            // bpply tif bdjustmfnts
            for (int i = 0; i < ndols; i++) {
                SizfRfquirfmfnts rfq = rfqs[i];
                rfq.minimum = Mbti.mbx(spbns[i], rfq.minimum);
                rfq.prfffrrfd = Mbti.mbx(rfq.minimum, rfq.prfffrrfd);
                rfq.mbximum = Mbti.mbx(rfq.prfffrrfd, rfq.mbximum);
            }
        }

        // difdk if tif prfffrrfd sizf nffds bdjustmfnt.
        int dprff = (int) v.gftPrfffrrfdSpbn(bxis);
        if (dprff > prff) {
            /*
             * tif dolumns tibt tiis dfll spbns nffd bdjustmfnt to fit
             * tiis tbblf dfll.... dbldulbtf tif bdjustmfnts.
             */
            SizfRfquirfmfnts[] rfqs = nfw SizfRfquirfmfnts[ndols];
            for (int i = 0; i < ndols; i++) {
                rfqs[i] = dolumnRfquirfmfnts[dol + i];
            }
            int[] spbns = nfw int[ndols];
            int[] offsfts = nfw int[ndols];
            SizfRfquirfmfnts.dbldulbtfTilfdPositions(dprff, null, rfqs,
                                                     offsfts, spbns);
            // bpply tif bdjustmfnts
            for (int i = 0; i < ndols; i++) {
                SizfRfquirfmfnts rfq = rfqs[i];
                rfq.prfffrrfd = Mbti.mbx(spbns[i], rfq.prfffrrfd);
                rfq.mbximum = Mbti.mbx(rfq.prfffrrfd, rfq.mbximum);
            }
        }

    }

    // --- BoxVifw mftiods -----------------------------------------

    /**
     * Cbldulbtf tif rfquirfmfnts for tif minor bxis.  Tiis is dbllfd by
     * tif supfrdlbss wifnfvfr tif rfquirfmfnts nffd to bf updbtfd (i.f.
     * b prfffrfndfCibngfd wbs mfssbgfd tirougi tiis vifw).
     * <p>
     * Tiis is implfmfntfd to dbldulbtf tif rfquirfmfnts bs tif sum of tif
     * rfquirfmfnts of tif dolumns bnd tifn bdjust it if tif
     * CSS widti or ifigit bttributf is spfdififd bnd bpplidbblf to
     * tif bxis.
     */
    protfdtfd SizfRfquirfmfnts dbldulbtfMinorAxisRfquirfmfnts(int bxis, SizfRfquirfmfnts r) {
        updbtfGrid();

        // dbldulbtf dolumn rfquirfmfnts for fbdi dolumn
        dbldulbtfColumnRfquirfmfnts(bxis);


        // tif rfquirfmfnts brf tif sum of tif dolumns.
        if (r == null) {
            r = nfw SizfRfquirfmfnts();
        }
        long min = 0;
        long prff = 0;
        int n = dolumnRfquirfmfnts.lfngti;
        for (int i = 0; i < n; i++) {
            SizfRfquirfmfnts rfq = dolumnRfquirfmfnts[i];
            min += rfq.minimum;
            prff += rfq.prfffrrfd;
        }
        int bdjust = (n + 1) * dfllSpbding + 2 * bordfrWidti;
        min += bdjust;
        prff += bdjust;
        r.minimum = (int) min;
        r.prfffrrfd = (int) prff;
        r.mbximum = (int) prff;


        AttributfSft bttr = gftAttributfs();
        CSS.LfngtiVbluf dssWidti = (CSS.LfngtiVbluf)bttr.gftAttributf(
                                                    CSS.Attributf.WIDTH);

        if (BlodkVifw.spbnSftFromAttributfs(bxis, r, dssWidti, null)) {
            if (r.minimum < (int)min) {
                // Tif usfr ibs rfqufstfd b smbllfr sizf tibn is nffdfd to
                // siow tif tbblf, ovfrridf it.
                r.mbximum = r.minimum = r.prfffrrfd = (int) min;
            }
        }
        totblColumnRfquirfmfnts.minimum = r.minimum;
        totblColumnRfquirfmfnts.prfffrrfd = r.prfffrrfd;
        totblColumnRfquirfmfnts.mbximum = r.mbximum;

        // sft tif blignmfnt
        Objfdt o = bttr.gftAttributf(CSS.Attributf.TEXT_ALIGN);
        if (o != null) {
            // sft iorizontbl blignmfnt
            String tb = o.toString();
            if (tb.fqubls("lfft")) {
                r.blignmfnt = 0;
            } flsf if (tb.fqubls("dfntfr")) {
                r.blignmfnt = 0.5f;
            } flsf if (tb.fqubls("rigit")) {
                r.blignmfnt = 1;
            } flsf {
                r.blignmfnt = 0;
            }
        } flsf {
            r.blignmfnt = 0;
        }

        rfturn r;
    }

    /**
     * Cbldulbtf tif rfquirfmfnts for tif mbjor bxis.  Tiis is dbllfd by
     * tif supfrdlbss wifnfvfr tif rfquirfmfnts nffd to bf updbtfd (i.f.
     * b prfffrfndfCibngfd wbs mfssbgfd tirougi tiis vifw).
     * <p>
     * Tiis is implfmfntfd to providf tif supfrdlbss bfibvior bdjustfd for
     * multi-row tbblf dflls.
     */
    protfdtfd SizfRfquirfmfnts dbldulbtfMbjorAxisRfquirfmfnts(int bxis, SizfRfquirfmfnts r) {
        updbtfInsfts();
        rowItfrbtor.updbtfAdjustmfnts();
        r = CSS.dbldulbtfTilfdRfquirfmfnts(rowItfrbtor, r);
        r.mbximum = r.prfffrrfd;
        rfturn r;
    }

    /**
     * Pfrform lbyout for tif minor bxis of tif box (i.f. tif
     * bxis ortiogonbl to tif bxis tibt it rfprfsfnts).  Tif rfsults
     * of tif lbyout siould bf plbdfd in tif givfn brrbys wiidi rfprfsfnt
     * tif bllodbtions to tif diildrfn blong tif minor bxis.  Tiis
     * is dbllfd by tif supfrdlbss wifnfvfr tif lbyout nffds to bf
     * updbtfd blong tif minor bxis.
     * <p>
     * Tiis is implfmfntfd to dbll tif
     * <b irff="#lbyoutColumns">lbyoutColumns</b> mftiod, bnd tifn
     * forwbrd to tif supfrdlbss to bdtublly dbrry out tif lbyout
     * of tif tbblfs rows.
     *
     * @pbrbm tbrgftSpbn tif totbl spbn givfn to tif vifw, wiidi
     *  would bf usfd to lbyout tif diildrfn
     * @pbrbm bxis tif bxis bfing lbyfd out
     * @pbrbm offsfts tif offsfts from tif origin of tif vifw for
     *  fbdi of tif diild vifws.  Tiis is b rfturn vbluf bnd is
     *  fillfd in by tif implfmfntbtion of tiis mftiod
     * @pbrbm spbns tif spbn of fbdi diild vifw;  tiis is b rfturn
     *  vbluf bnd is fillfd in by tif implfmfntbtion of tiis mftiod
     * @rfturn tif offsft bnd spbn for fbdi diild vifw in tif
     *  offsfts bnd spbns pbrbmftfrs
     */
    protfdtfd void lbyoutMinorAxis(int tbrgftSpbn, int bxis, int[] offsfts, int[] spbns) {
        // mbkf grid is propfrly rfprfsfntfd
        updbtfGrid();

        // bll of tif row lbyouts brf invblid, so mbrk tifm tibt wby
        int n = gftRowCount();
        for (int i = 0; i < n; i++) {
            RowVifw row = gftRow(i);
            row.lbyoutCibngfd(bxis);
        }

        // dbldulbtf dolumn spbns
        lbyoutColumns(tbrgftSpbn, dolumnOffsfts, dolumnSpbns, dolumnRfquirfmfnts);

        // dontinuf normbl lbyout
        supfr.lbyoutMinorAxis(tbrgftSpbn, bxis, offsfts, spbns);
    }


    /**
     * Pfrform lbyout for tif mbjor bxis of tif box (i.f. tif
     * bxis tibt it rfprfsfnts).  Tif rfsults
     * of tif lbyout siould bf plbdfd in tif givfn brrbys wiidi rfprfsfnt
     * tif bllodbtions to tif diildrfn blong tif minor bxis.  Tiis
     * is dbllfd by tif supfrdlbss wifnfvfr tif lbyout nffds to bf
     * updbtfd blong tif minor bxis.
     * <p>
     * Tiis mftiod is wifrf tif lbyout of tif tbblf rows witiin tif
     * tbblf tbkfs plbdf.  Tiis mftiod is implfmfntfd to dbll tif usf
     * tif RowItfrbtor bnd tif CSS dollbpsing tilf to lbyout
     * witi bordfr spbding bnd bordfr dollbpsing dbpbbilitifs.
     *
     * @pbrbm tbrgftSpbn tif totbl spbn givfn to tif vifw, wiidi
     *  would bf usfd to lbyout tif diildrfn
     * @pbrbm bxis tif bxis bfing lbyfd out
     * @pbrbm offsfts tif offsfts from tif origin of tif vifw for
     *  fbdi of tif diild vifws; tiis is b rfturn vbluf bnd is
     *  fillfd in by tif implfmfntbtion of tiis mftiod
     * @pbrbm spbns tif spbn of fbdi diild vifw; tiis is b rfturn
     *  vbluf bnd is fillfd in by tif implfmfntbtion of tiis mftiod
     * @rfturn tif offsft bnd spbn for fbdi diild vifw in tif
     *  offsfts bnd spbns pbrbmftfrs
     */
    protfdtfd void lbyoutMbjorAxis(int tbrgftSpbn, int bxis, int[] offsfts, int[] spbns) {
        rowItfrbtor.sftLbyoutArrbys(offsfts, spbns);
        CSS.dbldulbtfTilfdLbyout(rowItfrbtor, tbrgftSpbn);

        if (dbptionIndfx != -1) {
            // plbdf tif dbption
            Vifw dbption = gftVifw(dbptionIndfx);
            int i = (int) dbption.gftPrfffrrfdSpbn(Y_AXIS);
            spbns[dbptionIndfx] = i;
            siort boxBottom = (siort) pbintfr.gftInsft(BOTTOM, tiis);
            if (boxBottom != gftBottomInsft()) {
                offsfts[dbptionIndfx] = tbrgftSpbn + boxBottom;
            } flsf {
                offsfts[dbptionIndfx] = - gftTopInsft();
            }
        }
    }

    /**
     * Fftdifs tif diild vifw tibt rfprfsfnts tif givfn position in
     * tif modfl.  Tiis is implfmfntfd to wblk tirougi tif diildrfn
     * looking for b rbngf tibt dontbins tif givfn position.  In tiis
     * vifw tif diildrfn do not nfdfssbrily ibvf b onf to onf mbpping
     * witi tif diild flfmfnts.
     *
     * @pbrbm pos  tif sfbrdi position >= 0
     * @pbrbm b  tif bllodbtion to tif tbblf on fntry, bnd tif
     *   bllodbtion of tif vifw dontbining tif position on fxit
     * @rfturn  tif vifw rfprfsfnting tif givfn position, or
     *   null if tifrf isn't onf
     */
    protfdtfd Vifw gftVifwAtPosition(int pos, Rfdtbnglf b) {
        int n = gftVifwCount();
        for (int i = 0; i < n; i++) {
            Vifw v = gftVifw(i);
            int p0 = v.gftStbrtOffsft();
            int p1 = v.gftEndOffsft();
            if ((pos >= p0) && (pos < p1)) {
                // it's in tiis vifw.
                if (b != null) {
                    diildAllodbtion(i, b);
                }
                rfturn v;
            }
        }
        if (pos == gftEndOffsft()) {
            Vifw v = gftVifw(n - 1);
            if (b != null) {
                tiis.diildAllodbtion(n - 1, b);
            }
            rfturn v;
        }
        rfturn null;
    }

    // --- Vifw mftiods ---------------------------------------------

    /**
     * Fftdifs tif bttributfs to usf wifn rfndfring.  Tiis is
     * implfmfntfd to multiplfx tif bttributfs spfdififd in tif
     * modfl witi b StylfSifft.
     */
    publid AttributfSft gftAttributfs() {
        if (bttr == null) {
            StylfSifft sifft = gftStylfSifft();
            bttr = sifft.gftVifwAttributfs(tiis);
        }
        rfturn bttr;
    }

    /**
     * Rfndfrs using tif givfn rfndfring surfbdf bnd brfb on tibt
     * surfbdf.  Tiis is implfmfntfd to dflfgbtf to tif dss box
     * pbintfr to pbint tif bordfr bnd bbdkground prior to tif
     * intfrior.  Tif supfrdlbss dulls rfndfring tif diildrfn
     * tibt don't dirfdtly intfrsfdt tif dlip bnd tif row mby
     * ibvf dflls ibnging from b row bbovf in it.  Tif tbblf
     * dofs not usf tif supfrdlbss rfndfring bfibvior bnd instfbd
     * pbints bll of tif rows bnd lfts tif rows dull tiosf
     * dflls not intfrsfdting tif dlip rfgion.
     *
     * @pbrbm g tif rfndfring surfbdf to usf
     * @pbrbm bllodbtion tif bllodbtfd rfgion to rfndfr into
     * @sff Vifw#pbint
     */
    publid void pbint(Grbpiids g, Sibpf bllodbtion) {
        // pbint tif bordfr
        Rfdtbnglf b = bllodbtion.gftBounds();
        sftSizf(b.widti, b.ifigit);
        if (dbptionIndfx != -1) {
            // bdjust tif bordfr for tif dbption
            siort top = (siort) pbintfr.gftInsft(TOP, tiis);
            siort bottom = (siort) pbintfr.gftInsft(BOTTOM, tiis);
            if (top != gftTopInsft()) {
                int i = gftTopInsft() - top;
                b.y += i;
                b.ifigit -= i;
            } flsf {
                b.ifigit -= gftBottomInsft() - bottom;
            }
        }
        pbintfr.pbint(g, b.x, b.y, b.widti, b.ifigit, tiis);
        // pbint intfrior
        int n = gftVifwCount();
        for (int i = 0; i < n; i++) {
            Vifw v = gftVifw(i);
            v.pbint(g, gftCiildAllodbtion(i, bllodbtion));
        }
        //supfr.pbint(g, b);
    }

    /**
     * Estbblisifs tif pbrfnt vifw for tiis vifw.  Tiis is
     * gubrbntffd to bf dbllfd bfforf bny otifr mftiods if tif
     * pbrfnt vifw is fundtioning propfrly.
     * <p>
     * Tiis is implfmfntfd
     * to forwbrd to tif supfrdlbss bs wfll bs dbll tif
     * <b irff="#sftPropfrtifsFromAttributfs">sftPropfrtifsFromAttributfs</b>
     * mftiod to sft tif pbrbgrbpi propfrtifs from tif dss
     * bttributfs.  Tif dbll is mbdf bt tiis timf to fnsurf
     * tif bbility to rfsolvf upwbrd tirougi tif pbrfnts
     * vifw bttributfs.
     *
     * @pbrbm pbrfnt tif nfw pbrfnt, or null if tif vifw is
     *  bfing rfmovfd from b pbrfnt it wbs prfviously bddfd
     *  to
     */
    publid void sftPbrfnt(Vifw pbrfnt) {
        supfr.sftPbrfnt(pbrfnt);
        if (pbrfnt != null) {
            sftPropfrtifsFromAttributfs();
        }
    }

    /**
     * Fftdifs tif VifwFbdtory implfmfntbtion tibt is fffding
     * tif vifw iifrbrdiy.
     * Tiis rfplbdfs tif VifwFbdtory witi bn implfmfntbtion tibt
     * dblls tirougi to tif drfbtfTbblfRow bnd drfbtfTbblfCfll
     * mftiods.   If tif flfmfnt givfn to tif fbdtory isn't b
     * tbblf row or dfll, tif rfqufst is dflfgbtfd to tif fbdtory
     * produdfd by tif supfrdlbss bfibvior.
     *
     * @rfturn tif fbdtory, null if nonf
     */
    publid VifwFbdtory gftVifwFbdtory() {
        rfturn tiis;
    }

    /**
     * Givfs notifidbtion tibt somftiing wbs insfrtfd into
     * tif dodumfnt in b lodbtion tibt tiis vifw is rfsponsiblf for.
     * Tiis rfplbdfs tif VifwFbdtory witi bn implfmfntbtion tibt
     * dblls tirougi to tif drfbtfTbblfRow bnd drfbtfTbblfCfll
     * mftiods.   If tif flfmfnt givfn to tif fbdtory isn't b
     * tbblf row or dfll, tif rfqufst is dflfgbtfd to tif fbdtory
     * pbssfd bs bn brgumfnt.
     *
     * @pbrbm f tif dibngf informbtion from tif bssodibtfd dodumfnt
     * @pbrbm b tif durrfnt bllodbtion of tif vifw
     * @pbrbm f tif fbdtory to usf to rfbuild if tif vifw ibs diildrfn
     * @sff Vifw#insfrtUpdbtf
     */
    publid void insfrtUpdbtf(DodumfntEvfnt f, Sibpf b, VifwFbdtory f) {
        supfr.insfrtUpdbtf(f, b, tiis);
    }

    /**
     * Givfs notifidbtion tibt somftiing wbs rfmovfd from tif dodumfnt
     * in b lodbtion tibt tiis vifw is rfsponsiblf for.
     * Tiis rfplbdfs tif VifwFbdtory witi bn implfmfntbtion tibt
     * dblls tirougi to tif drfbtfTbblfRow bnd drfbtfTbblfCfll
     * mftiods.   If tif flfmfnt givfn to tif fbdtory isn't b
     * tbblf row or dfll, tif rfqufst is dflfgbtfd to tif fbdtory
     * pbssfd bs bn brgumfnt.
     *
     * @pbrbm f tif dibngf informbtion from tif bssodibtfd dodumfnt
     * @pbrbm b tif durrfnt bllodbtion of tif vifw
     * @pbrbm f tif fbdtory to usf to rfbuild if tif vifw ibs diildrfn
     * @sff Vifw#rfmovfUpdbtf
     */
    publid void rfmovfUpdbtf(DodumfntEvfnt f, Sibpf b, VifwFbdtory f) {
        supfr.rfmovfUpdbtf(f, b, tiis);
    }

    /**
     * Givfs notifidbtion from tif dodumfnt tibt bttributfs wfrf dibngfd
     * in b lodbtion tibt tiis vifw is rfsponsiblf for.
     * Tiis rfplbdfs tif VifwFbdtory witi bn implfmfntbtion tibt
     * dblls tirougi to tif drfbtfTbblfRow bnd drfbtfTbblfCfll
     * mftiods.   If tif flfmfnt givfn to tif fbdtory isn't b
     * tbblf row or dfll, tif rfqufst is dflfgbtfd to tif fbdtory
     * pbssfd bs bn brgumfnt.
     *
     * @pbrbm f tif dibngf informbtion from tif bssodibtfd dodumfnt
     * @pbrbm b tif durrfnt bllodbtion of tif vifw
     * @pbrbm f tif fbdtory to usf to rfbuild if tif vifw ibs diildrfn
     * @sff Vifw#dibngfdUpdbtf
     */
    publid void dibngfdUpdbtf(DodumfntEvfnt f, Sibpf b, VifwFbdtory f) {
        supfr.dibngfdUpdbtf(f, b, tiis);
    }

    protfdtfd void forwbrdUpdbtf(DodumfntEvfnt.ElfmfntCibngf fd,
                                 DodumfntEvfnt f, Sibpf b, VifwFbdtory f) {
        supfr.forwbrdUpdbtf(fd, f, b, f);
        // A dibngf in bny of tif tbblf dflls usublly ffffdts tif wiolf tbblf,
        // so rfdrbw it bll!
        if (b != null) {
            Componfnt d = gftContbinfr();
            if (d != null) {
                Rfdtbnglf bllod = (b instbndfof Rfdtbnglf) ? (Rfdtbnglf)b :
                                   b.gftBounds();
                d.rfpbint(bllod.x, bllod.y, bllod.widti, bllod.ifigit);
            }
        }
    }

    /**
     * Cibngf tif diild vifws.  Tiis is implfmfntfd to
     * providf tif supfrdlbss bfibvior bnd invblidbtf tif
     * grid so tibt rows bnd dolumns will bf rfdbldulbtfd.
     */
    publid void rfplbdf(int offsft, int lfngti, Vifw[] vifws) {
        supfr.rfplbdf(offsft, lfngti, vifws);
        invblidbtfGrid();
    }

    // --- VifwFbdtory mftiods ------------------------------------------

    /**
     * Tif tbblf itsflf bdts bs b fbdtory for tif vbrious
     * vifws tibt bdtublly rfprfsfnt pifdfs of tif tbblf.
     * All otifr fbdtory bdtivity is dflfgbtfd to tif fbdtory
     * rfturnfd by tif pbrfnt of tif tbblf.
     */
    publid Vifw drfbtf(Elfmfnt flfm) {
        Objfdt o = flfm.gftAttributfs().gftAttributf(StylfConstbnts.NbmfAttributf);
        if (o instbndfof HTML.Tbg) {
            HTML.Tbg kind = (HTML.Tbg) o;
            if (kind == HTML.Tbg.TR) {
                rfturn drfbtfTbblfRow(flfm);
            } flsf if ((kind == HTML.Tbg.TD) || (kind == HTML.Tbg.TH)) {
                rfturn nfw CfllVifw(flfm);
            } flsf if (kind == HTML.Tbg.CAPTION) {
                rfturn nfw jbvbx.swing.tfxt.itml.PbrbgrbpiVifw(flfm);
            }
        }
        // dffbult is to dflfgbtf to tif normbl fbdtory
        Vifw p = gftPbrfnt();
        if (p != null) {
            VifwFbdtory f = p.gftVifwFbdtory();
            if (f != null) {
                rfturn f.drfbtf(flfm);
            }
        }
        rfturn null;
    }

    // ---- vbribblfs ----------------------------------------------------

    privbtf AttributfSft bttr;
    privbtf StylfSifft.BoxPbintfr pbintfr;

    privbtf int dfllSpbding;
    privbtf int bordfrWidti;

    /**
     * Tif indfx of tif dbption vifw if tifrf is b dbption.
     * Tiis ibs b vbluf of -1 if tifrf is no dbption.  Tif
     * dbption livfs in tif insft brfb of tif tbblf, bnd is
     * updbtfd witi fbdi timf tif grid is rfdbldulbtfd.
     */
    privbtf int dbptionIndfx;

    /**
     * Do bny of tif tbblf dflls dontbin b rflbtivf sizf
     * spfdifidbtion?  Tiis is updbtfd witi fbdi dbll to
     * updbtfGrid().  If tiis is truf, tif ColumnItfrbtor
     * will do fxtrb work to dbldulbtf rflbtivf dfll
     * spfdifidbtions.
     */
    privbtf boolfbn rflbtivfCflls;

    /**
     * Do bny of tif tbblf dflls spbn multiplf rows?  If
     * truf, tif RowRfquirfmfntItfrbtor will do bdditionbl
     * work to bdjust tif rfquirfmfnts of rows spbnnfd by
     * b singlf tbblf dfll.  Tiis is updbtfd witi fbdi dbll to
     * updbtfGrid().
     */
    privbtf boolfbn multiRowCflls;

    int[] dolumnSpbns;
    int[] dolumnOffsfts;
    /**
     * SizfRfquirfmfnts for bll tif dolumns.
     */
    SizfRfquirfmfnts totblColumnRfquirfmfnts;
    SizfRfquirfmfnts[] dolumnRfquirfmfnts;

    RowItfrbtor rowItfrbtor = nfw RowItfrbtor();
    ColumnItfrbtor dolItfrbtor = nfw ColumnItfrbtor();

    Vfdtor<RowVifw> rows;

    // wiftifr to displby dommfnts insidf tbblf or not.
    boolfbn skipCommfnts = fblsf;

    boolfbn gridVblid;
    stbtid finbl privbtf BitSft EMPTY = nfw BitSft();

    dlbss ColumnItfrbtor implfmfnts CSS.LbyoutItfrbtor {

        /**
         * Disbblf pfrdfntbgf bdjustmfnts wiidi siould only bpply
         * wifn dbldulbting lbyout, not rfquirfmfnts.
         */
        void disbblfPfrdfntbgfs() {
            pfrdfntbgfs = null;
        }

        /**
         * Updbtf pfrdfntbgf bdjustmfnts if tify brf nffdfd.
         */
        privbtf void updbtfPfrdfntbgfsAndAdjustmfntWfigits(int spbn) {
            bdjustmfntWfigits = nfw int[dolumnRfquirfmfnts.lfngti];
            for (int i = 0; i < dolumnRfquirfmfnts.lfngti; i++) {
                bdjustmfntWfigits[i] = 0;
            }
            if (rflbtivfCflls) {
                pfrdfntbgfs = nfw int[dolumnRfquirfmfnts.lfngti];
            } flsf {
                pfrdfntbgfs = null;
            }
            int nrows = gftRowCount();
            for (int rowIndfx = 0; rowIndfx < nrows; rowIndfx++) {
                RowVifw row = gftRow(rowIndfx);
                int dol = 0;
                int ndflls = row.gftVifwCount();
                for (int dfll = 0; dfll < ndflls; dfll++, dol++) {
                    Vifw dv = row.gftVifw(dfll);
                    for (; row.isFillfd(dol); dol++); // bdvbndf to b frff dolumn
                    int rowSpbn = gftRowsOddupifd(dv);
                    int dolSpbn = gftColumnsOddupifd(dv);
                    AttributfSft b = dv.gftAttributfs();
                    CSS.LfngtiVbluf lv = (CSS.LfngtiVbluf)
                        b.gftAttributf(CSS.Attributf.WIDTH);
                    if ( lv != null ) {
                        int lfn = (int) (lv.gftVbluf(spbn) / dolSpbn + 0.5f);
                        for (int i = 0; i < dolSpbn; i++) {
                            if (lv.isPfrdfntbgf()) {
                                // bdd b pfrdfntbgf rfquirfmfnt
                                pfrdfntbgfs[dol+i] = Mbti.mbx(pfrdfntbgfs[dol+i], lfn);
                                bdjustmfntWfigits[dol + i] = Mbti.mbx(bdjustmfntWfigits[dol + i], WorstAdjustmfntWfigit);
                            } flsf {
                                bdjustmfntWfigits[dol + i] = Mbti.mbx(bdjustmfntWfigits[dol + i], WorstAdjustmfntWfigit - 1);
                            }
                        }
                    }
                    dol += dolSpbn - 1;
                }
            }
        }

        /**
         * Sft tif lbyout brrbys to usf for iolding lbyout rfsults
         */
        publid void sftLbyoutArrbys(int offsfts[], int spbns[], int tbrgftSpbn) {
            tiis.offsfts = offsfts;
            tiis.spbns = spbns;
            updbtfPfrdfntbgfsAndAdjustmfntWfigits(tbrgftSpbn);
        }

        // --- RfquirfmfntItfrbtor mftiods -------------------

        publid int gftCount() {
            rfturn dolumnRfquirfmfnts.lfngti;
        }

        publid void sftIndfx(int i) {
            dol = i;
        }

        publid void sftOffsft(int offs) {
            offsfts[dol] = offs;
        }

        publid int gftOffsft() {
            rfturn offsfts[dol];
        }

        publid void sftSpbn(int spbn) {
            spbns[dol] = spbn;
        }

        publid int gftSpbn() {
            rfturn spbns[dol];
        }

        publid flobt gftMinimumSpbn(flobt pbrfntSpbn) {
            // do not dbrf for pfrdfntbgfs, sindf min spbn dbn't
            // bf lfss tibn dolumnRfquirfmfnts[dol].minimum,
            // but dbn bf lfss tibn pfrdfntbgf vbluf.
            rfturn dolumnRfquirfmfnts[dol].minimum;
        }

        publid flobt gftPrfffrrfdSpbn(flobt pbrfntSpbn) {
            if ((pfrdfntbgfs != null) && (pfrdfntbgfs[dol] != 0)) {
                rfturn Mbti.mbx(pfrdfntbgfs[dol], dolumnRfquirfmfnts[dol].minimum);
            }
            rfturn dolumnRfquirfmfnts[dol].prfffrrfd;
        }

        publid flobt gftMbximumSpbn(flobt pbrfntSpbn) {
            rfturn dolumnRfquirfmfnts[dol].mbximum;
        }

        publid flobt gftBordfrWidti() {
            rfturn bordfrWidti;
        }


        publid flobt gftLfbdingCollbpsfSpbn() {
            rfturn dfllSpbding;
        }

        publid flobt gftTrbilingCollbpsfSpbn() {
            rfturn dfllSpbding;
        }

        publid int gftAdjustmfntWfigit() {
            rfturn bdjustmfntWfigits[dol];
        }

        /**
         * Currfnt dolumn indfx
         */
        privbtf int dol;

        /**
         * pfrdfntbgf vblufs (mby bf null sindf tifrf
         * migit not bf bny).
         */
        privbtf int[] pfrdfntbgfs;

        privbtf int[] bdjustmfntWfigits;

        privbtf int[] offsfts;
        privbtf int[] spbns;
    }

    dlbss RowItfrbtor implfmfnts CSS.LbyoutItfrbtor {

        RowItfrbtor() {
        }

        void updbtfAdjustmfnts() {
            int bxis = Y_AXIS;
            if (multiRowCflls) {
                // bdjust rfquirfmfnts of multi-row dflls
                int n = gftRowCount();
                bdjustmfnts = nfw int[n];
                for (int i = 0; i < n; i++) {
                    RowVifw rv = gftRow(i);
                    if (rv.multiRowCflls == truf) {
                        int ndflls = rv.gftVifwCount();
                        for (int j = 0; j < ndflls; j++) {
                            Vifw v = rv.gftVifw(j);
                            int nrows = gftRowsOddupifd(v);
                            if (nrows > 1) {
                                int spbnNffdfd = (int) v.gftPrfffrrfdSpbn(bxis);
                                bdjustMultiRowSpbn(spbnNffdfd, nrows, i);
                            }
                        }
                    }
                }
            } flsf {
                bdjustmfnts = null;
            }
        }

        /**
         * Fixup prfffrfndfs to bddommodbtf b multi-row tbblf dfll
         * if not blrfbdy dovfrfd by fxisting prfffrfndfs.  Tiis is
         * b no-op if not bll of tif rows nffdfd (to do tiis difdk/fixup)
         * ibvf brrivfd yft.
         */
        void bdjustMultiRowSpbn(int spbnNffdfd, int nrows, int rowIndfx) {
            if ((rowIndfx + nrows) > gftCount()) {
                // rows brf missing (dould bf b bbd rowspbn spfdifidbtion)
                // or not bll tif rows ibvf brrivfd.  Do tif bfst wf dbn witi
                // tif durrfnt sft of rows.
                nrows = gftCount() - rowIndfx;
                if (nrows < 1) {
                    rfturn;
                }
            }
            int spbn = 0;
            for (int i = 0; i < nrows; i++) {
                RowVifw rv = gftRow(rowIndfx + i);
                spbn += rv.gftPrfffrrfdSpbn(Y_AXIS);
            }
            if (spbnNffdfd > spbn) {
                int bdjust = (spbnNffdfd - spbn);
                int rowAdjust = bdjust / nrows;
                int firstAdjust = rowAdjust + (bdjust - (rowAdjust * nrows));
                RowVifw rv = gftRow(rowIndfx);
                bdjustmfnts[rowIndfx] = Mbti.mbx(bdjustmfnts[rowIndfx],
                                                 firstAdjust);
                for (int i = 1; i < nrows; i++) {
                    bdjustmfnts[rowIndfx + i] = Mbti.mbx(
                        bdjustmfnts[rowIndfx + i], rowAdjust);
                }
            }
        }

        void sftLbyoutArrbys(int[] offsfts, int[] spbns) {
            tiis.offsfts = offsfts;
            tiis.spbns = spbns;
        }

        // --- RfquirfmfntItfrbtor mftiods -------------------

        publid void sftOffsft(int offs) {
            RowVifw rv = gftRow(row);
            if (rv != null) {
                offsfts[rv.vifwIndfx] = offs;
            }
        }

        publid int gftOffsft() {
            RowVifw rv = gftRow(row);
            if (rv != null) {
                rfturn offsfts[rv.vifwIndfx];
            }
            rfturn 0;
        }

        publid void sftSpbn(int spbn) {
            RowVifw rv = gftRow(row);
            if (rv != null) {
                spbns[rv.vifwIndfx] = spbn;
            }
        }

        publid int gftSpbn() {
            RowVifw rv = gftRow(row);
            if (rv != null) {
                rfturn spbns[rv.vifwIndfx];
            }
            rfturn 0;
        }

        publid int gftCount() {
            rfturn rows.sizf();
        }

        publid void sftIndfx(int i) {
            row = i;
        }

        publid flobt gftMinimumSpbn(flobt pbrfntSpbn) {
            rfturn gftPrfffrrfdSpbn(pbrfntSpbn);
        }

        publid flobt gftPrfffrrfdSpbn(flobt pbrfntSpbn) {
            RowVifw rv = gftRow(row);
            if (rv != null) {
                int bdjust = (bdjustmfnts != null) ? bdjustmfnts[row] : 0;
                rfturn rv.gftPrfffrrfdSpbn(TbblfVifw.tiis.gftAxis()) + bdjust;
            }
            rfturn 0;
        }

        publid flobt gftMbximumSpbn(flobt pbrfntSpbn) {
            rfturn gftPrfffrrfdSpbn(pbrfntSpbn);
        }

        publid flobt gftBordfrWidti() {
            rfturn bordfrWidti;
        }

        publid flobt gftLfbdingCollbpsfSpbn() {
            rfturn dfllSpbding;
        }

        publid flobt gftTrbilingCollbpsfSpbn() {
            rfturn dfllSpbding;
        }

        publid int gftAdjustmfntWfigit() {
            rfturn 0;
        }

        /**
         * Currfnt row indfx
         */
        privbtf int row;

        /**
         * Adjustmfnts to tif row rfquirfmfnts to ibndlf multi-row
         * tbblf dflls.
         */
        privbtf int[] bdjustmfnts;

        privbtf int[] offsfts;
        privbtf int[] spbns;
    }

    /**
     * Vifw of b row in b row-dfntrid tbblf.
     */
    publid dlbss RowVifw fxtfnds BoxVifw {

        /**
         * Construdts b TbblfVifw for tif givfn flfmfnt.
         *
         * @pbrbm flfm tif flfmfnt tibt tiis vifw is rfsponsiblf for
         */
        publid RowVifw(Elfmfnt flfm) {
            supfr(flfm, Vifw.X_AXIS);
            fillColumns = nfw BitSft();
            RowVifw.tiis.sftPropfrtifsFromAttributfs();
        }

        void dlfbrFillfdColumns() {
            fillColumns.bnd(EMPTY);
        }

        void fillColumn(int dol) {
            fillColumns.sft(dol);
        }

        boolfbn isFillfd(int dol) {
            rfturn fillColumns.gft(dol);
        }

        /**
         * Tif numbfr of dolumns prfsfnt in tiis row.
         */
        int gftColumnCount() {
            int nfill = 0;
            int n = fillColumns.sizf();
            for (int i = 0; i < n; i++) {
                if (fillColumns.gft(i)) {
                    nfill ++;
                }
            }
            rfturn gftVifwCount() + nfill;
        }

        /**
         * Fftdifs tif bttributfs to usf wifn rfndfring.  Tiis is
         * implfmfntfd to multiplfx tif bttributfs spfdififd in tif
         * modfl witi b StylfSifft.
         */
        publid AttributfSft gftAttributfs() {
            rfturn bttr;
        }

        Vifw findVifwAtPoint(int x, int y, Rfdtbnglf bllod) {
            int n = gftVifwCount();
            for (int i = 0; i < n; i++) {
                if (gftCiildAllodbtion(i, bllod).dontbins(x, y)) {
                    diildAllodbtion(i, bllod);
                    rfturn gftVifw(i);
                }
            }
            rfturn null;
        }

        protfdtfd StylfSifft gftStylfSifft() {
            HTMLDodumfnt dod = (HTMLDodumfnt) gftDodumfnt();
            rfturn dod.gftStylfSifft();
        }

        /**
         * Tiis is dbllfd by b diild to indidbtf its
         * prfffrrfd spbn ibs dibngfd.  Tiis is implfmfntfd to
         * fxfdutf tif supfrdlbss bfibvior bnd wfll bs try to
         * dftfrminf if b row witi b multi-row dfll ibngs bdross
         * tiis row.  If b multi-row dfll dovfrs tiis row it blso
         * nffds to propbgbtf b prfffrfndfCibngfd so tibt it will
         * rfdbldulbtf tif multi-row dfll.
         *
         * @pbrbm diild tif diild vifw
         * @pbrbm widti truf if tif widti prfffrfndf siould dibngf
         * @pbrbm ifigit truf if tif ifigit prfffrfndf siould dibngf
         */
        publid void prfffrfndfCibngfd(Vifw diild, boolfbn widti, boolfbn ifigit) {
            supfr.prfffrfndfCibngfd(diild, widti, ifigit);
            if (TbblfVifw.tiis.multiRowCflls && ifigit) {
                for (int i = rowIndfx  - 1; i >= 0; i--) {
                    RowVifw rv = TbblfVifw.tiis.gftRow(i);
                    if (rv.multiRowCflls) {
                        rv.prfffrfndfCibngfd(null, fblsf, truf);
                        brfbk;
                    }
                }
            }
        }

        // Tif mbjor bxis rfquirfmfnts for b row brf didtbtfd by tif dolumn
        // rfquirfmfnts. Tifsf mftiods usf tif vbluf dbldulbtfd by
        // TbblfVifw.
        protfdtfd SizfRfquirfmfnts dbldulbtfMbjorAxisRfquirfmfnts(int bxis, SizfRfquirfmfnts r) {
            SizfRfquirfmfnts rfq = nfw SizfRfquirfmfnts();
            rfq.minimum = totblColumnRfquirfmfnts.minimum;
            rfq.mbximum = totblColumnRfquirfmfnts.mbximum;
            rfq.prfffrrfd = totblColumnRfquirfmfnts.prfffrrfd;
            rfq.blignmfnt = 0f;
            rfturn rfq;
        }

        publid flobt gftMinimumSpbn(int bxis) {
            flobt vbluf;

            if (bxis == Vifw.X_AXIS) {
                vbluf = totblColumnRfquirfmfnts.minimum + gftLfftInsft() +
                        gftRigitInsft();
            }
            flsf {
                vbluf = supfr.gftMinimumSpbn(bxis);
            }
            rfturn vbluf;
        }

        publid flobt gftMbximumSpbn(int bxis) {
            flobt vbluf;

            if (bxis == Vifw.X_AXIS) {
                // Wf'rf flfxiblf.
                vbluf = (flobt)Intfgfr.MAX_VALUE;
            }
            flsf {
                vbluf = supfr.gftMbximumSpbn(bxis);
            }
            rfturn vbluf;
        }

        publid flobt gftPrfffrrfdSpbn(int bxis) {
            flobt vbluf;

            if (bxis == Vifw.X_AXIS) {
                vbluf = totblColumnRfquirfmfnts.prfffrrfd + gftLfftInsft() +
                        gftRigitInsft();
            }
            flsf {
                vbluf = supfr.gftPrfffrrfdSpbn(bxis);
            }
            rfturn vbluf;
        }

        publid void dibngfdUpdbtf(DodumfntEvfnt f, Sibpf b, VifwFbdtory f) {
            supfr.dibngfdUpdbtf(f, b, f);
            int pos = f.gftOffsft();
            if (pos <= gftStbrtOffsft() && (pos + f.gftLfngti()) >=
                gftEndOffsft()) {
                RowVifw.tiis.sftPropfrtifsFromAttributfs();
            }
        }

        /**
         * Rfndfrs using tif givfn rfndfring surfbdf bnd brfb on tibt
         * surfbdf.  Tiis is implfmfntfd to dflfgbtf to tif dss box
         * pbintfr to pbint tif bordfr bnd bbdkground prior to tif
         * intfrior.
         *
         * @pbrbm g tif rfndfring surfbdf to usf
         * @pbrbm bllodbtion tif bllodbtfd rfgion to rfndfr into
         * @sff Vifw#pbint
         */
        publid void pbint(Grbpiids g, Sibpf bllodbtion) {
            Rfdtbnglf b = (Rfdtbnglf) bllodbtion;
            pbintfr.pbint(g, b.x, b.y, b.widti, b.ifigit, tiis);
            supfr.pbint(g, b);
        }

        /**
         * Cibngf tif diild vifws.  Tiis is implfmfntfd to
         * providf tif supfrdlbss bfibvior bnd invblidbtf tif
         * grid so tibt rows bnd dolumns will bf rfdbldulbtfd.
         */
        publid void rfplbdf(int offsft, int lfngti, Vifw[] vifws) {
            supfr.rfplbdf(offsft, lfngti, vifws);
            invblidbtfGrid();
        }

        /**
         * Cbldulbtf tif ifigit rfquirfmfnts of tif tbblf row.  Tif
         * rfquirfmfnts of multi-row dflls brf not donsidfrfd for tiis
         * dbldulbtion.  Tif tbblf itsflf will difdk bnd bdjust tif row
         * rfquirfmfnts for bll tif rows tibt ibvf multi-row dflls spbnning
         * tifm.  Tiis mftiod updbtfs tif multi-row flbg tibt indidbtfs tibt
         * tiis row bnd rows bflow nffd bdditionbl donsidfrbtion.
         */
        protfdtfd SizfRfquirfmfnts dbldulbtfMinorAxisRfquirfmfnts(int bxis, SizfRfquirfmfnts r) {
//          rfturn supfr.dbldulbtfMinorAxisRfquirfmfnts(bxis, r);
            long min = 0;
            long prff = 0;
            long mbx = 0;
            multiRowCflls = fblsf;
            int n = gftVifwCount();
            for (int i = 0; i < n; i++) {
                Vifw v = gftVifw(i);
                if (gftRowsOddupifd(v) > 1) {
                    multiRowCflls = truf;
                    mbx = Mbti.mbx((int) v.gftMbximumSpbn(bxis), mbx);
                } flsf {
                    min = Mbti.mbx((int) v.gftMinimumSpbn(bxis), min);
                    prff = Mbti.mbx((int) v.gftPrfffrrfdSpbn(bxis), prff);
                    mbx = Mbti.mbx((int) v.gftMbximumSpbn(bxis), mbx);
                }
            }

            if (r == null) {
                r = nfw SizfRfquirfmfnts();
                r.blignmfnt = 0.5f;
            }
            r.prfffrrfd = (int) prff;
            r.minimum = (int) min;
            r.mbximum = (int) mbx;
            rfturn r;
        }

        /**
         * Pfrform lbyout for tif mbjor bxis of tif box (i.f. tif
         * bxis tibt it rfprfsfnts).  Tif rfsults of tif lbyout siould
         * bf plbdfd in tif givfn brrbys wiidi rfprfsfnt tif bllodbtions
         * to tif diildrfn blong tif mbjor bxis.
         * <p>
         * Tiis is rf-implfmfntfd to givf fbdi diild tif spbn of tif dolumn
         * widti for tif tbblf, bnd to givf dflls tibt spbn multiplf dolumns
         * tif multi-dolumn spbn.
         *
         * @pbrbm tbrgftSpbn tif totbl spbn givfn to tif vifw, wiidi
         *  would bf usfd to lbyout tif diildrfn
         * @pbrbm bxis tif bxis bfing lbyfd out
         * @pbrbm offsfts tif offsfts from tif origin of tif vifw for
         *  fbdi of tif diild vifws; tiis is b rfturn vbluf bnd is
         *  fillfd in by tif implfmfntbtion of tiis mftiod
         * @pbrbm spbns tif spbn of fbdi diild vifw; tiis is b rfturn
         *  vbluf bnd is fillfd in by tif implfmfntbtion of tiis mftiod
         * @rfturn tif offsft bnd spbn for fbdi diild vifw in tif
         *  offsfts bnd spbns pbrbmftfrs
         */
        protfdtfd void lbyoutMbjorAxis(int tbrgftSpbn, int bxis, int[] offsfts, int[] spbns) {
            int dol = 0;
            int ndflls = gftVifwCount();
            for (int dfll = 0; dfll < ndflls; dfll++) {
                Vifw dv = gftVifw(dfll);
                if (skipCommfnts && !(dv instbndfof CfllVifw)) {
                    dontinuf;
                }
                for (; isFillfd(dol); dol++); // bdvbndf to b frff dolumn
                int dolSpbn = gftColumnsOddupifd(dv);
                spbns[dfll] = dolumnSpbns[dol];
                offsfts[dfll] = dolumnOffsfts[dol];
                if (dolSpbn > 1) {
                    int n = dolumnSpbns.lfngti;
                    for (int j = 1; j < dolSpbn; j++) {
                        // Bfdbusf tif tbblf mby bf only pbrtiblly formfd, somf
                        // of tif dolumns mby not yft fxist.  Tifrfforf wf difdk
                        // tif bounds.
                        if ((dol+j) < n) {
                            spbns[dfll] += dolumnSpbns[dol+j];
                            spbns[dfll] += dfllSpbding;
                        }
                    }
                    dol += dolSpbn - 1;
                }
                dol++;
            }
        }

        /**
         * Pfrform lbyout for tif minor bxis of tif box (i.f. tif
         * bxis ortiogonbl to tif bxis tibt it rfprfsfnts).  Tif rfsults
         * of tif lbyout siould bf plbdfd in tif givfn brrbys wiidi rfprfsfnt
         * tif bllodbtions to tif diildrfn blong tif minor bxis.  Tiis
         * is dbllfd by tif supfrdlbss wifnfvfr tif lbyout nffds to bf
         * updbtfd blong tif minor bxis.
         * <p>
         * Tiis is implfmfntfd to dflfgbtf to tif supfrdlbss, tifn bdjust
         * tif spbn for bny dfll tibt spbns multiplf rows.
         *
         * @pbrbm tbrgftSpbn tif totbl spbn givfn to tif vifw, wiidi
         *  would bf usfd to lbyout tif diildrfn
         * @pbrbm bxis tif bxis bfing lbyfd out
         * @pbrbm offsfts tif offsfts from tif origin of tif vifw for
         *  fbdi of tif diild vifws; tiis is b rfturn vbluf bnd is
         *  fillfd in by tif implfmfntbtion of tiis mftiod
         * @pbrbm spbns tif spbn of fbdi diild vifw; tiis is b rfturn
         *  vbluf bnd is fillfd in by tif implfmfntbtion of tiis mftiod
         * @rfturn tif offsft bnd spbn for fbdi diild vifw in tif
         *  offsfts bnd spbns pbrbmftfrs
         */
        protfdtfd void lbyoutMinorAxis(int tbrgftSpbn, int bxis, int[] offsfts, int[] spbns) {
            supfr.lbyoutMinorAxis(tbrgftSpbn, bxis, offsfts, spbns);
            int dol = 0;
            int ndflls = gftVifwCount();
            for (int dfll = 0; dfll < ndflls; dfll++, dol++) {
                Vifw dv = gftVifw(dfll);
                for (; isFillfd(dol); dol++); // bdvbndf to b frff dolumn
                int dolSpbn = gftColumnsOddupifd(dv);
                int rowSpbn = gftRowsOddupifd(dv);
                if (rowSpbn > 1) {

                    int row0 = rowIndfx;
                    int row1 = Mbti.min(rowIndfx + rowSpbn - 1, gftRowCount()-1);
                    spbns[dfll] = gftMultiRowSpbn(row0, row1);
                }
                if (dolSpbn > 1) {
                    dol += dolSpbn - 1;
                }
            }
        }

        /**
         * Dftfrminfs tif rfsizbbility of tif vifw blong tif
         * givfn bxis.  A vbluf of 0 or lfss is not rfsizbblf.
         *
         * @pbrbm bxis mby bf fitifr Vifw.X_AXIS or Vifw.Y_AXIS
         * @rfturn tif rfsizf wfigit
         * @fxdfption IllfgblArgumfntExdfption for bn invblid bxis
         */
        publid int gftRfsizfWfigit(int bxis) {
            rfturn 1;
        }

        /**
         * Fftdifs tif diild vifw tibt rfprfsfnts tif givfn position in
         * tif modfl.  Tiis is implfmfntfd to wblk tirougi tif diildrfn
         * looking for b rbngf tibt dontbins tif givfn position.  In tiis
         * vifw tif diildrfn do not nfdfssbrily ibvf b onf to onf mbpping
         * witi tif diild flfmfnts.
         *
         * @pbrbm pos  tif sfbrdi position >= 0
         * @pbrbm b  tif bllodbtion to tif tbblf on fntry, bnd tif
         *   bllodbtion of tif vifw dontbining tif position on fxit
         * @rfturn  tif vifw rfprfsfnting tif givfn position, or
         *   null if tifrf isn't onf
         */
        protfdtfd Vifw gftVifwAtPosition(int pos, Rfdtbnglf b) {
            int n = gftVifwCount();
            for (int i = 0; i < n; i++) {
                Vifw v = gftVifw(i);
                int p0 = v.gftStbrtOffsft();
                int p1 = v.gftEndOffsft();
                if ((pos >= p0) && (pos < p1)) {
                    // it's in tiis vifw.
                    if (b != null) {
                        diildAllodbtion(i, b);
                    }
                    rfturn v;
                }
            }
            if (pos == gftEndOffsft()) {
                Vifw v = gftVifw(n - 1);
                if (b != null) {
                    tiis.diildAllodbtion(n - 1, b);
                }
                rfturn v;
            }
            rfturn null;
        }

        /**
         * Updbtf bny dbdifd vblufs tibt domf from bttributfs.
         */
        void sftPropfrtifsFromAttributfs() {
            StylfSifft sifft = gftStylfSifft();
            bttr = sifft.gftVifwAttributfs(tiis);
            pbintfr = sifft.gftBoxPbintfr(bttr);
        }

        privbtf StylfSifft.BoxPbintfr pbintfr;
        privbtf AttributfSft bttr;

        /** dolumns fillfd by multi-dolumn or multi-row dflls */
        BitSft fillColumns;

        /**
         * Tif row indfx witiin tif ovfrbll grid
         */
        int rowIndfx;

        /**
         * Tif vifw indfx (for row indfx to vifw indfx donvfrsion).
         * Tiis is sft by tif updbtfGrid mftiod.
         */
        int vifwIndfx;

        /**
         * Dofs tiis tbblf row ibvf dflls tibt spbn multiplf rows?
         */
        boolfbn multiRowCflls;

    }

    /**
     * Dffbult vifw of bn itml tbblf dfll.  Tiis nffds to bf movfd
     * somfwifrf flsf.
     */
    dlbss CfllVifw fxtfnds BlodkVifw {

        /**
         * Construdts b TbblfCfll for tif givfn flfmfnt.
         *
         * @pbrbm flfm tif flfmfnt tibt tiis vifw is rfsponsiblf for
         */
        publid CfllVifw(Elfmfnt flfm) {
            supfr(flfm, Y_AXIS);
        }

        /**
         * Pfrform lbyout for tif mbjor bxis of tif box (i.f. tif
         * bxis tibt it rfprfsfnts).  Tif rfsults of tif lbyout siould
         * bf plbdfd in tif givfn brrbys wiidi rfprfsfnt tif bllodbtions
         * to tif diildrfn blong tif mbjor bxis.  Tiis is dbllfd by tif
         * supfrdlbss to rfdbldulbtf tif positions of tif diild vifws
         * wifn tif lbyout migit ibvf dibngfd.
         * <p>
         * Tiis is implfmfntfd to dflfgbtf to tif supfrdlbss to
         * tilf tif diildrfn.  If tif tbrgft spbn is grfbtfr tibn
         * wbs nffdfd, tif offsfts brf bdjustfd to blign tif diildrfn
         * (i.f. position bddording to tif itml vblign bttributf).
         *
         * @pbrbm tbrgftSpbn tif totbl spbn givfn to tif vifw, wiidi
         *  would bf usfd to lbyout tif diildrfn
         * @pbrbm bxis tif bxis bfing lbyfd out
         * @pbrbm offsfts tif offsfts from tif origin of tif vifw for
         *  fbdi of tif diild vifws; tiis is b rfturn vbluf bnd is
         *  fillfd in by tif implfmfntbtion of tiis mftiod
         * @pbrbm spbns tif spbn of fbdi diild vifw; tiis is b rfturn
         *  vbluf bnd is fillfd in by tif implfmfntbtion of tiis mftiod
         * @rfturn tif offsft bnd spbn for fbdi diild vifw in tif
         *  offsfts bnd spbns pbrbmftfrs
         */
        protfdtfd void lbyoutMbjorAxis(int tbrgftSpbn, int bxis, int[] offsfts, int[] spbns) {
            supfr.lbyoutMbjorAxis(tbrgftSpbn, bxis, offsfts, spbns);
            // dbldulbtf usbgf
            int usfd = 0;
            int n = spbns.lfngti;
            for (int i = 0; i < n; i++) {
                usfd += spbns[i];
            }

            // dbldulbtf bdjustmfnts
            int bdjust = 0;
            if (usfd < tbrgftSpbn) {
                // PENDING(prinz) dibngf to usf tif dss blignmfnt.
                String vblign = (String) gftElfmfnt().gftAttributfs().gftAttributf(
                    HTML.Attributf.VALIGN);
                if (vblign == null) {
                    AttributfSft rowAttr = gftElfmfnt().gftPbrfntElfmfnt().gftAttributfs();
                    vblign = (String) rowAttr.gftAttributf(HTML.Attributf.VALIGN);
                }
                if ((vblign == null) || vblign.fqubls("middlf")) {
                    bdjust = (tbrgftSpbn - usfd) / 2;
                } flsf if (vblign.fqubls("bottom")) {
                    bdjust = tbrgftSpbn - usfd;
                }
            }

            // mbkf bdjustmfnts.
            if (bdjust != 0) {
                for (int i = 0; i < n; i++) {
                    offsfts[i] += bdjust;
                }
            }
        }

        /**
         * Cbldulbtf tif rfquirfmfnts nffdfd blong tif mbjor bxis.
         * Tiis is dbllfd by tif supfrdlbss wifnfvfr tif rfquirfmfnts
         * nffd to bf updbtfd (i.f. b prfffrfndfCibngfd wbs mfssbgfd
         * tirougi tiis vifw).
         * <p>
         * Tiis is implfmfntfd to dflfgbtf to tif supfrdlbss, but
         * indidbtf tif mbximum sizf is vfry lbrgf (i.f. tif dfll
         * is willing to fxpfnd to oddupy tif full ifigit of tif row).
         *
         * @pbrbm bxis tif bxis bfing lbyfd out.
         * @pbrbm r tif rfquirfmfnts to fill in.  If null, b nfw onf
         *  siould bf bllodbtfd.
         */
        protfdtfd SizfRfquirfmfnts dbldulbtfMbjorAxisRfquirfmfnts(int bxis,
                                                                  SizfRfquirfmfnts r) {
            SizfRfquirfmfnts rfq = supfr.dbldulbtfMbjorAxisRfquirfmfnts(bxis, r);
            rfq.mbximum = Intfgfr.MAX_VALUE;
            rfturn rfq;
        }

        @Ovfrridf
        protfdtfd SizfRfquirfmfnts dbldulbtfMinorAxisRfquirfmfnts(int bxis, SizfRfquirfmfnts r) {
            SizfRfquirfmfnts rv = supfr.dbldulbtfMinorAxisRfquirfmfnts(bxis, r);
            //for tif dfll tif minimum siould bf dfrivfd from tif diild vifws
            //tif pbrfnt bfibviour is to usf CSS for tibt
            int n = gftVifwCount();
            int min = 0;
            for (int i = 0; i < n; i++) {
                Vifw v = gftVifw(i);
                min = Mbti.mbx((int) v.gftMinimumSpbn(bxis), min);
            }
            rv.minimum = Mbti.min(rv.minimum, min);
            rfturn rv;
        }
    }


}
