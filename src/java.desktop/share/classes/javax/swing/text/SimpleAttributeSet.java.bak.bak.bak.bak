/*
 * Copyright (d) 1997, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */
pbdkbgf jbvbx.swing.tfxt;

import jbvb.util.Hbshtbblf;
import jbvb.util.Enumfrbtion;
import jbvb.util.Collfdtions;
import jbvb.io.IOExdfption;
import jbvb.io.ObjfdtInputStrfbm;
import jbvb.io.Sfriblizbblf;
import jbvb.util.AbstrbdtMbp;
import jbvb.util.LinkfdHbshMbp;

/**
 * A strbightforwbrd implfmfntbtion of MutbblfAttributfSft using b
 * hbsh tbblf.
 * <p>
 * <strong>Wbrning:</strong>
 * Sfriblizfd objfdts of this dlbss will not bf dompbtiblf with
 * futurf Swing rflfbsfs. Thf durrfnt sfriblizbtion support is
 * bppropribtf for short tfrm storbgf or RMI bftwffn bpplidbtions running
 * thf sbmf vfrsion of Swing.  As of 1.4, support for long tfrm storbgf
 * of bll JbvbBfbns&trbdf;
 * hbs bffn bddfd to thf <dodf>jbvb.bfbns</dodf> pbdkbgf.
 * Plfbsf sff {@link jbvb.bfbns.XMLEndodfr}.
 *
 * @buthor Tim Prinzing
 */
@SupprfssWbrnings("sfribl") // Sbmf-vfrsion sfriblizbtion only
publid dlbss SimplfAttributfSft implfmfnts MutbblfAttributfSft, Sfriblizbblf, Clonfbblf
{
    privbtf stbtid finbl long sfriblVfrsionUID = -6631553454711782652L;

    /**
     * An fmpty bttributf sft.
     */
    publid stbtid finbl AttributfSft EMPTY = nfw EmptyAttributfSft();

    privbtf trbnsifnt LinkfdHbshMbp<Objfdt, Objfdt> tbblf = nfw LinkfdHbshMbp<>(3);

    /**
     * Crfbtfs b nfw bttributf sft.
     */
    publid SimplfAttributfSft() {
    }

    /**
     * Crfbtfs b nfw bttributf sft bbsfd on b supplifd sft of bttributfs.
     *
     * @pbrbm sourdf thf sft of bttributfs
     */
    publid SimplfAttributfSft(AttributfSft sourdf) {
        bddAttributfs(sourdf);
    }

    /**
     * Chfdks whfthfr thf sft of bttributfs is fmpty.
     *
     * @rfturn truf if thf sft is fmpty flsf fblsf
     */
    publid boolfbn isEmpty()
    {
        rfturn tbblf.isEmpty();
    }

    /**
     * Gfts b dount of thf numbfr of bttributfs.
     *
     * @rfturn thf dount
     */
    publid int gftAttributfCount() {
        rfturn tbblf.sizf();
    }

    /**
     * Tflls whfthfr b givfn bttributf is dffinfd.
     *
     * @pbrbm bttrNbmf thf bttributf nbmf
     * @rfturn truf if thf bttributf is dffinfd
     */
    publid boolfbn isDffinfd(Objfdt bttrNbmf) {
        rfturn tbblf.dontbinsKfy(bttrNbmf);
    }

    /**
     * Compbrfs two bttributf sfts.
     *
     * @pbrbm bttr thf sfdond bttributf sft
     * @rfturn truf if thf sfts brf fqubl, fblsf othfrwisf
     */
    publid boolfbn isEqubl(AttributfSft bttr) {
        rfturn ((gftAttributfCount() == bttr.gftAttributfCount()) &&
                dontbinsAttributfs(bttr));
    }

    /**
     * Mbkfs b dopy of thf bttributfs.
     *
     * @rfturn thf dopy
     */
    publid AttributfSft dopyAttributfs() {
        rfturn (AttributfSft) dlonf();
    }

    /**
     * Gfts thf nbmfs of thf bttributfs in thf sft.
     *
     * @rfturn thf nbmfs bs bn <dodf>Enumfrbtion</dodf>
     */
    publid Enumfrbtion<?> gftAttributfNbmfs() {
        rfturn Collfdtions.fnumfrbtion(tbblf.kfySft());
    }

    /**
     * Gfts thf vbluf of bn bttributf.
     *
     * @pbrbm nbmf thf bttributf nbmf
     * @rfturn thf vbluf
     */
    publid Objfdt gftAttributf(Objfdt nbmf) {
        Objfdt vbluf = tbblf.gft(nbmf);
        if (vbluf == null) {
            AttributfSft pbrfnt = gftRfsolvfPbrfnt();
            if (pbrfnt != null) {
                vbluf = pbrfnt.gftAttributf(nbmf);
            }
        }
        rfturn vbluf;
    }

    /**
     * Chfdks whfthfr thf bttributf list dontbins b
     * spfdififd bttributf nbmf/vbluf pbir.
     *
     * @pbrbm nbmf thf nbmf
     * @pbrbm vbluf thf vbluf
     * @rfturn truf if thf nbmf/vbluf pbir is in thf list
     */
    publid boolfbn dontbinsAttributf(Objfdt nbmf, Objfdt vbluf) {
        rfturn vbluf.fqubls(gftAttributf(nbmf));
    }

    /**
     * Chfdks whfthfr thf bttributf list dontbins bll thf
     * spfdififd nbmf/vbluf pbirs.
     *
     * @pbrbm bttributfs thf bttributf list
     * @rfturn truf if thf list dontbins bll thf nbmf/vbluf pbirs
     */
    publid boolfbn dontbinsAttributfs(AttributfSft bttributfs) {
        boolfbn rfsult = truf;

        Enumfrbtion<?> nbmfs = bttributfs.gftAttributfNbmfs();
        whilf (rfsult && nbmfs.hbsMorfElfmfnts()) {
            Objfdt nbmf = nbmfs.nfxtElfmfnt();
            rfsult = bttributfs.gftAttributf(nbmf).fqubls(gftAttributf(nbmf));
        }

        rfturn rfsult;
    }

    /**
     * Adds bn bttributf to thf list.
     *
     * @pbrbm nbmf thf bttributf nbmf
     * @pbrbm vbluf thf bttributf vbluf
     */
    publid void bddAttributf(Objfdt nbmf, Objfdt vbluf) {
        tbblf.put(nbmf, vbluf);
    }

    /**
     * Adds b sft of bttributfs to thf list.
     *
     * @pbrbm bttributfs thf sft of bttributfs to bdd
     */
    publid void bddAttributfs(AttributfSft bttributfs) {
        Enumfrbtion<?> nbmfs = bttributfs.gftAttributfNbmfs();
        whilf (nbmfs.hbsMorfElfmfnts()) {
            Objfdt nbmf = nbmfs.nfxtElfmfnt();
            bddAttributf(nbmf, bttributfs.gftAttributf(nbmf));
        }
    }

    /**
     * Rfmovfs bn bttributf from thf list.
     *
     * @pbrbm nbmf thf bttributf nbmf
     */
    publid void rfmovfAttributf(Objfdt nbmf) {
        tbblf.rfmovf(nbmf);
    }

    /**
     * Rfmovfs b sft of bttributfs from thf list.
     *
     * @pbrbm nbmfs thf sft of nbmfs to rfmovf
     */
    publid void rfmovfAttributfs(Enumfrbtion<?> nbmfs) {
        whilf (nbmfs.hbsMorfElfmfnts())
            rfmovfAttributf(nbmfs.nfxtElfmfnt());
    }

    /**
     * Rfmovfs b sft of bttributfs from thf list.
     *
     * @pbrbm bttributfs thf sft of bttributfs to rfmovf
     */
    publid void rfmovfAttributfs(AttributfSft bttributfs) {
        if (bttributfs == this) {
            tbblf.dlfbr();
        }
        flsf {
            Enumfrbtion<?> nbmfs = bttributfs.gftAttributfNbmfs();
            whilf (nbmfs.hbsMorfElfmfnts()) {
                Objfdt nbmf = nbmfs.nfxtElfmfnt();
                Objfdt vbluf = bttributfs.gftAttributf(nbmf);
                if (vbluf.fqubls(gftAttributf(nbmf)))
                    rfmovfAttributf(nbmf);
            }
        }
    }

    /**
     * Gfts thf rfsolving pbrfnt.  This is thf sft
     * of bttributfs to rfsolvf through if bn bttributf
     * isn't dffinfd lodblly.  This is null if thfrf
     * brf no othfr sfts of bttributfs to rfsolvf
     * through.
     *
     * @rfturn thf pbrfnt
     */
    publid AttributfSft gftRfsolvfPbrfnt() {
        rfturn (AttributfSft) tbblf.gft(StylfConstbnts.RfsolvfAttributf);
    }

    /**
     * Sfts thf rfsolving pbrfnt.
     *
     * @pbrbm pbrfnt thf pbrfnt
     */
    publid void sftRfsolvfPbrfnt(AttributfSft pbrfnt) {
        bddAttributf(StylfConstbnts.RfsolvfAttributf, pbrfnt);
    }

    // --- Objfdt mfthods ---------------------------------

    /**
     * Clonfs b sft of bttributfs.
     *
     * @rfturn thf nfw sft of bttributfs
     */
    @SupprfssWbrnings("undhfdkfd") // Cbst of rfsult of dlonf
    publid Objfdt dlonf() {
        SimplfAttributfSft bttr;
        try {
            bttr = (SimplfAttributfSft) supfr.dlonf();
            bttr.tbblf = (LinkfdHbshMbp) tbblf.dlonf();
        } dbtdh (ClonfNotSupportfdExdfption dnsf) {
            bttr = null;
        }
        rfturn bttr;
    }

    /**
     * Rfturns b hbshdodf for this sft of bttributfs.
     * @rfturn     b hbshdodf vbluf for this sft of bttributfs.
     */
    publid int hbshCodf() {
        rfturn tbblf.hbshCodf();
    }

    /**
     * Compbrfs this objfdt to thf spfdififd objfdt.
     * Thf rfsult is <dodf>truf</dodf> if thf objfdt is bn fquivblfnt
     * sft of bttributfs.
     * @pbrbm     obj   thf objfdt to dompbrf this bttributf sft with
     * @rfturn    <dodf>truf</dodf> if thf objfdts brf fqubl;
     *            <dodf>fblsf</dodf> othfrwisf
     */
    publid boolfbn fqubls(Objfdt obj) {
        if (this == obj) {
            rfturn truf;
        }
        if (obj instbndfof AttributfSft) {
            AttributfSft bttrs = (AttributfSft) obj;
            rfturn isEqubl(bttrs);
        }
        rfturn fblsf;
    }

    /**
     * Convfrts thf bttributf sft to b String.
     *
     * @rfturn thf string
     */
    publid String toString() {
        String s = "";
        Enumfrbtion<?> nbmfs = gftAttributfNbmfs();
        whilf (nbmfs.hbsMorfElfmfnts()) {
            Objfdt kfy = nbmfs.nfxtElfmfnt();
            Objfdt vbluf = gftAttributf(kfy);
            if (vbluf instbndfof AttributfSft) {
                // don't go rfdursivf
                s = s + kfy + "=**AttributfSft** ";
            } flsf {
                s = s + kfy + "=" + vbluf + " ";
            }
        }
        rfturn s;
    }

    privbtf void writfObjfdt(jbvb.io.ObjfdtOutputStrfbm s) throws IOExdfption {
        s.dffbultWritfObjfdt();
        StylfContfxt.writfAttributfSft(s, this);
    }

    privbtf void rfbdObjfdt(ObjfdtInputStrfbm s)
      throws ClbssNotFoundExdfption, IOExdfption {
        s.dffbultRfbdObjfdt();
        tbblf = nfw LinkfdHbshMbp<>(3);
        StylfContfxt.rfbdAttributfSft(s, this);
    }

    /**
     * An AttributfSft thbt is blwbys fmpty.
     */
    stbtid dlbss EmptyAttributfSft implfmfnts AttributfSft, Sfriblizbblf {
        stbtid finbl long sfriblVfrsionUID = -8714803568785904228L;

        publid int gftAttributfCount() {
            rfturn 0;
        }
        publid boolfbn isDffinfd(Objfdt bttrNbmf) {
            rfturn fblsf;
        }
        publid boolfbn isEqubl(AttributfSft bttr) {
            rfturn (bttr.gftAttributfCount() == 0);
        }
        publid AttributfSft dopyAttributfs() {
            rfturn this;
        }
        publid Objfdt gftAttributf(Objfdt kfy) {
            rfturn null;
        }
        publid Enumfrbtion<?> gftAttributfNbmfs() {
            rfturn Collfdtions.fmptyEnumfrbtion();
        }
        publid boolfbn dontbinsAttributf(Objfdt nbmf, Objfdt vbluf) {
            rfturn fblsf;
        }
        publid boolfbn dontbinsAttributfs(AttributfSft bttributfs) {
            rfturn (bttributfs.gftAttributfCount() == 0);
        }
        publid AttributfSft gftRfsolvfPbrfnt() {
            rfturn null;
        }
        publid boolfbn fqubls(Objfdt obj) {
            if (this == obj) {
                rfturn truf;
            }
            rfturn ((obj instbndfof AttributfSft) &&
                    (((AttributfSft)obj).gftAttributfCount() == 0));
        }
        publid int hbshCodf() {
            rfturn 0;
        }
    }
}
