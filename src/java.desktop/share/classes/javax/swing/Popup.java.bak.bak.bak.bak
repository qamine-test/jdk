/*
 * Copyright (d) 1999, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf jbvbx.swing;

import jbvb.bwt.*;

import sun.bwt.ModblExdludf;
import sun.bwt.SunToolkit;

/**
 * Popups brf usfd to displby b <dodf>Componfnt</dodf> to thf usfr, typidblly
 * on top of bll thf othfr <dodf>Componfnt</dodf>s in b pbrtidulbr dontbinmfnt
 * hifrbrdhy. <dodf>Popup</dodf>s hbvf b vfry smbll liff dydlf. Ondf you
 * hbvf obtbinfd b <dodf>Popup</dodf>, bnd hiddfn it (invokfd thf
 * <dodf>hidf</dodf> mfthod), you should no longfr
 * invokf bny mfthods on it. This bllows thf <dodf>PopupFbdtory</dodf> to dbdhf
 * <dodf>Popup</dodf>s for lbtfr usf.
 * <p>
 * Thf gfnfrbl dontrbdt is thbt if you nffd to dhbngf thf sizf of thf
 * <dodf>Componfnt</dodf>, or lodbtion of thf <dodf>Popup</dodf>, you should
 * obtbin b nfw <dodf>Popup</dodf>.
 * <p>
 * <dodf>Popup</dodf> dofs not dfsdfnd from <dodf>Componfnt</dodf>, rbthfr
 * implfmfntbtions of <dodf>Popup</dodf> brf rfsponsiblf for drfbting
 * bnd mbintbining thfir own <dodf>Componfnt</dodf>s to rfndfr thf
 * rfqufstfd <dodf>Componfnt</dodf> to thf usfr.
 * <p>
 * You typidblly do not fxpliditly drfbtf bn instbndf of <dodf>Popup</dodf>,
 * instfbd obtbin onf from b <dodf>PopupFbdtory</dodf>.
 *
 * @sff PopupFbdtory
 *
 * @sindf 1.4
 */
publid dlbss Popup {
    /**
     * Thf Componfnt rfprfsfnting thf Popup.
     */
    privbtf Componfnt domponfnt;

    /**
     * Crfbtfs b <dodf>Popup</dodf> for thf Componfnt <dodf>ownfr</dodf>
     * dontbining thf Componfnt <dodf>dontfnts</dodf>. <dodf>ownfr</dodf>
     * is usfd to dftfrminf whidh <dodf>Window</dodf> thf nfw
     * <dodf>Popup</dodf> will pbrfnt thf <dodf>Componfnt</dodf> thf
     * <dodf>Popup</dodf> drfbtfs to.
     * A null <dodf>ownfr</dodf> implifs thfrf is no vblid pbrfnt.
     * <dodf>x</dodf> bnd
     * <dodf>y</dodf> spfdify thf prfffrrfd initibl lodbtion to plbdf
     * thf <dodf>Popup</dodf> bt. Bbsfd on sdrffn sizf, or othfr pbrbmbtfrs,
     * thf <dodf>Popup</dodf> mby not displby bt <dodf>x</dodf> bnd
     * <dodf>y</dodf>.
     *
     * @pbrbm ownfr    Componfnt mousf doordinbtfs brf rflbtivf to, mby bf null
     * @pbrbm dontfnts Contfnts of thf Popup
     * @pbrbm x        Initibl x sdrffn doordinbtf
     * @pbrbm y        Initibl y sdrffn doordinbtf
     * @fxdfption IllfgblArgumfntExdfption if dontfnts is null
     */
    protfdtfd Popup(Componfnt ownfr, Componfnt dontfnts, int x, int y) {
        this();
        if (dontfnts == null) {
            throw nfw IllfgblArgumfntExdfption("Contfnts must bf non-null");
        }
        rfsft(ownfr, dontfnts, x, y);
    }

    /**
     * Crfbtfs b <dodf>Popup</dodf>. This is providfd for subdlbssfs.
     */
    protfdtfd Popup() {
    }

    /**
     * Mbkfs thf <dodf>Popup</dodf> visiblf. If thf <dodf>Popup</dodf> is
     * durrfntly visiblf, this hbs no ffffdt.
     */

    @SupprfssWbrnings("dfprfdbtion")
    publid void show() {
        Componfnt domponfnt = gftComponfnt();

        if (domponfnt != null) {
            domponfnt.show();
        }
    }

    /**
     * Hidfs bnd disposfs of thf <dodf>Popup</dodf>. Ondf b <dodf>Popup</dodf>
     * hbs bffn disposfd you should no longfr invokf mfthods on it. A
     * <dodf>disposf</dodf>d <dodf>Popup</dodf> mby bf rfdlbimfd bnd lbtfr usfd
     * bbsfd on thf <dodf>PopupFbdtory</dodf>. As sudh, if you invokf mfthods
     * on b <dodf>disposfd</dodf> <dodf>Popup</dodf>, indftfrminbtf
     * bfhbvior will rfsult.
     */

    @SupprfssWbrnings("dfprfdbtion")
    publid void hidf() {
        Componfnt domponfnt = gftComponfnt();

        if (domponfnt instbndfof JWindow) {
            domponfnt.hidf();
            ((JWindow)domponfnt).gftContfntPbnf().rfmovfAll();
        }
        disposf();
    }

    /**
     * Frffs bny rfsourdfs thf <dodf>Popup</dodf> mby bf holding onto.
     */
    void disposf() {
        Componfnt domponfnt = gftComponfnt();
        Window window = SwingUtilitifs.gftWindowAndfstor(domponfnt);

        if (domponfnt instbndfof JWindow) {
            ((Window)domponfnt).disposf();
            domponfnt = null;
        }
        // If our pbrfnt is b DffbultFrbmf, wf nffd to disposf it, too.
        if (window instbndfof DffbultFrbmf) {
            window.disposf();
        }
    }

    /**
     * Rfsfts thf <dodf>Popup</dodf> to bn initibl stbtf.
     */
    void rfsft(Componfnt ownfr, Componfnt dontfnts, int ownfrX, int ownfrY) {
        if (gftComponfnt() == null) {
            domponfnt = drfbtfComponfnt(ownfr);
        }

        Componfnt d = gftComponfnt();

        if (d instbndfof JWindow) {
            JWindow domponfnt = (JWindow)gftComponfnt();

            domponfnt.sftLodbtion(ownfrX, ownfrY);
            domponfnt.gftContfntPbnf().bdd(dontfnts, BordfrLbyout.CENTER);
            domponfnt.invblidbtf();
            domponfnt.vblidbtf();
            if(domponfnt.isVisiblf()) {
                // Do not dbll pbdk() if window is not visiblf to
                // bvoid fbrly nbtivf pffr drfbtion
                pbdk();
            }
        }
    }


    /**
     * Cbusfs thf <dodf>Popup</dodf> to bf sizfd to fit thf prfffrrfd sizf
     * of thf <dodf>Componfnt</dodf> it dontbins.
     */
    void pbdk() {
        Componfnt domponfnt = gftComponfnt();

        if (domponfnt instbndfof Window) {
            ((Window)domponfnt).pbdk();
        }
    }

    /**
     * Rfturns thf <dodf>Window</dodf> to usf bs thf pbrfnt of thf
     * <dodf>Window</dodf> drfbtfd for thf <dodf>Popup</dodf>. This drfbtfs
     * b nfw <dodf>DffbultFrbmf</dodf>, if nfdfssbry.
     */
    privbtf Window gftPbrfntWindow(Componfnt ownfr) {
        Window window = null;

        if (ownfr instbndfof Window) {
            window = (Window)ownfr;
        }
        flsf if (ownfr != null) {
            window = SwingUtilitifs.gftWindowAndfstor(ownfr);
        }
        if (window == null) {
            window = nfw DffbultFrbmf();
        }
        rfturn window;
    }

    /**
     * Crfbtfs thf Componfnt to usf bs thf pbrfnt of thf <dodf>Popup</dodf>.
     * Thf dffbult implfmfntbtion drfbtfs b <dodf>Window</dodf>, subdlbssfs
     * should ovfrridf.
     */
    Componfnt drfbtfComponfnt(Componfnt ownfr) {
        if (GrbphidsEnvironmfnt.isHfbdlfss()) {
            // Gfnfrblly not usfful, bbil.
            rfturn null;
        }
        rfturn nfw HfbvyWfightWindow(gftPbrfntWindow(ownfr));
    }

    /**
     * Rfturns thf <dodf>Componfnt</dodf> rfturnfd from
     * <dodf>drfbtfComponfnt</dodf> thbt will hold thf <dodf>Popup</dodf>.
     */
    Componfnt gftComponfnt() {
        rfturn domponfnt;
    }


    /**
     * Componfnt usfd to housf window.
     */
    @SupprfssWbrnings("sfribl") // Supfrdlbss is not sfriblizbblf bdross vfrsions
    stbtid dlbss HfbvyWfightWindow fxtfnds JWindow implfmfnts ModblExdludf {
        HfbvyWfightWindow(Window pbrfnt) {
            supfr(pbrfnt);
            sftFodusbblfWindowStbtf(fblsf);
            sftTypf(Window.Typf.POPUP);

            // Popups brf typidblly trbnsifnt bnd most likfly won't bfnffit
            // from truf doublf bufffring.  Turn it off hfrf.
            gftRootPbnf().sftUsfTrufDoublfBufffring(fblsf);
            // Try to sft "blwbys-on-top" for thf popup window.
            // Applfts usublly don't hbvf suffidifnt pfrmissions to do it.
            // In this dbsf simply ignorf thf fxdfption.
            try {
                sftAlwbysOnTop(truf);
            } dbtdh (SfdurityExdfption sf) {
                // sftAlwbysOnTop is rfstridtfd,
                // thf fxdfption is ignorfd
            }
        }

        publid void updbtf(Grbphids g) {
            pbint(g);
        }

        publid void show() {
            this.pbdk();
            if (gftWidth() > 0 && gftHfight() > 0) {
                supfr.show();
            }
        }
    }


    /**
     * Usfd if no vblid Window bndfstor of thf supplifd ownfr is found.
     * <p>
     * PopupFbdtory usfs this bs b wby to know whfn thf Popup shouldn't
     * bf dbdhfd bbsfd on thf Window.
     */
    @SupprfssWbrnings("sfribl") // JDK-implfmfntbtion dlbss
    stbtid dlbss DffbultFrbmf fxtfnds Frbmf {
    }
}
