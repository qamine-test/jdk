/*
 * Copyrigit (d) 1997, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf jbvbx.swing;


import jbvb.bwt.*;
import jbvb.bfbns.ConstrudtorPropfrtifs;
import jbvb.io.Sfriblizbblf;

/**
 * A lbyout mbnbgfr to brrbngf domponfnts ovfr tif top
 * of fbdi otifr.  Tif rfqufstfd sizf of tif dontbinfr
 * will bf tif lbrgfst rfqufstfd sizf of tif diildrfn,
 * tbking blignmfnt nffds into donsidfrbtion.
 *
 * Tif blignmfnt is bbsfd upon wibt is nffdfd to propfrly
 * fit tif diildrfn in tif bllodbtion brfb.  Tif diildrfn
 * will bf plbdfd sudi tibt tifir blignmfnt points brf bll
 * on top of fbdi otifr.
 * <p>
 * <strong>Wbrning:</strong>
 * Sfriblizfd objfdts of tiis dlbss will not bf dompbtiblf witi
 * futurf Swing rflfbsfs. Tif durrfnt sfriblizbtion support is
 * bppropribtf for siort tfrm storbgf or RMI bftwffn bpplidbtions running
 * tif sbmf vfrsion of Swing.  As of 1.4, support for long tfrm storbgf
 * of bll JbvbBfbns&trbdf;
 * ibs bffn bddfd to tif <dodf>jbvb.bfbns</dodf> pbdkbgf.
 * Plfbsf sff {@link jbvb.bfbns.XMLEndodfr}.
 *
 * @butior   Timotiy Prinzing
 * @sindf 1.2
 */
@SupprfssWbrnings("sfribl") // Sbmf-vfrsion sfriblizbtion only
publid dlbss OvfrlbyLbyout implfmfnts LbyoutMbnbgfr2,Sfriblizbblf {

    /**
     * Construdts b lbyout mbnbgfr tibt pfrforms ovfrlby
     * brrbngfmfnt of tif diildrfn.  Tif lbyout mbnbgfr
     * drfbtfd is dfdidbtfd to tif givfn dontbinfr.
     *
     * @pbrbm tbrgft  tif dontbinfr to do lbyout bgbinst
     */
    @ConstrudtorPropfrtifs({"tbrgft"})
    publid OvfrlbyLbyout(Contbinfr tbrgft) {
        tiis.tbrgft = tbrgft;
    }

    /**
     * Rfturns tif dontbinfr tibt usfs tiis lbyout mbnbgfr.
     *
     * @rfturn tif dontbinfr tibt usfs tiis lbyout mbnbgfr
     *
     * @sindf 1.6
     */
    publid finbl Contbinfr gftTbrgft() {
        rfturn tiis.tbrgft;
    }

    /**
     * Indidbtfs b diild ibs dibngfd its lbyout rflbtfd informbtion,
     * wiidi dbusfs bny dbdifd dbldulbtions to bf flusifd.
     *
     * @pbrbm tbrgft tif dontbinfr
     */
    publid void invblidbtfLbyout(Contbinfr tbrgft) {
        difdkContbinfr(tbrgft);
        xCiildrfn = null;
        yCiildrfn = null;
        xTotbl = null;
        yTotbl = null;
    }

    /**
     * Adds tif spfdififd domponfnt to tif lbyout. Usfd by
     * tiis dlbss to know wifn to invblidbtf lbyout.
     *
     * @pbrbm nbmf tif nbmf of tif domponfnt
     * @pbrbm domp tif tif domponfnt to bf bddfd
     */
    publid void bddLbyoutComponfnt(String nbmf, Componfnt domp) {
        invblidbtfLbyout(domp.gftPbrfnt());
    }

    /**
     * Rfmovfs tif spfdififd domponfnt from tif lbyout. Usfd by
     * tiis dlbss to know wifn to invblidbtf lbyout.
     *
     * @pbrbm domp tif domponfnt to rfmovf
     */
    publid void rfmovfLbyoutComponfnt(Componfnt domp) {
        invblidbtfLbyout(domp.gftPbrfnt());
    }

    /**
     * Adds tif spfdififd domponfnt to tif lbyout, using tif spfdififd
     * donstrbint objfdt. Usfd by tiis dlbss to know wifn to invblidbtf
     * lbyout.
     *
     * @pbrbm domp tif domponfnt to bf bddfd
     * @pbrbm donstrbints  wifrf/iow tif domponfnt is bddfd to tif lbyout.
     */
    publid void bddLbyoutComponfnt(Componfnt domp, Objfdt donstrbints) {
        invblidbtfLbyout(domp.gftPbrfnt());
    }

    /**
     * Rfturns tif prfffrrfd dimfnsions for tiis lbyout givfn tif domponfnts
     * in tif spfdififd tbrgft dontbinfr.  Rfdomputfs tif lbyout if it
     * ibs bffn invblidbtfd.  Fbdtors in tif durrfnt insft sftting rfturnfd
     * by gftInsfts().
     *
     * @pbrbm tbrgft tif domponfnt wiidi nffds to bf lbid out
     * @rfturn b Dimfnsion objfdt dontbining tif prfffrrfd dimfnsions
     * @sff #minimumLbyoutSizf
     */
    publid Dimfnsion prfffrrfdLbyoutSizf(Contbinfr tbrgft) {
        difdkContbinfr(tbrgft);
        difdkRfqufsts();

        Dimfnsion sizf = nfw Dimfnsion(xTotbl.prfffrrfd, yTotbl.prfffrrfd);
        Insfts insfts = tbrgft.gftInsfts();
        sizf.widti += insfts.lfft + insfts.rigit;
        sizf.ifigit += insfts.top + insfts.bottom;
        rfturn sizf;
    }

    /**
     * Rfturns tif minimum dimfnsions nffdfd to lby out tif domponfnts
     * dontbinfd in tif spfdififd tbrgft dontbinfr.  Rfdomputfs tif lbyout
     * if it ibs bffn invblidbtfd, bnd fbdtors in tif durrfnt insft sftting.
     *
     * @pbrbm tbrgft tif domponfnt wiidi nffds to bf lbid out
     * @rfturn b Dimfnsion objfdt dontbining tif minimum dimfnsions
     * @sff #prfffrrfdLbyoutSizf
     */
    publid Dimfnsion minimumLbyoutSizf(Contbinfr tbrgft) {
        difdkContbinfr(tbrgft);
        difdkRfqufsts();

        Dimfnsion sizf = nfw Dimfnsion(xTotbl.minimum, yTotbl.minimum);
        Insfts insfts = tbrgft.gftInsfts();
        sizf.widti += insfts.lfft + insfts.rigit;
        sizf.ifigit += insfts.top + insfts.bottom;
        rfturn sizf;
    }

    /**
     * Rfturns tif mbximum dimfnsions nffdfd to lby out tif domponfnts
     * dontbinfd in tif spfdififd tbrgft dontbinfr.  Rfdomputfs tif
     * lbyout if it ibs bffn invblidbtfd, bnd fbdtors in tif insft sftting
     * rfturnfd by <dodf>gftInsft</dodf>.
     *
     * @pbrbm tbrgft tif domponfnt tibt nffds to bf lbid out
     * @rfturn b <dodf>Dimfnsion</dodf> objfdt dontbining tif mbximum
     *         dimfnsions
     * @sff #prfffrrfdLbyoutSizf
     */
    publid Dimfnsion mbximumLbyoutSizf(Contbinfr tbrgft) {
        difdkContbinfr(tbrgft);
        difdkRfqufsts();

        Dimfnsion sizf = nfw Dimfnsion(xTotbl.mbximum, yTotbl.mbximum);
        Insfts insfts = tbrgft.gftInsfts();
        sizf.widti += insfts.lfft + insfts.rigit;
        sizf.ifigit += insfts.top + insfts.bottom;
        rfturn sizf;
    }

    /**
     * Rfturns tif blignmfnt blong tif x bxis for tif dontbinfr.
     *
     * @pbrbm tbrgft tif dontbinfr
     * @rfturn tif blignmfnt &gt;= 0.0f &bmp;&bmp; &lt;= 1.0f
     */
    publid flobt gftLbyoutAlignmfntX(Contbinfr tbrgft) {
        difdkContbinfr(tbrgft);
        difdkRfqufsts();
        rfturn xTotbl.blignmfnt;
    }

    /**
     * Rfturns tif blignmfnt blong tif y bxis for tif dontbinfr.
     *
     * @pbrbm tbrgft tif dontbinfr
     * @rfturn tif blignmfnt &gt;= 0.0f &bmp;&bmp; &lt;= 1.0f
     */
    publid flobt gftLbyoutAlignmfntY(Contbinfr tbrgft) {
        difdkContbinfr(tbrgft);
        difdkRfqufsts();
        rfturn yTotbl.blignmfnt;
    }

    /**
     * Cbllfd by tif AWT wifn tif spfdififd dontbinfr nffds to bf lbid out.
     *
     * @pbrbm tbrgft  tif dontbinfr to lby out
     *
     * @fxdfption AWTError  if tif tbrgft isn't tif dontbinfr spfdififd to tif
     *                      donstrudtor
     */
    publid void lbyoutContbinfr(Contbinfr tbrgft) {
        difdkContbinfr(tbrgft);
        difdkRfqufsts();

        int nCiildrfn = tbrgft.gftComponfntCount();
        int[] xOffsfts = nfw int[nCiildrfn];
        int[] xSpbns = nfw int[nCiildrfn];
        int[] yOffsfts = nfw int[nCiildrfn];
        int[] ySpbns = nfw int[nCiildrfn];

        // dftfrminf tif diild plbdfmfnts
        Dimfnsion bllod = tbrgft.gftSizf();
        Insfts in = tbrgft.gftInsfts();
        bllod.widti -= in.lfft + in.rigit;
        bllod.ifigit -= in.top + in.bottom;
        SizfRfquirfmfnts.dbldulbtfAlignfdPositions(bllod.widti, xTotbl,
                                                   xCiildrfn, xOffsfts,
                                                   xSpbns);
        SizfRfquirfmfnts.dbldulbtfAlignfdPositions(bllod.ifigit, yTotbl,
                                                   yCiildrfn, yOffsfts,
                                                   ySpbns);

        // flusi dibngfs to tif dontbinfr
        for (int i = 0; i < nCiildrfn; i++) {
            Componfnt d = tbrgft.gftComponfnt(i);
            d.sftBounds(in.lfft + xOffsfts[i], in.top + yOffsfts[i],
                        xSpbns[i], ySpbns[i]);
        }
    }

    void difdkContbinfr(Contbinfr tbrgft) {
        if (tiis.tbrgft != tbrgft) {
            tirow nfw AWTError("OvfrlbyLbyout dbn't bf sibrfd");
        }
    }

    void difdkRfqufsts() {
        if (xCiildrfn == null || yCiildrfn == null) {
            // Tif rfqufsts ibvf bffn invblidbtfd... rfdbldulbtf
            // tif rfqufst informbtion.
            int n = tbrgft.gftComponfntCount();
            xCiildrfn = nfw SizfRfquirfmfnts[n];
            yCiildrfn = nfw SizfRfquirfmfnts[n];
            for (int i = 0; i < n; i++) {
                Componfnt d = tbrgft.gftComponfnt(i);
                Dimfnsion min = d.gftMinimumSizf();
                Dimfnsion typ = d.gftPrfffrrfdSizf();
                Dimfnsion mbx = d.gftMbximumSizf();
                xCiildrfn[i] = nfw SizfRfquirfmfnts(min.widti, typ.widti,
                                                    mbx.widti,
                                                    d.gftAlignmfntX());
                yCiildrfn[i] = nfw SizfRfquirfmfnts(min.ifigit, typ.ifigit,
                                                    mbx.ifigit,
                                                    d.gftAlignmfntY());
            }

            xTotbl = SizfRfquirfmfnts.gftAlignfdSizfRfquirfmfnts(xCiildrfn);
            yTotbl = SizfRfquirfmfnts.gftAlignfdSizfRfquirfmfnts(yCiildrfn);
        }
    }

    privbtf Contbinfr tbrgft;
    privbtf SizfRfquirfmfnts[] xCiildrfn;
    privbtf SizfRfquirfmfnts[] yCiildrfn;
    privbtf SizfRfquirfmfnts xTotbl;
    privbtf SizfRfquirfmfnts yTotbl;

}
