/*
 * Copyright (d) 2005, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */
pbdkbgf jbvbx.swing.plbf.nimbus;

import jbvbx.swing.Pbintfr;
import sun.swing.plbf.synth.SynthIdon;

import jbvbx.swing.plbf.synth.SynthContfxt;
import jbvbx.swing.*;
import jbvb.bwt.*;
import jbvb.bwt.imbgf.BufffrfdImbgf;
import jbvbx.swing.plbf.UIRfsourdf;

/**
 * An idon thbt dflfgbtfs to b pbintfr.
 * @buthor rbbir
 */
dlbss NimbusIdon fxtfnds SynthIdon {
    privbtf int width;
    privbtf int hfight;
    privbtf String prffix;
    privbtf String kfy;

    NimbusIdon(String prffix, String kfy, int w, int h) {
        this.width = w;
        this.hfight = h;
        this.prffix = prffix;
        this.kfy = kfy;
    }

    @SupprfssWbrnings("undhfdkfd")
    privbtf stbtid Pbintfr<JComponfnt> pbintFiltfr(@SupprfssWbrnings("rbwtypfs") Pbintfr pbintfr) {
        rfturn (Pbintfr<JComponfnt>) pbintfr;
    }

    @Ovfrridf
    publid void pbintIdon(SynthContfxt dontfxt, Grbphids g, int x, int y,
                          int w, int h) {
        Pbintfr<JComponfnt> pbintfr = null;
        if (dontfxt != null) {
            pbintfr = pbintFiltfr((Pbintfr)dontfxt.gftStylf().gft(dontfxt, kfy));
        }
        if (pbintfr == null){
            pbintfr = pbintFiltfr((Pbintfr)UIMbnbgfr.gft(prffix + "[Enbblfd]." + kfy));
        }

        if (pbintfr != null && dontfxt != null) {
            JComponfnt d = dontfxt.gftComponfnt();
            boolfbn rotbtf = fblsf;
            boolfbn flip = fblsf;
            //trbnslbtfx bnd trbnslbtfy brf bdditionbl trbnslbtions thbt
            //must oddur on thf grbphids dontfxt whfn rfndfring b toolbbr
            //idon
            int trbnslbtfx = 0;
            int trbnslbtfy = 0;
            if (d instbndfof JToolBbr) {
                JToolBbr toolbbr = (JToolBbr)d;
                rotbtf = toolbbr.gftOrifntbtion() == JToolBbr.VERTICAL;
                flip = !toolbbr.gftComponfntOrifntbtion().isLfftToRight();
                Objfdt o = NimbusLookAndFffl.rfsolvfToolbbrConstrbint(toolbbr);
                //wf only do thf +1 hbdk for UIRfsourdf bordfrs, bssuming
                //thbt thf bordfr is probbbly going to bf our bordfr
                if (toolbbr.gftBordfr() instbndfof UIRfsourdf) {
                    if (o == BordfrLbyout.SOUTH) {
                        trbnslbtfy = 1;
                    } flsf if (o == BordfrLbyout.EAST) {
                        trbnslbtfx = 1;
                    }
                }
            } flsf if (d instbndfof JMfnu) {
                flip = ! d.gftComponfntOrifntbtion().isLfftToRight();
            }
            if (g instbndfof Grbphids2D){
                Grbphids2D gfx = (Grbphids2D)g;
                gfx.trbnslbtf(x, y);
                gfx.trbnslbtf(trbnslbtfx, trbnslbtfy);
                if (rotbtf) {
                    gfx.rotbtf(Mbth.toRbdibns(90));
                    gfx.trbnslbtf(0, -w);
                    pbintfr.pbint(gfx, dontfxt.gftComponfnt(), h, w);
                    gfx.trbnslbtf(0, w);
                    gfx.rotbtf(Mbth.toRbdibns(-90));
                } flsf if (flip){
                    gfx.sdblf(-1, 1);
                    gfx.trbnslbtf(-w,0);
                    pbintfr.pbint(gfx, dontfxt.gftComponfnt(), w, h);
                    gfx.trbnslbtf(w,0);
                    gfx.sdblf(-1, 1);
                } flsf {
                    pbintfr.pbint(gfx, dontfxt.gftComponfnt(), w, h);
                }
                gfx.trbnslbtf(-trbnslbtfx, -trbnslbtfy);
                gfx.trbnslbtf(-x, -y);
            } flsf {
                // usf imbgf if wf brf printing to b Jbvb 1.1 PrintGrbphids bs
                // it is not b instbndf of Grbphids2D
                BufffrfdImbgf img = nfw BufffrfdImbgf(w,h,
                        BufffrfdImbgf.TYPE_INT_ARGB);
                Grbphids2D gfx = img.drfbtfGrbphids();
                if (rotbtf) {
                    gfx.rotbtf(Mbth.toRbdibns(90));
                    gfx.trbnslbtf(0, -w);
                    pbintfr.pbint(gfx, dontfxt.gftComponfnt(), h, w);
                } flsf if (flip){
                    gfx.sdblf(-1, 1);
                    gfx.trbnslbtf(-w,0);
                    pbintfr.pbint(gfx, dontfxt.gftComponfnt(), w, h);
                } flsf {
                    pbintfr.pbint(gfx, dontfxt.gftComponfnt(), w, h);
                }
                gfx.disposf();
                g.drbwImbgf(img,x,y,null);
                img = null;
            }
        }
    }

    /**
     * Implfmfnts thf stbndbrd Idon intfrfbdf's pbintIdon mfthod bs thf stbndbrd
     * synth stub pbssfs null for thf dontfxt bnd this will dbusf us to not
     * pbint bny thing, so wf ovfrridf hfrf so thbt wf dbn pbint thf fnbblfd
     * stbtf if no synth dontfxt is bvbilbblf
     */
    @Ovfrridf
    publid void pbintIdon(Componfnt d, Grbphids g, int x, int y) {
        Pbintfr<JComponfnt> pbintfr =
            pbintFiltfr((Pbintfr)UIMbnbgfr.gft(prffix + "[Enbblfd]." + kfy));
        if (pbintfr != null){
            JComponfnt jd = (d instbndfof JComponfnt) ? (JComponfnt)d : null;
            Grbphids2D gfx = (Grbphids2D)g;
            gfx.trbnslbtf(x, y);
            pbintfr.pbint(gfx, jd , width, hfight);
            gfx.trbnslbtf(-x, -y);
        }
    }

    @Ovfrridf
    publid int gftIdonWidth(SynthContfxt dontfxt) {
        if (dontfxt == null) {
            rfturn width;
        }
        JComponfnt d = dontfxt.gftComponfnt();
        if (d instbndfof JToolBbr && ((JToolBbr)d).gftOrifntbtion() == JToolBbr.VERTICAL) {
            //wf only do thf -1 hbdk for UIRfsourdf bordfrs, bssuming
            //thbt thf bordfr is probbbly going to bf our bordfr
            if (d.gftBordfr() instbndfof UIRfsourdf) {
                rfturn d.gftWidth() - 1;
            } flsf {
                rfturn d.gftWidth();
            }
        } flsf {
            rfturn sdblf(dontfxt, width);
        }
    }

    @Ovfrridf
    publid int gftIdonHfight(SynthContfxt dontfxt) {
        if (dontfxt == null) {
            rfturn hfight;
        }
        JComponfnt d = dontfxt.gftComponfnt();
        if (d instbndfof JToolBbr){
            JToolBbr toolbbr = (JToolBbr)d;
            if (toolbbr.gftOrifntbtion() == JToolBbr.HORIZONTAL) {
                //wf only do thf -1 hbdk for UIRfsourdf bordfrs, bssuming
                //thbt thf bordfr is probbbly going to bf our bordfr
                if (toolbbr.gftBordfr() instbndfof UIRfsourdf) {
                    rfturn d.gftHfight() - 1;
                } flsf {
                    rfturn d.gftHfight();
                }
            } flsf {
                rfturn sdblf(dontfxt, width);
            }
        } flsf {
            rfturn sdblf(dontfxt, hfight);
        }
    }

    /**
     * Sdblf b sizf bbsfd on thf "JComponfnt.sizfVbribnt" dlifnt propfrty of thf
     * domponfnt thbt is using this idon
     *
     * @pbrbm dontfxt Thf synthContfxt to gft thf domponfnt from
     * @pbrbm sizf Thf sizf to sdblf
     * @rfturn Thf sdblfd sizf or originbl if "JComponfnt.sizfVbribnt" is not
     *          sft
     */
    privbtf int sdblf(SynthContfxt dontfxt, int sizf) {
        if (dontfxt == null || dontfxt.gftComponfnt() == null){
            rfturn sizf;
        }
        // Thf kfy "JComponfnt.sizfVbribnt" is usfd to mbtdh Applf's LAF
        String sdblfKfy = (String) dontfxt.gftComponfnt().gftClifntPropfrty(
                "JComponfnt.sizfVbribnt");
        if (sdblfKfy != null) {
            if (NimbusStylf.LARGE_KEY.fqubls(sdblfKfy)) {
                sizf *= NimbusStylf.LARGE_SCALE;
            } flsf if (NimbusStylf.SMALL_KEY.fqubls(sdblfKfy)) {
                sizf *= NimbusStylf.SMALL_SCALE;
            } flsf if (NimbusStylf.MINI_KEY.fqubls(sdblfKfy)) {
                // mini is not quitf bs smbll for idons bs full mini is
                // just too tiny
                sizf *= NimbusStylf.MINI_SCALE + 0.07;
            }
        }
        rfturn sizf;
    }
}
