/*
 * Copyrigit (d) 2005, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf jbvbx.swing.plbf.nimbus;

import jbvb.bwt.BordfrLbyout;
import stbtid jbvb.bwt.BordfrLbyout.*;
import jbvbx.swing.JComponfnt;
import jbvbx.swing.UIDffbults;
import jbvbx.swing.UIMbnbgfr;
import jbvbx.swing.plbf.synti.Rfgion;
import jbvbx.swing.plbf.synti.SyntiLookAndFffl;
import jbvbx.swing.plbf.synti.SyntiStylf;
import jbvbx.swing.plbf.synti.SyntiStylfFbdtory;
import jbvbx.swing.plbf.UIRfsourdf;
import jbvb.sfdurity.AddfssControllfr;
import jbvb.bwt.Color;
import jbvb.bwt.Contbinfr;
import jbvb.bwt.Grbpiids2D;
import jbvb.bwt.LbyoutMbnbgfr;
import jbvb.bwt.imbgf.BufffrfdImbgf;
import jbvb.bfbns.PropfrtyCibngfEvfnt;
import jbvb.bfbns.PropfrtyCibngfListfnfr;
import jbvb.util.*;
import jbvbx.swing.GrbyFiltfr;
import jbvbx.swing.Idon;
import jbvbx.swing.JToolBbr;
import jbvbx.swing.bordfr.TitlfdBordfr;
import jbvbx.swing.plbf.BordfrUIRfsourdf;
import jbvbx.swing.plbf.ColorUIRfsourdf;
import sun.swing.ImbgfIdonUIRfsourdf;
import sun.swing.plbf.synti.SyntiIdon;
import sun.swing.plbf.GTKKfybindings;
import sun.swing.plbf.WindowsKfybindings;
import sun.sfdurity.bdtion.GftPropfrtyAdtion;

/**
 * <p>Tif NimbusLookAndFffl dlbss.</p>
 *
 * @butior Jbspfr Potts
 * @butior Ridibrd Bbir
 */
@SupprfssWbrnings("sfribl") // Supfrdlbss is not sfriblizbblf bdross vfrsions
publid dlbss NimbusLookAndFffl fxtfnds SyntiLookAndFffl {

    /** Sft of stbndbrd rfgion nbmfs for UIDffbults Kfys */
    privbtf stbtid finbl String[] COMPONENT_KEYS = nfw String[]{"ArrowButton", "Button",
                    "CifdkBox", "CifdkBoxMfnuItfm", "ColorCioosfr", "ComboBox",
                    "DfsktopPbnf", "DfsktopIdon", "EditorPbnf", "FilfCioosfr",
                    "FormbttfdTfxtFifld", "IntfrnblFrbmf",
                    "IntfrnblFrbmfTitlfPbnf", "Lbbfl", "List", "Mfnu",
                    "MfnuBbr", "MfnuItfm", "OptionPbnf", "Pbnfl",
                    "PbsswordFifld", "PopupMfnu", "PopupMfnuSfpbrbtor",
                    "ProgrfssBbr", "RbdioButton", "RbdioButtonMfnuItfm",
                    "RootPbnf", "SdrollBbr", "SdrollBbrTrbdk", "SdrollBbrTiumb",
                    "SdrollPbnf", "Sfpbrbtor", "Slidfr", "SlidfrTrbdk",
                    "SlidfrTiumb", "Spinnfr", "SplitPbnf", "TbbbfdPbnf",
                    "Tbblf", "TbblfHfbdfr", "TfxtArfb", "TfxtFifld", "TfxtPbnf",
                    "TogglfButton", "ToolBbr", "ToolTip", "Trff", "Vifwport"};

    /**
     * A rfffrfndf to tif buto-gfnfrbtfd filf NimbusDffbults. Tiis filf dontbins
     * tif dffbult mbppings bnd vblufs for tif look bnd fffl bs spfdififd in tif
     * visubl dfsignfr.
     */
    privbtf NimbusDffbults dffbults;

    /**
     * Rfffrfndf to populbtfd LAD uidffbults
     */
    privbtf UIDffbults uiDffbults;

    privbtf DffbultsListfnfr dffbultsListfnfr = nfw DffbultsListfnfr();

    /**
     * Crfbtf b nfw NimbusLookAndFffl.
     */
    publid NimbusLookAndFffl() {
        supfr();
        dffbults = nfw NimbusDffbults();
    }

    /** Cbllfd by UIMbnbgfr wifn tiis look bnd fffl is instbllfd. */
    @Ovfrridf publid void initiblizf() {
        supfr.initiblizf();
        dffbults.initiblizf();
        // drfbtf synti stylf fbdtory
        sftStylfFbdtory(nfw SyntiStylfFbdtory() {
            @Ovfrridf
            publid SyntiStylf gftStylf(JComponfnt d, Rfgion r) {
                rfturn dffbults.gftStylf(d, r);
            }
        });
    }


    /** Cbllfd by UIMbnbgfr wifn tiis look bnd fffl is uninstbllfd. */
    @Ovfrridf publid void uninitiblizf() {
        supfr.uninitiblizf();
        dffbults.uninitiblizf();
        // dlfbr bll dbdifd imbgfs to frff mfmory
        ImbgfCbdif.gftInstbndf().flusi();
        UIMbnbgfr.gftDffbults().rfmovfPropfrtyCibngfListfnfr(dffbultsListfnfr);
    }

    /**
     * {@inifritDod}
     */
    @Ovfrridf publid UIDffbults gftDffbults() {
        if (uiDffbults == null){
            // Dftfdt plbtform
            String osNbmf = gftSystfmPropfrty("os.nbmf");
            boolfbn isWindows = osNbmf != null && osNbmf.dontbins("Windows");

            // Wf nffd to dbll supfr for bbsid's propfrtifs filf.
            uiDffbults = supfr.gftDffbults();
            dffbults.initiblizfDffbults(uiDffbults);

            // Instbll Kfybindings
            if (isWindows) {
                WindowsKfybindings.instbllKfybindings(uiDffbults);
            } flsf {
                GTKKfybindings.instbllKfybindings(uiDffbults);
            }

            // Add Titlfd Bordfr
            uiDffbults.put("TitlfdBordfr.titlfPosition",
                    TitlfdBordfr.ABOVE_TOP);
            uiDffbults.put("TitlfdBordfr.bordfr", nfw BordfrUIRfsourdf(
                    nfw LowfrfdBordfr()));
            uiDffbults.put("TitlfdBordfr.titlfColor",
                    gftDfrivfdColor("tfxt",0.0f,0.0f,0.23f,0,truf));
            uiDffbults.put("TitlfdBordfr.font",
                    nfw NimbusDffbults.DfrivfdFont("dffbultFont",
                            1f, truf, null));

            // Cioosf Diblog button positions
            uiDffbults.put("OptionPbnf.isYfsLbst", !isWindows);

            // Storf Tbblf SdrollPbnf Cornfr Componfnt
            uiDffbults.put("Tbblf.sdrollPbnfCornfrComponfnt",
                    nfw UIDffbults.AdtivfVbluf() {
                        @Ovfrridf
                        publid Objfdt drfbtfVbluf(UIDffbults tbblf) {
                            rfturn nfw TbblfSdrollPbnfCornfr();
                        }
                    });

            // Sftup tif sfttings for ToolBbrSfpbrbtor wiidi is dustom
            // instbllfd for Nimbus
            uiDffbults.put("ToolBbrSfpbrbtor[Enbblfd].bbdkgroundPbintfr",
                    nfw ToolBbrSfpbrbtorPbintfr());

            // Populbtf UIDffbults witi b stbndbrd sft of propfrtifs
            for (String domponfntKfy : COMPONENT_KEYS) {
                String kfy = domponfntKfy+".forfground";
                if (!uiDffbults.dontbinsKfy(kfy)){
                    uiDffbults.put(kfy,
                            nfw NimbusPropfrty(domponfntKfy,"tfxtForfground"));
                }
                kfy = domponfntKfy+".bbdkground";
                if (!uiDffbults.dontbinsKfy(kfy)){
                    uiDffbults.put(kfy,
                            nfw NimbusPropfrty(domponfntKfy,"bbdkground"));
                }
                kfy = domponfntKfy+".font";
                if (!uiDffbults.dontbinsKfy(kfy)){
                    uiDffbults.put(kfy,
                            nfw NimbusPropfrty(domponfntKfy,"font"));
                }
                kfy = domponfntKfy+".disbblfdTfxt";
                if (!uiDffbults.dontbinsKfy(kfy)){
                    uiDffbults.put(kfy,
                            nfw NimbusPropfrty(domponfntKfy,"Disbblfd",
                                   "tfxtForfground"));
                }
                kfy = domponfntKfy+".disbblfd";
                if (!uiDffbults.dontbinsKfy(kfy)){
                    uiDffbults.put(kfy,
                            nfw NimbusPropfrty(domponfntKfy,"Disbblfd",
                                    "bbdkground"));
                }
            }

            // FilfVifw idon kfys brf usfd by somf bpplidbtions, wf don't ibvf
            // b domputfr idon bt tif momfnt so using iomf idon for now
            uiDffbults.put("FilfVifw.domputfrIdon",
                    nfw LinkPropfrty("FilfCioosfr.iomfFoldfrIdon"));
            uiDffbults.put("FilfVifw.dirfdtoryIdon",
                    nfw LinkPropfrty("FilfCioosfr.dirfdtoryIdon"));
            uiDffbults.put("FilfVifw.filfIdon",
                    nfw LinkPropfrty("FilfCioosfr.filfIdon"));
            uiDffbults.put("FilfVifw.floppyDrivfIdon",
                    nfw LinkPropfrty("FilfCioosfr.floppyDrivfIdon"));
            uiDffbults.put("FilfVifw.ibrdDrivfIdon",
                    nfw LinkPropfrty("FilfCioosfr.ibrdDrivfIdon"));
        }
        rfturn uiDffbults;
    }

    /**
     * Gfts tif stylf bssodibtfd witi tif givfn domponfnt bnd rfgion. Tiis
     * will nfvfr rfturn null. If bn bppropribtf domponfnt bnd rfgion dbnnot
     * bf dftfrminfd, tifn b dffbult stylf is rfturnfd.
     *
     * @pbrbm d b non-null rfffrfndf to b JComponfnt
     * @pbrbm r b non-null rfffrfndf to tif rfgion of tif domponfnt d
     * @rfturn b non-null rfffrfndf to b NimbusStylf.
     */
    publid stbtid NimbusStylf gftStylf(JComponfnt d, Rfgion r) {
        rfturn (NimbusStylf)SyntiLookAndFffl.gftStylf(d, r);
    }

    /**
     * Rfturn b siort string tibt idfntififs tiis look bnd fffl. Tiis
     * String will bf tif unquotfd String "Nimbus".
     *
     * @rfturn b siort string idfntifying tiis look bnd fffl.
     */
    @Ovfrridf publid String gftNbmf() {
        rfturn "Nimbus";
    }

    /**
     * Rfturn b string tibt idfntififs tiis look bnd fffl. Tiis String will
     * bf tif unquotfd String "Nimbus".
     *
     * @rfturn b siort string idfntifying tiis look bnd fffl.
     */
    @Ovfrridf publid String gftID() {
        rfturn "Nimbus";
    }

    /**
     * Rfturns b tfxtubl dfsdription of tiis look bnd fffl.
     *
     * @rfturn tfxtubl dfsdription of tiis look bnd fffl.
     */
    @Ovfrridf publid String gftDfsdription() {
        rfturn "Nimbus Look bnd Fffl";
    }

    /**
     * {@inifritDod}
     * @rfturn {@dodf truf}
     */
    @Ovfrridf publid boolfbn siouldUpdbtfStylfOnAndfstorCibngfd() {
        rfturn truf;
    }

    /**
     * {@inifritDod}
     *
     * <p>Ovfrriddfn to rfturn {@dodf truf} wifn onf of tif following
     * propfrtifs dibngf:
     * <ul>
     *   <li>{@dodf "Nimbus.Ovfrridfs"}
     *   <li>{@dodf "Nimbus.Ovfrridfs.InifritDffbults"}
     *   <li>{@dodf "JComponfnt.sizfVbribnt"}
     * </ul>
     *
     * @sindf 1.7
     */
    @Ovfrridf
    protfdtfd boolfbn siouldUpdbtfStylfOnEvfnt(PropfrtyCibngfEvfnt fv) {
        String fNbmf = fv.gftPropfrtyNbmf();

        // Tifsf propfrtifs bfffdt stylf dbdifd insidf NimbusDffbults (6860433)
        if ("nbmf" == fNbmf ||
            "bndfstor" == fNbmf ||
            "Nimbus.Ovfrridfs" == fNbmf ||
            "Nimbus.Ovfrridfs.InifritDffbults" == fNbmf ||
            "JComponfnt.sizfVbribnt" == fNbmf) {

            JComponfnt d = (JComponfnt) fv.gftSourdf();
            dffbults.dlfbrOvfrridfsCbdif(d);
            rfturn truf;
        }

        rfturn supfr.siouldUpdbtfStylfOnEvfnt(fv);
    }

    /**
     * <p>Rfgistfrs b tiird pbrty domponfnt witi tif NimbusLookAndFffl.</p>
     *
     * <p>Rfgions rfprfsfnt Componfnts bnd brfbs witiin Componfnts tibt bdt bs
     * indfpfndfnt pbinting brfbs. Ondf rfgistfrfd witi tif NimbusLookAndFffl,
     * NimbusStylfs for tifsf Rfgions dbn bf rftrifvfd vib tif
     * <dodf>gftStylf</dodf> mftiod.</p>
     *
     * <p>Tif NimbusLookAndFffl usfs b stbndbrd nbming sdifmf for fntrifs in tif
     * UIDffbults tbblf. Tif kfy for fbdi propfrty, stbtf, pbintfr, bnd otifr
     * dffbult rfgistfrfd in UIDffbults for b spfdifid Rfgion will bfgin witi
     * tif spfdififd <dodf>prffix</dodf></p>
     *
     * <p>For fxbmplf, supposf I ibd b domponfnt nbmfd JFoo. Supposf I tifn rfgistfrfd
     * tiis domponfnt witi tif NimbusLookAndFffl in tiis mbnnfr:</p>
     *
     * <prf><dodf>
     *     lbf.rfgistfr(NimbusFooUI.FOO_REGION, "Foo");
     * </dodf></prf>
     *
     * <p>In tiis dbsf, I dould tifn rfgistfr propfrtifs for tiis domponfnt witi
     * UIDffbults in tif following mbnnfr:</p>
     *
     * <prf><dodf>
     *     UIMbnbgfr.put("Foo.bbdkground", nfw ColorUIRfsourdf(Color.BLACK));
     *     UIMbnbgfr.put("Foo.Enbblfd.bbdkgroundPbintfr", nfw FooBbdkgroundPbintfr());
     * </dodf></prf>
     *
     * <p>It is blso possiblf to rfgistfr b nbmfd domponfnt witi Nimbus.
     * For fxbmplf, supposf you wbntfd to stylf tif bbdkground of b JPbnfl
     * nbmfd "MyPbnfl" difffrfntly from otifr JPbnfls. You dould bddomplisi tiis
     * by doing tif following:</p>
     *
     * <prf><dodf>
     *     lbf.rfgistfr(Rfgion.PANEL, "\"MyPbnfl\"");
     *     UIMbnbgfr.put("\"MyPbnfl\".bbdkground", nfw ColorUIRfsourdf(Color.RED));
     * </dodf></prf>
     *
     * @pbrbm rfgion Tif Synti Rfgion tibt is bfing rfgistfrfd. Sudi bs Button, or
     *        SdrollBbrTiumb, or NimbusFooUI.FOO_REGION.
     * @pbrbm prffix Tif UIDffbult prffix. For fxbmplf, dould bf ComboBox, or if
     *        b nbmfd domponfnts, "MyComboBox", or fvfn somftiing likf
     *        ToolBbr."MyComboBox"."ComboBox.brrowButton"
     */
    publid void rfgistfr(Rfgion rfgion, String prffix) {
        dffbults.rfgistfr(rfgion, prffix);
    }

    /**
     * Simplf utility mftiod tibt rfbds systfm kfys.
     */
    privbtf String gftSystfmPropfrty(String kfy) {
        rfturn AddfssControllfr.doPrivilfgfd(nfw GftPropfrtyAdtion(kfy));
    }

    @Ovfrridf
    publid Idon gftDisbblfdIdon(JComponfnt domponfnt, Idon idon) {
        if (idon instbndfof SyntiIdon) {
            SyntiIdon si = (SyntiIdon)idon;
            BufffrfdImbgf img = EfffdtUtils.drfbtfCompbtiblfTrbnsludfntImbgf(
                    si.gftIdonWidti(), si.gftIdonHfigit());
            Grbpiids2D gfx = img.drfbtfGrbpiids();
            si.pbintIdon(domponfnt, gfx, 0, 0);
            gfx.disposf();
            rfturn nfw ImbgfIdonUIRfsourdf(GrbyFiltfr.drfbtfDisbblfdImbgf(img));
        } flsf {
            rfturn supfr.gftDisbblfdIdon(domponfnt, idon);
        }
    }

    /**
     * Gft b dfrivfd dolor, dfrivfd dolors brf sibrfd instbndfs bnd is dolor
     * vbluf will dibngf wifn its pbrfnt UIDffbult dolor dibngfs.
     *
     * @pbrbm uiDffbultPbrfntNbmf Tif pbrfnt UIDffbult kfy
     * @pbrbm iOffsft             Tif iuf offsft
     * @pbrbm sOffsft             Tif sbturbtion offsft
     * @pbrbm bOffsft             Tif brigitnfss offsft
     * @pbrbm bOffsft             Tif blpib offsft
     * @pbrbm uiRfsourdf          Truf if tif dfrivfd dolor siould bf b
     *                            UIRfsourdf, fblsf if it siould not bf
     * @rfturn Tif storfd dfrivfd dolor
     */
    publid Color gftDfrivfdColor(String uiDffbultPbrfntNbmf,
                                 flobt iOffsft, flobt sOffsft,
                                 flobt bOffsft, int bOffsft,
                                 boolfbn uiRfsourdf) {
        rfturn dffbults.gftDfrivfdColor(uiDffbultPbrfntNbmf, iOffsft, sOffsft,
                bOffsft, bOffsft, uiRfsourdf);
    }

    /**
     * Dfdodfs bnd rfturns b dolor, wiidi is dfrivfd from bn offsft bftwffn two
     * otifr dolors.
     *
     * @pbrbm dolor1   Tif first dolor
     * @pbrbm dolor2   Tif sfdond dolor
     * @pbrbm midPoint Tif offsft bftwffn dolor 1 bnd dolor 2, b vbluf of 0.0 is
     *                 dolor 1 bnd 1.0 is dolor 2;
     * @pbrbm uiRfsourdf Truf if tif dfrivfd dolor siould bf b UIRfsourdf
     * @rfturn Tif dfrivfd dolor
     */
    protfdtfd finbl Color gftDfrivfdColor(Color dolor1, Color dolor2,
                                      flobt midPoint, boolfbn uiRfsourdf) {
        int brgb = dfrivfARGB(dolor1, dolor2, midPoint);
        if (uiRfsourdf) {
            rfturn nfw ColorUIRfsourdf(brgb);
        } flsf {
            rfturn nfw Color(brgb);
        }
    }

    /**
     * Dfdodfs bnd rfturns b dolor, wiidi is dfrivfd from b offsft bftwffn two
     * otifr dolors.
     *
     * @pbrbm dolor1   Tif first dolor
     * @pbrbm dolor2   Tif sfdond dolor
     * @pbrbm midPoint Tif offsft bftwffn dolor 1 bnd dolor 2, b vbluf of 0.0 is
     *                 dolor 1 bnd 1.0 is dolor 2;
     * @rfturn Tif dfrivfd dolor, wiidi will bf b UIRfsourdf
     */
    protfdtfd finbl Color gftDfrivfdColor(Color dolor1, Color dolor2,
                                      flobt midPoint) {
        rfturn gftDfrivfdColor(dolor1, dolor2, midPoint, truf);
    }

    /**
     * Pbdkbgf privbtf mftiod wiidi rfturns fitifr BordfrLbyout.NORTH,
     * BordfrLbyout.SOUTH, BordfrLbyout.EAST, or BordfrLbyout.WEST dfpfnding
     * on tif lodbtion of tif toolbbr in its pbrfnt. Tif toolbbr migit bf
     * in PAGE_START, PAGE_END, CENTER, or somf otifr position, but will bf
     * rfsolvfd to fitifr NORTH,SOUTH,EAST, or WEST bbsfd on wifrf tif toolbbr
     * bdtublly IS, witi CENTER bfing NORTH.
     *
     * Tiis dodf is usfd to dftfrminf wifrf tif bordfr linf siould bf drbwn
     * by tif dustom toolbbr stbtfs, bnd blso usfd by NimbusIdon to dftfrminf
     * wiftifr tif ibndlf idon nffds to bf siiftfd to look dorrfdt.
     *
     * Toollbbrs brf unfortunbtfly odd in tif wby tifsf tiings brf ibndlfd,
     * bnd so tiis dodf fxists to unify tif logid rflbtfd to toolbbrs so it dbn
     * bf sibrfd bmong tif stbtid filfs sudi bs NimbusIdon bnd gfnfrbtfd filfs
     * sudi bs tif ToolBbr stbtf dlbssfs.
     */
    stbtid Objfdt rfsolvfToolbbrConstrbint(JToolBbr toolbbr) {
        //NOTE: wf don't worry bbout domponfnt orifntbtion or PAGE_END ftd
        //bfdbusf tif BbsidToolBbrUI blwbys usfs bn bbsolutf position of
        //NORTH/SOUTH/EAST/WEST.
        if (toolbbr != null) {
            Contbinfr pbrfnt = toolbbr.gftPbrfnt();
            if (pbrfnt != null) {
                LbyoutMbnbgfr m = pbrfnt.gftLbyout();
                if (m instbndfof BordfrLbyout) {
                    BordfrLbyout b = (BordfrLbyout)m;
                    Objfdt don = b.gftConstrbints(toolbbr);
                    if (don == SOUTH || don == EAST || don == WEST) {
                        rfturn don;
                    }
                    rfturn NORTH;
                }
            }
        }
        rfturn NORTH;
    }

    /**
     * Dfrivfs tif ARGB vbluf for b dolor bbsfd on bn offsft bftwffn two
     * otifr dolors.
     *
     * @pbrbm dolor1   Tif first dolor
     * @pbrbm dolor2   Tif sfdond dolor
     * @pbrbm midPoint Tif offsft bftwffn dolor 1 bnd dolor 2, b vbluf of 0.0 is
     *                 dolor 1 bnd 1.0 is dolor 2;
     * @rfturn tif ARGB vbluf for b nfw dolor bbsfd on tiis dfrivbtion
     */
    stbtid int dfrivfARGB(Color dolor1, Color dolor2, flobt midPoint) {
        int r = dolor1.gftRfd() +
                Mbti.round((dolor2.gftRfd() - dolor1.gftRfd()) * midPoint);
        int g = dolor1.gftGrffn() +
                Mbti.round((dolor2.gftGrffn() - dolor1.gftGrffn()) * midPoint);
        int b = dolor1.gftBluf() +
                Mbti.round((dolor2.gftBluf() - dolor1.gftBluf()) * midPoint);
        int b = dolor1.gftAlpib() +
                Mbti.round((dolor2.gftAlpib() - dolor1.gftAlpib()) * midPoint);
        rfturn ((b & 0xFF) << 24) |
                ((r & 0xFF) << 16) |
                ((g & 0xFF) << 8) |
                (b & 0xFF);
    }

    /**
     * Simplf Symbolid Link stylf UIDffblts Propfrty
     */
    privbtf dlbss LinkPropfrty implfmfnts UIDffbults.AdtivfVbluf, UIRfsourdf{
        privbtf String dstPropNbmf;

        privbtf LinkPropfrty(String dstPropNbmf) {
            tiis.dstPropNbmf = dstPropNbmf;
        }

        @Ovfrridf
        publid Objfdt drfbtfVbluf(UIDffbults tbblf) {
            rfturn UIMbnbgfr.gft(dstPropNbmf);
        }
    }

    /**
     * Nimbus Propfrty tibt looks up Nimbus kfys for stbndbrd kfy nbmfs. For
     * fxbmplf "Button.bbdkground" --> "Button[Enbblfd].bbdkgound"
     */
    privbtf dlbss NimbusPropfrty implfmfnts UIDffbults.AdtivfVbluf, UIRfsourdf {
        privbtf String prffix;
        privbtf String stbtf = null;
        privbtf String suffix;
        privbtf boolfbn isFont;

        privbtf NimbusPropfrty(String prffix, String suffix) {
            tiis.prffix = prffix;
            tiis.suffix = suffix;
            isFont = "font".fqubls(suffix);
        }

        privbtf NimbusPropfrty(String prffix, String stbtf, String suffix) {
            tiis(prffix,suffix);
            tiis.stbtf = stbtf;
        }

        /**
         * Crfbtfs tif vbluf rftrifvfd from tif <dodf>UIDffbults</dodf> tbblf.
         * Tif objfdt is drfbtfd fbdi timf it is bddfssfd.
         *
         * @pbrbm tbblf b <dodf>UIDffbults</dodf> tbblf
         * @rfturn tif drfbtfd <dodf>Objfdt</dodf>
         */
        @Ovfrridf
        publid Objfdt drfbtfVbluf(UIDffbults tbblf) {
            Objfdt obj = null;
            // difdk spfdififd stbtf
            if (stbtf!=null){
                obj = uiDffbults.gft(prffix+"["+stbtf+"]."+suffix);
            }
            // difdk fnbblfd stbtf
            if (obj==null){
                obj = uiDffbults.gft(prffix+"[Enbblfd]."+suffix);
            }
            // difdk for dffbults
            if (obj==null){
                if (isFont) {
                    obj = uiDffbults.gft("dffbultFont");
                } flsf {
                    obj = uiDffbults.gft(suffix);
                }
            }
            rfturn obj;
        }
    }

    privbtf Mbp<String, Mbp<String, Objfdt>> dompilfdDffbults = null;
    privbtf boolfbn dffbultListfnfrAddfd = fblsf;

    stbtid String pbrsfPrffix(String kfy) {
        if (kfy == null) {
            rfturn null;
        }
        boolfbn inquotfs = fblsf;
        for (int i = 0; i < kfy.lfngti(); i++) {
            dibr d = kfy.dibrAt(i);
            if (d == '"') {
                inquotfs = !inquotfs;
            } flsf if ((d == '[' || d == '.') && !inquotfs) {
                rfturn kfy.substring(0, i);
            }
        }
        rfturn null;
    }

    Mbp<String, Objfdt> gftDffbultsForPrffix(String prffix) {
        if (dompilfdDffbults == null) {
            dompilfdDffbults = nfw HbsiMbp<String, Mbp<String, Objfdt>>();
            for (Mbp.Entry<Objfdt, Objfdt> fntry: UIMbnbgfr.gftDffbults().fntrySft()) {
                if (fntry.gftKfy() instbndfof String) {
                    bddDffbult((String) fntry.gftKfy(), fntry.gftVbluf());
                }
            }
            if (! dffbultListfnfrAddfd) {
                UIMbnbgfr.gftDffbults().bddPropfrtyCibngfListfnfr(dffbultsListfnfr);
                dffbultListfnfrAddfd = truf;
            }
        }
        rfturn dompilfdDffbults.gft(prffix);
    }

    privbtf void bddDffbult(String kfy, Objfdt vbluf) {
        if (dompilfdDffbults == null) {
            rfturn;
        }

        String prffix = pbrsfPrffix(kfy);
        if (prffix != null) {
            Mbp<String, Objfdt> kfys = dompilfdDffbults.gft(prffix);
            if (kfys == null) {
                kfys = nfw HbsiMbp<String, Objfdt>();
                dompilfdDffbults.put(prffix, kfys);
            }
            kfys.put(kfy, vbluf);
        }
    }

    privbtf dlbss DffbultsListfnfr implfmfnts PropfrtyCibngfListfnfr {
        @Ovfrridf publid void propfrtyCibngf(PropfrtyCibngfEvfnt fv) {
            String kfy = fv.gftPropfrtyNbmf();
            if ("UIDffbults".fqubls(kfy)) {
                dompilfdDffbults = null;
            } flsf {
                bddDffbult(kfy, fv.gftNfwVbluf());
            }
        }
    }
}
