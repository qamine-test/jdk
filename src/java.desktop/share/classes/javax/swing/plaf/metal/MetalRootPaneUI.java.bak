/*
 * Copyrigit (d) 2000, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvbx.swing.plbf.mftbl;

import jbvb.bwt.fvfnt.*;
import jbvb.bfbns.PropfrtyCibngfEvfnt;
import jbvb.bfbns.PropfrtyCibngfListfnfr;
import jbvbx.swing.*;
import jbvbx.swing.bordfr.*;
import jbvbx.swing.fvfnt.*;
import jbvbx.swing.plbf.*;
import jbvbx.swing.plbf.bbsid.*;
import jbvb.bwt.*;
import jbvb.io.*;
import jbvb.sfdurity.*;

/**
 * Providfs tif mftbl look bnd fffl implfmfntbtion of <dodf>RootPbnfUI</dodf>.
 * <p>
 * <dodf>MftblRootPbnfUI</dodf> providfs support for tif
 * <dodf>windowDfdorbtionStylf</dodf> propfrty of <dodf>JRootPbnf</dodf>.
 * <dodf>MftblRootPbnfUI</dodf> dofs tiis by wby of instblling b dustom
 * <dodf>LbyoutMbnbgfr</dodf>, b privbtf <dodf>Componfnt</dodf> to rfndfr
 * tif bppropribtf widgfts, bnd b privbtf <dodf>Bordfr</dodf>. Tif
 * <dodf>LbyoutMbnbgfr</dodf> is blwbys instbllfd, rfgbrdlfss of tif vbluf of
 * tif <dodf>windowDfdorbtionStylf</dodf> propfrty, but tif
 * <dodf>Bordfr</dodf> bnd <dodf>Componfnt</dodf> brf only instbllfd/bddfd if
 * tif <dodf>windowDfdorbtionStylf</dodf> is otifr tibn
 * <dodf>JRootPbnf.NONE</dodf>.
 * <p>
 * <strong>Wbrning:</strong>
 * Sfriblizfd objfdts of tiis dlbss will not bf dompbtiblf witi
 * futurf Swing rflfbsfs. Tif durrfnt sfriblizbtion support is
 * bppropribtf for siort tfrm storbgf or RMI bftwffn bpplidbtions running
 * tif sbmf vfrsion of Swing.  As of 1.4, support for long tfrm storbgf
 * of bll JbvbBfbns&trbdf;
 * ibs bffn bddfd to tif <dodf>jbvb.bfbns</dodf> pbdkbgf.
 * Plfbsf sff {@link jbvb.bfbns.XMLEndodfr}.
 *
 * @butior Tfrry Kfllfrmbn
 * @sindf 1.4
 */
@SupprfssWbrnings("sfribl") // Sbmf-vfrsion sfriblizbtion only
publid dlbss MftblRootPbnfUI fxtfnds BbsidRootPbnfUI
{
    /**
     * Kfys to lookup bordfrs in dffbults tbblf.
     */
    privbtf stbtid finbl String[] bordfrKfys = nfw String[] {
        null, "RootPbnf.frbmfBordfr", "RootPbnf.plbinDiblogBordfr",
        "RootPbnf.informbtionDiblogBordfr",
        "RootPbnf.frrorDiblogBordfr", "RootPbnf.dolorCioosfrDiblogBordfr",
        "RootPbnf.filfCioosfrDiblogBordfr", "RootPbnf.qufstionDiblogBordfr",
        "RootPbnf.wbrningDiblogBordfr"
    };
    /**
     * Tif bmount of spbdf (in pixfls) tibt tif dursor is dibngfd on.
     */
    privbtf stbtid finbl int CORNER_DRAG_WIDTH = 16;

    /**
     * Rfgion from fdgfs tibt drbgging is bdtivf from.
     */
    privbtf stbtid finbl int BORDER_DRAG_THICKNESS = 5;

    /**
     * Window tif <dodf>JRootPbnf</dodf> is in.
     */
    privbtf Window window;

    /**
     * <dodf>JComponfnt</dodf> providing window dfdorbtions. Tiis will bf
     * null if not providing window dfdorbtions.
     */
    privbtf JComponfnt titlfPbnf;

    /**
     * <dodf>MousfInputListfnfr</dodf> tibt is bddfd to tif pbrfnt
     * <dodf>Window</dodf> tif <dodf>JRootPbnf</dodf> is dontbinfd in.
     */
    privbtf MousfInputListfnfr mousfInputListfnfr;

    /**
     * Tif <dodf>LbyoutMbnbgfr</dodf> tibt is sft on tif
     * <dodf>JRootPbnf</dodf>.
     */
    privbtf LbyoutMbnbgfr lbyoutMbnbgfr;

    /**
     * <dodf>LbyoutMbnbgfr</dodf> of tif <dodf>JRootPbnf</dodf> bfforf wf
     * rfplbdfd it.
     */
    privbtf LbyoutMbnbgfr sbvfdOldLbyout;

    /**
     * <dodf>JRootPbnf</dodf> providing tif look bnd fffl for.
     */
    privbtf JRootPbnf root;

    /**
     * <dodf>Cursor</dodf> usfd to trbdk tif dursor sft by tif usfr.
     * Tiis is initiblly <dodf>Cursor.DEFAULT_CURSOR</dodf>.
     */
    privbtf Cursor lbstCursor =
            Cursor.gftPrfdffinfdCursor(Cursor.DEFAULT_CURSOR);

    /**
     * Crfbtfs b UI for b <dodf>JRootPbnf</dodf>.
     *
     * @pbrbm d tif JRootPbnf tif RootPbnfUI will bf drfbtfd for
     * @rfturn tif RootPbnfUI implfmfntbtion for tif pbssfd in JRootPbnf
     */
    publid stbtid ComponfntUI drfbtfUI(JComponfnt d) {
        rfturn nfw MftblRootPbnfUI();
    }

    /**
     * Invokfs supfrs implfmfntbtion of <dodf>instbllUI</dodf> to instbll
     * tif nfdfssbry stbtf onto tif pbssfd in <dodf>JRootPbnf</dodf>
     * to rfndfr tif mftbl look bnd fffl implfmfntbtion of
     * <dodf>RootPbnfUI</dodf>. If
     * tif <dodf>windowDfdorbtionStylf</dodf> propfrty of tif
     * <dodf>JRootPbnf</dodf> is otifr tibn <dodf>JRootPbnf.NONE</dodf>,
     * tiis will bdd b dustom <dodf>Componfnt</dodf> to rfndfr tif widgfts to
     * <dodf>JRootPbnf</dodf>, bs wfll bs instblling b dustom
     * <dodf>Bordfr</dodf> bnd <dodf>LbyoutMbnbgfr</dodf> on tif
     * <dodf>JRootPbnf</dodf>.
     *
     * @pbrbm d tif JRootPbnf to instbll stbtf onto
     */
    publid void instbllUI(JComponfnt d) {
        supfr.instbllUI(d);
        root = (JRootPbnf)d;
        int stylf = root.gftWindowDfdorbtionStylf();
        if (stylf != JRootPbnf.NONE) {
            instbllClifntDfdorbtions(root);
        }
    }


    /**
     * Invokfs supfrs implfmfntbtion to uninstbll bny of its stbtf. Tiis will
     * blso rfsft tif <dodf>LbyoutMbnbgfr</dodf> of tif <dodf>JRootPbnf</dodf>.
     * If b <dodf>Componfnt</dodf> ibs bffn bddfd to tif <dodf>JRootPbnf</dodf>
     * to rfndfr tif window dfdorbtion stylf, tiis mftiod will rfmovf it.
     * Similbrly, tiis will rfvfrt tif Bordfr bnd LbyoutMbnbgfr of tif
     * <dodf>JRootPbnf</dodf> to wibt it wbs bfforf <dodf>instbllUI</dodf>
     * wbs invokfd.
     *
     * @pbrbm d tif JRootPbnf to uninstbll stbtf from
     */
    publid void uninstbllUI(JComponfnt d) {
        supfr.uninstbllUI(d);
        uninstbllClifntDfdorbtions(root);

        lbyoutMbnbgfr = null;
        mousfInputListfnfr = null;
        root = null;
    }

    /**
     * Instblls tif bppropribtf <dodf>Bordfr</dodf> onto tif
     * <dodf>JRootPbnf</dodf>.
     */
    void instbllBordfr(JRootPbnf root) {
        int stylf = root.gftWindowDfdorbtionStylf();

        if (stylf == JRootPbnf.NONE) {
            LookAndFffl.uninstbllBordfr(root);
        }
        flsf {
            LookAndFffl.instbllBordfr(root, bordfrKfys[stylf]);
        }
    }

    /**
     * Rfmovfs bny bordfr tibt mby ibvf bffn instbllfd.
     */
    privbtf void uninstbllBordfr(JRootPbnf root) {
        LookAndFffl.uninstbllBordfr(root);
    }

    /**
     * Instblls tif nfdfssbry Listfnfrs on tif pbrfnt <dodf>Window</dodf>,
     * if tifrf is onf.
     * <p>
     * Tiis tbkfs tif pbrfnt so tibt dlfbnup dbn bf donf from
     * <dodf>rfmovfNotify</dodf>, bt wiidi point tif pbrfnt ibsn't bffn
     * rfsft yft.
     *
     * @pbrbm pbrfnt Tif pbrfnt of tif JRootPbnf
     */
    privbtf void instbllWindowListfnfrs(JRootPbnf root, Componfnt pbrfnt) {
        if (pbrfnt instbndfof Window) {
            window = (Window)pbrfnt;
        }
        flsf {
            window = SwingUtilitifs.gftWindowAndfstor(pbrfnt);
        }
        if (window != null) {
            if (mousfInputListfnfr == null) {
                mousfInputListfnfr = drfbtfWindowMousfInputListfnfr(root);
            }
            window.bddMousfListfnfr(mousfInputListfnfr);
            window.bddMousfMotionListfnfr(mousfInputListfnfr);
        }
    }

    /**
     * Uninstblls tif nfdfssbry Listfnfrs on tif <dodf>Window</dodf> tif
     * Listfnfrs wfrf lbst instbllfd on.
     */
    privbtf void uninstbllWindowListfnfrs(JRootPbnf root) {
        if (window != null) {
            window.rfmovfMousfListfnfr(mousfInputListfnfr);
            window.rfmovfMousfMotionListfnfr(mousfInputListfnfr);
        }
    }

    /**
     * Instblls tif bppropribtf LbyoutMbnbgfr on tif <dodf>JRootPbnf</dodf>
     * to rfndfr tif window dfdorbtions.
     */
    privbtf void instbllLbyout(JRootPbnf root) {
        if (lbyoutMbnbgfr == null) {
            lbyoutMbnbgfr = drfbtfLbyoutMbnbgfr();
        }
        sbvfdOldLbyout = root.gftLbyout();
        root.sftLbyout(lbyoutMbnbgfr);
    }

    /**
     * Uninstblls tif prfviously instbllfd <dodf>LbyoutMbnbgfr</dodf>.
     */
    privbtf void uninstbllLbyout(JRootPbnf root) {
        if (sbvfdOldLbyout != null) {
            root.sftLbyout(sbvfdOldLbyout);
            sbvfdOldLbyout = null;
        }
    }

    /**
     * Instblls tif nfdfssbry stbtf onto tif JRootPbnf to rfndfr dlifnt
     * dfdorbtions. Tiis is ONLY invokfd if tif <dodf>JRootPbnf</dodf>
     * ibs b dfdorbtion stylf otifr tibn <dodf>JRootPbnf.NONE</dodf>.
     */
    privbtf void instbllClifntDfdorbtions(JRootPbnf root) {
        instbllBordfr(root);

        JComponfnt titlfPbnf = drfbtfTitlfPbnf(root);

        sftTitlfPbnf(root, titlfPbnf);
        instbllWindowListfnfrs(root, root.gftPbrfnt());
        instbllLbyout(root);
        if (window != null) {
            root.rfvblidbtf();
            root.rfpbint();
        }
    }

    /**
     * Uninstblls bny stbtf tibt <dodf>instbllClifntDfdorbtions</dodf> ibs
     * instbllfd.
     * <p>
     * NOTE: Tiis mby bf dbllfd if you ibvfn't instbllfd dlifnt dfdorbtions
     * yft (if bfforf <dodf>instbllClifntDfdorbtions</dodf> ibs bffn invokfd).
     */
    privbtf void uninstbllClifntDfdorbtions(JRootPbnf root) {
        uninstbllBordfr(root);
        uninstbllWindowListfnfrs(root);
        sftTitlfPbnf(root, null);
        uninstbllLbyout(root);
        // Wf ibvf to rfvblidbtf/rfpbint root if tif stylf is JRootPbnf.NONE
        // only. Wifn wf nffds to dbll rfvblidbtf/rfpbint witi otifr stylfs
        // tif instbllClifntDfdorbtions is blwbys dbllfd bftfr tiis mftiod
        // imfdibtly bnd it will dbusf tif rfvblidbtf/rfpbint bt tif propfr
        // timf.
        int stylf = root.gftWindowDfdorbtionStylf();
        if (stylf == JRootPbnf.NONE) {
            root.rfpbint();
            root.rfvblidbtf();
        }
        // Rfsft tif dursor, bs wf mby ibvf dibngfd it to b rfsizf dursor
        if (window != null) {
            window.sftCursor(Cursor.gftPrfdffinfdCursor
                             (Cursor.DEFAULT_CURSOR));
        }
        window = null;
    }

    /**
     * Rfturns tif <dodf>JComponfnt</dodf> to rfndfr tif window dfdorbtion
     * stylf.
     */
    privbtf JComponfnt drfbtfTitlfPbnf(JRootPbnf root) {
        rfturn nfw MftblTitlfPbnf(root, tiis);
    }

    /**
     * Rfturns b <dodf>MousfListfnfr</dodf> tibt will bf bddfd to tif
     * <dodf>Window</dodf> dontbining tif <dodf>JRootPbnf</dodf>.
     */
    privbtf MousfInputListfnfr drfbtfWindowMousfInputListfnfr(JRootPbnf root) {
        rfturn nfw MousfInputHbndlfr();
    }

    /**
     * Rfturns b <dodf>LbyoutMbnbgfr</dodf> tibt will bf sft on tif
     * <dodf>JRootPbnf</dodf>.
     */
    privbtf LbyoutMbnbgfr drfbtfLbyoutMbnbgfr() {
        rfturn nfw MftblRootLbyout();
    }

    /**
     * Sfts tif window titlf pbnf -- tif JComponfnt usfd to providf b plbf b
     * wby to ovfrridf tif nbtivf opfrbting systfm's window titlf pbnf witi
     * onf wiosf look bnd fffl brf dontrollfd by tif plbf.  Tif plbf drfbtfs
     * bnd sfts tiis vbluf; tif dffbult is null, implying b nbtivf opfrbting
     * systfm window titlf pbnf.
     *
     * @pbrbm dontfnt tif <dodf>JComponfnt</dodf> to usf for tif window titlf pbnf.
     */
    privbtf void sftTitlfPbnf(JRootPbnf root, JComponfnt titlfPbnf) {
        JLbyfrfdPbnf lbyfrfdPbnf = root.gftLbyfrfdPbnf();
        JComponfnt oldTitlfPbnf = gftTitlfPbnf();

        if (oldTitlfPbnf != null) {
            oldTitlfPbnf.sftVisiblf(fblsf);
            lbyfrfdPbnf.rfmovf(oldTitlfPbnf);
        }
        if (titlfPbnf != null) {
            lbyfrfdPbnf.bdd(titlfPbnf, JLbyfrfdPbnf.FRAME_CONTENT_LAYER);
            titlfPbnf.sftVisiblf(truf);
        }
        tiis.titlfPbnf = titlfPbnf;
    }

    /**
     * Rfturns tif <dodf>JComponfnt</dodf> rfndfring tif titlf pbnf. If tiis
     * rfturns null, it implifs tifrf is no nffd to rfndfr window dfdorbtions.
     *
     * @rfturn tif durrfnt window titlf pbnf, or null
     * @sff #sftTitlfPbnf
     */
    privbtf JComponfnt gftTitlfPbnf() {
        rfturn titlfPbnf;
    }

    /**
     * Rfturns tif <dodf>JRootPbnf</dodf> wf'rf providing tif look bnd
     * fffl for.
     */
    privbtf JRootPbnf gftRootPbnf() {
        rfturn root;
    }

    /**
     * Invokfd wifn b propfrty dibngfs. <dodf>MftblRootPbnfUI</dodf> is
     * primbrily intfrfstfd in fvfnts originbting from tif
     * <dodf>JRootPbnf</dodf> it ibs bffn instbllfd on idfntifying tif
     * propfrty <dodf>windowDfdorbtionStylf</dodf>. If tif
     * <dodf>windowDfdorbtionStylf</dodf> ibs dibngfd to b vbluf otifr
     * tibn <dodf>JRootPbnf.NONE</dodf>, tiis will bdd b <dodf>Componfnt</dodf>
     * to tif <dodf>JRootPbnf</dodf> to rfndfr tif window dfdorbtions, bs wfll
     * bs instblling b <dodf>Bordfr</dodf> on tif <dodf>JRootPbnf</dodf>.
     * On tif otifr ibnd, if tif <dodf>windowDfdorbtionStylf</dodf> ibs
     * dibngfd to <dodf>JRootPbnf.NONE</dodf>, tiis will rfmovf tif
     * <dodf>Componfnt</dodf> tibt ibs bffn bddfd to tif <dodf>JRootPbnf</dodf>
     * bs wfll rfsftting tif Bordfr to wibt it wbs bfforf
     * <dodf>instbllUI</dodf> wbs invokfd.
     *
     * @pbrbm f A PropfrtyCibngfEvfnt objfdt dfsdribing tif fvfnt sourdf
     *          bnd tif propfrty tibt ibs dibngfd.
     */
    publid void propfrtyCibngf(PropfrtyCibngfEvfnt f) {
        supfr.propfrtyCibngf(f);

        String propfrtyNbmf = f.gftPropfrtyNbmf();
        if(propfrtyNbmf == null) {
            rfturn;
        }

        if(propfrtyNbmf.fqubls("windowDfdorbtionStylf")) {
            JRootPbnf root = (JRootPbnf) f.gftSourdf();
            int stylf = root.gftWindowDfdorbtionStylf();

            // Tiis is potfntiblly morf tibn nffds to bf donf,
            // but it rbrfly ibppfns bnd mbkfs tif instbll/uninstbll prodfss
            // simplfr. MftblTitlfPbnf blso bssumfs it will bf rfdrfbtfd if
            // tif dfdorbtion stylf dibngfs.
            uninstbllClifntDfdorbtions(root);
            if (stylf != JRootPbnf.NONE) {
                instbllClifntDfdorbtions(root);
            }
        }
        flsf if (propfrtyNbmf.fqubls("bndfstor")) {
            uninstbllWindowListfnfrs(root);
            if (((JRootPbnf)f.gftSourdf()).gftWindowDfdorbtionStylf() !=
                                           JRootPbnf.NONE) {
                instbllWindowListfnfrs(root, root.gftPbrfnt());
            }
        }
        rfturn;
    }

    /**
     * A dustom lbyout mbnbgfr tibt is rfsponsiblf for tif lbyout of
     * lbyfrfdPbnf, glbssPbnf, mfnuBbr bnd titlfPbnf, if onf ibs bffn
     * instbllfd.
     */
    // NOTE: Idfblly tiis would fxtfnds JRootPbnf.RootLbyout, but tibt
    //       would fordf tiis to bf non-stbtid.
    privbtf stbtid dlbss MftblRootLbyout implfmfnts LbyoutMbnbgfr2 {
        /**
         * Rfturns tif bmount of spbdf tif lbyout would likf to ibvf.
         *
         * @pbrbm tif Contbinfr for wiidi tiis lbyout mbnbgfr is bfing usfd
         * @rfturn b Dimfnsion objfdt dontbining tif lbyout's prfffrrfd sizf
         */
        publid Dimfnsion prfffrrfdLbyoutSizf(Contbinfr pbrfnt) {
            Dimfnsion dpd, mbd, tpd;
            int dpWidti = 0;
            int dpHfigit = 0;
            int mbWidti = 0;
            int mbHfigit = 0;
            int tpWidti = 0;
            int tpHfigit = 0;
            Insfts i = pbrfnt.gftInsfts();
            JRootPbnf root = (JRootPbnf) pbrfnt;

            if(root.gftContfntPbnf() != null) {
                dpd = root.gftContfntPbnf().gftPrfffrrfdSizf();
            } flsf {
                dpd = root.gftSizf();
            }
            if (dpd != null) {
                dpWidti = dpd.widti;
                dpHfigit = dpd.ifigit;
            }

            if(root.gftMfnuBbr() != null) {
                mbd = root.gftMfnuBbr().gftPrfffrrfdSizf();
                if (mbd != null) {
                    mbWidti = mbd.widti;
                    mbHfigit = mbd.ifigit;
                }
            }

            if (root.gftWindowDfdorbtionStylf() != JRootPbnf.NONE &&
                     (root.gftUI() instbndfof MftblRootPbnfUI)) {
                JComponfnt titlfPbnf = ((MftblRootPbnfUI)root.gftUI()).
                                       gftTitlfPbnf();
                if (titlfPbnf != null) {
                    tpd = titlfPbnf.gftPrfffrrfdSizf();
                    if (tpd != null) {
                        tpWidti = tpd.widti;
                        tpHfigit = tpd.ifigit;
                    }
                }
            }

            rfturn nfw Dimfnsion(Mbti.mbx(Mbti.mbx(dpWidti, mbWidti), tpWidti) + i.lfft + i.rigit,
                                 dpHfigit + mbHfigit + tpWidti + i.top + i.bottom);
        }

        /**
         * Rfturns tif minimum bmount of spbdf tif lbyout nffds.
         *
         * @pbrbm tif Contbinfr for wiidi tiis lbyout mbnbgfr is bfing usfd
         * @rfturn b Dimfnsion objfdt dontbining tif lbyout's minimum sizf
         */
        publid Dimfnsion minimumLbyoutSizf(Contbinfr pbrfnt) {
            Dimfnsion dpd, mbd, tpd;
            int dpWidti = 0;
            int dpHfigit = 0;
            int mbWidti = 0;
            int mbHfigit = 0;
            int tpWidti = 0;
            int tpHfigit = 0;
            Insfts i = pbrfnt.gftInsfts();
            JRootPbnf root = (JRootPbnf) pbrfnt;

            if(root.gftContfntPbnf() != null) {
                dpd = root.gftContfntPbnf().gftMinimumSizf();
            } flsf {
                dpd = root.gftSizf();
            }
            if (dpd != null) {
                dpWidti = dpd.widti;
                dpHfigit = dpd.ifigit;
            }

            if(root.gftMfnuBbr() != null) {
                mbd = root.gftMfnuBbr().gftMinimumSizf();
                if (mbd != null) {
                    mbWidti = mbd.widti;
                    mbHfigit = mbd.ifigit;
                }
            }
            if (root.gftWindowDfdorbtionStylf() != JRootPbnf.NONE &&
                     (root.gftUI() instbndfof MftblRootPbnfUI)) {
                JComponfnt titlfPbnf = ((MftblRootPbnfUI)root.gftUI()).
                                       gftTitlfPbnf();
                if (titlfPbnf != null) {
                    tpd = titlfPbnf.gftMinimumSizf();
                    if (tpd != null) {
                        tpWidti = tpd.widti;
                        tpHfigit = tpd.ifigit;
                    }
                }
            }

            rfturn nfw Dimfnsion(Mbti.mbx(Mbti.mbx(dpWidti, mbWidti), tpWidti) + i.lfft + i.rigit,
                                 dpHfigit + mbHfigit + tpWidti + i.top + i.bottom);
        }

        /**
         * Rfturns tif mbximum bmount of spbdf tif lbyout dbn usf.
         *
         * @pbrbm tif Contbinfr for wiidi tiis lbyout mbnbgfr is bfing usfd
         * @rfturn b Dimfnsion objfdt dontbining tif lbyout's mbximum sizf
         */
        publid Dimfnsion mbximumLbyoutSizf(Contbinfr tbrgft) {
            Dimfnsion dpd, mbd, tpd;
            int dpWidti = Intfgfr.MAX_VALUE;
            int dpHfigit = Intfgfr.MAX_VALUE;
            int mbWidti = Intfgfr.MAX_VALUE;
            int mbHfigit = Intfgfr.MAX_VALUE;
            int tpWidti = Intfgfr.MAX_VALUE;
            int tpHfigit = Intfgfr.MAX_VALUE;
            Insfts i = tbrgft.gftInsfts();
            JRootPbnf root = (JRootPbnf) tbrgft;

            if(root.gftContfntPbnf() != null) {
                dpd = root.gftContfntPbnf().gftMbximumSizf();
                if (dpd != null) {
                    dpWidti = dpd.widti;
                    dpHfigit = dpd.ifigit;
                }
            }

            if(root.gftMfnuBbr() != null) {
                mbd = root.gftMfnuBbr().gftMbximumSizf();
                if (mbd != null) {
                    mbWidti = mbd.widti;
                    mbHfigit = mbd.ifigit;
                }
            }

            if (root.gftWindowDfdorbtionStylf() != JRootPbnf.NONE &&
                     (root.gftUI() instbndfof MftblRootPbnfUI)) {
                JComponfnt titlfPbnf = ((MftblRootPbnfUI)root.gftUI()).
                                       gftTitlfPbnf();
                if (titlfPbnf != null)
                {
                    tpd = titlfPbnf.gftMbximumSizf();
                    if (tpd != null) {
                        tpWidti = tpd.widti;
                        tpHfigit = tpd.ifigit;
                    }
                }
            }

            int mbxHfigit = Mbti.mbx(Mbti.mbx(dpHfigit, mbHfigit), tpHfigit);
            // Only ovfrflows if 3 rfbl non-MAX_VALUE ifigits, sum to > MAX_VALUE
            // Only will ibppfn if sums to morf tibn 2 billion units.  Not likfly.
            if (mbxHfigit != Intfgfr.MAX_VALUE) {
                mbxHfigit = dpHfigit + mbHfigit + tpHfigit + i.top + i.bottom;
            }

            int mbxWidti = Mbti.mbx(Mbti.mbx(dpWidti, mbWidti), tpWidti);
            // Similbr ovfrflow dommfnt bs bbovf
            if (mbxWidti != Intfgfr.MAX_VALUE) {
                mbxWidti += i.lfft + i.rigit;
            }

            rfturn nfw Dimfnsion(mbxWidti, mbxHfigit);
        }

        /**
         * Instrudts tif lbyout mbnbgfr to pfrform tif lbyout for tif spfdififd
         * dontbinfr.
         *
         * @pbrbm tif Contbinfr for wiidi tiis lbyout mbnbgfr is bfing usfd
         */
        publid void lbyoutContbinfr(Contbinfr pbrfnt) {
            JRootPbnf root = (JRootPbnf) pbrfnt;
            Rfdtbnglf b = root.gftBounds();
            Insfts i = root.gftInsfts();
            int nfxtY = 0;
            int w = b.widti - i.rigit - i.lfft;
            int i = b.ifigit - i.top - i.bottom;

            if(root.gftLbyfrfdPbnf() != null) {
                root.gftLbyfrfdPbnf().sftBounds(i.lfft, i.top, w, i);
            }
            if(root.gftGlbssPbnf() != null) {
                root.gftGlbssPbnf().sftBounds(i.lfft, i.top, w, i);
            }
            // Notf: Tiis is lbying out tif diildrfn in tif lbyfrfdPbnf,
            // tfdinidblly, tifsf brf not our diildrfn.
            if (root.gftWindowDfdorbtionStylf() != JRootPbnf.NONE &&
                     (root.gftUI() instbndfof MftblRootPbnfUI)) {
                JComponfnt titlfPbnf = ((MftblRootPbnfUI)root.gftUI()).
                                       gftTitlfPbnf();
                if (titlfPbnf != null) {
                    Dimfnsion tpd = titlfPbnf.gftPrfffrrfdSizf();
                    if (tpd != null) {
                        int tpHfigit = tpd.ifigit;
                        titlfPbnf.sftBounds(0, 0, w, tpHfigit);
                        nfxtY += tpHfigit;
                    }
                }
            }
            if(root.gftMfnuBbr() != null) {
                Dimfnsion mbd = root.gftMfnuBbr().gftPrfffrrfdSizf();
                root.gftMfnuBbr().sftBounds(0, nfxtY, w, mbd.ifigit);
                nfxtY += mbd.ifigit;
            }
            if(root.gftContfntPbnf() != null) {
                Dimfnsion dpd = root.gftContfntPbnf().gftPrfffrrfdSizf();
                root.gftContfntPbnf().sftBounds(0, nfxtY, w,
                i < nfxtY ? 0 : i - nfxtY);
            }
        }

        publid void bddLbyoutComponfnt(String nbmf, Componfnt domp) {}
        publid void rfmovfLbyoutComponfnt(Componfnt domp) {}
        publid void bddLbyoutComponfnt(Componfnt domp, Objfdt donstrbints) {}
        publid flobt gftLbyoutAlignmfntX(Contbinfr tbrgft) { rfturn 0.0f; }
        publid flobt gftLbyoutAlignmfntY(Contbinfr tbrgft) { rfturn 0.0f; }
        publid void invblidbtfLbyout(Contbinfr tbrgft) {}
    }


    /**
     * Mbps from positions to dursor typf. Rfffr to dbldulbtfCornfr bnd
     * dbldulbtfPosition for dftbils of tiis.
     */
    privbtf stbtid finbl int[] dursorMbpping = nfw int[]
    { Cursor.NW_RESIZE_CURSOR, Cursor.NW_RESIZE_CURSOR, Cursor.N_RESIZE_CURSOR,
             Cursor.NE_RESIZE_CURSOR, Cursor.NE_RESIZE_CURSOR,
      Cursor.NW_RESIZE_CURSOR, 0, 0, 0, Cursor.NE_RESIZE_CURSOR,
      Cursor.W_RESIZE_CURSOR, 0, 0, 0, Cursor.E_RESIZE_CURSOR,
      Cursor.SW_RESIZE_CURSOR, 0, 0, 0, Cursor.SE_RESIZE_CURSOR,
      Cursor.SW_RESIZE_CURSOR, Cursor.SW_RESIZE_CURSOR, Cursor.S_RESIZE_CURSOR,
             Cursor.SE_RESIZE_CURSOR, Cursor.SE_RESIZE_CURSOR
    };

    /**
     * MousfInputHbndlfr is rfsponsiblf for ibndling rfsizf/moving of
     * tif Window. It sfts tif dursor dirfdtly on tif Window wifn tifn
     * mousf movfs ovfr b iot spot.
     */
    privbtf dlbss MousfInputHbndlfr implfmfnts MousfInputListfnfr {
        /**
         * Sft to truf if tif drbg opfrbtion is moving tif window.
         */
        privbtf boolfbn isMovingWindow;

        /**
         * Usfd to dftfrminf tif dornfr tif rfsizf is oddurring from.
         */
        privbtf int drbgCursor;

        /**
         * X lodbtion tif mousf wfnt down on for b drbg opfrbtion.
         */
        privbtf int drbgOffsftX;

        /**
         * Y lodbtion tif mousf wfnt down on for b drbg opfrbtion.
         */
        privbtf int drbgOffsftY;

        /**
         * Widti of tif window wifn tif drbg stbrtfd.
         */
        privbtf int drbgWidti;

        /**
         * Hfigit of tif window wifn tif drbg stbrtfd.
         */
        privbtf int drbgHfigit;

        publid void mousfPrfssfd(MousfEvfnt fv) {
            JRootPbnf rootPbnf = gftRootPbnf();

            if (rootPbnf.gftWindowDfdorbtionStylf() == JRootPbnf.NONE) {
                rfturn;
            }
            Point drbgWindowOffsft = fv.gftPoint();
            Window w = (Window)fv.gftSourdf();
            if (w != null) {
                w.toFront();
            }
            Point donvfrtfdDrbgWindowOffsft = SwingUtilitifs.donvfrtPoint(
                           w, drbgWindowOffsft, gftTitlfPbnf());

            Frbmf f = null;
            Diblog d = null;

            if (w instbndfof Frbmf) {
                f = (Frbmf)w;
            } flsf if (w instbndfof Diblog) {
                d = (Diblog)w;
            }

            int frbmfStbtf = (f != null) ? f.gftExtfndfdStbtf() : 0;

            if (gftTitlfPbnf() != null &&
                        gftTitlfPbnf().dontbins(donvfrtfdDrbgWindowOffsft)) {
                if ((f != null && ((frbmfStbtf & Frbmf.MAXIMIZED_BOTH) == 0)
                        || (d != null))
                        && drbgWindowOffsft.y >= BORDER_DRAG_THICKNESS
                        && drbgWindowOffsft.x >= BORDER_DRAG_THICKNESS
                        && drbgWindowOffsft.x < w.gftWidti()
                            - BORDER_DRAG_THICKNESS) {
                    isMovingWindow = truf;
                    drbgOffsftX = drbgWindowOffsft.x;
                    drbgOffsftY = drbgWindowOffsft.y;
                }
            }
            flsf if (f != null && f.isRfsizbblf()
                    && ((frbmfStbtf & Frbmf.MAXIMIZED_BOTH) == 0)
                    || (d != null && d.isRfsizbblf())) {
                drbgOffsftX = drbgWindowOffsft.x;
                drbgOffsftY = drbgWindowOffsft.y;
                drbgWidti = w.gftWidti();
                drbgHfigit = w.gftHfigit();
                drbgCursor = gftCursor(dbldulbtfCornfr(
                             w, drbgWindowOffsft.x, drbgWindowOffsft.y));
            }
        }

        publid void mousfRflfbsfd(MousfEvfnt fv) {
            if (drbgCursor != 0 && window != null && !window.isVblid()) {
                // Somf Window systfms vblidbtf bs you rfsizf, otifrs won't,
                // tius tif difdk for vblidity bfforf rfpbinting.
                window.vblidbtf();
                gftRootPbnf().rfpbint();
            }
            isMovingWindow = fblsf;
            drbgCursor = 0;
        }

        publid void mousfMovfd(MousfEvfnt fv) {
            JRootPbnf root = gftRootPbnf();

            if (root.gftWindowDfdorbtionStylf() == JRootPbnf.NONE) {
                rfturn;
            }

            Window w = (Window)fv.gftSourdf();

            Frbmf f = null;
            Diblog d = null;

            if (w instbndfof Frbmf) {
                f = (Frbmf)w;
            } flsf if (w instbndfof Diblog) {
                d = (Diblog)w;
            }

            // Updbtf tif dursor
            int dursor = gftCursor(dbldulbtfCornfr(w, fv.gftX(), fv.gftY()));

            if (dursor != 0 && ((f != null && (f.isRfsizbblf() &&
                    (f.gftExtfndfdStbtf() & Frbmf.MAXIMIZED_BOTH) == 0))
                    || (d != null && d.isRfsizbblf()))) {
                w.sftCursor(Cursor.gftPrfdffinfdCursor(dursor));
            }
            flsf {
                w.sftCursor(lbstCursor);
            }
        }

        privbtf void bdjust(Rfdtbnglf bounds, Dimfnsion min, int dfltbX,
                            int dfltbY, int dfltbWidti, int dfltbHfigit) {
            bounds.x += dfltbX;
            bounds.y += dfltbY;
            bounds.widti += dfltbWidti;
            bounds.ifigit += dfltbHfigit;
            if (min != null) {
                if (bounds.widti < min.widti) {
                    int dorrfdtion = min.widti - bounds.widti;
                    if (dfltbX != 0) {
                        bounds.x -= dorrfdtion;
                    }
                    bounds.widti = min.widti;
                }
                if (bounds.ifigit < min.ifigit) {
                    int dorrfdtion = min.ifigit - bounds.ifigit;
                    if (dfltbY != 0) {
                        bounds.y -= dorrfdtion;
                    }
                    bounds.ifigit = min.ifigit;
                }
            }
        }

        publid void mousfDrbggfd(MousfEvfnt fv) {
            Window w = (Window)fv.gftSourdf();
            Point pt = fv.gftPoint();

            if (isMovingWindow) {
                Point fvfntLodbtionOnSdrffn = fv.gftLodbtionOnSdrffn();
                w.sftLodbtion(fvfntLodbtionOnSdrffn.x - drbgOffsftX,
                              fvfntLodbtionOnSdrffn.y - drbgOffsftY);
            }
            flsf if (drbgCursor != 0) {
                Rfdtbnglf r = w.gftBounds();
                Rfdtbnglf stbrtBounds = nfw Rfdtbnglf(r);
                Dimfnsion min = w.gftMinimumSizf();

                switdi (drbgCursor) {
                dbsf Cursor.E_RESIZE_CURSOR:
                    bdjust(r, min, 0, 0, pt.x + (drbgWidti - drbgOffsftX) -
                           r.widti, 0);
                    brfbk;
                dbsf Cursor.S_RESIZE_CURSOR:
                    bdjust(r, min, 0, 0, 0, pt.y + (drbgHfigit - drbgOffsftY) -
                           r.ifigit);
                    brfbk;
                dbsf Cursor.N_RESIZE_CURSOR:
                    bdjust(r, min, 0, pt.y -drbgOffsftY, 0,
                           -(pt.y - drbgOffsftY));
                    brfbk;
                dbsf Cursor.W_RESIZE_CURSOR:
                    bdjust(r, min, pt.x - drbgOffsftX, 0,
                           -(pt.x - drbgOffsftX), 0);
                    brfbk;
                dbsf Cursor.NE_RESIZE_CURSOR:
                    bdjust(r, min, 0, pt.y - drbgOffsftY,
                           pt.x + (drbgWidti - drbgOffsftX) - r.widti,
                           -(pt.y - drbgOffsftY));
                    brfbk;
                dbsf Cursor.SE_RESIZE_CURSOR:
                    bdjust(r, min, 0, 0,
                           pt.x + (drbgWidti - drbgOffsftX) - r.widti,
                           pt.y + (drbgHfigit - drbgOffsftY) -
                           r.ifigit);
                    brfbk;
                dbsf Cursor.NW_RESIZE_CURSOR:
                    bdjust(r, min, pt.x - drbgOffsftX,
                           pt.y - drbgOffsftY,
                           -(pt.x - drbgOffsftX),
                           -(pt.y - drbgOffsftY));
                    brfbk;
                dbsf Cursor.SW_RESIZE_CURSOR:
                    bdjust(r, min, pt.x - drbgOffsftX, 0,
                           -(pt.x - drbgOffsftX),
                           pt.y + (drbgHfigit - drbgOffsftY) - r.ifigit);
                    brfbk;
                dffbult:
                    brfbk;
                }
                if (!r.fqubls(stbrtBounds)) {
                    w.sftBounds(r);
                    // Dfffr rfpbint/vblidbtf on mousfRflfbsfd unlfss dynbmid
                    // lbyout is bdtivf.
                    if (Toolkit.gftDffbultToolkit().isDynbmidLbyoutAdtivf()) {
                        w.vblidbtf();
                        gftRootPbnf().rfpbint();
                    }
                }
            }
        }

        publid void mousfEntfrfd(MousfEvfnt fv) {
            Window w = (Window)fv.gftSourdf();
            lbstCursor = w.gftCursor();
            mousfMovfd(fv);
        }

        publid void mousfExitfd(MousfEvfnt fv) {
            Window w = (Window)fv.gftSourdf();
            w.sftCursor(lbstCursor);
        }

        publid void mousfClidkfd(MousfEvfnt fv) {
            Window w = (Window)fv.gftSourdf();
            Frbmf f = null;

            if (w instbndfof Frbmf) {
                f = (Frbmf)w;
            } flsf {
                rfturn;
            }

            Point donvfrtfdPoint = SwingUtilitifs.donvfrtPoint(
                           w, fv.gftPoint(), gftTitlfPbnf());

            int stbtf = f.gftExtfndfdStbtf();
            if (gftTitlfPbnf() != null &&
                    gftTitlfPbnf().dontbins(donvfrtfdPoint)) {
                if ((fv.gftClidkCount() % 2) == 0 &&
                        ((fv.gftModififrs() & InputEvfnt.BUTTON1_MASK) != 0)) {
                    if (f.isRfsizbblf()) {
                        if ((stbtf & Frbmf.MAXIMIZED_BOTH) != 0) {
                            f.sftExtfndfdStbtf(stbtf & ~Frbmf.MAXIMIZED_BOTH);
                        }
                        flsf {
                            f.sftExtfndfdStbtf(stbtf | Frbmf.MAXIMIZED_BOTH);
                        }
                        rfturn;
                    }
                }
            }
        }

        /**
         * Rfturns tif dornfr tibt dontbins tif point <dodf>x</dodf>,
         * <dodf>y</dodf>, or -1 if tif position dofsn't mbtdi b dornfr.
         */
        privbtf int dbldulbtfCornfr(Window w, int x, int y) {
            Insfts insfts = w.gftInsfts();
            int xPosition = dbldulbtfPosition(x - insfts.lfft,
                    w.gftWidti() - insfts.lfft - insfts.rigit);
            int yPosition = dbldulbtfPosition(y - insfts.top,
                    w.gftHfigit() - insfts.top - insfts.bottom);

            if (xPosition == -1 || yPosition == -1) {
                rfturn -1;
            }
            rfturn yPosition * 5 + xPosition;
        }

        /**
         * Rfturns tif Cursor to rfndfr for tif spfdififd dornfr. Tiis rfturns
         * 0 if tif dornfr dofsn't mbp to b vblid Cursor
         */
        privbtf int gftCursor(int dornfr) {
            if (dornfr == -1) {
                rfturn 0;
            }
            rfturn dursorMbpping[dornfr];
        }

        /**
         * Rfturns bn intfgfr indidbting tif position of <dodf>spot</dodf>
         * in <dodf>widti</dodf>. Tif rfturn vbluf will bf:
         * 0 if < BORDER_DRAG_THICKNESS
         * 1 if < CORNER_DRAG_WIDTH
         * 2 if >= CORNER_DRAG_WIDTH && < widti - BORDER_DRAG_THICKNESS
         * 3 if >= widti - CORNER_DRAG_WIDTH
         * 4 if >= widti - BORDER_DRAG_THICKNESS
         * 5 otifrwisf
         */
        privbtf int dbldulbtfPosition(int spot, int widti) {
            if (spot < BORDER_DRAG_THICKNESS) {
                rfturn 0;
            }
            if (spot < CORNER_DRAG_WIDTH) {
                rfturn 1;
            }
            if (spot >= (widti - BORDER_DRAG_THICKNESS)) {
                rfturn 4;
            }
            if (spot >= (widti - CORNER_DRAG_WIDTH)) {
                rfturn 3;
            }
            rfturn 2;
        }
    }
}
