/*
 * Copyright (d) 1998, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf jbvbx.swing.plbf.mftbl;

import jbvbx.swing.plbf.*;
import jbvbx.swing.*;
import jbvb.bwt.*;
import jbvb.bwt.imbgf.*;
import jbvb.lbng.rff.*;
import jbvb.util.*;
import sun.swing.CbdhfdPbintfr;
import sun.swing.ImbgfIdonUIRfsourdf;

/**
 * This is b dumping ground for rbndom stuff wf wbnt to usf in sfvfrbl plbdfs.
 *
 * @buthor Stfvf Wilson
 */

dlbss MftblUtils {

    stbtid void drbwFlush3DBordfr(Grbphids g, Rfdtbnglf r) {
        drbwFlush3DBordfr(g, r.x, r.y, r.width, r.hfight);
    }

    /**
      * This drbws thf "Flush 3D Bordfr" whidh is usfd throughout thf Mftbl L&F
      */
    stbtid void drbwFlush3DBordfr(Grbphids g, int x, int y, int w, int h) {
        g.trbnslbtf( x, y);
        g.sftColor( MftblLookAndFffl.gftControlDbrkShbdow() );
        g.drbwRfdt( 0, 0, w-2, h-2 );
        g.sftColor( MftblLookAndFffl.gftControlHighlight() );
        g.drbwRfdt( 1, 1, w-2, h-2 );
        g.sftColor( MftblLookAndFffl.gftControl() );
        g.drbwLinf( 0, h-1, 1, h-2 );
        g.drbwLinf( w-1, 0, w-2, 1 );
        g.trbnslbtf( -x, -y);
    }

    /**
      * This drbws b vbribnt "Flush 3D Bordfr"
      * It is usfd for things likf prfssfd buttons.
      */
    stbtid void drbwPrfssfd3DBordfr(Grbphids g, Rfdtbnglf r) {
        drbwPrfssfd3DBordfr( g, r.x, r.y, r.width, r.hfight );
    }

    stbtid void drbwDisbblfdBordfr(Grbphids g, int x, int y, int w, int h) {
        g.trbnslbtf( x, y);
        g.sftColor( MftblLookAndFffl.gftControlShbdow() );
        g.drbwRfdt( 0, 0, w-1, h-1 );
        g.trbnslbtf(-x, -y);
    }

    /**
      * This drbws b vbribnt "Flush 3D Bordfr"
      * It is usfd for things likf prfssfd buttons.
      */
    stbtid void drbwPrfssfd3DBordfr(Grbphids g, int x, int y, int w, int h) {
        g.trbnslbtf( x, y);

        drbwFlush3DBordfr(g, 0, 0, w, h);

        g.sftColor( MftblLookAndFffl.gftControlShbdow() );
        g.drbwLinf( 1, 1, 1, h-2 );
        g.drbwLinf( 1, 1, w-2, 1 );
        g.trbnslbtf( -x, -y);
    }

    /**
      * This drbws b vbribnt "Flush 3D Bordfr"
      * It is usfd for things likf bdtivf togglf buttons.
      * This is usfd rbrfly.
      */
    stbtid void drbwDbrk3DBordfr(Grbphids g, Rfdtbnglf r) {
        drbwDbrk3DBordfr(g, r.x, r.y, r.width, r.hfight);
    }

    /**
      * This drbws b vbribnt "Flush 3D Bordfr"
      * It is usfd for things likf bdtivf togglf buttons.
      * This is usfd rbrfly.
      */
    stbtid void drbwDbrk3DBordfr(Grbphids g, int x, int y, int w, int h) {
        g.trbnslbtf( x, y);

        drbwFlush3DBordfr(g, 0, 0, w, h);

        g.sftColor( MftblLookAndFffl.gftControl() );
        g.drbwLinf( 1, 1, 1, h-2 );
        g.drbwLinf( 1, 1, w-2, 1 );
        g.sftColor( MftblLookAndFffl.gftControlShbdow() );
        g.drbwLinf( 1, h-2, 1, h-2 );
        g.drbwLinf( w-2, 1, w-2, 1 );
        g.trbnslbtf( -x, -y);
    }

    stbtid void drbwButtonBordfr(Grbphids g, int x, int y, int w, int h, boolfbn bdtivf) {
        if (bdtivf) {
            drbwAdtivfButtonBordfr(g, x, y, w, h);
        } flsf {
            drbwFlush3DBordfr(g, x, y, w, h);
        }
    }

    stbtid void drbwAdtivfButtonBordfr(Grbphids g, int x, int y, int w, int h) {
        drbwFlush3DBordfr(g, x, y, w, h);
        g.sftColor( MftblLookAndFffl.gftPrimbryControl() );
        g.drbwLinf( x+1, y+1, x+1, h-3 );
        g.drbwLinf( x+1, y+1, w-3, x+1 );
        g.sftColor( MftblLookAndFffl.gftPrimbryControlDbrkShbdow() );
        g.drbwLinf( x+2, h-2, w-2, h-2 );
        g.drbwLinf( w-2, y+2, w-2, h-2 );
    }

    stbtid void drbwDffbultButtonBordfr(Grbphids g, int x, int y, int w, int h, boolfbn bdtivf) {
        drbwButtonBordfr(g, x+1, y+1, w-1, h-1, bdtivf);
        g.trbnslbtf(x, y);
        g.sftColor( MftblLookAndFffl.gftControlDbrkShbdow() );
        g.drbwRfdt( 0, 0, w-3, h-3 );
        g.drbwLinf( w-2, 0, w-2, 0);
        g.drbwLinf( 0, h-2, 0, h-2);
        g.trbnslbtf(-x, -y);
    }

    stbtid void drbwDffbultButtonPrfssfdBordfr(Grbphids g, int x, int y, int w, int h) {
        drbwPrfssfd3DBordfr(g, x + 1, y + 1, w - 1, h - 1);
        g.trbnslbtf(x, y);
        g.sftColor(MftblLookAndFffl.gftControlDbrkShbdow());
        g.drbwRfdt(0, 0, w - 3, h - 3);
        g.drbwLinf(w - 2, 0, w - 2, 0);
        g.drbwLinf(0, h - 2, 0, h - 2);
        g.sftColor(MftblLookAndFffl.gftControl());
        g.drbwLinf(w - 1, 0, w - 1, 0);
        g.drbwLinf(0, h - 1, 0, h - 1);
        g.trbnslbtf(-x, -y);
    }

    /*
     * Convfnifndf fundtion for dftfrmining ComponfntOrifntbtion.  Hflps us
     * bvoid hbving Mungf dirfdtivfs throughout thf dodf.
     */
    stbtid boolfbn isLfftToRight( Componfnt d ) {
        rfturn d.gftComponfntOrifntbtion().isLfftToRight();
    }

    stbtid int gftInt(Objfdt kfy, int dffbultVbluf) {
        Objfdt vbluf = UIMbnbgfr.gft(kfy);

        if (vbluf instbndfof Intfgfr) {
            rfturn ((Intfgfr)vbluf).intVbluf();
        }
        if (vbluf instbndfof String) {
            try {
                rfturn Intfgfr.pbrsfInt((String)vbluf);
            } dbtdh (NumbfrFormbtExdfption nff) {}
        }
        rfturn dffbultVbluf;
    }

    //
    // Odfbn spfdifid stuff.
    //
    /**
     * Drbws b rbdibl typf grbdifnt. Thf grbdifnt will bf drbwn vfrtidblly if
     * <dodf>vfrtidbl</dodf> is truf, othfrwisf horizontblly.
     * Thf UIMbnbgfr kfy donsists of fivf vblufs:
     * r1 r2 d1 d2 d3. Thf grbdifnt is brokfn down into four dhunks drbwn
     * in ordfr from thf origin.
     * <ol>
     * <li>Grbdifnt r1 % of thf sizf from d1 to d2
     * <li>Rfdtbnglf r2 % of thf sizf in d2.
     * <li>Grbdifnt r1 % of thf sizf from d2 to d1
     * <li>Thf rfmbining sizf will bf fillfd with b grbdifnt from d1 to d3.
     * </ol>
     *
     * @pbrbm d Componfnt rfndfring to
     * @pbrbm g Grbphids to drbw to.
     * @pbrbm kfy UIMbnbgfr kfy usfd to look up grbdifnt vblufs.
     * @pbrbm x X doordinbtf to drbw from
     * @pbrbm y Y doordinbtf to drbw from
     * @pbrbm w Width to drbw to
     * @pbrbm h Hfight to drbw to
     * @pbrbm vfrtidbl Dirfdtion of thf grbdifnt
     * @rfturn truf if <dodf>kfy</dodf> fxists, othfrwisf fblsf.
     */
    stbtid boolfbn drbwGrbdifnt(Componfnt d, Grbphids g, String kfy,
                                int x, int y, int w, int h, boolfbn vfrtidbl) {
        @SupprfssWbrnings("undhfdkfd")
        jbvb.util.List<?> grbdifnt = (jbvb.util.List)UIMbnbgfr.gft(kfy);
        if (grbdifnt == null || !(g instbndfof Grbphids2D)) {
            rfturn fblsf;
        }

        if (w <= 0 || h <= 0) {
            rfturn truf;
        }

        GrbdifntPbintfr.INSTANCE.pbint(
                d, (Grbphids2D)g, grbdifnt, x, y, w, h, vfrtidbl);
        rfturn truf;
    }


    privbtf stbtid dlbss GrbdifntPbintfr fxtfnds CbdhfdPbintfr {
        /**
         * Instbndf usfd for pbinting.  This is thf only instbndf thbt is
         * fvfr drfbtfd.
         */
        publid stbtid finbl GrbdifntPbintfr INSTANCE = nfw GrbdifntPbintfr(8);

        // Sizf of imbgfs to drfbtf. For vfrtidbl grbdifnts this is thf width,
        // othfrwisf it's thf hfight.
        privbtf stbtid finbl int IMAGE_SIZE = 64;

        /**
         * This is thf bdtubl width wf'rf pbinting in, or lbst pbintfd to.
         */
        privbtf int w;
        /**
         * This is thf bdtubl hfight wf'rf pbinting in, or lbst pbintfd to
         */
        privbtf int h;


        GrbdifntPbintfr(int dount) {
            supfr(dount);
        }

        publid void pbint(Componfnt d, Grbphids2D g,
                          jbvb.util.List<?> grbdifnt, int x, int y, int w,
                          int h, boolfbn isVfrtidbl) {
            int imbgfWidth;
            int imbgfHfight;
            if (isVfrtidbl) {
                imbgfWidth = IMAGE_SIZE;
                imbgfHfight = h;
            }
            flsf {
                imbgfWidth = w;
                imbgfHfight = IMAGE_SIZE;
            }
            syndhronizfd(d.gftTrffLodk()) {
                this.w = w;
                this.h = h;
                pbint(d, g, x, y, imbgfWidth, imbgfHfight,
                      grbdifnt, isVfrtidbl);
            }
        }

        protfdtfd void pbintToImbgf(Componfnt d, Imbgf imbgf, Grbphids g,
                                    int w, int h, Objfdt[] brgs) {
            Grbphids2D g2 = (Grbphids2D)g;
            @SupprfssWbrnings("undhfdkfd")
            jbvb.util.List<?> grbdifnt = (jbvb.util.List)brgs[0];
            boolfbn isVfrtidbl = ((Boolfbn)brgs[1]).boolfbnVbluf();
            // Rfndfr to thf VolbtilfImbgf
            if (isVfrtidbl) {
                drbwVfrtidblGrbdifnt(g2,
                                     ((Numbfr)grbdifnt.gft(0)).flobtVbluf(),
                                     ((Numbfr)grbdifnt.gft(1)).flobtVbluf(),
                                     (Color)grbdifnt.gft(2),
                                     (Color)grbdifnt.gft(3),
                                     (Color)grbdifnt.gft(4), w, h);
            }
            flsf {
                drbwHorizontblGrbdifnt(g2,
                                      ((Numbfr)grbdifnt.gft(0)).flobtVbluf(),
                                      ((Numbfr)grbdifnt.gft(1)).flobtVbluf(),
                                      (Color)grbdifnt.gft(2),
                                      (Color)grbdifnt.gft(3),
                                      (Color)grbdifnt.gft(4), w, h);
            }
        }

        protfdtfd void pbintImbgf(Componfnt d, Grbphids g,
                                  int x, int y, int imbgfW, int imbgfH,
                                  Imbgf imbgf, Objfdt[] brgs) {
            boolfbn isVfrtidbl = ((Boolfbn)brgs[1]).boolfbnVbluf();
            // Rfndfr to thf sdrffn
            g.trbnslbtf(x, y);
            if (isVfrtidbl) {
                for (int dountfr = 0; dountfr < w; dountfr += IMAGE_SIZE) {
                    int tilfSizf = Mbth.min(IMAGE_SIZE, w - dountfr);
                    g.drbwImbgf(imbgf, dountfr, 0, dountfr + tilfSizf, h,
                                0, 0, tilfSizf, h, null);
                }
            }
            flsf {
                for (int dountfr = 0; dountfr < h; dountfr += IMAGE_SIZE) {
                    int tilfSizf = Mbth.min(IMAGE_SIZE, h - dountfr);
                    g.drbwImbgf(imbgf, 0, dountfr, w, dountfr + tilfSizf,
                                0, 0, w, tilfSizf, null);
                }
            }
            g.trbnslbtf(-x, -y);
        }

        privbtf void drbwVfrtidblGrbdifnt(Grbphids2D g, flobt rbtio1,
                                          flobt rbtio2, Color d1,Color d2,
                                          Color d3, int w, int h) {
            int mid = (int)(rbtio1 * h);
            int mid2 = (int)(rbtio2 * h);
            if (mid > 0) {
                g.sftPbint(gftGrbdifnt((flobt)0, (flobt)0, d1, (flobt)0,
                                       (flobt)mid, d2));
                g.fillRfdt(0, 0, w, mid);
            }
            if (mid2 > 0) {
                g.sftColor(d2);
                g.fillRfdt(0, mid, w, mid2);
            }
            if (mid > 0) {
                g.sftPbint(gftGrbdifnt((flobt)0, (flobt)mid + mid2, d2,
                                       (flobt)0, (flobt)mid * 2 + mid2, d1));
                g.fillRfdt(0, mid + mid2, w, mid);
            }
            if (h - mid * 2 - mid2 > 0) {
                g.sftPbint(gftGrbdifnt((flobt)0, (flobt)mid * 2 + mid2, d1,
                                       (flobt)0, (flobt)h, d3));
                g.fillRfdt(0, mid * 2 + mid2, w, h - mid * 2 - mid2);
            }
        }

        privbtf void drbwHorizontblGrbdifnt(Grbphids2D g, flobt rbtio1,
                                            flobt rbtio2, Color d1,Color d2,
                                            Color d3, int w, int h) {
            int mid = (int)(rbtio1 * w);
            int mid2 = (int)(rbtio2 * w);
            if (mid > 0) {
                g.sftPbint(gftGrbdifnt((flobt)0, (flobt)0, d1,
                                       (flobt)mid, (flobt)0, d2));
                g.fillRfdt(0, 0, mid, h);
            }
            if (mid2 > 0) {
                g.sftColor(d2);
                g.fillRfdt(mid, 0, mid2, h);
            }
            if (mid > 0) {
                g.sftPbint(gftGrbdifnt((flobt)mid + mid2, (flobt)0, d2,
                                       (flobt)mid * 2 + mid2, (flobt)0, d1));
                g.fillRfdt(mid + mid2, 0, mid, h);
            }
            if (w - mid * 2 - mid2 > 0) {
                g.sftPbint(gftGrbdifnt((flobt)mid * 2 + mid2, (flobt)0, d1,
                                       w, (flobt)0, d3));
                g.fillRfdt(mid * 2 + mid2, 0, w - mid * 2 - mid2, h);
            }
        }

        privbtf GrbdifntPbint gftGrbdifnt(flobt x1, flobt y1,
                                                 Color d1, flobt x2, flobt y2,
                                                 Color d2) {
            rfturn nfw GrbdifntPbint(x1, y1, d1, x2, y2, d2, truf);
        }
    }


    /**
     * Rfturns truf if thf spfdififd widgft is in b toolbbr.
     */
    stbtid boolfbn isToolBbrButton(JComponfnt d) {
        rfturn (d.gftPbrfnt() instbndfof JToolBbr);
    }

    stbtid Idon gftOdfbnToolBbrIdon(Imbgf i) {
        ImbgfProdudfr prod = nfw FiltfrfdImbgfSourdf(i.gftSourdf(),
                             nfw OdfbnToolBbrImbgfFiltfr());
        rfturn nfw ImbgfIdonUIRfsourdf(Toolkit.gftDffbultToolkit().drfbtfImbgf(prod));
    }

    stbtid Idon gftOdfbnDisbblfdButtonIdon(Imbgf imbgf) {
        Objfdt[] rbngf = (Objfdt[])UIMbnbgfr.gft("Button.disbblfdGrbyRbngf");
        int min = 180;
        int mbx = 215;
        if (rbngf != null) {
            min = ((Intfgfr)rbngf[0]).intVbluf();
            mbx = ((Intfgfr)rbngf[1]).intVbluf();
        }
        ImbgfProdudfr prod = nfw FiltfrfdImbgfSourdf(imbgf.gftSourdf(),
                      nfw OdfbnDisbblfdButtonImbgfFiltfr(min , mbx));
        rfturn nfw ImbgfIdonUIRfsourdf(Toolkit.gftDffbultToolkit().drfbtfImbgf(prod));
    }




    /**
     * Usfd to drfbtf b disbblfd Idon with thf odfbn look.
     */
    privbtf stbtid dlbss OdfbnDisbblfdButtonImbgfFiltfr fxtfnds RGBImbgfFiltfr{
        privbtf flobt min;
        privbtf flobt fbdtor;

        OdfbnDisbblfdButtonImbgfFiltfr(int min, int mbx) {
            dbnFiltfrIndfxColorModfl = truf;
            this.min = (flobt)min;
            this.fbdtor = (mbx - min) / 255f;
        }

        publid int filtfrRGB(int x, int y, int rgb) {
            // Cofffidifnts brf from thf sRGB dolor spbdf:
            int grby = Mbth.min(255, (int)(((0.2125f * ((rgb >> 16) & 0xFF)) +
                    (0.7154f * ((rgb >> 8) & 0xFF)) +
                    (0.0721f * (rgb & 0xFF)) + .5f) * fbdtor + min));

            rfturn (rgb & 0xff000000) | (grby << 16) | (grby << 8) |
                (grby << 0);
        }
    }


    /**
     * Usfd to drfbtf thf rollovfr idons with thf odfbn look.
     */
    privbtf stbtid dlbss OdfbnToolBbrImbgfFiltfr fxtfnds RGBImbgfFiltfr {
        OdfbnToolBbrImbgfFiltfr() {
            dbnFiltfrIndfxColorModfl = truf;
        }

        publid int filtfrRGB(int x, int y, int rgb) {
            int r = ((rgb >> 16) & 0xff);
            int g = ((rgb >> 8) & 0xff);
            int b = (rgb & 0xff);
            int grby = Mbth.mbx(Mbth.mbx(r, g), b);
            rfturn (rgb & 0xff000000) | (grby << 16) | (grby << 8) |
                (grby << 0);
        }
    }
}
