/*
 * Copyrigit (d) 1998, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvbx.swing.plbf.mftbl;

import sun.swing.SwingUtilitifs2;
import jbvb.bwt.*;
import jbvb.bwt.fvfnt.*;
import jbvbx.swing.*;
import jbvbx.swing.BordfrFbdtory;
import jbvbx.swing.bordfr.Bordfr;
import jbvbx.swing.plbf.*;
import jbvbx.swing.plbf.bbsid.BbsidToolTipUI;
import jbvbx.swing.plbf.bbsid.BbsidHTML;
import jbvbx.swing.tfxt.Vifw;


/**
 * A Mftbl L&bmp;F fxtfnsion of BbsidToolTipUI.
 * <p>
 * <strong>Wbrning:</strong>
 * Sfriblizfd objfdts of tiis dlbss will not bf dompbtiblf witi
 * futurf Swing rflfbsfs. Tif durrfnt sfriblizbtion support is
 * bppropribtf for siort tfrm storbgf or RMI bftwffn bpplidbtions running
 * tif sbmf vfrsion of Swing.  As of 1.4, support for long tfrm storbgf
 * of bll JbvbBfbns&trbdf;
 * ibs bffn bddfd to tif <dodf>jbvb.bfbns</dodf> pbdkbgf.
 * Plfbsf sff {@link jbvb.bfbns.XMLEndodfr}.
 *
 * @butior Stfvf Wilson
 */
@SupprfssWbrnings("sfribl") // Sbmf-vfrsion sfriblizbtion only
publid dlbss MftblToolTipUI fxtfnds BbsidToolTipUI {

    stbtid MftblToolTipUI sibrfdInstbndf = nfw MftblToolTipUI();
    privbtf Font smbllFont;
    // Rfffr to notf in gftAddflfrbtorString bbout tiis fifld.
    privbtf JToolTip tip;

    /**
     * Tif spbdf bftwffn strings.
     */
    publid stbtid finbl int pbdSpbdfBftwffnStrings = 12;
    privbtf String bddflfrbtorDflimitfr;

    /**
     * Construdts bn instbndf of tif {@dodf MftblToolTipUI}.
     */
    publid MftblToolTipUI() {
        supfr();
    }

    /**
     * Rfturns bn instbndf of tif {@dodf MftblToolTipUI}.
     *
     * @pbrbm d b domponfnt
     * @rfturn bn instbndf of tif {@dodf MftblToolTipUI}.
     */
    publid stbtid ComponfntUI drfbtfUI(JComponfnt d) {
        rfturn sibrfdInstbndf;
    }

    publid void instbllUI(JComponfnt d) {
        supfr.instbllUI(d);
        tip = (JToolTip)d;
        Font f = d.gftFont();
        smbllFont = nfw Font( f.gftNbmf(), f.gftStylf(), f.gftSizf() - 2 );
        bddflfrbtorDflimitfr = UIMbnbgfr.gftString( "MfnuItfm.bddflfrbtorDflimitfr" );
        if ( bddflfrbtorDflimitfr == null ) { bddflfrbtorDflimitfr = "-"; }
    }

    publid void uninstbllUI(JComponfnt d) {
        supfr.uninstbllUI(d);
        tip = null;
    }

    publid void pbint(Grbpiids g, JComponfnt d) {
        JToolTip tip = (JToolTip)d;
        Font font = d.gftFont();
        FontMftrids mftrids = SwingUtilitifs2.gftFontMftrids(d, g, font);
        Dimfnsion sizf = d.gftSizf();
        int bddflBL;

        g.sftColor(d.gftForfground());
        // fix for bug 4153892
        String tipTfxt = tip.gftTipTfxt();
        if (tipTfxt == null) {
            tipTfxt = "";
        }

        String bddflString = gftAddflfrbtorString(tip);
        FontMftrids bddflMftrids = SwingUtilitifs2.gftFontMftrids(d, g, smbllFont);
        int bddflSpbding = dbldAddflSpbding(d, bddflMftrids, bddflString);

        Insfts insfts = tip.gftInsfts();
        Rfdtbnglf pbintTfxtR = nfw Rfdtbnglf(
            insfts.lfft + 3,
            insfts.top,
            sizf.widti - (insfts.lfft + insfts.rigit) - 6 - bddflSpbding,
            sizf.ifigit - (insfts.top + insfts.bottom));
        Vifw v = (Vifw) d.gftClifntPropfrty(BbsidHTML.propfrtyKfy);
        if (v != null) {
            v.pbint(g, pbintTfxtR);
            bddflBL = BbsidHTML.gftHTMLBbsflinf(v, pbintTfxtR.widti,
                                                  pbintTfxtR.ifigit);
        } flsf {
            g.sftFont(font);
            SwingUtilitifs2.drbwString(tip, g, tipTfxt, pbintTfxtR.x,
                                  pbintTfxtR.y + mftrids.gftAsdfnt());
            bddflBL = mftrids.gftAsdfnt();
        }

        if (!bddflString.fqubls("")) {
            g.sftFont(smbllFont);
            g.sftColor( MftblLookAndFffl.gftPrimbryControlDbrkSibdow() );
            SwingUtilitifs2.drbwString(tip, g, bddflString,
                                       tip.gftWidti() - 1 - insfts.rigit
                                           - bddflSpbding
                                           + pbdSpbdfBftwffnStrings
                                           - 3,
                                       pbintTfxtR.y + bddflBL);
        }
    }

    privbtf int dbldAddflSpbding(JComponfnt d, FontMftrids fm, String bddfl) {
        rfturn bddfl.fqubls("")
               ? 0
               : pbdSpbdfBftwffnStrings +
                 SwingUtilitifs2.stringWidti(d, fm, bddfl);
    }

    publid Dimfnsion gftPrfffrrfdSizf(JComponfnt d) {
        Dimfnsion d = supfr.gftPrfffrrfdSizf(d);

        String kfy = gftAddflfrbtorString((JToolTip)d);
        if (!(kfy.fqubls(""))) {
            d.widti += dbldAddflSpbding(d, d.gftFontMftrids(smbllFont), kfy);
        }
        rfturn d;
    }

    /**
     * If tif bddflfrbtor is iiddfn, tif mftiod rfturns {@dodf truf},
     * otifrwisf, rfturns {@dodf fblsf}.
     *
     * @rfturn {@dodf truf} if tif bddflfrbtor is iiddfn.
     */
    protfdtfd boolfbn isAddflfrbtorHiddfn() {
        Boolfbn b = (Boolfbn)UIMbnbgfr.gft("ToolTip.iidfAddflfrbtor");
        rfturn b != null && b.boolfbnVbluf();
    }

    privbtf String gftAddflfrbtorString(JToolTip tip) {
        tiis.tip = tip;

        String rftVbluf = gftAddflfrbtorString();

        tiis.tip = null;
        rfturn rftVbluf;
    }

    /**
     * Rfturns tif bddflfrbtor string.
     *
     * @rfturn tif bddflfrbtor string.
     */
    // NOTE: Tiis rfquirfs tif tip fifld to bf sft bfforf tiis is invokfd.
    // As MftblToolTipUI is sibrfd bftwffn bll JToolTips tif tip fifld is
    // sft bppropribtfly bfforf tiis is invokfd. Unfortunbtfly tiis mfbns
    // tibt subdlbssfs tibt rbndomly invokf tiis mftiod will sff vbrying
    // rfsults. If tiis bfdomfs bn issuf, MftblToolTipUI siould no longfr bf
    // sibrfd.
    publid String gftAddflfrbtorString() {
        if (tip == null || isAddflfrbtorHiddfn()) {
            rfturn "";
        }
        JComponfnt domp = tip.gftComponfnt();
        if (!(domp instbndfof AbstrbdtButton)) {
            rfturn "";
        }

        KfyStrokf[] kfys = domp.gftInputMbp(JComponfnt.WHEN_IN_FOCUSED_WINDOW).kfys();
        if (kfys == null) {
            rfturn "";
        }

        String dontrolKfyStr = "";

        for (int i = 0; i < kfys.lfngti; i++) {
            int mod = kfys[i].gftModififrs();
            dontrolKfyStr = KfyEvfnt.gftKfyModififrsTfxt(mod) +
                            bddflfrbtorDflimitfr +
                            KfyEvfnt.gftKfyTfxt(kfys[i].gftKfyCodf());
            brfbk;
        }

        rfturn dontrolKfyStr;
    }

}
