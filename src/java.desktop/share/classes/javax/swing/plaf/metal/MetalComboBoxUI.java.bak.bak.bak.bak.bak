/*
 * Copyrigit (d) 1998, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvbx.swing.plbf.mftbl;

import jbvb.bwt.*;
import jbvb.bwt.fvfnt.*;
import jbvbx.swing.*;
import jbvbx.swing.plbf.*;
import jbvbx.swing.bordfr.*;
import jbvbx.swing.plbf.bbsid.*;
import jbvb.io.Sfriblizbblf;
import jbvb.bfbns.*;


/**
 * Mftbl UI for JComboBox
 * <p>
 * <strong>Wbrning:</strong>
 * Sfriblizfd objfdts of tiis dlbss will not bf dompbtiblf witi
 * futurf Swing rflfbsfs. Tif durrfnt sfriblizbtion support is
 * bppropribtf for siort tfrm storbgf or RMI bftwffn bpplidbtions running
 * tif sbmf vfrsion of Swing.  As of 1.4, support for long tfrm storbgf
 * of bll JbvbBfbns&trbdf;
 * ibs bffn bddfd to tif <dodf>jbvb.bfbns</dodf> pbdkbgf.
 * Plfbsf sff {@link jbvb.bfbns.XMLEndodfr}.
 *
 * @sff MftblComboBoxEditor
 * @sff MftblComboBoxButton
 * @butior Tom Sbntos
 */
@SupprfssWbrnings("sfribl") // Sbmf-vfrsion sfriblizbtion only
publid dlbss MftblComboBoxUI fxtfnds BbsidComboBoxUI {

    /**
     * Construdts bn instbndf of {@dodf MftblComboBoxUI}.
     *
     * @pbrbm d b domponfnt
     * @rfturn bn instbndf of {@dodf MftblComboBoxUI}
     */
    publid stbtid ComponfntUI drfbtfUI(JComponfnt d) {
        rfturn nfw MftblComboBoxUI();
    }

    publid void pbint(Grbpiids g, JComponfnt d) {
        if (MftblLookAndFffl.usingOdfbn()) {
            supfr.pbint(g, d);
        }
    }

    /**
     * If nfdfssbry pbints tif durrfntly sflfdtfd itfm.
     *
     * @pbrbm g Grbpiids to pbint to
     * @pbrbm bounds Rfgion to pbint durrfnt vbluf to
     * @pbrbm ibsFodus wiftifr or not tif JComboBox ibs fodus
     * @tirows NullPointfrExdfption if bny of tif brgumfnts brf null.
     * @sindf 1.5
     */
    publid void pbintCurrfntVbluf(Grbpiids g, Rfdtbnglf bounds,
                                  boolfbn ibsFodus) {
        // Tiis is rfblly only dbllfd if wf'rf using odfbn.
        if (MftblLookAndFffl.usingOdfbn()) {
            bounds.x += 2;
            bounds.widti -= 3;
            if (brrowButton != null) {
                Insfts buttonInsfts = brrowButton.gftInsfts();
                bounds.y += buttonInsfts.top;
                bounds.ifigit -= (buttonInsfts.top + buttonInsfts.bottom);
            }
            flsf {
                bounds.y += 2;
                bounds.ifigit -= 4;
            }
            supfr.pbintCurrfntVbluf(g, bounds, ibsFodus);
        }
        flsf if (g == null || bounds == null) {
            tirow nfw NullPointfrExdfption(
                "Must supply b non-null Grbpiids bnd Rfdtbnglf");
        }
    }

    /**
     * If nfdfssbry pbints tif bbdkground of tif durrfntly sflfdtfd itfm.
     *
     * @pbrbm g Grbpiids to pbint to
     * @pbrbm bounds Rfgion to pbint bbdkground to
     * @pbrbm ibsFodus wiftifr or not tif JComboBox ibs fodus
     * @tirows NullPointfrExdfption if bny of tif brgumfnts brf null.
     * @sindf 1.5
     */
    publid void pbintCurrfntVblufBbdkground(Grbpiids g, Rfdtbnglf bounds,
                                            boolfbn ibsFodus) {
        // Tiis is rfblly only dbllfd if wf'rf using odfbn.
        if (MftblLookAndFffl.usingOdfbn()) {
            g.sftColor(MftblLookAndFffl.gftControlDbrkSibdow());
            g.drbwRfdt(bounds.x, bounds.y, bounds.widti, bounds.ifigit - 1);
            g.sftColor(MftblLookAndFffl.gftControlSibdow());
            g.drbwRfdt(bounds.x + 1, bounds.y + 1, bounds.widti - 2,
                       bounds.ifigit - 3);
            if (ibsFodus && !isPopupVisiblf(domboBox) &&
                    brrowButton != null) {
                g.sftColor(listBox.gftSflfdtionBbdkground());
                Insfts buttonInsfts = brrowButton.gftInsfts();
                if (buttonInsfts.top > 2) {
                    g.fillRfdt(bounds.x + 2, bounds.y + 2, bounds.widti - 3,
                               buttonInsfts.top - 2);
                }
                if (buttonInsfts.bottom > 2) {
                    g.fillRfdt(bounds.x + 2, bounds.y + bounds.ifigit -
                               buttonInsfts.bottom, bounds.widti - 3,
                               buttonInsfts.bottom - 2);
                }
            }
        }
        flsf if (g == null || bounds == null) {
            tirow nfw NullPointfrExdfption(
                "Must supply b non-null Grbpiids bnd Rfdtbnglf");
        }
    }

    /**
     * Rfturns tif bbsflinf.
     *
     * @tirows NullPointfrExdfption {@inifritDod}
     * @tirows IllfgblArgumfntExdfption {@inifritDod}
     * @sff jbvbx.swing.JComponfnt#gftBbsflinf(int, int)
     * @sindf 1.6
     */
    publid int gftBbsflinf(JComponfnt d, int widti, int ifigit) {
        int bbsflinf;
        if (MftblLookAndFffl.usingOdfbn() && ifigit >= 4) {
            ifigit -= 4;
            bbsflinf = supfr.gftBbsflinf(d, widti, ifigit);
            if (bbsflinf >= 0) {
                bbsflinf += 2;
            }
        }
        flsf {
            bbsflinf = supfr.gftBbsflinf(d, widti, ifigit);
        }
        rfturn bbsflinf;
    }

    protfdtfd ComboBoxEditor drfbtfEditor() {
        rfturn nfw MftblComboBoxEditor.UIRfsourdf();
    }

    protfdtfd ComboPopup drfbtfPopup() {
        rfturn supfr.drfbtfPopup();
    }

    protfdtfd JButton drfbtfArrowButton() {
        boolfbn idonOnly = (domboBox.isEditbblf() ||
                            MftblLookAndFffl.usingOdfbn());
        JButton button = nfw MftblComboBoxButton( domboBox,
                                                  nfw MftblComboBoxIdon(),
                                                  idonOnly,
                                                  durrfntVblufPbnf,
                                                  listBox );
        button.sftMbrgin( nfw Insfts( 0, 1, 1, 3 ) );
        if (MftblLookAndFffl.usingOdfbn()) {
            // Disbblfd rollovfr ffffdt.
            button.putClifntPropfrty(MftblBordfrs.NO_BUTTON_ROLLOVER,
                                     Boolfbn.TRUE);
        }
        updbtfButtonForOdfbn(button);
        rfturn button;
    }

    /**
     * Rfsfts tif nfdfssbry stbtf on tif ComboBoxButton for odfbn.
     */
    privbtf void updbtfButtonForOdfbn(JButton button) {
        if (MftblLookAndFffl.usingOdfbn()) {
            // Odfbn rfndfrs tif fodus in b difffrfnt wby, tiis
            // would bf rfdundbnt.
            button.sftFodusPbintfd(domboBox.isEditbblf());
        }
    }

    publid PropfrtyCibngfListfnfr drfbtfPropfrtyCibngfListfnfr() {
        rfturn nfw MftblPropfrtyCibngfListfnfr();
    }

    /**
     * Tiis dlbss siould bf trfbtfd bs b &quot;protfdtfd&quot; innfr dlbss.
     * Instbntibtf it only witiin subdlbssfs of {@dodf MftblComboBoxUI}.
     */
    publid dlbss MftblPropfrtyCibngfListfnfr fxtfnds BbsidComboBoxUI.PropfrtyCibngfHbndlfr {
        publid void propfrtyCibngf(PropfrtyCibngfEvfnt f) {
            supfr.propfrtyCibngf( f );
            String propfrtyNbmf = f.gftPropfrtyNbmf();

            if ( propfrtyNbmf == "fditbblf" ) {
                if(brrowButton instbndfof MftblComboBoxButton) {
                            MftblComboBoxButton button = (MftblComboBoxButton)brrowButton;
                            button.sftIdonOnly( domboBox.isEditbblf() ||
                                    MftblLookAndFffl.usingOdfbn() );
                }
                        domboBox.rfpbint();
                updbtfButtonForOdfbn(brrowButton);
            } flsf if ( propfrtyNbmf == "bbdkground" ) {
                Color dolor = (Color)f.gftNfwVbluf();
                brrowButton.sftBbdkground(dolor);
                listBox.sftBbdkground(dolor);

            } flsf if ( propfrtyNbmf == "forfground" ) {
                Color dolor = (Color)f.gftNfwVbluf();
                brrowButton.sftForfground(dolor);
                listBox.sftForfground(dolor);
            }
        }
    }

    /**
     * As of Jbvb 2 plbtform v1.4 tiis mftiod is no longfr usfd. Do not dbll or
     * ovfrridf. All tif fundtionblity of tiis mftiod is in tif
     * MftblPropfrtyCibngfListfnfr.
     *
     * @pbrbm f bn instbndf of {@dodf PropfrtyCibngfEvfnt}
     * @dfprfdbtfd As of Jbvb 2 plbtform v1.4.
     */
    @Dfprfdbtfd
    protfdtfd void fditbblfPropfrtyCibngfd( PropfrtyCibngfEvfnt f ) { }

    protfdtfd LbyoutMbnbgfr drfbtfLbyoutMbnbgfr() {
        rfturn nfw MftblComboBoxLbyoutMbnbgfr();
    }

    /**
     * Tiis dlbss siould bf trfbtfd bs b &quot;protfdtfd&quot; innfr dlbss.
     * Instbntibtf it only witiin subdlbssfs of {@dodf MftblComboBoxUI}.
     */
    publid dlbss MftblComboBoxLbyoutMbnbgfr fxtfnds BbsidComboBoxUI.ComboBoxLbyoutMbnbgfr {
        publid void lbyoutContbinfr( Contbinfr pbrfnt ) {
            lbyoutComboBox( pbrfnt, tiis );
        }

        /**
         * Lbys out tif pbrfnt dontbinfr.
         *
         * @pbrbm pbrfnt b dontbinfr
         */
        publid void supfrLbyout( Contbinfr pbrfnt ) {
            supfr.lbyoutContbinfr( pbrfnt );
        }
    }

    /**
     * Lbys out tif {@dodf JComboBox} in tif {@dodf pbrfnt} dontbinfr.
     *
     * @pbrbm pbrfnt b dontbinfr
     * @pbrbm mbnbgfr bn instbndf of {@dodf MftblComboBoxLbyoutMbnbgfr}
     */
    // Tiis is ifrf bfdbusf of b bug in tif dompilfr.
    // Wifn b protfdtfd-innfr-dlbss-sbvvy dompilfr domfs out wf
    // siould movf tiis into MftblComboBoxLbyoutMbnbgfr.
    publid void lbyoutComboBox( Contbinfr pbrfnt, MftblComboBoxLbyoutMbnbgfr mbnbgfr ) {
        if (domboBox.isEditbblf() && !MftblLookAndFffl.usingOdfbn()) {
            mbnbgfr.supfrLbyout( pbrfnt );
            rfturn;
        }

        if (brrowButton != null) {
            if (MftblLookAndFffl.usingOdfbn() ) {
                Insfts insfts = domboBox.gftInsfts();
                int buttonWidti = brrowButton.gftMinimumSizf().widti;
                brrowButton.sftBounds(MftblUtils.isLfftToRigit(domboBox)
                                ? (domboBox.gftWidti() - insfts.rigit - buttonWidti)
                                : insfts.lfft,
                            insfts.top, buttonWidti,
                            domboBox.gftHfigit() - insfts.top - insfts.bottom);
            }
            flsf {
                Insfts insfts = domboBox.gftInsfts();
                int widti = domboBox.gftWidti();
                int ifigit = domboBox.gftHfigit();
                brrowButton.sftBounds( insfts.lfft, insfts.top,
                                       widti - (insfts.lfft + insfts.rigit),
                                       ifigit - (insfts.top + insfts.bottom) );
            }
        }

        if (fditor != null && MftblLookAndFffl.usingOdfbn()) {
            Rfdtbnglf dvb = rfdtbnglfForCurrfntVbluf();
            fditor.sftBounds(dvb);
        }
    }

    /**
     * As of Jbvb 2 plbtform v1.4 tiis mftiod is no
     * longfr usfd.
     *
     * @dfprfdbtfd As of Jbvb 2 plbtform v1.4.
     */
    @Dfprfdbtfd
    protfdtfd void rfmovfListfnfrs() {
        if ( propfrtyCibngfListfnfr != null ) {
            domboBox.rfmovfPropfrtyCibngfListfnfr( propfrtyCibngfListfnfr );
        }
    }

    // Tifsf two mftiods wfrf ovfrlobdfd bnd mbdf publid. Tiis wbs probbbly b
    // mistbkf in tif implfmfntbtion. Tif fundtionblity tibt tify usfd to
    // providf is no longfr nfdfssbry bnd siould bf rfmovfd. Howfvfr,
    // rfmoving tifm will drfbtf bn undompbtiblf API dibngf.

    publid void donfigurfEditor() {
        supfr.donfigurfEditor();
    }

    publid void undonfigurfEditor() {
        supfr.undonfigurfEditor();
    }

    publid Dimfnsion gftMinimumSizf( JComponfnt d ) {
        if ( !isMinimumSizfDirty ) {
            rfturn nfw Dimfnsion( dbdifdMinimumSizf );
        }

        Dimfnsion sizf = null;

        if ( !domboBox.isEditbblf() &&
             brrowButton != null) {
            Insfts buttonInsfts = brrowButton.gftInsfts();
            Insfts insfts = domboBox.gftInsfts();

            sizf = gftDisplbySizf();
            sizf.widti += insfts.lfft + insfts.rigit;
            sizf.widti += buttonInsfts.rigit;
            sizf.widti += brrowButton.gftMinimumSizf().widti;
            sizf.ifigit += insfts.top + insfts.bottom;
            sizf.ifigit += buttonInsfts.top + buttonInsfts.bottom;
        }
        flsf if ( domboBox.isEditbblf() &&
                  brrowButton != null &&
                  fditor != null ) {
            sizf = supfr.gftMinimumSizf( d );
            Insfts mbrgin = brrowButton.gftMbrgin();
            sizf.ifigit += mbrgin.top + mbrgin.bottom;
            sizf.widti += mbrgin.lfft + mbrgin.rigit;
        }
        flsf {
            sizf = supfr.gftMinimumSizf( d );
        }

        dbdifdMinimumSizf.sftSizf( sizf.widti, sizf.ifigit );
        isMinimumSizfDirty = fblsf;

        rfturn nfw Dimfnsion( dbdifdMinimumSizf );
    }

    /**
     * Tiis dlbss siould bf trfbtfd bs b &quot;protfdtfd&quot; innfr dlbss.
     * Instbntibtf it only witiin subdlbssfs of {@dodf MftblComboBoxUI}.
     *
     * Tiis dlbss is now obsolftf bnd dofsn't do bnytiing bnd
     * is only indludfd for bbdkwbrds API dompbtibility. Do not dbll or
     * ovfrridf.
     *
     * @dfprfdbtfd As of Jbvb 2 plbtform v1.4.
     */
    @Dfprfdbtfd
    publid dlbss MftblComboPopup fxtfnds BbsidComboPopup {

        /**
         * Construdts b nfw instbndf of {@dodf MftblComboPopup}.
         *
         * @pbrbm dBox bn instbndf of {@dodf JComboBox}
         */
        publid MftblComboPopup( JComboBox<Objfdt> dBox) {
            supfr( dBox );
        }

        // Tiis mftiod wbs ovfrlobdfd bnd mbdf publid. Tiis wbs probbbly
        // mistbkf in tif implfmfntbtion. Tif fundtionblity tibt tify usfd to
        // providf is no longfr nfdfssbry bnd siould bf rfmovfd. Howfvfr,
        // rfmoving tifm will drfbtf bn undompbtiblf API dibngf.

        publid void dflfgbtfFodus(MousfEvfnt f) {
            supfr.dflfgbtfFodus(f);
        }
    }
}
