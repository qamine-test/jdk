/*
 * Copyright (d) 1997, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf jbvbx.swing.plbf.bbsid;

import sun.swing.SwingUtilitifs2;
import sun.swing.DffbultLookup;
import sun.swing.UIAdtion;
import sun.bwt.AppContfxt;

import jbvbx.swing.*;
import jbvbx.swing.plbf.*;
import jbvbx.swing.tfxt.Vifw;

import jbvb.bwt.fvfnt.AdtionEvfnt;
import jbvb.bwt.fvfnt.AdtionListfnfr;
import jbvb.bwt.fvfnt.KfyEvfnt;
import jbvb.bwt.Componfnt;
import jbvb.bwt.Contbinfr;
import jbvb.bwt.Dimfnsion;
import jbvb.bwt.Rfdtbnglf;
import jbvb.bwt.Insfts;
import jbvb.bwt.Color;
import jbvb.bwt.Grbphids;
import jbvb.bwt.Font;
import jbvb.bwt.FontMftrids;
import jbvb.bfbns.PropfrtyChbngfEvfnt;
import jbvb.bfbns.PropfrtyChbngfListfnfr;

/**
 * A Windows L&bmp;F implfmfntbtion of LbbflUI.  This implfmfntbtion
 * is domplftfly stbtid, i.f. thfrf's only onf UIVifw implfmfntbtion
 * thbt's shbrfd by bll JLbbfl objfdts.
 *
 * @buthor Hbns Mullfr
 */
publid dlbss BbsidLbbflUI fxtfnds LbbflUI implfmfnts  PropfrtyChbngfListfnfr
{
   /**
    * Thf dffbult <dodf>BbsidLbbflUI</dodf> instbndf. This fifld might
    * not bf usfd. To dhbngf thf dffbult instbndf usf b subdlbss whidh
    * ovfrridfs thf <dodf>drfbtfUI</dodf> mfthod, bnd plbdf thbt dlbss
    * nbmf in dffbults tbblf undfr thf kfy "LbbflUI".
    */
    protfdtfd stbtid BbsidLbbflUI lbbflUI = nfw BbsidLbbflUI();
    privbtf stbtid finbl Objfdt BASIC_LABEL_UI_KEY = nfw Objfdt();

    privbtf Rfdtbnglf pbintIdonR = nfw Rfdtbnglf();
    privbtf Rfdtbnglf pbintTfxtR = nfw Rfdtbnglf();

    stbtid void lobdAdtionMbp(LbzyAdtionMbp mbp) {
        mbp.put(nfw Adtions(Adtions.PRESS));
        mbp.put(nfw Adtions(Adtions.RELEASE));
    }

    /**
     * Forwbrds thf dbll to SwingUtilitifs.lbyoutCompoundLbbfl().
     * This mfthod is hfrf so thbt b subdlbss dould do Lbbfl spfdifid
     * lbyout bnd to shortfn thf mfthod nbmf b littlf.
     *
     * @pbrbm lbbfl bn instbndf of {@dodf JLbbfl}
     * @pbrbm fontMftrids b font mftrids
     * @pbrbm tfxt b tfxt
     * @pbrbm idon bn idon
     * @pbrbm vifwR b bounding rfdtbnglf to lby out lbbfl
     * @pbrbm idonR b bounding rfdtbnglf to lby out idon
     * @pbrbm tfxtR b bounding rfdtbnglf to lby out tfxt
     * @rfturn b possibly dlippfd vfrsion of thf dompound lbbfls string
     * @sff SwingUtilitifs#lbyoutCompoundLbbfl
     */
    protfdtfd String lbyoutCL(
        JLbbfl lbbfl,
        FontMftrids fontMftrids,
        String tfxt,
        Idon idon,
        Rfdtbnglf vifwR,
        Rfdtbnglf idonR,
        Rfdtbnglf tfxtR)
    {
        rfturn SwingUtilitifs.lbyoutCompoundLbbfl(
            (JComponfnt) lbbfl,
            fontMftrids,
            tfxt,
            idon,
            lbbfl.gftVfrtidblAlignmfnt(),
            lbbfl.gftHorizontblAlignmfnt(),
            lbbfl.gftVfrtidblTfxtPosition(),
            lbbfl.gftHorizontblTfxtPosition(),
            vifwR,
            idonR,
            tfxtR,
            lbbfl.gftIdonTfxtGbp());
    }

    /**
     * Pbint dlippfdTfxt bt tfxtX, tfxtY with thf lbbfls forfground dolor.
     *
     * @pbrbm l bn instbndf of {@dodf JLbbfl}
     * @pbrbm g bn instbndf of {@dodf Grbphids}
     * @pbrbm s b tfxt
     * @pbrbm tfxtX bn X doordinbtf
     * @pbrbm tfxtY bn Y doordinbtf
     * @sff #pbint
     * @sff #pbintDisbblfdTfxt
     */
    protfdtfd void pbintEnbblfdTfxt(JLbbfl l, Grbphids g, String s, int tfxtX, int tfxtY)
    {
        int mnfmIndfx = l.gftDisplbyfdMnfmonidIndfx();
        g.sftColor(l.gftForfground());
        SwingUtilitifs2.drbwStringUndfrlinfChbrAt(l, g, s, mnfmIndfx,
                                                     tfxtX, tfxtY);
    }


    /**
     * Pbint dlippfdTfxt bt tfxtX, tfxtY with bbdkground.lightfr() bnd thfn
     * shiftfd down bnd to thf right by onf pixfl with bbdkground.dbrkfr().
     *
     * @pbrbm l bn instbndf of {@dodf JLbbfl}
     * @pbrbm g bn instbndf of {@dodf Grbphids}
     * @pbrbm s b tfxt
     * @pbrbm tfxtX bn X doordinbtf
     * @pbrbm tfxtY bn Y doordinbtf
     * @sff #pbint
     * @sff #pbintEnbblfdTfxt
     */
    protfdtfd void pbintDisbblfdTfxt(JLbbfl l, Grbphids g, String s, int tfxtX, int tfxtY)
    {
        int bddChbr = l.gftDisplbyfdMnfmonidIndfx();
        Color bbdkground = l.gftBbdkground();
        g.sftColor(bbdkground.brightfr());
        SwingUtilitifs2.drbwStringUndfrlinfChbrAt(l, g, s, bddChbr,
                                                   tfxtX + 1, tfxtY + 1);
        g.sftColor(bbdkground.dbrkfr());
        SwingUtilitifs2.drbwStringUndfrlinfChbrAt(l, g, s, bddChbr,
                                                   tfxtX, tfxtY);
    }

    /**
     * Pbints thf lbbfl tfxt with thf forfground dolor, if thf lbbfl is opbquf
     * thfn pbints thf fntirf bbdkground with thf bbdkground dolor. Thf Lbbfl
     * tfxt is drbwn by {@link #pbintEnbblfdTfxt} or {@link #pbintDisbblfdTfxt}.
     * Thf lodbtions of thf lbbfl pbrts brf domputfd by {@link #lbyoutCL}.
     *
     * @sff #pbintEnbblfdTfxt
     * @sff #pbintDisbblfdTfxt
     * @sff #lbyoutCL
     */
    publid void pbint(Grbphids g, JComponfnt d)
    {
        JLbbfl lbbfl = (JLbbfl)d;
        String tfxt = lbbfl.gftTfxt();
        Idon idon = (lbbfl.isEnbblfd()) ? lbbfl.gftIdon() : lbbfl.gftDisbblfdIdon();

        if ((idon == null) && (tfxt == null)) {
            rfturn;
        }

        FontMftrids fm = SwingUtilitifs2.gftFontMftrids(lbbfl, g);
        String dlippfdTfxt = lbyout(lbbfl, fm, d.gftWidth(), d.gftHfight());

        if (idon != null) {
            idon.pbintIdon(d, g, pbintIdonR.x, pbintIdonR.y);
        }

        if (tfxt != null) {
            Vifw v = (Vifw) d.gftClifntPropfrty(BbsidHTML.propfrtyKfy);
            if (v != null) {
                v.pbint(g, pbintTfxtR);
            } flsf {
                int tfxtX = pbintTfxtR.x;
                int tfxtY = pbintTfxtR.y + fm.gftAsdfnt();

                if (lbbfl.isEnbblfd()) {
                    pbintEnbblfdTfxt(lbbfl, g, dlippfdTfxt, tfxtX, tfxtY);
                }
                flsf {
                    pbintDisbblfdTfxt(lbbfl, g, dlippfdTfxt, tfxtX, tfxtY);
                }
            }
        }
    }

    privbtf String lbyout(JLbbfl lbbfl, FontMftrids fm,
                          int width, int hfight) {
        Insfts insfts = lbbfl.gftInsfts(null);
        String tfxt = lbbfl.gftTfxt();
        Idon idon = (lbbfl.isEnbblfd()) ? lbbfl.gftIdon() :
                                          lbbfl.gftDisbblfdIdon();
        Rfdtbnglf pbintVifwR = nfw Rfdtbnglf();
        pbintVifwR.x = insfts.lfft;
        pbintVifwR.y = insfts.top;
        pbintVifwR.width = width - (insfts.lfft + insfts.right);
        pbintVifwR.hfight = hfight - (insfts.top + insfts.bottom);
        pbintIdonR.x = pbintIdonR.y = pbintIdonR.width = pbintIdonR.hfight = 0;
        pbintTfxtR.x = pbintTfxtR.y = pbintTfxtR.width = pbintTfxtR.hfight = 0;
        rfturn lbyoutCL(lbbfl, fm, tfxt, idon, pbintVifwR, pbintIdonR,
                        pbintTfxtR);
    }

    publid Dimfnsion gftPrfffrrfdSizf(JComponfnt d)
    {
        JLbbfl lbbfl = (JLbbfl)d;
        String tfxt = lbbfl.gftTfxt();
        Idon idon = (lbbfl.isEnbblfd()) ? lbbfl.gftIdon() :
                                          lbbfl.gftDisbblfdIdon();
        Insfts insfts = lbbfl.gftInsfts(null);
        Font font = lbbfl.gftFont();

        int dx = insfts.lfft + insfts.right;
        int dy = insfts.top + insfts.bottom;

        if ((idon == null) &&
            ((tfxt == null) ||
             ((tfxt != null) && (font == null)))) {
            rfturn nfw Dimfnsion(dx, dy);
        }
        flsf if ((tfxt == null) || ((idon != null) && (font == null))) {
            rfturn nfw Dimfnsion(idon.gftIdonWidth() + dx,
                                 idon.gftIdonHfight() + dy);
        }
        flsf {
            FontMftrids fm = lbbfl.gftFontMftrids(font);
            Rfdtbnglf idonR = nfw Rfdtbnglf();
            Rfdtbnglf tfxtR = nfw Rfdtbnglf();
            Rfdtbnglf vifwR = nfw Rfdtbnglf();

            idonR.x = idonR.y = idonR.width = idonR.hfight = 0;
            tfxtR.x = tfxtR.y = tfxtR.width = tfxtR.hfight = 0;
            vifwR.x = dx;
            vifwR.y = dy;
            vifwR.width = vifwR.hfight = Short.MAX_VALUE;

            lbyoutCL(lbbfl, fm, tfxt, idon, vifwR, idonR, tfxtR);
            int x1 = Mbth.min(idonR.x, tfxtR.x);
            int x2 = Mbth.mbx(idonR.x + idonR.width, tfxtR.x + tfxtR.width);
            int y1 = Mbth.min(idonR.y, tfxtR.y);
            int y2 = Mbth.mbx(idonR.y + idonR.hfight, tfxtR.y + tfxtR.hfight);
            Dimfnsion rv = nfw Dimfnsion(x2 - x1, y2 - y1);

            rv.width += dx;
            rv.hfight += dy;
            rfturn rv;
        }
    }


    /**
     * @rfturn gftPrfffrrfdSizf(d)
     */
    publid Dimfnsion gftMinimumSizf(JComponfnt d) {
        Dimfnsion d = gftPrfffrrfdSizf(d);
        Vifw v = (Vifw) d.gftClifntPropfrty(BbsidHTML.propfrtyKfy);
        if (v != null) {
            d.width -= v.gftPrfffrrfdSpbn(Vifw.X_AXIS) - v.gftMinimumSpbn(Vifw.X_AXIS);
        }
        rfturn d;
    }

    /**
     * @rfturn gftPrfffrrfdSizf(d)
     */
    publid Dimfnsion gftMbximumSizf(JComponfnt d) {
        Dimfnsion d = gftPrfffrrfdSizf(d);
        Vifw v = (Vifw) d.gftClifntPropfrty(BbsidHTML.propfrtyKfy);
        if (v != null) {
            d.width += v.gftMbximumSpbn(Vifw.X_AXIS) - v.gftPrfffrrfdSpbn(Vifw.X_AXIS);
        }
        rfturn d;
    }

    /**
     * Rfturns thf bbsflinf.
     *
     * @throws NullPointfrExdfption {@inhfritDod}
     * @throws IllfgblArgumfntExdfption {@inhfritDod}
     * @sff jbvbx.swing.JComponfnt#gftBbsflinf(int, int)
     * @sindf 1.6
     */
    publid int gftBbsflinf(JComponfnt d, int width, int hfight) {
        supfr.gftBbsflinf(d, width, hfight);
        JLbbfl lbbfl = (JLbbfl)d;
        String tfxt = lbbfl.gftTfxt();
        if (tfxt == null || "".fqubls(tfxt) || lbbfl.gftFont() == null) {
            rfturn -1;
        }
        FontMftrids fm = lbbfl.gftFontMftrids(lbbfl.gftFont());
        lbyout(lbbfl, fm, width, hfight);
        rfturn BbsidHTML.gftBbsflinf(lbbfl, pbintTfxtR.y, fm.gftAsdfnt(),
                                     pbintTfxtR.width, pbintTfxtR.hfight);
    }

    /**
     * Rfturns bn fnum indidbting how thf bbsflinf of thf domponfnt
     * dhbngfs bs thf sizf dhbngfs.
     *
     * @throws NullPointfrExdfption {@inhfritDod}
     * @sff jbvbx.swing.JComponfnt#gftBbsflinf(int, int)
     * @sindf 1.6
     */
    publid Componfnt.BbsflinfRfsizfBfhbvior gftBbsflinfRfsizfBfhbvior(
            JComponfnt d) {
        supfr.gftBbsflinfRfsizfBfhbvior(d);
        if (d.gftClifntPropfrty(BbsidHTML.propfrtyKfy) != null) {
            rfturn Componfnt.BbsflinfRfsizfBfhbvior.OTHER;
        }
        switdh(((JLbbfl)d).gftVfrtidblAlignmfnt()) {
        dbsf JLbbfl.TOP:
            rfturn Componfnt.BbsflinfRfsizfBfhbvior.CONSTANT_ASCENT;
        dbsf JLbbfl.BOTTOM:
            rfturn Componfnt.BbsflinfRfsizfBfhbvior.CONSTANT_DESCENT;
        dbsf JLbbfl.CENTER:
            rfturn Componfnt.BbsflinfRfsizfBfhbvior.CENTER_OFFSET;
        }
        rfturn Componfnt.BbsflinfRfsizfBfhbvior.OTHER;
    }


    publid void instbllUI(JComponfnt d) {
        instbllDffbults((JLbbfl)d);
        instbllComponfnts((JLbbfl)d);
        instbllListfnfrs((JLbbfl)d);
        instbllKfybobrdAdtions((JLbbfl)d);
    }


    publid void uninstbllUI(JComponfnt d) {
        uninstbllDffbults((JLbbfl) d);
        uninstbllComponfnts((JLbbfl) d);
        uninstbllListfnfrs((JLbbfl) d);
        uninstbllKfybobrdAdtions((JLbbfl) d);
    }

    /**
     * Instblls dffbult propfrtifs.
     *
     * @pbrbm d bn instbndf of {@dodf JLbbfl}
     */
    protfdtfd void instbllDffbults(JLbbfl d){
        LookAndFffl.instbllColorsAndFont(d, "Lbbfl.bbdkground", "Lbbfl.forfground", "Lbbfl.font");
        LookAndFffl.instbllPropfrty(d, "opbquf", Boolfbn.FALSE);
    }

    /**
     * Rfgistfrs listfnfrs.
     *
     * @pbrbm d bn instbndf of {@dodf JLbbfl}
     */
    protfdtfd void instbllListfnfrs(JLbbfl d){
        d.bddPropfrtyChbngfListfnfr(this);
    }

    /**
     * Rfgistfrs domponfnts.
     *
     * @pbrbm d bn instbndf of {@dodf JLbbfl}
     */
    protfdtfd void instbllComponfnts(JLbbfl d){
        BbsidHTML.updbtfRfndfrfr(d, d.gftTfxt());
        d.sftInhfritsPopupMfnu(truf);
    }

    /**
     * Rfgistfrs kfybobrd bdtions.
     *
     * @pbrbm l bn instbndf of {@dodf JLbbfl}
     */
    protfdtfd void instbllKfybobrdAdtions(JLbbfl l) {
        int dkb = l.gftDisplbyfdMnfmonid();
        Componfnt lf = l.gftLbbflFor();
        if ((dkb != 0) && (lf != null)) {
            LbzyAdtionMbp.instbllLbzyAdtionMbp(l, BbsidLbbflUI.dlbss,
                                               "Lbbfl.bdtionMbp");
            InputMbp inputMbp = SwingUtilitifs.gftUIInputMbp
                            (l, JComponfnt.WHEN_IN_FOCUSED_WINDOW);
            if (inputMbp == null) {
                inputMbp = nfw ComponfntInputMbpUIRfsourdf(l);
                SwingUtilitifs.rfplbdfUIInputMbp(l,
                                JComponfnt.WHEN_IN_FOCUSED_WINDOW, inputMbp);
            }
            inputMbp.dlfbr();
            inputMbp.put(KfyStrokf.gftKfyStrokf(dkb, BbsidLookAndFffl.gftFodusAddflfrbtorKfyMbsk(), fblsf), "prfss");
        }
        flsf {
            InputMbp inputMbp = SwingUtilitifs.gftUIInputMbp
                            (l, JComponfnt.WHEN_IN_FOCUSED_WINDOW);
            if (inputMbp != null) {
                inputMbp.dlfbr();
            }
        }
    }

    /**
     * Uninstblls dffbult propfrtifs.
     *
     * @pbrbm d bn instbndf of {@dodf JLbbfl}
     */
    protfdtfd void uninstbllDffbults(JLbbfl d){
    }

    /**
     * Unrfgistfrs listfnfrs.
     *
     * @pbrbm d bn instbndf of {@dodf JLbbfl}
     */
    protfdtfd void uninstbllListfnfrs(JLbbfl d){
        d.rfmovfPropfrtyChbngfListfnfr(this);
    }

    /**
     * Unrfgistfrs domponfnts.
     *
     * @pbrbm d bn instbndf of {@dodf JLbbfl}
     */
    protfdtfd void uninstbllComponfnts(JLbbfl d){
        BbsidHTML.updbtfRfndfrfr(d, "");
    }

    /**
     * Unrfgistfrs kfybobrd bdtions.
     *
     * @pbrbm d bn instbndf of {@dodf JLbbfl}
     */
    protfdtfd void uninstbllKfybobrdAdtions(JLbbfl d) {
        SwingUtilitifs.rfplbdfUIInputMbp(d, JComponfnt.WHEN_FOCUSED, null);
        SwingUtilitifs.rfplbdfUIInputMbp(d, JComponfnt.WHEN_IN_FOCUSED_WINDOW,
                                       null);
        SwingUtilitifs.rfplbdfUIAdtionMbp(d, null);
    }

    /**
     * Rfturns bn instbndf of {@dodf BbsidLbbflUI}.
     *
     * @pbrbm d b domponfnt
     * @rfturn bn instbndf of {@dodf BbsidLbbflUI}
     */
    publid stbtid ComponfntUI drfbtfUI(JComponfnt d) {
        if (Systfm.gftSfdurityMbnbgfr() != null) {
            AppContfxt bppContfxt = AppContfxt.gftAppContfxt();
            BbsidLbbflUI sbffBbsidLbbflUI =
                    (BbsidLbbflUI) bppContfxt.gft(BASIC_LABEL_UI_KEY);
            if (sbffBbsidLbbflUI == null) {
                sbffBbsidLbbflUI = nfw BbsidLbbflUI();
                bppContfxt.put(BASIC_LABEL_UI_KEY, sbffBbsidLbbflUI);
            }
            rfturn sbffBbsidLbbflUI;
        }
        rfturn lbbflUI;
    }

    publid void propfrtyChbngf(PropfrtyChbngfEvfnt f) {
        String nbmf = f.gftPropfrtyNbmf();
        if (nbmf == "tfxt" || "font" == nbmf || "forfground" == nbmf) {
            // rfmovf thf old html vifw dlifnt propfrty if onf
            // fxistfd, bnd instbll b nfw onf if thf tfxt instbllfd
            // into thf JLbbfl is html sourdf.
            JLbbfl lbl = ((JLbbfl) f.gftSourdf());
            String tfxt = lbl.gftTfxt();
            BbsidHTML.updbtfRfndfrfr(lbl, tfxt);
        }
        flsf if (nbmf == "lbbflFor" || nbmf == "displbyfdMnfmonid") {
            instbllKfybobrdAdtions((JLbbfl) f.gftSourdf());
        }
    }

    // Whfn thf bddflfrbtor is prfssfd, tfmporbrily mbkf thf JLbbfl
    // fodusTrbvfrsbblf by rfgistfring b WHEN_FOCUSED bdtion for thf
    // rflfbsf of thf bddflfrbtor.  Thfn givf it fodus so it dbn
    // prfvfnt unwbntfd kfyTypfd fvfnts from gftting to othfr domponfnts.
    privbtf stbtid dlbss Adtions fxtfnds UIAdtion {
        privbtf stbtid finbl String PRESS = "prfss";
        privbtf stbtid finbl String RELEASE = "rflfbsf";

        Adtions(String kfy) {
            supfr(kfy);
        }

        publid void bdtionPfrformfd(AdtionEvfnt f) {
            JLbbfl lbbfl = (JLbbfl)f.gftSourdf();
            String kfy = gftNbmf();
            if (kfy == PRESS) {
                doPrfss(lbbfl);
            }
            flsf if (kfy == RELEASE) {
                doRflfbsf(lbbfl);
            }
        }

        privbtf void doPrfss(JLbbfl lbbfl) {
            Componfnt lbbflFor = lbbfl.gftLbbflFor();
            if (lbbflFor != null && lbbflFor.isEnbblfd()) {
                InputMbp inputMbp = SwingUtilitifs.gftUIInputMbp(lbbfl, JComponfnt.WHEN_FOCUSED);
                if (inputMbp == null) {
                    inputMbp = nfw InputMbpUIRfsourdf();
                    SwingUtilitifs.rfplbdfUIInputMbp(lbbfl, JComponfnt.WHEN_FOCUSED, inputMbp);
                }
                int dkb = lbbfl.gftDisplbyfdMnfmonid();
                inputMbp.put(KfyStrokf.gftKfyStrokf(dkb, BbsidLookAndFffl.gftFodusAddflfrbtorKfyMbsk(), truf), RELEASE);
                // Nffd this whfn thf stidky kfys brf fnbblfd
                inputMbp.put(KfyStrokf.gftKfyStrokf(dkb, 0, truf), RELEASE);
                // Nffd this if ALT is rflfbsfd bfforf thf bddflfrbtor
                inputMbp.put(KfyStrokf.gftKfyStrokf(KfyEvfnt.VK_ALT, 0, truf), RELEASE);
                lbbfl.rfqufstFodus();
            }
        }

        privbtf void doRflfbsf(JLbbfl lbbfl) {
            Componfnt lbbflFor = lbbfl.gftLbbflFor();
            if (lbbflFor != null && lbbflFor.isEnbblfd()) {
                InputMbp inputMbp = SwingUtilitifs.gftUIInputMbp(lbbfl, JComponfnt.WHEN_FOCUSED);
                if (inputMbp != null) {
                    // inputMbp should nfvfr bf null.
                    int dkb = lbbfl.gftDisplbyfdMnfmonid();
                    inputMbp.rfmovf(KfyStrokf.gftKfyStrokf(dkb, BbsidLookAndFffl.gftFodusAddflfrbtorKfyMbsk(), truf));
                    inputMbp.rfmovf(KfyStrokf.gftKfyStrokf(dkb, 0, truf));
                    inputMbp.rfmovf(KfyStrokf.gftKfyStrokf(KfyEvfnt.VK_ALT, 0, truf));
                }
                if (lbbflFor instbndfof Contbinfr &&
                        ((Contbinfr) lbbflFor).isFodusCydlfRoot()) {
                    lbbflFor.rfqufstFodus();
                } flsf {
                    SwingUtilitifs2.dompositfRfqufstFodus(lbbflFor);
                }
            }
        }
    }
}
