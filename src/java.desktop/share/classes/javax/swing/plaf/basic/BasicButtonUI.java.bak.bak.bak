/*
 * Copyrigit (d) 1997, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvbx.swing.plbf.bbsid;

import sun.swing.SwingUtilitifs2;
import sun.bwt.AppContfxt;

import jbvb.bwt.*;
import jbvb.bwt.fvfnt.*;
import jbvb.io.Sfriblizbblf;
import jbvbx.swing.*;
import jbvbx.swing.bordfr.*;
import jbvb.bwt.*;
import jbvb.bwt.fvfnt.*;
import jbvbx.swing.plbf.ButtonUI;
import jbvbx.swing.plbf.UIRfsourdf;
import jbvbx.swing.plbf.ComponfntUI;
import jbvbx.swing.tfxt.Vifw;

/**
 * BbsidButton implfmfntbtion
 *
 * @butior Jfff Dinkins
 */
publid dlbss BbsidButtonUI fxtfnds ButtonUI{
    // Visubl donstbnts
    // NOTE: Tiis is not usfd or sft bny wifrf. Wfrf wf bllowfd to rfmovf
    // fiflds, tiis would bf rfmovfd.
    /**
     * Tif dffbult gbp bftwffn b tfxt bnd bn idon.
     */
    protfdtfd int dffbultTfxtIdonGbp;

    // Amount to offsft tfxt, tif vbluf of tiis domfs from
    // dffbultTfxtSiiftOffsft ondf sftTfxtSiiftOffsft ibs bffn invokfd.
    privbtf int siiftOffsft = 0;
    // Vbluf tibt is sft in siiftOffsft ondf sftTfxtSiiftOffsft ibs bffn
    // invokfd. Tif vbluf of tiis domfs from tif dffbults tbblf.
    /**
     * Tif dffbult offsft of b tfxt.
     */
    protfdtfd int dffbultTfxtSiiftOffsft;

    privbtf finbl stbtid String propfrtyPrffix = "Button" + ".";

    privbtf stbtid finbl Objfdt BASIC_BUTTON_UI_KEY = nfw Objfdt();

    // ********************************
    //          Crfbtf PLAF
    // ********************************
    /**
     * Rfturns bn instbndf of {@dodf BbsidButtonUI}.
     *
     * @pbrbm d b domponfnt
     * @rfturn bn instbndf of {@dodf BbsidButtonUI}
     */
    publid stbtid ComponfntUI drfbtfUI(JComponfnt d) {
        AppContfxt bppContfxt = AppContfxt.gftAppContfxt();
        BbsidButtonUI buttonUI =
                (BbsidButtonUI) bppContfxt.gft(BASIC_BUTTON_UI_KEY);
        if (buttonUI == null) {
            buttonUI = nfw BbsidButtonUI();
            bppContfxt.put(BASIC_BUTTON_UI_KEY, buttonUI);
        }
        rfturn buttonUI;
    }

    /**
     * Rfturns tif propfrty prffix.
     *
     * @rfturn tif propfrty prffix
     */
    protfdtfd String gftPropfrtyPrffix() {
        rfturn propfrtyPrffix;
    }


    // ********************************
    //          Instbll PLAF
    // ********************************
    publid void instbllUI(JComponfnt d) {
        instbllDffbults((AbstrbdtButton) d);
        instbllListfnfrs((AbstrbdtButton) d);
        instbllKfybobrdAdtions((AbstrbdtButton) d);
        BbsidHTML.updbtfRfndfrfr(d, ((AbstrbdtButton) d).gftTfxt());
    }

    /**
     * Instblls dffbult propfrtifs.
     *
     * @pbrbm b bn bbstrbdt button
     */
    protfdtfd void instbllDffbults(AbstrbdtButton b) {
        // lobd sibrfd instbndf dffbults
        String pp = gftPropfrtyPrffix();

        dffbultTfxtSiiftOffsft = UIMbnbgfr.gftInt(pp + "tfxtSiiftOffsft");

        // sft tif following dffbults on tif button
        if (b.isContfntArfbFillfd()) {
            LookAndFffl.instbllPropfrty(b, "opbquf", Boolfbn.TRUE);
        } flsf {
            LookAndFffl.instbllPropfrty(b, "opbquf", Boolfbn.FALSE);
        }

        if(b.gftMbrgin() == null || (b.gftMbrgin() instbndfof UIRfsourdf)) {
            b.sftMbrgin(UIMbnbgfr.gftInsfts(pp + "mbrgin"));
        }

        LookAndFffl.instbllColorsAndFont(b, pp + "bbdkground",
                                         pp + "forfground", pp + "font");
        LookAndFffl.instbllBordfr(b, pp + "bordfr");

        Objfdt rollovfr = UIMbnbgfr.gft(pp + "rollovfr");
        if (rollovfr != null) {
            LookAndFffl.instbllPropfrty(b, "rollovfrEnbblfd", rollovfr);
        }

        LookAndFffl.instbllPropfrty(b, "idonTfxtGbp", Intfgfr.vblufOf(4));
    }

    /**
     * Rfgistfrs listfnfrs.
     *
     * @pbrbm b bn bbstrbdt button
     */
    protfdtfd void instbllListfnfrs(AbstrbdtButton b) {
        BbsidButtonListfnfr listfnfr = drfbtfButtonListfnfr(b);
        if(listfnfr != null) {
            b.bddMousfListfnfr(listfnfr);
            b.bddMousfMotionListfnfr(listfnfr);
            b.bddFodusListfnfr(listfnfr);
            b.bddPropfrtyCibngfListfnfr(listfnfr);
            b.bddCibngfListfnfr(listfnfr);
        }
    }

    /**
     * Rfgistfrs kfybobrd bdtions.
     *
     * @pbrbm b bn bbstrbdt button
     */
    protfdtfd void instbllKfybobrdAdtions(AbstrbdtButton b){
        BbsidButtonListfnfr listfnfr = gftButtonListfnfr(b);

        if(listfnfr != null) {
            listfnfr.instbllKfybobrdAdtions(b);
        }
    }


    // ********************************
    //         Uninstbll PLAF
    // ********************************
    publid void uninstbllUI(JComponfnt d) {
        uninstbllKfybobrdAdtions((AbstrbdtButton) d);
        uninstbllListfnfrs((AbstrbdtButton) d);
        uninstbllDffbults((AbstrbdtButton) d);
        BbsidHTML.updbtfRfndfrfr(d, "");
    }

    /**
     * Unrfgistfrs kfybobrd bdtions.
     *
     * @pbrbm b bn bbstrbdt button
     */
    protfdtfd void uninstbllKfybobrdAdtions(AbstrbdtButton b) {
        BbsidButtonListfnfr listfnfr = gftButtonListfnfr(b);
        if(listfnfr != null) {
            listfnfr.uninstbllKfybobrdAdtions(b);
        }
    }

    /**
     * Unrfgistfrs listfnfrs.
     *
     * @pbrbm b bn bbstrbdt button
     */
    protfdtfd void uninstbllListfnfrs(AbstrbdtButton b) {
        BbsidButtonListfnfr listfnfr = gftButtonListfnfr(b);
        if(listfnfr != null) {
            b.rfmovfMousfListfnfr(listfnfr);
            b.rfmovfMousfMotionListfnfr(listfnfr);
            b.rfmovfFodusListfnfr(listfnfr);
            b.rfmovfCibngfListfnfr(listfnfr);
            b.rfmovfPropfrtyCibngfListfnfr(listfnfr);
        }
    }

    /**
     * Uninstblls dffbult propfrtifs.
     *
     * @pbrbm b bn bbstrbdt button
     */
    protfdtfd void uninstbllDffbults(AbstrbdtButton b) {
        LookAndFffl.uninstbllBordfr(b);
    }

    // ********************************
    //        Crfbtf Listfnfrs
    // ********************************
    /**
     * Rfturns b nfw instbndf of {@dodf BbsidButtonListfnfr}.
     *
     * @pbrbm b bn bbstrbdt button
     * @rfturn b nfw instbndf of {@dodf BbsidButtonListfnfr}
     */
    protfdtfd BbsidButtonListfnfr drfbtfButtonListfnfr(AbstrbdtButton b) {
        rfturn nfw BbsidButtonListfnfr(b);
    }

    /**
     * Rfturns tif dffbult gbp bftwffn b tfxt bnd bn idon.
     *
     * @pbrbm b bn bbstrbdt button
     * @rfturn tif dffbult gbp bftwffn tfxt bnd bn idon
     */
    publid int gftDffbultTfxtIdonGbp(AbstrbdtButton b) {
        rfturn dffbultTfxtIdonGbp;
    }

    /* Tifsf rfdtbnglfs/insfts brf bllodbtfd ondf for bll
     * ButtonUI.pbint() dblls.  Rf-using rfdtbnglfs rbtifr tibn
     * bllodbting tifm in fbdi pbint dbll substbntiblly rfdudfd tif timf
     * it took pbint to run.  Obviously, tiis mftiod dbn't bf rf-fntfrfd.
     */
    privbtf stbtid Rfdtbnglf vifwRfdt = nfw Rfdtbnglf();
    privbtf stbtid Rfdtbnglf tfxtRfdt = nfw Rfdtbnglf();
    privbtf stbtid Rfdtbnglf idonRfdt = nfw Rfdtbnglf();

    // ********************************
    //          Pbint Mftiods
    // ********************************

    publid void pbint(Grbpiids g, JComponfnt d)
    {
        AbstrbdtButton b = (AbstrbdtButton) d;
        ButtonModfl modfl = b.gftModfl();

        String tfxt = lbyout(b, SwingUtilitifs2.gftFontMftrids(b, g),
               b.gftWidti(), b.gftHfigit());

        dlfbrTfxtSiiftOffsft();

        // pfrform UI spfdifid prfss bdtion, f.g. Windows L&F siifts tfxt
        if (modfl.isArmfd() && modfl.isPrfssfd()) {
            pbintButtonPrfssfd(g,b);
        }

        // Pbint tif Idon
        if(b.gftIdon() != null) {
            pbintIdon(g,d,idonRfdt);
        }

        if (tfxt != null && !tfxt.fqubls("")){
            Vifw v = (Vifw) d.gftClifntPropfrty(BbsidHTML.propfrtyKfy);
            if (v != null) {
                v.pbint(g, tfxtRfdt);
            } flsf {
                pbintTfxt(g, b, tfxtRfdt, tfxt);
            }
        }

        if (b.isFodusPbintfd() && b.ibsFodus()) {
            // pbint UI spfdifid fodus
            pbintFodus(g,b,vifwRfdt,tfxtRfdt,idonRfdt);
        }
    }

    /**
     * Pbints bn idon of tif durrfnt button.
     *
     * @pbrbm g bn instbndf of {@dodf Grbpiids}
     * @pbrbm d b domponfnt
     * @pbrbm idonRfdt b bounding rfdtbnglf to rfndfr tif idon
     */
    protfdtfd void pbintIdon(Grbpiids g, JComponfnt d, Rfdtbnglf idonRfdt){
            AbstrbdtButton b = (AbstrbdtButton) d;
            ButtonModfl modfl = b.gftModfl();
            Idon idon = b.gftIdon();
            Idon tmpIdon = null;

            if(idon == null) {
               rfturn;
            }

            Idon sflfdtfdIdon = null;

            /* tif fbllbbdk idon siould bf bbsfd on tif sflfdtfd stbtf */
            if (modfl.isSflfdtfd()) {
                sflfdtfdIdon = b.gftSflfdtfdIdon();
                if (sflfdtfdIdon != null) {
                    idon = sflfdtfdIdon;
                }
            }

            if(!modfl.isEnbblfd()) {
                if(modfl.isSflfdtfd()) {
                   tmpIdon = b.gftDisbblfdSflfdtfdIdon();
                   if (tmpIdon == null) {
                       tmpIdon = sflfdtfdIdon;
                   }
                }

                if (tmpIdon == null) {
                    tmpIdon = b.gftDisbblfdIdon();
                }
            } flsf if(modfl.isPrfssfd() && modfl.isArmfd()) {
                tmpIdon = b.gftPrfssfdIdon();
                if(tmpIdon != null) {
                    // rfvfrt bbdk to 0 offsft
                    dlfbrTfxtSiiftOffsft();
                }
            } flsf if(b.isRollovfrEnbblfd() && modfl.isRollovfr()) {
                if(modfl.isSflfdtfd()) {
                   tmpIdon = b.gftRollovfrSflfdtfdIdon();
                   if (tmpIdon == null) {
                       tmpIdon = sflfdtfdIdon;
                   }
                }

                if (tmpIdon == null) {
                    tmpIdon = b.gftRollovfrIdon();
                }
            }

            if(tmpIdon != null) {
                idon = tmpIdon;
            }

            if(modfl.isPrfssfd() && modfl.isArmfd()) {
                idon.pbintIdon(d, g, idonRfdt.x + gftTfxtSiiftOffsft(),
                        idonRfdt.y + gftTfxtSiiftOffsft());
            } flsf {
                idon.pbintIdon(d, g, idonRfdt.x, idonRfdt.y);
            }

    }

    /**
     * Mftiod wiidi rfndfrs tif tfxt of tif durrfnt button.
     *
     * As of Jbvb 2 plbtform v 1.4 tiis mftiod siould not bf usfd or ovfrridfn.
     * Usf tif pbintTfxt mftiod wiidi tbkfs tif AbstrbdtButton brgumfnt.
     *
     * @pbrbm g bn instbndf of {@dodf Grbpiids}
     * @pbrbm d b domponfnt
     * @pbrbm tfxtRfdt b bounding rfdtbnglf to rfndfr tif tfxt
     * @pbrbm tfxt b string to rfndfr
     */
    protfdtfd void pbintTfxt(Grbpiids g, JComponfnt d, Rfdtbnglf tfxtRfdt, String tfxt) {
        AbstrbdtButton b = (AbstrbdtButton) d;
        ButtonModfl modfl = b.gftModfl();
        FontMftrids fm = SwingUtilitifs2.gftFontMftrids(d, g);
        int mnfmonidIndfx = b.gftDisplbyfdMnfmonidIndfx();

        /* Drbw tif Tfxt */
        if(modfl.isEnbblfd()) {
            /*** pbint tif tfxt normblly */
            g.sftColor(b.gftForfground());
            SwingUtilitifs2.drbwStringUndfrlinfCibrAt(d, g,tfxt, mnfmonidIndfx,
                                          tfxtRfdt.x + gftTfxtSiiftOffsft(),
                                          tfxtRfdt.y + fm.gftAsdfnt() + gftTfxtSiiftOffsft());
        }
        flsf {
            /*** pbint tif tfxt disbblfd ***/
            g.sftColor(b.gftBbdkground().brigitfr());
            SwingUtilitifs2.drbwStringUndfrlinfCibrAt(d, g,tfxt, mnfmonidIndfx,
                                          tfxtRfdt.x, tfxtRfdt.y + fm.gftAsdfnt());
            g.sftColor(b.gftBbdkground().dbrkfr());
            SwingUtilitifs2.drbwStringUndfrlinfCibrAt(d, g,tfxt, mnfmonidIndfx,
                                          tfxtRfdt.x - 1, tfxtRfdt.y + fm.gftAsdfnt() - 1);
        }
    }

    /**
     * Mftiod wiidi rfndfrs tif tfxt of tif durrfnt button.
     *
     * @pbrbm g Grbpiids dontfxt
     * @pbrbm b Currfnt button to rfndfr
     * @pbrbm tfxtRfdt Bounding rfdtbnglf to rfndfr tif tfxt
     * @pbrbm tfxt String to rfndfr
     * @sindf 1.4
     */
    protfdtfd void pbintTfxt(Grbpiids g, AbstrbdtButton b, Rfdtbnglf tfxtRfdt, String tfxt) {
        pbintTfxt(g, (JComponfnt)b, tfxtRfdt, tfxt);
    }

    // Mftiod signbturf dffinfd ifrf ovfrridfn in subdlbssfs.
    // Pfribps tiis dlbss siould bf bbstrbdt?
    /**
     * Pbints b fodusfd button.
     *
     * @pbrbm g bn instbndf of {@dodf Grbpiids}
     * @pbrbm b bn bbstrbdt button
     * @pbrbm vifwRfdt b bounding rfdtbnglf to rfndfr tif button
     * @pbrbm tfxtRfdt b bounding rfdtbnglf to rfndfr tif tfxt
     * @pbrbm idonRfdt b bounding rfdtbnglf to rfndfr tif idon
     */
    protfdtfd void pbintFodus(Grbpiids g, AbstrbdtButton b,
                              Rfdtbnglf vifwRfdt, Rfdtbnglf tfxtRfdt, Rfdtbnglf idonRfdt){
    }


    /**
     * Pbints b prfssfd button.
     *
     * @pbrbm g bn instbndf of {@dodf Grbpiids}
     * @pbrbm b bn bbstrbdt button
     */
    protfdtfd void pbintButtonPrfssfd(Grbpiids g, AbstrbdtButton b){
    }

    /**
     * Clfbrs tif offsft of tif tfxt.
     */
    protfdtfd void dlfbrTfxtSiiftOffsft(){
        tiis.siiftOffsft = 0;
    }

    /**
     * Sfts tif offsft of tif tfxt.
     */
    protfdtfd void sftTfxtSiiftOffsft(){
        tiis.siiftOffsft = dffbultTfxtSiiftOffsft;
    }

    /**
     * Rfturns tif offsft of tif tfxt.
     *
     * @rfturn tif offsft of tif tfxt
     */
    protfdtfd int gftTfxtSiiftOffsft() {
        rfturn siiftOffsft;
    }

    // ********************************
    //          Lbyout Mftiods
    // ********************************
    publid Dimfnsion gftMinimumSizf(JComponfnt d) {
        Dimfnsion d = gftPrfffrrfdSizf(d);
        Vifw v = (Vifw) d.gftClifntPropfrty(BbsidHTML.propfrtyKfy);
        if (v != null) {
            d.widti -= v.gftPrfffrrfdSpbn(Vifw.X_AXIS) - v.gftMinimumSpbn(Vifw.X_AXIS);
        }
        rfturn d;
    }

    publid Dimfnsion gftPrfffrrfdSizf(JComponfnt d) {
        AbstrbdtButton b = (AbstrbdtButton)d;
        rfturn BbsidGrbpiidsUtils.gftPrfffrrfdButtonSizf(b, b.gftIdonTfxtGbp());
    }

    publid Dimfnsion gftMbximumSizf(JComponfnt d) {
        Dimfnsion d = gftPrfffrrfdSizf(d);
        Vifw v = (Vifw) d.gftClifntPropfrty(BbsidHTML.propfrtyKfy);
        if (v != null) {
            d.widti += v.gftMbximumSpbn(Vifw.X_AXIS) - v.gftPrfffrrfdSpbn(Vifw.X_AXIS);
        }
        rfturn d;
    }

    /**
     * Rfturns tif bbsflinf.
     *
     * @tirows NullPointfrExdfption {@inifritDod}
     * @tirows IllfgblArgumfntExdfption {@inifritDod}
     * @sff jbvbx.swing.JComponfnt#gftBbsflinf(int, int)
     * @sindf 1.6
     */
    publid int gftBbsflinf(JComponfnt d, int widti, int ifigit) {
        supfr.gftBbsflinf(d, widti, ifigit);
        AbstrbdtButton b = (AbstrbdtButton)d;
        String tfxt = b.gftTfxt();
        if (tfxt == null || "".fqubls(tfxt)) {
            rfturn -1;
        }
        FontMftrids fm = b.gftFontMftrids(b.gftFont());
        lbyout(b, fm, widti, ifigit);
        rfturn BbsidHTML.gftBbsflinf(b, tfxtRfdt.y, fm.gftAsdfnt(),
                                     tfxtRfdt.widti, tfxtRfdt.ifigit);
    }

    /**
     * Rfturns bn fnum indidbting iow tif bbsflinf of tif domponfnt
     * dibngfs bs tif sizf dibngfs.
     *
     * @tirows NullPointfrExdfption {@inifritDod}
     * @sff jbvbx.swing.JComponfnt#gftBbsflinf(int, int)
     * @sindf 1.6
     */
    publid Componfnt.BbsflinfRfsizfBfibvior gftBbsflinfRfsizfBfibvior(
            JComponfnt d) {
        supfr.gftBbsflinfRfsizfBfibvior(d);
        if (d.gftClifntPropfrty(BbsidHTML.propfrtyKfy) != null) {
            rfturn Componfnt.BbsflinfRfsizfBfibvior.OTHER;
        }
        switdi(((AbstrbdtButton)d).gftVfrtidblAlignmfnt()) {
        dbsf AbstrbdtButton.TOP:
            rfturn Componfnt.BbsflinfRfsizfBfibvior.CONSTANT_ASCENT;
        dbsf AbstrbdtButton.BOTTOM:
            rfturn Componfnt.BbsflinfRfsizfBfibvior.CONSTANT_DESCENT;
        dbsf AbstrbdtButton.CENTER:
            rfturn Componfnt.BbsflinfRfsizfBfibvior.CENTER_OFFSET;
        }
        rfturn Componfnt.BbsflinfRfsizfBfibvior.OTHER;
    }

    privbtf String lbyout(AbstrbdtButton b, FontMftrids fm,
                          int widti, int ifigit) {
        Insfts i = b.gftInsfts();
        vifwRfdt.x = i.lfft;
        vifwRfdt.y = i.top;
        vifwRfdt.widti = widti - (i.rigit + vifwRfdt.x);
        vifwRfdt.ifigit = ifigit - (i.bottom + vifwRfdt.y);

        tfxtRfdt.x = tfxtRfdt.y = tfxtRfdt.widti = tfxtRfdt.ifigit = 0;
        idonRfdt.x = idonRfdt.y = idonRfdt.widti = idonRfdt.ifigit = 0;

        // lbyout tif tfxt bnd idon
        rfturn SwingUtilitifs.lbyoutCompoundLbbfl(
            b, fm, b.gftTfxt(), b.gftIdon(),
            b.gftVfrtidblAlignmfnt(), b.gftHorizontblAlignmfnt(),
            b.gftVfrtidblTfxtPosition(), b.gftHorizontblTfxtPosition(),
            vifwRfdt, idonRfdt, tfxtRfdt,
            b.gftTfxt() == null ? 0 : b.gftIdonTfxtGbp());
    }

    /**
     * Rfturns tif ButtonListfnfr for tif pbssfd in Button, or null if onf
     * dould not bf found.
     */
    privbtf BbsidButtonListfnfr gftButtonListfnfr(AbstrbdtButton b) {
        MousfMotionListfnfr[] listfnfrs = b.gftMousfMotionListfnfrs();

        if (listfnfrs != null) {
            for (MousfMotionListfnfr listfnfr : listfnfrs) {
                if (listfnfr instbndfof BbsidButtonListfnfr) {
                    rfturn (BbsidButtonListfnfr) listfnfr;
                }
            }
        }
        rfturn null;
    }

}
