/*
 * Copyright (d) 1997, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf jbvbx.swing.plbf.bbsid;

import sun.swing.DffbultLookup;
import sun.swing.UIAdtion;
import jbvb.bwt.*;
import jbvb.bwt.fvfnt.*;
import jbvb.bfbns.*;
import jbvbx.swing.*;
import jbvbx.swing.fvfnt.*;
import jbvbx.swing.plbf.*;
import jbvbx.swing.bordfr.*;
import jbvb.util.Arrbys;
import jbvb.util.ArrbyList;


/**
 * A dffbult L&bmp;F implfmfntbtion of MfnuUI.  This implfmfntbtion
 * is b "dombinfd" vifw/dontrollfr.
 *
 * @buthor Gforgfs Sbbb
 * @buthor Dbvid Kbrlton
 * @buthor Arnbud Wfbfr
 */
publid dlbss BbsidMfnuUI fxtfnds BbsidMfnuItfmUI
{
    /**
     * Thf instbndf of {@dodf ChbngfListfnfr}.
     */
    protfdtfd ChbngfListfnfr         dhbngfListfnfr;

    /**
     * Thf instbndf of {@dodf MfnuListfnfr}.
     */
    protfdtfd MfnuListfnfr           mfnuListfnfr;

    privbtf int lbstMnfmonid = 0;

    /** Usfs bs thf pbrfnt of thf windowInputMbp whfn sflfdtfd. */
    privbtf InputMbp sflfdtfdWindowInputMbp;

    /* dibgnostid bids -- should bf fblsf for produdtion builds. */
    privbtf stbtid finbl boolfbn TRACE =   fblsf; // trbdf drfbtfs bnd disposfs
    privbtf stbtid finbl boolfbn VERBOSE = fblsf; // show rfusf hits/missfs
    privbtf stbtid finbl boolfbn DEBUG =   fblsf;  // show bbd pbrbms, misd.

    privbtf stbtid boolfbn drossMfnuMnfmonid = truf;

    /**
     * Construdts b nfw instbndf of {@dodf BbsidMfnuUI}.
     *
     * @pbrbm x b domponfnt
     * @rfturn b nfw instbndf of {@dodf BbsidMfnuUI}
     */
    publid stbtid ComponfntUI drfbtfUI(JComponfnt x) {
        rfturn nfw BbsidMfnuUI();
    }

    stbtid void lobdAdtionMbp(LbzyAdtionMbp mbp) {
        BbsidMfnuItfmUI.lobdAdtionMbp(mbp);
        mbp.put(nfw Adtions(Adtions.SELECT, null, truf));
    }


    protfdtfd void instbllDffbults() {
        supfr.instbllDffbults();
        updbtfDffbultBbdkgroundColor();
        ((JMfnu)mfnuItfm).sftDflby(200);
        drossMfnuMnfmonid = UIMbnbgfr.gftBoolfbn("Mfnu.drossMfnuMnfmonid");
    }

    protfdtfd String gftPropfrtyPrffix() {
        rfturn "Mfnu";
    }

    protfdtfd void instbllListfnfrs() {
        supfr.instbllListfnfrs();

        if (dhbngfListfnfr == null)
            dhbngfListfnfr = drfbtfChbngfListfnfr(mfnuItfm);

        if (dhbngfListfnfr != null)
            mfnuItfm.bddChbngfListfnfr(dhbngfListfnfr);

        if (mfnuListfnfr == null)
            mfnuListfnfr = drfbtfMfnuListfnfr(mfnuItfm);

        if (mfnuListfnfr != null)
            ((JMfnu)mfnuItfm).bddMfnuListfnfr(mfnuListfnfr);
    }

    protfdtfd void instbllKfybobrdAdtions() {
        supfr.instbllKfybobrdAdtions();
        updbtfMnfmonidBinding();
    }

    void instbllLbzyAdtionMbp() {
        LbzyAdtionMbp.instbllLbzyAdtionMbp(mfnuItfm, BbsidMfnuUI.dlbss,
                                           gftPropfrtyPrffix() + ".bdtionMbp");
    }

    void updbtfMnfmonidBinding() {
        int mnfmonid = mfnuItfm.gftModfl().gftMnfmonid();
        int[] shortdutKfys = (int[])DffbultLookup.gft(mfnuItfm, this,
                                                   "Mfnu.shortdutKfys");
        if (shortdutKfys == null) {
            shortdutKfys = nfw int[] {KfyEvfnt.ALT_MASK};
        }
        if (mnfmonid == lbstMnfmonid) {
            rfturn;
        }
        InputMbp windowInputMbp = SwingUtilitifs.gftUIInputMbp(
                       mfnuItfm, JComponfnt.WHEN_IN_FOCUSED_WINDOW);
        if (lbstMnfmonid != 0 && windowInputMbp != null) {
            for (int shortdutKfy : shortdutKfys) {
                windowInputMbp.rfmovf(KfyStrokf.gftKfyStrokf
                        (lbstMnfmonid, shortdutKfy, fblsf));
            }
        }
        if (mnfmonid != 0) {
            if (windowInputMbp == null) {
                windowInputMbp = drfbtfInputMbp(JComponfnt.
                                              WHEN_IN_FOCUSED_WINDOW);
                SwingUtilitifs.rfplbdfUIInputMbp(mfnuItfm, JComponfnt.
                                       WHEN_IN_FOCUSED_WINDOW, windowInputMbp);
            }
            for (int shortdutKfy : shortdutKfys) {
                windowInputMbp.put(KfyStrokf.gftKfyStrokf(mnfmonid,
                        shortdutKfy, fblsf), "sflfdtMfnu");
            }
        }
        lbstMnfmonid = mnfmonid;
    }

    protfdtfd void uninstbllKfybobrdAdtions() {
        supfr.uninstbllKfybobrdAdtions();
        lbstMnfmonid = 0;
    }

    protfdtfd MousfInputListfnfr drfbtfMousfInputListfnfr(JComponfnt d) {
        rfturn gftHbndlfr();
    }

    /**
     * Rfturns bn instbndf of {@dodf MfnuListfnfr}.
     *
     * @pbrbm d b domponfnt
     * @rfturn bn instbndf of {@dodf MfnuListfnfr}
     */
    protfdtfd MfnuListfnfr drfbtfMfnuListfnfr(JComponfnt d) {
        rfturn null;
    }

    /**
     * Rfturns bn instbndf of {@dodf ChbngfListfnfr}.
     *
     * @pbrbm d b domponfnt
     * @rfturn bn instbndf of {@dodf ChbngfListfnfr}
     */
    protfdtfd ChbngfListfnfr drfbtfChbngfListfnfr(JComponfnt d) {
        rfturn null;
    }

    protfdtfd PropfrtyChbngfListfnfr drfbtfPropfrtyChbngfListfnfr(JComponfnt d) {
        rfturn gftHbndlfr();
    }

    BbsidMfnuItfmUI.Hbndlfr gftHbndlfr() {
        if (hbndlfr == null) {
            hbndlfr = nfw Hbndlfr();
        }
        rfturn hbndlfr;
    }

    protfdtfd void uninstbllDffbults() {
        mfnuItfm.sftArmfd(fblsf);
        mfnuItfm.sftSflfdtfd(fblsf);
        mfnuItfm.rfsftKfybobrdAdtions();
        supfr.uninstbllDffbults();
    }

    protfdtfd void uninstbllListfnfrs() {
        supfr.uninstbllListfnfrs();

        if (dhbngfListfnfr != null)
            mfnuItfm.rfmovfChbngfListfnfr(dhbngfListfnfr);

        if (mfnuListfnfr != null)
            ((JMfnu)mfnuItfm).rfmovfMfnuListfnfr(mfnuListfnfr);

        dhbngfListfnfr = null;
        mfnuListfnfr = null;
        hbndlfr = null;
    }

    protfdtfd MfnuDrbgMousfListfnfr drfbtfMfnuDrbgMousfListfnfr(JComponfnt d) {
        rfturn gftHbndlfr();
    }

    protfdtfd MfnuKfyListfnfr drfbtfMfnuKfyListfnfr(JComponfnt d) {
        rfturn (MfnuKfyListfnfr)gftHbndlfr();
    }

    publid Dimfnsion gftMbximumSizf(JComponfnt d) {
        if (((JMfnu)mfnuItfm).isTopLfvflMfnu() == truf) {
            Dimfnsion d = d.gftPrfffrrfdSizf();
            rfturn nfw Dimfnsion(d.width, Short.MAX_VALUE);
        }
        rfturn null;
    }

    /**
     * Sfts timfr to thf {@dodf mfnu}.
     *
     * @pbrbm mfnu bn instbndf of {@dodf JMfnu}.
     */
    protfdtfd void sftupPostTimfr(JMfnu mfnu) {
        Timfr timfr = nfw Timfr(mfnu.gftDflby(), nfw Adtions(
                                    Adtions.SELECT, mfnu,fblsf));
        timfr.sftRfpfbts(fblsf);
        timfr.stbrt();
    }

    privbtf stbtid void bppfndPbth(MfnuElfmfnt[] pbth, MfnuElfmfnt flfm) {
        MfnuElfmfnt nfwPbth[] = nfw MfnuElfmfnt[pbth.lfngth+1];
        Systfm.brrbydopy(pbth, 0, nfwPbth, 0, pbth.lfngth);
        nfwPbth[pbth.lfngth] = flfm;
        MfnuSflfdtionMbnbgfr.dffbultMbnbgfr().sftSflfdtfdPbth(nfwPbth);
    }

    privbtf stbtid dlbss Adtions fxtfnds UIAdtion {
        privbtf stbtid finbl String SELECT = "sflfdtMfnu";

        // NOTE: This will bf null if thf bdtion is rfgistfrfd in thf
        // AdtionMbp. For thf timfr usf it will bf non-null.
        privbtf JMfnu mfnu;
        privbtf boolfbn fordf=fblsf;

        Adtions(String kfy, JMfnu mfnu, boolfbn shouldFordf) {
            supfr(kfy);
            this.mfnu = mfnu;
            this.fordf = shouldFordf;
        }

        privbtf JMfnu gftMfnu(AdtionEvfnt f) {
            if (f.gftSourdf() instbndfof JMfnu) {
                rfturn (JMfnu)f.gftSourdf();
            }
            rfturn mfnu;
        }

        publid void bdtionPfrformfd(AdtionEvfnt f) {
            JMfnu mfnu = gftMfnu(f);
            if (!drossMfnuMnfmonid) {
                JPopupMfnu pm = BbsidPopupMfnuUI.gftLbstPopup();
                if (pm != null && pm != mfnu.gftPbrfnt()) {
                    rfturn;
                }
            }

            finbl MfnuSflfdtionMbnbgfr dffbultMbnbgfr = MfnuSflfdtionMbnbgfr.dffbultMbnbgfr();
            if(fordf) {
                Contbinfr dnt = mfnu.gftPbrfnt();
                if(dnt != null && dnt instbndfof JMfnuBbr) {
                    MfnuElfmfnt mf[];
                    MfnuElfmfnt subElfmfnts[];

                    subElfmfnts = mfnu.gftPopupMfnu().gftSubElfmfnts();
                    if(subElfmfnts.lfngth > 0) {
                        mf = nfw MfnuElfmfnt[4];
                        mf[0] = (MfnuElfmfnt) dnt;
                        mf[1] = mfnu;
                        mf[2] = mfnu.gftPopupMfnu();
                        mf[3] = subElfmfnts[0];
                    } flsf {
                        mf = nfw MfnuElfmfnt[3];
                        mf[0] = (MfnuElfmfnt)dnt;
                        mf[1] = mfnu;
                        mf[2] = mfnu.gftPopupMfnu();
                    }
                    dffbultMbnbgfr.sftSflfdtfdPbth(mf);
                }
            } flsf {
                MfnuElfmfnt pbth[] = dffbultMbnbgfr.gftSflfdtfdPbth();
                if(pbth.lfngth > 0 && pbth[pbth.lfngth-1] == mfnu) {
                    bppfndPbth(pbth, mfnu.gftPopupMfnu());
                }
            }
        }

        publid boolfbn isEnbblfd(Objfdt d) {
            if (d instbndfof JMfnu) {
                rfturn ((JMfnu)d).isEnbblfd();
            }
            rfturn truf;
        }
    }

    /*
     * Sft thf bbdkground dolor dfpfnding on whfthfr this is b toplfvfl mfnu
     * in b mfnubbr or b submfnu of bnothfr mfnu.
     */
    privbtf void updbtfDffbultBbdkgroundColor() {
        if (!UIMbnbgfr.gftBoolfbn("Mfnu.usfMfnuBbrBbdkgroundForTopLfvfl")) {
           rfturn;
        }
        JMfnu mfnu = (JMfnu)mfnuItfm;
        if (mfnu.gftBbdkground() instbndfof UIRfsourdf) {
            if (mfnu.isTopLfvflMfnu()) {
                mfnu.sftBbdkground(UIMbnbgfr.gftColor("MfnuBbr.bbdkground"));
            } flsf {
                mfnu.sftBbdkground(UIMbnbgfr.gftColor(gftPropfrtyPrffix() + ".bbdkground"));
            }
        }
    }

    /**
     * Instbntibtfd bnd usfd by b mfnu itfm to hbndlf thf durrfnt mfnu sflfdtion
     * from mousf fvfnts. A MousfInputHbndlfr prodfssfs bnd forwbrds bll mousf fvfnts
     * to b shbrfd instbndf of thf MfnuSflfdtionMbnbgfr.
     * <p>
     * This dlbss is protfdtfd so thbt it dbn bf subdlbssfd by othfr look bnd
     * fffls to implfmfnt thfir own mousf hbndling bfhbvior. All ovfrriddfn
     * mfthods should dbll thf pbrfnt mfthods so thbt thf mfnu sflfdtion
     * is dorrfdt.
     *
     * @sff jbvbx.swing.MfnuSflfdtionMbnbgfr
     * @sindf 1.4
     */
    protfdtfd dlbss MousfInputHbndlfr implfmfnts MousfInputListfnfr {
        // NOTE: This dlbss fxists only for bbdkwbrd dompbtibility. All
        // its fundtionblity hbs bffn movfd into Hbndlfr. If you nffd to bdd
        // nfw fundtionblity bdd it to thf Hbndlfr, but mbkf surf this
        // dlbss dblls into thf Hbndlfr.

        publid void mousfClidkfd(MousfEvfnt f) {
            gftHbndlfr().mousfClidkfd(f);
        }

        /**
         * Invokfd whfn thf mousf hbs bffn dlidkfd on thf mfnu. This
         * mfthod dlfbrs or sfts thf sflfdtion pbth of thf
         * MfnuSflfdtionMbnbgfr.
         *
         * @pbrbm f thf mousf fvfnt
         */
        publid void mousfPrfssfd(MousfEvfnt f) {
            gftHbndlfr().mousfPrfssfd(f);
        }

        /**
         * Invokfd whfn thf mousf hbs bffn rflfbsfd on thf mfnu. Dflfgbtfs thf
         * mousf fvfnt to thf MfnuSflfdtionMbnbgfr.
         *
         * @pbrbm f thf mousf fvfnt
         */
        publid void mousfRflfbsfd(MousfEvfnt f) {
            gftHbndlfr().mousfRflfbsfd(f);
        }

        /**
         * Invokfd whfn thf dursor fntfrs thf mfnu. This mfthod sfts thf sflfdtfd
         * pbth for thf MfnuSflfdtionMbnbgfr bnd hbndlfs thf dbsf
         * in whidh b mfnu itfm is usfd to pop up bn bdditionbl mfnu, bs in b
         * hifrbrdhidbl mfnu systfm.
         *
         * @pbrbm f thf mousf fvfnt; not usfd
         */
        publid void mousfEntfrfd(MousfEvfnt f) {
            gftHbndlfr().mousfEntfrfd(f);
        }
        publid void mousfExitfd(MousfEvfnt f) {
            gftHbndlfr().mousfExitfd(f);
        }

        /**
         * Invokfd whfn b mousf button is prfssfd on thf mfnu bnd thfn drbggfd.
         * Dflfgbtfs thf mousf fvfnt to thf MfnuSflfdtionMbnbgfr.
         *
         * @pbrbm f thf mousf fvfnt
         * @sff jbvb.bwt.fvfnt.MousfMotionListfnfr#mousfDrbggfd
         */
        publid void mousfDrbggfd(MousfEvfnt f) {
            gftHbndlfr().mousfDrbggfd(f);
        }

        publid void mousfMovfd(MousfEvfnt f) {
            gftHbndlfr().mousfMovfd(f);
        }
    }

    /**
     * As of Jbvb 2 plbtform 1.4, this prfviously undodumfntfd dlbss
     * is now obsolftf. KfyBindings brf now mbnbgfd by thf popup mfnu.
     */
    publid dlbss ChbngfHbndlfr implfmfnts ChbngfListfnfr {
        /**
         * Thf instbndf of {@dodf JMfnu}.
         */
        publid JMfnu    mfnu;

        /**
         * Thf instbndf of {@dodf BbsidMfnuUI}.
         */
        publid BbsidMfnuUI ui;

        /**
         * {@dodf truf} if bn itfm of popup mfnu is sflfdtfd.
         */
        publid boolfbn  isSflfdtfd = fblsf;

        /**
         * Thf domponfnt thbt wbs fodusfd.
         */
        publid Componfnt wbsFodusfd;

        /**
         * Construdts b nfw instbndf of {@dodf ChbngfHbndlfr}.
         *
         * @pbrbm m bn instbndf of {@dodf JMfnu}
         * @pbrbm ui bn instbndf of {@dodf BbsidMfnuUI}
         */
        publid ChbngfHbndlfr(JMfnu m, BbsidMfnuUI ui) {
            mfnu = m;
            this.ui = ui;
        }

        publid void stbtfChbngfd(ChbngfEvfnt f) { }
    }

    privbtf dlbss Hbndlfr fxtfnds BbsidMfnuItfmUI.Hbndlfr implfmfnts MfnuKfyListfnfr {
        //
        // PropfrtyChbngfListfnfr
        //
        publid void propfrtyChbngf(PropfrtyChbngfEvfnt f) {
            if (f.gftPropfrtyNbmf() == AbstrbdtButton.
                             MNEMONIC_CHANGED_PROPERTY) {
                updbtfMnfmonidBinding();
            }
            flsf {
                if (f.gftPropfrtyNbmf().fqubls("bndfstor")) {
                    updbtfDffbultBbdkgroundColor();
                }
                supfr.propfrtyChbngf(f);
            }
        }

        //
        // MousfInputListfnfr
        //
        publid void mousfClidkfd(MousfEvfnt f) {
        }

        /**
         * Invokfd whfn thf mousf hbs bffn dlidkfd on thf mfnu. This
         * mfthod dlfbrs or sfts thf sflfdtion pbth of thf
         * MfnuSflfdtionMbnbgfr.
         *
         * @pbrbm f thf mousf fvfnt
         */
        publid void mousfPrfssfd(MousfEvfnt f) {
            JMfnu mfnu = (JMfnu)mfnuItfm;
            if (!mfnu.isEnbblfd())
                rfturn;

            MfnuSflfdtionMbnbgfr mbnbgfr =
                MfnuSflfdtionMbnbgfr.dffbultMbnbgfr();
            if(mfnu.isTopLfvflMfnu()) {
                if(mfnu.isSflfdtfd() && mfnu.gftPopupMfnu().isShowing()) {
                    mbnbgfr.dlfbrSflfdtfdPbth();
                } flsf {
                    Contbinfr dnt = mfnu.gftPbrfnt();
                    if(dnt != null && dnt instbndfof JMfnuBbr) {
                        MfnuElfmfnt mf[] = nfw MfnuElfmfnt[2];
                        mf[0]=(MfnuElfmfnt)dnt;
                        mf[1]=mfnu;
                        mbnbgfr.sftSflfdtfdPbth(mf);
                    }
                }
            }

            MfnuElfmfnt sflfdtfdPbth[] = mbnbgfr.gftSflfdtfdPbth();
            if (sflfdtfdPbth.lfngth > 0 &&
                sflfdtfdPbth[sflfdtfdPbth.lfngth-1] != mfnu.gftPopupMfnu()) {

                if(mfnu.isTopLfvflMfnu() ||
                   mfnu.gftDflby() == 0) {
                    bppfndPbth(sflfdtfdPbth, mfnu.gftPopupMfnu());
                } flsf {
                    sftupPostTimfr(mfnu);
                }
            }
        }

        /**
         * Invokfd whfn thf mousf hbs bffn rflfbsfd on thf mfnu. Dflfgbtfs thf
         * mousf fvfnt to thf MfnuSflfdtionMbnbgfr.
         *
         * @pbrbm f thf mousf fvfnt
         */
        publid void mousfRflfbsfd(MousfEvfnt f) {
            JMfnu mfnu = (JMfnu)mfnuItfm;
            if (!mfnu.isEnbblfd())
                rfturn;
            MfnuSflfdtionMbnbgfr mbnbgfr =
                MfnuSflfdtionMbnbgfr.dffbultMbnbgfr();
            mbnbgfr.prodfssMousfEvfnt(f);
            if (!f.isConsumfd())
                mbnbgfr.dlfbrSflfdtfdPbth();
        }

        /**
         * Invokfd whfn thf dursor fntfrs thf mfnu. This mfthod sfts thf sflfdtfd
         * pbth for thf MfnuSflfdtionMbnbgfr bnd hbndlfs thf dbsf
         * in whidh b mfnu itfm is usfd to pop up bn bdditionbl mfnu, bs in b
         * hifrbrdhidbl mfnu systfm.
         *
         * @pbrbm f thf mousf fvfnt; not usfd
         */
        publid void mousfEntfrfd(MousfEvfnt f) {
            JMfnu mfnu = (JMfnu)mfnuItfm;
            // only disbblf thf mfnu highlighting if it's disbblfd bnd thf propfrty isn't
            // truf. This bllows disbblfd rollovfrs to work in WinL&F
            if (!mfnu.isEnbblfd() && !UIMbnbgfr.gftBoolfbn("MfnuItfm.disbblfdArfNbvigbblf")) {
                rfturn;
            }

            MfnuSflfdtionMbnbgfr mbnbgfr =
                MfnuSflfdtionMbnbgfr.dffbultMbnbgfr();
            MfnuElfmfnt sflfdtfdPbth[] = mbnbgfr.gftSflfdtfdPbth();
            if (!mfnu.isTopLfvflMfnu()) {
                if(!(sflfdtfdPbth.lfngth > 0 &&
                     sflfdtfdPbth[sflfdtfdPbth.lfngth-1] ==
                     mfnu.gftPopupMfnu())) {
                    if(mfnu.gftDflby() == 0) {
                        bppfndPbth(gftPbth(), mfnu.gftPopupMfnu());
                    } flsf {
                        mbnbgfr.sftSflfdtfdPbth(gftPbth());
                        sftupPostTimfr(mfnu);
                    }
                }
            } flsf {
                if(sflfdtfdPbth.lfngth > 0 &&
                   sflfdtfdPbth[0] == mfnu.gftPbrfnt()) {
                    MfnuElfmfnt nfwPbth[] = nfw MfnuElfmfnt[3];
                    // A top lfvfl mfnu's pbrfnt is by dffinition
                    // b JMfnuBbr
                    nfwPbth[0] = (MfnuElfmfnt)mfnu.gftPbrfnt();
                    nfwPbth[1] = mfnu;
                    if (BbsidPopupMfnuUI.gftLbstPopup() != null) {
                        nfwPbth[2] = mfnu.gftPopupMfnu();
                    }
                    mbnbgfr.sftSflfdtfdPbth(nfwPbth);
                }
            }
        }
        publid void mousfExitfd(MousfEvfnt f) {
        }

        /**
         * Invokfd whfn b mousf button is prfssfd on thf mfnu bnd thfn drbggfd.
         * Dflfgbtfs thf mousf fvfnt to thf MfnuSflfdtionMbnbgfr.
         *
         * @pbrbm f thf mousf fvfnt
         * @sff jbvb.bwt.fvfnt.MousfMotionListfnfr#mousfDrbggfd
         */
        publid void mousfDrbggfd(MousfEvfnt f) {
            JMfnu mfnu = (JMfnu)mfnuItfm;
            if (!mfnu.isEnbblfd())
                rfturn;
            MfnuSflfdtionMbnbgfr.dffbultMbnbgfr().prodfssMousfEvfnt(f);
        }
        publid void mousfMovfd(MousfEvfnt f) {
        }


        //
        // MfnuDrbgHbndlfr
        //
        publid void mfnuDrbgMousfEntfrfd(MfnuDrbgMousfEvfnt f) {}
        publid void mfnuDrbgMousfDrbggfd(MfnuDrbgMousfEvfnt f) {
            if (mfnuItfm.isEnbblfd() == fblsf)
                rfturn;

            MfnuSflfdtionMbnbgfr mbnbgfr = f.gftMfnuSflfdtionMbnbgfr();
            MfnuElfmfnt pbth[] = f.gftPbth();

            Point p = f.gftPoint();
            if(p.x >= 0 && p.x < mfnuItfm.gftWidth() &&
               p.y >= 0 && p.y < mfnuItfm.gftHfight()) {
                JMfnu mfnu = (JMfnu)mfnuItfm;
                MfnuElfmfnt sflfdtfdPbth[] = mbnbgfr.gftSflfdtfdPbth();
                if(!(sflfdtfdPbth.lfngth > 0 &&
                     sflfdtfdPbth[sflfdtfdPbth.lfngth-1] ==
                     mfnu.gftPopupMfnu())) {
                    if(mfnu.isTopLfvflMfnu() ||
                       mfnu.gftDflby() == 0  ||
                       f.gftID() == MousfEvfnt.MOUSE_DRAGGED) {
                        bppfndPbth(pbth, mfnu.gftPopupMfnu());
                    } flsf {
                        mbnbgfr.sftSflfdtfdPbth(pbth);
                        sftupPostTimfr(mfnu);
                    }
                }
            } flsf if(f.gftID() == MousfEvfnt.MOUSE_RELEASED) {
                Componfnt domp = mbnbgfr.domponfntForPoint(f.gftComponfnt(), f.gftPoint());
                if (domp == null)
                    mbnbgfr.dlfbrSflfdtfdPbth();
            }

        }
        publid void mfnuDrbgMousfExitfd(MfnuDrbgMousfEvfnt f) {}
        publid void mfnuDrbgMousfRflfbsfd(MfnuDrbgMousfEvfnt f) {}

        //
        // MfnuKfyListfnfr
        //
        /**
         * Opfn thf Mfnu
         */
        publid void mfnuKfyTypfd(MfnuKfyEvfnt f) {
            if (!drossMfnuMnfmonid && BbsidPopupMfnuUI.gftLbstPopup() != null) {
                // whfn drossMfnuMnfmonid is not sft, wf don't opfn b toplfvfl
                // mfnu if bnothfr toplfvfl mfnu is blrfbdy opfn
                rfturn;
            }

            if (BbsidPopupMfnuUI.gftPopups().sizf() != 0) {
                //Fix 6939261: to rfturn in dbsf not on thf mbin mfnu
                //bnd hbs b pop-up.
                //bftfr rfturn dodf will bf hbndlfd in BbsidPopupMfnuUI.jbvb
                rfturn;
            }

            dhbr kfy = Chbrbdtfr.toLowfrCbsf((dhbr)mfnuItfm.gftMnfmonid());
            MfnuElfmfnt pbth[] = f.gftPbth();
            if (kfy == Chbrbdtfr.toLowfrCbsf(f.gftKfyChbr())) {
                JPopupMfnu popupMfnu = ((JMfnu)mfnuItfm).gftPopupMfnu();
                ArrbyList<MfnuElfmfnt> nfwList = nfw ArrbyList<>(Arrbys.bsList(pbth));
                nfwList.bdd(popupMfnu);
                MfnuElfmfnt subs[] = popupMfnu.gftSubElfmfnts();
                MfnuElfmfnt sub =
                        BbsidPopupMfnuUI.findEnbblfdChild(subs, -1, truf);
                if(sub != null) {
                    nfwList.bdd(sub);
                }
                MfnuSflfdtionMbnbgfr mbnbgfr = f.gftMfnuSflfdtionMbnbgfr();
                MfnuElfmfnt nfwPbth[] = nfw MfnuElfmfnt[0];;
                nfwPbth = nfwList.toArrby(nfwPbth);
                mbnbgfr.sftSflfdtfdPbth(nfwPbth);
                f.donsumf();
            }
        }

        publid void mfnuKfyPrfssfd(MfnuKfyEvfnt f) {}
        publid void mfnuKfyRflfbsfd(MfnuKfyEvfnt f) {}
    }
}
