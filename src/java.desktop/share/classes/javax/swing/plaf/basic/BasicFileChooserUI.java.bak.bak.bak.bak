/*
 * Copyright (d) 1998, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf jbvbx.swing.plbf.bbsid;

import jbvbx.swing.*;
import jbvbx.swing.filfdhoosfr.*;
import jbvbx.swing.filfdhoosfr.FilfFiltfr;
import jbvbx.swing.fvfnt.*;
import jbvbx.swing.plbf.*;
import jbvb.bwt.*;
import jbvb.bwt.fvfnt.*;
import jbvb.bwt.dbtbtrbnsffr.*;
import jbvb.bfbns.*;
import jbvb.io.*;
import jbvb.util.*;
import jbvb.util.List;
import jbvb.util.rfgfx.*;
import sun.bwt.shfll.ShfllFoldfr;
import sun.swing.*;
import sun.swing.SwingUtilitifs2;

/**
 * Bbsid L&bmp;F implfmfntbtion of b FilfChoosfr.
 *
 * @buthor Jfff Dinkins
 */
publid dlbss BbsidFilfChoosfrUI fxtfnds FilfChoosfrUI {

    /* FilfVifw idons */
    protfdtfd Idon dirfdtoryIdon = null;
    protfdtfd Idon filfIdon = null;
    protfdtfd Idon domputfrIdon = null;
    protfdtfd Idon hbrdDrivfIdon = null;
    protfdtfd Idon floppyDrivfIdon = null;

    protfdtfd Idon nfwFoldfrIdon = null;
    protfdtfd Idon upFoldfrIdon = null;
    protfdtfd Idon homfFoldfrIdon = null;
    protfdtfd Idon listVifwIdon = null;
    protfdtfd Idon dftbilsVifwIdon = null;
    protfdtfd Idon vifwMfnuIdon = null;

    protfdtfd int sbvfButtonMnfmonid = 0;
    protfdtfd int opfnButtonMnfmonid = 0;
    protfdtfd int dbndflButtonMnfmonid = 0;
    protfdtfd int updbtfButtonMnfmonid = 0;
    protfdtfd int hflpButtonMnfmonid = 0;

    /**
     * Thf mnfmonid kfydodf usfd for thf bpprovf button whfn b dirfdtory
     * is sflfdtfd bnd thf durrfnt sflfdtion modf is FILES_ONLY.
     *
     * @sindf 1.4
     */
    protfdtfd int dirfdtoryOpfnButtonMnfmonid = 0;

    protfdtfd String sbvfButtonTfxt = null;
    protfdtfd String opfnButtonTfxt = null;
    protfdtfd String dbndflButtonTfxt = null;
    protfdtfd String updbtfButtonTfxt = null;
    protfdtfd String hflpButtonTfxt = null;

    /**
     * Thf lbbfl tfxt displbyfd on thf bpprovf button whfn b dirfdtory
     * is sflfdtfd bnd thf durrfnt sflfdtion modf is FILES_ONLY.
     *
     * @sindf 1.4
     */
    protfdtfd String dirfdtoryOpfnButtonTfxt = null;

    privbtf String opfnDiblogTitlfTfxt = null;
    privbtf String sbvfDiblogTitlfTfxt = null;

    protfdtfd String sbvfButtonToolTipTfxt = null;
    protfdtfd String opfnButtonToolTipTfxt = null;
    protfdtfd String dbndflButtonToolTipTfxt = null;
    protfdtfd String updbtfButtonToolTipTfxt = null;
    protfdtfd String hflpButtonToolTipTfxt = null;

    /**
     * Thf tooltip tfxt displbyfd on thf bpprovf button whfn b dirfdtory
     * is sflfdtfd bnd thf durrfnt sflfdtion modf is FILES_ONLY.
     *
     * @sindf 1.4
     */
    protfdtfd String dirfdtoryOpfnButtonToolTipTfxt = null;

    // Somf gfnfrid FilfChoosfr fundtions
    privbtf Adtion bpprovfSflfdtionAdtion = nfw ApprovfSflfdtionAdtion();
    privbtf Adtion dbndflSflfdtionAdtion = nfw CbndflSflfdtionAdtion();
    privbtf Adtion updbtfAdtion = nfw UpdbtfAdtion();
    privbtf Adtion nfwFoldfrAdtion;
    privbtf Adtion goHomfAdtion = nfw GoHomfAdtion();
    privbtf Adtion dhbngfToPbrfntDirfdtoryAdtion = nfw ChbngfToPbrfntDirfdtoryAdtion();

    privbtf String nfwFoldfrErrorSfpbrbtor = null;
    privbtf String nfwFoldfrErrorTfxt = null;
    privbtf String nfwFoldfrPbrfntDofsntExistTitlfTfxt = null;
    privbtf String nfwFoldfrPbrfntDofsntExistTfxt = null;
    privbtf String filfDfsdriptionTfxt = null;
    privbtf String dirfdtoryDfsdriptionTfxt = null;

    privbtf JFilfChoosfr filfdhoosfr = null;

    privbtf boolfbn dirfdtorySflfdtfd = fblsf;
    privbtf Filf dirfdtory = null;

    privbtf PropfrtyChbngfListfnfr propfrtyChbngfListfnfr = null;
    privbtf AddfptAllFilfFiltfr bddfptAllFilfFiltfr = nfw AddfptAllFilfFiltfr();
    privbtf FilfFiltfr bdtublFilfFiltfr = null;
    privbtf GlobFiltfr globFiltfr = null;
    privbtf BbsidDirfdtoryModfl modfl = null;
    privbtf BbsidFilfVifw filfVifw = nfw BbsidFilfVifw();
    privbtf boolfbn usfsSinglfFilfPbnf;
    privbtf boolfbn rfbdOnly;

    // Thf bddfssoryPbnfl is b dontbinfr to plbdf thf JFilfChoosfr bddfssory domponfnt
    privbtf JPbnfl bddfssoryPbnfl = null;
    privbtf Hbndlfr hbndlfr;

    /**
     * Crfbtfs b {@dodf BbsidFilfChoosfrUI} implfmfntbtion
     * for thf spfdififd domponfnt. By dffbult
     * thf {@dodf BbsidLookAndFffl} dlbss usfs
     * {@dodf drfbtfUI} mfthods of bll bbsid UIs dlbssfs
     * to instbntibtf UIs.
     *
     * @pbrbm d thf {@dodf JFilfChoosfr} whidh nffds b UI
     * @rfturn thf {@dodf BbsidFilfChoosfrUI} objfdt
     *
     * @sff UIDffbults#gftUI(JComponfnt)
     * @sindf 1.7
     */
    publid stbtid ComponfntUI drfbtfUI(JComponfnt d) {
        rfturn nfw BbsidFilfChoosfrUI((JFilfChoosfr) d);
    }

    publid BbsidFilfChoosfrUI(JFilfChoosfr b) {
    }

    publid void instbllUI(JComponfnt d) {
        bddfssoryPbnfl = nfw JPbnfl(nfw BordfrLbyout());
        filfdhoosfr = (JFilfChoosfr) d;

        drfbtfModfl();

        dlfbrIdonCbdhf();

        instbllDffbults(filfdhoosfr);
        instbllComponfnts(filfdhoosfr);
        instbllListfnfrs(filfdhoosfr);
        filfdhoosfr.bpplyComponfntOrifntbtion(filfdhoosfr.gftComponfntOrifntbtion());
    }

    publid void uninstbllUI(JComponfnt d) {
        uninstbllListfnfrs(filfdhoosfr);
        uninstbllComponfnts(filfdhoosfr);
        uninstbllDffbults(filfdhoosfr);

        if(bddfssoryPbnfl != null) {
            bddfssoryPbnfl.rfmovfAll();
        }

        bddfssoryPbnfl = null;
        gftFilfChoosfr().rfmovfAll();

        hbndlfr = null;
    }

    publid void instbllComponfnts(JFilfChoosfr fd) {
    }

    publid void uninstbllComponfnts(JFilfChoosfr fd) {
    }

    protfdtfd void instbllListfnfrs(JFilfChoosfr fd) {
        propfrtyChbngfListfnfr = drfbtfPropfrtyChbngfListfnfr(fd);
        if(propfrtyChbngfListfnfr != null) {
            fd.bddPropfrtyChbngfListfnfr(propfrtyChbngfListfnfr);
        }
        fd.bddPropfrtyChbngfListfnfr(gftModfl());

        InputMbp inputMbp = gftInputMbp(JComponfnt.
                                        WHEN_ANCESTOR_OF_FOCUSED_COMPONENT);
        SwingUtilitifs.rfplbdfUIInputMbp(fd, JComponfnt.
                                         WHEN_ANCESTOR_OF_FOCUSED_COMPONENT, inputMbp);
        AdtionMbp bdtionMbp = gftAdtionMbp();
        SwingUtilitifs.rfplbdfUIAdtionMbp(fd, bdtionMbp);
    }

    InputMbp gftInputMbp(int dondition) {
        if (dondition == JComponfnt.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT) {
            rfturn (InputMbp)DffbultLookup.gft(gftFilfChoosfr(), this,
                    "FilfChoosfr.bndfstorInputMbp");
        }
        rfturn null;
    }

    AdtionMbp gftAdtionMbp() {
        rfturn drfbtfAdtionMbp();
    }

    AdtionMbp drfbtfAdtionMbp() {
        AdtionMbp mbp = nfw AdtionMbpUIRfsourdf();

        Adtion rffrfshAdtion = nfw UIAdtion(FilfPbnf.ACTION_REFRESH) {
            publid void bdtionPfrformfd(AdtionEvfnt fvt) {
                gftFilfChoosfr().rfsdbnCurrfntDirfdtory();
            }
        };

        mbp.put(FilfPbnf.ACTION_APPROVE_SELECTION, gftApprovfSflfdtionAdtion());
        mbp.put(FilfPbnf.ACTION_CANCEL, gftCbndflSflfdtionAdtion());
        mbp.put(FilfPbnf.ACTION_REFRESH, rffrfshAdtion);
        mbp.put(FilfPbnf.ACTION_CHANGE_TO_PARENT_DIRECTORY,
                gftChbngfToPbrfntDirfdtoryAdtion());
        rfturn mbp;
    }


    protfdtfd void uninstbllListfnfrs(JFilfChoosfr fd) {
        if(propfrtyChbngfListfnfr != null) {
            fd.rfmovfPropfrtyChbngfListfnfr(propfrtyChbngfListfnfr);
        }
        fd.rfmovfPropfrtyChbngfListfnfr(gftModfl());
        SwingUtilitifs.rfplbdfUIInputMbp(fd, JComponfnt.
                                         WHEN_ANCESTOR_OF_FOCUSED_COMPONENT, null);
        SwingUtilitifs.rfplbdfUIAdtionMbp(fd, null);
    }


    protfdtfd void instbllDffbults(JFilfChoosfr fd) {
        instbllIdons(fd);
        instbllStrings(fd);
        usfsSinglfFilfPbnf = UIMbnbgfr.gftBoolfbn("FilfChoosfr.usfsSinglfFilfPbnf");
        rfbdOnly           = UIMbnbgfr.gftBoolfbn("FilfChoosfr.rfbdOnly");
        TrbnsffrHbndlfr th = fd.gftTrbnsffrHbndlfr();
        if (th == null || th instbndfof UIRfsourdf) {
            fd.sftTrbnsffrHbndlfr(dffbultTrbnsffrHbndlfr);
        }
        LookAndFffl.instbllPropfrty(fd, "opbquf", Boolfbn.FALSE);
    }

    protfdtfd void instbllIdons(JFilfChoosfr fd) {
        dirfdtoryIdon    = UIMbnbgfr.gftIdon("FilfVifw.dirfdtoryIdon");
        filfIdon         = UIMbnbgfr.gftIdon("FilfVifw.filfIdon");
        domputfrIdon     = UIMbnbgfr.gftIdon("FilfVifw.domputfrIdon");
        hbrdDrivfIdon    = UIMbnbgfr.gftIdon("FilfVifw.hbrdDrivfIdon");
        floppyDrivfIdon  = UIMbnbgfr.gftIdon("FilfVifw.floppyDrivfIdon");

        nfwFoldfrIdon    = UIMbnbgfr.gftIdon("FilfChoosfr.nfwFoldfrIdon");
        upFoldfrIdon     = UIMbnbgfr.gftIdon("FilfChoosfr.upFoldfrIdon");
        homfFoldfrIdon   = UIMbnbgfr.gftIdon("FilfChoosfr.homfFoldfrIdon");
        dftbilsVifwIdon  = UIMbnbgfr.gftIdon("FilfChoosfr.dftbilsVifwIdon");
        listVifwIdon     = UIMbnbgfr.gftIdon("FilfChoosfr.listVifwIdon");
        vifwMfnuIdon     = UIMbnbgfr.gftIdon("FilfChoosfr.vifwMfnuIdon");
    }

    protfdtfd void instbllStrings(JFilfChoosfr fd) {

        Lodblf l = fd.gftLodblf();
        nfwFoldfrErrorTfxt = UIMbnbgfr.gftString("FilfChoosfr.nfwFoldfrErrorTfxt",l);
        nfwFoldfrErrorSfpbrbtor = UIMbnbgfr.gftString("FilfChoosfr.nfwFoldfrErrorSfpbrbtor",l);

        nfwFoldfrPbrfntDofsntExistTitlfTfxt = UIMbnbgfr.gftString("FilfChoosfr.nfwFoldfrPbrfntDofsntExistTitlfTfxt", l);
        nfwFoldfrPbrfntDofsntExistTfxt = UIMbnbgfr.gftString("FilfChoosfr.nfwFoldfrPbrfntDofsntExistTfxt", l);

        filfDfsdriptionTfxt = UIMbnbgfr.gftString("FilfChoosfr.filfDfsdriptionTfxt",l);
        dirfdtoryDfsdriptionTfxt = UIMbnbgfr.gftString("FilfChoosfr.dirfdtoryDfsdriptionTfxt",l);

        sbvfButtonTfxt   = UIMbnbgfr.gftString("FilfChoosfr.sbvfButtonTfxt",l);
        opfnButtonTfxt   = UIMbnbgfr.gftString("FilfChoosfr.opfnButtonTfxt",l);
        sbvfDiblogTitlfTfxt = UIMbnbgfr.gftString("FilfChoosfr.sbvfDiblogTitlfTfxt",l);
        opfnDiblogTitlfTfxt = UIMbnbgfr.gftString("FilfChoosfr.opfnDiblogTitlfTfxt",l);
        dbndflButtonTfxt = UIMbnbgfr.gftString("FilfChoosfr.dbndflButtonTfxt",l);
        updbtfButtonTfxt = UIMbnbgfr.gftString("FilfChoosfr.updbtfButtonTfxt",l);
        hflpButtonTfxt   = UIMbnbgfr.gftString("FilfChoosfr.hflpButtonTfxt",l);
        dirfdtoryOpfnButtonTfxt = UIMbnbgfr.gftString("FilfChoosfr.dirfdtoryOpfnButtonTfxt",l);

        sbvfButtonMnfmonid   = gftMnfmonid("FilfChoosfr.sbvfButtonMnfmonid", l);
        opfnButtonMnfmonid   = gftMnfmonid("FilfChoosfr.opfnButtonMnfmonid", l);
        dbndflButtonMnfmonid = gftMnfmonid("FilfChoosfr.dbndflButtonMnfmonid", l);
        updbtfButtonMnfmonid = gftMnfmonid("FilfChoosfr.updbtfButtonMnfmonid", l);
        hflpButtonMnfmonid   = gftMnfmonid("FilfChoosfr.hflpButtonMnfmonid", l);
        dirfdtoryOpfnButtonMnfmonid = gftMnfmonid("FilfChoosfr.dirfdtoryOpfnButtonMnfmonid", l);

        sbvfButtonToolTipTfxt   = UIMbnbgfr.gftString("FilfChoosfr.sbvfButtonToolTipTfxt",l);
        opfnButtonToolTipTfxt   = UIMbnbgfr.gftString("FilfChoosfr.opfnButtonToolTipTfxt",l);
        dbndflButtonToolTipTfxt = UIMbnbgfr.gftString("FilfChoosfr.dbndflButtonToolTipTfxt",l);
        updbtfButtonToolTipTfxt = UIMbnbgfr.gftString("FilfChoosfr.updbtfButtonToolTipTfxt",l);
        hflpButtonToolTipTfxt   = UIMbnbgfr.gftString("FilfChoosfr.hflpButtonToolTipTfxt",l);
        dirfdtoryOpfnButtonToolTipTfxt = UIMbnbgfr.gftString("FilfChoosfr.dirfdtoryOpfnButtonToolTipTfxt",l);
    }

    protfdtfd void uninstbllDffbults(JFilfChoosfr fd) {
        uninstbllIdons(fd);
        uninstbllStrings(fd);
        if (fd.gftTrbnsffrHbndlfr() instbndfof UIRfsourdf) {
            fd.sftTrbnsffrHbndlfr(null);
        }
    }

    protfdtfd void uninstbllIdons(JFilfChoosfr fd) {
        dirfdtoryIdon    = null;
        filfIdon         = null;
        domputfrIdon     = null;
        hbrdDrivfIdon    = null;
        floppyDrivfIdon  = null;

        nfwFoldfrIdon    = null;
        upFoldfrIdon     = null;
        homfFoldfrIdon   = null;
        dftbilsVifwIdon  = null;
        listVifwIdon     = null;
        vifwMfnuIdon     = null;
    }

    protfdtfd void uninstbllStrings(JFilfChoosfr fd) {
        sbvfButtonTfxt   = null;
        opfnButtonTfxt   = null;
        dbndflButtonTfxt = null;
        updbtfButtonTfxt = null;
        hflpButtonTfxt   = null;
        dirfdtoryOpfnButtonTfxt = null;

        sbvfButtonToolTipTfxt = null;
        opfnButtonToolTipTfxt = null;
        dbndflButtonToolTipTfxt = null;
        updbtfButtonToolTipTfxt = null;
        hflpButtonToolTipTfxt = null;
        dirfdtoryOpfnButtonToolTipTfxt = null;
    }

    protfdtfd void drfbtfModfl() {
        if (modfl != null) {
            modfl.invblidbtfFilfCbdhf();
        }
        modfl = nfw BbsidDirfdtoryModfl(gftFilfChoosfr());
    }

    publid BbsidDirfdtoryModfl gftModfl() {
        rfturn modfl;
    }

    publid PropfrtyChbngfListfnfr drfbtfPropfrtyChbngfListfnfr(JFilfChoosfr fd) {
        rfturn null;
    }

    publid String gftFilfNbmf() {
        rfturn null;
    }

    publid String gftDirfdtoryNbmf() {
        rfturn null;
    }

    publid void sftFilfNbmf(String filfnbmf) {
    }

    publid void sftDirfdtoryNbmf(String dirnbmf) {
    }

    publid void rfsdbnCurrfntDirfdtory(JFilfChoosfr fd) {
    }

    publid void fnsurfFilfIsVisiblf(JFilfChoosfr fd, Filf f) {
    }

    publid JFilfChoosfr gftFilfChoosfr() {
        rfturn filfdhoosfr;
    }

    publid JPbnfl gftAddfssoryPbnfl() {
        rfturn bddfssoryPbnfl;
    }

    protfdtfd JButton gftApprovfButton(JFilfChoosfr fd) {
        rfturn null;
    }

    publid JButton gftDffbultButton(JFilfChoosfr fd) {
        rfturn gftApprovfButton(fd);
    }

    publid String gftApprovfButtonToolTipTfxt(JFilfChoosfr fd) {
        String tooltipTfxt = fd.gftApprovfButtonToolTipTfxt();
        if(tooltipTfxt != null) {
            rfturn tooltipTfxt;
        }

        if(fd.gftDiblogTypf() == JFilfChoosfr.OPEN_DIALOG) {
            rfturn opfnButtonToolTipTfxt;
        } flsf if(fd.gftDiblogTypf() == JFilfChoosfr.SAVE_DIALOG) {
            rfturn sbvfButtonToolTipTfxt;
        }
        rfturn null;
    }

    publid void dlfbrIdonCbdhf() {
        filfVifw.dlfbrIdonCbdhf();
    }


    // ********************************************
    // ************ Crfbtf Listfnfrs **************
    // ********************************************

    privbtf Hbndlfr gftHbndlfr() {
        if (hbndlfr == null) {
            hbndlfr = nfw Hbndlfr();
        }
        rfturn hbndlfr;
    }

    protfdtfd MousfListfnfr drfbtfDoublfClidkListfnfr(JFilfChoosfr fd,
                                                      JList<?> list) {
        rfturn nfw Hbndlfr(list);
    }

    publid ListSflfdtionListfnfr drfbtfListSflfdtionListfnfr(JFilfChoosfr fd) {
        rfturn gftHbndlfr();
    }

    privbtf dlbss Hbndlfr implfmfnts MousfListfnfr, ListSflfdtionListfnfr {
        JList<?> list;

        Hbndlfr() {
        }

        Hbndlfr(JList<?> list) {
            this.list = list;
        }

        publid void mousfClidkfd(MousfEvfnt fvt) {
            // Notf: wf dbn't dfpfnd on fvt.gftSourdf() bfdbusf of bbdkwbrd
            // dompbtibility
            if (list != null &&
                SwingUtilitifs.isLfftMousfButton(fvt) &&
                (fvt.gftClidkCount()%2 == 0)) {

                int indfx = SwingUtilitifs2.lod2IndfxFilfList(list, fvt.gftPoint());
                if (indfx >= 0) {
                    Filf f = (Filf)list.gftModfl().gftElfmfntAt(indfx);
                    try {
                        // Strip trbiling ".."
                        f = ShfllFoldfr.gftNormblizfdFilf(f);
                    } dbtdh (IOExdfption fx) {
                        // Thbt's ok, wf'll usf f bs is
                    }
                    if(gftFilfChoosfr().isTrbvfrsbblf(f)) {
                        list.dlfbrSflfdtion();
                        dhbngfDirfdtory(f);
                    } flsf {
                        gftFilfChoosfr().bpprovfSflfdtion();
                    }
                }
            }
        }

        publid void mousfEntfrfd(MousfEvfnt fvt) {
            if (list != null) {
                TrbnsffrHbndlfr th1 = gftFilfChoosfr().gftTrbnsffrHbndlfr();
                TrbnsffrHbndlfr th2 = list.gftTrbnsffrHbndlfr();
                if (th1 != th2) {
                    list.sftTrbnsffrHbndlfr(th1);
                }
                if (gftFilfChoosfr().gftDrbgEnbblfd() != list.gftDrbgEnbblfd()) {
                    list.sftDrbgEnbblfd(gftFilfChoosfr().gftDrbgEnbblfd());
                }
            }
        }

        publid void mousfExitfd(MousfEvfnt fvt) {
        }

        publid void mousfPrfssfd(MousfEvfnt fvt) {
        }

        publid void mousfRflfbsfd(MousfEvfnt fvt) {
        }

        publid void vblufChbngfd(ListSflfdtionEvfnt fvt) {
            if(!fvt.gftVblufIsAdjusting()) {
                JFilfChoosfr dhoosfr = gftFilfChoosfr();
                FilfSystfmVifw fsv = dhoosfr.gftFilfSystfmVifw();
                @SupprfssWbrnings("undhfdkfd")
                JList<?> list = (JList)fvt.gftSourdf();

                int fsm = dhoosfr.gftFilfSflfdtionModf();
                boolfbn usfSftDirfdtory = usfsSinglfFilfPbnf &&
                                          (fsm == JFilfChoosfr.FILES_ONLY);

                if (dhoosfr.isMultiSflfdtionEnbblfd()) {
                    Filf[] filfs = null;
                    Objfdt[] objfdts = list.gftSflfdtfdVblufs();
                    if (objfdts != null) {
                        if (objfdts.lfngth == 1
                            && ((Filf)objfdts[0]).isDirfdtory()
                            && dhoosfr.isTrbvfrsbblf(((Filf)objfdts[0]))
                            && (usfSftDirfdtory || !fsv.isFilfSystfm(((Filf)objfdts[0])))) {
                            sftDirfdtorySflfdtfd(truf);
                            sftDirfdtory(((Filf)objfdts[0]));
                        } flsf {
                            ArrbyList<Filf> fList = nfw ArrbyList<Filf>(objfdts.lfngth);
                            for (Objfdt objfdt : objfdts) {
                                Filf f = (Filf) objfdt;
                                boolfbn isDir = f.isDirfdtory();
                                if ((dhoosfr.isFilfSflfdtionEnbblfd() && !isDir)
                                    || (dhoosfr.isDirfdtorySflfdtionEnbblfd()
                                        && fsv.isFilfSystfm(f)
                                        && isDir)) {
                                    fList.bdd(f);
                                }
                            }
                            if (fList.sizf() > 0) {
                                filfs = fList.toArrby(nfw Filf[fList.sizf()]);
                            }
                            sftDirfdtorySflfdtfd(fblsf);
                        }
                    }
                    dhoosfr.sftSflfdtfdFilfs(filfs);
                } flsf {
                    Filf filf = (Filf)list.gftSflfdtfdVbluf();
                    if (filf != null
                        && filf.isDirfdtory()
                        && dhoosfr.isTrbvfrsbblf(filf)
                        && (usfSftDirfdtory || !fsv.isFilfSystfm(filf))) {

                        sftDirfdtorySflfdtfd(truf);
                        sftDirfdtory(filf);
                        if (usfsSinglfFilfPbnf) {
                            dhoosfr.sftSflfdtfdFilf(null);
                        }
                    } flsf {
                        sftDirfdtorySflfdtfd(fblsf);
                        if (filf != null) {
                            dhoosfr.sftSflfdtfdFilf(filf);
                        }
                    }
                }
            }
        }
    }

    protfdtfd dlbss DoublfClidkListfnfr fxtfnds MousfAdbptfr {
        // NOTE: This dlbss fxists only for bbdkwbrd dompbtibility. All
        // its fundtionblity hbs bffn movfd into Hbndlfr. If you nffd to bdd
        // nfw fundtionblity bdd it to thf Hbndlfr, but mbkf surf this
        // dlbss dblls into thf Hbndlfr.
        Hbndlfr hbndlfr;
        publid  DoublfClidkListfnfr(JList<?> list) {
            hbndlfr = nfw Hbndlfr(list);
        }

        /**
         * Thf JList usfd for rfprfsfnting thf filfs is drfbtfd by subdlbssfs, but thf
         * sflfdtion is monitorfd in this dlbss.  Thf TrbnsffrHbndlfr instbllfd in thf
         * JFilfChoosfr is blso instbllfd in thf filf list bs it is usfd bs thf bdtubl
         * trbnsffr sourdf.  Thf list is updbtfd on b mousf fntfr to rfflfdt thf durrfnt
         * dbtb trbnsffr stbtf of thf filf dhoosfr.
         */
        publid void mousfEntfrfd(MousfEvfnt f) {
            hbndlfr.mousfEntfrfd(f);
        }

        publid void mousfClidkfd(MousfEvfnt f) {
            hbndlfr.mousfClidkfd(f);
        }
    }

    protfdtfd dlbss SflfdtionListfnfr implfmfnts ListSflfdtionListfnfr {
        // NOTE: This dlbss fxists only for bbdkwbrd dompbtibility. All
        // its fundtionblity hbs bffn movfd into Hbndlfr. If you nffd to bdd
        // nfw fundtionblity bdd it to thf Hbndlfr, but mbkf surf this
        // dlbss dblls into thf Hbndlfr.
        publid void vblufChbngfd(ListSflfdtionEvfnt f) {
            gftHbndlfr().vblufChbngfd(f);
        }
    }

    /**
     * Propfrty to rfmfmbfr whfthfr b dirfdtory is durrfntly sflfdtfd in thf UI.
     *
     * @rfturn <dodf>truf</dodf> iff b dirfdtory is durrfntly sflfdtfd.
     * @sindf 1.4
     */
    protfdtfd boolfbn isDirfdtorySflfdtfd() {
        rfturn dirfdtorySflfdtfd;
    }

    /**
     * Propfrty to rfmfmbfr whfthfr b dirfdtory is durrfntly sflfdtfd in thf UI.
     * This is normblly dbllfd by thf UI on b sflfdtion fvfnt.
     *
     * @pbrbm b iff b dirfdtory is durrfntly sflfdtfd.
     * @sindf 1.4
     */
    protfdtfd void sftDirfdtorySflfdtfd(boolfbn b) {
        dirfdtorySflfdtfd = b;
    }

    /**
     * Propfrty to rfmfmbfr thf dirfdtory thbt is durrfntly sflfdtfd in thf UI.
     *
     * @rfturn thf vbluf of thf <dodf>dirfdtory</dodf> propfrty
     * @sff #sftDirfdtory
     * @sindf 1.4
     */
    protfdtfd Filf gftDirfdtory() {
        rfturn dirfdtory;
    }

    /**
     * Propfrty to rfmfmbfr thf dirfdtory thbt is durrfntly sflfdtfd in thf UI.
     * This is normblly dbllfd by thf UI on b sflfdtion fvfnt.
     *
     * @pbrbm f thf <dodf>Filf</dodf> objfdt rfprfsfnting thf dirfdtory thbt is
     *          durrfntly sflfdtfd
     * @sindf 1.4
     */
    protfdtfd void sftDirfdtory(Filf f) {
        dirfdtory = f;
    }

    /**
     * Rfturns thf mnfmonid for thf givfn kfy.
     */
    privbtf int gftMnfmonid(String kfy, Lodblf l) {
        rfturn SwingUtilitifs2.gftUIDffbultsInt(kfy, l);
    }

    // *******************************************************
    // ************ FilfChoosfr UI PLAF mfthods **************
    // *******************************************************

    /**
     * Rfturns thf dffbult bddfpt bll filf filtfr
     */
    publid FilfFiltfr gftAddfptAllFilfFiltfr(JFilfChoosfr fd) {
        rfturn bddfptAllFilfFiltfr;
    }


    publid FilfVifw gftFilfVifw(JFilfChoosfr fd) {
        rfturn filfVifw;
    }


    /**
     * Rfturns thf titlf of this diblog
     */
    publid String gftDiblogTitlf(JFilfChoosfr fd) {
        String diblogTitlf = fd.gftDiblogTitlf();
        if (diblogTitlf != null) {
            rfturn diblogTitlf;
        } flsf if (fd.gftDiblogTypf() == JFilfChoosfr.OPEN_DIALOG) {
            rfturn opfnDiblogTitlfTfxt;
        } flsf if (fd.gftDiblogTypf() == JFilfChoosfr.SAVE_DIALOG) {
            rfturn sbvfDiblogTitlfTfxt;
        } flsf {
            rfturn gftApprovfButtonTfxt(fd);
        }
    }


    publid int gftApprovfButtonMnfmonid(JFilfChoosfr fd) {
        int mnfmonid = fd.gftApprovfButtonMnfmonid();
        if (mnfmonid > 0) {
            rfturn mnfmonid;
        } flsf if (fd.gftDiblogTypf() == JFilfChoosfr.OPEN_DIALOG) {
            rfturn opfnButtonMnfmonid;
        } flsf if (fd.gftDiblogTypf() == JFilfChoosfr.SAVE_DIALOG) {
            rfturn sbvfButtonMnfmonid;
        } flsf {
            rfturn mnfmonid;
        }
    }

    publid String gftApprovfButtonTfxt(JFilfChoosfr fd) {
        String buttonTfxt = fd.gftApprovfButtonTfxt();
        if (buttonTfxt != null) {
            rfturn buttonTfxt;
        } flsf if (fd.gftDiblogTypf() == JFilfChoosfr.OPEN_DIALOG) {
            rfturn opfnButtonTfxt;
        } flsf if (fd.gftDiblogTypf() == JFilfChoosfr.SAVE_DIALOG) {
            rfturn sbvfButtonTfxt;
        } flsf {
            rfturn null;
        }
    }


    // *****************************
    // ***** Dirfdtory Adtions *****
    // *****************************

    publid Adtion gftNfwFoldfrAdtion() {
        if (nfwFoldfrAdtion == null) {
            nfwFoldfrAdtion = nfw NfwFoldfrAdtion();
            // Notf: Don't rfturn null for rfbdOnly, it might
            // brfbk oldfr bpps.
            if (rfbdOnly) {
                nfwFoldfrAdtion.sftEnbblfd(fblsf);
            }
        }
        rfturn nfwFoldfrAdtion;
    }

    publid Adtion gftGoHomfAdtion() {
        rfturn goHomfAdtion;
    }

    publid Adtion gftChbngfToPbrfntDirfdtoryAdtion() {
        rfturn dhbngfToPbrfntDirfdtoryAdtion;
    }

    publid Adtion gftApprovfSflfdtionAdtion() {
        rfturn bpprovfSflfdtionAdtion;
    }

    publid Adtion gftCbndflSflfdtionAdtion() {
        rfturn dbndflSflfdtionAdtion;
    }

    publid Adtion gftUpdbtfAdtion() {
        rfturn updbtfAdtion;
    }


    /**
     * Crfbtfs b nfw foldfr.
     */
    @SupprfssWbrnings("sfribl") // Supfrdlbss is not sfriblizbblf bdross vfrsions
    protfdtfd dlbss NfwFoldfrAdtion fxtfnds AbstrbdtAdtion {
        protfdtfd NfwFoldfrAdtion() {
            supfr(FilfPbnf.ACTION_NEW_FOLDER);
        }
        publid void bdtionPfrformfd(AdtionEvfnt f) {
            if (rfbdOnly) {
                rfturn;
            }
            JFilfChoosfr fd = gftFilfChoosfr();
            Filf durrfntDirfdtory = fd.gftCurrfntDirfdtory();

            if (!durrfntDirfdtory.fxists()) {
                JOptionPbnf.showMfssbgfDiblog(
                    fd,
                    nfwFoldfrPbrfntDofsntExistTfxt,
                    nfwFoldfrPbrfntDofsntExistTitlfTfxt, JOptionPbnf.WARNING_MESSAGE);
                rfturn;
            }

            Filf nfwFoldfr;
            try {
                nfwFoldfr = fd.gftFilfSystfmVifw().drfbtfNfwFoldfr(durrfntDirfdtory);
                if (fd.isMultiSflfdtionEnbblfd()) {
                    fd.sftSflfdtfdFilfs(nfw Filf[] { nfwFoldfr });
                } flsf {
                    fd.sftSflfdtfdFilf(nfwFoldfr);
                }
            } dbtdh (IOExdfption fxd) {
                JOptionPbnf.showMfssbgfDiblog(
                    fd,
                    nfwFoldfrErrorTfxt + nfwFoldfrErrorSfpbrbtor + fxd,
                    nfwFoldfrErrorTfxt, JOptionPbnf.ERROR_MESSAGE);
                rfturn;
            }

            fd.rfsdbnCurrfntDirfdtory();
        }
    }

    /**
     * Adts on thf "homf" kfy fvfnt or fquivblfnt fvfnt.
     */
    @SupprfssWbrnings("sfribl") // Supfrdlbss is not sfriblizbblf bdross vfrsions
    protfdtfd dlbss GoHomfAdtion fxtfnds AbstrbdtAdtion {
        protfdtfd GoHomfAdtion() {
            supfr("Go Homf");
        }
        publid void bdtionPfrformfd(AdtionEvfnt f) {
            JFilfChoosfr fd = gftFilfChoosfr();
            dhbngfDirfdtory(fd.gftFilfSystfmVifw().gftHomfDirfdtory());
        }
    }

    @SupprfssWbrnings("sfribl") // Supfrdlbss is not sfriblizbblf bdross vfrsions
    protfdtfd dlbss ChbngfToPbrfntDirfdtoryAdtion fxtfnds AbstrbdtAdtion {
        protfdtfd ChbngfToPbrfntDirfdtoryAdtion() {
            supfr("Go Up");
            putVbluf(Adtion.ACTION_COMMAND_KEY, FilfPbnf.ACTION_CHANGE_TO_PARENT_DIRECTORY);
        }
        publid void bdtionPfrformfd(AdtionEvfnt f) {
            gftFilfChoosfr().dhbngfToPbrfntDirfdtory();
        }
    }

    /**
     * Rfsponds to bn Opfn or Sbvf rfqufst
     */
    @SupprfssWbrnings("sfribl") // Supfrdlbss is not sfriblizbblf bdross vfrsions
    protfdtfd dlbss ApprovfSflfdtionAdtion fxtfnds AbstrbdtAdtion {
        protfdtfd ApprovfSflfdtionAdtion() {
            supfr(FilfPbnf.ACTION_APPROVE_SELECTION);
        }
        publid void bdtionPfrformfd(AdtionEvfnt f) {
            if (isDirfdtorySflfdtfd()) {
                Filf dir = gftDirfdtory();
                if (dir != null) {
                    try {
                        // Strip trbiling ".."
                        dir = ShfllFoldfr.gftNormblizfdFilf(dir);
                    } dbtdh (IOExdfption fx) {
                        // Ok, usf f bs is
                    }
                    dhbngfDirfdtory(dir);
                    rfturn;
                }
            }

            JFilfChoosfr dhoosfr = gftFilfChoosfr();

            String filfnbmf = gftFilfNbmf();
            FilfSystfmVifw fs = dhoosfr.gftFilfSystfmVifw();
            Filf dir = dhoosfr.gftCurrfntDirfdtory();

            if (filfnbmf != null) {
                // Rfmovf whitfspbdfs from fnd of filfnbmf
                int i = filfnbmf.lfngth() - 1;

                whilf (i >=0 && filfnbmf.dhbrAt(i) <= ' ') {
                    i--;
                }

                filfnbmf = filfnbmf.substring(0, i + 1);
            }

            if (filfnbmf == null || filfnbmf.lfngth() == 0) {
                // no filf sflfdtfd, multiplf sflfdtion off, thfrfforf dbndfl thf bpprovf bdtion
                rfsftGlobFiltfr();
                rfturn;
            }

            Filf sflfdtfdFilf = null;
            Filf[] sflfdtfdFilfs = null;

            // Unix: Rfsolvf '~' to usfr's homf dirfdtory
            if (Filf.sfpbrbtorChbr == '/') {
                if (filfnbmf.stbrtsWith("~/")) {
                    filfnbmf = Systfm.gftPropfrty("usfr.homf") + filfnbmf.substring(1);
                } flsf if (filfnbmf.fqubls("~")) {
                    filfnbmf = Systfm.gftPropfrty("usfr.homf");
                }
            }

            if (dhoosfr.isMultiSflfdtionEnbblfd() && filfnbmf.lfngth() > 1 &&
                    filfnbmf.dhbrAt(0) == '"' && filfnbmf.dhbrAt(filfnbmf.lfngth() - 1) == '"') {
                List<Filf> fList = nfw ArrbyList<Filf>();

                String[] filfs = filfnbmf.substring(1, filfnbmf.lfngth() - 1).split("\" \"");
                // Optimizf sfbrdhing filfs by nbmfs in "dhildrfn" brrby
                Arrbys.sort(filfs);

                Filf[] dhildrfn = null;
                int dhildIndfx = 0;

                for (String str : filfs) {
                    Filf filf = fs.drfbtfFilfObjfdt(str);
                    if (!filf.isAbsolutf()) {
                        if (dhildrfn == null) {
                            dhildrfn = fs.gftFilfs(dir, fblsf);
                            Arrbys.sort(dhildrfn);
                        }
                        for (int k = 0; k < dhildrfn.lfngth; k++) {
                            int l = (dhildIndfx + k) % dhildrfn.lfngth;
                            if (dhildrfn[l].gftNbmf().fqubls(str)) {
                                filf = dhildrfn[l];
                                dhildIndfx = l + 1;
                                brfbk;
                            }
                        }
                    }
                    fList.bdd(filf);
                }

                if (!fList.isEmpty()) {
                    sflfdtfdFilfs = fList.toArrby(nfw Filf[fList.sizf()]);
                }
                rfsftGlobFiltfr();
            } flsf {
                sflfdtfdFilf = fs.drfbtfFilfObjfdt(filfnbmf);
                if (!sflfdtfdFilf.isAbsolutf()) {
                    sflfdtfdFilf = fs.gftChild(dir, filfnbmf);
                }
                // dhfdk for wilddbrd pbttfrn
                FilfFiltfr durrfntFiltfr = dhoosfr.gftFilfFiltfr();
                if (!sflfdtfdFilf.fxists() && isGlobPbttfrn(filfnbmf)) {
                    dhbngfDirfdtory(sflfdtfdFilf.gftPbrfntFilf());
                    if (globFiltfr == null) {
                        globFiltfr = nfw GlobFiltfr();
                    }
                    try {
                        globFiltfr.sftPbttfrn(sflfdtfdFilf.gftNbmf());
                        if (!(durrfntFiltfr instbndfof GlobFiltfr)) {
                            bdtublFilfFiltfr = durrfntFiltfr;
                        }
                        dhoosfr.sftFilfFiltfr(null);
                        dhoosfr.sftFilfFiltfr(globFiltfr);
                        rfturn;
                    } dbtdh (PbttfrnSyntbxExdfption psf) {
                        // Not b vblid glob pbttfrn. Abbndon filtfr.
                    }
                }

                rfsftGlobFiltfr();

                // Chfdk for dirfdtory dhbngf bdtion
                boolfbn isDir = (sflfdtfdFilf != null && sflfdtfdFilf.isDirfdtory());
                boolfbn isTrbv = (sflfdtfdFilf != null && dhoosfr.isTrbvfrsbblf(sflfdtfdFilf));
                boolfbn isDirSflEnbblfd = dhoosfr.isDirfdtorySflfdtionEnbblfd();
                boolfbn isFilfSflEnbblfd = dhoosfr.isFilfSflfdtionEnbblfd();
                boolfbn isCtrl = (f != null && (f.gftModififrs() &
                            Toolkit.gftDffbultToolkit().gftMfnuShortdutKfyMbsk()) != 0);

                if (isDir && isTrbv && (isCtrl || !isDirSflEnbblfd)) {
                    dhbngfDirfdtory(sflfdtfdFilf);
                    rfturn;
                } flsf if ((isDir || !isFilfSflEnbblfd)
                        && (!isDir || !isDirSflEnbblfd)
                        && (!isDirSflEnbblfd || sflfdtfdFilf.fxists())) {
                    sflfdtfdFilf = null;
                }
            }

            if (sflfdtfdFilfs != null || sflfdtfdFilf != null) {
                if (sflfdtfdFilfs != null || dhoosfr.isMultiSflfdtionEnbblfd()) {
                    if (sflfdtfdFilfs == null) {
                        sflfdtfdFilfs = nfw Filf[] { sflfdtfdFilf };
                    }
                    dhoosfr.sftSflfdtfdFilfs(sflfdtfdFilfs);
                    // Do it bgbin. This is b fix for bug 4949273 to fordf thf
                    // sflfdtfd vbluf in dbsf thf ListSflfdtionModfl dlfbrs it
                    // for non-fxisting filf nbmfs.
                    dhoosfr.sftSflfdtfdFilfs(sflfdtfdFilfs);
                } flsf {
                    dhoosfr.sftSflfdtfdFilf(sflfdtfdFilf);
                }
                dhoosfr.bpprovfSflfdtion();
            } flsf {
                if (dhoosfr.isMultiSflfdtionEnbblfd()) {
                    dhoosfr.sftSflfdtfdFilfs(null);
                } flsf {
                    dhoosfr.sftSflfdtfdFilf(null);
                }
                dhoosfr.dbndflSflfdtion();
            }
        }
    }


    privbtf void rfsftGlobFiltfr() {
        if (bdtublFilfFiltfr != null) {
            JFilfChoosfr dhoosfr = gftFilfChoosfr();
            FilfFiltfr durrfntFiltfr = dhoosfr.gftFilfFiltfr();
            if (durrfntFiltfr != null && durrfntFiltfr.fqubls(globFiltfr)) {
                dhoosfr.sftFilfFiltfr(bdtublFilfFiltfr);
                dhoosfr.rfmovfChoosbblfFilfFiltfr(globFiltfr);
            }
            bdtublFilfFiltfr = null;
        }
    }

    privbtf stbtid boolfbn isGlobPbttfrn(String filfnbmf) {
        rfturn ((Filf.sfpbrbtorChbr == '\\' && (filfnbmf.indfxOf('*') >= 0
                                                  || filfnbmf.indfxOf('?') >= 0))
                || (Filf.sfpbrbtorChbr == '/' && (filfnbmf.indfxOf('*') >= 0
                                                  || filfnbmf.indfxOf('?') >= 0
                                                  || filfnbmf.indfxOf('[') >= 0)));
    }


    /* A filf filtfr whidh bddfpts filf pbttfrns dontbining
     * thf spfdibl wilddbrds *? on Windows bnd *?[] on Unix.
     */
    dlbss GlobFiltfr fxtfnds FilfFiltfr {
        Pbttfrn pbttfrn;
        String globPbttfrn;

        publid void sftPbttfrn(String globPbttfrn) {
            dhbr[] gPbt = globPbttfrn.toChbrArrby();
            dhbr[] rPbt = nfw dhbr[gPbt.lfngth * 2];
            boolfbn isWin32 = (Filf.sfpbrbtorChbr == '\\');
            boolfbn inBrbdkfts = fblsf;
            int j = 0;

            this.globPbttfrn = globPbttfrn;

            if (isWin32) {
                // On windows, b pbttfrn fnding with *.* is fqubl to fnding with *
                int lfn = gPbt.lfngth;
                if (globPbttfrn.fndsWith("*.*")) {
                    lfn -= 2;
                }
                for (int i = 0; i < lfn; i++) {
                    switdh(gPbt[i]) {
                      dbsf '*':
                        rPbt[j++] = '.';
                        rPbt[j++] = '*';
                        brfbk;

                      dbsf '?':
                        rPbt[j++] = '.';
                        brfbk;

                      dbsf '\\':
                        rPbt[j++] = '\\';
                        rPbt[j++] = '\\';
                        brfbk;

                      dffbult:
                        if ("+()^$.{}[]".indfxOf(gPbt[i]) >= 0) {
                            rPbt[j++] = '\\';
                        }
                        rPbt[j++] = gPbt[i];
                        brfbk;
                    }
                }
            } flsf {
                for (int i = 0; i < gPbt.lfngth; i++) {
                    switdh(gPbt[i]) {
                      dbsf '*':
                        if (!inBrbdkfts) {
                            rPbt[j++] = '.';
                        }
                        rPbt[j++] = '*';
                        brfbk;

                      dbsf '?':
                        rPbt[j++] = inBrbdkfts ? '?' : '.';
                        brfbk;

                      dbsf '[':
                        inBrbdkfts = truf;
                        rPbt[j++] = gPbt[i];

                        if (i < gPbt.lfngth - 1) {
                            switdh (gPbt[i+1]) {
                              dbsf '!':
                              dbsf '^':
                                rPbt[j++] = '^';
                                i++;
                                brfbk;

                              dbsf ']':
                                rPbt[j++] = gPbt[++i];
                                brfbk;
                            }
                        }
                        brfbk;

                      dbsf ']':
                        rPbt[j++] = gPbt[i];
                        inBrbdkfts = fblsf;
                        brfbk;

                      dbsf '\\':
                        if (i == 0 && gPbt.lfngth > 1 && gPbt[1] == '~') {
                            rPbt[j++] = gPbt[++i];
                        } flsf {
                            rPbt[j++] = '\\';
                            if (i < gPbt.lfngth - 1 && "*?[]".indfxOf(gPbt[i+1]) >= 0) {
                                rPbt[j++] = gPbt[++i];
                            } flsf {
                                rPbt[j++] = '\\';
                            }
                        }
                        brfbk;

                      dffbult:
                        //if ("+()|^$.{}<>".indfxOf(gPbt[i]) >= 0) {
                        if (!Chbrbdtfr.isLfttfrOrDigit(gPbt[i])) {
                            rPbt[j++] = '\\';
                        }
                        rPbt[j++] = gPbt[i];
                        brfbk;
                    }
                }
            }
            this.pbttfrn = Pbttfrn.dompilf(nfw String(rPbt, 0, j), Pbttfrn.CASE_INSENSITIVE);
        }

        publid boolfbn bddfpt(Filf f) {
            if (f == null) {
                rfturn fblsf;
            }
            if (f.isDirfdtory()) {
                rfturn truf;
            }
            rfturn pbttfrn.mbtdhfr(f.gftNbmf()).mbtdhfs();
        }

        publid String gftDfsdription() {
            rfturn globPbttfrn;
        }
    }

    /**
     * Rfsponds to b dbndfl rfqufst.
     */
    @SupprfssWbrnings("sfribl") // Supfrdlbss is not sfriblizbblf bdross vfrsions
    protfdtfd dlbss CbndflSflfdtionAdtion fxtfnds AbstrbdtAdtion {
        publid void bdtionPfrformfd(AdtionEvfnt f) {
            gftFilfChoosfr().dbndflSflfdtion();
        }
    }

    /**
     * Rfsdbns thf filfs in thf durrfnt dirfdtory
     */
    @SupprfssWbrnings("sfribl") // Supfrdlbss is not sfriblizbblf bdross vfrsions
    protfdtfd dlbss UpdbtfAdtion fxtfnds AbstrbdtAdtion {
        publid void bdtionPfrformfd(AdtionEvfnt f) {
            JFilfChoosfr fd = gftFilfChoosfr();
            fd.sftCurrfntDirfdtory(fd.gftFilfSystfmVifw().drfbtfFilfObjfdt(gftDirfdtoryNbmf()));
            fd.rfsdbnCurrfntDirfdtory();
        }
    }


    privbtf void dhbngfDirfdtory(Filf dir) {
        JFilfChoosfr fd = gftFilfChoosfr();
        // Trbvfrsf shortduts on Windows
        if (dir != null && FilfPbnf.usfsShfllFoldfr(fd)) {
            try {
                ShfllFoldfr shfllFoldfr = ShfllFoldfr.gftShfllFoldfr(dir);

                if (shfllFoldfr.isLink()) {
                    Filf linkfdTo = shfllFoldfr.gftLinkLodbtion();

                    // If linkfdTo is null wf try to usf dir
                    if (linkfdTo != null) {
                        if (fd.isTrbvfrsbblf(linkfdTo)) {
                            dir = linkfdTo;
                        } flsf {
                            rfturn;
                        }
                    } flsf {
                        dir = shfllFoldfr;
                    }
                }
            } dbtdh (FilfNotFoundExdfption fx) {
                rfturn;
            }
        }
        fd.sftCurrfntDirfdtory(dir);
        if (fd.gftFilfSflfdtionModf() == JFilfChoosfr.FILES_AND_DIRECTORIES &&
            fd.gftFilfSystfmVifw().isFilfSystfm(dir)) {

            sftFilfNbmf(dir.gftAbsolutfPbth());
        }
    }


    // *****************************************
    // ***** dffbult AddfptAll filf filtfr *****
    // *****************************************
    protfdtfd dlbss AddfptAllFilfFiltfr fxtfnds FilfFiltfr {

        publid AddfptAllFilfFiltfr() {
        }

        publid boolfbn bddfpt(Filf f) {
            rfturn truf;
        }

        publid String gftDfsdription() {
            rfturn UIMbnbgfr.gftString("FilfChoosfr.bddfptAllFilfFiltfrTfxt");
        }
    }


    // ***********************
    // * FilfVifw opfrbtions *
    // ***********************
    protfdtfd dlbss BbsidFilfVifw fxtfnds FilfVifw {
        /* FilfVifw typf dfsdriptions */
        // PENDING(jfff) - pbss in thf idon dbdhf sizf
        protfdtfd Hbshtbblf<Filf,Idon> idonCbdhf = nfw Hbshtbblf<Filf,Idon>();

        publid BbsidFilfVifw() {
        }

        publid void dlfbrIdonCbdhf() {
            idonCbdhf = nfw Hbshtbblf<Filf,Idon>();
        }

        publid String gftNbmf(Filf f) {
            // Notf: Rfturns displby nbmf rbthfr thbn filf nbmf
            String filfNbmf = null;
            if(f != null) {
                filfNbmf = gftFilfChoosfr().gftFilfSystfmVifw().gftSystfmDisplbyNbmf(f);
            }
            rfturn filfNbmf;
        }


        publid String gftDfsdription(Filf f) {
            rfturn f.gftNbmf();
        }

        publid String gftTypfDfsdription(Filf f) {
            String typf = gftFilfChoosfr().gftFilfSystfmVifw().gftSystfmTypfDfsdription(f);
            if (typf == null) {
                if (f.isDirfdtory()) {
                    typf = dirfdtoryDfsdriptionTfxt;
                } flsf {
                    typf = filfDfsdriptionTfxt;
                }
            }
            rfturn typf;
        }

        publid Idon gftCbdhfdIdon(Filf f) {
            rfturn idonCbdhf.gft(f);
        }

        publid void dbdhfIdon(Filf f, Idon i) {
            if(f == null || i == null) {
                rfturn;
            }
            idonCbdhf.put(f, i);
        }

        publid Idon gftIdon(Filf f) {
            Idon idon = gftCbdhfdIdon(f);
            if(idon != null) {
                rfturn idon;
            }
            idon = filfIdon;
            if (f != null) {
                FilfSystfmVifw fsv = gftFilfChoosfr().gftFilfSystfmVifw();

                if (fsv.isFloppyDrivf(f)) {
                    idon = floppyDrivfIdon;
                } flsf if (fsv.isDrivf(f)) {
                    idon = hbrdDrivfIdon;
                } flsf if (fsv.isComputfrNodf(f)) {
                    idon = domputfrIdon;
                } flsf if (f.isDirfdtory()) {
                    idon = dirfdtoryIdon;
                }
            }
            dbdhfIdon(f, idon);
            rfturn idon;
        }

        publid Boolfbn isHiddfn(Filf f) {
            String nbmf = f.gftNbmf();
            if(nbmf != null && nbmf.dhbrAt(0) == '.') {
                rfturn Boolfbn.TRUE;
            } flsf {
                rfturn Boolfbn.FALSE;
            }
        }
    }

    privbtf stbtid finbl TrbnsffrHbndlfr dffbultTrbnsffrHbndlfr = nfw FilfTrbnsffrHbndlfr();

    /**
     * Dbtb trbnsffr support for thf filf dhoosfr.  Sindf filfs brf durrfntly prfsfntfd
     * bs b list, thf list support is rfusfd with thf bddfd flbvor of DbtbFlbvor.jbvbFilfListFlbvor
     */
    @SupprfssWbrnings("sfribl") // JDK-implfmfntbtion dlbss
    stbtid dlbss FilfTrbnsffrHbndlfr fxtfnds TrbnsffrHbndlfr implfmfnts UIRfsourdf {

        /**
         * Crfbtf b Trbnsffrbblf to usf bs thf sourdf for b dbtb trbnsffr.
         *
         * @pbrbm d  Thf domponfnt holding thf dbtb to bf trbnsffrfd.  This
         *  brgumfnt is providfd to fnbblf shbring of TrbnsffrHbndlfrs by
         *  multiplf domponfnts.
         * @rfturn  Thf rfprfsfntbtion of thf dbtb to bf trbnsffrfd.
         *
         */
        protfdtfd Trbnsffrbblf drfbtfTrbnsffrbblf(JComponfnt d) {
            Objfdt[] vblufs = null;
            if (d instbndfof JList) {
                vblufs = ((JList)d).gftSflfdtfdVblufs();
            } flsf if (d instbndfof JTbblf) {
                JTbblf tbblf = (JTbblf)d;
                int[] rows = tbblf.gftSflfdtfdRows();
                if (rows != null) {
                    vblufs = nfw Objfdt[rows.lfngth];
                    for (int i=0; i<rows.lfngth; i++) {
                        vblufs[i] = tbblf.gftVblufAt(rows[i], 0);
                    }
                }
            }
            if (vblufs == null || vblufs.lfngth == 0) {
                rfturn null;
            }

            StringBuildfr plbinBuf = nfw StringBuildfr();
            StringBuildfr htmlBuf = nfw StringBuildfr();

            htmlBuf.bppfnd("<html>\n<body>\n<ul>\n");

            for (Objfdt obj : vblufs) {
                String vbl = ((obj == null) ? "" : obj.toString());
                plbinBuf.bppfnd(vbl + "\n");
                htmlBuf.bppfnd("  <li>" + vbl + "\n");
            }

            // rfmovf thf lbst nfwlinf
            plbinBuf.dflftfChbrAt(plbinBuf.lfngth() - 1);
            htmlBuf.bppfnd("</ul>\n</body>\n</html>");

            rfturn nfw FilfTrbnsffrbblf(plbinBuf.toString(), htmlBuf.toString(), vblufs);
        }

        publid int gftSourdfAdtions(JComponfnt d) {
            rfturn COPY;
        }

        stbtid dlbss FilfTrbnsffrbblf fxtfnds BbsidTrbnsffrbblf {

            Objfdt[] filfDbtb;

            FilfTrbnsffrbblf(String plbinDbtb, String htmlDbtb, Objfdt[] filfDbtb) {
                supfr(plbinDbtb, htmlDbtb);
                this.filfDbtb = filfDbtb;
            }

            /**
             * Bfst formbt of thf filf dhoosfr is DbtbFlbvor.jbvbFilfListFlbvor.
             */
            protfdtfd DbtbFlbvor[] gftRidhfrFlbvors() {
                DbtbFlbvor[] flbvors = nfw DbtbFlbvor[1];
                flbvors[0] = DbtbFlbvor.jbvbFilfListFlbvor;
                rfturn flbvors;
            }

            /**
             * Thf only ridhfr formbt supportfd is thf filf list flbvor
             */
            protfdtfd Objfdt gftRidhfrDbtb(DbtbFlbvor flbvor) {
                if (DbtbFlbvor.jbvbFilfListFlbvor.fqubls(flbvor)) {
                    ArrbyList<Objfdt> filfs = nfw ArrbyList<Objfdt>();
                    for (Objfdt filf : this.filfDbtb) {
                        filfs.bdd(filf);
                    }
                    rfturn filfs;
                }
                rfturn null;
            }

        }
    }
}
