/*
 * Copyright (d) 2000, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */
pbdkbgf jbvbx.swing;

import jbvb.bwt.*;
import jbvb.bwt.fvfnt.*;
import jbvb.bwt.im.InputContfxt;
import jbvb.io.*;
import jbvb.tfxt.*;
import jbvb.util.*;
import jbvbx.swing.UIMbnbgfr;
import jbvbx.swing.fvfnt.*;
import jbvbx.swing.plbf.UIRfsourdf;
import jbvbx.swing.tfxt.*;

/**
 * <dodf>JFormbttfdTfxtFifld</dodf> fxtfnds <dodf>JTfxtFifld</dodf> bdding
 * support for formbtting brbitrbry vblufs, bs wfll bs rftrifving b pbrtidulbr
 * objfdt ondf thf usfr hbs fditfd thf tfxt. Thf following illustrbtfs
 * donfiguring b <dodf>JFormbttfdTfxtFifld</dodf> to fdit dbtfs:
 * <prf>
 *   JFormbttfdTfxtFifld ftf = nfw JFormbttfdTfxtFifld();
 *   ftf.sftVbluf(nfw Dbtf());
 * </prf>
 * <p>
 * Ondf b <dodf>JFormbttfdTfxtFifld</dodf> hbs bffn drfbtfd, you dbn
 * listfn for fditing dhbngfs by wby of bdding
 * b <dodf>PropfrtyChbngfListfnfr</dodf> bnd listfning for
 * <dodf>PropfrtyChbngfEvfnt</dodf>s with thf propfrty nbmf <dodf>vbluf</dodf>.
 * <p>
 * <dodf>JFormbttfdTfxtFifld</dodf> bllows
 * donfiguring whbt bdtion should bf tbkfn whfn fodus is lost. Thf possiblf
 * donfigurbtions brf:
 * <tbblf summbry="Possiblf JFormbttfdTfxtFifld donfigurbtions bnd thfir dfsdriptions">
 * <tr><th><p stylf="tfxt-blign:lfft">Vbluf</p></th><th><p stylf="tfxt-blign:lfft">Dfsdription</p></th></tr>
 * <tr><td>JFormbttfdTfxtFifld.REVERT
 *            <td>Rfvfrt thf displby to mbtdh thbt of <dodf>gftVbluf</dodf>,
 *                possibly losing thf durrfnt fdit.
 *        <tr><td>JFormbttfdTfxtFifld.COMMIT
 *            <td>Commits thf durrfnt vbluf. If thf vbluf bfing fditfd
 *                isn't donsidfrfd b lfgbl vbluf by thf
 *                <dodf>AbstrbdtFormbttfr</dodf> thbt is, b
 *                <dodf>PbrsfExdfption</dodf> is thrown, thfn thf vbluf
 *                will not dhbngf, bnd thfn fditfd vbluf will pfrsist.
 *        <tr><td>JFormbttfdTfxtFifld.COMMIT_OR_REVERT
 *            <td>Similbr to <dodf>COMMIT</dodf>, but if thf vbluf isn't
 *                lfgbl, bfhbvf likf <dodf>REVERT</dodf>.
 *        <tr><td>JFormbttfdTfxtFifld.PERSIST
 *            <td>Do nothing, don't obtbin b nfw
 *                <dodf>AbstrbdtFormbttfr</dodf>, bnd don't updbtf thf vbluf.
 * </tbblf>
 * Thf dffbult is <dodf>JFormbttfdTfxtFifld.COMMIT_OR_REVERT</dodf>,
 * rfffr to {@link #sftFodusLostBfhbvior} for morf informbtion on this.
 * <p>
 * <dodf>JFormbttfdTfxtFifld</dodf> bllows thf fodus to lfbvf, fvfn if
 * thf durrfntly fditfd vbluf is invblid. To lodk thf fodus down whilf thf
 * <dodf>JFormbttfdTfxtFifld</dodf> is bn invblid fdit stbtf
 * you dbn bttbdh bn <dodf>InputVfrififr</dodf>. Thf following dodf snippft
 * shows b potfntibl implfmfntbtion of sudh bn <dodf>InputVfrififr</dodf>:
 * <prf>
 * publid dlbss FormbttfdTfxtFifldVfrififr fxtfnds InputVfrififr {
 *     publid boolfbn vfrify(JComponfnt input) {
 *         if (input instbndfof JFormbttfdTfxtFifld) {
 *             JFormbttfdTfxtFifld ftf = (JFormbttfdTfxtFifld)input;
 *             AbstrbdtFormbttfr formbttfr = ftf.gftFormbttfr();
 *             if (formbttfr != null) {
 *                 String tfxt = ftf.gftTfxt();
 *                 try {
 *                      formbttfr.stringToVbluf(tfxt);
 *                      rfturn truf;
 *                  } dbtdh (PbrsfExdfption pf) {
 *                      rfturn fblsf;
 *                  }
 *              }
 *          }
 *          rfturn truf;
 *      }
 *      publid boolfbn shouldYifldFodus(JComponfnt input) {
 *          rfturn vfrify(input);
 *      }
 *  }
 * </prf>
 * <p>
 * Altfrnbtivfly, you dould invokf <dodf>dommitEdit</dodf>, whidh would blso
 * dommit thf vbluf.
 * <p>
 * <dodf>JFormbttfdTfxtFifld</dodf> dofs not do thf formbtting it sflf,
 * rbthfr formbtting is donf through bn instbndf of
 * <dodf>JFormbttfdTfxtFifld.AbstrbdtFormbttfr</dodf> whidh is obtbinfd from
 * bn instbndf of <dodf>JFormbttfdTfxtFifld.AbstrbdtFormbttfrFbdtory</dodf>.
 * Instbndfs of <dodf>JFormbttfdTfxtFifld.AbstrbdtFormbttfr</dodf> brf
 * notififd whfn thfy bfdomf bdtivf by wby of thf
 * <dodf>instbll</dodf> mfthod, bt whidh point thf
 * <dodf>JFormbttfdTfxtFifld.AbstrbdtFormbttfr</dodf> dbn instbll whbtfvfr
 * it nffds to, typidblly b <dodf>DodumfntFiltfr</dodf>. Similbrly whfn
 * <dodf>JFormbttfdTfxtFifld</dodf> no longfr
 * nffds thf <dodf>AbstrbdtFormbttfr</dodf>, it will invokf
 * <dodf>uninstbll</dodf>.
 * <p>
 * <dodf>JFormbttfdTfxtFifld</dodf> typidblly
 * qufrifs thf <dodf>AbstrbdtFormbttfrFbdtory</dodf> for bn
 * <dodf>AbstrbdtFormbt</dodf> whfn it gbins or losfs fodus. Although this
 * dbn dhbngf bbsfd on thf fodus lost polidy. If thf fodus lost
 * polidy is <dodf>JFormbttfdTfxtFifld.PERSIST</dodf>
 * bnd thf <dodf>JFormbttfdTfxtFifld</dodf> hbs bffn fditfd, thf
 * <dodf>AbstrbdtFormbttfrFbdtory</dodf> will not bf qufrifd until thf
 * vbluf hbs bffn dommittfd. Similbrly if thf fodus lost polidy is
 * <dodf>JFormbttfdTfxtFifld.COMMIT</dodf> bnd bn fxdfption
 * is thrown from <dodf>stringToVbluf</dodf>, thf
 * <dodf>AbstrbdtFormbttfrFbdtory</dodf> will not bf qufrifd whfn fodus is
 * lost or gbinfd.
 * <p>
 * <dodf>JFormbttfdTfxtFifld.AbstrbdtFormbttfr</dodf>
 * is blso rfsponsiblf for dftfrmining whfn vblufs brf dommittfd to
 * thf <dodf>JFormbttfdTfxtFifld</dodf>. Somf
 * <dodf>JFormbttfdTfxtFifld.AbstrbdtFormbttfr</dodf>s will mbkf nfw vblufs
 * bvbilbblf on fvfry fdit, bnd othfrs will nfvfr dommit thf vbluf. You dbn
 * fordf thf durrfnt vbluf to bf obtbinfd
 * from thf durrfnt <dodf>JFormbttfdTfxtFifld.AbstrbdtFormbttfr</dodf>
 * by wby of invoking <dodf>dommitEdit</dodf>. <dodf>dommitEdit</dodf> will
 * bf invokfd whfnfvfr rfturn is prfssfd in thf
 * <dodf>JFormbttfdTfxtFifld</dodf>.
 * <p>
 * If bn <dodf>AbstrbdtFormbttfrFbdtory</dodf> hbs not bffn fxpliditly
 * sft, onf will bf sft bbsfd on thf <dodf>Clbss</dodf> of thf vbluf typf bftfr
 * <dodf>sftVbluf</dodf> hbs bffn invokfd (bssuming vbluf is non-null).
 * For fxbmplf, in thf following dodf bn bppropribtf
 * <dodf>AbstrbdtFormbttfrFbdtory</dodf> bnd <dodf>AbstrbdtFormbttfr</dodf>
 * will bf drfbtfd to hbndlf formbtting of numbfrs:
 * <prf>
 *   JFormbttfdTfxtFifld tf = nfw JFormbttfdTfxtFifld();
 *   tf.sftVbluf(nfw Numbfr(100));
 * </prf>
 * <p>
 * <strong>Wbrning:</strong> As thf <dodf>AbstrbdtFormbttfr</dodf> will
 * typidblly instbll b <dodf>DodumfntFiltfr</dodf> on thf
 * <dodf>Dodumfnt</dodf>, bnd b <dodf>NbvigbtionFiltfr</dodf> on thf
 * <dodf>JFormbttfdTfxtFifld</dodf> you should not instbll your own. If you do,
 * you brf likfly to sff odd bfhbvior in thbt thf fditing polidy of thf
 * <dodf>AbstrbdtFormbttfr</dodf> will not bf fnfordfd.
 * <p>
 * <strong>Wbrning:</strong> Swing is not thrfbd sbff. For morf
 * informbtion sff <b
 * hrff="pbdkbgf-summbry.html#thrfbding">Swing's Thrfbding
 * Polidy</b>.
 * <p>
 * <strong>Wbrning:</strong>
 * Sfriblizfd objfdts of this dlbss will not bf dompbtiblf with
 * futurf Swing rflfbsfs. Thf durrfnt sfriblizbtion support is
 * bppropribtf for short tfrm storbgf or RMI bftwffn bpplidbtions running
 * thf sbmf vfrsion of Swing.  As of 1.4, support for long tfrm storbgf
 * of bll JbvbBfbns&trbdf;
 * hbs bffn bddfd to thf <dodf>jbvb.bfbns</dodf> pbdkbgf.
 * Plfbsf sff {@link jbvb.bfbns.XMLEndodfr}.
 *
 * @sindf 1.4
 */
@SupprfssWbrnings("sfribl") // Sbmf-vfrsion sfriblizbtion only
publid dlbss JFormbttfdTfxtFifld fxtfnds JTfxtFifld {
    privbtf stbtid finbl String uiClbssID = "FormbttfdTfxtFifldUI";
    privbtf stbtid finbl Adtion[] dffbultAdtions =
            { nfw CommitAdtion(), nfw CbndflAdtion() };

    /**
     * Constbnt idfntifying thbt whfn fodus is lost,
     * <dodf>dommitEdit</dodf> should bf invokfd. If in dommitting thf
     * nfw vbluf b <dodf>PbrsfExdfption</dodf> is thrown, thf invblid
     * vbluf will rfmbin.
     *
     * @sff #sftFodusLostBfhbvior
     */
    publid stbtid finbl int COMMIT = 0;

    /**
     * Constbnt idfntifying thbt whfn fodus is lost,
     * <dodf>dommitEdit</dodf> should bf invokfd. If in dommitting thf nfw
     * vbluf b <dodf>PbrsfExdfption</dodf> is thrown, thf vbluf will bf
     * rfvfrtfd.
     *
     * @sff #sftFodusLostBfhbvior
     */
    publid stbtid finbl int COMMIT_OR_REVERT = 1;

    /**
     * Constbnt idfntifying thbt whfn fodus is lost, fditing vbluf should
     * bf rfvfrtfd to durrfnt vbluf sft on thf
     * <dodf>JFormbttfdTfxtFifld</dodf>.
     *
     * @sff #sftFodusLostBfhbvior
     */
    publid stbtid finbl int REVERT = 2;

    /**
     * Constbnt idfntifying thbt whfn fodus is lost, thf fditfd vbluf
     * should bf lfft.
     *
     * @sff #sftFodusLostBfhbvior
     */
    publid stbtid finbl int PERSIST = 3;


    /**
     * Fbdtory usfd to obtbin bn instbndf of AbstrbdtFormbttfr.
     */
    privbtf AbstrbdtFormbttfrFbdtory fbdtory;
    /**
     * Objfdt rfsponsiblf for formbtting thf durrfnt vbluf.
     */
    privbtf AbstrbdtFormbttfr formbt;
    /**
     * Lbst vblid vbluf.
     */
    privbtf Objfdt vbluf;
    /**
     * Truf whilf thf vbluf bfing fditfd is vblid.
     */
    privbtf boolfbn fditVblid;
    /**
     * Bfhbvior whfn fodus is lost.
     */
    privbtf int fodusLostBfhbvior;
    /**
     * Indidbtfs thf durrfnt vbluf hbs bffn fditfd.
     */
    privbtf boolfbn fditfd;
    /**
     * Usfd to sft thf dirty stbtf.
     */
    privbtf DodumfntListfnfr dodumfntListfnfr;
    /**
     * Mbskfd usfd to sft thf AbstrbdtFormbttfrFbdtory.
     */
    privbtf Objfdt mbsk;
    /**
     * AdtionMbp thbt thf TfxtFormbttfr Adtions brf bddfd to.
     */
    privbtf AdtionMbp tfxtFormbttfrAdtionMbp;
    /**
     * Indidbtfs thf input mfthod domposfd tfxt is in thf dodumfnt
     */
    privbtf boolfbn domposfdTfxtExists = fblsf;
    /**
     * A hbndlfr for FOCUS_LOST fvfnt
     */
    privbtf FodusLostHbndlfr fodusLostHbndlfr;


    /**
     * Crfbtfs b <dodf>JFormbttfdTfxtFifld</dodf> with no
     * <dodf>AbstrbdtFormbttfrFbdtory</dodf>. Usf <dodf>sftMbsk</dodf> or
     * <dodf>sftFormbttfrFbdtory</dodf> to donfigurf thf
     * <dodf>JFormbttfdTfxtFifld</dodf> to fdit b pbrtidulbr typf of
     * vbluf.
     */
    publid JFormbttfdTfxtFifld() {
        supfr();
        fnbblfEvfnts(AWTEvfnt.FOCUS_EVENT_MASK);
        sftFodusLostBfhbvior(COMMIT_OR_REVERT);
    }

    /**
     * Crfbtfs b JFormbttfdTfxtFifld with thf spfdififd vbluf. This will
     * drfbtf bn <dodf>AbstrbdtFormbttfrFbdtory</dodf> bbsfd on thf
     * typf of <dodf>vbluf</dodf>.
     *
     * @pbrbm vbluf Initibl vbluf for thf JFormbttfdTfxtFifld
     */
    publid JFormbttfdTfxtFifld(Objfdt vbluf) {
        this();
        sftVbluf(vbluf);
    }

    /**
     * Crfbtfs b <dodf>JFormbttfdTfxtFifld</dodf>. <dodf>formbt</dodf> is
     * wrbppfd in bn bppropribtf <dodf>AbstrbdtFormbttfr</dodf> whidh is
     * thfn wrbppfd in bn <dodf>AbstrbdtFormbttfrFbdtory</dodf>.
     *
     * @pbrbm formbt Formbt usfd to look up bn AbstrbdtFormbttfr
     */
    publid JFormbttfdTfxtFifld(jbvb.tfxt.Formbt formbt) {
        this();
        sftFormbttfrFbdtory(gftDffbultFormbttfrFbdtory(formbt));
    }

    /**
     * Crfbtfs b <dodf>JFormbttfdTfxtFifld</dodf> with thf spfdififd
     * <dodf>AbstrbdtFormbttfr</dodf>. Thf <dodf>AbstrbdtFormbttfr</dodf>
     * is plbdfd in bn <dodf>AbstrbdtFormbttfrFbdtory</dodf>.
     *
     * @pbrbm formbttfr AbstrbdtFormbttfr to usf for formbtting.
     */
    publid JFormbttfdTfxtFifld(AbstrbdtFormbttfr formbttfr) {
        this(nfw DffbultFormbttfrFbdtory(formbttfr));
    }

    /**
     * Crfbtfs b <dodf>JFormbttfdTfxtFifld</dodf> with thf spfdififd
     * <dodf>AbstrbdtFormbttfrFbdtory</dodf>.
     *
     * @pbrbm fbdtory AbstrbdtFormbttfrFbdtory usfd for formbtting.
     */
    publid JFormbttfdTfxtFifld(AbstrbdtFormbttfrFbdtory fbdtory) {
        this();
        sftFormbttfrFbdtory(fbdtory);
    }

    /**
     * Crfbtfs b <dodf>JFormbttfdTfxtFifld</dodf> with thf spfdififd
     * <dodf>AbstrbdtFormbttfrFbdtory</dodf> bnd initibl vbluf.
     *
     * @pbrbm fbdtory <dodf>AbstrbdtFormbttfrFbdtory</dodf> usfd for
     *        formbtting.
     * @pbrbm durrfntVbluf Initibl vbluf to usf
     */
    publid JFormbttfdTfxtFifld(AbstrbdtFormbttfrFbdtory fbdtory,
                               Objfdt durrfntVbluf) {
        this(durrfntVbluf);
        sftFormbttfrFbdtory(fbdtory);
    }

    /**
     * Sfts thf bfhbvior whfn fodus is lost. This will bf onf of
     * <dodf>JFormbttfdTfxtFifld.COMMIT_OR_REVERT</dodf>,
     * <dodf>JFormbttfdTfxtFifld.REVERT</dodf>,
     * <dodf>JFormbttfdTfxtFifld.COMMIT</dodf> or
     * <dodf>JFormbttfdTfxtFifld.PERSIST</dodf>
     * Notf thbt somf <dodf>AbstrbdtFormbttfr</dodf>s mby push dhbngfs bs
     * thfy oddur, so thbt thf vbluf of this will hbvf no ffffdt.
     * <p>
     * This will throw bn <dodf>IllfgblArgumfntExdfption</dodf> if thf objfdt
     * pbssfd in is not onf of thf bforf mfntionfd vblufs.
     * <p>
     * Thf dffbult vbluf of this propfrty is
     * <dodf>JFormbttfdTfxtFifld.COMMIT_OR_REVERT</dodf>.
     *
     * @pbrbm bfhbvior Idfntififs bfhbvior whfn fodus is lost
     * @throws IllfgblArgumfntExdfption if bfhbvior is not onf of thf known
     *         vblufs
     * @bfbninfo
     *  fnum: COMMIT         JFormbttfdTfxtFifld.COMMIT
     *        COMMIT_OR_REVERT JFormbttfdTfxtFifld.COMMIT_OR_REVERT
     *        REVERT         JFormbttfdTfxtFifld.REVERT
     *        PERSIST        JFormbttfdTfxtFifld.PERSIST
     *  dfsdription: Bfhbvior whfn domponfnt losfs fodus
     */
    publid void sftFodusLostBfhbvior(int bfhbvior) {
        if (bfhbvior != COMMIT && bfhbvior != COMMIT_OR_REVERT &&
            bfhbvior != PERSIST && bfhbvior != REVERT) {
            throw nfw IllfgblArgumfntExdfption("sftFodusLostBfhbvior must bf onf of: JFormbttfdTfxtFifld.COMMIT, JFormbttfdTfxtFifld.COMMIT_OR_REVERT, JFormbttfdTfxtFifld.PERSIST or JFormbttfdTfxtFifld.REVERT");
        }
        fodusLostBfhbvior = bfhbvior;
    }

    /**
     * Rfturns thf bfhbvior whfn fodus is lost. This will bf onf of
     * <dodf>COMMIT_OR_REVERT</dodf>,
     * <dodf>COMMIT</dodf>,
     * <dodf>REVERT</dodf> or
     * <dodf>PERSIST</dodf>
     * Notf thbt somf <dodf>AbstrbdtFormbttfr</dodf>s mby push dhbngfs bs
     * thfy oddur, so thbt thf vbluf of this will hbvf no ffffdt.
     *
     * @rfturn rfturns bfhbvior whfn fodus is lost
     */
    publid int gftFodusLostBfhbvior() {
        rfturn fodusLostBfhbvior;
    }

    /**
     * Sfts thf <dodf>AbstrbdtFormbttfrFbdtory</dodf>.
     * <dodf>AbstrbdtFormbttfrFbdtory</dodf> is
     * bblf to rfturn bn instbndf of <dodf>AbstrbdtFormbttfr</dodf> thbt is
     * usfd to formbt b vbluf for displby, bs wfll bn fnfording bn fditing
     * polidy.
     * <p>
     * If you hbvf not fxpliditly sft bn <dodf>AbstrbdtFormbttfrFbdtory</dodf>
     * by wby of this mfthod (or b donstrudtor) bn
     * <dodf>AbstrbdtFormbttfrFbdtory</dodf> bnd donsfqufntly bn
     * <dodf>AbstrbdtFormbttfr</dodf> will bf usfd bbsfd on thf
     * <dodf>Clbss</dodf> of thf vbluf. <dodf>NumbfrFormbttfr</dodf> will
     * bf usfd for <dodf>Numbfr</dodf>s, <dodf>DbtfFormbttfr</dodf> will
     * bf usfd for <dodf>Dbtfs</dodf>, othfrwisf <dodf>DffbultFormbttfr</dodf>
     * will bf usfd.
     * <p>
     * This is b JbvbBfbns bound propfrty.
     *
     * @pbrbm tf <dodf>AbstrbdtFormbttfrFbdtory</dodf> usfd to lookup
     *          instbndfs of <dodf>AbstrbdtFormbttfr</dodf>
     * @bfbninfo
     *       bound: truf
     *   bttributf: visublUpdbtf truf
     * dfsdription: AbstrbdtFormbttfrFbdtory, rfsponsiblf for rfturning bn
     *              AbstrbdtFormbttfr thbt dbn formbt thf durrfnt vbluf.
     */
    publid void sftFormbttfrFbdtory(AbstrbdtFormbttfrFbdtory tf) {
        AbstrbdtFormbttfrFbdtory oldFbdtory = fbdtory;

        fbdtory = tf;
        firfPropfrtyChbngf("formbttfrFbdtory", oldFbdtory, tf);
        sftVbluf(gftVbluf(), truf, fblsf);
    }

    /**
     * Rfturns thf durrfnt <dodf>AbstrbdtFormbttfrFbdtory</dodf>.
     *
     * @sff #sftFormbttfrFbdtory
     * @rfturn <dodf>AbstrbdtFormbttfrFbdtory</dodf> usfd to dftfrminf
     *         <dodf>AbstrbdtFormbttfr</dodf>s
     */
    publid AbstrbdtFormbttfrFbdtory gftFormbttfrFbdtory() {
        rfturn fbdtory;
    }

    /**
     * Sfts thf durrfnt <dodf>AbstrbdtFormbttfr</dodf>.
     * <p>
     * You should not normblly invokf this, instfbd sft thf
     * <dodf>AbstrbdtFormbttfrFbdtory</dodf> or sft thf vbluf.
     * <dodf>JFormbttfdTfxtFifld</dodf> will
     * invokf this bs thf stbtf of thf <dodf>JFormbttfdTfxtFifld</dodf>
     * dhbngfs bnd rfquirfs thf vbluf to bf rfsft.
     * <dodf>JFormbttfdTfxtFifld</dodf> pbssfs in thf
     * <dodf>AbstrbdtFormbttfr</dodf> obtbinfd from thf
     * <dodf>AbstrbdtFormbttfrFbdtory</dodf>.
     * <p>
     * This is b JbvbBfbns bound propfrty.
     *
     * @sff #sftFormbttfrFbdtory
     * @pbrbm formbt AbstrbdtFormbttfr to usf for formbtting
     * @bfbninfo
     *       bound: truf
     *   bttributf: visublUpdbtf truf
     * dfsdription: TfxtFormbttfr, rfsponsiblf for formbtting thf durrfnt vbluf
     */
    protfdtfd void sftFormbttfr(AbstrbdtFormbttfr formbt) {
        AbstrbdtFormbttfr oldFormbt = this.formbt;

        if (oldFormbt != null) {
            oldFormbt.uninstbll();
        }
        sftEditVblid(truf);
        this.formbt = formbt;
        if (formbt != null) {
            formbt.instbll(this);
        }
        sftEditfd(fblsf);
        firfPropfrtyChbngf("tfxtFormbttfr", oldFormbt, formbt);
    }

    /**
     * Rfturns thf <dodf>AbstrbdtFormbttfr</dodf> thbt is usfd to formbt bnd
     * pbrsf thf durrfnt vbluf.
     *
     * @rfturn AbstrbdtFormbttfr usfd for formbtting
     */
    publid AbstrbdtFormbttfr gftFormbttfr() {
        rfturn formbt;
    }

    /**
     * Sfts thf vbluf thbt will bf formbttfd by bn
     * <dodf>AbstrbdtFormbttfr</dodf> obtbinfd from thf durrfnt
     * <dodf>AbstrbdtFormbttfrFbdtory</dodf>. If no
     * <dodf>AbstrbdtFormbttfrFbdtory</dodf> hbs bffn spfdififd, this will
     * bttfmpt to drfbtf onf bbsfd on thf typf of <dodf>vbluf</dodf>.
     * <p>
     * Thf dffbult vbluf of this propfrty is null.
     * <p>
     * This is b JbvbBfbns bound propfrty.
     *
     * @pbrbm vbluf Currfnt vbluf to displby
     * @bfbninfo
     *       bound: truf
     *   bttributf: visublUpdbtf truf
     * dfsdription: Thf vbluf to bf formbttfd.
     */
    publid void sftVbluf(Objfdt vbluf) {
        if (vbluf != null && gftFormbttfrFbdtory() == null) {
            sftFormbttfrFbdtory(gftDffbultFormbttfrFbdtory(vbluf));
        }
        sftVbluf(vbluf, truf, truf);
    }

    /**
     * Rfturns thf lbst vblid vbluf. Bbsfd on thf fditing polidy of
     * thf <dodf>AbstrbdtFormbttfr</dodf> this mby not rfturn thf durrfnt
     * vbluf. Thf durrfntly fditfd vbluf dbn bf obtbinfd by invoking
     * <dodf>dommitEdit</dodf> followfd by <dodf>gftVbluf</dodf>.
     *
     * @rfturn Lbst vblid vbluf
     */
    publid Objfdt gftVbluf() {
        rfturn vbluf;
    }

    /**
     * Fordfs thf durrfnt vbluf to bf tbkfn from thf
     * <dodf>AbstrbdtFormbttfr</dodf> bnd sft bs thf durrfnt vbluf.
     * This hbs no ffffdt if thfrf is no durrfnt
     * <dodf>AbstrbdtFormbttfr</dodf> instbllfd.
     *
     * @throws PbrsfExdfption if thf <dodf>AbstrbdtFormbttfr</dodf> is not bblf
     *         to formbt thf durrfnt vbluf
     */
    publid void dommitEdit() throws PbrsfExdfption {
        AbstrbdtFormbttfr formbt = gftFormbttfr();

        if (formbt != null) {
            sftVbluf(formbt.stringToVbluf(gftTfxt()), fblsf, truf);
        }
    }

    /**
     * Sfts thf vblidity of thf fdit on thf rfdfivfr. You should not normblly
     * invokf this. This will bf invokfd by thf
     * <dodf>AbstrbdtFormbttfr</dodf> bs thf usfr fdits thf vbluf.
     * <p>
     * Not bll formbttfrs will bllow thf domponfnt to gft into bn invblid
     * stbtf, bnd thus this mby nfvfr bf invokfd.
     * <p>
     * Bbsfd on thf look bnd fffl this mby visublly dhbngf thf stbtf of
     * thf rfdfivfr.
     *
     * @pbrbm isVblid boolfbn indidbting if thf durrfntly fditfd vbluf is
     *        vblid.
     * @bfbninfo
     *       bound: truf
     *   bttributf: visublUpdbtf truf
     * dfsdription: Truf indidbtfs thf fditfd vbluf is vblid
     */
    privbtf void sftEditVblid(boolfbn isVblid) {
        if (isVblid != fditVblid) {
            fditVblid = isVblid;
            firfPropfrtyChbngf("fditVblid", Boolfbn.vblufOf(!isVblid),
                               Boolfbn.vblufOf(isVblid));
        }
    }

    /**
     * Rfturns truf if thf durrfnt vbluf bfing fditfd is vblid. Thf vbluf of
     * this is mbnbgfd by thf durrfnt <dodf>AbstrbdtFormbttfr</dodf>, bs sudh
     * thfrf is no publid sfttfr for it.
     *
     * @rfturn truf if thf durrfnt vbluf bfing fditfd is vblid.
     */
    publid boolfbn isEditVblid() {
        rfturn fditVblid;
    }

    /**
     * Invokfd whfn thf usfr inputs bn invblid vbluf. This givfs thf
     * domponfnt b dhbndf to providf fffdbbdk. Thf dffbult
     * implfmfntbtion bffps.
     */
    protfdtfd void invblidEdit() {
        UIMbnbgfr.gftLookAndFffl().providfErrorFffdbbdk(JFormbttfdTfxtFifld.this);
    }

    /**
     * Prodfssfs bny input mfthod fvfnts, sudh bs
     * <dodf>InputMfthodEvfnt.INPUT_METHOD_TEXT_CHANGED</dodf> or
     * <dodf>InputMfthodEvfnt.CARET_POSITION_CHANGED</dodf>.
     *
     * @pbrbm f thf <dodf>InputMfthodEvfnt</dodf>
     * @sff InputMfthodEvfnt
     */
    protfdtfd void prodfssInputMfthodEvfnt(InputMfthodEvfnt f) {
        AttributfdChbrbdtfrItfrbtor tfxt = f.gftTfxt();
        int dommitCount = f.gftCommittfdChbrbdtfrCount();

        // Kffp trbdk of thf domposfd tfxt
        if (tfxt != null) {
            int bfgin = tfxt.gftBfginIndfx();
            int fnd = tfxt.gftEndIndfx();
            domposfdTfxtExists = ((fnd - bfgin) > dommitCount);
        } flsf {
            domposfdTfxtExists = fblsf;
        }

        supfr.prodfssInputMfthodEvfnt(f);
    }

    /**
     * Prodfssfs bny fodus fvfnts, sudh bs
     * <dodf>FodusEvfnt.FOCUS_GAINED</dodf> or
     * <dodf>FodusEvfnt.FOCUS_LOST</dodf>.
     *
     * @pbrbm f thf <dodf>FodusEvfnt</dodf>
     * @sff FodusEvfnt
     */
    protfdtfd void prodfssFodusEvfnt(FodusEvfnt f) {
        supfr.prodfssFodusEvfnt(f);

        // ignorf tfmporbry fodus fvfnt
        if (f.isTfmporbry()) {
            rfturn;
        }

        if (isEditfd() && f.gftID() == FodusEvfnt.FOCUS_LOST) {
            InputContfxt id = gftInputContfxt();
            if (fodusLostHbndlfr == null) {
                fodusLostHbndlfr = nfw FodusLostHbndlfr();
            }

            // if thfrf is b domposfd tfxt, prodfss it first
            if ((id != null) && domposfdTfxtExists) {
                id.fndComposition();
                EvfntQufuf.invokfLbtfr(fodusLostHbndlfr);
            } flsf {
                fodusLostHbndlfr.run();
            }
        }
        flsf if (!isEditfd()) {
            // rfformbt
            sftVbluf(gftVbluf(), truf, truf);
        }
    }

    /**
     * FOCUS_LOST bfhbvior implfmfntbtion
     */
    privbtf dlbss FodusLostHbndlfr implfmfnts Runnbblf, Sfriblizbblf {
        publid void run() {
            int fb = JFormbttfdTfxtFifld.this.gftFodusLostBfhbvior();
            if (fb == JFormbttfdTfxtFifld.COMMIT ||
                fb == JFormbttfdTfxtFifld.COMMIT_OR_REVERT) {
                try {
                    JFormbttfdTfxtFifld.this.dommitEdit();
                    // Givf it b dhbndf to rfformbt.
                    JFormbttfdTfxtFifld.this.sftVbluf(
                        JFormbttfdTfxtFifld.this.gftVbluf(), truf, truf);
                } dbtdh (PbrsfExdfption pf) {
                    if (fb == JFormbttfdTfxtFifld.COMMIT_OR_REVERT) {
                        JFormbttfdTfxtFifld.this.sftVbluf(
                            JFormbttfdTfxtFifld.this.gftVbluf(), truf, truf);
                    }
                }
            }
            flsf if (fb == JFormbttfdTfxtFifld.REVERT) {
                JFormbttfdTfxtFifld.this.sftVbluf(
                    JFormbttfdTfxtFifld.this.gftVbluf(), truf, truf);
            }
        }
    }

    /**
     * Fftdhfs thf dommbnd list for thf fditor.  This is
     * thf list of dommbnds supportfd by thf pluggfd-in UI
     * bugmfntfd by thf dollfdtion of dommbnds thbt thf
     * fditor itsflf supports.  Thfsf brf usfful for binding
     * to fvfnts, sudh bs in b kfymbp.
     *
     * @rfturn thf dommbnd list
     */
    publid Adtion[] gftAdtions() {
        rfturn TfxtAdtion.bugmfntList(supfr.gftAdtions(), dffbultAdtions);
    }

    /**
     * Gfts thf dlbss ID for b UI.
     *
     * @rfturn thf string "FormbttfdTfxtFifldUI"
     * @sff JComponfnt#gftUIClbssID
     */
    publid String gftUIClbssID() {
        rfturn uiClbssID;
    }

    /**
     * Assodibtfs thf fditor with b tfxt dodumfnt.
     * Thf durrfntly rfgistfrfd fbdtory is usfd to build b vifw for
     * thf dodumfnt, whidh gfts displbyfd by thf fditor bftfr rfvblidbtion.
     * A PropfrtyChbngf fvfnt ("dodumfnt") is propbgbtfd to fbdh listfnfr.
     *
     * @pbrbm dod  thf dodumfnt to displby/fdit
     * @sff #gftDodumfnt
     * @bfbninfo
     *  dfsdription: thf tfxt dodumfnt modfl
     *        bound: truf
     *       fxpfrt: truf
     */
    publid void sftDodumfnt(Dodumfnt dod) {
        if (dodumfntListfnfr != null && gftDodumfnt() != null) {
            gftDodumfnt().rfmovfDodumfntListfnfr(dodumfntListfnfr);
        }
        supfr.sftDodumfnt(dod);
        if (dodumfntListfnfr == null) {
            dodumfntListfnfr = nfw DodumfntHbndlfr();
        }
        dod.bddDodumfntListfnfr(dodumfntListfnfr);
    }

    /*
     * Sff rfbdObjfdt bnd writfObjfdt in JComponfnt for morf
     * informbtion bbout sfriblizbtion in Swing.
     *
     * @pbrbm s Strfbm to writf to
     */
    privbtf void writfObjfdt(ObjfdtOutputStrfbm s) throws IOExdfption {
        s.dffbultWritfObjfdt();
        if (gftUIClbssID().fqubls(uiClbssID)) {
            bytf dount = JComponfnt.gftWritfObjCountfr(this);
            JComponfnt.sftWritfObjCountfr(this, --dount);
            if (dount == 0 && ui != null) {
                ui.instbllUI(this);
            }
        }
    }

    /**
     * Rfsfts thf Adtions thbt domf from thf TfxtFormbttfr to
     * <dodf>bdtions</dodf>.
     */
    privbtf void sftFormbttfrAdtions(Adtion[] bdtions) {
        if (bdtions == null) {
            if (tfxtFormbttfrAdtionMbp != null) {
                tfxtFormbttfrAdtionMbp.dlfbr();
            }
        }
        flsf {
            if (tfxtFormbttfrAdtionMbp == null) {
                AdtionMbp mbp = gftAdtionMbp();

                tfxtFormbttfrAdtionMbp = nfw AdtionMbp();
                whilf (mbp != null) {
                    AdtionMbp pbrfnt = mbp.gftPbrfnt();

                    if (pbrfnt instbndfof UIRfsourdf || pbrfnt == null) {
                        mbp.sftPbrfnt(tfxtFormbttfrAdtionMbp);
                        tfxtFormbttfrAdtionMbp.sftPbrfnt(pbrfnt);
                        brfbk;
                    }
                    mbp = pbrfnt;
                }
            }
            for (int dountfr = bdtions.lfngth - 1; dountfr >= 0;
                 dountfr--) {
                Objfdt kfy = bdtions[dountfr].gftVbluf(Adtion.NAME);

                if (kfy != null) {
                    tfxtFormbttfrAdtionMbp.put(kfy, bdtions[dountfr]);
                }
            }
        }
    }

    /**
     * Dofs thf sftting of thf vbluf. If <dodf>drfbtfFormbt</dodf> is truf,
     * this will blso obtbin b nfw <dodf>AbstrbdtFormbttfr</dodf> from thf
     * durrfnt fbdtory. Thf propfrty dhbngf fvfnt will bf firfd if
     * <dodf>firfPC</dodf> is truf.
     */
    privbtf void sftVbluf(Objfdt vbluf, boolfbn drfbtfFormbt, boolfbn firfPC) {
        Objfdt oldVbluf = this.vbluf;

        this.vbluf = vbluf;

        if (drfbtfFormbt) {
            AbstrbdtFormbttfrFbdtory fbdtory = gftFormbttfrFbdtory();
            AbstrbdtFormbttfr btf;

            if (fbdtory != null) {
                btf = fbdtory.gftFormbttfr(this);
            }
            flsf {
                btf = null;
            }
            sftFormbttfr(btf);
        }
        flsf {
            // Assumfd to bf vblid
            sftEditVblid(truf);
        }

        sftEditfd(fblsf);

        if (firfPC) {
            firfPropfrtyChbngf("vbluf", oldVbluf, vbluf);
        }
    }

    /**
     * Sfts thf fditfd stbtf of thf rfdfivfr.
     */
    privbtf void sftEditfd(boolfbn fditfd) {
        this.fditfd = fditfd;
    }

    /**
     * Rfturns truf if thf rfdfivfr hbs bffn fditfd.
     */
    privbtf boolfbn isEditfd() {
        rfturn fditfd;
    }

    /**
     * Rfturns bn AbstrbdtFormbttfrFbdtory suitbblf for thf pbssfd in
     * Objfdt typf.
     */
    privbtf AbstrbdtFormbttfrFbdtory gftDffbultFormbttfrFbdtory(Objfdt typf) {
        if (typf instbndfof DbtfFormbt) {
            rfturn nfw DffbultFormbttfrFbdtory(nfw DbtfFormbttfr
                                               ((DbtfFormbt)typf));
        }
        if (typf instbndfof NumbfrFormbt) {
            rfturn nfw DffbultFormbttfrFbdtory(nfw NumbfrFormbttfr(
                                               (NumbfrFormbt)typf));
        }
        if (typf instbndfof Formbt) {
            rfturn nfw DffbultFormbttfrFbdtory(nfw IntfrnbtionblFormbttfr(
                                               (Formbt)typf));
        }
        if (typf instbndfof Dbtf) {
            rfturn nfw DffbultFormbttfrFbdtory(nfw DbtfFormbttfr());
        }
        if (typf instbndfof Numbfr) {
            AbstrbdtFormbttfr displbyFormbttfr = nfw NumbfrFormbttfr();
            ((NumbfrFormbttfr)displbyFormbttfr).sftVblufClbss(typf.gftClbss());
            AbstrbdtFormbttfr fditFormbttfr = nfw NumbfrFormbttfr(
                                  nfw DfdimblFormbt("#.#"));
            ((NumbfrFormbttfr)fditFormbttfr).sftVblufClbss(typf.gftClbss());

            rfturn nfw DffbultFormbttfrFbdtory(displbyFormbttfr,
                                               displbyFormbttfr,fditFormbttfr);
        }
        rfturn nfw DffbultFormbttfrFbdtory(nfw DffbultFormbttfr());
    }


    /**
     * Instbndfs of <dodf>AbstrbdtFormbttfrFbdtory</dodf> brf usfd by
     * <dodf>JFormbttfdTfxtFifld</dodf> to obtbin instbndfs of
     * <dodf>AbstrbdtFormbttfr</dodf> whidh in turn brf usfd to formbt vblufs.
     * <dodf>AbstrbdtFormbttfrFbdtory</dodf> dbn rfturn difffrfnt
     * <dodf>AbstrbdtFormbttfr</dodf>s bbsfd on thf stbtf of thf
     * <dodf>JFormbttfdTfxtFifld</dodf>, pfrhbps rfturning difffrfnt
     * <dodf>AbstrbdtFormbttfr</dodf>s whfn thf
     * <dodf>JFormbttfdTfxtFifld</dodf> hbs fodus vs whfn it
     * dofsn't hbvf fodus.
     * @sindf 1.4
     */
    publid stbtid bbstrbdt dlbss AbstrbdtFormbttfrFbdtory {
        /**
         * Rfturns bn <dodf>AbstrbdtFormbttfr</dodf> thbt dbn hbndlf formbtting
         * of thf pbssfd in <dodf>JFormbttfdTfxtFifld</dodf>.
         *
         * @pbrbm tf JFormbttfdTfxtFifld rfqufsting AbstrbdtFormbttfr
         * @rfturn AbstrbdtFormbttfr to hbndlf formbtting dutifs, b null
         *         rfturn vbluf implifs thf JFormbttfdTfxtFifld should bfhbvf
         *         likf b normbl JTfxtFifld
         */
        publid bbstrbdt AbstrbdtFormbttfr gftFormbttfr(JFormbttfdTfxtFifld tf);
    }


    /**
     * Instbndfs of <dodf>AbstrbdtFormbttfr</dodf> brf usfd by
     * <dodf>JFormbttfdTfxtFifld</dodf> to hbndlf thf donvfrsion both
     * from bn Objfdt to b String, bnd bbdk from b String to bn Objfdt.
     * <dodf>AbstrbdtFormbttfr</dodf>s dbn blso fnfordf fditing polidifs,
     * or nbvigbtion polidifs, or mbnipulbtf thf
     * <dodf>JFormbttfdTfxtFifld</dodf> in bny wby it sffs fit to
     * fnfordf thf dfsirfd polidy.
     * <p>
     * An <dodf>AbstrbdtFormbttfr</dodf> dbn only bf bdtivf in
     * onf <dodf>JFormbttfdTfxtFifld</dodf> bt b timf.
     * <dodf>JFormbttfdTfxtFifld</dodf> invokfs
     * <dodf>instbll</dodf> whfn it is rfbdy to usf it followfd
     * by <dodf>uninstbll</dodf> whfn donf. Subdlbssfs
     * thbt wish to instbll bdditionbl stbtf should ovfrridf
     * <dodf>instbll</dodf> bnd mfssbgf supfr bppropribtfly.
     * <p>
     * Subdlbssfs must ovfrridf thf donvfrsion mfthods
     * <dodf>stringToVbluf</dodf> bnd <dodf>vblufToString</dodf>. Optionblly
     * thfy dbn ovfrridf <dodf>gftAdtions</dodf>,
     * <dodf>gftNbvigbtionFiltfr</dodf> bnd <dodf>gftDodumfntFiltfr</dodf>
     * to rfstridt thf <dodf>JFormbttfdTfxtFifld</dodf> in b pbrtidulbr
     * wby.
     * <p>
     * Subdlbssfs thbt bllow thf <dodf>JFormbttfdTfxtFifld</dodf> to bf in
     * b tfmporbrily invblid stbtf should invokf <dodf>sftEditVblid</dodf>
     * bt thf bppropribtf timfs.
     * @sindf 1.4
     */
    publid stbtid bbstrbdt dlbss AbstrbdtFormbttfr implfmfnts Sfriblizbblf {
        privbtf JFormbttfdTfxtFifld ftf;

        /**
         * Instblls thf <dodf>AbstrbdtFormbttfr</dodf> onto b pbrtidulbr
         * <dodf>JFormbttfdTfxtFifld</dodf>.
         * This will invokf <dodf>vblufToString</dodf> to donvfrt thf
         * durrfnt vbluf from thf <dodf>JFormbttfdTfxtFifld</dodf> to
         * b String. This will thfn instbll thf <dodf>Adtion</dodf>s from
         * <dodf>gftAdtions</dodf>, thf <dodf>DodumfntFiltfr</dodf>
         * rfturnfd from <dodf>gftDodumfntFiltfr</dodf> bnd thf
         * <dodf>NbvigbtionFiltfr</dodf> rfturnfd from
         * <dodf>gftNbvigbtionFiltfr</dodf> onto thf
         * <dodf>JFormbttfdTfxtFifld</dodf>.
         * <p>
         * Subdlbssfs will typidblly only nffd to ovfrridf this if thfy
         * wish to instbll bdditionbl listfnfrs on thf
         * <dodf>JFormbttfdTfxtFifld</dodf>.
         * <p>
         * If thfrf is b <dodf>PbrsfExdfption</dodf> in donvfrting thf
         * durrfnt vbluf to b String, this will sft thf tfxt to bn fmpty
         * String, bnd mbrk thf <dodf>JFormbttfdTfxtFifld</dodf> bs bfing
         * in bn invblid stbtf.
         * <p>
         * Whilf this is b publid mfthod, this is typidblly only usfful
         * for subdlbssfrs of <dodf>JFormbttfdTfxtFifld</dodf>.
         * <dodf>JFormbttfdTfxtFifld</dodf> will invokf this mfthod bt
         * thf bppropribtf timfs whfn thf vbluf dhbngfs, or its intfrnbl
         * stbtf dhbngfs.  You will only nffd to invokf this yoursflf if
         * you brf subdlbssing <dodf>JFormbttfdTfxtFifld</dodf> bnd
         * instblling/uninstblling <dodf>AbstrbdtFormbttfr</dodf> bt b
         * difffrfnt timf thbn <dodf>JFormbttfdTfxtFifld</dodf> dofs.
         *
         * @pbrbm ftf JFormbttfdTfxtFifld to formbt for, mby bf null indidbting
         *            uninstbll from durrfnt JFormbttfdTfxtFifld.
         */
        publid void instbll(JFormbttfdTfxtFifld ftf) {
            if (this.ftf != null) {
                uninstbll();
            }
            this.ftf = ftf;
            if (ftf != null) {
                try {
                    ftf.sftTfxt(vblufToString(ftf.gftVbluf()));
                } dbtdh (PbrsfExdfption pf) {
                    ftf.sftTfxt("");
                    sftEditVblid(fblsf);
                }
                instbllDodumfntFiltfr(gftDodumfntFiltfr());
                ftf.sftNbvigbtionFiltfr(gftNbvigbtionFiltfr());
                ftf.sftFormbttfrAdtions(gftAdtions());
            }
        }

        /**
         * Uninstblls bny stbtf thf <dodf>AbstrbdtFormbttfr</dodf> mby hbvf
         * instbllfd on thf <dodf>JFormbttfdTfxtFifld</dodf>. This rfsfts thf
         * <dodf>DodumfntFiltfr</dodf>, <dodf>NbvigbtionFiltfr</dodf>
         * bnd bdditionbl <dodf>Adtion</dodf>s instbllfd on thf
         * <dodf>JFormbttfdTfxtFifld</dodf>.
         */
        publid void uninstbll() {
            if (this.ftf != null) {
                instbllDodumfntFiltfr(null);
                this.ftf.sftNbvigbtionFiltfr(null);
                this.ftf.sftFormbttfrAdtions(null);
            }
        }

        /**
         * Pbrsfs <dodf>tfxt</dodf> rfturning bn brbitrbry Objfdt. Somf
         * formbttfrs mby rfturn null.
         *
         * @throws PbrsfExdfption if thfrf is bn frror in thf donvfrsion
         * @pbrbm tfxt String to donvfrt
         * @rfturn Objfdt rfprfsfntbtion of tfxt
         */
        publid bbstrbdt Objfdt stringToVbluf(String tfxt) throws
                                     PbrsfExdfption;

        /**
         * Rfturns thf string vbluf to displby for <dodf>vbluf</dodf>.
         *
         * @throws PbrsfExdfption if thfrf is bn frror in thf donvfrsion
         * @pbrbm vbluf Vbluf to donvfrt
         * @rfturn String rfprfsfntbtion of vbluf
         */
        publid bbstrbdt String vblufToString(Objfdt vbluf) throws
                        PbrsfExdfption;

        /**
         * Rfturns thf durrfnt <dodf>JFormbttfdTfxtFifld</dodf> thf
         * <dodf>AbstrbdtFormbttfr</dodf> is instbllfd on.
         *
         * @rfturn JFormbttfdTfxtFifld formbtting for.
         */
        protfdtfd JFormbttfdTfxtFifld gftFormbttfdTfxtFifld() {
            rfturn ftf;
        }

        /**
         * This should bf invokfd whfn thf usfr typfs bn invblid dhbrbdtfr.
         * This forwbrds thf dbll to thf durrfnt JFormbttfdTfxtFifld.
         */
        protfdtfd void invblidEdit() {
            JFormbttfdTfxtFifld ftf = gftFormbttfdTfxtFifld();

            if (ftf != null) {
                ftf.invblidEdit();
            }
        }

        /**
         * Invokf this to updbtf thf <dodf>fditVblid</dodf> propfrty of thf
         * <dodf>JFormbttfdTfxtFifld</dodf>. If you bn fnfordf b polidy
         * sudh thbt thf <dodf>JFormbttfdTfxtFifld</dodf> is blwbys in b
         * vblid stbtf, you will nfvfr nffd to invokf this.
         *
         * @pbrbm vblid Vblid stbtf of thf JFormbttfdTfxtFifld
         */
        protfdtfd void sftEditVblid(boolfbn vblid) {
            JFormbttfdTfxtFifld ftf = gftFormbttfdTfxtFifld();

            if (ftf != null) {
                ftf.sftEditVblid(vblid);
            }
        }

        /**
         * Subdlbss bnd ovfrridf if you wish to providf b dustom sft of
         * <dodf>Adtion</dodf>s. <dodf>instbll</dodf> will instbll thfsf
         * on thf <dodf>JFormbttfdTfxtFifld</dodf>'s <dodf>AdtionMbp</dodf>.
         *
         * @rfturn Arrby of Adtions to instbll on JFormbttfdTfxtFifld
         */
        protfdtfd Adtion[] gftAdtions() {
            rfturn null;
        }

        /**
         * Subdlbss bnd ovfrridf if you wish to providf b
         * <dodf>DodumfntFiltfr</dodf> to rfstridt whbt dbn bf input.
         * <dodf>instbll</dodf> will instbll thf rfturnfd vbluf onto
         * thf <dodf>JFormbttfdTfxtFifld</dodf>.
         *
         * @rfturn DodumfntFiltfr to rfstridt fdits
         */
        protfdtfd DodumfntFiltfr gftDodumfntFiltfr() {
            rfturn null;
        }

        /**
         * Subdlbss bnd ovfrridf if you wish to providf b filtfr to rfstridt
         * whfrf thf usfr dbn nbvigbtf to.
         * <dodf>instbll</dodf> will instbll thf rfturnfd vbluf onto
         * thf <dodf>JFormbttfdTfxtFifld</dodf>.
         *
         * @rfturn NbvigbtionFiltfr to rfstridt nbvigbtion
         */
        protfdtfd NbvigbtionFiltfr gftNbvigbtionFiltfr() {
            rfturn null;
        }

        /**
         * Clonfs thf <dodf>AbstrbdtFormbttfr</dodf>. Thf rfturnfd instbndf
         * is not bssodibtfd with b <dodf>JFormbttfdTfxtFifld</dodf>.
         *
         * @rfturn Copy of thf AbstrbdtFormbttfr
         */
        protfdtfd Objfdt dlonf() throws ClonfNotSupportfdExdfption {
            AbstrbdtFormbttfr formbttfr = (AbstrbdtFormbttfr)supfr.dlonf();

            formbttfr.ftf = null;
            rfturn formbttfr;
        }

        /**
         * Instblls thf <dodf>DodumfntFiltfr</dodf> <dodf>filtfr</dodf>
         * onto thf durrfnt <dodf>JFormbttfdTfxtFifld</dodf>.
         *
         * @pbrbm filtfr DodumfntFiltfr to instbll on thf Dodumfnt.
         */
        privbtf void instbllDodumfntFiltfr(DodumfntFiltfr filtfr) {
            JFormbttfdTfxtFifld ftf = gftFormbttfdTfxtFifld();

            if (ftf != null) {
                Dodumfnt dod = ftf.gftDodumfnt();

                if (dod instbndfof AbstrbdtDodumfnt) {
                    ((AbstrbdtDodumfnt)dod).sftDodumfntFiltfr(filtfr);
                }
                dod.putPropfrty(DodumfntFiltfr.dlbss, null);
            }
        }
    }


    /**
     * Usfd to dommit thf fdit. This fxtfnds JTfxtFifld.NotifyAdtion
     * so thbt <dodf>isEnbblfd</dodf> is truf whilf b JFormbttfdTfxtFifld
     * hbs fodus, bnd fxtfnds <dodf>bdtionPfrformfd</dodf> to invokf
     * dommitEdit.
     */
    stbtid dlbss CommitAdtion fxtfnds JTfxtFifld.NotifyAdtion {
        publid void bdtionPfrformfd(AdtionEvfnt f) {
            JTfxtComponfnt tbrgft = gftFodusfdComponfnt();

            if (tbrgft instbndfof JFormbttfdTfxtFifld) {
                // Attfmpt to dommit thf vbluf
                try {
                    ((JFormbttfdTfxtFifld)tbrgft).dommitEdit();
                } dbtdh (PbrsfExdfption pf) {
                    ((JFormbttfdTfxtFifld)tbrgft).invblidEdit();
                    // vbluf not dommittfd, don't notify AdtionListfnfrs
                    rfturn;
                }
            }
            // Supfr bfhbvior.
            supfr.bdtionPfrformfd(f);
        }

        publid boolfbn isEnbblfd() {
            JTfxtComponfnt tbrgft = gftFodusfdComponfnt();
            if (tbrgft instbndfof JFormbttfdTfxtFifld) {
                JFormbttfdTfxtFifld ftf = (JFormbttfdTfxtFifld)tbrgft;
                if (!ftf.isEditfd()) {
                    rfturn fblsf;
                }
                rfturn truf;
            }
            rfturn supfr.isEnbblfd();
        }
    }


    /**
     * CbndflAdtion will rfsft thf vbluf in thf JFormbttfdTfxtFifld whfn
     * <dodf>bdtionPfrformfd</dodf> is invokfd. It will only bf
     * fnbblfd if thf fodusfd domponfnt is bn instbndf of
     * JFormbttfdTfxtFifld.
     */
    privbtf stbtid dlbss CbndflAdtion fxtfnds TfxtAdtion {
        publid CbndflAdtion() {
            supfr("rfsft-fifld-fdit");
        }

        publid void bdtionPfrformfd(AdtionEvfnt f) {
            JTfxtComponfnt tbrgft = gftFodusfdComponfnt();

            if (tbrgft instbndfof JFormbttfdTfxtFifld) {
                JFormbttfdTfxtFifld ftf = (JFormbttfdTfxtFifld)tbrgft;
                ftf.sftVbluf(ftf.gftVbluf());
            }
        }

        publid boolfbn isEnbblfd() {
            JTfxtComponfnt tbrgft = gftFodusfdComponfnt();
            if (tbrgft instbndfof JFormbttfdTfxtFifld) {
                JFormbttfdTfxtFifld ftf = (JFormbttfdTfxtFifld)tbrgft;
                if (!ftf.isEditfd()) {
                    rfturn fblsf;
                }
                rfturn truf;
            }
            rfturn supfr.isEnbblfd();
        }
    }


    /**
     * Sfts thf dirty stbtf bs thf dodumfnt dhbngfs.
     */
    privbtf dlbss DodumfntHbndlfr implfmfnts DodumfntListfnfr, Sfriblizbblf {
        publid void insfrtUpdbtf(DodumfntEvfnt f) {
            sftEditfd(truf);
        }
        publid void rfmovfUpdbtf(DodumfntEvfnt f) {
            sftEditfd(truf);
        }
        publid void dhbngfdUpdbtf(DodumfntEvfnt f) {}
    }
}
