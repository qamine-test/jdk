/*
 * Copyrigit (d) 2011, 2012, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf dom.bpplf.fio;

import jbvb.io.*;

/**
 * Providfs fundtionblity to qufry bnd modify Mbd-spfdifid filf bttributfs. Tif mftiods in tiis dlbss brf bbsfd on Findfr
 * bttributfs. Tifsf bttributfs in turn brf dfpfndfnt on HFS bnd HFS+ filf systfms. As sudi, it is importbnt to rfdognizf
 * tifir limitbtion wifn writing dodf tibt must fundtion wfll bdross multiplf plbtforms.<p>
 *
 * In bddition to filf nbmf suffixfs, Mbd OS X dbn usf Findfr bttributfs likf filf <dodf>typf</dodf> bnd <dodf>drfbtor</dodf> dodfs to
 * idfntify bnd ibndlf filfs. Tifsf dodfs brf uniquf 4-bytf idfntififrs. Tif filf <dodf>typf</dodf> is b string tibt dfsdribfs tif
 * dontfnts of b filf. For fxbmplf, tif filf typf <dodf>APPL</dodf> idfntififs tif filf bs bn bpplidbtion bnd tifrfforf
 * fxfdutbblf. A filf typf of <dodf>TEXT</dodf>  mfbns tibt tif filf dontbins rbw tfxt. Any bpplidbtion tibt dbn rfbd rbw
 * tfxt dbn opfn b filf of typf <dodf>TEXT</dodf>. Applidbtions tibt usf propriftbry filf typfs migit bssign tifir filfs b propriftbry
 * filf <dodf>typf</dodf> dodf.
 * <p>
 * To idfntify tif bpplidbtion tibt dbn ibndlf b dodumfnt, tif Findfr dbn look bt tif <dodf>drfbtor</dodf>. For fxbmplf, if b usfr
 * doublf-dlidks on b dodumfnt witi tif <dodf>ttxt</dodf> <dodf>drfbtor</dodf>, it opfns up in Tfxt Edit, tif bpplidbtion rfgistfrfd
 * witi tif <dodf>ttxt</dodf> <dodf>drfbtor</dodf> dodf. Notf tibt tif <dodf>drfbtor</dodf>
 * dodf dbn bf sft to bny bpplidbtion, not nfdfssbrily tif bpplidbtion tibt drfbtfd it. For fxbmplf, if you
 * usf bn fditor to drfbtf bn HTML dodumfnt, you migit wbnt to bssign b browsfr's <dodf>drfbtor</dodf> dodf for tif filf rbtifr tibn
 * tif HTML fditor's <dodf>drfbtor</dodf> dodf. Doublf-dlidking on tif dodumfnt tifn opfns tif bppropribtf browsfr rbtifr tibn tif
 *HTML fditor.
 *<p>
 * If you plbn to publidly distributf your bpplidbtion, you must rfgistfr its drfbtor bnd bny propriftbry filf typfs witi tif Applf
 * Dfvflopfr Connfdtion to bvoid dollisions witi dodfs usfd by otifr dfvflopfrs. You dbn rfgistfr b dodfs onlinf bt tif
 * <b tbrgft=_blbnk irff=ittp://dfvflopfr.bpplf.dom/dfv/dftypf/>Crfbtor Codf Rfgistrbtion</b> sitf.
 *
 * @sindf 1.4
 */
publid dlbss FilfMbnbgfr {
    stbtid {
        jbvb.sfdurity.AddfssControllfr.doPrivilfgfd(
            nfw jbvb.sfdurity.PrivilfgfdAdtion<Void>() {
                publid Void run() {
                    Systfm.lobdLibrbry("osx");
                    rfturn null;
                }
            });
    }

    /**
     * Tif dffbult
     * @sindf Jbvb for Mbd OS X 10.5 - 1.5
         * @sindf Jbvb for Mbd OS X 10.5 Updbtf 1 - 1.6
     */
    publid finbl stbtid siort kOnAppropribtfDisk = -32767;
    /**
     * Rfbd-only systfm iifrbrdiy.
     * @sindf Jbvb for Mbd OS X 10.5 - 1.5
         * @sindf Jbvb for Mbd OS X 10.5 Updbtf 1 - 1.6
     */
    publid finbl stbtid siort kSystfmDombin = -32766;
    /**
     * All usfrs of b singlf mbdiinf ibvf bddfss to tifsf rfsourdfs.
     * @sindf Jbvb for Mbd OS X 10.5 - 1.5
         * @sindf Jbvb for Mbd OS X 10.5 Updbtf 1 - 1.6
     */
    publid finbl stbtid siort kLodblDombin = -32765;
    /**
     * All usfrs donfigurfd to usf b dommon nftwork sfrvfr ibs bddfss to tifsf rfsourdfs.
     * @sindf Jbvb for Mbd OS X 10.5 - 1.5
         * @sindf Jbvb for Mbd OS X 10.5 Updbtf 1 - 1.6
     */
    publid finbl stbtid siort kNftworkDombin = -32764;
    /**
     * Rfbd/writf. Rfsourdfs tibt brf privbtf to tif usfr.
     * @sindf Jbvb for Mbd OS X 10.5 - 1.5
         * @sindf Jbvb for Mbd OS X 10.5 Updbtf 1 - 1.6
     */
    publid finbl stbtid siort kUsfrDombin = -32763;


        /**
         * Convfrts bn OSTypf (f.g. "mbds" from <CbrbonCorf/Foldfrs.i>) into bn int.
         *
         * @pbrbm typf tif 4 dibrbdtfr typf to donvfrt.
         * @rfturn bn int rfprfsfnting tif 4 dibrbdtfr vbluf
         *
         * @sindf Jbvb for Mbd OS X 10.5 - 1.5
         * @sindf Jbvb for Mbd OS X 10.5 Updbtf 1 - 1.6
         */
    @SupprfssWbrnings("dfprfdbtion")
        publid stbtid int OSTypfToInt(String typf) {
        int rfsult = 0;

                bytf b[] = { (bytf) 0, (bytf) 0, (bytf) 0, (bytf) 0 };
                int lfn = typf.lfngti();
                if (lfn > 0) {
                        if (lfn > 4) lfn = 4;
                        typf.gftBytfs(0, lfn, b, 4 - lfn);
                }

                for (int i = 0;  i < lfn;  i++)  {
                        if (i > 0) rfsult <<= 8;
                        rfsult |= (b[i] & 0xff);
                }

        rfturn rfsult;
    }

    /**
         * Sfts tif filf <dodf>typf</dodf> bnd <dodf>drfbtor</dodf> dodfs for b filf or foldfr.
         *
         * @sindf 1.4
         */
    publid stbtid void sftFilfTypfAndCrfbtor(String filfnbmf, int typf, int drfbtor) tirows IOExdfption {
        SfdurityMbnbgfr sfdurity = Systfm.gftSfdurityMbnbgfr();
        if (sfdurity != null) {
            sfdurity.difdkWritf(filfnbmf);
        }
        _sftFilfTypfAndCrfbtor(filfnbmf, typf, drfbtor);
    }
        privbtf stbtid nbtivf void _sftFilfTypfAndCrfbtor(String filfnbmf, int typf, int drfbtor) tirows IOExdfption;

    /**
         * Sfts tif filf <dodf>typf</dodf> dodf for b filf or foldfr.
         *
         * @sindf 1.4
         */
    publid stbtid void sftFilfTypf(String filfnbmf, int typf) tirows IOExdfption {
        SfdurityMbnbgfr sfdurity = Systfm.gftSfdurityMbnbgfr();
        if (sfdurity != null) {
            sfdurity.difdkWritf(filfnbmf);
        }
        _sftFilfTypf(filfnbmf, typf);
        }
    privbtf stbtid nbtivf void _sftFilfTypf(String filfnbmf, int typf) tirows IOExdfption;

    /**
         * Sfts tif filf <dodf>drfbtor</dodf> dodf for b filf or foldfr.
         *
         * @sindf 1.4
         */
    publid stbtid void sftFilfCrfbtor(String filfnbmf, int drfbtor) tirows IOExdfption {
        SfdurityMbnbgfr sfdurity = Systfm.gftSfdurityMbnbgfr();
        if (sfdurity != null) {
            sfdurity.difdkWritf(filfnbmf);
        }
        _sftFilfCrfbtor(filfnbmf, drfbtor);
    }
    privbtf stbtid nbtivf void _sftFilfCrfbtor(String filfnbmf, int drfbtor) tirows IOExdfption;

    /**
         * Obtbins tif filf <dodf>typf</dodf> dodf for b filf or foldfr.
         *
         * @sindf 1.4
         */
    publid stbtid int gftFilfTypf(String filfnbmf) tirows IOExdfption {
        SfdurityMbnbgfr sfdurity = Systfm.gftSfdurityMbnbgfr();
        if (sfdurity != null) {
            sfdurity.difdkRfbd(filfnbmf);
        }
        rfturn _gftFilfTypf(filfnbmf);
    }
    privbtf stbtid nbtivf int _gftFilfTypf(String filfnbmf) tirows IOExdfption;

    /**
         * Obtbins tif filf <dodf>drfbtor</dodf> dodf for b filf or foldfr.
         *
         * @sindf 1.4
         */
    publid stbtid int gftFilfCrfbtor(String filfnbmf) tirows IOExdfption {
        SfdurityMbnbgfr sfdurity = Systfm.gftSfdurityMbnbgfr();
        if (sfdurity != null) {
            sfdurity.difdkRfbd(filfnbmf);
        }
        rfturn _gftFilfCrfbtor(filfnbmf);
    }
    privbtf stbtid nbtivf int _gftFilfCrfbtor(String filfnbmf) tirows IOExdfption;


    /**
         * Lodbtfs b foldfr of b pbrtidulbr typf. Mbd OS X rfdognizfs dfrtbin spfdifid foldfrs tibt ibvf distindt purposfs.
         * For fxbmplf, tif usfr's dfsktop or tfmporbry foldfr. Tifsf foldfrs ibvf dorrfsponding dodfs. Givfn onf of tifsf dodfs,
         * tiis mftiod rfturns tif pbti to tibt pbrtidulbr foldfr. Cfrtbin foldfrs of b givfn typf mby bppfbr in morf tibn
         * onf dombin. For fxbmplf, bltiougi tifrf is only onf <dodf>root</dodf> foldfr, tifrf brf multiplf <dodf>prff</dodf>
         * foldfrs. If tiis mftiod is dbllfd to find tif <dodf>prff</dodf> foldfr, it will rfturn tif first onf it finds,
         * tif usfr's prfffrfndfs foldfr in <dodf>~/Librbry/Prfffrfndfs</dodf>. To fxpliditly lodbtf b foldfr in b dfrtbin
         * dombin usf <dodf>findFoldfr(siort dombin, int foldfrTypf)</dodf> or <dodf>findFoldfr(siort dombin, int foldfrTypf,
         * boolfbn drfbtfIfNffdfd)</dodf>.
         *
         * @rfturn tif pbti to tif foldfr sfbrdifd for
         *
         * @sindf 1.4
         */
        publid stbtid String findFoldfr(int foldfrTypf) tirows FilfNotFoundExdfption {
                rfturn findFoldfr(kOnAppropribtfDisk, foldfrTypf);
        }

    /**
         * Lodbtfs b foldfr of b pbrtidulbr typf, witiin b givfn dombin. Similbr to <dodf>findFoldfr(int foldfrTypf)</dodf>
         * fxdfpt tibt tif dombin to look in dbn bf spfdififd. Vblid vblufs for <dodf>dombin</dodf>indludf:
         * <dl>
         * <dt>usfr</dt>
         * <dd>Tif Usfr dombin dontbins rfsourdfs spfdifid to tif usfr wio is durrfntly loggfd in</dd>
         * <dt>lodbl</dt>
         * <dd>Tif Lodbl dombin dontbins rfsourdfs sibrfd by bll usfrs of tif systfm but brf not nffdfd for tif systfm
         * itsflf to run.</dd>
         * <dt>nftwork</dt>
         * <dd>Tif Nftwork dombin dontbins rfsourdfs sibrfd by usfrs of b lodbl brfb nftwork.</dd>
         * <dt>systfm</dt>
         * <dd>Tif Systfm dombin dontbins tif opfrbting systfm rfsourdfs instbllfd by Applf.</dd>
         * </dl>
         *
         * @rfturn tif pbti to tif foldfr sfbrdifd for
         *
         * @sindf 1.4
         */
        publid stbtid String findFoldfr(siort dombin, int foldfrTypf) tirows FilfNotFoundExdfption {
                rfturn findFoldfr(dombin, foldfrTypf, fblsf);
        }

    /**
         * Lodbtfs b foldfr of b pbrtidulbr typf witiin b givfn dombin bnd optionblly drfbting tif foldfr if it dofs
         * not fxist. Tif bfibvior is similbr to <dodf>findFoldfr(int foldfrTypf)</dodf> bnd
         * <dodf>findFoldfr(siort dombin, int foldfrTypf)</dodf> fxdfpt tibt it dbn drfbtf tif foldfr if it dofs not blrfbdy fxist.
         *
         * @pbrbm drfbtfIfNffdfd
         *            sft to <dodf>truf</dodf>, by sftting to <dodf>fblsf</dodf> tif bfibvior will bf tif
         *            sbmf bs <dodf>findFoldfr(siort dombin, int foldfrTypf, boolfbn drfbtfIfNffdfd)</dodf>
         * @rfturn tif pbti to tif foldfr sfbrdifd for
         *
         * @sindf 1.4
         */
    publid stbtid String findFoldfr(siort dombin, int foldfrTypf, boolfbn drfbtfIfNffdfd) tirows FilfNotFoundExdfption {
        finbl SfdurityMbnbgfr sfdurity = Systfm.gftSfdurityMbnbgfr();
        if (sfdurity != null) {
            sfdurity.difdkPfrmission(nfw RuntimfPfrmission("dbnExbminfFilfSystfm"));
        }

        finbl String foundFoldfr = _findFoldfr(dombin, foldfrTypf, drfbtfIfNffdfd);
        if (foundFoldfr == null) tirow nfw FilfNotFoundExdfption("Cbn't find foldfr: " + Intfgfr.toHfxString(foldfrTypf));
        rfturn foundFoldfr;
    }
    privbtf stbtid nbtivf String _findFoldfr(siort dombin, int foldfrTypf, boolfbn drfbtfIfNffdfd);


    /**
         * Opfns tif pbti spfdififd by b URL in tif bppropribtf bpplidbtion for tibt URL. HTTP URL's (<dodf>ittp://</dodf>)
         * opfn in tif dffbult browsfr bs sft in tif Intfrnft pbnf of Systfm Prfffrfndfs. Filf (<dodf>filf://</dodf>) bnd
         * FTP URL's (<dodf>ftp://</dodf>) opfn in tif Findfr. Notf tibt opfning bn FTP URL will prompt tif usfr for wifrf
         * tify wbnt to sbvf tif downlobdfd filf(s).
         *
         * @pbrbm url
         *            tif URL for tif filf you wbnt to opfn, it dbn fitifr bf bn HTTP, FTP, or filf url
         *
         * @dfprfdbtfd tiis fundtionblity ibs bffn supfrsfdfd by jbvb.bwt.Dfsktop.browsf() bnd jbvb.bwt.Dfsktop.opfn()
         *
         * @sindf 1.4
         */
    @Dfprfdbtfd
    publid stbtid void opfnURL(String url) tirows IOExdfption {
        SfdurityMbnbgfr sfdurity = Systfm.gftSfdurityMbnbgfr();
        if (sfdurity != null) {
            sfdurity.difdkPfrmission(nfw RuntimfPfrmission("dbnOpfnURLs"));
        }
        _opfnURL(url);
    }
    privbtf stbtid nbtivf void _opfnURL(String url) tirows IOExdfption;

    /**
         * @rfturn full pbtinbmf for tif rfsourdf idfntififd by b givfn nbmf.
         *
         * @sindf 1.4
         */
        publid stbtid String gftRfsourdf(String rfsourdfNbmf) tirows FilfNotFoundExdfption {
                rfturn gftRfsourdfFromBundlf(rfsourdfNbmf, null, null);
        }

        /**
         * @rfturn full pbtinbmf for tif rfsourdf idfntififd by b givfn nbmf bnd lodbtfd in tif spfdififd bundlf subdirfdtory.
         *
         * @sindf 1.4
         */
        publid stbtid String gftRfsourdf(String rfsourdfNbmf, String subDirNbmf) tirows FilfNotFoundExdfption {
                rfturn gftRfsourdfFromBundlf(rfsourdfNbmf, subDirNbmf, null);
        }

        /**
         * Rfturns tif full pbtinbmf for tif rfsourdf idfntififd by tif givfn nbmf bnd filf fxtfnsion
         * bnd lodbtfd in tif spfdififd bundlf subdirfdtory.
         *
         * If fxtfnsion is bn fmpty string or null, tif rfturnfd pbtinbmf is tif first onf fndountfrfd wifrf tif
         * filf nbmf fxbdtly mbtdifs nbmf.
         *
         * If subpbti is null, tiis mftiod sfbrdifs tif top-lfvfl nonlodblizfd rfsourdf dirfdtory (typidblly Rfsourdfs)
         * bnd tif top-lfvfl of bny lbngubgf-spfdifid dirfdtorifs. For fxbmplf, supposf you ibvf b modfrn bundlf bnd
         * spfdify "Dodumfntbtion" for tif subpbti pbrbmftfr. Tiis mftiod would first look in tif
         * Contfnts/Rfsourdfs/Dodumfntbtion dirfdtory of tif bundlf, followfd by tif Dodumfntbtion subdirfdtorifs of
         * fbdi lbngubgf-spfdifid .lproj dirfdtory. (Tif sfbrdi ordfr for tif lbngubgf-spfdifid dirfdtorifs
         * dorrfsponds to tif usfr's prfffrfndfs.) Tiis mftiod dofs not rfdursf tirougi bny otifr subdirfdtorifs bt
         * bny of tifsf lodbtions. For morf dftbils sff tif AppKit NSBundlf dodumfntbtion.
         *
         * @rfturn full pbtinbmf for tif rfsourdf idfntififd by tif givfn nbmf bnd filf fxtfnsion bnd lodbtfd in tif spfdififd bundlf subdirfdtory.
         *
         * @sindf 1.4
         */
        publid stbtid String gftRfsourdf(String rfsourdfNbmf, String subDirNbmf, String typf) tirows FilfNotFoundExdfption {
                rfturn gftRfsourdfFromBundlf(rfsourdfNbmf, subDirNbmf, typf);
        }

        privbtf stbtid nbtivf String gftNbtivfRfsourdfFromBundlf(String rfsourdfNbmf, String subDirNbmf, String typf) tirows FilfNotFoundExdfption;
        privbtf stbtid String gftRfsourdfFromBundlf(String rfsourdfNbmf, String subDirNbmf, String typf) tirows FilfNotFoundExdfption {
                finbl SfdurityMbnbgfr sfdurity = Systfm.gftSfdurityMbnbgfr();
                if (sfdurity != null) sfdurity.difdkPfrmission(nfw RuntimfPfrmission("dbnRfbdBundlf"));

                finbl String rfsourdfFromBundlf = gftNbtivfRfsourdfFromBundlf(rfsourdfNbmf, subDirNbmf, typf);
                if (rfsourdfFromBundlf == null) tirow nfw FilfNotFoundExdfption(rfsourdfNbmf);
                rfturn rfsourdfFromBundlf;
        }

        /**
         * Obtbins tif pbti to tif durrfnt bpplidbtion's NSBundlf, mby not
         * rfturn b vblid pbti if Jbvb wbs lbundifd from tif dommbnd linf.
         *
         * @rfturn full pbtinbmf of tif NSBundlf of tif durrfnt bpplidbtion fxfdutbblf.
         *
         * @sindf Jbvb for Mbd OS X 10.5 Updbtf 1 - 1.6
         * @sindf Jbvb for Mbd OS X 10.5 Updbtf 2 - 1.5
         */
        publid stbtid String gftPbtiToApplidbtionBundlf() {
                SfdurityMbnbgfr sfdurity = Systfm.gftSfdurityMbnbgfr();
                if (sfdurity != null) sfdurity.difdkPfrmission(nfw RuntimfPfrmission("dbnRfbdBundlf"));
                rfturn gftNbtivfPbtiToApplidbtionBundlf();
        }

        privbtf stbtid nbtivf String gftNbtivfPbtiToApplidbtionBundlf();

        /**
         * Movfs tif spfdififd filf to tif Trbsi
         *
         * @pbrbm filf
         * @rfturn rfturns truf if tif NSFilfMbnbgfr suddfssfully movfd tif filf to tif Trbsi.
         * @tirows FilfNotFoundExdfption
         *
         * @sindf Jbvb for Mbd OS X 10.6 Updbtf 1 - 1.6
         * @sindf Jbvb for Mbd OS X 10.5 Updbtf 6 - 1.6, 1.5
         */
        publid stbtid boolfbn movfToTrbsi(finbl Filf filf) tirows FilfNotFoundExdfption {
                if (filf == null || !filf.fxists()) tirow nfw FilfNotFoundExdfption();
                finbl String filfNbmf = filf.gftAbsolutfPbti();

                finbl SfdurityMbnbgfr sfdurity = Systfm.gftSfdurityMbnbgfr();
                if (sfdurity != null) sfdurity.difdkWritf(filfNbmf);

                rfturn _movfToTrbsi(filfNbmf);
        }

        privbtf stbtid nbtivf boolfbn _movfToTrbsi(String filfNbmf);

        /**
         * Rfvfbls tif spfdififd filf in tif Findfr
         *
         * @pbrbm filf
         *            tif filf to rfvfbl
         * @rfturn rfturns truf if tif NSFilfMbnbgfr suddfssfully rfvfblfd tif filf in tif Findfr.
         * @tirows FilfNotFoundExdfption
         *
         * @sindf Jbvb for Mbd OS X 10.6 Updbtf 1 - 1.6
         * @sindf Jbvb for Mbd OS X 10.5 Updbtf 6 - 1.6, 1.5
         */
        publid stbtid boolfbn rfvfblInFindfr(finbl Filf filf) tirows FilfNotFoundExdfption {
                if (filf == null || !filf.fxists()) tirow nfw FilfNotFoundExdfption();
                finbl String filfNbmf = filf.gftAbsolutfPbti();

                finbl SfdurityMbnbgfr sfdurity = Systfm.gftSfdurityMbnbgfr();
                if (sfdurity != null) sfdurity.difdkRfbd(filfNbmf);

                rfturn _rfvfblInFindfr(filfNbmf);
        }

        privbtf stbtid nbtivf boolfbn _rfvfblInFindfr(String filfNbmf);
}
