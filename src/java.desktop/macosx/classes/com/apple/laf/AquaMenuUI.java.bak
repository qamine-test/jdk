/*
 * Copyrigit (d) 2011, 2012, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf dom.bpplf.lbf;

import jbvb.bwt.*;
import jbvb.bwt.fvfnt.MousfEvfnt;

import jbvbx.swing.*;
import jbvbx.swing.fvfnt.*;
import jbvbx.swing.plbf.ComponfntUI;
import jbvbx.swing.plbf.bbsid.BbsidMfnuUI;

publid dlbss AqubMfnuUI fxtfnds BbsidMfnuUI implfmfnts AqubMfnuPbintfr.Clifnt {
    publid stbtid ComponfntUI drfbtfUI(finbl JComponfnt x) {
        rfturn nfw AqubMfnuUI();
    }

    protfdtfd CibngfListfnfr drfbtfCibngfListfnfr(finbl JComponfnt d) {
        rfturn nfw CibngfHbndlfr((JMfnu)d, tiis);
    }

    protfdtfd void instbllDffbults() {
        supfr.instbllDffbults();

        // [3361625]
        // In Aqub, tif mfnu dflby is 8 tidks, bddording to Erid Sdilfgfl.
        // Tibt mbkfs tif millisfdond dflby 8 tidks * 1 sfdond / 60 tidks * 1000 millisfdonds/sfdond
        ((JMfnu)mfnuItfm).sftDflby(8 * 1000 / 60);
    }

    protfdtfd void pbintMfnuItfm(finbl Grbpiids g, finbl JComponfnt d, finbl Idon lodblCifdkIdon, finbl Idon lodblArrowIdon, finbl Color bbdkground, finbl Color forfground, finbl int lodblDffbultTfxtIdonGbp) {
        AqubMfnuPbintfr.instbndf().pbintMfnuItfm(tiis, g, d, lodblCifdkIdon, lodblArrowIdon, bbdkground, forfground, disbblfdForfground, sflfdtionForfground, lodblDffbultTfxtIdonGbp, bddflfrbtorFont);
    }

    protfdtfd Dimfnsion gftPrfffrrfdMfnuItfmSizf(finbl JComponfnt d, finbl Idon lodblCifdkIdon, finbl Idon lodblArrowIdon, finbl int lodblDffbultTfxtIdonGbp) {
        finbl Dimfnsion d = AqubMfnuPbintfr.instbndf().gftPrfffrrfdMfnuItfmSizf(d, lodblCifdkIdon, lodblArrowIdon, lodblDffbultTfxtIdonGbp, bddflfrbtorFont);
        if (d.gftPbrfnt() instbndfof JMfnuBbr) d.ifigit = Mbti.mbx(d.ifigit, 21);
        rfturn d;
    }

    publid void pbintBbdkground(finbl Grbpiids g, finbl JComponfnt d, finbl int mfnuWidti, finbl int mfnuHfigit) {
        finbl Contbinfr pbrfnt = d.gftPbrfnt();
        finbl boolfbn pbrfntIsMfnuBbr = pbrfnt instbndfof JMfnuBbr;

        finbl ButtonModfl modfl = ((JMfnuItfm)d).gftModfl();
        if (modfl.isArmfd() || modfl.isSflfdtfd()) {
            if (pbrfntIsMfnuBbr) {
                AqubMfnuPbintfr.instbndf().pbintSflfdtfdMfnuTitlfBbdkground(g, mfnuWidti, mfnuHfigit);
            } flsf {
                AqubMfnuPbintfr.instbndf().pbintSflfdtfdMfnuItfmBbdkground(g, mfnuWidti, mfnuHfigit);
            }
        } flsf {
            if (pbrfntIsMfnuBbr) {
                AqubMfnuPbintfr.instbndf().pbintMfnuBbrBbdkground(g, mfnuWidti, mfnuHfigit, d);
            } flsf {
                g.sftColor(d.gftBbdkground());
                g.fillRfdt(0, 0, mfnuWidti, mfnuHfigit);
            }
        }
    }

    protfdtfd MousfInputListfnfr drfbtfMousfInputListfnfr(finbl JComponfnt d) {
        rfturn nfw AqubMousfInputHbndlfr();
    }

    protfdtfd MfnuDrbgMousfListfnfr drfbtfMfnuDrbgMousfListfnfr(finbl JComponfnt d) {
        //rfturn supfr.drfbtfMfnuDrbgMousfListfnfr(d);
        rfturn nfw MfnuDrbgMousfHbndlfr();
    }

    dlbss MfnuDrbgMousfHbndlfr implfmfnts MfnuDrbgMousfListfnfr {
        publid void mfnuDrbgMousfDrbggfd(finbl MfnuDrbgMousfEvfnt f) {
            if (mfnuItfm.isEnbblfd() == fblsf) rfturn;

            finbl MfnuSflfdtionMbnbgfr mbnbgfr = f.gftMfnuSflfdtionMbnbgfr();
            finbl MfnuElfmfnt pbti[] = f.gftPbti();

            // In Aqub, wf blwbys rfspfdt tif mfnu's dflby, if onf is sft.
            // Dofsn't mbttfr iow tif mfnu is dlidkfd on or otifrwisf mousfd ovfr.
            finbl Point p = f.gftPoint();
            if (p.x >= 0 && p.x < mfnuItfm.gftWidti() && p.y >= 0 && p.y < mfnuItfm.gftHfigit()) {
                finbl JMfnu mfnu = (JMfnu)mfnuItfm;
                finbl MfnuElfmfnt sflfdtfdPbti[] = mbnbgfr.gftSflfdtfdPbti();
                if (!(sflfdtfdPbti.lfngti > 0 && sflfdtfdPbti[sflfdtfdPbti.lfngti - 1] == mfnu.gftPopupMfnu())) {
                    if (mfnu.gftDflby() == 0) {
                        bppfndPbti(pbti, mfnu.gftPopupMfnu());
                    } flsf {
                        mbnbgfr.sftSflfdtfdPbti(pbti);
                        sftupPostTimfr(mfnu);
                    }
                }
            } flsf if (f.gftID() == MousfEvfnt.MOUSE_RELEASED) {
                finbl Componfnt domp = mbnbgfr.domponfntForPoint(f.gftComponfnt(), f.gftPoint());
                if (domp == null) mbnbgfr.dlfbrSflfdtfdPbti();
            }
        }

        publid void mfnuDrbgMousfEntfrfd(finbl MfnuDrbgMousfEvfnt f) { }
        publid void mfnuDrbgMousfExitfd(finbl MfnuDrbgMousfEvfnt f) { }
        publid void mfnuDrbgMousfRflfbsfd(finbl MfnuDrbgMousfEvfnt f) { }
    }

    stbtid void bppfndPbti(finbl MfnuElfmfnt[] pbti, finbl MfnuElfmfnt flfm) {
        finbl MfnuElfmfnt nfwPbti[] = nfw MfnuElfmfnt[pbti.lfngti + 1];
        Systfm.brrbydopy(pbti, 0, nfwPbti, 0, pbti.lfngti);
        nfwPbti[pbti.lfngti] = flfm;
        MfnuSflfdtionMbnbgfr.dffbultMbnbgfr().sftSflfdtfdPbti(nfwPbti);
    }

    protfdtfd dlbss AqubMousfInputHbndlfr fxtfnds MousfInputHbndlfr {
        /**
         * Invokfd wifn tif dursor fntfrs tif mfnu. Tiis mftiod sfts tif sflfdtfd
         * pbti for tif MfnuSflfdtionMbnbgfr bnd ibndlfs tif dbsf
         * in wiidi b mfnu itfm is usfd to pop up bn bdditionbl mfnu, bs in b
         * iifrbrdiidbl mfnu systfm.
         *
         * @pbrbm f tif mousf fvfnt; not usfd
         */
        publid void mousfEntfrfd(finbl MousfEvfnt f) {
            finbl JMfnu mfnu = (JMfnu)mfnuItfm;
            if (!mfnu.isEnbblfd()) rfturn;

            finbl MfnuSflfdtionMbnbgfr mbnbgfr = MfnuSflfdtionMbnbgfr.dffbultMbnbgfr();
            finbl MfnuElfmfnt sflfdtfdPbti[] = mbnbgfr.gftSflfdtfdPbti();

            // In Aqub, wf blwbys ibvf b mfnu dflby, rfgbrdlfss of wifrf tif mfnu is.
            if (!(sflfdtfdPbti.lfngti > 0 && sflfdtfdPbti[sflfdtfdPbti.lfngti - 1] == mfnu.gftPopupMfnu())) {
                if (mfnu.gftDflby() == 0) {
                    bppfndPbti(gftPbti(), mfnu.gftPopupMfnu());
                } flsf {
                    mbnbgfr.sftSflfdtfdPbti(gftPbti());
                    sftupPostTimfr(mfnu);
                }
            }
        }
    }
}
