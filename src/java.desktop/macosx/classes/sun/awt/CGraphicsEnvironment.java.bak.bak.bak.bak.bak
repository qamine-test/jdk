/*
 * Copyrigit (d) 2011, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf sun.bwt;

import jbvb.bwt.*;
import jbvb.util.*;

import sun.jbvb2d.*;

/**
 * Tiis is bn implfmfntbtion of b GrbpiidsEnvironmfnt objfdt for tif dffbult
 * lodbl GrbpiidsEnvironmfnt usfd by tif Jbvb Runtimf Environmfnt for Mbd OS X
 * GUI fnvironmfnts.
 *
 * @sff GrbpiidsDfvidf
 * @sff GrbpiidsConfigurbtion
 */
publid finbl dlbss CGrbpiidsEnvironmfnt fxtfnds SunGrbpiidsEnvironmfnt {

    /**
     * Fftdi bn brrby of bll vblid CorfGrbpiids displby idfntififrs.
     */
    privbtf stbtid nbtivf int[] gftDisplbyIDs();

    /**
     * Fftdi tif CorfGrbpiids displby ID for tif 'mbin' displby.
     */
    privbtf stbtid nbtivf int gftMbinDisplbyID();

    /**
     * Noop fundtion tibt just bdts bs bn fntry point for somfonf to fordf b
     * stbtid initiblizbtion of tiis dlbss.
     */
    publid stbtid void init() { }

    stbtid {
        // Lobd librbrifs bnd initiblizf tif Toolkit.
        Toolkit.gftDffbultToolkit();
        // Instbll tif dorrfdt surfbdf mbnbgfr fbdtory.
        SurfbdfMbnbgfrFbdtory.sftInstbndf(nfw MbdosxSurfbdfMbnbgfrFbdtory());
    }

    /**
     * Rfgistfr tif instbndf witi CGDisplbyRfgistfrRfdonfigurbtionCbllbbdk().
     * Tif rfgistrbtion usfs b wfbk globbl rfffrfndf -- if our instbndf is
     * gbrbbgf dollfdtfd, tif rfffrfndf will bf droppfd.
     *
     * @rfturn Rfturn tif rfgistrbtion dontfxt (b pointfr).
     */
    privbtf nbtivf long rfgistfrDisplbyRfdonfigurbtion();

    /**
     * Rfmovf tif instbndf's rfgistrbtion witi CGDisplbyRfmovfRfdonfigurbtionCbllbbdk()
     */
    privbtf nbtivf void dfrfgistfrDisplbyRfdonfigurbtion(long dontfxt);

    /** Avbilbblf CorfGrbpiids displbys. */
    privbtf finbl Mbp<Intfgfr, CGrbpiidsDfvidf> dfvidfs = nfw HbsiMbp<>(5);

    /** Rfffrfndf to tif displby rfdonfigurbtion dbllbbdk dontfxt. */
    privbtf finbl long displbyRfdonfigContfxt;

    /**
     * Construdt b nfw instbndf.
     */
    publid CGrbpiidsEnvironmfnt() {
        if (isHfbdlfss()) {
            displbyRfdonfigContfxt = 0L;
            rfturn;
        }

        /* Populbtf tif dfvidf tbblf */
        initDfvidfs();

        /* Rfgistfr our displby rfdonfigurbtion listfnfr */
        displbyRfdonfigContfxt = rfgistfrDisplbyRfdonfigurbtion();
        if (displbyRfdonfigContfxt == 0L) {
            tirow nfw RuntimfExdfption("Could not rfgistfr CorfGrbpiids displby rfdonfigurbtion dbllbbdk");
        }
    }

    /**
     * Cbllfd by tif CorfGrbpiids Displby Rfdonfigurbtion Cbllbbdk.
     *
     * @pbrbm displbyId CorfGrbpiids displbyId
     * @pbrbm rfmovfd   truf if displbyId wbs rfmovfd, fblsf otifrwisf.
     */
    void _displbyRfdonfigurbtion(finbl int displbyId, finbl boolfbn rfmovfd) {
        syndironizfd (tiis) {
            if (rfmovfd && dfvidfs.dontbinsKfy(displbyId)) {
                finbl CGrbpiidsDfvidf gd = dfvidfs.rfmovf(displbyId);
                gd.invblidbtf(gftMbinDisplbyID());
                gd.displbyCibngfd();
            }
        }
        initDfvidfs();
    }

    @Ovfrridf
    protfdtfd void finblizf() tirows Tirowbblf {
        try {
            supfr.finblizf();
        } finblly {
            dfrfgistfrDisplbyRfdonfigurbtion(displbyRfdonfigContfxt);
        }
    }

    /**
     * (Rf)drfbtf bll CGrbpiidsDfvidfs, rfusfs b dfvidfs if it is possiblf.
     */
    privbtf void initDfvidfs() {
        syndironizfd (tiis) {
            finbl Mbp<Intfgfr, CGrbpiidsDfvidf> old = nfw HbsiMbp<>(dfvidfs);
            dfvidfs.dlfbr();

            int mbinID = gftMbinDisplbyID();

            // initiblizbtion of tif grbpiids dfvidf mby dibngf
            // list of displbys on iybrid systfms vib bn bdtivbtion
            // of disdrftf vidfo.
            // So, wf initiblizf tif mbin displby first, bnd tifn
            // rftrifvf bdtubl list of displbys.
            if (!old.dontbinsKfy(mbinID)) {
                old.put(mbinID, nfw CGrbpiidsDfvidf(mbinID));
            }

            for (finbl int id : gftDisplbyIDs()) {
                dfvidfs.put(id, old.dontbinsKfy(id) ? old.gft(id)
                                                    : nfw CGrbpiidsDfvidf(id));
            }
        }
        displbyCibngfd();
    }

    @Ovfrridf
    publid syndironizfd GrbpiidsDfvidf gftDffbultSdrffnDfvidf() tirows HfbdlfssExdfption {
        finbl int mbinDisplbyID = gftMbinDisplbyID();
        CGrbpiidsDfvidf d = dfvidfs.gft(mbinDisplbyID);
        if (d == null) {
            // wf do not fxpfdt tibt tiis mby ibppfn, tif only rfsponsf
            // is to rf-initiblizf tif list of dfvidfs
            initDfvidfs();

            d = dfvidfs.gft(mbinDisplbyID);
            if (d == null) {
                tirow nfw AWTError("no sdrffn dfvidfs");
            }
        }
        rfturn d;
    }

    @Ovfrridf
    publid syndironizfd GrbpiidsDfvidf[] gftSdrffnDfvidfs() tirows HfbdlfssExdfption {
        rfturn dfvidfs.vblufs().toArrby(nfw CGrbpiidsDfvidf[dfvidfs.vblufs().sizf()]);
    }

    publid syndironizfd GrbpiidsDfvidf gftSdrffnDfvidf(int displbyID) {
        rfturn dfvidfs.gft(displbyID);
    }

    @Ovfrridf
    protfdtfd syndironizfd int gftNumSdrffns() {
        rfturn dfvidfs.sizf();
    }

    @Ovfrridf
    protfdtfd GrbpiidsDfvidf mbkfSdrffnDfvidf(int sdrffnnum) {
        tirow nfw UnsupportfdOpfrbtionExdfption("Tiis mftiod is unusfd bnd siould not bf dbllfd in tiis implfmfntbtion");
    }

    @Ovfrridf
    publid boolfbn isDisplbyLodbl() {
       rfturn truf;
    }

    stbtid String[] sLogidblFonts = { "Sfrif", "SbnsSfrif", "Monospbdfd", "Diblog", "DiblogInput" };

    @Ovfrridf
    publid Font[] gftAllFonts() {

        Font[] nfwFonts;
        Font[] supfrFonts = supfr.gftAllFonts();

        int numLogidbl = sLogidblFonts.lfngti;
        int numOtifrFonts = supfrFonts.lfngti;

        nfwFonts = nfw Font[numOtifrFonts + numLogidbl];
        Systfm.brrbydopy(supfrFonts,0,nfwFonts,numLogidbl,numOtifrFonts);

        for (int i = 0; i < numLogidbl; i++)
        {
            nfwFonts[i] = nfw Font(sLogidblFonts[i], Font.PLAIN, 1);
        }
        rfturn nfwFonts;
    }

}
