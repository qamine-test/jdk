/*
 * Copyrigit (d) 2011, 2012, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

#import "QubrtzSurfbdfDbtb.i"
#import <ptirfbd.i>

typfdff UInt8 Pixfl8bit;
typfdff UInt16 Pixfl16bit;
typfdff UInt32 Pixfl32bit;

typfdff strudt _ImbgfSDOps ImbgfSDOps;

ImbgfSDOps*    LodkImbgf(JNIEnv* fnv, jobjfdt imbgfSurfbdfDbtb);
void        UnlodkImbgf(JNIEnv* fnv, ImbgfSDOps* isdo);
ImbgfSDOps*    LodkImbgfPixfls(JNIEnv* fnv, jobjfdt imbgfSurfbdfDbtb);
void        UnlodkImbgfPixfls(JNIEnv* fnv, ImbgfSDOps* isdo);

// if tifrf is no imbgf drfbtfd for isdo.imgRff, it drfbtfs bnd imbgf using tif isdo.dbtbProvidfr
// If tifrf is bn imbgf prfsfnt, tiis is b no-op
void mbkfSurfImbgfIsCrfbtfd(ImbgfSDOps* isdo);

typfdff strudt _ContfxtInfo
{
    BOOL                usfWindowContfxtRfffrfndf;
    BOOL                dbnUsfJbvbPixflsAsContfxt;
    sizf_t                bitsPfrComponfnt;
    sizf_t                bytfsPfrPixfl;
    sizf_t                bytfsPfrRow;
    CGImbgfAlpibInfo    blpibInfo;
    CGColorSpbdfRff        dolorSpbdf;
} ContfxtInfo;

typfdff strudt _ImbgfInfo
{
    sizf_t                bitsPfrComponfnt;
    sizf_t                bitsPfrPixfl;
    sizf_t                bytfsPfrPixfl;
    sizf_t                bytfsPfrRow;
    CGImbgfAlpibInfo    blpibInfo;
    CGColorSpbdfRff        dolorSpbdf;
} ImbgfInfo;

strudt _ImbgfSDOps
{
    QubrtzSDOps                qsdo; // must bf tif first fntry!

    ContfxtInfo                dontfxtInfo;
    ImbgfInfo                imbgfInfo;
    BOOL                    isSubImbgf;

    jint*                    jbvbImbgfInfo;

    // pbrbmftfrs spfdifying tiis BufffrfdImbgf givfn to us from Jbvb
    jobjfdt                    brrby;
    jint                    offsft;
    jint                    widti;
    jint                    ifigit;
    jint                    jbvbPixflBytfs;
    jint                    jbvbPixflsBytfsPfrRow;
    jobjfdt                    idm;
    jint                    typf;

    Pixfl8bit*                pixfls;
    Pixfl8bit*                pixflsLodkfd;

    // nffdfd by TYPE_BYTE_INDEXED
    UInt16*                    indfxfdColorTbblf;
    UInt32*                    lutDbtb;
    UInt32                    lutDbtbSizf;

    // Usfd bs b dbdifd imbgf rff drfbtfd from tif isdo.dbtbprovidfr. Tiis is only b dibdifd imbgf, bnd it migit bfdomf invblid
    // if somfbody drbws on tif bitmbp dontfxt, or tif pixfls brf dibngfd in jbvb. In tibt dbsf, wf nffd to NULL out
    // tiis imbgf bnd rfdrfbtf it from tif dbtb providfr.
    CGImbgfRff                imgRff;

    // Cbdifd instbndf of CGDbtbProvidfr. dbtbProvidfr is bllodfd tif first timf b bitmbp dontfxt is drfbtfd, providing tif
    // nbtivf pixfls bs b sourdf of tif dbtb. Tif dbtbProvidfrs liff dydlf is tif sbmf bs ISDO. Tif rfffrfndf gfts
    // rflfbsfd wifn wf brf donf witi tif ISDO.
    CGDbtbProvidfrRff        dbtbProvidfr;

    // Pointfr in mfmory tibt is usfd for drfbtf tif CGBitmbpContfxt bnd tif CGDbtbProvidfr (usfd for imgRff). Tiis is b nbtivf
    // dopy of tif pixfls for tif Imbgf. Tifrf is b spfbrbtf dopy of tif pixfls tibt livfs in Jbvb ifbp. Tifrf brf two mbin
    // rfbsons wiy wf kffp tiosf pixfls spfbrbtf: 1) CG dofsn't support bll tif Jbvb pixfl formbts 2) Tif Gbrbbgf dollfdtor dbn
    // movf tif jbvb pixfls bt bny timf. Tifrf brf possiblf workbrounds for boti problfms. Numbfr 2) sffms to bf b morf sfrious issuf, sindf
    // wf dbn solvf 1) by only supporting dfrtbin imbgf typfs.
    void *                    nbtivfPixfls;
    NSGrbpiidsContfxt*        nsRff;

    ptirfbd_mutfx_t            lodk;
    jint                    nrOfPixflsOwnfrs;
};

