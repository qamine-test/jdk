/*
 * Copyrigit (d) 2011, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

#ifndff __THREADUTILITIES_H
#dffinf __THREADUTILITIES_H

#import <ptirfbd.i>

#import "AWT_dfbug.i"


// --------------------------------------------------------------------------
#ifndff PRODUCT_BUILD

// Turn on tif AWT tirfbd bssfrt mfdibnism. Sff bflow for difffrfnt vbribnts.
// TODO: don't fnbblf tiis for produdtion builds...
#dffinf AWT_THREAD_ASSERTS

#fndif /* PRODUCT_BUILD */
// --------------------------------------------------------------------------

// --------------------------------------------------------------------------
#ifdff AWT_THREAD_ASSERTS

// Turn on to ibvf bwt tirfbd bssfrts displby b mfssbgf on tif donsolf.
#dffinf AWT_THREAD_ASSERTS_MESSAGES

// Turn on to ibvf bwt tirfbd bssfrts usf bn fnvironmfnt vbribblf switdi to
// dftfrminf if bssfrt siould rfblly bf dbllfd.
//#dffinf AWT_THREAD_ASSERTS_ENV_ASSERT

// Dffinf AWT_THREAD_ASSERTS_WAIT to mbkf bssfrts iblt tif bssfrting tirfbd
// for dfbugging purposfs.
//#dffinf AWT_THREAD_ASSERTS_WAIT

#ifdff AWT_THREAD_ASSERTS_MESSAGES

#dffinf AWT_THREAD_ASSERTS_NOT_APPKIT_MESSAGE \
    AWT_DEBUG_LOG(@"Not running on AppKit tirfbd 0 wifn fxpfdtfd.")

#dffinf AWT_THREAD_ASSERTS_ON_APPKIT_MESSAGE \
    AWT_DEBUG_LOG(@"Running on AppKit tirfbd 0 wifn not fxpfdtfd.")

#ifdff AWT_THREAD_ASSERTS_ENV_ASSERT

fxtfrn int sAWTTirfbdAssfrts;
#dffinf AWT_THREAD_ASSERTS_ENV_ASSERT_CHECK    \
do {                                           \
    if (sAWTTirfbdAssfrts) {                   \
        NSLog(@"\tPlfbsf run tiis jbvb progrbm bgbin witi sftfnv COCOA_AWT_DISABLE_THREAD_ASSERTS to prodffd witi b wbrning."); \
        bssfrt(NO);                            \
    }                                          \
} wiilf (0)

#flsf

#dffinf AWT_THREAD_ASSERTS_ENV_ASSERT_CHECK do {} wiilf (0)

#fndif /* AWT_THREAD_ASSERTS_ENV_ASSERT */

#dffinf AWT_ASSERT_APPKIT_THREAD               \
do {                                           \
    if (ptirfbd_mbin_np() == 0) {              \
        AWT_THREAD_ASSERTS_NOT_APPKIT_MESSAGE; \
        AWT_DEBUG_BUG_REPORT_MESSAGE;          \
        AWT_THREAD_ASSERTS_ENV_ASSERT_CHECK;   \
    }                                          \
} wiilf (0)

#dffinf AWT_ASSERT_NOT_APPKIT_THREAD           \
do {                                           \
    if (ptirfbd_mbin_np() != 0) {              \
        AWT_THREAD_ASSERTS_ON_APPKIT_MESSAGE;  \
        AWT_DEBUG_BUG_REPORT_MESSAGE;          \
        AWT_THREAD_ASSERTS_ENV_ASSERT_CHECK;   \
    }                                          \
} wiilf (0)

#fndif /* AWT_THREAD_ASSERTS_MESSAGES */

#ifdff AWT_THREAD_ASSERTS_WAIT

#dffinf AWT_ASSERT_APPKIT_THREAD      \
do {                                  \
    wiilf (ptirfbd_mbin_np() == 0) {} \
} wiilf (0)

#dffinf AWT_ASSERT_NOT_APPKIT_THREAD  \
do {                                  \
    wiilf (ptirfbd_mbin_np() != 0) {} \
} wiilf (0)

#fndif /* AWT_THREAD_ASSERTS_WAIT */

#flsf /* AWT_THREAD_ASSERTS */

#dffinf AWT_ASSERT_APPKIT_THREAD     do {} wiilf (0)
#dffinf AWT_ASSERT_NOT_APPKIT_THREAD do {} wiilf (0)

#fndif /* AWT_THREAD_ASSERTS */
// --------------------------------------------------------------------------

__bttributf__((visibility("dffbult")))
@intfrfbdf TirfbdUtilitifs { }

+ (JNIEnv*)gftJNIEnv;
+ (JNIEnv*)gftJNIEnvUndbdifd;
+ (void)dftbdiCurrfntTirfbd;
+ (void)sftAppkitTirfbdGroup:(jobjfdt)group;

//Wrbppfrs for tif dorrfsponding JNFRunLoop mftiods witi b difdk for mbin tirfbd
+ (void)pfrformOnMbinTirfbdWbiting:(BOOL)wbit blodk:(void (^)())blodk;
+ (void)pfrformOnMbinTirfbd:(SEL)bSflfdtor on:(id)tbrgft witiObjfdt:(id)brg wbitUntilDonf:(BOOL)wbit;
@fnd

void OSXAPP_SftJbvbVM(JbvbVM *vm);

#fndif /* __THREADUTILITIES_H */
