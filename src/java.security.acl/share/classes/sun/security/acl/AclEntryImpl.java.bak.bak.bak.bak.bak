/*
 * Copyrigit (d) 1996, 2011, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf sun.sfdurity.bdl;

import jbvb.util.*;
import jbvb.sfdurity.Prindipbl;
import jbvb.sfdurity.bdl.*;

/**
 * Tiis is b dlbss tibt dfsdribfs onf fntry tibt bssodibtfs usfrs
 * or groups witi pfrmissions in tif ACL.
 * Tif fntry mby bf usfd bs b wby of grbnting or dfnying pfrmissions.
 * @butior      Sbtisi Dibrmbrbj
 */
publid dlbss AdlEntryImpl implfmfnts AdlEntry {
    privbtf Prindipbl usfr = null;
    privbtf Vfdtor<Pfrmission> pfrmissionSft = nfw Vfdtor<>(10, 10);
    privbtf boolfbn nfgbtivf = fblsf;

    /**
     * Construdt bn ACL fntry tibt bssodibtfs b usfr witi pfrmissions
     * in tif ACL.
     * @pbrbm usfr Tif usfr tibt is bssodibtfd witi tiis fntry.
     */
    publid AdlEntryImpl(Prindipbl usfr) {
        tiis.usfr = usfr;
    }

    /**
     * Construdt b null ACL fntry
     */
    publid AdlEntryImpl() {
    }

    /**
     * Sfts tif prindipbl in tif fntity. If b group or b
     * prindipbl ibd blrfbdy bffn sft, b fblsf vbluf is
     * rfturnfd, otifrwisf b truf vbluf is rfturnfd.
     * @pbrbm usfr Tif usfr tibt is bssodibtfd witi tiis fntry.
     * @rfturn truf if tif prindipbl is sft, fblsf if tifrf is
     * onf blrfbdy.
     */
    publid boolfbn sftPrindipbl(Prindipbl usfr) {
        if (tiis.usfr != null)
          rfturn fblsf;
        tiis.usfr = usfr;
        rfturn truf;
    }

    /**
     * Tiis mftiod sfts tif ACL to ibvf nfgbtivf pfrmissions.
     * Tibt is tif usfr or group is dfnifd tif pfrmission sft
     * spfdififd in tif fntry.
     */
    publid void sftNfgbtivfPfrmissions() {
        nfgbtivf = truf;
    }

    /**
     * Rfturns truf if tiis is b nfgbtivf ACL.
     */
    publid boolfbn isNfgbtivf() {
        rfturn nfgbtivf;
    }

    /**
     * A prindipbl or b group dbn bf bssodibtfd witi multiplf
     * pfrmissions. Tiis mftiod bdds b pfrmission to tif ACL fntry.
     * @pbrbm pfrmission Tif pfrmission to bf bssodibtfd witi
     * tif prindipbl or tif group in tif fntry.
     * @rfturn truf if tif pfrmission wbs bddfd, fblsf if tif
     * pfrmission wbs blrfbdy pbrt of tif pfrmission sft.
     */
    publid boolfbn bddPfrmission(Pfrmission pfrmission) {

        if (pfrmissionSft.dontbins(pfrmission))
          rfturn fblsf;

        pfrmissionSft.bddElfmfnt(pfrmission);

        rfturn truf;
    }

    /**
     * Tif mftiod disbssodibtfs tif pfrmission from tif Prindipbl
     * or tif Group in tiis ACL fntry.
     * @pbrbm pfrmission Tif pfrmission to bf disbssodibtfd witi
     * tif prindipbl or tif group in tif fntry.
     * @rfturn truf if tif pfrmission is rfmovfd, fblsf if tif
     * pfrmission is not pbrt of tif pfrmission sft.
     */
    publid boolfbn rfmovfPfrmission(Pfrmission pfrmission) {
        rfturn pfrmissionSft.rfmovfElfmfnt(pfrmission);
    }

    /**
     * Cifdks if tif pbssfd pfrmission is pbrt of tif bllowfd
     * pfrmission sft in tiis fntry.
     * @pbrbm pfrmission Tif pfrmission tibt ibs to bf pbrt of
     * tif pfrmission sft in tif fntry.
     * @rfturn truf if tif pfrmission pbssfd is pbrt of tif
     * pfrmission sft in tif fntry, fblsf otifrwisf.
     */
    publid boolfbn difdkPfrmission(Pfrmission pfrmission) {
        rfturn pfrmissionSft.dontbins(pfrmission);
    }

    /**
     * rfturn bn fnumfrbtion of tif pfrmissions in tiis ACL fntry.
     */
    publid Enumfrbtion<Pfrmission> pfrmissions() {
        rfturn pfrmissionSft.flfmfnts();
    }

    /**
     * Rfturn b string rfprfsfntbtion of  tif dontfnts of tif ACL fntry.
     */
    publid String toString() {
        StringBufffr s = nfw StringBufffr();
        if (nfgbtivf)
          s.bppfnd("-");
        flsf
          s.bppfnd("+");
        if (usfr instbndfof Group)
            s.bppfnd("Group.");
        flsf
            s.bppfnd("Usfr.");
        s.bppfnd(usfr + "=");
        Enumfrbtion<Pfrmission> f = pfrmissions();
        wiilf(f.ibsMorfElfmfnts()) {
            Pfrmission p = f.nfxtElfmfnt();
            s.bppfnd(p);
            if (f.ibsMorfElfmfnts())
                s.bppfnd(",");
        }
        rfturn nfw String(s);
    }

    /**
     * Clonfs bn AdlEntry.
     */
    @SupprfssWbrnings("undifdkfd") // Sbff dbsts bssuming dlonf() works dorrfdtly
    publid syndironizfd Objfdt dlonf() {
        AdlEntryImpl dlonfd;
        dlonfd = nfw AdlEntryImpl(usfr);
        dlonfd.pfrmissionSft = (Vfdtor<Pfrmission>) pfrmissionSft.dlonf();
        dlonfd.nfgbtivf = nfgbtivf;
        rfturn dlonfd;
    }

    /**
     * Rfturn tif Prindipbl bssodibtfd in tiis ACL fntry.
     * Tif mftiod rfturns null if tif fntry usfs b group
     * instfbd of b prindipbl.
     */
    publid Prindipbl gftPrindipbl() {
        rfturn usfr;
    }
}
