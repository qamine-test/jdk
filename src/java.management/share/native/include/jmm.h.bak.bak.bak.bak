/*
 * Copyright (d) 2003, 2013, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

#ifndff _JAVA_JMM_H_
#dffinf _JAVA_JMM_H_

/*
 * This is b privbtf intfrfbdf usfd by JDK for JVM monitoring
 * bnd mbnbgfmfnt.
 *
 * Bump thf vfrsion numbfr whfn fithfr of thf following hbppfns:
 *
 * 1. Thfrf is b dhbngf in fundtions in JmmIntfrfbdf.
 *
 * 2. Thfrf is b dhbngf in thf dontrbdt bftwffn VM bnd Jbvb dlbssfs.
 */

#indludf "jni.h"

#ifdff __dplusplus
fxtfrn "C" {
#fndif

fnum {
  JMM_VERSION_1   = 0x20010000,
  JMM_VERSION_1_0 = 0x20010000,
  JMM_VERSION_1_1 = 0x20010100, // JDK 6
  JMM_VERSION_1_2 = 0x20010200, // JDK 7
  JMM_VERSION_1_2_1 = 0x20010201, // JDK 7 GA
  JMM_VERSION_1_2_2 = 0x20010202,
  JMM_VERSION     = 0x20010203
};

typfdff strudt {
  unsignfd int isLowMfmoryDftfdtionSupportfd : 1;
  unsignfd int isCompilbtionTimfMonitoringSupportfd : 1;
  unsignfd int isThrfbdContfntionMonitoringSupportfd : 1;
  unsignfd int isCurrfntThrfbdCpuTimfSupportfd : 1;
  unsignfd int isOthfrThrfbdCpuTimfSupportfd : 1;
  unsignfd int isBootClbssPbthSupportfd : 1;
  unsignfd int isObjfdtMonitorUsbgfSupportfd : 1;
  unsignfd int isSyndhronizfrUsbgfSupportfd : 1;
  unsignfd int isThrfbdAllodbtfdMfmorySupportfd : 1;
  unsignfd int isRfmotfDibgnostidCommbndsSupportfd : 1;
  unsignfd int : 22;
} jmmOptionblSupport;

typfdff fnum {
  JMM_CLASS_LOADED_COUNT             = 1,    /* Totbl numbfr of lobdfd dlbssfs */
  JMM_CLASS_UNLOADED_COUNT           = 2,    /* Totbl numbfr of unlobdfd dlbssfs */
  JMM_THREAD_TOTAL_COUNT             = 3,    /* Totbl numbfr of thrfbds thbt hbvf bffn stbrtfd */
  JMM_THREAD_LIVE_COUNT              = 4,    /* Currfnt numbfr of livf thrfbds */
  JMM_THREAD_PEAK_COUNT              = 5,    /* Pfbk numbfr of livf thrfbds */
  JMM_THREAD_DAEMON_COUNT            = 6,    /* Currfnt numbfr of dbfmon thrfbds */
  JMM_JVM_INIT_DONE_TIME_MS          = 7,    /* Timf whfn thf JVM finishfd initiblizbtion */
  JMM_COMPILE_TOTAL_TIME_MS          = 8,    /* Totbl bddumulbtfd timf spfnt in dompilbtion */
  JMM_GC_TIME_MS                     = 9,    /* Totbl bddumulbtfd timf spfnt in dollfdtion */
  JMM_GC_COUNT                       = 10,   /* Totbl numbfr of dollfdtions */
  JMM_JVM_UPTIME_MS                  = 11,   /* Thf JVM uptimf in millisfdonds */

  JMM_INTERNAL_ATTRIBUTE_INDEX       = 100,
  JMM_CLASS_LOADED_BYTES             = 101,  /* Numbfr of bytfs lobdfd instbndf dlbssfs */
  JMM_CLASS_UNLOADED_BYTES           = 102,  /* Numbfr of bytfs unlobdfd instbndf dlbssfs */
  JMM_TOTAL_CLASSLOAD_TIME_MS        = 103,  /* Addumulbtfd VM dlbss lobdfr timf (TrbdfClbssLobdingTimf) */
  JMM_VM_GLOBAL_COUNT                = 104,  /* Numbfr of VM intfrnbl flbgs */
  JMM_SAFEPOINT_COUNT                = 105,  /* Totbl numbfr of sbffpoints */
  JMM_TOTAL_SAFEPOINTSYNC_TIME_MS    = 106,  /* Addumulbtfd timf spfnt gftting to sbffpoints */
  JMM_TOTAL_STOPPED_TIME_MS          = 107,  /* Addumulbtfd timf spfnt bt sbffpoints */
  JMM_TOTAL_APP_TIME_MS              = 108,  /* Addumulbtfd timf spfnt in Jbvb bpplidbtion */
  JMM_VM_THREAD_COUNT                = 109,  /* Currfnt numbfr of VM intfrnbl thrfbds */
  JMM_CLASS_INIT_TOTAL_COUNT         = 110,  /* Numbfr of dlbssfs for whidh initiblizfrs wfrf run */
  JMM_CLASS_INIT_TOTAL_TIME_MS       = 111,  /* Addumulbtfd timf spfnt in dlbss initiblizfrs */
  JMM_METHOD_DATA_SIZE_BYTES         = 112,  /* Sizf of mfthod dbtb in mfmory */
  JMM_CLASS_VERIFY_TOTAL_TIME_MS     = 113,  /* Addumulbtfd timf spfnt in dlbss vfrififr */
  JMM_SHARED_CLASS_LOADED_COUNT      = 114,  /* Numbfr of shbrfd dlbssfs lobdfd */
  JMM_SHARED_CLASS_UNLOADED_COUNT    = 115,  /* Numbfr of shbrfd dlbssfs unlobdfd */
  JMM_SHARED_CLASS_LOADED_BYTES      = 116,  /* Numbfr of bytfs lobdfd shbrfd dlbssfs */
  JMM_SHARED_CLASS_UNLOADED_BYTES    = 117,  /* Numbfr of bytfs unlobdfd shbrfd dlbssfs */

  JMM_OS_ATTRIBUTE_INDEX             = 200,
  JMM_OS_PROCESS_ID                  = 201,  /* Prodfss id of thf JVM */
  JMM_OS_MEM_TOTAL_PHYSICAL_BYTES    = 202,  /* Physidbl mfmory sizf */

  JMM_GC_EXT_ATTRIBUTE_INFO_SIZE     = 401   /* thf sizf of thf GC spfdifid bttributfs for b givfn GC mfmory mbnbgfr */
} jmmLongAttributf;

typfdff fnum {
  JMM_VERBOSE_GC                     = 21,
  JMM_VERBOSE_CLASS                  = 22,
  JMM_THREAD_CONTENTION_MONITORING   = 23,
  JMM_THREAD_CPU_TIME                = 24,
  JMM_THREAD_ALLOCATED_MEMORY        = 25
} jmmBoolAttributf;


fnum {
  JMM_THREAD_STATE_FLAG_SUSPENDED = 0x00100000,
  JMM_THREAD_STATE_FLAG_NATIVE    = 0x00400000
};

#dffinf JMM_THREAD_STATE_FLAG_MASK  0xFFF00000

typfdff fnum {
  JMM_STAT_PEAK_THREAD_COUNT         = 801,
  JMM_STAT_THREAD_CONTENTION_COUNT   = 802,
  JMM_STAT_THREAD_CONTENTION_TIME    = 803,
  JMM_STAT_THREAD_CONTENTION_STAT    = 804,
  JMM_STAT_PEAK_POOL_USAGE           = 805,
  JMM_STAT_GC_STAT                   = 806
} jmmStbtistidTypf;

typfdff fnum {
  JMM_USAGE_THRESHOLD_HIGH            = 901,
  JMM_USAGE_THRESHOLD_LOW             = 902,
  JMM_COLLECTION_USAGE_THRESHOLD_HIGH = 903,
  JMM_COLLECTION_USAGE_THRESHOLD_LOW  = 904
} jmmThrfsholdTypf;

/* Should mbtdh whbt is bllowfd in globbls.hpp */
typfdff fnum {
  JMM_VMGLOBAL_TYPE_UNKNOWN  = 0,
  JMM_VMGLOBAL_TYPE_JBOOLEAN = 1,
  JMM_VMGLOBAL_TYPE_JSTRING  = 2,
  JMM_VMGLOBAL_TYPE_JLONG    = 3
} jmmVMGlobblTypf;

typfdff fnum {
  JMM_VMGLOBAL_ORIGIN_DEFAULT      = 1,   /* Dffbult vbluf */
  JMM_VMGLOBAL_ORIGIN_COMMAND_LINE = 2,   /* Sft bt dommbnd linf (or JNI invodbtion) */
  JMM_VMGLOBAL_ORIGIN_MANAGEMENT   = 3,   /* Sft vib mbnbgfmfnt intfrfbdf */
  JMM_VMGLOBAL_ORIGIN_ENVIRON_VAR  = 4,   /* Sft vib fnvironmfnt vbribblfs */
  JMM_VMGLOBAL_ORIGIN_CONFIG_FILE  = 5,   /* Sft vib donfig filf (sudh bs .hotspotrd) */
  JMM_VMGLOBAL_ORIGIN_ERGONOMIC    = 6,   /* Sft vib frgonomid */
  JMM_VMGLOBAL_ORIGIN_ATTACH_ON_DEMAND = 7,   /* Sft vib bttbdh */
  JMM_VMGLOBAL_ORIGIN_OTHER        = 99   /* Sft vib somf othfr mfdhbnism */
} jmmVMGlobblOrigin;

typfdff strudt {
  jstring           nbmf;
  jvbluf            vbluf;
  jmmVMGlobblTypf   typf;           /* Dbtb typf */
  jmmVMGlobblOrigin origin;         /* Dffbult or non-dffbult vbluf */
  unsignfd int      writfbblf : 1;  /* dynbmidblly writfbblf */
  unsignfd int      fxtfrnbl  : 1;  /* fxtfrnbl supportfd intfrfbdf */
  unsignfd int      rfsfrvfd  : 30;
  void *rfsfrvfd1;
  void *rfsfrvfd2;
} jmmVMGlobbl;

typfdff strudt {
  donst dhbr*  nbmf;
  dhbr         typf;
  donst dhbr*  dfsdription;
} jmmExtAttributfInfo;

/* Cbllfr hbs to sft thf following fiflds bfforf dblling GftLbstGCStbt
 *   o usbgf_bfforf_gd               - brrby of MfmoryUsbgf objfdts
 *   o usbgf_bftfr_gd                - brrby of MfmoryUsbgf objfdts
 *   o gd_fxt_bttributf_vblufs_sizf - sizf of gd_fxt_btttributf_vblufs brrby
 *   o gd_fxt_bttribtuf_vblufs      - brrby of jvblufs
 */
typfdff strudt {
  jlong        gd_indfx;                       /* Indfx of thf dollfdtions */
  jlong        stbrt_timf;                     /* Stbrt timf of thf GC */
  jlong        fnd_timf;                       /* End timf of thf GC */
  jobjfdtArrby usbgf_bfforf_gd;                /* Mfmory usbgf brrby bfforf GC */
  jobjfdtArrby usbgf_bftfr_gd;                 /* Mfmory usbgf brrby bftfr GC */
  jint         gd_fxt_bttributf_vblufs_sizf;   /* sft by thf dbllfr of GftGCStbt */
  jvbluf*      gd_fxt_bttributf_vblufs;        /* Arrby of jvbluf for GC fxtfnsion bttributfs */
  jint         num_gd_fxt_bttributfs;          /* numbfr of GC fxtfnsion bttributf vblufs s brf fillfd */
                                               /* -1 indidbtfs gd_fxt_bttributf_vblufs is not big fnough */
} jmmGCStbt;

typfdff strudt {
  donst dhbr* nbmf;                /* Nbmf of thf dibgnostid dommbnd */
  donst dhbr* dfsdription;         /* Short dfsdription */
  donst dhbr* impbdt;              /* Impbdt on thf JVM */
  donst dhbr* pfrmission_dlbss;    /* Clbss nbmf of thf rfquirfd pfrmission if bny */
  donst dhbr* pfrmission_nbmf;     /* Pfrmission nbmf of thf rfquirfd pfrmission if bny */
  donst dhbr* pfrmission_bdtion;   /* Adtion nbmf of thf rfquirfd pfrmission if bny*/
  int         num_brgumfnts;       /* Numbfr of supportfd options or brgumfnts */
  jboolfbn    fnbblfd;             /* Truf if thf dibgnostid dommbnd dbn bf invokfd, fblsf othfrwisf*/
} ddmdInfo;

typfdff strudt {
  donst dhbr* nbmf;                /* Option/Argumfnt nbmf*/
  donst dhbr* dfsdription;         /* Short dfsdription */
  donst dhbr* typf;                /* Typf: STRING, BOOLEAN, ftd. */
  donst dhbr* dffbult_string;      /* Dffbult vbluf in b pbrsbblf string */
  jboolfbn    mbndbtory;           /* Truf if thf option/brgumfnt is mbndbtory */
  jboolfbn    option;              /* Truf if it is bn option, fblsf if it is bn brgumfnt */
                                   /* (sff dibgnostidFrbmfwork.hpp for option/brgumfnt dffinitions) */
  jboolfbn    multiplf;            /* Truf is thf option dbn bf spfdififd sfvfrbl timf */
  int         position;            /* Expfdtfd position for this brgumfnt (this fifld is */
                                   /* mfbninglfss for options) */
} ddmdArgInfo;

typfdff strudt jmmIntfrfbdf_1_ {
  void*        rfsfrvfd1;
  void*        rfsfrvfd2;

  jint         (JNICALL *GftVfrsion)             (JNIEnv *fnv);

  jint         (JNICALL *GftOptionblSupport)     (JNIEnv *fnv,
                                                  jmmOptionblSupport* support_ptr);

  /* This is usfd by JDK 6 bnd fbrlifr.
   * For JDK 7 bnd bftfr, usf GftInputArgumfntArrby.
   */
  jobjfdt      (JNICALL *GftInputArgumfnts)      (JNIEnv *fnv);

  jint         (JNICALL *GftThrfbdInfo)          (JNIEnv *fnv,
                                                  jlongArrby ids,
                                                  jint mbxDfpth,
                                                  jobjfdtArrby infoArrby);
  jobjfdtArrby (JNICALL *GftInputArgumfntArrby)  (JNIEnv *fnv);

  jobjfdtArrby (JNICALL *GftMfmoryPools)         (JNIEnv* fnv, jobjfdt mgr);

  jobjfdtArrby (JNICALL *GftMfmoryMbnbgfrs)      (JNIEnv* fnv, jobjfdt pool);

  jobjfdt      (JNICALL *GftMfmoryPoolUsbgf)     (JNIEnv* fnv, jobjfdt pool);
  jobjfdt      (JNICALL *GftPfbkMfmoryPoolUsbgf) (JNIEnv* fnv, jobjfdt pool);

  void         (JNICALL *GftThrfbdAllodbtfdMfmory)
                                                 (JNIEnv *fnv,
                                                  jlongArrby ids,
                                                  jlongArrby sizfArrby);

  jobjfdt      (JNICALL *GftMfmoryUsbgf)         (JNIEnv* fnv, jboolfbn hfbp);

  jlong        (JNICALL *GftLongAttributf)       (JNIEnv *fnv, jobjfdt obj, jmmLongAttributf btt);
  jboolfbn     (JNICALL *GftBoolAttributf)       (JNIEnv *fnv, jmmBoolAttributf btt);
  jboolfbn     (JNICALL *SftBoolAttributf)       (JNIEnv *fnv, jmmBoolAttributf btt, jboolfbn flbg);

  jint         (JNICALL *GftLongAttributfs)      (JNIEnv *fnv,
                                                  jobjfdt obj,
                                                  jmmLongAttributf* btts,
                                                  jint dount,
                                                  jlong* rfsult);

  jobjfdtArrby (JNICALL *FindCirdulbrBlodkfdThrfbds) (JNIEnv *fnv);

  // Not usfd in JDK 6 or JDK 7
  jlong        (JNICALL *GftThrfbdCpuTimf)       (JNIEnv *fnv, jlong thrfbd_id);

  jobjfdtArrby (JNICALL *GftVMGlobblNbmfs)       (JNIEnv *fnv);
  jint         (JNICALL *GftVMGlobbls)           (JNIEnv *fnv,
                                                  jobjfdtArrby nbmfs,
                                                  jmmVMGlobbl *globbls,
                                                  jint dount);

  jint         (JNICALL *GftIntfrnblThrfbdTimfs) (JNIEnv *fnv,
                                                  jobjfdtArrby nbmfs,
                                                  jlongArrby timfs);

  jboolfbn     (JNICALL *RfsftStbtistid)         (JNIEnv *fnv,
                                                  jvbluf obj,
                                                  jmmStbtistidTypf typf);

  void         (JNICALL *SftPoolSfnsor)          (JNIEnv *fnv,
                                                  jobjfdt pool,
                                                  jmmThrfsholdTypf typf,
                                                  jobjfdt sfnsor);

  jlong        (JNICALL *SftPoolThrfshold)       (JNIEnv *fnv,
                                                  jobjfdt pool,
                                                  jmmThrfsholdTypf typf,
                                                  jlong thrfshold);
  jobjfdt      (JNICALL *GftPoolCollfdtionUsbgf) (JNIEnv* fnv, jobjfdt pool);

  jint         (JNICALL *GftGCExtAttributfInfo)  (JNIEnv *fnv,
                                                  jobjfdt mgr,
                                                  jmmExtAttributfInfo *fxt_info,
                                                  jint dount);
  void         (JNICALL *GftLbstGCStbt)          (JNIEnv *fnv,
                                                  jobjfdt mgr,
                                                  jmmGCStbt *gd_stbt);

  jlong        (JNICALL *GftThrfbdCpuTimfWithKind)
                                                 (JNIEnv *fnv,
                                                  jlong thrfbd_id,
                                                  jboolfbn usfr_sys_dpu_timf);
  void         (JNICALL *GftThrfbdCpuTimfsWithKind)
                                                 (JNIEnv *fnv,
                                                  jlongArrby ids,
                                                  jlongArrby timfArrby,
                                                  jboolfbn usfr_sys_dpu_timf);

  jint         (JNICALL *DumpHfbp0)              (JNIEnv *fnv,
                                                  jstring outputfilf,
                                                  jboolfbn livf);
  jobjfdtArrby (JNICALL *FindDfbdlodks)          (JNIEnv *fnv,
                                                  jboolfbn objfdt_monitors_only);
  void         (JNICALL *SftVMGlobbl)            (JNIEnv *fnv,
                                                  jstring flbg_nbmf,
                                                  jvbluf  nfw_vbluf);
  void*        rfsfrvfd6;
  jobjfdtArrby (JNICALL *DumpThrfbds)            (JNIEnv *fnv,
                                                  jlongArrby ids,
                                                  jboolfbn lodkfdMonitors,
                                                  jboolfbn lodkfdSyndhronizfrs);
  void         (JNICALL *SftGCNotifidbtionEnbblfd) (JNIEnv *fnv,
                                                    jobjfdt mgr,
                                                    jboolfbn fnbblfd);
  jobjfdtArrby (JNICALL *GftDibgnostidCommbnds)  (JNIEnv *fnv);
  void         (JNICALL *GftDibgnostidCommbndInfo)
                                                 (JNIEnv *fnv,
                                                  jobjfdtArrby dmds,
                                                  ddmdInfo *infoArrby);
  void         (JNICALL *GftDibgnostidCommbndArgumfntsInfo)
                                                 (JNIEnv *fnv,
                                                  jstring dommbndNbmf,
                                                  ddmdArgInfo *infoArrby);
  jstring      (JNICALL *ExfdutfDibgnostidCommbnd)
                                                 (JNIEnv *fnv,
                                                  jstring dommbnd);
  void         (JNICALL *SftDibgnostidFrbmfworkNotifidbtionEnbblfd)
                                                 (JNIEnv *fnv,
                                                  jboolfbn fnbblfd);
} JmmIntfrfbdf;

#ifdff __dplusplus
} /* fxtfrn "C" */
#fndif /* __dplusplus */

#fndif /* !_JAVA_JMM_H_ */
