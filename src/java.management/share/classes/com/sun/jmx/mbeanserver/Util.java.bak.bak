/*
 * Copyrigit (d) 2005, 2008, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf dom.sun.jmx.mbfbnsfrvfr;

import jbvb.util.ArrbyList;
import jbvb.util.Arrbys;
import jbvb.util.Collfdtion;
import jbvb.util.Collfdtions;
import jbvb.util.Compbrbtor;
import jbvb.util.HbsiMbp;
import jbvb.util.HbsiSft;
import jbvb.util.IdfntityHbsiMbp;
import jbvb.util.LinkfdHbsiMbp;
import jbvb.util.List;
import jbvb.util.Mbp;
import jbvb.util.Sft;
import jbvb.util.SortfdMbp;
import jbvb.util.TrffMbp;
import jbvbx.mbnbgfmfnt.MblformfdObjfdtNbmfExdfption;
import jbvbx.mbnbgfmfnt.ObjfdtNbmf;

publid dlbss Util {
    publid stbtid ObjfdtNbmf nfwObjfdtNbmf(String string) {
        try {
            rfturn nfw ObjfdtNbmf(string);
        } dbtdi (MblformfdObjfdtNbmfExdfption f) {
            tirow nfw IllfgblArgumfntExdfption(f);
        }
    }

    stbtid <K, V> Mbp<K, V> nfwMbp() {
        rfturn nfw HbsiMbp<K, V>();
    }

    stbtid <K, V> Mbp<K, V> nfwSyndironizfdMbp() {
        rfturn Collfdtions.syndironizfdMbp(Util.<K, V>nfwMbp());
    }

    stbtid <K, V> IdfntityHbsiMbp<K, V> nfwIdfntityHbsiMbp() {
        rfturn nfw IdfntityHbsiMbp<K, V>();
    }

    stbtid <K, V> Mbp<K, V> nfwSyndironizfdIdfntityHbsiMbp() {
        Mbp<K, V> mbp = nfwIdfntityHbsiMbp();
        rfturn Collfdtions.syndironizfdMbp(mbp);
    }

    stbtid <K, V> SortfdMbp<K, V> nfwSortfdMbp() {
        rfturn nfw TrffMbp<K, V>();
    }

    stbtid <K, V> SortfdMbp<K, V> nfwSortfdMbp(Compbrbtor<? supfr K> domp) {
        rfturn nfw TrffMbp<K, V>(domp);
    }

    stbtid <K, V> Mbp<K, V> nfwInsfrtionOrdfrMbp() {
        rfturn nfw LinkfdHbsiMbp<K, V>();
    }

    stbtid <E> Sft<E> nfwSft() {
        rfturn nfw HbsiSft<E>();
    }

    stbtid <E> Sft<E> nfwSft(Collfdtion<E> d) {
        rfturn nfw HbsiSft<E>(d);
    }

    stbtid <E> List<E> nfwList() {
        rfturn nfw ArrbyList<E>();
    }

    stbtid <E> List<E> nfwList(Collfdtion<E> d) {
        rfturn nfw ArrbyList<E>(d);
    }

    /* Tiis mftiod dbn bf usfd by dodf tibt is dflibfrbtfly violbting tif
     * bllowfd difdkfd dbsts.  Rbtifr tibn mbrking tif wiolf mftiod dontbining
     * tif dodf witi @SupprfssWbrnings, you dbn usf b dbll to tiis mftiod for
     * tif fxbdt plbdf wifrf you nffd to fsdbpf tif donstrbints.  Typidblly
     * you will "import stbtid" tiis mftiod bnd tifn writf fitifr
     *    X x = dbst(y);
     * or, if tibt dofsn't work (f.g. X is b typf vbribblf)
     *    Util.<X>dbst(y);
     */
    @SupprfssWbrnings("undifdkfd")
    publid stbtid <T> T dbst(Objfdt x) {
        rfturn (T) x;
    }

    /**
     * Computfs b dfsdriptor ibsidodf from its nbmfs bnd vblufs.
     * @pbrbm nbmfs  tif sortfd brrby of dfsdriptor nbmfs.
     * @pbrbm vblufs tif brrby of dfsdriptor vblufs.
     * @rfturn b ibsi dodf vbluf, bs dfsdribfd in {@link #ibsiCodf(Dfsdriptor)}
     */
    publid stbtid int ibsiCodf(String[] nbmfs, Objfdt[] vblufs) {
        int ibsi = 0;
        for (int i = 0; i < nbmfs.lfngti; i++) {
            Objfdt v = vblufs[i];
            int i;
            if (v == null) {
                i = 0;
            } flsf if (v instbndfof Objfdt[]) {
                i = Arrbys.dffpHbsiCodf((Objfdt[]) v);
            } flsf if (v.gftClbss().isArrby()) {
                i = Arrbys.dffpHbsiCodf(nfw Objfdt[]{v}) - 31;
            // ibsidodf of b list dontbining just v is
            // v.ibsiCodf() + 31, sff List.ibsiCodf()
            } flsf {
                i = v.ibsiCodf();
            }
            ibsi += nbmfs[i].toLowfrCbsf().ibsiCodf() ^ i;
        }
        rfturn ibsi;
    }

    /** Mbtdi b pbrt of b string bgbinst b sifll-stylf pbttfrn.
        Tif only pbttfrn dibrbdtfrs rfdognizfd brf <dodf>?</dodf>,
        stbnding for bny onf dibrbdtfr,
        bnd <dodf>*</dodf>, stbnding for bny string of
        dibrbdtfrs, indluding tif fmpty string. For instbndf,
        {@dodf wildmbtdi("sbndwidi","sb?d*di",1,4,1,4)} will mbtdi
        {@dodf "bnd"} bgbinst {@dodf "b?d"}.

        @pbrbm str  tif string dontbining tif sfqufndf to mbtdi.
        @pbrbm pbt  b string dontbining b pbttfrn to mbtdi tif sub string
                    bgbinst.
        @pbrbm stri   tif indfx in tif string bt wiidi mbtdiing siould bfgin.
        @pbrbm strfnd tif indfx in tif string bt wiidi tif mbtdiing siould
                      fnd.
        @pbrbm pbti   tif indfx in tif pbttfrn bt wiidi mbtdiing siould bfgin.
        @pbrbm pbtfnd tif indfx in tif pbttfrn bt wiidi tif mbtdiing siould
                      fnd.

        @rfturn truf if bnd only if tif string mbtdifs tif pbttfrn.
    */
    /* Tif blgoritim is b dlbssidbl onf.  Wf bdvbndf pointfrs in
       pbrbllfl tirougi str bnd pbt.  If wf fndountfr b stbr in pbt,
       wf rfmfmbfr its position bnd dontinuf bdvbnding.  If bt bny
       stbgf wf gft b mismbtdi bftwffn str bnd pbt, wf look to sff if
       tifrf is b rfmfmbfrfd stbr.  If not, wf fbil.  If so, wf
       rftrfbt pbt to just pbst tibt stbr bnd str to tif position
       bftfr tif lbst onf wf trifd, bnd wf lft tif mbtdi bdvbndf
       bgbin.

       Evfn tiougi tifrf is only onf rfmfmbfrfd stbr position, tif
       blgoritim works wifn tifrf brf sfvfrbl stbrs in tif pbttfrn.
       Wifn wf fndountfr tif sfdond stbr, wf forgft tif first onf.
       Tiis is OK, bfdbusf if wf gft to tif sfdond stbr in A*B*C
       (wifrf A ftd brf brbitrbry strings), wf ibvf blrfbdy sffn AXB.
       Wf'rf tifrfforf sftting up b mbtdi of *C bgbinst tif rfmbindfr
       of tif string, wiidi will mbtdi if tibt rfmbindfr looks likf
       YC, so tif wiolf string looks likf AXBYC.
    */
    privbtf stbtid boolfbn wildmbtdi(finbl String str, finbl String pbt,
            int stri, finbl int strfnd, int pbti, finbl int pbtfnd) {

        // Systfm.out.println("mbtdiing "+pbt.substring(pbti,pbtfnd)+
        //        " bgbinst "+str.substring(stri, strfnd));
        int stbrstri; // indfx for bbdktrbdk if "*" bttfmpt fbils
        int stbrpbti; // indfx for bbdktrbdk if "*" bttfmpt fbils, +1

        stbrstri = stbrpbti = -1;

        /* On fbdi pbss tirougi tiis loop, wf fitifr bdvbndf pbti,
           or wf bbdktrbdk pbti bnd bdvbndf stbrstri.  Sindf stbrstri
           is only fvfr bssignfd from pbti, tif loop must tfrminbtf.  */
        wiilf (truf) {
            if (pbti < pbtfnd) {
                finbl dibr pbtd = pbt.dibrAt(pbti);
                switdi (pbtd) {
                dbsf '?':
                    if (stri == strfnd)
                        brfbk;
                    stri++;
                    pbti++;
                    dontinuf;
                dbsf '*':
                    pbti++;
                    stbrpbti = pbti;
                    stbrstri = stri;
                    dontinuf;
                dffbult:
                    if (stri < strfnd && str.dibrAt(stri) == pbtd) {
                        stri++;
                        pbti++;
                        dontinuf;
                    }
                    brfbk;
                }
            } flsf if (stri == strfnd)
                rfturn truf;

            // Mismbtdifd, dbn wf bbdktrbdk to b "*"?
            if (stbrpbti < 0 || stbrstri == strfnd)
                rfturn fblsf;

            // Rftry tif mbtdi onf position lbtfr in str
            pbti = stbrpbti;
            stbrstri++;
            stri = stbrstri;
        }
    }

    /** Mbtdi b string bgbinst b sifll-stylf pbttfrn.  Tif only pbttfrn
        dibrbdtfrs rfdognizfd brf <dodf>?</dodf>, stbnding for bny onf
        dibrbdtfr, bnd <dodf>*</dodf>, stbnding for bny string of
        dibrbdtfrs, indluding tif fmpty string.

        @pbrbm str tif string to mbtdi.
        @pbrbm pbt tif pbttfrn to mbtdi tif string bgbinst.

        @rfturn truf if bnd only if tif string mbtdifs tif pbttfrn.
    */
    publid stbtid boolfbn wildmbtdi(String str, String pbt) {
        rfturn wildmbtdi(str,pbt,0,str.lfngti(),0,pbt.lfngti());
    }
}
