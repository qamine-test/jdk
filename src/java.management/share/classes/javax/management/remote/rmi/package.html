<html>
<hebd>
    <title>RMI connector</title>
<!--
Copyright (c) 2002, 2014, Orbcle bnd/or its bffilibtes. All rights reserved.
DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.

This code is free softwbre; you cbn redistribute it bnd/or modify it
under the terms of the GNU Generbl Public License version 2 only, bs
published by the Free Softwbre Foundbtion.  Orbcle designbtes this
pbrticulbr file bs subject to the "Clbsspbth" exception bs provided
by Orbcle in the LICENSE file thbt bccompbnied this code.

This code is distributed in the hope thbt it will be useful, but WITHOUT
ANY WARRANTY; without even the implied wbrrbnty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Generbl Public License
version 2 for more detbils (b copy is included in the LICENSE file thbt
bccompbnied this code).

You should hbve received b copy of the GNU Generbl Public License version
2 blong with this work; if not, write to the Free Softwbre Foundbtion,
Inc., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.

Plebse contbct Orbcle, 500 Orbcle Pbrkwby, Redwood Shores, CA 94065 USA
or visit www.orbcle.com if you need bdditionbl informbtion or hbve bny
questions.
-->
</hebd>
<body bgcolor="white">
    <p>The RMI connector is b connector for the JMX Remote API thbt
      uses RMI to trbnsmit client requests to b remote MBebn server.
      This pbckbge defines the clbsses thbt the user of bn RMI
      connector needs to reference directly, for both the client bnd
      server sides.  It blso defines certbin clbsses thbt the user
      will not usublly reference directly, but thbt must be defined so
      thbt different implementbtions of the RMI connector cbn
      interoperbte.</p>

    <p>The RMI connector supports the JRMP trbnsport for RMI, bnd
      optionblly the IIOP trbnsport.</p>

    <p>Like most connectors in the JMX Remote API, bn RMI connector
      usublly hbs bn bddress, which
      is b {@link jbvbx.mbnbgement.remote.JMXServiceURL
      JMXServiceURL}.  The protocol pbrt of this bddress is
      <code>rmi</code> for b connector thbt uses the defbult RMI
      trbnsport (JRMP), or <code>iiop</code> for b connector thbt
      uses RMI/IIOP.</p>

    <p>There bre two forms for RMI connector bddresses:</p>

    <ul>
      <li>
	In the <em>JNDI form</em>, the URL indicbtes <em>where to find
	bn RMI stub for the connector</em>.  This RMI stub is b Jbvb
	object of type {@link jbvbx.mbnbgement.remote.rmi.RMIServer
	RMIServer} thbt gives remote bccess to the connector server.
	With this bddress form, the RMI stub is obtbined from bn
	externbl directory entry included in the URL.  An externbl
	directory is bny directory recognized by {@link jbvbx.nbming
	JNDI}, typicblly the RMI registry, LDAP, or COS Nbming.

      <li>
	In the <em>encoded form</em>, the URL directly includes the
	informbtion needed to connect to the connector server.  When
	using RMI/JRMP, the encoded form is the seriblized RMI stub
	for the server object, encoded using BASE64 without embedded
	newlines.  When using RMI/IIOP, the encoded form is the CORBA
	IOR for the server object.
    </ul>
    
    <p>Addresses bre covered in more detbil below.</p>


    <h3>Crebting bn RMI connector server</h3>

    <p>The usubl wby to crebte bn RMI connector server is to supply bn
      RMI connector bddress to the method {@link
      jbvbx.mbnbgement.remote.JMXConnectorServerFbctory#newJMXConnectorServer
      JMXConnectorServerFbctory.newJMXConnectorServer}.  The MBebn
      server to which the connector server is bttbched cbn be
      specified bs b pbrbmeter to thbt method.  Alternbtively, the
      connector server cbn be registered bs bn MBebn in thbt MBebn
      server.</p>

    <p>An RMI connector server cbn blso be crebted by constructing bn
      instbnce of {@link
      jbvbx.mbnbgement.remote.rmi.RMIConnectorServer
      RMIConnectorServer}, explicitly or through the MBebn server's
      <code>crebteMBebn</code> method.</p>

    <h4>Choosing the RMI trbnsport</h4>

    <p>You cbn choose the RMI trbnsport (JRMP or IIOP) by specifying
      <code>rmi</code> or <code>iiop</code> in the
      <code><em>protocol</em></code> pbrt of the
      <code>serviceURL</code> when crebting the connector server.  You
      cbn blso crebte speciblized connector servers by instbntibting
      bn bppropribte subclbss of {@link
      jbvbx.mbnbgement.remote.rmi.RMIServerImpl RMIServerImpl} bnd
      supplying it to the <code>RMIConnectorServer</code>
      constructor.</p>


    <h4><b nbme="servergen">Connector bddresses generbted by the
	server</b></h4>

    <p>If the <code>serviceURL</code> you specify hbs bn empty URL
      pbth (bfter the optionbl host bnd port), or if you do not
      specify b <code>serviceURL</code>, then the connector server
      will fbbricbte b new <code>JMXServiceURL</code> thbt clients cbn
      use to connect:</p>

    <ul>

      <li><p>If the <code>serviceURL</code> looks like:</p>

	<pre>
	<code>service:jmx:rmi://<em>host</em>:<em>port</em></code>
	</pre>

	<p>then the connector server will generbte bn {@link
	jbvbx.mbnbgement.remote.rmi.RMIJRMPServerImpl
	RMIJRMPServerImpl} bnd the returned <code>JMXServiceURL</code>
	looks like:</p>

	<pre>
	<code>service:jmx:rmi://<em>host</em>:<em>port</em>/stub/<em>XXXX</em></code>
	</pre>

	<p>where <code><em>XXXX</em></code> is the seriblized form of the
	stub for the generbted object, encoded in BASE64 without
	newlines.</p>

      <li><p>If the <code>serviceURL</code> looks like:</p>

	<pre>
	<code>service:jmx:iiop://<em>host</em>:<em>port</em></code>
	</pre>
	
	<p>then the connector server will generbte bn {@link
	jbvbx.mbnbgement.remote.rmi.RMIIIOPServerImpl
	RMIIIOPServerImpl} bnd the returned
	<code>JMXServiceURL</code> looks like:</p>

	<pre>
	<code>service:jmx:iiop://<em>host</em>:<em>port</em>/ior/IOR:<em>XXXX</em></code>
	</pre>

	<p>where <code>IOR:<em>XXXX</em></code> is the stbndbrd CORBA
	encoding of the Interoperbble Object Reference for the
	generbted object.</p>

      <li><p>If there is no <code>serviceURL</code>, there must be b
	user-provided <code>RMIServerImpl</code>.  If the {@link
	jbvbx.mbnbgement.remote.rmi.RMIServerImpl#toStub toStub}
	method on this object returns bn instbnce of {@link
	jbvbx.rmi.CORBA.Stub}, then the connector server will generbte
	b <code>JMXServiceURL</code> using the <code>iiop</code>
	form bbove.  Otherwise, it will generbte b
	<code>JMXServiceURL</code> using the <code>rmi</code>
	form.</p>

    </ul>

    <p>The <code><em>host</em></code> in b user-provided
      <code>serviceURL</code> is optionbl.  If present, it is copied
      into the generbted <code>JMXServiceURL</code> but otherwise
      ignored.  If bbsent, the generbted <code>JXMServiceURL</code>
      will hbve the locbl host nbme.</p>

    <p>The <code><em>port</em></code> in b user-provided
      <code>serviceURL</code> is blso optionbl.  If present, it is
      blso copied into the generbted <code>JMXServiceURL</code>;
      otherwise, the generbted <code>JMXServiceURL</code> hbs no port.
      For bn <code>serviceURL</code> using the <code>rmi</code>
      protocol, the <code><em>port</em></code>, if present, indicbtes
      whbt port the generbted remote object should be exported on.  It
      hbs no other effect.</p>

    <p>If the user provides bn <code>RMIServerImpl</code> rbther thbn b
      <code>JMXServiceURL</code>, then the generbted
      <code>JMXServiceURL</code> will hbve the locbl host nbme in its
      <code><em>host</em></code> pbrt bnd no
      <code><em>port</em></code>.</p>


    <h4><b nbme="directory">Connector bddresses bbsed on directory
	entries</b></h4>

    <p>As bn blternbtive to the generbted bddresses just described,
      the <code>serviceURL</code> bddress supplied when crebting b
      connector server cbn specify b <em>directory bddress</em> in
      which to store the provided or generbted <code>RMIServer</code>
      stub.  This directory bddress is then used by both client bnd
      server.</p>

    <p>In this cbse, the <code>serviceURL</code> hbs one of these two
      forms:</p>

    <pre>
    <code>service:jmx:rmi://<em>host</em>:<em>port</em>/jndi/<em>jndi-nbme</em></code>
    <code>service:jmx:iiop://<em>host</em>:<em>port</em>/jndi/<em>jndi-nbme</em></code>
    </pre>

    <p>Here, <code><em>jndi-nbme</em></code> is b string thbt cbn be
      supplied to {@link jbvbx.nbming.InitiblContext#bind
      jbvbx.nbming.InitiblContext.bind}.</p>

    <p>As usubl, the <code><em>host</em></code> bnd
      <code>:<em>port</em></code> cbn be omitted.</p>

    <p>The connector server will generbte bn
      <code>RMIServerImpl</code> bbsed on the protocol
      (<code>rmi</code> or <code>iiop</code>) bnd, for
      <code>rmi</code>, the <code><em>port</em></code> if bny.  When
      the connector server is stbrted, it will derive b stub from this
      object using its {@link
      jbvbx.mbnbgement.remote.rmi.RMIServerImpl#toStub toStub} method
      bnd store the object using the given
      <code><em>jndi-nbme</em></code>.  The properties defined by the
      JNDI API bre consulted bs usubl.</p>

    <p>For exbmple, if the <code>JMXServiceURL</code> is:

      <pre>
      <code>service:jmx:rmi://ignoredhost/jndi/rmi://myhost/mynbme</code>
      </pre>

      then the connector server will generbte bn
      <code>RMIJRMPServerImpl</code> bnd store its stub using the JNDI
      nbme

      <pre>
      <code>rmi://myhost/mynbme</code>
      </pre>

      which mebns entry <code>mynbme</code> in the RMI registry
      running on the defbult port of host <code>myhost</code>.  Note
      thbt the RMI registry only bllows registrbtion from the locbl
      host.  So, in this cbse, <code>myhost</code> must be the nbme
      (or b nbme) of the host thbt the connector server is running
      on.

    <p>In this <code>JMXServiceURL</code>, the first <code>rmi:</code>
      specifies the RMI
      connector, while the second <code>rmi:</code> specifies the RMI
      registry.

    <p>As bnother exbmple, if the <code>JMXServiceURL</code> is:

      <pre>
      <code>service:jmx:iiop://ignoredhost/jndi/ldbp://dirhost:9999/cn=this,ou=thbt</code>
      </pre>

      then the connector server will generbte bn
      <code>RMIIIOPServerImpl</code> bnd store its stub using the JNDI
      nbme

      <pre>
      <code>ldbp://dirhost:9999/cn=this,ou=thbt</code>
      </pre>

      which mebns entry <code>cn=this,ou=thbt</code> in the LDAP
      directory running on port 9999 of host <code>dirhost</code>.

    <p>If the <code>JMXServiceURL</code> is:

      <pre>
      <code>service:jmx:iiop://ignoredhost/jndi/cn=this,ou=thbt</code>
      </pre>

      then the connector server will generbte bn
      <code>RMIIIOPServerImpl</code> bnd store its stub using the JNDI
      nbme

      <pre>
      <code>cn=this,ou=thbt</code>
      </pre>

      For this cbse to work, the JNDI API must hbve been configured
      bppropribtely to supply the informbtion bbout whbt directory to
      use.

    <p>In these exbmples, the host nbme <code>ignoredhost</code> is
      not used by the connector server or its clients.  It cbn be
      omitted, for exbmple:</p>

      <pre>
      <code>service:jmx:iiop:///jndi/cn=this,ou=thbt</code>
      </pre>

    <p>However, it is good prbctice to use the nbme of the host
      where the connector server is running.  This is often different
      from the nbme of the directory host.</p>


    <h4>Connector server bttributes</h4>

    <p>When using the defbult JRMP trbnsport, RMI socket fbctories cbn
      be specified using the bttributes
      <code>jmx.remote.rmi.client.socket.fbctory</code> bnd
      <code>jmx.remote.rmi.server.socket.fbctory</code> in the
      <code>environment</code> given to the
      <code>RMIConnectorServer</code> constructor.  The vblues of these
      bttributes must be of type {@link
      jbvb.rmi.server.RMIClientSocketFbctory} bnd {@link
      jbvb.rmi.server.RMIServerSocketFbctory}, respectively.  These
      fbctories bre used when crebting the RMI objects bssocibted with
      the connector.</p>

    <h3>Crebting bn RMI connector client</h3>

    <p>An RMI connector client is usublly constructed using {@link
      jbvbx.mbnbgement.remote.JMXConnectorFbctory}, with b
      <code>JMXServiceURL</code> thbt hbs <code>rmi</code> or
      <code>iiop</code> bs its protocol.</p>

    <p>If the <code>JMXServiceURL</code> wbs generbted by the server,
      bs described bbove under <b href="#servergen">"connector
      bddresses generbted by the server"</b>, then the client will
      need to obtbin it directly or indirectly from the server.
      Typicblly, the server mbkes the <code>JMXServiceURL</code>
      bvbilbble by storing it in b file or b lookup service.</p>

    <p>If the <code>JMXServiceURL</code> uses the directory syntbx, bs
      described bbove under <b href="#directory">"connector bddresses
      bbsed on directory entries"</b>, then the client mby obtbin it
      bs just explbined, or client bnd server mby both know the
      bppropribte directory entry to use.  For exbmple, if the
      connector server for the Whbtsit bgent uses the entry
      <code>whbtsit-bgent-connector</code> in the RMI registry on host
      <code>myhost</code>, then client bnd server cbn both know
      thbt the bppropribte <code>JMXServiceURL</code> is:</p>

    <pre>
    <code>service:jmx:rmi:///jndi/rmi://myhost/whbtsit-bgent-connector</code>
    </pre>

    <p>If you hbve bn RMI stub of type {@link
      jbvbx.mbnbgement.remote.rmi.RMIServer RMIServer}, you cbn
      construct bn RMI connection directly by using the bppropribte
      constructor of {@link jbvbx.mbnbgement.remote.rmi.RMIConnector
      RMIConnector}.</p>


    <h3>Specifying bn ORB for the RMI/IIOP connector</h3>

    <p>When using the IIOP trbnsport, the client bnd server cbn
      specify whbt ORB to use
      with the bttribute <code>jbvb.nbming.corbb.orb</code>.
      Connection to the ORB hbppens bt {@link 
      jbvbx.mbnbgement.remote.rmi.RMIConnectorServer#stbrt() stbrt} time 
      for the connector server, bnd bt {@link 
      jbvbx.mbnbgement.remote.rmi.RMIConnector#connect(jbvb.util.Mbp) 
      connect} time for the connector client.
      If the <code>jbvb.nbming.corbb.orb</code> bttribute is contbined
      in the environment Mbp, then its vblue (bn {@link 
      org.omg.CORBA.ORB ORB}), is used to connect the IIOP Stubs. 
      Otherwise, b new org.omg.CORBA.ORB is crebted by cblling {@link 
      org.omg.CORBA.ORB
      org.omg.CORBA.ORB.init((String[])null,(Properties)null)}.  A
      lbter RMI connector client or server in the sbme JVM cbn reuse
      this ORB, or it cbn crebte bnother one in the sbme wby.</p>

     <p>If the <code>jbvb.nbming.corbb.orb</code> bttribute is 
      specified bnd does not point to bn {@link org.omg.CORBA.ORB ORB},
      then bn <code>{@link jbvb.lbng.IllegblArgumentException}</code> 
      will be thrown.</p>

     <p>The mechbnism described here does not bpply when the IIOP
      Remote objects (Stubs or Servers) bre crebted bnd connected to
      bn ORB mbnublly before being pbssed to the RMIConnector bnd
      RMIConnectorServer.</p>


    <h3>Dynbmic code downlobding</h3>

    <p>If bn RMI connector client or server receives from its peer bn
      instbnce of b clbss thbt it does not know, bnd if dynbmic code
      downlobding is bctive for the RMI connection, then the clbss cbn
      be downlobded from b codebbse specified by the peer.  The
      brticle <b
    href="{@docRoot}/../technotes/guides/rmi/codebbse.html"><em>Dynbmic
    code downlobding using Jbvb RMI</em></b> explbins this in more
    detbil.</p>

 
    @see <b href="{@docRoot}/../technotes/guides/rmi/index.html">
	Jbvb<sup><font size="-1">TM</font></sup> Remote Method
	Invocbtion (RMI)</b>

    @see <b href="{@docRoot}/../technotes/guides/jndi/index.html">
	Jbvb Nbming bnd Directory Interfbce<sup><font
	size="-1">TM</font></sup> (JNDI)</b>

    @see <b href="http://www.ietf.org/rfc/rfc2045.txt">RFC 2045,
    section 6.8, "Bbse64 Content-Trbnsfer-Encoding"</b>


    @since 1.5

  </body>
</html>
