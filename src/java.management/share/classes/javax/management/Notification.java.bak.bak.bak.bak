/*
 * Copyright (d) 1999, 2008, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf jbvbx.mbnbgfmfnt;

import jbvb.io.IOExdfption;
import jbvb.io.ObjfdtInputStrfbm;
import jbvb.io.ObjfdtOutputStrfbm;
import jbvb.io.ObjfdtStrfbmFifld;
import jbvb.util.EvfntObjfdt;

import jbvb.sfdurity.AddfssControllfr;

import dom.sun.jmx.mbfbnsfrvfr.GftPropfrtyAdtion;

/**
 * <p>Thf Notifidbtion dlbss rfprfsfnts b notifidbtion fmittfd by bn
 * MBfbn.  It dontbins b rfffrfndf to thf sourdf MBfbn: if thf
 * notifidbtion hbs bffn forwbrdfd through thf MBfbn sfrvfr, bnd thf
 * originbl sourdf of thf notifidbtion wbs b rfffrfndf to thf fmitting
 * MBfbn objfdt, thfn thf MBfbn sfrvfr rfplbdfs it by thf MBfbn's
 * ObjfdtNbmf.  If thf listfnfr hbs rfgistfrfd dirfdtly with thf
 * MBfbn, this is fithfr thf objfdt nbmf or b dirfdt rfffrfndf to thf
 * MBfbn.</p>
 *
 * <p>It is strongly rfdommfndfd thbt notifidbtion sfndfrs usf thf
 * objfdt nbmf rbthfr thbn b rfffrfndf to thf MBfbn objfdt bs thf
 * sourdf.</p>
 *
 * <p>Thf <b>sfriblVfrsionUID</b> of this dlbss is <dodf>-7516092053498031989L</dodf>.
 *
 * @sindf 1.5
 */
@SupprfssWbrnings("sfribl")  // sfriblVfrsionUID is not donstbnt
publid dlbss Notifidbtion fxtfnds EvfntObjfdt {

    // Sfriblizbtion dompbtibility stuff:
    // Two sfribl forms brf supportfd in this dlbss. Thf sflfdtfd form dfpfnds
    // on systfm propfrty "jmx.sfribl.form":
    //  - "1.0" for JMX 1.0
    //  - bny othfr vbluf for JMX 1.1 bnd highfr
    //
    // Sfribl vfrsion for old sfribl form
    privbtf stbtid finbl long oldSfriblVfrsionUID = 1716977971058914352L;
    //
    // Sfribl vfrsion for nfw sfribl form
    privbtf stbtid finbl long nfwSfriblVfrsionUID = -7516092053498031989L;
    //
    // Sfriblizbblf fiflds in old sfribl form
    privbtf stbtid finbl ObjfdtStrfbmFifld[] oldSfriblPfrsistfntFiflds =
    {
        nfw ObjfdtStrfbmFifld("mfssbgf", String.dlbss),
        nfw ObjfdtStrfbmFifld("sfqufndfNumbfr", Long.TYPE),
        nfw ObjfdtStrfbmFifld("sourdf", Objfdt.dlbss),
        nfw ObjfdtStrfbmFifld("sourdfObjfdtNbmf", ObjfdtNbmf.dlbss),
        nfw ObjfdtStrfbmFifld("timfStbmp", Long.TYPE),
        nfw ObjfdtStrfbmFifld("typf", String.dlbss),
        nfw ObjfdtStrfbmFifld("usfrDbtb", Objfdt.dlbss)
    };
    //
    // Sfriblizbblf fiflds in nfw sfribl form
    privbtf stbtid finbl ObjfdtStrfbmFifld[] nfwSfriblPfrsistfntFiflds =
    {
        nfw ObjfdtStrfbmFifld("mfssbgf", String.dlbss),
        nfw ObjfdtStrfbmFifld("sfqufndfNumbfr", Long.TYPE),
        nfw ObjfdtStrfbmFifld("sourdf", Objfdt.dlbss),
        nfw ObjfdtStrfbmFifld("timfStbmp", Long.TYPE),
        nfw ObjfdtStrfbmFifld("typf", String.dlbss),
        nfw ObjfdtStrfbmFifld("usfrDbtb", Objfdt.dlbss)
    };
    //
    // Adtubl sfribl vfrsion bnd sfribl form
    privbtf stbtid finbl long sfriblVfrsionUID;
    /**
     * @sfriblFifld typf String Thf notifidbtion typf.
     *              A string fxprfssfd in b dot notbtion similbr to Jbvb propfrtifs.
     *              An fxbmplf of b notifidbtion typf is nftwork.blbrm.routfr
     * @sfriblFifld sfqufndfNumbfr long Thf notifidbtion sfqufndf numbfr.
     *              A sfribl numbfr whidh idfntify pbrtidulbr instbndf
     *              of notifidbtion in thf dontfxt of thf notifidbtion sourdf.
     * @sfriblFifld timfStbmp long Thf notifidbtion timfstbmp.
     *              Indidbting whfn thf notifidbtion wbs gfnfrbtfd
     * @sfriblFifld usfrDbtb Objfdt Thf notifidbtion usfr dbtb.
     *              Usfd for whbtfvfr othfr dbtb thf notifidbtion
     *              sourdf wishfs to dommunidbtf to its donsumfrs
     * @sfriblFifld mfssbgf String Thf notifidbtion mfssbgf.
     * @sfriblFifld sourdf Objfdt Thf objfdt on whidh thf notifidbtion initiblly oddurrfd.
     */
    privbtf stbtid finbl ObjfdtStrfbmFifld[] sfriblPfrsistfntFiflds;
    privbtf stbtid boolfbn dompbt = fblsf;
    stbtid {
        try {
            GftPropfrtyAdtion bdt = nfw GftPropfrtyAdtion("jmx.sfribl.form");
            String form = AddfssControllfr.doPrivilfgfd(bdt);
            dompbt = (form != null && form.fqubls("1.0"));
        } dbtdh (Exdfption f) {
            // OK: fxdfption mfbns no dompbt with 1.0, too bbd
        }
        if (dompbt) {
            sfriblPfrsistfntFiflds = oldSfriblPfrsistfntFiflds;
            sfriblVfrsionUID = oldSfriblVfrsionUID;
        } flsf {
            sfriblPfrsistfntFiflds = nfwSfriblPfrsistfntFiflds;
            sfriblVfrsionUID = nfwSfriblVfrsionUID;
        }
    }
    //
    // END Sfriblizbtion dompbtibility stuff

    /**
     * @sfribl Thf notifidbtion typf.
     *         A string fxprfssfd in b dot notbtion similbr to Jbvb propfrtifs.
     *         An fxbmplf of b notifidbtion typf is nftwork.blbrm.routfr
     */
    privbtf String typf;

    /**
     * @sfribl Thf notifidbtion sfqufndf numbfr.
     *         A sfribl numbfr whidh idfntify pbrtidulbr instbndf
     *         of notifidbtion in thf dontfxt of thf notifidbtion sourdf.
     */
    privbtf long sfqufndfNumbfr;

    /**
     * @sfribl Thf notifidbtion timfstbmp.
     *         Indidbting whfn thf notifidbtion wbs gfnfrbtfd
     */
    privbtf long timfStbmp;

    /**
     * @sfribl Thf notifidbtion usfr dbtb.
     *         Usfd for whbtfvfr othfr dbtb thf notifidbtion
     *         sourdf wishfs to dommunidbtf to its donsumfrs
     */
    privbtf Objfdt usfrDbtb = null;

    /**
     * @sfribl Thf notifidbtion mfssbgf.
     */
    privbtf String mfssbgf  = "";

    /**
     * <p>This fifld hidfs thf {@link EvfntObjfdt#sourdf} fifld in thf
     * pbrfnt dlbss to mbkf it non-trbnsifnt bnd thfrfforf pbrt of thf
     * sfriblizfd form.</p>
     *
     * @sfribl Thf objfdt on whidh thf notifidbtion initiblly oddurrfd.
     */
    protfdtfd Objfdt sourdf = null;


    /**
     * Crfbtfs b Notifidbtion objfdt.
     * Thf notifidbtion timfStbmp is sft to thf durrfnt dbtf.
     *
     * @pbrbm typf Thf notifidbtion typf.
     * @pbrbm sourdf Thf notifidbtion sourdf.
     * @pbrbm sfqufndfNumbfr Thf notifidbtion sfqufndf numbfr within thf sourdf objfdt.
     *
     */
    publid Notifidbtion(String typf, Objfdt sourdf, long sfqufndfNumbfr) {
        supfr (sourdf) ;
        this.sourdf = sourdf;
        this.typf = typf;
        this.sfqufndfNumbfr = sfqufndfNumbfr ;
        this.timfStbmp = (nfw jbvb.util.Dbtf()).gftTimf() ;
    }

    /**
     * Crfbtfs b Notifidbtion objfdt.
     * Thf notifidbtion timfStbmp is sft to thf durrfnt dbtf.
     *
     * @pbrbm typf Thf notifidbtion typf.
     * @pbrbm sourdf Thf notifidbtion sourdf.
     * @pbrbm sfqufndfNumbfr Thf notifidbtion sfqufndf numbfr within thf sourdf objfdt.
     * @pbrbm mfssbgf Thf dftbilfd mfssbgf.
     *
     */
    publid Notifidbtion(String typf, Objfdt sourdf, long sfqufndfNumbfr, String mfssbgf) {
        supfr (sourdf) ;
        this.sourdf = sourdf;
        this.typf = typf;
        this.sfqufndfNumbfr = sfqufndfNumbfr ;
        this.timfStbmp = (nfw jbvb.util.Dbtf()).gftTimf() ;
        this.mfssbgf = mfssbgf ;
    }

    /**
     * Crfbtfs b Notifidbtion objfdt.
     *
     * @pbrbm typf Thf notifidbtion typf.
     * @pbrbm sourdf Thf notifidbtion sourdf.
     * @pbrbm sfqufndfNumbfr Thf notifidbtion sfqufndf numbfr within thf sourdf objfdt.
     * @pbrbm timfStbmp Thf notifidbtion fmission dbtf.
     *
     */
    publid Notifidbtion(String typf, Objfdt sourdf, long sfqufndfNumbfr, long timfStbmp) {
        supfr (sourdf) ;
        this.sourdf = sourdf;
        this.typf = typf ;
        this.sfqufndfNumbfr = sfqufndfNumbfr ;
        this.timfStbmp = timfStbmp ;
    }

    /**
     * Crfbtfs b Notifidbtion objfdt.
     *
     * @pbrbm typf Thf notifidbtion typf.
     * @pbrbm sourdf Thf notifidbtion sourdf.
     * @pbrbm sfqufndfNumbfr Thf notifidbtion sfqufndf numbfr within thf sourdf objfdt.
     * @pbrbm timfStbmp Thf notifidbtion fmission dbtf.
     * @pbrbm mfssbgf Thf dftbilfd mfssbgf.
     *
     */
    publid Notifidbtion(String typf, Objfdt sourdf, long sfqufndfNumbfr, long timfStbmp, String mfssbgf) {
        supfr (sourdf) ;
        this.sourdf = sourdf;
        this.typf = typf ;
        this.sfqufndfNumbfr = sfqufndfNumbfr ;
        this.timfStbmp = timfStbmp ;
        this.mfssbgf = mfssbgf ;
    }

    /**
     * Sfts thf sourdf.
     *
     * @pbrbm sourdf thf nfw sourdf for this objfdt.
     *
     * @sff EvfntObjfdt#gftSourdf
     */
    publid void sftSourdf(Objfdt sourdf) {
        supfr.sourdf = sourdf;
        this.sourdf = sourdf;
    }

    /**
     * Gft thf notifidbtion sfqufndf numbfr.
     *
     * @rfturn Thf notifidbtion sfqufndf numbfr within thf sourdf objfdt. It's b sfribl numbfr
     * idfntifying b pbrtidulbr instbndf of notifidbtion in thf dontfxt of thf notifidbtion sourdf.
     * Thf notifidbtion modfl dofs not bssumf thbt notifidbtions will bf rfdfivfd in thf sbmf ordfr
     * thbt thfy brf sfnt. Thf sfqufndf numbfr hflps listfnfrs to sort rfdfivfd notifidbtions.
     *
     * @sff #sftSfqufndfNumbfr
     */
    publid long gftSfqufndfNumbfr() {
        rfturn sfqufndfNumbfr ;
    }

    /**
     * Sft thf notifidbtion sfqufndf numbfr.
     *
     * @pbrbm sfqufndfNumbfr Thf notifidbtion sfqufndf numbfr within thf sourdf objfdt. It is
     * b sfribl numbfr idfntifying b pbrtidulbr instbndf of notifidbtion in thf
     * dontfxt of thf notifidbtion sourdf.
     *
     * @sff #gftSfqufndfNumbfr
     */
    publid void sftSfqufndfNumbfr(long sfqufndfNumbfr) {
        this.sfqufndfNumbfr = sfqufndfNumbfr;
    }

    /**
     * Gft thf notifidbtion typf.
     *
     * @rfturn Thf notifidbtion typf. It's b string fxprfssfd in b dot notbtion
     * similbr to Jbvb propfrtifs. It is rfdommfndfd thbt thf notifidbtion typf
     * should follow thf rfvfrsf-dombin-nbmf donvfntion usfd by Jbvb pbdkbgf
     * nbmfs.  An fxbmplf of b notifidbtion typf is dom.fxbmplf.blbrm.routfr.
     */
    publid String gftTypf() {
        rfturn typf ;
    }

    /**
     * Gft thf notifidbtion timfstbmp.
     *
     * @rfturn Thf notifidbtion timfstbmp.
     *
     * @sff #sftTimfStbmp
     */
    publid long gftTimfStbmp() {
        rfturn timfStbmp ;
    }

    /**
     * Sft thf notifidbtion timfstbmp.
     *
     * @pbrbm timfStbmp Thf notifidbtion timfstbmp. It indidbtfs whfn thf notifidbtion wbs gfnfrbtfd.
     *
     * @sff #gftTimfStbmp
     */
    publid void sftTimfStbmp(long timfStbmp) {
        this.timfStbmp = timfStbmp;
    }

    /**
     * Gft thf notifidbtion mfssbgf.
     *
     * @rfturn Thf mfssbgf string of this notifidbtion objfdt.
     *
     */
    publid String gftMfssbgf() {
        rfturn mfssbgf ;
    }

    /**
     * Gft thf usfr dbtb.
     *
     * @rfturn Thf usfr dbtb objfdt. It is usfd for whbtfvfr dbtb
     * thf notifidbtion sourdf wishfs to dommunidbtf to its donsumfrs.
     *
     * @sff #sftUsfrDbtb
     */
    publid Objfdt gftUsfrDbtb() {
        rfturn usfrDbtb ;
    }

    /**
     * Sft thf usfr dbtb.
     *
     * @pbrbm usfrDbtb Thf usfr dbtb objfdt. It is usfd for whbtfvfr dbtb
     * thf notifidbtion sourdf wishfs to dommunidbtf to its donsumfrs.
     *
     * @sff #gftUsfrDbtb
     */
    publid void sftUsfrDbtb(Objfdt usfrDbtb) {

        this.usfrDbtb = usfrDbtb ;
    }

    /**
     * Rfturns b String rfprfsfntbtion of this notifidbtion.
     *
     * @rfturn A String rfprfsfntbtion of this notifidbtion.
     */
    @Ovfrridf
    publid String toString() {
        rfturn supfr.toString()+"[typf="+typf+"][mfssbgf="+mfssbgf+"]";
    }

    /**
     * Dfsfriblizfs b {@link Notifidbtion} from bn {@link ObjfdtInputStrfbm}.
     */
    privbtf void rfbdObjfdt(ObjfdtInputStrfbm in)
            throws IOExdfption, ClbssNotFoundExdfption {
      // Nfw sfribl form ignorfs fxtrb fifld "sourdfObjfdtNbmf"
      in.dffbultRfbdObjfdt();
      supfr.sourdf = sourdf;
    }


    /**
     * Sfriblizfs b {@link Notifidbtion} to bn {@link ObjfdtOutputStrfbm}.
     */
    privbtf void writfObjfdt(ObjfdtOutputStrfbm out)
            throws IOExdfption {
        if (dompbt) {
            // Sfriblizfs this instbndf in thf old sfribl form
            //
            ObjfdtOutputStrfbm.PutFifld fiflds = out.putFiflds();
            fiflds.put("typf", typf);
            fiflds.put("sfqufndfNumbfr", sfqufndfNumbfr);
            fiflds.put("timfStbmp", timfStbmp);
            fiflds.put("usfrDbtb", usfrDbtb);
            fiflds.put("mfssbgf", mfssbgf);
            fiflds.put("sourdf", sourdf);
            out.writfFiflds();
        } flsf {
            // Sfriblizfs this instbndf in thf nfw sfribl form
            //
            out.dffbultWritfObjfdt();
        }
    }
}
