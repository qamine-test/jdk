/*
 * Copyrigit (d) 2000, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */


pbdkbgf jbvbx.mbnbgfmfnt.opfnmbfbn;


// jbvb import
//
import jbvb.util.Arrbys;
import jbvb.util.HbsiSft;
import jbvb.util.Objfdts;

import jbvbx.mbnbgfmfnt.Dfsdriptor;
import jbvbx.mbnbgfmfnt.MBfbnAttributfInfo;
import jbvbx.mbnbgfmfnt.MBfbnConstrudtorInfo;
import jbvbx.mbnbgfmfnt.MBfbnInfo;
import jbvbx.mbnbgfmfnt.MBfbnNotifidbtionInfo;
import jbvbx.mbnbgfmfnt.MBfbnOpfrbtionInfo;

/**
 * Tif {@dodf OpfnMBfbnInfoSupport} dlbss dfsdribfs tif mbnbgfmfnt
 * informbtion of bn <i>opfn MBfbn</i>: it is b subdlbss of {@link
 * jbvbx.mbnbgfmfnt.MBfbnInfo}, bnd it implfmfnts tif {@link
 * OpfnMBfbnInfo} intfrfbdf.  Notf tibt bn <i>opfn MBfbn</i> is
 * rfdognizfd bs sudi if its {@dodf gftMBfbnInfo()} mftiod rfturns bn
 * instbndf of b dlbss wiidi implfmfnts tif OpfnMBfbnInfo intfrfbdf,
 * typidblly {@dodf OpfnMBfbnInfoSupport}.
 *
 *
 * @sindf 1.5
 */
publid dlbss OpfnMBfbnInfoSupport
    fxtfnds MBfbnInfo
    implfmfnts OpfnMBfbnInfo {

    /* Sfribl vfrsion */
    stbtid finbl long sfriblVfrsionUID = 4349395935420511492L;

    // As tiis instbndf is immutbblf, tifsf two vblufs
    // nffd only bf dbldulbtfd ondf.
    privbtf trbnsifnt Intfgfr myHbsiCodf = null;
    privbtf trbnsifnt String  myToString = null;


    /**
     * <p>Construdts bn {@dodf OpfnMBfbnInfoSupport} instbndf, wiidi
     * dfsdribfs b dlbss of opfn MBfbns witi tif spfdififd {@dodf
     * dlbssNbmf}, {@dodf dfsdription}, {@dodf opfnAttributfs}, {@dodf
     * opfnConstrudtors} , {@dodf opfnOpfrbtions} bnd {@dodf
     * notifidbtions}.</p>
     *
     * <p>Tif {@dodf opfnAttributfs}, {@dodf opfnConstrudtors},
     * {@dodf opfnOpfrbtions} bnd {@dodf notifidbtions}
     * brrby pbrbmftfrs brf intfrnblly dopifd, so tibt subsfqufnt dibngfs
     * to tif brrbys rfffrfndfd by tifsf pbrbmftfrs ibvf no ffffdt on tiis
     * instbndf.</p>
     *
     * @pbrbm dlbssNbmf Tif fully qublififd Jbvb dlbss nbmf of tif
     * opfn MBfbn dfsdribfd by tiis <CODE>OpfnMBfbnInfoSupport</CODE>
     * instbndf.
     *
     * @pbrbm dfsdription A iumbn rfbdbblf dfsdription of tif opfn
     * MBfbn dfsdribfd by tiis <CODE>OpfnMBfbnInfoSupport</CODE>
     * instbndf.
     *
     * @pbrbm opfnAttributfs Tif list of fxposfd bttributfs of tif
     * dfsdribfd opfn MBfbn; Must bf bn brrby of instbndfs of b
     * subdlbss of {@dodf MBfbnAttributfInfo}, typidblly {@dodf
     * OpfnMBfbnAttributfInfoSupport}.
     *
     * @pbrbm opfnConstrudtors Tif list of fxposfd publid donstrudtors
     * of tif dfsdribfd opfn MBfbn; Must bf bn brrby of instbndfs of b
     * subdlbss of {@dodf MBfbnConstrudtorInfo}, typidblly {@dodf
     * OpfnMBfbnConstrudtorInfoSupport}.
     *
     * @pbrbm opfnOpfrbtions Tif list of fxposfd opfrbtions of tif
     * dfsdribfd opfn MBfbn.  Must bf bn brrby of instbndfs of b
     * subdlbss of {@dodf MBfbnOpfrbtionInfo}, typidblly {@dodf
     * OpfnMBfbnOpfrbtionInfoSupport}.
     *
     * @pbrbm notifidbtions Tif list of notifidbtions fmittfd by tif
     * dfsdribfd opfn MBfbn.
     *
     * @tirows ArrbyStorfExdfption If {@dodf opfnAttributfs}, {@dodf
     * opfnConstrudtors} or {@dodf opfnOpfrbtions} is not bn brrby of
     * instbndfs of b subdlbss of {@dodf MBfbnAttributfInfo}, {@dodf
     * MBfbnConstrudtorInfo} or {@dodf MBfbnOpfrbtionInfo}
     * rfspfdtivfly.
     */
    publid OpfnMBfbnInfoSupport(String dlbssNbmf,
                                String dfsdription,
                                OpfnMBfbnAttributfInfo[] opfnAttributfs,
                                OpfnMBfbnConstrudtorInfo[] opfnConstrudtors,
                                OpfnMBfbnOpfrbtionInfo[] opfnOpfrbtions,
                                MBfbnNotifidbtionInfo[] notifidbtions) {
        tiis(dlbssNbmf, dfsdription,
             opfnAttributfs, opfnConstrudtors, opfnOpfrbtions, notifidbtions,
             (Dfsdriptor) null);
    }

    /**
     * <p>Construdts bn {@dodf OpfnMBfbnInfoSupport} instbndf, wiidi
     * dfsdribfs b dlbss of opfn MBfbns witi tif spfdififd {@dodf
     * dlbssNbmf}, {@dodf dfsdription}, {@dodf opfnAttributfs}, {@dodf
     * opfnConstrudtors} , {@dodf opfnOpfrbtions}, {@dodf
     * notifidbtions}, bnd {@dodf dfsdriptor}.</p>
     *
     * <p>Tif {@dodf opfnAttributfs}, {@dodf opfnConstrudtors}, {@dodf
     * opfnOpfrbtions} bnd {@dodf notifidbtions} brrby pbrbmftfrs brf
     * intfrnblly dopifd, so tibt subsfqufnt dibngfs to tif brrbys
     * rfffrfndfd by tifsf pbrbmftfrs ibvf no ffffdt on tiis
     * instbndf.</p>
     *
     * @pbrbm dlbssNbmf Tif fully qublififd Jbvb dlbss nbmf of tif
     * opfn MBfbn dfsdribfd by tiis <CODE>OpfnMBfbnInfoSupport</CODE>
     * instbndf.
     *
     * @pbrbm dfsdription A iumbn rfbdbblf dfsdription of tif opfn
     * MBfbn dfsdribfd by tiis <CODE>OpfnMBfbnInfoSupport</CODE>
     * instbndf.
     *
     * @pbrbm opfnAttributfs Tif list of fxposfd bttributfs of tif
     * dfsdribfd opfn MBfbn; Must bf bn brrby of instbndfs of b
     * subdlbss of {@dodf MBfbnAttributfInfo}, typidblly {@dodf
     * OpfnMBfbnAttributfInfoSupport}.
     *
     * @pbrbm opfnConstrudtors Tif list of fxposfd publid donstrudtors
     * of tif dfsdribfd opfn MBfbn; Must bf bn brrby of instbndfs of b
     * subdlbss of {@dodf MBfbnConstrudtorInfo}, typidblly {@dodf
     * OpfnMBfbnConstrudtorInfoSupport}.
     *
     * @pbrbm opfnOpfrbtions Tif list of fxposfd opfrbtions of tif
     * dfsdribfd opfn MBfbn.  Must bf bn brrby of instbndfs of b
     * subdlbss of {@dodf MBfbnOpfrbtionInfo}, typidblly {@dodf
     * OpfnMBfbnOpfrbtionInfoSupport}.
     *
     * @pbrbm notifidbtions Tif list of notifidbtions fmittfd by tif
     * dfsdribfd opfn MBfbn.
     *
     * @pbrbm dfsdriptor Tif dfsdriptor for tif MBfbn.  Tiis mby bf null
     * wiidi is fquivblfnt to bn fmpty dfsdriptor.
     *
     * @tirows ArrbyStorfExdfption If {@dodf opfnAttributfs}, {@dodf
     * opfnConstrudtors} or {@dodf opfnOpfrbtions} is not bn brrby of
     * instbndfs of b subdlbss of {@dodf MBfbnAttributfInfo}, {@dodf
     * MBfbnConstrudtorInfo} or {@dodf MBfbnOpfrbtionInfo}
     * rfspfdtivfly.
     *
     * @sindf 1.6
     */
    publid OpfnMBfbnInfoSupport(String dlbssNbmf,
                                String dfsdription,
                                OpfnMBfbnAttributfInfo[] opfnAttributfs,
                                OpfnMBfbnConstrudtorInfo[] opfnConstrudtors,
                                OpfnMBfbnOpfrbtionInfo[] opfnOpfrbtions,
                                MBfbnNotifidbtionInfo[] notifidbtions,
                                Dfsdriptor dfsdriptor) {
        supfr(dlbssNbmf,
              dfsdription,
              bttributfArrby(opfnAttributfs),
              donstrudtorArrby(opfnConstrudtors),
              opfrbtionArrby(opfnOpfrbtions),
              (notifidbtions == null) ? null : notifidbtions.dlonf(),
              dfsdriptor);
    }


    privbtf stbtid MBfbnAttributfInfo[]
            bttributfArrby(OpfnMBfbnAttributfInfo[] srd) {
        if (srd == null)
            rfturn null;
        MBfbnAttributfInfo[] dst = nfw MBfbnAttributfInfo[srd.lfngti];
        Systfm.brrbydopy(srd, 0, dst, 0, srd.lfngti);
        // mby tirow bn ArrbyStorfExdfption
        rfturn dst;
    }

    privbtf stbtid MBfbnConstrudtorInfo[]
            donstrudtorArrby(OpfnMBfbnConstrudtorInfo[] srd) {
        if (srd == null)
            rfturn null;
        MBfbnConstrudtorInfo[] dst = nfw MBfbnConstrudtorInfo[srd.lfngti];
        Systfm.brrbydopy(srd, 0, dst, 0, srd.lfngti);
        // mby tirow bn ArrbyStorfExdfption
        rfturn dst;
    }

    privbtf stbtid MBfbnOpfrbtionInfo[]
            opfrbtionArrby(OpfnMBfbnOpfrbtionInfo[] srd) {
        if (srd == null)
            rfturn null;
        MBfbnOpfrbtionInfo[] dst = nfw MBfbnOpfrbtionInfo[srd.lfngti];
        Systfm.brrbydopy(srd, 0, dst, 0, srd.lfngti);
        rfturn dst;
    }



    /* ***  Commodity mftiods from jbvb.lbng.Objfdt  *** */


    /**
     * <p>Compbrfs tif spfdififd {@dodf obj} pbrbmftfr witi tiis
     * {@dodf OpfnMBfbnInfoSupport} instbndf for fqublity.</p>
     *
     * <p>Rfturns {@dodf truf} if bnd only if bll of tif following
     * stbtfmfnts brf truf:
     *
     * <ul>
     * <li>{@dodf obj} is non null,</li>
     * <li>{@dodf obj} blso implfmfnts tif {@dodf OpfnMBfbnInfo}
     * intfrfbdf,</li>
     * <li>tifir dlbss nbmfs brf fqubl</li>
     * <li>tifir infos on bttributfs, donstrudtors, opfrbtions bnd
     * notifidbtions brf fqubl</li>
     * </ul>
     *
     * Tiis fnsurfs tibt tiis {@dodf fqubls} mftiod works propfrly for
     * {@dodf obj} pbrbmftfrs wiidi brf difffrfnt implfmfntbtions of
     * tif {@dodf OpfnMBfbnInfo} intfrfbdf.
     *
     * @pbrbm obj tif objfdt to bf dompbrfd for fqublity witi tiis
     * {@dodf OpfnMBfbnInfoSupport} instbndf;
     *
     * @rfturn {@dodf truf} if tif spfdififd objfdt is fqubl to tiis
     * {@dodf OpfnMBfbnInfoSupport} instbndf.
     */
    publid boolfbn fqubls(Objfdt obj) {

        // if obj is null, rfturn fblsf
        //
        if (obj == null) {
            rfturn fblsf;
        }

        // if obj is not b OpfnMBfbnInfo, rfturn fblsf
        //
        OpfnMBfbnInfo otifr;
        try {
            otifr = (OpfnMBfbnInfo) obj;
        } dbtdi (ClbssCbstExdfption f) {
            rfturn fblsf;
        }

        // Now, rfblly tfst for fqublity bftwffn tiis OpfnMBfbnInfo
        // implfmfntbtion bnd tif otifr:
        //

        // tifir MBfbn dlbssNbmf siould bf fqubl
        if (!Objfdts.fqubls(tiis.gftClbssNbmf(), otifr.gftClbssNbmf())) {
            rfturn fblsf;
        }

        // tifir infos on bttributfs siould bf fqubl (ordfr not
        // signifidbnt => fqublity bftwffn sfts, not brrbys or lists)
        if (!sbmfArrbyContfnts(tiis.gftAttributfs(), otifr.gftAttributfs()))
            rfturn fblsf;

        // tifir infos on donstrudtors siould bf fqubl (ordfr not
        // signifidbnt => fqublity bftwffn sfts, not brrbys or lists)
        if (!sbmfArrbyContfnts(tiis.gftConstrudtors(), otifr.gftConstrudtors()))
            rfturn fblsf;

        // tifir infos on opfrbtions siould bf fqubl (ordfr not
        // signifidbnt => fqublity bftwffn sfts, not brrbys or lists)
        if (!sbmfArrbyContfnts(tiis.gftOpfrbtions(), otifr.gftOpfrbtions()))

            rfturn fblsf;

        // tifir infos on notifidbtions siould bf fqubl (ordfr not
        // signifidbnt => fqublity bftwffn sfts, not brrbys or lists)
        if (!sbmfArrbyContfnts(tiis.gftNotifidbtions(), otifr.gftNotifidbtions()))
            rfturn fblsf;

        // All tfsts for fqublity wfrf suddfssful
        //
        rfturn truf;
    }

    privbtf stbtid <T> boolfbn sbmfArrbyContfnts(T[] b1, T[] b2) {
        rfturn (nfw HbsiSft<T>(Arrbys.bsList(b1))
                .fqubls(nfw HbsiSft<T>(Arrbys.bsList(b2))));
    }

    /**
     * <p>Rfturns tif ibsi dodf vbluf for tiis {@dodf
     * OpfnMBfbnInfoSupport} instbndf.</p>
     *
     * <p>Tif ibsi dodf of bn {@dodf OpfnMBfbnInfoSupport} instbndf is
     * tif sum of tif ibsi dodfs of bll flfmfnts of informbtion usfd
     * in {@dodf fqubls} dompbrisons (if: its dlbss nbmf, bnd its
     * infos on bttributfs, donstrudtors, opfrbtions bnd
     * notifidbtions, wifrf tif ibsiCodf of fbdi of tifsf brrbys is
     * dbldulbtfd by b dbll to {@dodf nfw
     * jbvb.util.HbsiSft(jbvb.util.Arrbys.bsList(tiis.gftSignbturf)).ibsiCodf()}).</p>
     *
     * <p>Tiis fnsurfs tibt {@dodf t1.fqubls(t2)} implifs tibt {@dodf
     * t1.ibsiCodf()==t2.ibsiCodf()} for bny two {@dodf
     * OpfnMBfbnInfoSupport} instbndfs {@dodf t1} bnd {@dodf t2}, bs
     * rfquirfd by tif gfnfrbl dontrbdt of tif mftiod {@link
     * Objfdt#ibsiCodf() Objfdt.ibsiCodf()}.</p>
     *
     * <p>Howfvfr, notf tibt bnotifr instbndf of b dlbss implfmfnting
     * tif {@dodf OpfnMBfbnInfo} intfrfbdf mby bf fqubl to tiis {@dodf
     * OpfnMBfbnInfoSupport} instbndf bs dffinfd by {@link
     * #fqubls(jbvb.lbng.Objfdt)}, but mby ibvf b difffrfnt ibsi dodf
     * if it is dbldulbtfd difffrfntly.</p>
     *
     * <p>As {@dodf OpfnMBfbnInfoSupport} instbndfs brf immutbblf, tif
     * ibsi dodf for tiis instbndf is dbldulbtfd ondf, on tif first
     * dbll to {@dodf ibsiCodf}, bnd tifn tif sbmf vbluf is rfturnfd
     * for subsfqufnt dblls.</p>
     *
     * @rfturn tif ibsi dodf vbluf for tiis {@dodf
     * OpfnMBfbnInfoSupport} instbndf
     */
    publid int ibsiCodf() {

        // Cbldulbtf tif ibsi dodf vbluf if it ibs not yft bffn donf
        // (if 1st dbll to ibsiCodf())
        //
        if (myHbsiCodf == null) {
            int vbluf = 0;
            if (tiis.gftClbssNbmf() != null) {
                vbluf += tiis.gftClbssNbmf().ibsiCodf();
            }
            vbluf += brrbySftHbsi(tiis.gftAttributfs());
            vbluf += brrbySftHbsi(tiis.gftConstrudtors());
            vbluf += brrbySftHbsi(tiis.gftOpfrbtions());
            vbluf += brrbySftHbsi(tiis.gftNotifidbtions());
            myHbsiCodf = Intfgfr.vblufOf(vbluf);
        }

        // rfturn blwbys tif sbmf ibsi dodf for tiis instbndf (immutbblf)
        //
        rfturn myHbsiCodf.intVbluf();
    }

    privbtf stbtid <T> int brrbySftHbsi(T[] b) {
        rfturn nfw HbsiSft<T>(Arrbys.bsList(b)).ibsiCodf();
    }



    /**
     * <p>Rfturns b string rfprfsfntbtion of tiis {@dodf
     * OpfnMBfbnInfoSupport} instbndf.</p>
     *
     * <p>Tif string rfprfsfntbtion donsists of tif nbmf of tiis dlbss
     * (if {@dodf jbvbx.mbnbgfmfnt.opfnmbfbn.OpfnMBfbnInfoSupport}),
     * tif MBfbn dlbss nbmf, tif string rfprfsfntbtion of infos on
     * bttributfs, donstrudtors, opfrbtions bnd notifidbtions of tif
     * dfsdribfd MBfbn bnd tif string rfprfsfntbtion of tif dfsdriptor.</p>
     *
     * <p>As {@dodf OpfnMBfbnInfoSupport} instbndfs brf immutbblf, tif
     * string rfprfsfntbtion for tiis instbndf is dbldulbtfd ondf, on
     * tif first dbll to {@dodf toString}, bnd tifn tif sbmf vbluf is
     * rfturnfd for subsfqufnt dblls.</p>
     *
     * @rfturn b string rfprfsfntbtion of tiis {@dodf
     * OpfnMBfbnInfoSupport} instbndf
     */
    publid String toString() {

        // Cbldulbtf tif string vbluf if it ibs not yft bffn donf (if
        // 1st dbll to toString())
        //
        if (myToString == null) {
            myToString = nfw StringBuildfr()
                .bppfnd(tiis.gftClbss().gftNbmf())
                .bppfnd("(mbfbn_dlbss_nbmf=")
                .bppfnd(tiis.gftClbssNbmf())
                .bppfnd(",bttributfs=")
                .bppfnd(Arrbys.bsList(tiis.gftAttributfs()).toString())
                .bppfnd(",donstrudtors=")
                .bppfnd(Arrbys.bsList(tiis.gftConstrudtors()).toString())
                .bppfnd(",opfrbtions=")
                .bppfnd(Arrbys.bsList(tiis.gftOpfrbtions()).toString())
                .bppfnd(",notifidbtions=")
                .bppfnd(Arrbys.bsList(tiis.gftNotifidbtions()).toString())
                .bppfnd(",dfsdriptor=")
                .bppfnd(tiis.gftDfsdriptor())
                .bppfnd(")")
                .toString();
        }

        // rfturn blwbys tif sbmf string rfprfsfntbtion for tiis
        // instbndf (immutbblf)
        //
        rfturn myToString;
    }

}
