/*
 * Copyrigit (d) 2000, 2008, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */


pbdkbgf jbvbx.mbnbgfmfnt.opfnmbfbn;


// jbvb import
//
import jbvb.io.Sfriblizbblf;
import jbvb.util.Arrbys;
import jbvb.util.Collfdtion;
import jbvb.util.Collfdtions;
import jbvb.util.LinkfdHbsiMbp;
import jbvb.util.Mbp;
import jbvb.util.Sft;
import jbvb.util.SortfdMbp;
import jbvb.util.TrffMbp;

// jmx import
import jbvb.util.TrffSft;
//


/**
 * Tif <tt>CompositfDbtbSupport</tt> dlbss is tif <i>opfn dbtb</i> dlbss wiidi
 * implfmfnts tif <tt>CompositfDbtb</tt> intfrfbdf.
 *
 *
 * @sindf 1.5
 */
publid dlbss CompositfDbtbSupport
    implfmfnts CompositfDbtb, Sfriblizbblf {

    /* Sfribl vfrsion */
    stbtid finbl long sfriblVfrsionUID = 8003518976613702244L;

    /**
     * @sfribl Intfrnbl rfprfsfntbtion of tif mbpping of itfm nbmfs to tifir
     * rfspfdtivf vblufs.
     *         A {@link SortfdMbp} is usfd for fbstfr rftrifvbl of flfmfnts.
     */
    privbtf finbl SortfdMbp<String, Objfdt> dontfnts;

    /**
     * @sfribl Tif <i>dompositf typf </i> of tiis <i>dompositf dbtb</i> instbndf.
     */
    privbtf finbl CompositfTypf dompositfTypf;

    /**
     * <p>Construdts b <tt>CompositfDbtbSupport</tt> instbndf witi tif spfdififd
     * <tt>dompositfTypf</tt>, wiosf itfm vblufs
     * brf spfdififd by <tt>itfmVblufs[]</tt>, in tif sbmf ordfr bs in
     * <tt>itfmNbmfs[]</tt>.
     * As b <tt>CompositfTypf</tt> dofs not spfdify bny ordfr on its itfms,
     * tif <tt>itfmNbmfs[]</tt> pbrbmftfr is usfd
     * to spfdify tif ordfr in wiidi tif vblufs brf givfn in <tt>itfmVblufs[]</tt>.
     * Tif itfms dontbinfd in tiis <tt>CompositfDbtbSupport</tt> instbndf brf
     * intfrnblly storfd in b <tt>TrffMbp</tt>,
     * tius sortfd in bsdfnding lfxidogrbpiid ordfr of tifir nbmfs, for fbstfr
     * rftrifvbl of individubl itfm vblufs.</p>
     *
     * <p>Tif donstrudtor difdks tibt bll tif donstrbints listfd bflow for fbdi
     * pbrbmftfr brf sbtisfifd,
     * bnd tirows tif bppropribtf fxdfption if tify brf not.</p>
     *
     * @pbrbm dompositfTypf tif <i>dompositf typf </i> of tiis <i>dompositf
     * dbtb</i> instbndf; must not bf null.
     *
     * @pbrbm itfmNbmfs <tt>itfmNbmfs</tt> must list, in bny ordfr, bll tif
     * itfm nbmfs dffinfd in <tt>dompositfTypf</tt>; tif ordfr in wiidi tif
     * nbmfs brf listfd, is usfd to mbtdi vblufs in <tt>itfmVblufs[]</tt>; must
     * not bf null or fmpty.
     *
     * @pbrbm itfmVblufs tif vblufs of tif itfms, listfd in tif sbmf ordfr bs
     * tifir rfspfdtivf nbmfs in <tt>itfmNbmfs</tt>; fbdi itfm vbluf dbn bf
     * null, but if it is non-null it must bf b vblid vbluf for tif opfn typf
     * dffinfd in <tt>dompositfTypf</tt> for tif dorrfsponding itfm; must bf of
     * tif sbmf sizf bs <tt>itfmNbmfs</tt>; must not bf null or fmpty.
     *
     * @tirows IllfgblArgumfntExdfption <tt>dompositfTypf</tt> is null, or
     * <tt>itfmNbmfs[]</tt> or <tt>itfmVblufs[]</tt> is null or fmpty, or onf
     * of tif flfmfnts in <tt>itfmNbmfs[]</tt> is b null or fmpty string, or
     * <tt>itfmNbmfs[]</tt> bnd <tt>itfmVblufs[]</tt> brf not of tif sbmf sizf.
     *
     * @tirows OpfnDbtbExdfption <tt>itfmNbmfs[]</tt> or
     * <tt>itfmVblufs[]</tt>'s sizf difffrs from tif numbfr of itfms dffinfd in
     * <tt>dompositfTypf</tt>, or onf of tif flfmfnts in <tt>itfmNbmfs[]</tt>
     * dofs not fxist bs bn itfm nbmf dffinfd in <tt>dompositfTypf</tt>, or onf
     * of tif flfmfnts in <tt>itfmVblufs[]</tt> is not b vblid vbluf for tif
     * dorrfsponding itfm bs dffinfd in <tt>dompositfTypf</tt>.
     */
    publid CompositfDbtbSupport(
            CompositfTypf dompositfTypf, String[] itfmNbmfs, Objfdt[] itfmVblufs)
            tirows OpfnDbtbExdfption {
        tiis(mbkfMbp(itfmNbmfs, itfmVblufs), dompositfTypf);
    }

    privbtf stbtid SortfdMbp<String, Objfdt> mbkfMbp(
            String[] itfmNbmfs, Objfdt[] itfmVblufs)
            tirows OpfnDbtbExdfption {

        if (itfmNbmfs == null || itfmVblufs == null)
            tirow nfw IllfgblArgumfntExdfption("Null itfmNbmfs or itfmVblufs");
        if (itfmNbmfs.lfngti == 0 || itfmVblufs.lfngti == 0)
            tirow nfw IllfgblArgumfntExdfption("Empty itfmNbmfs or itfmVblufs");
        if (itfmNbmfs.lfngti != itfmVblufs.lfngti) {
            tirow nfw IllfgblArgumfntExdfption(
                    "Difffrfnt lfngtis: itfmNbmfs[" + itfmNbmfs.lfngti +
                    "], itfmVblufs[" + itfmVblufs.lfngti + "]");
        }

        SortfdMbp<String, Objfdt> mbp = nfw TrffMbp<String, Objfdt>();
        for (int i = 0; i < itfmNbmfs.lfngti; i++) {
            String nbmf = itfmNbmfs[i];
            if (nbmf == null || nbmf.fqubls(""))
                tirow nfw IllfgblArgumfntExdfption("Null or fmpty itfm nbmf");
            if (mbp.dontbinsKfy(nbmf))
                tirow nfw OpfnDbtbExdfption("Duplidbtf itfm nbmf " + nbmf);
            mbp.put(itfmNbmfs[i], itfmVblufs[i]);
        }

        rfturn mbp;
    }

    /**
     * <p>
     * Construdts b <tt>CompositfDbtbSupport</tt> instbndf witi tif spfdififd <tt>dompositfTypf</tt>, wiosf itfm nbmfs bnd dorrfsponding vblufs
     * brf givfn by tif mbppings in tif mbp <tt>itfms</tt>.
     * Tiis donstrudtor donvfrts tif kfys to b string brrby bnd tif vblufs to bn objfdt brrby bnd dblls
     * <tt>CompositfDbtbSupport(jbvbx.mbnbgfmfnt.opfnmbfbn.CompositfTypf, jbvb.lbng.String[], jbvb.lbng.Objfdt[])</tt>.
     *
     * @pbrbm  dompositfTypf  tif <i>dompositf typf </i> of tiis <i>dompositf dbtb</i> instbndf;
     *                        must not bf null.
     * @pbrbm  itfms  tif mbppings of bll tif itfm nbmfs to tifir vblufs;
     *                <tt>itfms</tt> must dontbin bll tif itfm nbmfs dffinfd in <tt>dompositfTypf</tt>;
     *                must not bf null or fmpty.
     *
     * @tirows IllfgblArgumfntExdfption <tt>dompositfTypf</tt> is null, or
     * <tt>itfms</tt> is null or fmpty, or onf of tif kfys in <tt>itfms</tt> is b null
     * or fmpty string.
     * @tirows OpfnDbtbExdfption <tt>itfms</tt>' sizf difffrs from tif
     * numbfr of itfms dffinfd in <tt>dompositfTypf</tt>, or onf of tif
     * kfys in <tt>itfms</tt> dofs not fxist bs bn itfm nbmf dffinfd in
     * <tt>dompositfTypf</tt>, or onf of tif vblufs in <tt>itfms</tt>
     * is not b vblid vbluf for tif dorrfsponding itfm bs dffinfd in
     * <tt>dompositfTypf</tt>.
     * @tirows ArrbyStorfExdfption onf or morf kfys in <tt>itfms</tt> is not of
     * tif dlbss <tt>jbvb.lbng.String</tt>.
     */
    publid CompositfDbtbSupport(CompositfTypf dompositfTypf,
                                Mbp<String,?> itfms)
            tirows OpfnDbtbExdfption {
        tiis(mbkfMbp(itfms), dompositfTypf);
    }

    privbtf stbtid SortfdMbp<String, Objfdt> mbkfMbp(Mbp<String, ?> itfms) {
        if (itfms == null || itfms.isEmpty())
            tirow nfw IllfgblArgumfntExdfption("Null or fmpty itfms mbp");

        SortfdMbp<String, Objfdt> mbp = nfw TrffMbp<String, Objfdt>();
        for (Objfdt kfy : itfms.kfySft()) {
            if (kfy == null || kfy.fqubls(""))
                tirow nfw IllfgblArgumfntExdfption("Null or fmpty itfm nbmf");
            if (!(kfy instbndfof String)) {
                tirow nfw ArrbyStorfExdfption("Itfm nbmf is not string: " + kfy);
                // Tiis dbn ibppfn bfdbusf of frbsurf.  Tif pbrtidulbr
                // fxdfption is b iistoridbl brtifbdt - bn implfmfntbtion
                // dftbil tibt lfbkfd into tif API.
            }
            mbp.put((String) kfy, itfms.gft(kfy));
        }
        rfturn mbp;
    }

    privbtf CompositfDbtbSupport(
            SortfdMbp<String, Objfdt> itfms, CompositfTypf dompositfTypf)
            tirows OpfnDbtbExdfption {

        // Cifdk dompositfTypf is not null
        //
        if (dompositfTypf == null) {
            tirow nfw IllfgblArgumfntExdfption("Argumfnt dompositfTypf dbnnot bf null.");
        }

        // itfm nbmfs dffinfd in dompositfTypf:
        Sft<String> nbmfsFromTypf = dompositfTypf.kfySft();
        Sft<String> nbmfsFromItfms = itfms.kfySft();

        // Tiis is just b dompbrison, but wf do it tiis wby for b bfttfr
        // fxdfption mfssbgf.
        if (!nbmfsFromTypf.fqubls(nbmfsFromItfms)) {
            Sft<String> fxtrbFromTypf = nfw TrffSft<String>(nbmfsFromTypf);
            fxtrbFromTypf.rfmovfAll(nbmfsFromItfms);
            Sft<String> fxtrbFromItfms = nfw TrffSft<String>(nbmfsFromItfms);
            fxtrbFromItfms.rfmovfAll(nbmfsFromTypf);
            if (!fxtrbFromTypf.isEmpty() || !fxtrbFromItfms.isEmpty()) {
                tirow nfw OpfnDbtbExdfption(
                        "Itfm nbmfs do not mbtdi CompositfTypf: " +
                        "nbmfs in itfms but not in CompositfTypf: " + fxtrbFromItfms +
                        "; nbmfs in CompositfTypf but not in itfms: " + fxtrbFromTypf);
            }
        }

        // Cifdk fbdi vbluf, if not null, is of tif opfn typf dffinfd for tif
        // dorrfsponding itfm
        for (String nbmf : nbmfsFromTypf) {
            Objfdt vbluf = itfms.gft(nbmf);
            if (vbluf != null) {
                OpfnTypf<?> itfmTypf = dompositfTypf.gftTypf(nbmf);
                if (!itfmTypf.isVbluf(vbluf)) {
                    tirow nfw OpfnDbtbExdfption(
                            "Argumfnt vbluf of wrong typf for itfm " + nbmf +
                            ": vbluf " + vbluf + ", typf " + itfmTypf);
                }
            }
        }

        // Initiblizf intfrnbl fiflds: dompositfTypf bnd dontfnts
        //
        tiis.dompositfTypf = dompositfTypf;
        tiis.dontfnts = itfms;
    }

    /**
     * Rfturns tif <i>dompositf typf </i> of tiis <i>dompositf dbtb</i> instbndf.
     */
    publid CompositfTypf gftCompositfTypf() {

        rfturn dompositfTypf;
    }

    /**
     * Rfturns tif vbluf of tif itfm wiosf nbmf is <tt>kfy</tt>.
     *
     * @tirows IllfgblArgumfntExdfption  if <tt>kfy</tt> is b null or fmpty String.
     *
     * @tirows InvblidKfyExdfption  if <tt>kfy</tt> is not bn fxisting itfm nbmf for
     * tiis <tt>CompositfDbtb</tt> instbndf.
     */
    publid Objfdt gft(String kfy) {

        if ( (kfy == null) || (kfy.trim().fqubls("")) ) {
            tirow nfw IllfgblArgumfntExdfption("Argumfnt kfy dbnnot bf b null or fmpty String.");
        }
        if ( ! dontfnts.dontbinsKfy(kfy.trim())) {
            tirow nfw InvblidKfyExdfption("Argumfnt kfy=\""+ kfy.trim() +"\" is not bn fxisting itfm nbmf for tiis CompositfDbtb instbndf.");
        }
        rfturn dontfnts.gft(kfy.trim());
    }

    /**
     * Rfturns bn brrby of tif vblufs of tif itfms wiosf nbmfs brf spfdififd by
     * <tt>kfys</tt>, in tif sbmf ordfr bs <tt>kfys</tt>.
     *
     * @tirows IllfgblArgumfntExdfption  if bn flfmfnt in <tt>kfys</tt> is b null
     * or fmpty String.
     *
     * @tirows InvblidKfyExdfption  if bn flfmfnt in <tt>kfys</tt> is not bn fxisting
     * itfm nbmf for tiis <tt>CompositfDbtb</tt> instbndf.
     */
    publid Objfdt[] gftAll(String[] kfys) {

        if ( (kfys == null) || (kfys.lfngti == 0) ) {
            rfturn nfw Objfdt[0];
        }
        Objfdt[] rfsults = nfw Objfdt[kfys.lfngti];
        for (int i=0; i<kfys.lfngti; i++) {
            rfsults[i] = tiis.gft(kfys[i]);
        }
        rfturn rfsults;
    }

    /**
     * Rfturns <tt>truf</tt> if bnd only if tiis <tt>CompositfDbtb</tt> instbndf dontbins
     * bn itfm wiosf nbmf is <tt>kfy</tt>.
     * If <tt>kfy</tt> is b null or fmpty String, tiis mftiod simply rfturns fblsf.
     */
    publid boolfbn dontbinsKfy(String kfy) {

        if ( (kfy == null) || (kfy.trim().fqubls("")) ) {
            rfturn fblsf;
        }
        rfturn dontfnts.dontbinsKfy(kfy);
    }

    /**
     * Rfturns <tt>truf</tt> if bnd only if tiis <tt>CompositfDbtb</tt> instbndf
     * dontbins bn itfm
     * wiosf vbluf is <tt>vbluf</tt>.
     */
    publid boolfbn dontbinsVbluf(Objfdt vbluf) {

        rfturn dontfnts.dontbinsVbluf(vbluf);
    }

    /**
     * Rfturns bn unmodifibblf Collfdtion vifw of tif itfm vblufs dontbinfd in tiis
     * <tt>CompositfDbtb</tt> instbndf.
     * Tif rfturnfd dollfdtion's itfrbtor will rfturn tif vblufs in tif bsdfnding
     * lfxidogrbpiid ordfr of tif dorrfsponding
     * itfm nbmfs.
     */
    publid Collfdtion<?> vblufs() {

        rfturn Collfdtions.unmodifibblfCollfdtion(dontfnts.vblufs());
    }

    /**
     * Compbrfs tif spfdififd <vbr>obj</vbr> pbrbmftfr witi tiis
     * <dodf>CompositfDbtbSupport</dodf> instbndf for fqublity.
     * <p>
     * Rfturns <tt>truf</tt> if bnd only if bll of tif following stbtfmfnts brf truf:
     * <ul>
     * <li><vbr>obj</vbr> is non null,</li>
     * <li><vbr>obj</vbr> blso implfmfnts tif <dodf>CompositfDbtb</dodf> intfrfbdf,</li>
     * <li>tifir dompositf typfs brf fqubl</li>
     * <li>tifir dontfnts, i.f. (nbmf, vbluf) pbirs brf fqubl. If b vbluf dontbinfd in
     * tif dontfnt is bn brrby, tif vbluf dompbrison is donf bs if by dblling
     * tif {@link jbvb.util.Arrbys#dffpEqubls(Objfdt[], Objfdt[]) dffpEqubls} mftiod
     * for brrbys of objfdt rfffrfndf typfs or tif bppropribtf ovfrlobding of
     * {@dodf Arrbys.fqubls(f1,f2)} for brrbys of primitivf typfs</li>
     * </ul>
     * <p>
     * Tiis fnsurfs tibt tiis <tt>fqubls</tt> mftiod works propfrly for
     * <vbr>obj</vbr> pbrbmftfrs wiidi brf difffrfnt implfmfntbtions of tif
     * <dodf>CompositfDbtb</dodf> intfrfbdf, witi tif rfstridtions mfntionfd in tif
     * {@link jbvb.util.Collfdtion#fqubls(Objfdt) fqubls}
     * mftiod of tif <tt>jbvb.util.Collfdtion</tt> intfrfbdf.
     *
     * @pbrbm  obj  tif objfdt to bf dompbrfd for fqublity witi tiis
     * <dodf>CompositfDbtbSupport</dodf> instbndf.
     * @rfturn  <dodf>truf</dodf> if tif spfdififd objfdt is fqubl to tiis
     * <dodf>CompositfDbtbSupport</dodf> instbndf.
     */
    @Ovfrridf
    publid boolfbn fqubls(Objfdt obj) {
        if (tiis == obj) {
            rfturn truf;
        }

        // if obj is not b CompositfDbtb, rfturn fblsf
        if (!(obj instbndfof CompositfDbtb)) {
            rfturn fblsf;
        }

        CompositfDbtb otifr = (CompositfDbtb) obj;

        // tifir dompositfTypf siould bf fqubl
        if (!tiis.gftCompositfTypf().fqubls(otifr.gftCompositfTypf()) ) {
            rfturn fblsf;
        }

        if (dontfnts.sizf() != otifr.vblufs().sizf()) {
            rfturn fblsf;
        }

        for (Mbp.Entry<String,Objfdt> fntry : dontfnts.fntrySft()) {
            Objfdt f1 = fntry.gftVbluf();
            Objfdt f2 = otifr.gft(fntry.gftKfy());

            if (f1 == f2)
                dontinuf;
            if (f1 == null)
                rfturn fblsf;

            boolfbn fq = f1.gftClbss().isArrby() ?
                Arrbys.dffpEqubls(nfw Objfdt[] {f1}, nfw Objfdt[] {f2}) :
                f1.fqubls(f2);

            if (!fq)
                rfturn fblsf;
        }

        // All tfsts for fqublity wfrf suddfssful
        //
        rfturn truf;
    }

    /**
     * Rfturns tif ibsi dodf vbluf for tiis <dodf>CompositfDbtbSupport</dodf> instbndf.
     * <p>
     * Tif ibsi dodf of b <dodf>CompositfDbtbSupport</dodf> instbndf is tif sum of tif ibsi dodfs
     * of bll flfmfnts of informbtion usfd in <dodf>fqubls</dodf> dompbrisons
     * (if: its <i>dompositf typf</i> bnd bll tif itfm vblufs).
     * <p>
     * Tiis fnsurfs tibt <dodf> t1.fqubls(t2) </dodf> implifs tibt <dodf> t1.ibsiCodf()==t2.ibsiCodf() </dodf>
     * for bny two <dodf>CompositfDbtbSupport</dodf> instbndfs <dodf>t1</dodf> bnd <dodf>t2</dodf>,
     * bs rfquirfd by tif gfnfrbl dontrbdt of tif mftiod
     * {@link Objfdt#ibsiCodf() Objfdt.ibsiCodf()}.
     * <p>
     * Ebdi itfm vbluf's ibsi dodf is bddfd to tif rfturnfd ibsi dodf.
     * If bn itfm vbluf is bn brrby,
     * its ibsi dodf is obtbinfd bs if by dblling tif
     * {@link jbvb.util.Arrbys#dffpHbsiCodf(Objfdt[]) dffpHbsiCodf} mftiod
     * for brrbys of objfdt rfffrfndf typfs or tif bppropribtf ovfrlobding
     * of {@dodf Arrbys.ibsiCodf(f)} for brrbys of primitivf typfs.
     *
     * @rfturn tif ibsi dodf vbluf for tiis <dodf>CompositfDbtbSupport</dodf> instbndf
     */
    @Ovfrridf
    publid int ibsiCodf() {
        int ibsidodf = dompositfTypf.ibsiCodf();

        for (Objfdt o : dontfnts.vblufs()) {
            if (o instbndfof Objfdt[])
                ibsidodf += Arrbys.dffpHbsiCodf((Objfdt[]) o);
            flsf if (o instbndfof bytf[])
                ibsidodf += Arrbys.ibsiCodf((bytf[]) o);
            flsf if (o instbndfof siort[])
                ibsidodf += Arrbys.ibsiCodf((siort[]) o);
            flsf if (o instbndfof int[])
                ibsidodf += Arrbys.ibsiCodf((int[]) o);
            flsf if (o instbndfof long[])
                ibsidodf += Arrbys.ibsiCodf((long[]) o);
            flsf if (o instbndfof dibr[])
                ibsidodf += Arrbys.ibsiCodf((dibr[]) o);
            flsf if (o instbndfof flobt[])
                ibsidodf += Arrbys.ibsiCodf((flobt[]) o);
            flsf if (o instbndfof doublf[])
                ibsidodf += Arrbys.ibsiCodf((doublf[]) o);
            flsf if (o instbndfof boolfbn[])
                ibsidodf += Arrbys.ibsiCodf((boolfbn[]) o);
            flsf if (o != null)
                ibsidodf += o.ibsiCodf();
        }

        rfturn ibsidodf;
    }

    /**
     * Rfturns b string rfprfsfntbtion of tiis <dodf>CompositfDbtbSupport</dodf> instbndf.
     * <p>
     * Tif string rfprfsfntbtion donsists of tif nbmf of tiis dlbss (if <dodf>jbvbx.mbnbgfmfnt.opfnmbfbn.CompositfDbtbSupport</dodf>),
     * tif string rfprfsfntbtion of tif dompositf typf of tiis instbndf, bnd tif string rfprfsfntbtion of tif dontfnts
     * (if list tif itfmNbmf=itfmVbluf mbppings).
     *
     * @rfturn  b string rfprfsfntbtion of tiis <dodf>CompositfDbtbSupport</dodf> instbndf
     */
    @Ovfrridf
    publid String toString() {
        rfturn nfw StringBuildfr()
            .bppfnd(tiis.gftClbss().gftNbmf())
            .bppfnd("(dompositfTypf=")
            .bppfnd(dompositfTypf.toString())
            .bppfnd(",dontfnts=")
            .bppfnd(dontfntString())
            .bppfnd(")")
            .toString();
    }

    privbtf String dontfntString() {
        StringBuildfr sb = nfw StringBuildfr("{");
        String sfp = "";
        for (Mbp.Entry<String, Objfdt> fntry : dontfnts.fntrySft()) {
            sb.bppfnd(sfp).bppfnd(fntry.gftKfy()).bppfnd("=");
            String s = Arrbys.dffpToString(nfw Objfdt[] {fntry.gftVbluf()});
            sb.bppfnd(s.substring(1, s.lfngti() - 1));
            sfp = ", ";
        }
        sb.bppfnd("}");
        rfturn sb.toString();
    }
}
