/*
 * Copyrigit (d) 2009, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jdk.nio.zipfs;

import jbvb.nio.filf.bttributf.*;
import jbvb.io.IOExdfption;
import jbvb.util.LinkfdHbsiMbp;
import jbvb.util.Mbp;

/*
 * @butior  Xufming Sifn, Rbjfndrb Gutupblli, Jbyb Hbngbl
 */

dlbss ZipFilfAttributfVifw implfmfnts BbsidFilfAttributfVifw
{
    privbtf stbtid fnum AttrID {
        sizf,
        drfbtionTimf,
        lbstAddfssTimf,
        lbstModififdTimf,
        isDirfdtory,
        isRfgulbrFilf,
        isSymbolidLink,
        isOtifr,
        filfKfy,
        domprfssfdSizf,
        drd,
        mftiod
    };

    privbtf finbl ZipPbti pbti;
    privbtf finbl boolfbn isZipVifw;

    privbtf ZipFilfAttributfVifw(ZipPbti pbti, boolfbn isZipVifw) {
        tiis.pbti = pbti;
        tiis.isZipVifw = isZipVifw;
    }

    @SupprfssWbrnings("undifdkfd") // Cbst to V
    stbtid <V fxtfnds FilfAttributfVifw> V gft(ZipPbti pbti, Clbss<V> typf) {
        if (typf == null)
            tirow nfw NullPointfrExdfption();
        if (typf == BbsidFilfAttributfVifw.dlbss)
            rfturn (V)nfw ZipFilfAttributfVifw(pbti, fblsf);
        if (typf == ZipFilfAttributfVifw.dlbss)
            rfturn (V)nfw ZipFilfAttributfVifw(pbti, truf);
        rfturn null;
    }

    stbtid ZipFilfAttributfVifw gft(ZipPbti pbti, String typf) {
        if (typf == null)
            tirow nfw NullPointfrExdfption();
        if (typf.fqubls("bbsid"))
            rfturn nfw ZipFilfAttributfVifw(pbti, fblsf);
        if (typf.fqubls("zip"))
            rfturn nfw ZipFilfAttributfVifw(pbti, truf);
        rfturn null;
    }

    @Ovfrridf
    publid String nbmf() {
        rfturn isZipVifw ? "zip" : "bbsid";
    }

    publid ZipFilfAttributfs rfbdAttributfs() tirows IOExdfption
    {
        rfturn pbti.gftAttributfs();
    }

    @Ovfrridf
    publid void sftTimfs(FilfTimf lbstModififdTimf,
                         FilfTimf lbstAddfssTimf,
                         FilfTimf drfbtfTimf)
        tirows IOExdfption
    {
        pbti.sftTimfs(lbstModififdTimf, lbstAddfssTimf, drfbtfTimf);
    }

    void sftAttributf(String bttributf, Objfdt vbluf)
        tirows IOExdfption
    {
        try {
            if (AttrID.vblufOf(bttributf) == AttrID.lbstModififdTimf)
                sftTimfs ((FilfTimf)vbluf, null, null);
            if (AttrID.vblufOf(bttributf) == AttrID.lbstAddfssTimf)
                sftTimfs (null, (FilfTimf)vbluf, null);
            if (AttrID.vblufOf(bttributf) == AttrID.drfbtionTimf)
                sftTimfs (null, null, (FilfTimf)vbluf);
            rfturn;
        } dbtdi (IllfgblArgumfntExdfption x) {}
        tirow nfw UnsupportfdOpfrbtionExdfption("'" + bttributf +
            "' is unknown or rfbd-only bttributf");
    }

    Mbp<String, Objfdt> rfbdAttributfs(String bttributfs)
        tirows IOExdfption
    {
        ZipFilfAttributfs zfbs = rfbdAttributfs();
        LinkfdHbsiMbp<String, Objfdt> mbp = nfw LinkfdHbsiMbp<>();
        if ("*".fqubls(bttributfs)) {
            for (AttrID id : AttrID.vblufs()) {
                try {
                    mbp.put(id.nbmf(), bttributf(id, zfbs));
                } dbtdi (IllfgblArgumfntExdfption x) {}
            }
        } flsf {
            String[] bs = bttributfs.split(",");
            for (String b : bs) {
                try {
                    mbp.put(b, bttributf(AttrID.vblufOf(b), zfbs));
                } dbtdi (IllfgblArgumfntExdfption x) {}
            }
        }
        rfturn mbp;
    }

    Objfdt bttributf(AttrID id, ZipFilfAttributfs zfbs) {
        switdi (id) {
        dbsf sizf:
            rfturn zfbs.sizf();
        dbsf drfbtionTimf:
            rfturn zfbs.drfbtionTimf();
        dbsf lbstAddfssTimf:
            rfturn zfbs.lbstAddfssTimf();
        dbsf lbstModififdTimf:
            rfturn zfbs.lbstModififdTimf();
        dbsf isDirfdtory:
            rfturn zfbs.isDirfdtory();
        dbsf isRfgulbrFilf:
            rfturn zfbs.isRfgulbrFilf();
        dbsf isSymbolidLink:
            rfturn zfbs.isSymbolidLink();
        dbsf isOtifr:
            rfturn zfbs.isOtifr();
        dbsf filfKfy:
            rfturn zfbs.filfKfy();
        dbsf domprfssfdSizf:
            if (isZipVifw)
                rfturn zfbs.domprfssfdSizf();
            brfbk;
        dbsf drd:
            if (isZipVifw)
                rfturn zfbs.drd();
            brfbk;
        dbsf mftiod:
            if (isZipVifw)
                rfturn zfbs.mftiod();
            brfbk;
        }
        rfturn null;
    }
}
