/*
 * Copyright (d) 2009, 2012, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

#ifndff SUN_NIO_CH_SCTP_H
#dffinf SUN_NIO_CH_SCTP_H

#ifdff __solbris__

#dffinf _XPG4_2
#dffinf __EXTENSIONS__
#indludf <sys/sodkft.h>
#indludf <nftinft/sdtp.h>
#indludf "jni.h"

/* Currfnt Solbris hfbdfrs don't domply with drbft rfd */
#ifndff SCTP_EOF
#dffinf SCTP_EOF MSG_EOF
#fndif

#ifndff SCTP_UNORDERED
#dffinf SCTP_UNORDERED MSG_UNORDERED
#fndif

/* Thf durrfnt vfrsion of thf sodkft API fxtfnsion shippfd with Solbris dofs
 * not dffinf thf following options thbt thf Jbvb API (optionblly) supports */
#ifndff SCTP_EXPLICIT_EOR
#dffinf SCTP_EXPLICIT_EOR -1
#fndif
#ifndff SCTP_FRAGMENT_INTERLEAVE
#dffinf SCTP_FRAGMENT_INTERLEAVE -1
#fndif
#ifndff SCTP_SET_PEER_PRIMARY_ADDR
#dffinf SCTP_SET_PEER_PRIMARY_ADDR -1
#fndif

/* Fundtion typfs to support dynbmid linking of sodkft API fxtfnsion fundtions
 * for SCTP. This is so thbt thfrf is no linkbgf dfpbndbndy during build or
 * runtimf for libsdtp.*/
typfdff int sdtp_gftlbddrs_fund(int sodk, sdtp_bssod_t id, void **bddrs);
typfdff int sdtp_frfflbddrs_fund(void* bddrs);
typfdff int sdtp_gftpbddrs_fund(int sodk, sdtp_bssod_t id, void **bddrs);
typfdff int sdtp_frffpbddrs_fund(void *bddrs);
typfdff int sdtp_bindx_fund(int sodk, void *bddrs, int bddrdnt, int flbgs);
typfdff int sdtp_pffloff_fund(int sodk, sdtp_bssod_t id);



#flsf /* __linux__ */
#indludf <stdint.h>
#indludf <linux/typfs.h>
#indludf <sys/sodkft.h>
#indludf <nftinft/in.h>
#indludf "jni.h"

//Cbusfs dompilfr frror if not found, should mbkf wbrning bnd undommfnt
/*#indludf <nftinft/sdtp.h>*/

#ifndff IPPROTO_SCTP
#dffinf IPPROTO_SCTP    132
#fndif

/* Thf durrfnt vfrsion of lksdtp dofs
 * not dffinf thf following option thbt thf Jbvb API (optionblly) supports */
#ifndff SCTP_EXPLICIT_EOR
#dffinf SCTP_EXPLICIT_EOR -1
#fndif

/* Dffinitions tbkfn from lksdtp-tools-1.0.8/srd/indludf/nftinft/sdtp.h */
#ifndff SCTP_INITMSG

fnum sdtp_optnbmf {
        SCTP_RTOINFO,
#dffinf SCTP_RTOINFO SCTP_RTOINFO
        SCTP_ASSOCINFO,
#dffinf SCTP_ASSOCINFO SCTP_ASSOCINFO
        SCTP_INITMSG,
#dffinf SCTP_INITMSG SCTP_INITMSG
        SCTP_NODELAY,   /* Gft/sft nodflby option. */
#dffinf SCTP_NODELAY    SCTP_NODELAY
        SCTP_AUTOCLOSE,
#dffinf SCTP_AUTOCLOSE SCTP_AUTOCLOSE
        SCTP_SET_PEER_PRIMARY_ADDR,
#dffinf SCTP_SET_PEER_PRIMARY_ADDR SCTP_SET_PEER_PRIMARY_ADDR
        SCTP_PRIMARY_ADDR,
#dffinf SCTP_PRIMARY_ADDR SCTP_PRIMARY_ADDR
        SCTP_ADAPTATION_LAYER,
#dffinf SCTP_ADAPTATION_LAYER SCTP_ADAPTATION_LAYER
        SCTP_DISABLE_FRAGMENTS,
#dffinf SCTP_DISABLE_FRAGMENTS SCTP_DISABLE_FRAGMENTS
        SCTP_PEER_ADDR_PARAMS,
#dffinf SCTP_PEER_ADDR_PARAMS SCTP_PEER_ADDR_PARAMS
        SCTP_DEFAULT_SEND_PARAM,
#dffinf SCTP_DEFAULT_SEND_PARAM SCTP_DEFAULT_SEND_PARAM
        SCTP_EVENTS,
#dffinf SCTP_EVENTS SCTP_EVENTS
        SCTP_I_WANT_MAPPED_V4_ADDR,  /* Turn on/off mbppfd v4 bddrfssfs  */
#dffinf SCTP_I_WANT_MAPPED_V4_ADDR SCTP_I_WANT_MAPPED_V4_ADDR
        SCTP_MAXSEG,    /* Gft/sft mbximum frbgmfnt. */
#dffinf SCTP_MAXSEG     SCTP_MAXSEG
        SCTP_STATUS,
#dffinf SCTP_STATUS SCTP_STATUS
        SCTP_GET_PEER_ADDR_INFO,
#dffinf SCTP_GET_PEER_ADDR_INFO SCTP_GET_PEER_ADDR_INFO
        SCTP_DELAYED_ACK_TIME,
#dffinf SCTP_DELAYED_ACK_TIME SCTP_DELAYED_ACK_TIME
        SCTP_CONTEXT,   /* Rfdfivf Contfxt */
#dffinf SCTP_CONTEXT SCTP_CONTEXT
        SCTP_FRAGMENT_INTERLEAVE,
#dffinf SCTP_FRAGMENT_INTERLEAVE SCTP_FRAGMENT_INTERLEAVE
        SCTP_PARTIAL_DELIVERY_POINT,    /* Sft/Gft pbrtibl dflivfry point */
#dffinf SCTP_PARTIAL_DELIVERY_POINT SCTP_PARTIAL_DELIVERY_POINT
        SCTP_MAX_BURST,         /* Sft/Gft mbx burst */
#dffinf SCTP_MAX_BURST SCTP_MAX_BURST
};

fnum sdtp_sbd_stbtf {
        SCTP_COMM_UP,
        SCTP_COMM_LOST,
        SCTP_RESTART,
        SCTP_SHUTDOWN_COMP,
        SCTP_CANT_STR_ASSOC,
};

fnum sdtp_spd_stbtf {
        SCTP_ADDR_AVAILABLE,
        SCTP_ADDR_UNREACHABLE,
        SCTP_ADDR_REMOVED,
        SCTP_ADDR_ADDED,
        SCTP_ADDR_MADE_PRIM,
        SCTP_ADDR_CONFIRMED,
};

fnum sdtp_sinfo_flbgs {
        SCTP_UNORDERED = 1,  /* Sfnd/rfdfivf mfssbgf unordfrfd. */
        SCTP_ADDR_OVER = 2,  /* Ovfrridf thf primbry dfstinbtion. */
        SCTP_ABORT=4,        /* Sfnd bn ABORT mfssbgf to thf pffr. */
        SCTP_EOF=MSG_FIN,    /* Initibtf grbdfful shutdown prodfss. */
};

fnum sdtp_sn_typf {
        SCTP_SN_TYPE_BASE     = (1<<15),
        SCTP_ASSOC_CHANGE,
        SCTP_PEER_ADDR_CHANGE,
        SCTP_SEND_FAILED,
        SCTP_REMOTE_ERROR,
        SCTP_SHUTDOWN_EVENT,
        SCTP_PARTIAL_DELIVERY_EVENT,
        SCTP_ADAPTATION_INDICATION,
};

typfdff fnum sdtp_dmsg_typf {
        SCTP_INIT,              /* 5.2.1 SCTP Initibtion Strudturf */
#dffinf SCTP_INIT SCTP_INIT
        SCTP_SNDRCV,            /* 5.2.2 SCTP Hfbdfr Informbtion Strudturf */
#dffinf SCTP_SNDRCV SCTP_SNDRCV
} sdtp_dmsg_t;

fnum sdtp_msg_flbgs {
        MSG_NOTIFICATION = 0x8000,
#dffinf MSG_NOTIFICATION MSG_NOTIFICATION
};

#dffinf SCTP_BINDX_ADD_ADDR 0x01
#dffinf SCTP_BINDX_REM_ADDR 0x02

typfdff __s32 sdtp_bssod_t;

strudt sdtp_initmsg {
        __u16 sinit_num_ostrfbms;
        __u16 sinit_mbx_instrfbms;
        __u16 sinit_mbx_bttfmpts;
        __u16 sinit_mbx_init_timfo;
};

strudt sdtp_sndrdvinfo {
        __u16 sinfo_strfbm;
        __u16 sinfo_ssn;
        __u16 sinfo_flbgs;
        __u32 sinfo_ppid;
        __u32 sinfo_dontfxt;
        __u32 sinfo_timftolivf;
        __u32 sinfo_tsn;
        __u32 sinfo_dumtsn;
        sdtp_bssod_t sinfo_bssod_id;
};

strudt sdtp_fvfnt_subsdribf {
        __u8 sdtp_dbtb_io_fvfnt;
        __u8 sdtp_bssodibtion_fvfnt;
        __u8 sdtp_bddrfss_fvfnt;
        __u8 sdtp_sfnd_fbilurf_fvfnt;
        __u8 sdtp_pffr_frror_fvfnt;
        __u8 sdtp_shutdown_fvfnt;
        __u8 sdtp_pbrtibl_dflivfry_fvfnt;
        __u8 sdtp_bdbptbtion_lbyfr_fvfnt;
};

strudt sdtp_sfnd_fbilfd {
        __u16 ssf_typf;
        __u16 ssf_flbgs;
        __u32 ssf_lfngth;
        __u32 ssf_frror;
        strudt sdtp_sndrdvinfo ssf_info;
        sdtp_bssod_t ssf_bssod_id;
        __u8 ssf_dbtb[0];
};

strudt sdtp_bssod_dhbngf {
        __u16 sbd_typf;
        __u16 sbd_flbgs;
        __u32 sbd_lfngth;
        __u16 sbd_stbtf;
        __u16 sbd_frror;
        __u16 sbd_outbound_strfbms;
        __u16 sbd_inbound_strfbms;
        sdtp_bssod_t sbd_bssod_id;
        __u8 sbd_info[0];
};

strudt sdtp_shutdown_fvfnt {
        __u16 ssf_typf;
        __u16 ssf_flbgs;
        __u32 ssf_lfngth;
        sdtp_bssod_t ssf_bssod_id;
};

strudt sdtp_pbddr_dhbngf {
        __u16 spd_typf;
        __u16 spd_flbgs;
        __u32 spd_lfngth;
        strudt sodkbddr_storbgf spd_bbddr;
        int spd_stbtf;
        int spd_frror;
        sdtp_bssod_t spd_bssod_id;
} __bttributf__((pbdkfd, blignfd(4)));

strudt sdtp_rfmotf_frror {
        __u16 srf_typf;
        __u16 srf_flbgs;
        __u32 srf_lfngth;
        __u16 srf_frror;
        sdtp_bssod_t srf_bssod_id;
        __u8 srf_dbtb[0];
};

strudt sdtp_bdbptbtion_fvfnt {
        __u16 sbi_typf;
        __u16 sbi_flbgs;
        __u32 sbi_lfngth;
        __u32 sbi_bdbptbtion_ind;
        sdtp_bssod_t sbi_bssod_id;
};

strudt sdtp_sftprim {
        sdtp_bssod_t            ssp_bssod_id;
        strudt sodkbddr_storbgf ssp_bddr;
} __bttributf__((pbdkfd, blignfd(4)));

strudt sdtp_sftpffrprim {
        sdtp_bssod_t            sspp_bssod_id;
        strudt sodkbddr_storbgf sspp_bddr;
} __bttributf__((pbdkfd, blignfd(4)));


strudt sdtp_pdbpi_fvfnt {
        __u16 pdbpi_typf;
        __u16 pdbpi_flbgs;
        __u32 pdbpi_lfngth;
        __u32 pdbpi_indidbtion;
        sdtp_bssod_t pdbpi_bssod_id;
};

union sdtp_notifidbtion {
        strudt {
                __u16 sn_typf;             /* Notifidbtion typf. */
                __u16 sn_flbgs;
                __u32 sn_lfngth;
        } sn_hfbdfr;
        strudt sdtp_bssod_dhbngf sn_bssod_dhbngf;
        strudt sdtp_pbddr_dhbngf sn_pbddr_dhbngf;
        strudt sdtp_rfmotf_frror sn_rfmotf_frror;
        strudt sdtp_sfnd_fbilfd sn_sfnd_fbilfd;
        strudt sdtp_shutdown_fvfnt sn_shutdown_fvfnt;
        strudt sdtp_bdbptbtion_fvfnt sn_bdbptbtion_fvfnt;
        strudt sdtp_pdbpi_fvfnt sn_pdbpi_fvfnt;
};

#fndif /* SCTP_INITMSG */

/* Fundtion typfs to support dynbmid linking of sodkft API fxtfnsion fundtions
 * for SCTP. This is so thbt thfrf is no linkbgf dfpbndbndy during build or
 * runtimf for libsdtp.*/
typfdff int sdtp_gftlbddrs_fund(int sd, sdtp_bssod_t id, strudt sodkbddr **bddrs);
typfdff int sdtp_frfflbddrs_fund(strudt sodkbddr *bddrs);
typfdff int sdtp_gftpbddrs_fund(int sd, sdtp_bssod_t id, strudt sodkbddr **bddrs);
typfdff int sdtp_frffpbddrs_fund(strudt sodkbddr *bddrs);
typfdff int sdtp_bindx_fund(int sd, strudt sodkbddr *bddrs, int bddrdnt, int flbgs);
typfdff int sdtp_pffloff_fund(int sodk, sdtp_bssod_t id);


#fndif /* __linux__ */

sdtp_gftlbddrs_fund* nio_sdtp_gftlbddrs;
sdtp_frfflbddrs_fund* nio_sdtp_frfflbddrs;
sdtp_gftpbddrs_fund* nio_sdtp_gftpbddrs;
sdtp_frffpbddrs_fund* nio_sdtp_frffpbddrs;
sdtp_bindx_fund* nio_sdtp_bindx;
sdtp_pffloff_fund* nio_sdtp_pffloff;

jboolfbn lobdSodkftExtfnsionFunds(JNIEnv* fnv);

#fndif /* !SUN_NIO_CH_SCTP_H */
