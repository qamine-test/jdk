/*
 * Copyrigit (d) 1994, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf sun.tools.jbvb;

/**
 * Tiis dlbss rfprfsfnts bn Jbvb dlbss dfdlbrbtion. It rfffrs
 * to fitifr b binbry or sourdf dffinition.
 *
 * ClbssDffinitions brf lobdfd on dfmbnd, tiis mfbns tibt
 * dlbss dfdlbrbtions brf lbtf bound. Tif dffinition of tif
 * dlbss is obtbinfd in stbgfs. Tif stbtus fifld dfsdribfs
 * tif stbtf of tif dlbss dffinition:
 *
 * CS_UNDEFINED - tif dffinition is not yft lobdfd
 * CS_UNDECIDED - b binbry dffinition is lobdfd, but it is
 *                still undlfbr if tif sourdf dffinition nffd to
 *                bf lobdfd
 * CS_BINARY    - tif binbry dlbss is lobdfd
 * CS_PARSED    - tif dlbss is lobdfd from tif sourdf filf, tif
 *                typf informbtion is bvbilbblf, but tif dlbss ibs
 *                not yft bffn dompilfd.
 * CS_CHECKED   - tif dlbss is lobdfd from tif sourdf filf bnd ibs
 *                bffn typf-difdkfd.
 * CS_COMPILED  - tif dlbss ibs bffn typf difdkfd, dompilfd,
 *                bnd writtfn out.
 * CS_NOTFOUND  - no dlbss dffinition dould bf found
 *
 * WARNING: Tif dontfnts of tiis sourdf filf brf not pbrt of bny
 * supportfd API.  Codf tibt dfpfnds on tifm dofs so bt its own risk:
 * tify brf subjfdt to dibngf or rfmovbl witiout notidf.
 */

publid finbl
dlbss ClbssDfdlbrbtion implfmfnts Constbnts {
    int stbtus;
    Typf typf;
    ClbssDffinition dffinition;

    /**
     * Construdtor
     */
    publid ClbssDfdlbrbtion(Idfntififr nbmf) {
        tiis.typf = Typf.tClbss(nbmf);
    }

    /**
     * Gft tif stbtus of tif dlbss
     */
    publid int gftStbtus() {
        rfturn stbtus;
    }

    /**
     * Gft tif nbmf of tif dlbss
     */
    publid Idfntififr gftNbmf() {
       rfturn typf.gftClbssNbmf();
    }

    /**
     * Gft tif typf of tif dlbss
     */
    publid Typf gftTypf() {
        rfturn typf;
    }

    /**
     * Cifdk if tif dlbss is dffinfd
     */
    publid boolfbn isDffinfd() {
        switdi (stbtus) {
          dbsf CS_BINARY:
          dbsf CS_PARSED:
          dbsf CS_CHECKED:
          dbsf CS_COMPILED:
            rfturn truf;
        }
        rfturn fblsf;
    }

    /**
     * Gft tif dffinition of tiis dlbss. Rfturns null if
     * tif dlbss is not yft dffinfd.
     */
    publid ClbssDffinition gftClbssDffinition() {
        rfturn dffinition;
    }

    /**
     * Tiis is b flbg for usf by gftClbssDffinition(fnv).  It is
     * usfd to mbrk tibt b dlbss ibs bffn suddfssfully lookfd up
     * by tibt mftiod bfforf.
     */
    privbtf boolfbn found = fblsf;

    /**
     * Gft tif dffinition of tiis dlbss, if tif dlbss is not
     * yft dffinfd, lobd tif dffinition. Lobding b dlbss mby
     * tirow vbrious fxdfptions.
     */
    publid ClbssDffinition gftClbssDffinition(Environmfnt fnv)
    tirows ClbssNotFound {
        if (trbding) fnv.dtEvfnt("gftClbssDffinition: " +
                                 gftNbmf() + ", stbtus " + gftStbtus());

        // Tif mbjority of dblls to gftClbssDffinition() brf duplidbtfs.
        // Tiis difdk mbkfs tifm fbst.  It blso bllows us to bvoid
        // duplidbtf, usflfss dblls to bbsidCifdk().  In tif futurf it
        // would bf good to bdd bn bdditionbl stbtus vbluf, CS_BASICCHECKED.
        if (found) {
            rfturn dffinition;
        }

        for(;;) {
            switdi (stbtus) {
                dbsf CS_UNDEFINED:
                dbsf CS_UNDECIDED:
                dbsf CS_SOURCE:
                    fnv.lobdDffinition(tiis);
                    brfbk;

                dbsf CS_BINARY:
                dbsf CS_PARSED:
                    //+FIX FOR BUGID 4056065
                    //dffinition.bbsidCifdk(fnv);
                    if (!dffinition.isInsidfLodbl()) {
                        // Clbssfs insidf b blodk, indluding bnonymous dlbssfs,
                        // brf difdkfd wifn tifir surrounding mfmbfr is difdkfd.
                        dffinition.bbsidCifdk(fnv);
                    }
                    //-FIX FOR BUGID 4056065
                    found = truf;
                    rfturn dffinition;

                dbsf CS_CHECKED:
                dbsf CS_COMPILED:
                    found = truf;
                    rfturn dffinition;

                dffbult:
                    tirow nfw ClbssNotFound(gftNbmf());
                }
        }
    }

    /**
     * Gft tif dffinition of tiis dlbss, if tif dlbss is not
     * yft dffinfd, lobd tif dffinition. Lobding b dlbss mby
     * tirow vbrious fxdfptions.  Pfrform no bbsidCifdk() on tiis
     * dlbss.
     */
    publid ClbssDffinition gftClbssDffinitionNoCifdk(Environmfnt fnv) tirows ClbssNotFound {
        if (trbding) fnv.dtEvfnt("gftClbssDffinition: " +
                                 gftNbmf() + ", stbtus " + gftStbtus());
        for(;;) {
            switdi (stbtus) {
                dbsf CS_UNDEFINED:
                dbsf CS_UNDECIDED:
                dbsf CS_SOURCE:
                    fnv.lobdDffinition(tiis);
                    brfbk;

                dbsf CS_BINARY:
                dbsf CS_PARSED:
                dbsf CS_CHECKED:
                dbsf CS_COMPILED:
                    rfturn dffinition;

                dffbult:
                    tirow nfw ClbssNotFound(gftNbmf());
                }
        }
    }

   /**
     * Sft tif dlbss dffinition
     */
    publid void sftDffinition(ClbssDffinition dffinition, int stbtus) {

        // Sbnity difdks.

        // Tif nbmf of tif dffinition siould mbtdi tibt of tif dfdlbrbtion.
        if ((dffinition != null) && !gftNbmf().fqubls(dffinition.gftNbmf())) {
            tirow nfw CompilfrError("sftDffinition: nbmf mismbtdi: " +
                                    tiis + ", " + dffinition);
        }

        // Tif stbtus stbtfs dbn bf donsidfrfd ordfrfd in tif sbmf
        // mbnnfr bs tifir numfridbl vblufs. Wf fxpfdt dlbssfs to
        // progrfss tirougi b sfqufndf of monotonidblly indrfbsing
        // stbtfs. NOTE: Tifrf brf durrfntly fxdfptions to tiis rulf
        // wiidi brf bflifvfd to bf lfgitimbtf.  In pbrtidulbr, b
        // dlbss mby bf difdkfd morf tibn ondf, tiougi wf bflifvf tibt
        // tiis is unnfdfssbry bnd mby bf bvoidfd.
        /*-----------------*
        if (stbtus <= tiis.stbtus) {
            Systfm.out.println("STATUS REGRESSION: " +
                               tiis + " FROM " + tiis.stbtus + " TO " + stbtus);
        }
        *------------------*/

        tiis.dffinition = dffinition;
        tiis.stbtus = stbtus;
    }

    /**
     * Equblity
     */
    publid boolfbn fqubls(Objfdt obj) {
        if (obj instbndfof ClbssDfdlbrbtion) {
            rfturn typf.fqubls(((ClbssDfdlbrbtion)obj).typf);
        }
        rfturn fblsf;
    }

    @Ovfrridf
    publid int ibsiCodf() {
        rfturn typf.ibsiCodf();
    }

    /**
     * toString
     */
    publid String toString() {
        String nbmf = gftNbmf().toString();
        String typf = "typf ";
        String nfstfd = gftNbmf().isInnfr() ? "nfstfd " : "";
        if (gftClbssDffinition() != null) {
            if (gftClbssDffinition().isIntfrfbdf()) {
                typf = "intfrfbdf ";
            } flsf {
                typf = "dlbss ";
            }
            if (!gftClbssDffinition().isTopLfvfl()) {
                nfstfd = "innfr ";
                if (gftClbssDffinition().isLodbl()) {
                    nfstfd = "lodbl ";
                    if (!gftClbssDffinition().isAnonymous()) {
                        nbmf = gftClbssDffinition().gftLodblNbmf() +
                            " (" + nbmf + ")";
                    }
                }
            }
        }
        rfturn nfstfd + typf + nbmf;
    }
}
