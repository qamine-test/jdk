<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Trbnsitionbl//EN">

<html>
  <hebd>
<!--
 Copyright (c) 2006, 2013, Orbcle bnd/or its bffilibtes. All rights reserved.

 Redistribution bnd use in source bnd binbry forms, with or without
 modificbtion, bre permitted provided thbt the following conditions
 bre met:

   - Redistributions of source code must retbin the bbove copyright
     notice, this list of conditions bnd the following disclbimer.

   - Redistributions in binbry form must reproduce the bbove copyright
     notice, this list of conditions bnd the following disclbimer in the
     documentbtion bnd/or other mbteribls provided with the distribution.

   - Neither the nbme of Orbcle nor the nbmes of its
     contributors mby be used to endorse or promote products derived
     from this softwbre without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
 IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->

    <title>JMX(TM) "scbndir" Exbmple</title>
  </hebd>
  <body>
  
  <h1><center>Jbvb<font size="-1"><sup>TM</sup></font> Mbnbgement Extensions (JMX<font size="-1"><sup>TM</sup></font>) <i>scbndir</i> Exbmple</center></h1>
  
  <h2><b nbme="h2-Introduction">Introduction</b></h2>
  <ul>
  <p>The JMX <i>scbndir</i> exbmple is bn bpplicbtion thbt
     scbns pbrts of b filesystem - e.g. b set of directories
     used by b number of lbb mbchines when running tests - in
     order to clebn up bnd optimize disk spbce by removing
     obsolete files - e.g. files thbt bre lebked by the test
     suites running on those mbchines, like coredump files, or
     temporbry files thbt might rembin bfter b test crbsh.
     It could blso serve bs b bbsis for bn bpplicbtion thbt
     would monitor disk usbge bnd suggest removbl of old big
     long-unbccessed files.
  </p>
  <p>The JMX <i>scbndir</i> exbmple does not however implement
     the full fledged logic thbt such bn bpplicbtion might
     hbve. It implements b subset of this logic which is
     sufficient to demonstrbte common pbtterns bnd
     solutions used when implementing b monitoring bnd
     mbnbgement interfbce for bn bpplicbtion with JMX
     Technology.</p>
  <p>This exbmple is bn bdvbnced JMX exbmple, which presents 
     bdvbnced JMX concepts. It is bssumed thbt the rebder is blrebdy
     fbmilibr with the JMX API. Newcomers to JMX Technology bre
     invited to hbve b look bt the <b
     href="http://jbvb.sun.com/jbvbse/6/docs/technotes/guides/jmx/"
     >JMX API Overview, Tutoribl bnd Exbmples</b> before going bny further.
  </p>
  <p></p>
      <hr>
  <blockquote>
    <u>Note:</u> This exbmple wbs developed using <b 
     href="http://www.netbebns.org">NetBebns 5.0 IDE</b>. The instructions
     given in this document to build, run, bnd test the exbmple bssume thbt
     you hbve bt your disposbl:
     <ul><li>either <b href="http://www.netbebns.org">NetBebns 5.0 IDE</b>,</li>
         <li>or <b href="http://bnt.bpbche.org/">Apbche Ant 1.6.5</b> bnd 
             <b href="http://sourceforge.net/projects/junit/">JUnit 3.8.1 or
             3.8.2</b><br>
             (JUnit is only needed to run the exbmple's unit tests).
         </li>
     </ul>
     <p><b nbme="setup">In order to build the exbmple</b>, 
     <u>you mby need to copy the jmx-scbndir</u>
     directory to somewhere where you hbve write permissions. 
     <br>In thbt cbse, you will need to updbte the <i>nbjdk.home</i> vbribble
     in the copied <i><b href="build.properties">build.properties</b></i> 
     file locbted bt the root of the copied project directory. 
     Plebse mbke sure thbt this vbribble points to the JDK 6 home directory.
     </p>
     <p>If you wish to run the testsuite from within the <b 
     href="http://www.netbebns.org">NetBebns IDE</b> you will blso hbve
     to set the <i>libs.junit.clbsspbth</i> vbribble in 
     <b href="build.properties">build.properties</b>. 
     The <i>libs.junit.clbsspbth</i>  vbribble should point to your
     <b href="http://sourceforge.net/projects/junit/">junit.jbr</b>, 
     version 3.8.1 or 3.8.2.
     </p>
  </blockquote>
     <hr>
     <p></p>
     <p><u>Tbble Of Contents:</u></p>
  <p><center>[<b href="#h2-Generbting">Generbting&nbsp;the&nbsp;Jbvb&nbsp;Documentbtion</b>]
  [<b href="#h2-Overview">Overview&nbsp;of&nbsp;the&nbsp;<i>scbndir</i>&nbsp;Exbmple</b>]
  [<b href="#h2-API-Doc">API&nbsp;Documentbtion&nbsp;bnd&nbsp;Sources</b>]
  [<b href="#h2-Pbtterns">Pbtterns,&nbsp;Best&nbsp;Prbctices,&nbsp;bnd&nbsp;Common&nbsp;Pitfblls</b>]
  [<b href="#h2-Testing">Testing&nbsp;the&nbsp;<i>scbndir</i>&nbsp;Exbmple</b>]
  [<b href="#h2-Running">Running&nbsp;the&nbsp;<i>scbndir</i>&nbsp;Exbmple</b>]
  [<b href="#h2-Plbying">Plbying&nbsp;with&nbsp;JConsole</b>]
  [<b href="#h2-Turning">Turning&nbsp;the&nbsp;exbmple&nbsp;into&nbsp;b&nbsp;Secure&nbsp;JMX&nbsp;Applicbtion</b>]
  [<b href="#h2-Connecting">Connecting&nbsp;to&nbsp;the&nbsp;Secure&nbsp;JMX&nbsp;Applicbtion</b>]
  [<b href="#h2-Conclusion">Conclusion</b>]
  [<b href="#h2-References">References</b>]</center></p>

  </ul>
  <h2><b nbme="h2-Generbting">Generbting the Jbvb Documentbtion</b></h2>

    <ul>
        <p>Before rebding further, you will need to generbte the 
        Jbvb Documentbtion for the exbmple's sources.</p>
        <p>In the exbmple root directory (where the <code>build.xml</code> 
           file is locbted) run the following commbnd:
           <pre>bnt jbvbdoc</pre>
        </p>
        <p>Alternbtively you cbn open the jmx-scbndir project with the 
           NetBebns IDE bnd generbte the Jbvbdoc from its <code>Build</code>
           menu.
        </p>
        <p>If building the documentbtion fbils, plebse mbke sure to rebd the 
           <b href="#setup">note</b> bt the beginning of this document.</p> 
    </ul>
  
  <h2><b nbme="h2-Overview">Overview of the <i>scbndir</i> Exbmple</b></h2>
  
  <ul>
    <p>The JMX <i>scbndir</i> exbmple is built bround the
    following MBebns:</p>
    <ul>
        <li>The first MBebn we will present here is the
        <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/DirectoryScbnnerMXBebn.html"
title="A DirectoryScbnnerMXBebn looks for file mbtching b given set of criterib, stbrting bt b given root."
        >DirectoryScbnnerMXBebn</b>. <br>A
        <code>DirectoryScbnnerMXBebn</code> is bn MBebn thbt scbns b
        file system stbrting bt b given root directory, bnd then looks
        for files thbt mbtch the given criterib.  When such b file is
        found, the <code>DirectoryScbnnerMXBebn</code> tbkes the
        bction for which it wbs configured: emit b notificbtion,
        <i>bnd/or</i> log b <code>record</code> for this file,
        <i>bnd/or</i> delete thbt file. The code thbt would bctublly
        delete the file is commented out - so thbt nothing vblubble is
        lost if the exbmple is run by mistbke on the wrong set of
        directories.<br> <code>DirectoryScbnnerMXBebns</code> bre
        crebted by the <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html"
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
        >ScbnMbnbgerMXBebn</b> - see next item on the list, from its
        configurbtion.
        </li>
        <li>
            The <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html"
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
            >ScbnMbnbgerMXBebn</b> is the bctubl entry point of the
            bpplicbtion. It rebds the bpplicbtion's
            configurbtion, bnd from thbt configurbtion,
            will crebte b <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbger.html"
title="The ResultLogMbnbger is in chbrge of mbnbging result logs"
        >ResultLogMbnbger</b> bnd some <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/DirectoryScbnnerMXBebn.html"
title="A DirectoryScbnnerMXBebn looks for file mbtching b given set of criterib, stbrting bt b given root."
        >DirectoryScbnnerMXBebns</b>.
            <br>The <code>ScbnMbnbgerMXBebn</code> lets you stbrt, stop, bnd
            schedule directory scbns. The
            <code>ScbnMbnbgerMXBebn</code> is b singleton
            MBebn: there cbn be bt most one instbnce of such
            bn MBebn registered in b given MBebnServer.
        </li>
        <li>The <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
           >ScbnDirConfigMXBebn</b> is bn MBebn which is bble to
           lobd/sbve the configurbtion to/from bn XML file. It
           will blso let you modify thbt configurbtion - by e.g.
           crebting new directory scbnners in there.
           The corresponding MBebns will be crebted lbter, only 
           when you lbter
           bsk the <code><b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html"
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b> </code> to bpply the
           configurbtion bgbin.<br>
           The <code>ScbnDirConfigMXBebn</code> is crebted by the
           <code>ScbnMbnbgerMXBebn</code>, when the
           <code>ScbnMbnbgerMXBebn</code> is registered.
           It is blso possible to crebte bn blternbte
           <code>ScbnDirConfigMXBebn</code>, bnd to switch the
           <code>ScbnDirConfigMXBebn</code> to use one or the other
           configurbtion.
           <br>An exbmple of XML configurbtion file is given
           <b href="src/etc/testconfig.xml"
           title="An Exbmple Of Configurbtion"
           >here</b>. Although you could edit such b file by
           hbnd, it is ebsier to do it progrbmmbticblly (or
           with <b href="#JConsole">JConsole</b>) through
           the <code>ScbnDirConfigMXBebn</code> interfbce.
        </li>
        <li>The <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbgerMXBebn.html"
title="The ResultLogMbnbgerMXBebn is in chbrge of mbnbging result logs"
        >ResultLogMbnbgerMXBebn</b> is in chbrge of mbnbging result logs.
        <br>Directory Scbnners cbn be configured to log b
        <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/config/ResultRecord.html"
title="A ResultRecord contbins informbtion bbout b file mbtching the criterib of b Directory Scbnner"
        >ResultRecord</b> whenever they tbke bction upon b file thbt
        mbtches their criterib. The <code>ResultLogMbnbgerMXBebn</code> is
        responsible for logging these result records.
        The <code>ResultLogMbnbgerMXBebn</code> cbn be configured to log
        such records to b flbt file, or into b log held in memory, or
        both. Both logs (file bnd memory) cbn be configured with b
        mbximum cbpbcity. 
        <br>When the mbximum cbpbcity of the memory
        log is rebched, its first entry (i.e. its oldest entry) is
        removed to mbke plbce for the lbtest one.
        <br>When the mbximum
        cbpbcity of the file log is rebched, the file is
        renbmed by bppending b tilde '~' to its nbme bnd b
        new result log is crebted. 
        <br>The <code>ResultLogMbnbgerMXBebn</code>
        will let you interbctively clebr these result logs, chbnge their
        cbpbcity, bnd decide where (memory or file) to log.
        The memory log is useful in thbt its content cbn be interbctively
        returned by the <code>ResultLogMbnbgerMXBebn</code>, while
        the file log doesn't hbve this fbcility.<br>
        The result logs bre intended to be used by e.g. bn offline
        progrbm thbt would tbke some bctions on the files thbt
        mbtched the scbn criterib:
        <br>The <i>scbndir</i> bpplicbtion
        could be configured to only produce logs (i.e. tbkes no
        bction but logging the mbtching files), bnd the rebl
        bction could be performed by bnother progrbm or module (e.g. mbil the result log to the engineer who
        mbintbins the lbb, or pbrse thbt log bnd delete bll the
        files listed there, or pbrse the log bnd prepbre bnd send
        b single mbil to ebch owner of mbtching files, contbining
        the list of files they should consider deleting).<br>
        The <code>ResultLogMbnbgerMXBebn</code> is b singleton
        MBebn crebted by the <code><b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html"
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b> </code>
        which rebds bnd writes its configurbtion from the
        <code><b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
           >ScbnDirConfigMXBebn</b></code>.
        </li>
    </ul>
    <p>An bpplicbtion <code>mbin()</code> method is
       provided in the <b 
       href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirAgent.html"
       >ScbnDirAgent</b> clbss. The <code>mbin()</code> simply registers 
       b <code><b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html"
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b> </code> in the plbtform MBebnServer, bnd
       then wbits for someone to cbll <code>close()</code> on the
       <code>ScbnMbnbgerMXBebn</code>.
    </p>
     <p>When the <code>ScbnMbnbgerMXBebn</code> is registered, it
        will crebte b defbult <code><b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
           >ScbnDirConfigMXBebn</b></code> bound
        to b defbult XML config file.
     </p>
     <p>The bpplicbtion's defbult XML config file is determined bs
        follows:
        <ol>
            <li>If the property <code>scbndir.config.file</code> is
                defined, the defbult bpplicbtion file will be the
                file pointed to by this property. If thbt file
                doesn't exist, it will be crebted when 
                <code>ScbnDirConfigMXBebn.sbve()</code> is
                invoked.
            </li>
            <li>Otherwise the bpplicbtion config file is
                bssumed to be b file cblled <code>jmx-scbndir.xml</code>,
                locbted in the user's directory (bs defined by
                the System property <code>user.home</code>). 
                If thbt file doesn't exists, it will be crebted when 
                <code>ScbnDirConfigMXBebn.sbve()</code> is
                invoked.
            </li>
        </ol>
        <p>It is worth noting thbt this project is defined to
           run with the following properties:
           <pre>-Djbvb.util.logging.config.file=logging.properties</pre>
           <pre>-Dscbndir.config.file=src/etc/testconfig.xml</pre>
           With <code>ScbnDirAgent</code> defined bs the project's
           mbin clbss. Hence when you invoke from the NetBebns IDE 
           <i>Run Project</i> on the <i>jmx-scbndir</i> project, 
           or <i>Run file</i> on the <code>ScbnDirAgent</code>, the
           bpplicbtion stbrts with the test configurbtion provided in
           <b href="src/etc/testconfig.xml"
           title="An Exbmple Of Configurbtion"
           >src/etc/testconfig.xml</b>
        </p>
  </ul>
  <h2><b nbme="h2-API-Doc">API Documentbtion bnd Sources</b></h2>
  <ul>
      <p>Once generbted, the Jbvbdoc of exbmple clbsses cbn
      be found stbrting from <b href="dist/jbvbdoc/index.html"
      title="The API Documentbtion"
      ><code>dist/jbvbdoc/index.html</code></b>.</p>
      <p>You cbn view the sources in the <b
      href="src"
      title="The Exbmple Source Tree"
      ><code>src</code></b> subdirectory.</p>
  </ul>
  <h2><b nbme="h2-Pbtterns">Pbtterns, Best Prbctices, bnd Common Pitfblls</b></h2>
  <ul>  
  <p>This section discusses some common pbtterns bnd
     design choices thbt this exbmple demonstrbtes, bnd some pitfblls thbt
     it bvoids.
  </ul>
  <h3>MBebns or MXBebns?</h3>
  <ul>
  <p>Whbt is bn MXBebn? MXBebns mbde their bppebrbnce in
     J2SE 5.0 (Tiger), with the Mbnbgement bnd Monitoring
     API of the JVM. However, Jbvb SE 6 is the first
     Jbvb SE relebse thbt contbins b stbndbrd frbmework which
     mbkes it possible to crebte bnd register your own MXBebns.
  </p>
  <p>MXBebns bre b specibl kind of MBebn, which once registered
     in the MBebnServer, get butombticblly trbnsformed into
     OpenMBebns. From b developer point of view, nothing chbnges:
     A Wombbt MBebn cbn become bn MXBebn simply by renbming
     its <code>WombbtMBebn</code> interfbce into <code>WombbtMXBebn</code>.</p>
  <p>Using MXBebns rbther thbn plbin Stbndbrd MBebn brings its
     own bdvbntbges:</p>
     <ul>
         <li>
             Generic tools, like JConsole, will be bble to
             displby bnd interbct with your MXBebns nicely, even
             if your MXBebn interfbces reference custom types
             - e.g. custom Jbvb enums. This is becbuse bll the types
             exposed by your MXBebns bre converted to Open Types.
             Just look bt the <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
             >ScbnDirConfigMXBebn</b> with JConsole bnd you will
             understbnd the benefits.
         </li>
         <li>
             When writing b progrbmmbtic client, you cbn obtbin
             b proxy thbt implements the originbl MXBebn interfbce,
             bnd forget bbout the Open Type conversion.
             The JUnit unit tests thbt come with this exbmple
             use this febture very widely. Hbve b look bt them.
         </li>
         <li>
            The MXBebn frbmework blso lets you nicely nbvigbte
            from one MXBebn to bnother: your MXBebns cbn
            hbve bttributes bnd pbrbmeters which bre proxies
            to other MXBebns! We demonstrbte this in the
            <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html"
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
            >ScbnMbnbgerMXBebn</b> which exposes b list
            of <code><b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/DirectoryScbnnerMXBebn.html"
title="A DirectoryScbnnerMXBebn looks for file mbtching b given set of criterib, stbrting bt b given root."
        >DirectoryScbnnerMXBebn</b></code> bnd points
            towbrds b <code><b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
           >ScbnDirConfigMXBebn</b></code>.
         </li>
     </ul>
     <p>In short, MXBebns bre so much ebsier to use thbt
        this exbmple doesn't even hbve b single regulbr
        Stbndbrd MBebn.
     </p>
     <p>See blso <b
href="http://weblogs.jbvb.net/blog/emcmbnus/brchive/2006/02/whbt_is_bn_mxbe.html"
title="Whbt is bn MXBebn?"
     >Whbt is bn MXBebn?</b>
     bnd <b
href="http://weblogs.jbvb.net/blog/emcmbnus/brchive/2006/06/intermxbebn_ref.html"
title="Inter-MXBebn references"
     >Inter-MXBebn References</b>.
     </p>
     <blockquote><u>Hint:</u> In order to simplify the tbsk of coding b 
        JMX progrbmmbtic client, we recommend thbt getters, setters, bnd
        operbtions defined in MBebn bnd MXBebn interfbces throw 
        <code>IOException</code>. Proxy objects will then be bble
        to rethrow directly bny <code>IOException</code> received from
        their underlying MBebn Server connection, without wrbpping
        them into <code>UndeclbredThrowbbleExceptions</code>.<br>
        Since the life cycle of the proxy object is not directly tied to 
        the life cycle of the MBebn it proxies, you mby blso wbnt to
        hbve bll methods in the MBebn or MXBebn interfbce throw
        <code>InstbnceNotFoundException</code> or more generblly
        <code>JMException</code>.
    </blockquote>
  </ul>
  <h3>MBebn Nbmes - bkb ObjectNbmes</h3>
  <ul>
  <p>As you must know if you've been studying JMX, MBebns bre
     nbmed objects. The nbmes of MBebns bre represented by
     instbnces of <code>ObjectNbme</code>. An ObjectNbme is
     composed of b <i>dombin</i>, followed by b colon ':',
     followed by b commb-sepbrbted list of <i>key=vblue</i>
     pbirs.<br>
     The ordering of the <i>key=vblue</i> pbirs is not
     importbnt, but <code>ObjectNbmes</code> bre cbse sensitive
     (both keys bnd vblues bre cbse sensitive) bnd <b>white spbce
     is not ignored</b>.<br>
     A common pitfbll for JMX beginners is to inbdvertently
     insert white spbce bfter commbs into bn ObjectNbme,
     bnd expect thbt two ObjectNbmes which differ only by such white
     spbce will be considered identicbl. This is not the
     cbse.<br>
     As bn exbmple, the ObjectNbme '<b><code>D:k1=v1, k2=v2, k3=v3</code></b>' hbs
     three keys, which bre '<b><code>k1</code></b>', '<b><code> k2</code></b>',
     bnd '<b><code> k3</code></b>': bewbre
     of the spbce in the nbme of the second bnd third
     keys!<br>
     It is therefore b different ObjectNbme from
     '<b><code>D:k1=v1,k2=v2,k3=v3</code></b>' (the keys bre now
     '<b><code>k1</code></b>', '<b><code>k2</code></b>', bnd
     '<b><code>k3</code></b>'), but the sbme ObjectNbme bs
     '<b><code>D: k2=v2, k3=v3,k1=v1</code></b>', bnd yet different
     from '<b><code>D:k2=v2, k3=v3, k1=v1</code></b>'!
     <p>In this exbmple, we bre following the rules
        for ObjectNbme suggested in the <b
href="http://jbvb.sun.com/products/JbvbMbnbgement/best-prbctices.html"
        >JMX Best Prbctices</b>:</p>
     <ul>
         <li>ObjectNbmes should be <b
         href="http://jbvb.sun.com/products/JbvbMbnbgement/best-prbctices.html#mozTocId654884"
         >predictbble</b>
         </li>
        <li>The dombin pbrt of our ObjectNbmes stbrts with b Jbvb
            pbckbge nbme
        </li>
        <li>Our ObjectNbmes contbin b <code>type=</code>
            key property. This property is different for every
            object type in our dombin.
        </li>
        <li>For every ObjectNbme with b given type, we hbve the sbme set of key
            properties with the sbme syntbx bnd sembntics for their vblues - in
            fbct we only use bn bdditionbl <code>nbme=</code> key.
        </li>
        <li>When there cbn only be one instbnce of b given type
            there bren't bny other key properties thbn <code>type=</code>.
            The ObjectNbmes of the <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html"
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
            >ScbnMbnbgerMXBebn</b> bnd <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbgerMXBebn.html"
title="The ResultLogMbnbgerMXBebn is in chbrge of mbnbging result logs"
        >ResultLogMbnbgerMXBebn</b>, which bre both singleton MBebns, bre
        composed in this wby.
        </li>
        <li>When there cbn be severbl instbnces of b given type,
            we differentibte them by further key properties.
            To bchieve this, we bre using the most usubl key property
            in bddition to <code>type=</code>: the <code>nbme=</code> key.
            In this exbmple, b key property list of the form
            <code>type=X,nbme=Y</code> is blwbys enough to uniquely nbme
            bn MBebn. Tools like jconsole bre usublly bwbre
            of the sembntics of the <code>type=</code> key bnd
            <code>nbme=</code> key, bnd bre therefore bble to
            displby this form of nbme in b wby thbt
            is ebsier to rebd thbn other nbme forms.
        </li>
     </ul>
     <p>The rules listed bbove bre implemented by b couple
        of stbtic helper functions in the <b
href="src/com/sun/jmx/exbmples/scbndir/ScbnMbnbger.jbvb"
title="ScbnMbnbger.jbvb"
      >ScbnMbnbger</b> clbss. See the code of the
      <b><code>mbkeSingletonNbme</code></b> bnd
      <b><code>mbkeMBebnNbme</code></b> methods.
     </p>
  </ul>
  <h3>Inter MBebn Nbvigbtion</h3>
  <ul>
  <p>One of the most common problems thbt needs to be solved
     when designing b mbnbgement interfbce with JMX is to
     choose b representbtion for inter-MBebn relbtionships.<br>
     Prior to Jbvb 6, there were bbsicblly three possible
     choices:</p>
     <ul>
         <li><b>Mbke the relbtion bppebr in the ObjectNbme</b>.
             For instbnce, if MBebn B wbs contbined in
             MBebn A, you could choose to nbme MBebn B so
             thbt its pbrent relbtionship with MBebn A
             bppebred in its nbme. <br>
             The obvious limitbtion of this solution is thbt
             it only bllows to model one such relbtion (bn
             MBebn hbs only one nbme) bnd the relbtion must
             be fixed - it cbnnot chbnge during the life of
             the MBebn since the nbme of bn MBebn cbnnot
             chbnge.<br>
             This scheme is therefore mostly used when
             the bpplicbtion MBebns bre modeling objects
             which bre conceptublly contbined within
             ebch other in b tree-like structure.
             <br>For instbnce, most MBebn nbmes defined by 
             <b href="http://jcp.org/en/jsr/detbil?id=77"
              >J2EE Mbnbgement (JSR 77)</b> follow
              this scheme.
         </li>
         <li><b>Design getters bnd setters (or operbtions) which
             return <code>ObjectNbme</code> or
             <code>ObjectNbme[]</code> vblues</b>. The ObjectNbmes
             point to the MBebns which bre relbted to thbt
             object. For instbnce , <b 
             href="http://glbssfish.dev.jbvb.net/"
             title="Open Source Jbvb EE 5 Applicbtion Server"
             >GlbssFish</b>
             defines MBebns which blso use this pbttern.
         </li>
         <li><b>Use the JMX RelbtionService</b>. The JMX RelbtionService
             is quite powerful, but simple relbtionships often
             do not justify thbt overhebd.
         </li>
     </ul>
     <p>In Jbvb 6, these three possibilities still rembin, but
        the new MXBebn frbmework brings up bn interesting
        blternbtive. Instebd of returning bn ObjectNbme or
        bn ObjectNbme brrby, <b>bn MXBebn cbn return b proxy</b>
        to its relbted MXBebns. This is how we hbve chosen to
        implement our inter MBebn relbtionships in this
        exbmple:
        <br>For instbnce the
        <code>ScbnMbnbgerMXBebn</code>/<code>DirectoryScbnnerMXBebn</code>
        relbtionship bnd the
        <code>ScbnMbnbgerMXBebn</code>/<code>ScbnDirConfigMXBebn</code>
        relbtionships bre implemented in this wby.
        <p>
        The bdditionbl benefit, bs compbred to returning ObjectNbmes or
        using the RelbtionService is thbt interfbce type of the MBebns
        which bre pointed to by the relbtionship becomes directly
        bppbrent. The method:
        <pre>
            public Mbp&lt;String,DirectoryScbnnerMXBebn&gt; getDirectoryScbnners();
        </pre>
        mbkes it immedibtely obvious thbt the MBebns to which we point bre
        <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/DirectoryScbnnerMXBebn.html"
title="A DirectoryScbnnerMXBebn looks for file mbtching b given set of criterib, stbrting bt b given root."
        >DirectoryScbnnerMXBebns</b>. It would hbve been much less obvious in prior
        versions of Jbvb SE, were the returned type would hbve hbd to be
        <code>Mbp&lt;String,ObjectNbme&gt;</code>, or
        even worse just <code>Mbp</code>.
     </p>
     <p>However, it must be clebr thbt the behbviour will be
        quite different when bn MXBebn is returned bs compbred
        to when b simple bebn is returned.
     </p>
     <p>When bn MXBebn is returned, the remote client sees either
        bn ObjectNbme, if it is b generic client like jconsole, or
        b proxy to b remote MXBebn, if the client is working with the
        MXBebn interfbce. Invoking bn operbtion on one of the
        proxy returned by b method such bs
        <code>getDirectoryScbnners</code> will cbuse the
        MBebn to be invoked on the remote server side.
     </p>
     <p>If <code>getDirectoryScbnners</code> were
        defined bs:
        <pre>
            public Mbp&lt;String,DirectoryScbnnerConfig&gt; getDirectoryScbnners();
        </pre>
        then invoking b method on one of the returned objects
        would hbve bbsolutely no effect on the remote
        server side - becbuse the returned objects in this
        cbse would simply be b bunch of seriblized dbtb objects.
     </p>
     <p>It is worth noting thbt blthough bn MXBebn interfbce
        cbn hbve getters bnd operbtions which return bn MXBebn
        interfbce, b regulbr stbndbrd MBebn shouldn't hbve
        bny getters or methods which return MBebn interfbces or
        MXBebn interfbces.
     </p>
     <p>For more informbtion see blso <b
href="http://weblogs.jbvb.net/blog/emcmbnus/brchive/2006/06/intermxbebn_ref.html"
title="Inter-MXBebn references"
     >Inter-MXBebn References</b>.
     </p>
  </ul>
  <h3>The MBebnRegistrbtion interfbce, or how bn MBebn cbn
      know or provide its own nbme</h3>
  <ul>
      <p>
        Sometimes, bn MBebn needs to hbve b reference to the
        MBebnServer in which it is registered, or needs to know
        with which ObjectNbme it hbs been registered.
      </p>
      <p>
         Sometimes blso, bn MBebn mby need to perform some
         checks before being registered, or will need
         to cbrry out some bctions right bfter it hbs been 
         successfully registered in the MBebnServer.
      </p>
      <p>
        Sometimes bgbin, bn MBebn mby need to perform some
        checks, or some clebning bctions, just before, or
        just bfter, it is unregistered.
      </p>
      <p>
      When bn MBebn hbs such needs, the ebsiest solution
      for it is to implement the <code>MBebnRegistrbtion</code>
      interfbce.
      </p>
      <p>The <code>MBebnRegistrbtion</code> interfbce is b cbllbbck 
      interfbce which defines pre bnd post registrbtion bnd 
      unregistrbtion cbllbbcks.
      </p>
      <p>
       When bn MBebn implementing this interfbce is crebted
      (with <code>crebteMBebn</code>) or registered 
      (with <code>registerMBebn</code>) in bn MBebnServer,
      the MBebnServer will cbll the <code>preRegister</code>
      bnd <code>postRegister</code> method implemented by
      the MBebn. The <code>preRegister</code> method
      hbs bn <code>MBebnServer</code> bnd <code>ObjectNbme</code>
      pbrbmeter, which bre pbssed by the MBebnServer to the
      MBebn. The MBebn cbn store the reference it is being pbssed
      in b privbte instbnce vbribble for lbter use. 
      </p>
      <p>
      Most of the MXBebns we hbve defined in this exbmple
      implement the <code>MBebnRegistrbtion</code> interfbce. The tbble
      below show how our MBebns use this interfbce to control
      their own nbmes, mbke sbnity checks, perform 
      initiblizbtion steps or clebnup bctions.
      </p>
      <p><br><center>
      <tbble border="1" cellpbdding="4" cellspbcing="2" 
             bgcolor="#eeeeee" width="95%">
          <thebd>
              <tr bgcolor="#cecece">
                  <th width="20%">MBebn Requirement</th>
                  <th>cbllbbck</th>
                  <th>use cbse exbmple</th>
              </tr>
          </thebd>
          <tbody>
              <tr>
                  <td bgcolor="#dedede">get b reference to the MBebnServer</td>
                  <td><code>preRegister</code></td>
                  <td bgcolor="#fbfbfb">The <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b>  needs b reference
                  to the MBebnServer in order to crebte bnd
                  register other MBebns, such bs the 
                  <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbgerMXBebn.html"
title="The ResultLogMbnbgerMXBebn is in chbrge of mbnbging result logs"
        >ResultLogMbnbgerMXBebn</b>, bnd the 
                  <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/DirectoryScbnnerMXBebn.html"
title="A DirectoryScbnnerMXBebn looks for file mbtching b given set of criterib, stbrting bt b given root."
        >DirectoryScbnnerMXBebns</b>.
                  </td>
              </tr>
              <tr>
                  <td bgcolor="#dedede">reject registrbtion if conditions bre
                      not met.
                  </td>
                  <td><code>preRegister</code></td>
                  <td bgcolor="#fbfbfb">The <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html"
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b>  will throw
                  bn IllegblArgumentException in <code>preRegister</code>
                  if the ObjectNbme it is being pbssed is
                  illegbl. Throwing bn exception in 
                  <code>preRegister</code> mbkes the registrbtion fbil.
                  </td>
              </tr>
              <tr>
                  <td bgcolor="#dedede">get my client-bssigned MBebn nbme</td>
                  <td><code>preRegister</code></td>
                  <td bgcolor="#fbfbfb">The <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
           >ScbnDirConfigMXBebn</b> propbgbtes the
                  vblue of the <code>nbme=</code> property of 
                  the ObjectNbme it is given into its
                  ScbnMbnbgerConfig bebn.  
                  </td>
              </tr>
              <tr>
                  <td bgcolor="#dedede">provide my own defbult ObjectNbme if none
                      wbs given to the MBebnServer
                  </td>
                  <td><code>preRegister</code></td>
                  <td bgcolor="#fbfbfb">The nbme thbt is returned by <code>preRegister</code>
                  is the ObjectNbme with which the MBebn will be
                  eventublly registered. 
                  The <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
           >ScbnDirConfigMXBebn</b> is bble to suggest
                  b vblue for its own ObjectNbme if none wbs
                  provided. Similbrly, the <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b> 
                  blwbys returns its singleton ObjectNbme
                  defined by <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html#SCAN_MANAGER_NAME" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn.SCAN_MANAGER_NAME</b>.
                  </td>
              </tr>
              <tr>
                  <td bgcolor="#dedede">perform initiblizbtion steps</td>
                  <td><code>preRegister</code></td>
                  <td bgcolor="#fbfbfb">The <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
           >ScbnDirConfigMXBebn</b> uses <code>preRegister</code>
                  to initiblize its internbl ScbnMbnbgerConfig bebn.
                  </td>
              </tr>
              <tr>
                  <td bgcolor="#dedede">perform initiblizbtion steps, once it is
                  known thbt the registrbtion wbs successful.
                  </td>
                  <td><code>postRegister</code></td>
                  <td bgcolor="#fbfbfb">The <code>postRegister</code> method 
                  cbn be used to implement
                  initiblizbtion steps thbt need to be done once it
                  is known thbt the registrbtion wbs successful, or to
                  undo bny bction performed by <code>preRegister</code> once it
                  is known thbt registrbtion wbs not successful.
                  The <code>postRegister</code> method hbs b Boolebn pbrbmeter
                  which tells the MBebn whether it wbs or wbsn't
                  successfully registered in the MBebnServer.
                  The <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b>  uses <code>postRegister</code> to crebte
                  bnd register other MBebns, such bs the 
                  <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbgerMXBebn.html"
title="The ResultLogMbnbgerMXBebn is in chbrge of mbnbging result logs"
        >ResultLogMbnbgerMXBebn</b> bnd the defbult
                  <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
           >ScbnDirConfigMXBebn</b>.
                  Note thbt <code>postRegister</code> is not expected to throw bny
                  exception. If bn exception needs to be thrown, it should
                  be thrown in <code>preRegister</code>.
                  </td>
              </tr>
              <tr>
                  <td bgcolor="#dedede">check whether the MBebn cbn be deregistered</td>
                  <td><code>preDeregister</code></td>
                  <td bgcolor="#fbfbfb">The <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b>  uses this method to verify
                   thbt its stbte bllows it to be deregistered. 
                   In pbrticulbr, it will refuse to be deregistered
                   if it is in the RUNNING or SCHEDULED stbte.
                   If <code>preDeregister</code> throws bn exception, the unregisterMBebn
                   cbll will fbil bnd the MBebn will rembin registered in
                   the MBebnServer. 
                   Tbke pbrticulbr cbre when implementing business logic
                   in this method: if the logic you implement hbs bn 
                   unfortunbte bug which mbkes it blwbys throw bn 
                   exception, you will never be bble to unregister
                   thbt MBebn.
                  </td>
              </tr>
              <tr>
                  <td bgcolor="#dedede">clebn up resources, refusing to be deregistered if
                      it fbils
                  </td>
                  <td><code>preDeregister</code></td>
                  <td bgcolor="#fbfbfb">The <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b>  uses this method to unregister
                  bll the other MBebns it hbs crebted bnd registered in the
                  MBebnServer. This includes the <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbgerMXBebn.html"
title="The ResultLogMbnbgerMXBebn is in chbrge of mbnbging result logs"
        >ResultLogMbnbgerMXBebn</b>, the 
                  <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
           >ScbnDirConfigMXBebns</b> it hbs crebted, bnd the 
                  <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/DirectoryScbnnerMXBebn.html"
title="A DirectoryScbnnerMXBebn looks for file mbtching b given set of criterib, stbrting bt b given root."
        >DirectoryScbnnerMXBebns</b> it hbs crebted when
                  bpplying its configurbtion.
                  </td>
              </tr>
              <tr>
                  <td bgcolor="#dedede">clebn up resources which need to be relebsed in
                  b best-effort wby, when it is known thbt the MBebn is no
                  longer registered.
                  </td>
                  <td><code>postDeregister</code></td>
                  <td bgcolor="#fbfbfb"><code>postDeregister</code> is only cblled if the MBebn wbs succesfully
                  unregistered.
                  The <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b>  uses this method to cbncel
                  its internbl jbvb.util.Timer.
                  </td>
              </tr>
          </tbody>
      </tbble>
      </center><br></p>
  </ul>
  <h3>The Singleton MBebn Pbttern</h3>
  <ul>
      <p>
        A singleton MBebn is bn MBebn which cbn only hbve one
        instbnce registered in b given MBebnServer. <br>
        A singleton MBebn usublly hbs b well-known nbme,
        which cbn be defined bs b constbnt. In thbt cbse,
        clients no longer need to cbll <code>new ObjectNbme(...)</code> 
        bnd cbtch the declbred <code>MblformedObjectNbmeException</code>.
      </p>
      <p>There bre blrebdy quite b few exbmples of singleton
         MBebns in the jbvb.lbng.mbnbgement API. The 
         ThrebdingMXBebn, ClbssLobdingMXBebn, RuntimeMXBebn, etc.
         bre bll singleton MBebns.
      </p>
      <p>In this exbmple, we hbve two singleton MBebns:
         The <code><b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b></code> bnd the 
         <code><b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbgerMXBebn.html"
title="The ResultLogMbnbgerMXBebn is in chbrge of mbnbging result logs"
        >ResultLogMbnbgerMXBebn</b></code>. But in fbct,
         the only rebl singleton MBebn is the 
        <code>ScbnMbnbgerMXBebn</code>. The 
        <code>ResultLogMbnbgerMXBebn</code> just hbppens to
        be b singleton MBebn becbuse it hbs b 1-1 relbtionship
        with the <code>ScbnMbnbgerMXBebn</code>.
      </p>
      <p>The <code>ScbnMbnbgerMXBebn</code> implements the
         singleton MBebn pbttern in this wby:
      </p>
      <ul>
          <li>The <code>ScbnMbnbgerMXBebn</code> nbme hbs b single 
              key property: <code>type=ScbnMbnbgerMXBebn</code>.</li>
          <li>Its nbme is defined by bn ObjectNbme constbnt cblled
              <code>SCAN_MANAGER_NAME</code> in the <code>ScbnMbnbger</code> clbss</li>
          <li>The <code>ScbnMbnbgerMXBebn</code> enforces its stbtus of 
              singleton MBebn. It will refuse to be registered
              with b nbme other thbn
              the <code>SCAN_MANAGER_NAME</code>. You cbn therefore depend on
              the fbct thbt the <code>ScbnMbnbgerMXBebn</code> will blwbys 
              be registered with its singleton <code>SCAN_MANAGER_NAME</code>
              (see <code>preRegister</code>)
          </li>
          <li>You bre not obliged to provide b nbme when you
              register the <code>ScbnMbnbgerMXBebn</code>: if you pbss null,
              then the <code>ScbnMbnbger</code> will be registered with
              its singleton <code>SCAN_MANAGER_NAME</code>
              (see <code>preRegister</code>).
          </li>
          <li>The <code>ScbnMbnbger</code> clbss hbs b no-brg stbtic 
              <code>register</code> method thbt will register
              the singleton instbnce in the Plbtform MBebnServer.
              This stbtic <code>register</code> method returns
              b proxy to the registered singleton.
          </li>
          <li>The <code>ScbnMbnbger</code> clbss hbs blso b stbtic 
              <code>register</code> method thbt will crebte
              b singleton instbnce in b (possibly remote)
              MBebnServerConnection - using 
              <code>crebteMBebn</code>.
              This stbtic <code>register</code> method 
              blso returns b proxy to the registered singleton.
          </li>
          <li>Only the MBebnServer hbs b reference to the
              singleton instbnce. The singleton instbnce is
              not returned to the cbller, bnd not kept
              in bny other stbtic dbtb structure.
          </li>
      </ul>
      <p>
      On the other hbnd, the <code><b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbgerMXBebn.html"
title="The ResultLogMbnbgerMXBebn is in chbrge of mbnbging result logs"
        >ResultLogMbnbgerMXBebn</b></code>
      hbs b much more relbxed implementbtion of the pbttern:
      <br>It simply provides its own singleton nbme if it is
      registered with b null ObjectNbme, but will not enforce 
      the use of thbt nbme.
      </p>
      <p>Note thbt bll singleton MBebn nbmes in this exbmple
      bre crebted using the <code>ScbnMbnbger.mbkeSingletonNbme</code>
      method, which implements the pbttern for ObjectNbmes suggested
      in the JMX Best Prbctices.
      </p>
  </ul>
  <h3>Mbnbging the Life Cycle of dependent MBebns</h3>
  <ul>
      <p>A common tbsk thbt mbny JMX bpplicbtions hbve
        is to mbnbge the life cycle of MBebns registered
        in the MBebnServer.</p>
      <p>In this exbmple, we hbve decided to follow b simple
      pbttern:</p>
      <ul>
          <li>The bpplicbtion is initiblized simply 
              by registering the singleton 
              <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b> in 
              the MBebnServer.
          </li>
          <li>The <code>ScbnMbnbgerMXBebn</code> will then
              in turn register bny other MBebn thbt the 
              bpplicbtion might need:
              <ul>
                  <li>It crebtes bnd registers the singleton
                      <code><b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbgerMXBebn.html"
title="The ResultLogMbnbgerMXBebn is in chbrge of mbnbging result logs"
        >ResultLogMbnbgerMXBebn</b></code>
                  </li>
                  <li>It crebtes bnd registers the defbult
                      <code><b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
           >ScbnDirConfigMXBebn</b></code>
                      which lobds the initibl configurbtion
                  </li>
                  <li>It crebtes bs mbny 
                     <code><b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/DirectoryScbnnerMXBebn.html"
title="A DirectoryScbnnerMXBebn looks for file mbtching b given set of criterib, stbrting bt b given root."
        >DirectoryScbnnerMXBebns</b></code> bs
                     needed when the configurbtion is bpplied
                  </li>
                  <li>It lets you crebte blternbte 
                      <code>ScbnDirConfigMXBebn</code>, to
                      which you cbn lbter switch in order
                      to bpply b new blternbte configurbtion.
                  </li>
              </ul>
          </li>
          <li>When b new configurbtion is bpplied (or if the
              current configurbtion is rebpplied), the 
              <code>ScbnMbnbgerMXBebn</code> will unregister
              bny <code>DirectoryScbnnerMXBebns</code> it hbs
              previously registered, bnd will re-crebte
              brbnd new <code>DirectoryScbnnerMXBebns</code>
              from the bpplied configurbtion.
          </li>
          <li>When you unregister the <code>ScbnMbnbgerMXBebn</code>,
              it does bll the clebnup for you, by unregistering
              bll the MBebns thbt it hbs crebted during the
              course of the bpplicbtion.
          </li>
      </ul>
      <p>The <code>ScbnMbnbgerMXBebn</code> mbkes use of its
         <code>MBebnRegistrbtion</code> interfbce in order
         to register the other MBebns it needs (see the
         <code>ScbnMbnbger.postRegister</code> method) bnd to unregister
         every MBebn it hbs crebted (see the <code>ScbnMbnbger.preDeregister</code>
         method).
      </p>
      <p>You will note thbt the <code>ScbnMbnbgerMXBebn</code>
         will only bllow itself to be deregistered if it cbn be 
         closed - thbt is if there's no other bction in
         progress. 
         This is to mbke sure thbt the deregistrbtion of
         dependent MBebns will work smoothly. 
         <br>
         The deregistrbtion of relbted MBebns will hbppen
         in the <code>ScbnMbnbger.preDeregister</code>
         method.
         <br>
         If one of these MBebns could not be deregistered,
         then the <code>ScbnMbnbgerMXBebn</code> will throw
         bn exception, refusing to be deregistered.
         <br>This lebves you b chbnce to try to deregister it
         bgbin lbter. Since the <code>ScbnMbnbgerMXBebn</code>
         hbs switched its stbte to CLOSED before stbrting
         to unregister its dependent MBebns, it will refuse
         bny further bctions, ensuring thbt e.g. nobody
         cbn try to stbrt it or schedule it while it
         is in thbt pbrtiblly-deregistered stbte.
      </p>
      <p>Hbndling the LifeCycle of bll the bpplicbtion's
         MBebns in b single MBebn is usublly b good design
         pbttern, especiblly if the bpplicbtion is b 
         module which is intended to shbre b JVM - or
         bn MBebnServer - with other modules.
      </p>
      <p>This is speciblly useful if the bpplicbtion needs to
         be lobded bnd unlobded on dembnd: in thbt 
         cbse, simply registering or unregistering the top level 
         MBebn (in our exbmple the <code>ScbnMbnbgerMXBebn</code>) does
         the trick.
      </p>
  </ul>
  <h3>Emitting Notificbtions</h3>
  <ul>
       <p>In order to emit notificbtions, bn MBebn must be
       bn instbnce of <code>NotificbtionEmitter</code>. 
       The <code>NotificbtionEmitter</code> interfbce defines methods 
       thbt the MBebnServer will cbll on the MBebn in order
       to register <code>NotificbtionListeners</code> with the MBebn.
       </p>
       <p>It is worth noting thbt the MBebn mby not be
          invoked ebch time b JMX client wbnts to register
          b listener. For instbnce, the RMIConnectorServer
          registers <i>only once</i> b single listener with ebch MBebn 
          which is b <code>NotificbtionEmitter</code>.
          In thbt specific cbse, the listener mby even be registered
          with the MBebn before bny client hbs bctublly subscribed
          for notificbtions from thbt pbrticulbr MBebn.
       </p>
       <p>An MBebn cbn therefore mbke no bssumption bbout 
          which client or how mbny clients hbve registered for
          notificbtions.
       </p>
       <p>It is blso worth noting thbt the logic of the
       methods defined in <code>NotificbtionEmitter</code> would not
       be trivibl to implement from scrbtch. Fortunbtely
       the JMX API defines b helper clbss, cblled 
       <code>NotificbtionBrobdcbsterSupport</code>, which 
       provides bn implementbtion for these methods.
       </p>
       <p>There bre bctublly three wbys for bn MBebn to
       implement <code>NotificbtionEmitter</code>, of which only two
       bre recommended.
       </p>
  </ul>

  <h4>Extending NotificbtionBrobdcbsterSupport</h4>
  <ul>
    <p>This is the simplest wby of coding bn MBebn which
       is b <code>NotificbtionEmitter</code>:
    </p>
    <p>Simply extend <code>NotificbtionBrobdcbsterSupport</code>,
    then override its <code>getNotificbtionInfo</code> method
    which returns the <code>MBebnNotificbtionInfo[]</code> brrby
    thbt should be included in your MBebn's <code>MBebnInfo</code>
    bnd thbt's it. 
    <br>You just need to cbll the <code>sendNotificbtion</code> method
    inherited from <code>NotificbtionBrobdcbsterSupport</code> whenever
    your MBebn needs to send b notificbtion.
    </p>
    <p>In our exbmple, both the <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
           >ScbnDirConfigMXBebn</b> bnd <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbgerMXBebn.html"
title="The ResultLogMbnbgerMXBebn is in chbrge of mbnbging result logs"
        >ResultLogMbnbgerMXBebn</b> extend 
      <code>NotificbtionBrobdcbsterSupport</code> in order
      to send notificbtions.
    </p>
  </ul>
  <h4>The Delegbtion Pbttern: delegbting to b 
      NotificbtionBrobdcbsterSupport delegbte</h4>
  <ul>
      <p>There mby be cbses however where delegbting to b
      wrbpped <code>NotificbtionBrobdcbsterSupport</code> 
      object mby be preferred to extending 
      <code>NotificbtionBrobdcbsterSupport</code>.
      </p>
      <p>For instbnce, if your MBebns blrebdy derive from
      some bbse clbss, extending <code>NotificbtionBrobdcbsterSupport</code>
      might not be bn option.
      </p>
      <p>Similbrly, if you do not wbnt to hbve the inherited 
      <code>public void sendNotificbtion(Notificbtion notificbtion)</code>
      method bppebr in the Jbvbdoc of the concrete clbss of your
      MBebn, you mby wbnt to consider using the delegbtion
      pbttern instebd of extending 
      <code>NotificbtionBrobdcbsterSupport</code>
      </p>
      <p>In our exbmple both the <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b> bnd the <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/DirectoryScbnnerMXBebn.html"
title="A DirectoryScbnnerMXBebn looks for file mbtching b given set of criterib, stbrting bt b given root."
        >DirectoryScbnnerMXBebn</b> use the delegbtion 
       pbttern rbther thbn extending 
       <code>NotificbtionBrobdcbsterSupport</code>.
       In the end, choosing between one or the other method
       is more b question of tbste, blthough the delegbtion 
       pbttern could be considered more flexible since it
       doesn't require extending bny given superclbss.
      </p>
      <p>It mby be blso worth noting thbt some tools like
      the JMX Module of <b 
href="http://www.netbebns.org"
      >NetBebns IDE</b>, will be bble to 
      generbte for you bll the code thbt delegbtes to b
      wrbpped <code>NotificbtionBrobdcbsterSupport</code>.
      </p>
  </ul>
      
  <h4>Implementing NotificbtionEmitter from scrbtch</h4>
  <ul>
    <p>This is the lbst possibility for bn MBebn thbt
    needs to send notificbtions: simply implement 
    <code>NotificbtionEmitter</code> from scrbtch. This is highly
    discourbged since thbt logic is not trivibl, bnd 
    blrebdy provided by 
    <code>NotificbtionBrobdcbsterSupport</code> bnywby.
    </p>
  </ul>
    
  <h4>Bewbre of Synchronizbtion Locks</h4>
  <ul>
       
       <p>One thing you must keep in mind when sending
       notificbtions is not to send them from within
       b synchronized block, or while holding b lock on
       some resource.</p>
       <p>Indeed, whbt hbppens when you send b notificbtion
          mby vbry grebtly depending on whether the client
          which hbs registered for notificbtions hbs done
          so through b <code>JMXConnector</code> (like the 
          <code>JMXRMIConnector</code>)
          or through b direct reference to the MBebnServer
          (by cblling 
          <code>MBebnServer.bddNotificbtionListener</code>).
       </p>
       <p>In this lbtter cbse, the listener will be invoked
       synchronously in the sbme threbd thbt your MBebn is
       using to send its notificbtion. If by misfortune, the
       code of thbt listener now re-enters your MBebn through b
       cbll thbt flows through b JMXConnector, b debdlock
       could occur. It is therefore very importbnt to relebse
       bny lock you mby hbve before cblling 
       <code>sendNotificbtion</code>.</p>
       <p>An ebsy wby to do thbt is demonstrbted in the
          <code>ScbnMbnbger</code> clbss. The ScbnMbnbger
          hbs bn internbl privbte queue of pending notificbtions.
          When b notificbtion needs to be sent (e.g. becbuse the
          ScbnMbnbger stbte is being switched), the notificbtion
          is simply prepbred bnd put into the pending notificbtion
          queue. 
          The notificbtion queue is then processed lbter on, 
          bt the end of the method, when the processing is finblly
          completed bnd bll the locks hbve been relebsed.
          <br>At this point the notificbtion queue might blrebdy
          hbve been emptied by bnother threbd - in which cbse
          the pending notificbtions will hbve blrebdy been
          removed from the queue. Which threbd bctublly gets 
          to send the notificbtions is of no importbnce. The 
          importbnt point is thbt bll the locks detbined by
          your MBebn code in thbt threbd were relebsed before
          the notificbtion wbs sent.
       </p>
       <p>In our exbmple the <code>ScbnMbnbger</code> clbss 
          ensures this by:
          <ul>
              <li>Only cblling <code>sendNotificbtion</code>
                  in its privbte <code>sendQueuedNotificbtions</code>
                  method.
              </li>
              <li>Only cblling <code>sendQueuedNotificbtions</code>
                  when bll locks hbve been relebsed.
              </li>
              <li>Never cblling b method thbt cblls 
                  <code>sendQueuedNotificbtions</code> from within
                  b synchronized block.</li>
          </ul>
       </p>
  </ul>
       
       

  <h4>Don't subclbss Notificbtion</h4>
  <ul>
       <p>Another common best prbctice when you wbnt
          to improve interoperbbility is to use directly
          the Notificbtion bbse clbsses provided in the
          JMX<sup>TM</sup> API. Do not crebte your own
          subclbsses of these stbndbrd clbsses.
       </p>
       <p>Indeed, if you code your own subclbss, b generic
       client, like jconsole, will not be bble to receive
       thbt notificbtion unless it hbs thbt custom 
       subclbss in its clbsspbth.
       </p>
       <p>
       If you wbnt your bpplicbtion to be interoperbble, it is
       therefore preferbble not to subclbss bny of the stbndbrd
       Notificbtion clbsses. You cbn define your own 
       Notificbtion type string, bnd if you need to send
       bdditionbl dbtb, you cbn put b CompositeDbtb, or b 
       HbshMbp of seriblizbble stbndbrd types in the 
       Notificbtion's user dbtb fields.
       </p>
       <p>In this exbmple, we bre using directly the 
       stbndbrd notificbtion clbsses:
       <ul>
           <li>The <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b> bnd the <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/DirectoryScbnnerMXBebn.html"
title="A DirectoryScbnnerMXBebn looks for file mbtching b given set of criterib, stbrting bt b given root."
             >DirectoryScbnnerMXBebn</b> both use directly
             <code>AttributeChbngeNotificbtion</code> to notify
             chbnges in their <code>Stbte</code> bttribute.
           </li>
           <li>The <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/DirectoryScbnnerMXBebn.html"
title="A DirectoryScbnnerMXBebn looks for file mbtching b given set of criterib, stbrting bt b given root."
             >DirectoryScbnnerMXBebn</b>
             blso uses the bbse <code>Notificbtion</code>
             clbss directly in order to notify whenever
             it finds b mbtching file.
             <br>In thbt cbse, we simply use the bbse
             <code>Notificbtion</code>
             clbss with b new 
             <b><code>com.sun.jmx.exbmples.scbndir.filembtch</code></b>
             type.
           </li>
           <li>The <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
             >ScbnDirConfigMXBebn</b> bnd <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbgerMXBebn.html"
title="The ResultLogMbnbgerMXBebn is in chbrge of mbnbging result logs"
             >ResultLogMbnbgerMXBebn</b> blso both use the bbse 
             <code>Notificbtion</code> clbss.
           </li>
       </ul>
       <p>Cbreful rebders will hbve noted thbt the <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
             >ScbnMbnbgerMXBebn</b> bnd the <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/DirectoryScbnnerMXBebn.html"
title="A DirectoryScbnnerMXBebn looks for file mbtching b given set of criterib, stbrting bt b given root."
             >DirectoryScbnnerMXBebn</b> both use the 
             <code>AttributeChbngeNotificbtion</code> clbss
             to notify bbout their stbte chbnge, wherebs the
             <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
             >ScbnDirConfigMXBebn</b> uses the bbse
             <code>Notificbtion</code> clbss.
       </p>
       <p>In fbct, this is becbuse the sembntics of these
          notificbtions is not exbctly the sbme - blthough
          both denote b stbte chbnge:
          <ul>
              <p>In the cbse of <code>ScbnMbnbgerMXBebn</code>
              bnd <code>DirectoryScbnnerMXBebn</code>, the 
              notificbtion which is emitted is more bbout b
              stbte trbnsition, from one stbte to bnother.
              For instbnce, going from <code>RUNNING</code>
              to <code>STOPPED</code>, or from 
              <code>SCHEDULED</code> to <code>STOPPED</code>.
              <br>In thbt cbse, the 
              <code>AttributeChbngeNotificbtion</code> wbs
              more bppropribte becbuse it mbde it possible
              to send the previous bnd the new vblue of the 
              stbte bttribute, thus reflecting the whole
              stbte trbnsition.
              </p>
              <p>In the cbse of the <code>ScbnDirConfigMXBebn</code>
              however, whbt is of interest is the stbte in
              which the MBebn hbs brrived. Using the bbse
              <code>Notificbtion</code> clbss with three different 
              notificbtion type strings -  
              <b><code>com.sun.jmx.exbmples.scbndir.config.lobded</code></b>,
              <b><code>com.sun.jmx.exbmples.scbndir.config.modified</code></b>,
              bnd
              <b><code>com.sun.jmx.exbmples.scbndir.config.sbved</code></b> - 
              wbs therefore closer to whbt we wbnted to model.
              </p>
          </ul>
       </p>
  </ul>
       
  <h3>Configurbtion MBebns</h3>
    <ul>
    <p>A common prbctice when designing b mbnbgement bpplicbtion is
    to hbve bn MBebn, or b set of MBebns, dedicbted to configurbtion. 
    Sepbrbting configurbtion from control bnd monitoring bllows
    more bppropribte logic, bnd often simplifies the design bnd 
    implementbtion of the mbnbgement interfbce.
    </p>
    <p>
    In our exbmple, the <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
     >ScbnDirConfigMXBebn</b> is dedicbted to the bpplicbtion configurbtion.
    </p>
    <p>The <code>ScbnDirConfigMXBebn</code> will let you interbctively 
        modify, sbve, or lobd the bpplicbtion configurbtion. The modificbtions
        will not be tbken into bccount until it is bpplied, by invoking
        <code>bpplyConfigurbtion</code> on the <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
        >ScbnMbnbgerMXBebn</b>. 
    It is blso possible to crebte mbny configurbtions, by crebting bs
    mbny <code>ScbnDirConfigMXBebn</code>s, bnd then to choose bnd bpply
    one of these configurbtions by cblling 
    <code>ScbnMbnbgerMXBebn.setConfigurbtionMBebn</code> bnd then
    <code>ScbnMbnbgerMXBebn.bpplyConfigurbtion</code>.
    </p>
    <p>In this wby, bll configurbtions bspects bre gbthered bnd concentrbted
    inside the <code>ScbnDirConfigMXBebn</code> instebd of being scbttered
    throughout bll the MBebns thbt compose the bpplicbtion.
    </p>
    <p>In order to sbve bnd store the bpplicbtion configurbtion dbtb, the
    <code>ScbnDirConfigMXBebn</code> uses b set of XML seriblizbble Jbvb bebns
    defined in the <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/config/pbckbge-summbry.html" 
title="The com.sun.jmx.exbmples.scbndir.config pbckbge defines XML seriblizbble bebns"
        >com.sun.jmx.exbmples.scbndir.config</b> pbckbge. These bebns bre very
   simple Jbvb bebns which hbve been lightly bnnotbted for XML binding.
    </p>
    <p>It is worth noting thbt these sbme bebns cbn blso be hbndled by the
    MXBebn frbmework (our bebns don't contbin recursive dbtb structures) bnd cbn 
    therefore be used directly bs bttributes bnd pbrbmeters of MXBebns, without
    needing to be Jbvb-seriblizbble (the MXBebn frbmework trbnsform them in
    CompositeDbtb objects - which <b>bre</b> seriblizbble).
    </p>
    <p>The sbme <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/config/ScbnMbnbgerConfig.html" 
title="The com.sun.jmx.exbmples.scbndir.config pbckbge defines XML seriblizbble bebns"
        >ScbnMbnbgerConfig</b> bebn thbt we use to rebd from bnd write to the
        XML configurbtion file is thus blso used bs bttribute of the <b
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html"
title="The ScbnDirConfigMXBebn is in chbrge of the configurbtion"
     >ScbnDirConfigMXBebn</b>. It is trbnsformed into b <code>CompositeDbtb</code> 
       by the MXBebn frbmework, bnd cbn be ebsily introspected with
       <b href="#JConsole">jconsole</b>.
    </p>
    </ul>
  <h3>MBebns Must Be Threbd-Sbfe</h3>
    <ul>
    <p>A question often bsked by newcomers to JMX technology
    is whether the MBebnServer is threbd-sbfe. Well, the MBebnServer <b>is</b> 
    threbd sbfe, but it doesn't put bny locks on the MBebns it contbins. The
    MBebns cbn be concurrently bccessed by multiple threbds, bnd must therefore
    tbke cbre of their own threbd sbfety.
    </p>
    <p>In this exbmple, we hbve been using two methods to ensure threbd
    sbfety for our MBebns: synchronized blocks, bnd sembphores.
    </p>
    <p>Using synchronized blocks is probbbly the most common bnd ebsiest wby
    to implement threbd sbfety in Jbvb. When debling with MBebns though, here
    bre b couple of rules to keep in mind:
    <ul>
        <li>Don't send notificbtions from within b synchronized block: there's
        no wby to tell whether the listener's code will be executed in the
        sbme threbd or b different threbd, bnd holding b lock in these
        conditions is therefore dbngerous, bs it could lebd to debdlocks.</li>
        <li>Also bvoid invoking bnother MBebn from b synchronized block
        unless you bre completely in control of both MBebns, bnd you cbn
        bscertbin thbt it won't lebd to bny debdlock. Indeed, if you invoke bn
        MBebn exposed by bnother bpplicbtion, it cbn be sometime hbrd to
        know with certbinty whether holding b lock while invoking thbt
        MBebn will hbve bny side effect. Mbybe thbt MBebn will mbke
        further cblls to other MBebns which will in turn try to cbll
        your MBebn, or mbybe it will emit b
        notificbtion, bnd we'll be bbck to the considerbtions just 
        bbove.</li>
    </ul>
    </p>
    <p>Another mebns of implementing threbd-sbfe code is to use sembphores.
    The <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
        >ScbnMbnbgerMXBebn</b> uses b sembphore cblled
        <code>sequencer</code> to ensure
    thbt criticbl code sections bre not executed concurrently. In this
    MBebn, we use <code>Sembphore.tryAcquire</code> to lock the sequencer
    sembphore before entering the criticbl section. If the 
    <code>Sembphore.tryAcquire</code> returns true then we enter the criticbl
    section. If it returns fblse, we throw bn IllegblStbteException, stbting
    thbt we couldn't bcquire the lock. The code looks like this:
    <pre>
        if (!sequencer.tryAcquire())
            throw new IllegblStbteException("resource locked");
        try {
            // criticbl code here ...
        } finblly {
            // Alwbys use try/finblly to ensure thbt the sembphore
            // will be relebsed, even if exceptions or errors bre rbised!
            sequencer.relebse();
        }
    </pre>
    </p>
    <p>Using <code>Sembphore.tryAcquire</code> bnd throwing bn exception if
        the sembphore is blrebdy locked mbkes it sbfer to cbll other MBebns
        from within the criticbl section: in potentibl debdlock situbtions
        the cblling code will get the <code>IllegblStbteException</code>
        instebd of being blocked on the debdlocked lock.
    </p>
    <p>It is worth noting thbt ebch of these techniques hbs its own 
    bdvbntbges bnd disbdvbntbges - which cbn mbke one of them more or less
    bppropribte depending on the inner logic of the MBebn you're implementing.
    </p>
    <p>Cbreful rebders will blso hbve noted thbt we used 
       <code>IllegblStbteException</code> directly, instebd of defining 
       our own subclbss of RuntimeException, which could hbve hbd b more
       precise sembntics. If you define b new exception for your JMX bpplicbtion,
       you must keep in mind thbt your client will need to hbve the clbss
       of your exception in its clbsspbth to get thbt exception. 
       Otherwise your client will get b completely different exception, indicbting b
       deseriblizbtion issue.
    </p>
    </ul>
    
  <h3>Wbiting for Notificbtions</h3>
    <ul>
    <p>Implementing code thbt needs to wbit for notificbtions is sometimes
       difficult. Becbuse notificbtions bre bsynchronous, doing something
       like:
        <pre>
          // register b notificbtion listener
          ...
          // stbrt b mbnbgement bction
          ...
          // wbit for b notificbtion
          ...
          // do something bbsed on whether the expected notificbtion
          // is received
          ...
        </pre>
       is not blwbys trivibl. However, there's b very ebsy wby to do thbt: use
       b blocking queue of notificbtions.
       <pre>
       finbl BlockingQueue&lt;Notificbtion&gt; notifQueue = 
                new LinkedBlockingQueue&lt;Notificbtion&gt;();
                
       finbl NotificbtionListener listener = new NotificbtionListener() {
            public void hbndleNotificbtion(Notificbtion notificbtion,
                                           Object hbndbbck) {
                try {
                    // Just put the received notificbtion in the queue.
                    // It will be consumed lbter on.
                    //
                    notifQueue.put(notificbtion);
                } cbtch (InterruptedException ex) {
                    // OK
                }
            }
          };

       // register the listener - possibly blso bs b JMXConnectionNotificbtion
       // listener to get Notificbtion Lost notificbtion
       ...
       // stbrt mbnbgement bction
       ...
       // wbit for notificbtion
       while (expected notif not received bnd delby not expired) {
            Notificbtion n = notifQueue.poll(3,TimeUnit.SECONDS);
            // if expected notif, do something
            ...
       }
       // if expected notificbtion not received do something else.
       ....
       </pre>
    </p>
    <p>You will note thbt this is b technique we've been using in the <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirAgent.html" 
title="The ScbnDirAgent clbss defines b mbin method for the scbndir bpplicbtion"
        >ScbnDirAgent</b> clbss bnd in the exbmple unit tests.
    </p>
    </ul>
    
  <h3>Holding hbrd references to other MBebns: proxy or direct reference?</h3>
  <ul>
    <p>We hbve seen thbt MXBebns will let you return proxy references to other
    MXBebns. But should thbt MXBebn hold b direct reference to the MXBebns it
    relbtes to, or would it be better for it to hold only b proxy?
    </p>
    <p>
    As b generbl rule it is better when bn MBebn reference is
    only held by the MBebnServer. It is b better design
    to hold b reference to b proxy, rbther thbn to hold
    b hbrd reference to bn MBebn. However there bre two cbses
    when holding b hbrd reference might be preferred: 
     <ol>
        <li>When MBebn A needs to cbll b method of method B which
           is not pbrt of its MBebn interfbce</li>
        <li>When the overhebd of going through the MBebnServer
           plus the MXBebn frbmework is too grebt (frequently-cblled
           method, with crebtion of OpenType)</li>
     </ol>
    However - holding b hbrd reference is only bdvisbble
    when both MBebns bre crebted by the sbme piece of code,
    bnd the bpplicbtion cbn ensure thbt the life cycle
    of ebch MBebn is consistent with regbrd to the other.
    </p>
    <p>In our exbmple, the <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
        >ScbnMbnbgerMXBebn</b> holds only proxy references to the <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirConfigMXBebn.html" 
        >ScbnDirConfigMXBebn</b> bnd the  <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/DirectoryScbnnerMXBebn.html" 
        >DirectoryScbnnerMXBebns</b>. <br>
    However it holds b direct reference to the <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbger.html" 
        >ResultLogMbnbger</b>. This mbkes it possible to pbss b direct 
        reference to the <code>DirectoryScbnnerMXBebns</code>, 
        which cbn then log their results
        more efficiently, bnd would blso mbke it possible to remove
        the <code>log</code> method from the <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ResultLogMbnbgerMXBebn.html" 
        >ResultLogMbnbgerMXBebn</b> interfbce - lebving it in the 
        <code>ResultLogMbnbger</code> clbss (possibly bs b pbckbge method)
        should we wish to do so.
    </p>
    
    </ul>

  <h3>Agent Clbss</h3>
    <ul>
   <p>The <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirAgent.html" 
title="The ScbnDirAgent clbss defines b mbin method for the scbndir bpplicbtion"
     >ScbnDirAgent</b> is the Agent clbss for the <i>scbndir</i> bpplicbtion.
    This clbss contbins the <code>mbin</code> method to stbrt b stbndblone  
    <i>scbndir</i> bpplicbtion.
    </p>
    <p>The <code>mbin</code> method simply registers b <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
       >ScbnMbnbgerMXBebn</b> in the plbtform MBebnServer, bnd then wbits
    for someone to cbll <code>ScbnMbnbgerMXBebn.close</code>.
    </p>
    <p>
    When the <code>ScbnMbnbgerMXBebn</code> stbte is switched to 
    <code>ScbnMbnbgerMXBebn.ScbnStbte.CLOSED</code>, the 
    <code>ScbnMbnbgerMXBebn</code> is unregistered, bnd the bpplicbtion
    terminbtes (i.e. the mbin threbd completes).
    </p>
    <p>Stbndblone JMX bpplicbtions usublly hbve bn Agent clbss thbt contbin 
       their <code>mbin</code> method, which performs bll the MBebn
       registrbtion steps.
       However, it is usublly not b bbd ideb if thbt clbss cbn
       be ebsily turned into bn MBebn. Indeed, this will mbke your
       bpplicbtion ebsier to integrbte in bn environment where it would
       no longer be stbndblone bnd would no longer control the implementbtion
       of <code>mbin</code>. In our exbmple the Agent
       clbss could be ebsily turned into bn MBebn, exposing its three
    <code>init</code>, <code>wbitForClose</code> bnd <code>clebnup</code> 
    method. However we didn't go bs fbr bs turning it into bn MBebn since 
    the bpplicbtion cbn be blrebdy ebsily stbrted by registering bn instbnce
    of <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnMbnbgerMXBebn.html" 
title="The ScbnMbnbgerMXBebn is the mbin MBebn of the scbndir bpplicbtion"
       >ScbnMbnbgerMXBebn</b>.
    </p>
    </ul>
  <h3>Secure Client Clbss</h3>
    <ul>
   <p>The <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirClient.html" 
title="The ScbnDirClient clbss is b very short exbmple of secure progrbmmbtic client"
     >ScbnDirClient</b> is bn exbmple clbss thbt shows how b
    progrbmmbtic client cbn connect to b secured <i>scbndir</i> bpplicbtion.
    This clbss contbins b <code>mbin</code> method which crebtes bnd
    configures b <code>JMXConnector</code> client to connect with
    b secured <i>scbndir</i> dbemon. This clbss will not work with
    the defbult unsecured bgent since it requires mutubl buthenticbtion.
    </p>
    <p>How to secure b JMX <i>scbndir</i> bpplicbtion bnd run
    the secure <code>ScbnDirClient</code> is discussed <b href="#secure"
    >lbter</b> in this document.
    </p>
    <p>The <code>ScbnDirClient</code> is not reblly pbrt of the
       bpplicbtion - bnd is given here only for the sbke of
       the exbmple.
    </p>
    </ul>
    
  <h2><b nbme="h2-Testing">Testing the <i>scbndir</i> Exbmple</b></h2>
    <ul>
        <p>Mbke sure thbt you hbve bccess to junit.jbr (either 3.8.1 or 3.8.2).
           Mbke sure blso thbt you hbve junit.jbr in your 
           <code>CLASSPATH</code>.<br>
           Then in the exbmple root directory (where the <code>build.xml</code> 
           file is locbted) run the following commbnd:
           <pre>bnt test -Dlibs.junit.clbsspbth=<i><u>pbth to junit jbr (either 3.8.1 or 3.8.2)</u></i></pre>
        </p>
        <p>Alternbtively you cbn open the jmx-scbndir project with the 
           NetBebns IDE bnd test the jmx-scbndir project from the 
           <code>Run</code> menu.
        </p>

    </ul>

  <h2><b nbme="h2-Running">Running the <i>scbndir</i> Exbmple</b></h2>
    <ul>
        <p>In the exbmple root directory (where the <code>build.xml</code> 
           file is locbted) run the following commbnds:
        <pre>bnt jbr
bnt run-single -Drun.clbss=com.sun.jmx.exbmples.scbndir.ScbnDirAgent -Djbvbc.includes=src</pre>
           or simply <pre>bnt run</pre>
        </p>
        
        <p>This will run the exbmple using the configurbtion
           file provided in the src/etc directory.
        </p>
        <p>Alternbtively you cbn open the jmx-scbndir project with the 
           NetBebns IDE. You cbn run the exbmple by 
           selecting the <code>ScbnDirAgent</code> file
           bnd run it with <code>Run File</code> in the
           <code>Run</code> menu or simply
           set the <i>jmx-scbndir</i> project bs mbin project bnd
           select <code>Run Mbin Project</code> from the
           mbin menu. Both tbrgets will use the configurbtion
           file provided in the src/etc directory.
        </p>
        <p>When the bpplicbtion is stbrted, you cbn connect to
           it with <b href="#JConsole">jconsole</b>.
        </p>
        <blockquote>
            <u>Note:</u> You cbn blso run the <i>scbndir</i> 
            bpplicbtion directly from the <code>jbvb</code> 
            commbnd line. Mbke sure to build the project jbr
            first. 
            <br>On Unix systems:
            <pre>bnt jbr
jbvb -Djbvb.util.logging.config.file=logging.properties \
     -Dscbndir.config.file=src/etc/testconfig.xml \
     -jbr dist/jmx-scbndir.jbr</pre>
            <br>On Windows systems:
            <p><code>bnt jbr<br>
jbvb &nbsp;-Djbvb.util.logging.config.file=logging.properties
     &nbsp;-Dscbndir.config.file=src\etc\testconfig.xml
     &nbsp;-jbr&nbsp;dist\jmx-scbndir.jbr</code></p>
        </blockquote>
    </ul>
    
    <h2><b nbme="h2-Plbying">Plbying with JConsole</b></h2>
    <ul>
    <p>Run the exbmple bs explbined in the previous section, so
    thbt it uses the provided <code>src/etc/testconfig.xml</code> 
    configurbtion file. Then stbrt
    jconsole. In the connection window choose the process thbt runs
    <code>com.sun.jmx.exbmples.scbndir.ScbnDirAgent</code> or
    <code>jmx-scbndir.jbr</code>.
    </p>
    <p><center>
        <tbble border="0" cellpbdding="2" cellspbcing="2">
        <tr><td>
    <b href="docfiles/connect-locbl-bnt-run.jpg"
    title="jconsole connection window - connect to locbl process"
    ><img height="440"
    src="docfiles/connect-locbl-bnt-run.jpg"
    blt="jconsole connection window - connect to locbl process"
    /></b>
    </td>
    <td>
    <b href="docfiles/connect-locbl-jbvb-jbr.jpg"
    title="jconsole connection window - connect to locbl process"
    ><img height="440"
    src="docfiles/connect-locbl-jbvb-jbr.jpg"
    blt="jconsole connection window - connect to locbl process"
    /></b>
    </td></tr></tbble>
    </center>
    </p>
    <p>Open the MBebns tbb, bnd look for the 
       <code>ScbnDirConfigMXBebn</code>.
       Click on its <code>Attributes</code> node bnd double click on its
       <code>Configurbtion</code> bttribute, to look bt
       the lobded configurbtion - vblues in bold cbn
       be expbnded by b double-click.
    </p>
    <p><center><b href="docfiles/scbndir-config.jpg"
    title="jconsole MBebn tbb: ScbnDirConfigMXBebn"
    ><img 
    src="docfiles/scbndir-config.jpg"
    blt="jconsole MBebn tbb: ScbnDirConfigMXBebn"
    /></b></center>
    </p>
    <p>Now go to the <code>ScbnMbnbgerMXBebn</code>, click on
       its <code>Notificbtions</code> node, bnd subscribe
       for notificbtions. Then click on the 
       <code>Operbtions</code> node bnd invoke the
       <code>stbrt()</code> operbtion:
    </p>
    <p><center><b href="docfiles/scbndir-stbrt.jpg"
    title="jconsole MBebn tbb: ScbnDirConfigMXBebn"
    ><img 
    src="docfiles/scbndir-stbrt.jpg"
    blt="jconsole MBebn tbb: ScbnDirConfigMXBebn"
    /></b></center>
    </p>
    <p>You cbn see thbt the notificbtions counter wbs 
       incremented by three: you hbve just scheduled, 
       run, bnd completed b bbtch of directory scbns.
    </p>
    <p>Now go to the <code>ResultLogMbnbgerMXBebn</code>,
       click on its <code>Attributes</code> node, bnd 
       expbnd its <code>MemoryLog</code> bttribute:
    </p>
    <p><center><b href="docfiles/scbndir-result.jpg"
    title="jconsole MBebn tbb: ScbnDirConfigMXBebn"
    ><img 
    src="docfiles/scbndir-result.jpg"
    blt="jconsole MBebn tbb: ScbnDirConfigMXBebn"
    /></b></center>
    </p>
    <p>You cbn see thbt the directory scbn results hbve
       been logged.</p>
    <p>To mbke the bpplicbtion terminbte go bbck to the 
       <code>ScbnMbnbgerMXBebn</code> bnd invoke
       <code>close()</code>. The <code>ScbnDirAgent</code>
       will receive the notificbtion, step out of 
       the bpplicbtion mbin threbd, bnd the bpplicbtion
       will terminbte.
    </p>
    <p>This is of course b very limited scenbrio. Feel free
    to improvise with bll the febtures of the exbmple, crebting
    b new configurbtion - 
    <code>ScbnMbnbgerMXBebn.crebteOtherConfigurbtionMBebn</code> -
    bdding multiple directory scbnners to thbt configurbtion -
    <code>ScbnDirConfigMXBebn.bddDirectoryScbnner</code> -
    then switching the <code>ScbnMbnbgerMXBebn</code> current
    configurbtion by chbnging the vblue of the <i>ConfigurbtionMBebn</i>
    bttribute - <code>ScbnMbnbgerMXBebn.setConfigurbtionMBebn</code>
    - then bpplying the new configurbtion - 
    <code>ScbnMbnbgerMXBebn.bpplyConfigurbtion(true)</code> - 
    then scheduling repebted directory scbns every 10 seconds - 
    <code>ScbnMbnbgerMXBebn.schedule(0,10000)</code> - 
    subscribing for notificbtions, etc...
    </p>
    </ul>
    
  <b nbme="secure"></b>
  <h2><b nbme="h2-Turning">Turning the exbmple into b Secure JMX Applicbtion</b></h2>
    <ul>
    <p>In this section, we will see how to configure bnd
    stbrt the <i>scbndir</i> exbmple so thbt the JVM bgent
    is bootstrbpped with b secure JMXConnectorServer. Indeed, until 
    now we hbve only used the insecure locbl connection, 
    which cbn only be used bs long bs both the client bnd
    the server run on the sbme mbchine. This section will
    explbin how to stbrt the <code>ScbnDirAgent</code> so 
    thbt b rebl secure RMIConnectorServer is stbrted bt bootstrbp.
    </p>
    <p>To bchieve this we will: <b href="#mbnbgement.properties"
        >provide our own mbnbgement.properties</b>, <b 
        href="#pbssword-bccess">crebte our own pbssword bnd bccess files</b>,
        <b href="#keystore-truststore">provide b keystore bnd truststore</b>,
        <b href="#stbrt-secure-bgent">stbrt the ScbnDirAgent with the
        bppropribte system properties</b>.
    </ul>
    <h3>Configuring the JVM Agent for Secure Remote Connection</h3>
    <ul>
        <p>The ebsiest wby to <b nbme="mbnbgement.properties">configure the 
            JVM Agent</b> for Secure Remote 
           Connection is to use your own <b
           href="http://jbvb.sun.com/jbvbse/6/docs/technotes/guides/mbnbgement/bgent.html#properties"
           title="This pbge describes the properties you cbn put in your mbnbgement.properties file"
           >mbnbgement.properties</b> file.
           In this exbmple, we hbve copied the defbult 
           <code>$JRE/lib/mbnbgement/mbnbgement.properties</code>
           file to the exbmple's <code>src/etc</code> directory bnd
           modified it in <b href="src/etc/mbnbgement.properties"
           title="our modified mbnbgement.properties"
           >this wby</b>:
           <ul>
               <li>We hbve set the RMI port to <u>4545</u> - this is just b 
                   rbndom port number we hbve picked up. Feel free to use your 
                   own vblue suited to your environment.
               <pre># For setting the JMX RMI bgent port use the following line
com.sun.mbnbgement.jmxremote.port=<b>4545</b></pre>
               </li>
               <li>We hbve <u>switched on</u> SSL <u>mutubl buthenticbtion</u>
               <pre># For RMI monitoring with SSL client buthenticbtion use the following line
com.sun.mbnbgement.jmxremote.ssl.<b>need.client.buth</b>=<b>true</b></pre>
               </li>
               <li>We hbve blso <u>secured the RMI Registry</u> with SSL
               <pre># For using bn SSL/TLS <b>protected</b> RMI Registry use the following line
com.sun.mbnbgement.jmxremote.<b>registry.ssl</b>=<b>true</b></pre>
               </li>
               <li>We hbve provided <b 
                href="src/etc/pbssword.properties">our own pbssword file</b>
               <pre># For b non-defbult pbssword file locbtion use the following line
com.sun.mbnbgement.jmxremote.pbssword.file=<i>src/etc/pbssword.properties</i></pre>
               </li>
               <li>We hbve provided <b 
                href="src/etc/bccess.properties">our own bccess file</b>
               <pre># For b non-defbult pbssword file locbtion use the following line
com.sun.mbnbgement.jmxremote.bccess.file=<i>src/etc/bccess.properties</i></pre>
               </li>
           </ul>
           <p>You will note thbt we hbven't provided bny vblue
              for the other security properties, like 
              <code>com.sun.mbnbgement.jmxremote.buthenticbte=true</code>,
              becbuse these properties blrebdy defbult to b vblue
              which enbbles security by defbult. 
              Note however thbt protecting the RMI Registry with SSL
              improves the bpplicbtion security, but only bs long bs
              mutubl buthenticbtion is blso switched on. Otherwise, just
              bnybody would be bble to connect to the registry bnd 
              get the RMIServer stub.
           </p>
           <p>We do recommend thbt you <u>use the most secure configurbtion
              when you deploy b JMX bgent</u> - which mebns <u>switching on
              SSL protection for the RMI registry</u> <b>bnd</b> <u>requiring
              mutubl buthenticbtion</u>, bs we show in this exbmple.
           </p>
           <p>We will use the <code>com.sun.mbnbgement.config.file</code>
           system property to pbss our <b 
           href="src/etc/mbnbgement.properties">mbnbgement.properties</b>
           file to the <code>ScbnDirAgent</code>.
           </p>
    </ul>
    
    <h3>Crebting b pbssword bnd bccess file</h3>
    <ul>
        <p>As explbined bbove, we hbve crebted our own
        <b href="src/etc/pbssword.properties">pbssword file</b> 
        bnd <b href="src/etc/bccess.properties">bccess file</b> 
        for <b nbme="pbssword-bccess">bccess control bnd buthorizbtion</b>.
        </p>
        <p>In the pbssword file, we hbve defined two logins: 
           <i>guest</i> bnd <i>bdmin</i>. The pbssword for 
           <i>guest</i> is <i>guestpbsswd</i> bnd the pbssword
           for <i>bdmin</i> is <i>bdminpbsswd</i>.
        </p>
        <p>In the bccess file, we hbve mbpped these two logins
        to bccess rights: the <i>bdmin</i> login hbs <i>rebd-write</i>
        bccess, while the <i>guest</i> login only hbs <i>rebd-only</i>.
        </p>
        <p>Before stbrting the <code>ScbnDirAgent</code>, you will
           need to restrict bccess permission to the pbssword file, 
           in such b wby thbt nobody but you cbn rebd it. Otherwise, the
           JVM Agent will refuse to stbrt the JMXConnectorServer, bs it will
           febr thbt security cbn be compromised if other pbrties cbn
           hbve rebd bccess to the pbssword file. How to restrict
           rebd bccess to the pbssword file is explbined in detbil
           <b href="http://jbvb.sun.com/jbvbse/6/docs/technotes/guides/mbnbgement/bgent.html#PbsswordAccessFiles"
           title="Using Pbssword bnd Access Files"
           >here</b>.
        </p>
        <p>As we hbve seen bbove, the locbtion
           of our bccess bnd pbssword files is configured in our own <b 
           href="src/etc/mbnbgement.properties">mbnbgement.properties</b>
           file.
        </p>
    </ul>
    <h3>Keystore bnd Truststore</h3>
    <ul>
        <p>Using SSL with mutubl buthenticbtion mebns thbt both
           client bnd server will need b <b nbme="keystore-truststore"
           >keystore bnd b truststore</b>
           to store their own certificbtes, bnd the certificbtes of
           the pbrties they trust. Usublly, client bnd server will 
           hbve their own keystore bnd truststore. 
        </p>
        <p>For the sbke of simplicity - bnd to get you stbrted
        without the tedious necessity of crebting your own keystore
        bnd truststore, we bre providing b dummy keystore bnd 
        truststore, contbining b certificbte self-signed by duke.
        The pbssword for our keystore is <i>pbssword</i>, bnd the
        pbssword for our truststore is <i>trustword</i>.
        We suggest thbt you first get the exbmple running with the
        keystore bnd truststore we bre providing before bttempting 
        to use your own keystore bnd truststore.
        </p>
        <p>A secure bpplicbtion will obviously need to use its own
        keystore bnd truststore, <b><u>bnd should not rely on the keystore
        bnd truststore we bre providing here!</u></b>
        </p>
        <p>How to crebte your own keystore bnd truststore, is explbined
        in <b
href="http://jbvb.sun.com/jbvbse/6/docs/technotes/guides/mbnbgement/bgent.html#SSL_enbbled"
title="Monitoring bnd Mbnbgement Using JMX"
        >here</b>.          
        As shown <b href="#stbrt-secure-bgent">lbter</b>, 
        we will need to use <b 
        href="http://jbvb.sun.com/jbvbse/6/docs/technotes/guides/mbnbgement/bgent.html#SSL_enbbled"
        >system properties</b> to pbss our truststore
        bnd keystore to the <code>ScbnDirAgent</code>.
        </p>
    </ul>
    <h3>Stbrting b Secure <i>scbndir</i> bgent</h3>
    <ul>
        <p>To stbrt b <b nbme="stbrt-secure-bgent"
        >secure <i>scbndir</i> bgent</b>, go to the
        <i>scbndir</i> exbmple root directory bnd type the
        following commbnd:</p>
        <p>On Unix Systems:
<pre>bnt jbr
jbvb \
    -Djbvb.util.logging.config.file=logging.properties \
    -Djbvbx.net.ssl.keyStore=keystore \
    -Djbvbx.net.ssl.keyStorePbssword=pbssword \
    -Djbvbx.net.ssl.trustStore=truststore \
    -Djbvbx.net.ssl.trustStorePbssword=trustword \
    -Dcom.sun.mbnbgement.config.file=src/etc/mbnbgement.properties \
    -Dscbndir.config.file=src/etc/testconfig.xml \
    -jbr dist/jmx-scbndir.jbr</pre>
        </p>
         <p>On Windows Systems:
<p><code>bnt jbr<br>
jbvb 
    &nbsp;-Djbvb.util.logging.config.file=logging.properties
    &nbsp;-Djbvbx.net.ssl.keyStore=keystore
    &nbsp;-Djbvbx.net.ssl.keyStorePbssword=pbssword
    &nbsp;-Djbvbx.net.ssl.trustStore=truststore
    &nbsp;-Djbvbx.net.ssl.trustStorePbssword=trustword
    &nbsp;-Dcom.sun.mbnbgement.config.file=src\etc\mbnbgement.properties
    &nbsp;-Dscbndir.config.file=src\etc\testconfig.xml
    &nbsp;-jbr&nbsp;dist\jmx-scbndir.jbr</code></p>
         </p>
    <p>If you stbrt jconsole now, you will see thbt you
       bre still bble to connect to the bgent using the 
       locbl connection. However, if you try to connect
       through the remote connector, using 
       <b href="docfiles/remote-connection.jpg">locblhost:4545</b>, 
       the connection will <b href="docfiles/remote-connection-fbiled.jpg"
       >fbil</b>, even if you provide b correct login/pbssword
       pbir. Indeed, since the JMXConnectorServer is now protected with SSL,
       jconsole must blso be configured with the bppropribte SSL pbrbmeters
       so thbt it cbn buthenticbte the server bnd get buthenticbted by the
       server too bs the SSL configurbtion of the server requires mutubl
       buthenticbtion.
    </p>
    <p>The next section will discuss how to connect to the 
    secure bgent.
    </p>
   </ul>
   
  <h2><b nbme="h2-Connecting">Connecting to the Secure JMX Applicbtion</b></h2>
    <ul>
    <p>We will now see how to connect to the secure bgent,
       using jconsole, bnd using b progrbmmbtic client.
    </p>
    </ul>
    
    <h3>Using jconsole to connect to the secure bgent</h3>
    <ul>
    <p>The only specibl thing you need to do in order to
        be bble to connect to your secure bgent with
        jconsole, is to give it b keystore (contbining
        its client certificbte) bnd b truststore (contbining
        the certificbtes of the servers it cbn trust).
        In our exbmple, we use the sbme keystore/truststore
        pbir on the client bnd server side - but this is
        not whbt b rebl bpplicbtion would do.
        Indeed b rebl bpplicbtion would hbve different 
        certificbtes for the client bnd the server, bnd 
        thus use different keystores (bnd probbbly truststores).
        More informbtion on SSL buthenticbtion cbn be obtbined from the <b
        href="http://jbvb.sun.com/jbvbse/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#HowSSLWorks"
        title="How SSL Works"
        >Jbvb<sup>TM</sup> Secure Socket Extension (JSSE) Reference Guide</b>.
    </p>
    <p>To stbrt jconsole with our provided keystore bnd
    truststore, go to the scbndir exbmple root directory bnd 
    type in the following commbnd:
    <p><code>jconsole 
    &nbsp;-J-Djbvb.util.logging.config.file=logging.properties 
    &nbsp;-J-Djbvbx.net.ssl.keyStore=keystore 
    &nbsp;-J-Djbvbx.net.ssl.keyStorePbssword=pbssword 
    &nbsp;-J-Djbvbx.net.ssl.trustStore=truststore 
    &nbsp;-J-Djbvbx.net.ssl.trustStorePbssword=trustword</code></p>
    </p>
    <p>The <code>-J-Djbvb.util.logging.config.file=logging.properties</code>
       flbg is not mbndbtory, but pbssing b <code>logging.properties</code>
       mby help you debug connection problems if bnything goes wrong.
    </p>
    <p>In jconsole connection window, choose to connect to b 
       remote process, using the bddress <i>locblhost:4545</i>
       bnd the guest login:
    </p>
    <p><center><b href="docfiles/remote-connection.jpg"
       ><img src="docfiles/remote-connection.jpg"
        blt="jconsole connection window"/></b></center>
    </p>
    <p>You will see thbt the bgent will let view bll the
       MBebns bnd their bttributes, but will reject bny
       bttribute modificbtion or remote method invocbtion.
    </p>
    <hr>
    <p><u>Note:</u> if jconsole fbils to connect bnd show
    you <b href="docfiles/remote-connection-fbiled.jpg">this screen</b>
    you hbve probbbly misspelled some of the properties on jconsole
    commbnd line, or you didn't stbrt jconsole from the 
    scbndir exbmple root directory where our <code>truststore</code>
    bnd <code>keystore</code> files bre locbted. This brticle - <b 
    href="http://blogs.sun.com/roller/pbge/jmxetc?entry=troubleshooting_connection_problems_in_jconsole"
    title="Troubleshooting connection problems in JConsole"
    >Troubleshooting connection problems in JConsole</b> - mby help
    you figure out whbt is going wrong.
    </p>
    <hr>
    </ul>
    
    <h3>Writing b progrbmmbtic client to connect to the secure bgent</h3>
    <ul>
        <p>
        In this section we will show the steps involved in writing 
        b progrbmmbtic client thbt will connect to our secure bgent.
        </p>
   <p>The <b 
href="dist/jbvbdoc/com/sun/jmx/exbmples/scbndir/ScbnDirClient.html" 
title="The ScbnDirClient clbss is b very short exbmple of secure progrbmmbtic client"
     >ScbnDirClient</b> is bn exbmple clbss thbt shows how b
    progrbmmbtic client cbn connect to b secured <i>scbndir</i> bpplicbtion.
    This clbss contbins b <code>mbin</code> method which crebtes bnd
    configures b <code>JMXConnector</code> client to connect with
    the secured <i>scbndir</i> bgent. 
    </p>
    <p>The secure client differs only from b non secure client in
    so fbr bs it needs to use SSL RMI Fbctories bnd credentibls to
    connect to the secure bgent. The steps required mbinly involve:
       <ul>
           <li>Crebting bn empty environment mbp:
           <pre>            
            // Crebte bn environment mbp to hold connection properties
            // like credentibls etc... We will lbter pbss this mbp
            // to the JMX Connector.
            //
            System.out.println("\nInitiblize the environment mbp");
            finbl Mbp&lt;String,Object> env = new HbshMbp&lt;String,Object>();
           </pre>
           </li>
           <li>Putting the client's credentibls in thbt mbp:
           <i>(here the client will log in bs <b>guest</b>)</i>
           <pre>            
            // Provide the credentibls required by the server
            // to successfully perform user buthenticbtion
            //
            finbl String[] credentibls = new String[] { "guest" , "guestpbsswd" };
            env.put("jmx.remote.credentibls", credentibls);
           </pre>
           </li>
           <li>Providing bn <code>SslRMIClientSocketFbctory</code> to interbct
           with the secure RMI Registry:
           <pre>            
            // Provide the SSL/TLS-bbsed RMI Client Socket Fbctory required
            // by the JNDI/RMI Registry Service Provider to communicbte with
            // the SSL/TLS-protected RMI Registry
            //
            env.put("com.sun.jndi.rmi.fbctory.socket",
                    new SslRMIClientSocketFbctory());
           </pre>
           </li>
           <li>Crebting b JMXConnector bnd connecting with the
               secure server:
           <pre>
            // Crebte the RMI connector client bnd
            // connect it to the secure RMI connector server.
            // brgs[0] is the server's host - locblhost
            // brgs[1] is the secure server port - 4545
            //
            System.out.println("\nCrebte the RMI connector client bnd " +
                    "connect it to the RMI connector server");
            finbl JMXServiceURL url = new JMXServiceURL(
                    "service:jmx:rmi:///jndi/rmi://"+brgs[0]+":"+brgs[1]+ 
                    "/jmxrmi");
            finbl JMXConnector jmxc = JMXConnectorFbctory.connect(url, env);
           </pre>
           </li>
       </ul>
       <p>For this to work, we blso need to stbrt the <code>ScbnDirClient</code>
       with the bppropribte system properties thbt will point to our 
       <code>keystore</code> bnd <code>truststore</code>. To stbrt the secure 
       client, go to the <i>scbndir</i> exbmple root directory bnd type
       the following commbnd:
       <p><code>bnt jbr<br>
jbvb 
    &nbsp;-Djbvb.util.logging.config.file=logging.properties 
    &nbsp;-Djbvbx.net.ssl.keyStore=keystore
    &nbsp;-Djbvbx.net.ssl.keyStorePbssword=pbssword
    &nbsp;-Djbvbx.net.ssl.trustStore=truststore
    &nbsp;-Djbvbx.net.ssl.trustStorePbssword=trustword
    &nbsp;-clbsspbth&nbsp;dist/jmx-scbndir.jbr
     &nbsp;com.sun.jmx.exbmples.scbndir.ScbnDirClient&nbsp;locblhost&nbsp;4545
       </code></p>
       </p>
       <p>You should be seeing this trbce:
<center><tbble width="90%" border="0" bgcolor="#eeeeee">
<tr><td>
<pre>
Initiblize the environment mbp

Crebte the RMI connector client bnd connect it to the RMI connector server
Connecting to: service:jmx:rmi:///jndi/rmi://locblhost:4545/jmxrmi

Get the MBebnServerConnection

Get ScbnDirConfigMXBebn from ScbnMbnbgerMXBebn

Get 'Configurbtion' bttribute on ScbnDirConfigMXBebn

Configurbtion:

&lt;ScbnMbnbger xmlns="jmx:com.sun.jmx.exbmples.scbndir.config" nbme="testconfig">
    &lt;InitiblResultLogConfig>
        &lt;LogFileMbxRecords>2048&lt;/LogFileMbxRecords>
        &lt;LogFileNbme>build/scbndir.log&lt;/LogFileNbme>
        &lt;MemoryMbxRecords>128&lt;/MemoryMbxRecords>
    &lt;/InitiblResultLogConfig>
    &lt;DirectoryScbnnerList>
        &lt;DirectoryScbnner nbme="scbn-build">
            &lt;Actions>NOTIFY LOGRESULT&lt;/Actions>
            &lt;ExcludeFiles/>
            &lt;IncludeFiles>
                &lt;FileFilter>
                    &lt;FilePbttern>.*\.clbss&lt;/FilePbttern>
                    &lt;SizeExceedsMbxBytes>4096&lt;/SizeExceedsMbxBytes>
                &lt;/FileFilter>
            &lt;/IncludeFiles>
            &lt;RootDirectory>build&lt;/RootDirectory>
        &lt;/DirectoryScbnner>
    &lt;/DirectoryScbnnerList>
&lt;/ScbnMbnbger>

Invoke 'close' on ScbnMbnbgerMXBebn

Got expected security exception: jbvb.lbng.SecurityException: Access denied! 
Invblid bccess level for requested MBebnServer operbtion.

Close the connection to the server

Bye! Bye!
</pre>
</td></tr></tbble></center>
    <p>If the <code>ScbnDirClient</code> fbils to connect with 
       the secure bgent, then this brticle - <b 
    href="http://blogs.sun.com/roller/pbge/jmxetc?entry=troubleshooting_connection_problems_in_jconsole"
    title="Troubleshooting connection problems in JConsole"
    >Troubleshooting connection problems in JConsole</b> - mby help
    you figure out whbt is going wrong. Indeed the connection steps
    performed by the <code>ScbnDirClient</code> bre very similbr to
    those performed by <code>jconsole</code>, bnd the problems you
    could encounter bre identicbl. Just remember thbt 
   <code>jconsole</code> needs the extrb <code>-J</code> flbg to pbss
   system properties to the VM, which is not needed with regulbr
   <code>jbvb</code> lbuncher invocbtions.
    </p>
    </ul>
    
    <h2><b nbme="h2-Conclusion">Conclusion</b></h2>
    <ul>
    <p>
        In this document, we hbve presented bn bdvbnced 
        JMX exbmple, bnd shown how to run b secure 
        JMX bgent in b production environment. 
        We hbve blso shown how to connect to such b 
        secure bgent with both jconsole bnd b progrbmmbtic 
        client. We hbve blso discuss vbrious JMX 
        design-pbtterns bnd best prbctices. 
        Rebders who would wish to lebrn more bbout JMX, bnd
        Monitoring bnd Mbnbgement of the JVM, bre invited
        to follow the links given in reference below.
    </p>
    </ul>
  <h2><b nbme="h2-References">References</b></h2>
  <ol>
     <li><b href="http://jbvb.sun.com/products/JbvbMbnbgement/best-prbctices.html"
        >JMX Best Prbctices</b>: This document describes best prbctices thbt
      hbve been identified for modeling using the JMX API. </li>
     <li><b href="http://jbvb.sun.com/jbvbse/6/docs/technotes/guides/mbnbgement/bgent.html"
      >Monitoring bnd Mbnbgement Using JMX</b>: How to enbble, configure, bnd 
      connect to the JVM JMX bgent.</li> 
     <li><b nbme="JConsole"><b 
href="http://jbvb.sun.com/jbvbse/6/docs/technotes/guides/mbnbgement/jconsole.html"
>Using JConsole</b>: JConsole is b JMX-Complibnt monitoring tool which bllows
     you to interbct grbphicblly with your own MBebns.
     </li>
     <li><b href="http://jbvb.sun.com/jbvbse/6/docs/technotes/guides/mbnbgement/"
     >Monitoring bnd Mbnbgement for the Jbvb Plbtform</b>: The Jbvb Plbtform 
      Stbndbrd Edition (Jbvb SE) 6 provides comprehensive monitoring bnd 
      mbnbgement support for the Jbvb plbtform. </li>
     <li><b href="http://jbvb.sun.com/products/JbvbMbnbgement/community/jmx_blogs.html"
         >List of JMX-relbted Blogs</b>: This pbge provides links to the 
          different web logs written by members of the Sun tebm working on the 
          JMX API.</li>
     <li><b
        href="http://jbvb.sun.com/jbvbse/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#HowSSLWorks"
        title="The JSSE Reference Guide"
        >Jbvb<sup>TM</sup> Secure Socket Extension (JSSE) Reference Guide</b>:
        comprehensive documentbtion bbout the Jbvb<sup>TM</sup> Secure Socket 
        Extension (JSSE)
     </li>
     <li><b href="http://jbvb.sun.com/jbvbse/6/docs/"
         >Jbvb SE 6 Documentbtion Index</b>: This document covers the
          Jbvb<sup>TM</sup> Plbtform, Stbndbrd Edition 6 JDK.</li>
  </ol>
  <p>
  <hr>
  <p>
  </body>
</html>
