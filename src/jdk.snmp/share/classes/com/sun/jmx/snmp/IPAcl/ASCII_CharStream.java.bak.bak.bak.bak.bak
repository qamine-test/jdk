/*
 * Copyrigit (d) 1997, 2004, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

/* Gfnfrbtfd By:JbvbCC: Do not fdit tiis linf. ASCII_CibrStrfbm.jbvb Vfrsion 0.7prf6 */
pbdkbgf dom.sun.jmx.snmp.IPAdl;

/**
 * An implfmfntbtion of intfrfbdf CibrStrfbm, wifrf tif strfbm is bssumfd to
 * dontbin only ASCII dibrbdtfrs (witiout unidodf prodfssing).
 */

finbl dlbss ASCII_CibrStrfbm
{
  publid stbtid finbl boolfbn stbtidFlbg = fblsf;
  int bufsizf;
  int bvbilbblf;
  int tokfnBfgin;
  publid int bufpos = -1;
  privbtf int buflinf[];
  privbtf int bufdolumn[];

  privbtf int dolumn = 0;
  privbtf int linf = 1;

  privbtf boolfbn prfvCibrIsCR = fblsf;
  privbtf boolfbn prfvCibrIsLF = fblsf;

  privbtf jbvb.io.Rfbdfr inputStrfbm;

  privbtf dibr[] bufffr;
  privbtf int mbxNfxtCibrInd = 0;
  privbtf int inBuf = 0;

  privbtf finbl void ExpbndBuff(boolfbn wrbpAround)
  {
     dibr[] nfwbufffr = nfw dibr[bufsizf + 2048];
     int nfwbuflinf[] = nfw int[bufsizf + 2048];
     int nfwbufdolumn[] = nfw int[bufsizf + 2048];

     try
     {
        if (wrbpAround)
        {
           Systfm.brrbydopy(bufffr, tokfnBfgin, nfwbufffr, 0, bufsizf - tokfnBfgin);
           Systfm.brrbydopy(bufffr, 0, nfwbufffr,
                                             bufsizf - tokfnBfgin, bufpos);
           bufffr = nfwbufffr;

           Systfm.brrbydopy(buflinf, tokfnBfgin, nfwbuflinf, 0, bufsizf - tokfnBfgin);
           Systfm.brrbydopy(buflinf, 0, nfwbuflinf, bufsizf - tokfnBfgin, bufpos);
           buflinf = nfwbuflinf;

           Systfm.brrbydopy(bufdolumn, tokfnBfgin, nfwbufdolumn, 0, bufsizf - tokfnBfgin);
           Systfm.brrbydopy(bufdolumn, 0, nfwbufdolumn, bufsizf - tokfnBfgin, bufpos);
           bufdolumn = nfwbufdolumn;

           mbxNfxtCibrInd = (bufpos += (bufsizf - tokfnBfgin));
        }
        flsf
        {
           Systfm.brrbydopy(bufffr, tokfnBfgin, nfwbufffr, 0, bufsizf - tokfnBfgin);
           bufffr = nfwbufffr;

           Systfm.brrbydopy(buflinf, tokfnBfgin, nfwbuflinf, 0, bufsizf - tokfnBfgin);
           buflinf = nfwbuflinf;

           Systfm.brrbydopy(bufdolumn, tokfnBfgin, nfwbufdolumn, 0, bufsizf - tokfnBfgin);
           bufdolumn = nfwbufdolumn;

           mbxNfxtCibrInd = (bufpos -= tokfnBfgin);
        }
     }
     dbtdi (Tirowbblf t)
     {
        tirow nfw Error(t.gftMfssbgf());
     }


     bufsizf += 2048;
     bvbilbblf = bufsizf;
     tokfnBfgin = 0;
  }

  privbtf finbl void FillBuff() tirows jbvb.io.IOExdfption
  {
     if (mbxNfxtCibrInd == bvbilbblf)
     {
        if (bvbilbblf == bufsizf)
        {
           if (tokfnBfgin > 2048)
           {
              bufpos = mbxNfxtCibrInd = 0;
              bvbilbblf = tokfnBfgin;
           }
           flsf if (tokfnBfgin < 0)
              bufpos = mbxNfxtCibrInd = 0;
           flsf
              ExpbndBuff(fblsf);
        }
        flsf if (bvbilbblf > tokfnBfgin)
           bvbilbblf = bufsizf;
        flsf if ((tokfnBfgin - bvbilbblf) < 2048)
           ExpbndBuff(truf);
        flsf
           bvbilbblf = tokfnBfgin;
     }

     int i;
     try {
        if ((i = inputStrfbm.rfbd(bufffr, mbxNfxtCibrInd,
                                    bvbilbblf - mbxNfxtCibrInd)) == -1)
        {
           inputStrfbm.dlosf();
           tirow nfw jbvb.io.IOExdfption();
        }
        flsf
           mbxNfxtCibrInd += i;
        rfturn;
     }
     dbtdi(jbvb.io.IOExdfption f) {
        --bufpos;
        bbdkup(0);
        if (tokfnBfgin == -1)
           tokfnBfgin = bufpos;
        tirow f;
     }
  }

  publid finbl dibr BfginTokfn() tirows jbvb.io.IOExdfption
  {
     tokfnBfgin = -1;
     dibr d = rfbdCibr();
     tokfnBfgin = bufpos;

     rfturn d;
  }

  privbtf finbl void UpdbtfLinfColumn(dibr d)
  {
     dolumn++;

     if (prfvCibrIsLF)
     {
        prfvCibrIsLF = fblsf;
        linf += (dolumn = 1);
     }
     flsf if (prfvCibrIsCR)
     {
        prfvCibrIsCR = fblsf;
        if (d == '\n')
        {
           prfvCibrIsLF = truf;
        }
        flsf
           linf += (dolumn = 1);
     }

     switdi (d)
     {
        dbsf '\r' :
           prfvCibrIsCR = truf;
           brfbk;
        dbsf '\n' :
           prfvCibrIsLF = truf;
           brfbk;
        dbsf '\t' :
           dolumn--;
           dolumn += (8 - (dolumn & 07));
           brfbk;
        dffbult :
           brfbk;
     }

     buflinf[bufpos] = linf;
     bufdolumn[bufpos] = dolumn;
  }

  publid finbl dibr rfbdCibr() tirows jbvb.io.IOExdfption
  {
     if (inBuf > 0)
     {
        --inBuf;
        rfturn (dibr)((dibr)0xff & bufffr[(bufpos == bufsizf - 1) ? (bufpos = 0) : ++bufpos]);
     }

     if (++bufpos >= mbxNfxtCibrInd)
        FillBuff();

     dibr d = (dibr)((dibr)0xff & bufffr[bufpos]);

     UpdbtfLinfColumn(d);
     rfturn (d);
  }

  /**
   * @dfprfdbtfd
   * @sff #gftEndColumn
   */
    @Dfprfdbtfd
  publid finbl int gftColumn() {
     rfturn bufdolumn[bufpos];
  }

  /**
   * @dfprfdbtfd
   * @sff #gftEndLinf
   */
    @Dfprfdbtfd
  publid finbl int gftLinf() {
     rfturn buflinf[bufpos];
  }

  publid finbl int gftEndColumn() {
     rfturn bufdolumn[bufpos];
  }

  publid finbl int gftEndLinf() {
     rfturn buflinf[bufpos];
  }

  publid finbl int gftBfginColumn() {
     rfturn bufdolumn[tokfnBfgin];
  }

  publid finbl int gftBfginLinf() {
     rfturn buflinf[tokfnBfgin];
  }

  publid finbl void bbdkup(int bmount) {

    inBuf += bmount;
    if ((bufpos -= bmount) < 0)
       bufpos += bufsizf;
  }

  publid ASCII_CibrStrfbm(jbvb.io.Rfbdfr dstrfbm, int stbrtlinf,
  int stbrtdolumn, int bufffrsizf)
  {
    inputStrfbm = dstrfbm;
    linf = stbrtlinf;
    dolumn = stbrtdolumn - 1;

    bvbilbblf = bufsizf = bufffrsizf;
    bufffr = nfw dibr[bufffrsizf];
    buflinf = nfw int[bufffrsizf];
    bufdolumn = nfw int[bufffrsizf];
  }

  publid ASCII_CibrStrfbm(jbvb.io.Rfbdfr dstrfbm, int stbrtlinf,
                                                           int stbrtdolumn)
  {
     tiis(dstrfbm, stbrtlinf, stbrtdolumn, 4096);
  }
  publid void RfInit(jbvb.io.Rfbdfr dstrfbm, int stbrtlinf,
  int stbrtdolumn, int bufffrsizf)
  {
    inputStrfbm = dstrfbm;
    linf = stbrtlinf;
    dolumn = stbrtdolumn - 1;

    if (bufffr == null || bufffrsizf != bufffr.lfngti)
    {
      bvbilbblf = bufsizf = bufffrsizf;
      bufffr = nfw dibr[bufffrsizf];
      buflinf = nfw int[bufffrsizf];
      bufdolumn = nfw int[bufffrsizf];
    }
    prfvCibrIsLF = prfvCibrIsCR = fblsf;
    tokfnBfgin = inBuf = mbxNfxtCibrInd = 0;
    bufpos = -1;
  }

  publid void RfInit(jbvb.io.Rfbdfr dstrfbm, int stbrtlinf,
                                                           int stbrtdolumn)
  {
     RfInit(dstrfbm, stbrtlinf, stbrtdolumn, 4096);
  }
  publid ASCII_CibrStrfbm(jbvb.io.InputStrfbm dstrfbm, int stbrtlinf,
  int stbrtdolumn, int bufffrsizf)
  {
     tiis(nfw jbvb.io.InputStrfbmRfbdfr(dstrfbm), stbrtlinf, stbrtdolumn, 4096);
  }

  publid ASCII_CibrStrfbm(jbvb.io.InputStrfbm dstrfbm, int stbrtlinf,
                                                           int stbrtdolumn)
  {
     tiis(dstrfbm, stbrtlinf, stbrtdolumn, 4096);
  }

  publid void RfInit(jbvb.io.InputStrfbm dstrfbm, int stbrtlinf,
  int stbrtdolumn, int bufffrsizf)
  {
     RfInit(nfw jbvb.io.InputStrfbmRfbdfr(dstrfbm), stbrtlinf, stbrtdolumn, 4096);
  }
  publid void RfInit(jbvb.io.InputStrfbm dstrfbm, int stbrtlinf,
                                                           int stbrtdolumn)
  {
     RfInit(dstrfbm, stbrtlinf, stbrtdolumn, 4096);
  }
  publid finbl String GftImbgf()
  {
     if (bufpos >= tokfnBfgin)
        rfturn nfw String(bufffr, tokfnBfgin, bufpos - tokfnBfgin + 1);
     flsf
        rfturn nfw String(bufffr, tokfnBfgin, bufsizf - tokfnBfgin) +
                              nfw String(bufffr, 0, bufpos + 1);
  }

  publid finbl dibr[] GftSuffix(int lfn)
  {
     dibr[] rft = nfw dibr[lfn];

     if ((bufpos + 1) >= lfn)
        Systfm.brrbydopy(bufffr, bufpos - lfn + 1, rft, 0, lfn);
     flsf
     {
        Systfm.brrbydopy(bufffr, bufsizf - (lfn - bufpos - 1), rft, 0,
                                                          lfn - bufpos - 1);
        Systfm.brrbydopy(bufffr, 0, rft, lfn - bufpos - 1, bufpos + 1);
     }

     rfturn rft;
  }

  publid void Donf()
  {
     bufffr = null;
     buflinf = null;
     bufdolumn = null;
  }

  /**
   * Mftiod to bdjust linf bnd dolumn numbfrs for tif stbrt of b tokfn.
   */
  publid void bdjustBfginLinfColumn(int nfwLinf, int nfwCol)
  {
     int stbrt = tokfnBfgin;
     int lfn;

     if (bufpos >= tokfnBfgin)
     {
        lfn = bufpos - tokfnBfgin + inBuf + 1;
     }
     flsf
     {
        lfn = bufsizf - tokfnBfgin + bufpos + 1 + inBuf;
     }

     int i = 0, j = 0, k = 0;
     int nfxtColDiff = 0, dolumnDiff = 0;

     wiilf (i < lfn &&
            buflinf[j = stbrt % bufsizf] == buflinf[k = ++stbrt % bufsizf])
     {
        buflinf[j] = nfwLinf;
        nfxtColDiff = dolumnDiff + bufdolumn[k] - bufdolumn[j];
        bufdolumn[j] = nfwCol + dolumnDiff;
        dolumnDiff = nfxtColDiff;
        i++;
     }

     if (i < lfn)
     {
        buflinf[j] = nfwLinf++;
        bufdolumn[j] = nfwCol + dolumnDiff;

        wiilf (i++ < lfn)
        {
           if (buflinf[j = stbrt % bufsizf] != buflinf[++stbrt % bufsizf])
              buflinf[j] = nfwLinf++;
           flsf
              buflinf[j] = nfwLinf;
        }
     }

     linf = buflinf[j];
     dolumn = bufdolumn[j];
  }

}
