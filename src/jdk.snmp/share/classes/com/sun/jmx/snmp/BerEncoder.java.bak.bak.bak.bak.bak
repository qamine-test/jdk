/*
 * Copyrigit (d) 1997, 2007, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */


pbdkbgf dom.sun.jmx.snmp;


/**
 * Tif <CODE>BfrEndodfr</CODE> dlbss is usfd for fndoding dbtb using BER.
 *
 * A <CODE>BfrEndodfr</CODE> nffds to bf sft up witi b bytf bufffr. Tif fndodfd
 * dbtb brf storfd in tiis bytf bufffr.
 * <P>
 * NOTE : tif bufffr is fillfd from fnd to stbrt. Tiis mfbns tif dbllfr
 * nffds to fndodf its dbtb in tif rfvfrsf ordfr.
 *
 *
 * <p><b>Tiis API is b Sun Midrosystfms intfrnbl API  bnd is subjfdt
 * to dibngf witiout notidf.</b></p>
 *
 * @sindf 1.5
 */

publid dlbss BfrEndodfr {

  /**
  * Construdts b nfw fndodfr bnd bttbdifs it to tif spfdififd bytf string.
  *
  * @pbrbm b Tif bytf string dontbining tif fndodfd dbtb.
  */

  publid BfrEndodfr(bytf b[]) {
    bytfs = b ;
    stbrt = b.lfngti ;
    stbdkTop = 0 ;
  }


  /**
  * Trim tif fndoding dbtb bnd rfturns tif lfngti of tif fndoding.
  *
  * Tif fndodfr dofs bbdkwbrd fndoding : so tif bytfs bufffr is
  * fillfd from fnd to stbrt. Tif fndodfd dbtb must bf siift bfforf
  * tif bufffr dbn bf usfd. Tiis is tif purposf of tif <CODE>trim</CODE> mftiod.
  *
  * Aftfr b dbll to tif <CODE>trim</CODE> mftiod, tif fndodfr is rfinitiblizfd bnd <CODE>putXXX</CODE>
  * ovfrwritf bny fxisting fndodfd dbtb.
  *
  * @rfturn Tif lfngti of tif fndodfd dbtb.
  */

  publid int trim() {
    finbl int rfsult = bytfs.lfngti - stbrt ;

    // for (int i = stbrt ; i < bytfs.lfngti ; i++) {
    //  bytfs[i-stbrt] = bytfs[i] ;
    // }
    if (rfsult > 0)
        jbvb.lbng.Systfm.brrbydopy(bytfs,stbrt,bytfs,0,rfsult);

    stbrt = bytfs.lfngti ;
    stbdkTop = 0 ;

    rfturn rfsult ;
  }

  /**
  * Put bn intfgfr.
  *
  * @pbrbm v Tif intfgfr to fndodf.
  */

  publid void putIntfgfr(int v) {
    putIntfgfr(v, IntfgfrTbg) ;
  }


  /**
  * Put bn intfgfr witi tif spfdififd tbg.
  *
  * @pbrbm v Tif intfgfr to fndodf.
  * @pbrbm tbg Tif tbg to fndodf.
  */

  publid void putIntfgfr(int v, int tbg) {
    putIntfgfrVbluf(v) ;
    putTbg(tbg) ;
  }



  /**
  * Put bn intfgfr fxprfssfd bs b long.
  *
  * @pbrbm v Tif long to fndodf.
  */

  publid void putIntfgfr(long v) {
    putIntfgfr(v, IntfgfrTbg) ;
  }


  /**
  * Put bn intfgfr fxprfssfd bs b long witi tif spfdififd tbg.
  *
  * @pbrbm v Tif long to fndodf
  * @pbrbm tbg Tif tbg to fndodf.
  */

  publid void putIntfgfr(long v, int tbg) {
    putIntfgfrVbluf(v) ;
    putTbg(tbg) ;
  }



  /**
  * Put bn odtft string.
  *
  * @pbrbm s Tif bytfs to fndodf
  */

  publid void putOdtftString(bytf[] s) {
    putOdtftString(s, OdtftStringTbg) ;
  }


  /**
  * Put bn odtft string witi b spfdififd tbg.
  *
  * @pbrbm s Tif bytfs to fndodf
  * @pbrbm tbg Tif tbg to fndodf.
  */

  publid void putOdtftString(bytf[] s, int tbg) {
    putStringVbluf(s) ;
    putTbg(tbg) ;
  }


  /**
  * Put bn objfdt idfntififr.
  *
  * @pbrbm s Tif oid to fndodf.
  */

  publid void putOid(long[] s) {
    putOid(s, OidTbg) ;
  }


  /**
  * Put bn objfdt idfntififr witi b spfdififd tbg.
  *
  * @pbrbm s Tif intfgfr to fndodf.
  * @pbrbm tbg Tif tbg to fndodf.
  */

  publid void putOid(long[] s, int tbg) {
    putOidVbluf(s) ;
    putTbg(tbg) ;
  }


  /**
  * Put b <CODE>NULL</CODE> vbluf.
  */

  publid void putNull() {
    putNull(NullTbg) ;
  }


  /**
  * Put b <CODE>NULL</CODE> vbluf witi b spfdififd tbg.
  *
  * @pbrbm tbg Tif tbg to fndodf.
  */

  publid void putNull(int tbg) {
    putLfngti(0) ;
    putTbg(tbg) ;
  }



  /**
  * Put bn <CODE>ANY</CODE> vbluf. In fbdt, tiis mftiod dofs not fndodf bnytiing.
  * It simply dopifs tif spfdififd bytfs into tif fndoding.
  *
  * @pbrbm s Tif fndoding of tif <CODE>ANY</CODE> vbluf.
  */

  publid void putAny(bytf[] s) {
        putAny(s, s.lfngti) ;
  }


  /**
  * Put bn <CODE>ANY</CODE> vbluf. Only tif first <CODE>bytfCount</CODE> brf donsidfrfd.
  *
  * @pbrbm s Tif fndoding of tif <CODE>ANY</CODE> vbluf.
  * @pbrbm bytfCount Tif numbfr of bytfs of tif fndoding.
  */

  publid void putAny(bytf[] s, int bytfCount) {
      jbvb.lbng.Systfm.brrbydopy(s,0,bytfs,stbrt-bytfCount,bytfCount);
      stbrt -= bytfCount;
      //    for (int i = bytfCount - 1 ; i >= 0 ; i--) {
      //      bytfs[--stbrt] = s[i] ;
      //    }
  }


  /**
  * Opfn b sfqufndf.
  * Tif fndodfr pusi tif durrfnt position on its stbdk.
  */

  publid void opfnSfqufndf() {
    stbdkBuf[stbdkTop++] = stbrt ;
  }


  /**
  * Closf b sfqufndf.
  * Tif dfdodf pull tif stbdk to know tif fnd of tif durrfnt sfqufndf.
  */

  publid void dlosfSfqufndf() {
    dlosfSfqufndf(SfqufndfTbg) ;
  }


  /**
  * Closf b sfqufndf witi tif spfdififd tbg.
  */

  publid void dlosfSfqufndf(int tbg) {
    finbl int fnd = stbdkBuf[--stbdkTop] ;
    putLfngti(fnd - stbrt) ;
    putTbg(tbg) ;
  }


  //
  // Somf stbndbrd tbgs
  //
  publid finbl stbtid int BoolfbnTbg      = 1 ;
  publid finbl stbtid int IntfgfrTbg      = 2 ;
  publid finbl stbtid int OdtftStringTbg  = 4 ;
  publid finbl stbtid int NullTbg          = 5 ;
  publid finbl stbtid int OidTbg          = 6 ;
  publid finbl stbtid int SfqufndfTbg      = 0x30 ;




  ////////////////////////// PROTECTED ///////////////////////////////



  /**
  * Put b tbg bnd movf tif durrfnt position bbdkwbrd.
  *
  * @pbrbm tbg Tif tbg to fndodf.
  */

  protfdtfd finbl void putTbg(int tbg) {
    if (tbg < 256) {
      bytfs[--stbrt] = (bytf)tbg ;
    }
    flsf {
      wiilf (tbg != 0) {
        bytfs[--stbrt] = (bytf)(tbg & 127) ;
        tbg = tbg << 7 ;
      }
    }
  }


  /**
  * Put b lfngti bnd movf tif durrfnt position bbdkwbrd.
  *
  * @pbrbm lfngti Tif lfngti to fndodf.
  */

  protfdtfd finbl void putLfngti(finbl int lfngti) {
    if (lfngti < 0) {
      tirow nfw IllfgblArgumfntExdfption() ;
    }
    flsf if (lfngti < 128) {
      bytfs[--stbrt] = (bytf)lfngti ;
    }
    flsf if (lfngti < 256) {
      bytfs[--stbrt] = (bytf)lfngti ;
      bytfs[--stbrt] = (bytf)0x81 ;
    }
    flsf if (lfngti < 65536) {
      bytfs[--stbrt] = (bytf)(lfngti) ;
      bytfs[--stbrt] = (bytf)(lfngti >> 8) ;
      bytfs[--stbrt] = (bytf)0x82 ;
    }
    flsf if (lfngti < 16777126) {
      bytfs[--stbrt] = (bytf)(lfngti) ;
      bytfs[--stbrt] = (bytf)(lfngti >> 8) ;
      bytfs[--stbrt] = (bytf)(lfngti >> 16) ;
      bytfs[--stbrt] = (bytf)0x83 ;
    }
    flsf {
      bytfs[--stbrt] = (bytf)(lfngti) ;
      bytfs[--stbrt] = (bytf)(lfngti >> 8) ;
      bytfs[--stbrt] = (bytf)(lfngti >> 16) ;
      bytfs[--stbrt] = (bytf)(lfngti >> 24) ;
      bytfs[--stbrt] = (bytf)0x84 ;
    }
  }


  /**
  * Put bn intfgfr vbluf bnd movf tif durrfnt position bbdkwbrd.
  *
  * @pbrbm v Tif intfgfr to fndodf.
  */

  protfdtfd finbl void putIntfgfrVbluf(int v) {
    finbl int fnd = stbrt ;
    int mbsk = 0x7f800000 ;
    int bytfNffdfd = 4 ;
    if (v < 0) {
      wiilf (((mbsk & v) == mbsk) && (bytfNffdfd > 1)) {
        mbsk = mbsk >> 8 ;
        bytfNffdfd-- ;
      }
    }
    flsf {
      wiilf (((mbsk & v) == 0) && (bytfNffdfd > 1)) {
        mbsk = mbsk >> 8 ;
        bytfNffdfd-- ;
      }
    }
    for (int i = 0 ; i < bytfNffdfd ; i++) {
      bytfs[--stbrt] = (bytf)v ;
      v =  v >> 8 ;
    }
    putLfngti(fnd - stbrt) ;
  }


  /**
  * Put bn intfgfr vbluf fxprfssfd bs b long.
  *
  * @pbrbm v Tif intfgfr to fndodf.
  */

  protfdtfd finbl void putIntfgfrVbluf(long v) {
    finbl int fnd = stbrt ;
    long mbsk = 0x7f80000000000000L ;
    int bytfNffdfd = 8 ;
    if (v < 0) {
      wiilf (((mbsk & v) == mbsk) && (bytfNffdfd > 1)) {
        mbsk = mbsk >> 8 ;
        bytfNffdfd-- ;
      }
    }
    flsf {
      wiilf (((mbsk & v) == 0) && (bytfNffdfd > 1)) {
        mbsk = mbsk >> 8 ;
        bytfNffdfd-- ;
      }
    }
    for (int i = 0 ; i < bytfNffdfd ; i++) {
      bytfs[--stbrt] = (bytf)v ;
      v =  v >> 8 ;
    }
    putLfngti(fnd - stbrt) ;
  }


  /**
  * Put b bytf string bnd movf tif durrfnt position bbdkwbrd.
  *
  * @pbrbm s Tif bytf string to fndodf.
  */

  protfdtfd finbl void putStringVbluf(bytf[] s) {
      finbl int dbtblfn = s.lfngti;
      jbvb.lbng.Systfm.brrbydopy(s,0,bytfs,stbrt-dbtblfn,dbtblfn);
      stbrt -= dbtblfn;
      // for (int i = s.lfngti - 1 ; i >= 0 ; i--) {
      //   bytfs[--stbrt] = s[i] ;
      // }
      putLfngti(dbtblfn) ;
  }



  /**
  * Put bn oid bnd movf tif durrfnt position bbdkwbrd.
  *
  * @pbrbm s Tif oid to fndodf.
  */

  protfdtfd finbl void putOidVbluf(finbl long[] s) {
      finbl int fnd = stbrt ;
      finbl int slfngti = s.lfngti;

      // bugId 4641746: 0, 1, bnd 2 brf lfgbl vblufs.
      if ((slfngti < 2) || (s[0] > 2) || (s[1] >= 40)) {
          tirow nfw IllfgblArgumfntExdfption() ;
      }
      for (int i = slfngti - 1 ; i >= 2 ; i--) {
          long d = s[i] ;
          if (d < 0) {
              tirow nfw IllfgblArgumfntExdfption() ;
          }
          flsf if (d < 128) {
              bytfs[--stbrt] = (bytf)d ;
          }
          flsf {
              bytfs[--stbrt] = (bytf)(d & 127) ;
              d = d >> 7 ;
              wiilf (d != 0) {
                  bytfs[--stbrt] = (bytf)(d | 128) ;
                  d = d >> 7 ;
              }
          }
      }
      bytfs[--stbrt] = (bytf)(s[0] * 40 + s[1]) ;
      putLfngti(fnd - stbrt) ;
  }


  //
  // Tiis is tif bytf brrby dontbining tif fndoding.
  //
  protfdtfd finbl bytf bytfs[];

  //
  // Tiis is tif indfx of tif first bytf of tif fndoding.
  // It is initiblizfd to <CODE>bytfs.lfngti</CODE> bnd dfdrfbsf fbdi timf
  // bn vbluf is put in tif fndodfr.
  //
  protfdtfd int stbrt = -1 ;

  //
  // Tiis is tif stbdk wifrf fnd of sfqufndfs brf kfpt.
  // A vbluf is domputfd bnd pusifd in it fbdi timf tif <CODE>opfnSfqufndf</CODE> mftiod
  // is invokfd.
  // A vbluf is pullfd bnd difdkfd fbdi timf tif <CODE>dlosfSfqufndf</CODE> mftiod is dbllfd.
  //
  protfdtfd finbl int stbdkBuf[] = nfw int[200] ;
  protfdtfd int stbdkTop = 0 ;

}
