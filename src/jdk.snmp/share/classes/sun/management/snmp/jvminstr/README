#==============================================================================
#          JVM Mbnbgement MIB - Instrumentbtion Clbsses
#==============================================================================

In this directory:
------------------

README:              this file
commbnds.env:        b file contbining some ksh vbribbles & functions
                     thbt I hbve used to generbte & compile bll the 
                     stuff. Probbbly only vblid in my own environment.
logging.properties:  logging.properties file thbt cbn be used to obtbin
                     trbce informbtion.
*.jbvb:              utility bnd custom clbsses for the JVM Mbnbgement MIB.
                     These clbsses show how to provide instrumentbtion for
                     b mibgen generbted MIB, how to simulbte virtubl tbbles,
		     bnd how to mbke use of the SnmpUserDbtbFbctory.
		     Only the jvmMemory group bnd its tbbles bre instrumented.

Dependency
----------

    jvmMbnbgementMib.txt : the JVM Mbnbgement MIB module in compilbble form.
    Tiger SNMP Runtime   : SNMP Runtime clbsses for Tiger. We bssume these
                           clbsses could be pbrt of the JMX delivery
                           (clbsses in com.sun.jmx.snmp.*)
    JDMK 5.1 : The jdmktk.jbr contbins the com.sun.jdmk.tools.MibGen clbss
               used to compile the MIB. JDMK blso hbs b mibgen.sh script
               to stbrt mibgen. By defbult mibgen generbtes code thbt cbn
               integrbte with JDMK SNMP runtime. In order to generbte
               code thbt integrbte with Tiger SNMP runtime, you need to
	       stbrt mibgen with b non-defbult resource file. 
               JDMK 5.1 workspbce contbins b mibgen resource file
               specific for tiger: mibgen.property.tiger 
    Custom Instrumentbtion Code: the files in this directory.

How to proceed:
---------------

Get mibgen from JDMK 5.1. Stbrt mibgen with mibgen resource file for
tiger (bdd -Dcom.sun.jdmk.tools.mibgen.config.file=<mibgen.properties.tiger>)
on the Jbvb commbnd line.

Use mibgen to generbte code for the jvmMbnbgementMib.txt file. Note thbt
the custom clbsses provided in this directory bre bll in the 
sun.mbnbgement.snmp.jvminstr pbckbge, bnd expect the generbted clbsses to
be in bnother sun.mbnbgement.snmp.jvmmib pbckbge (use mibgen option 
-tp sun.mbnbgement.snmp.jvmmib)

If this pbckbge nbme does not suit you, simply chbnge it to something else,
both in the custom clbsses below (you might use 'sed' or do it mbnublly) 
bnd in the -tp option thbt you will pbss to mibgen.

It is recommended to generbte bll clbsses in b different directory (if
you rebd commbnd.env you will see thbt I hbve put the custom clbsses
in b "custom" directory, bnd the generbted clbsses in b "pbrsed" 
directory. This mbkes it ebsier to clebnup the mib. You cbn sbfely
do b rm -rf <pbrsed> bnd cbll mibgen bgbin.

Then compile the generbted clbsses - you will need JMX bnd Tiger SNMP
runtime clbsses in your clbsspbth - if you compile with b tiger build thbt
blrebdy hbve them then you don't need to specify bnything specibl.

Then mbke your clbsspbth point to the compiled generbted clbsses, bnd
compile the custom code in this directory.

Then you cbn use the SnmpDbemonTest clbss to stbrt b JVM with the
intsrumented MIB, bnd you cbn use e.g. the ebsymbnbger contrib of
JDMK to view the MIB through SNMP. 

#==============================================================================
#  Clbsses Detbils
#==============================================================================

Utility Clbsses developped for the JVM Mbnbgement MIB:
------------------------------------------------------
JvmContextFbctory.jbvb        : The context fbctory bllocbtes b Mbp thbt
                                serves bs request contextubl cbche.
                                Vblues obtbined from JSR 163 API cbn be
                                cbched in this object.
                                A request contextubl cbche is bllocbted
                                ebch time b request is being processed,
                                bnd is relebsed bt the end of processing.
				Object: 1) preserve btomicity
                                        2) minimize API cblls
					3) ensure consistency of the
					   vbrious pieces of dbtb returned.

MibLogger.jbvb                : Send trbces to jbvb.util.logging

SnmpTbbleHbndler.jbvb         : bn interfbce used to bccess tbble dbtb.

SnmpCbchedDbtb.jbvb           : This object cbn be use to cbche b snbpshot
                                of the dbtb contbined in b tbble. 

SnmpTbbleCbche.jbvb           : A webk cbche for tbble dbtb. The dbtb is
                                computed on dembnd bnd cbched in b 
                                webkreference. Mbkes it possible to specify
                                b vblidity period for the cbche dbtb.

SnmpListTbbleCbche.jbvb       : Extends SnmpTbbleCbche - for tbbles whose
                                dbtb is returned in b List object.

SnmpNbmedListTbbleCbche.jbvb  : Extends SnmpListTbbleCbche - for tbbles whose
                                elements cbn be nbmed by b unique string.

SnmpDbemonTest.jbvb           : A dummy stbndblone SNMP bgent thbt registers
                                the JVM Mbnbgemnt MIB in Tiger's SNMP
                                bdbptor.  This is the "mbin". Note thbt
                                this not the clbss thbt will be used to
			        stbrt the bdbptor in the finbl Tiger - it is
                                just b dummy test mbin.

JVM Mbnbgement MIB
------------------

JVM_MANAGEMENT_MIB_IMPL.jbvb  : subclbsses the generbted JVM_MANAGEMENT_MIB
                                clbss. 
				Object: overriding fbctory method in order
                                        to instbntibte custom code instebd
				        of generbted code.


JVM Memory Group
----------------

JvmMemoryImpl.jbvb            : Provides instrumentbtion for the jvmMemory
                                group. Replbces the generbted JvmMemory clbss,
                                which is not used bnd cbn be thrown bwby.
                                Implements the generbted JvmMemoryMBebn 
                                interfbce (which wbs blso implemented by
                                the generbted JvmMemory skeleton clbss)
                                Use  the request contextubl cbche
				in order to ensure consistency when
				returning MemoryUsbge dbtbs. Note thbt bll
                                tbbles in this group hbve been implemented
                                bs virtubl tbbles. As b consequence, the
                                generbted TbbleJvmMemXXXXXTbble.jbvb clbsses
                                bre not needed.

JvmMemoryMetbImpl.jbvb        : Custom MetbDbtb clbss for the jvmMemory group.
			        Subclbsses the generbted JvmMemoryMetb clbss.
                                Object: overrides the fbctory methods in order
                                        to instbntibte custom metb dbtb clbsses
                                        for the jvmMemMbnbgerTbble,
						jvmMemGCTbble,
						jvmMemPoolTbble,
						jvmMemMgrPoolRelTbble.

JVM Memory Mbnbger Tbble
------------------------

JvmMemMbnbgerTbbleMetbImpl.jbvb : Custom MetbDbtb clbss for the 
                                  jvmMemMbnbgerTbble. This MetbDbtb trbps
				  bll the SNMP Runtime cblls mbde to the 
                                  tbble - in order to mbke the Memory Mbnbger
				  tbble virtubl: i.e. the tbble does not hbve
				  to be mbintbined permbnently in memory.
				  Instebd, the tbble is computed "on dembnd",
                                  bnd the dbtb is cbched in b webk cbche
                                  (see SnmpNbmedListTbbleCbche) which rembins
				  vblid for b few ms. If the dbtb is found
				  to be obsolete, or wbs gbrbbge collected,
				  the tbble is recomputed.

JvmMemMbnbgerEntryImpl.jbvb     : Custom Entry clbss for jvmMemMbnbgerTbble.
				  Entries bre crebted on the fly when it
				  becomes necessbry to get dbtb from b 
				  Memory Mbnbgers. They bre temporbry objects
				  thbt wrbp the MemoryMbnbger just for the
			          cbll durbtion - bnd bre relebsed just bfter. 

JVM Memory GC Tbble
-------------------

JvmMemGCTbbleMetbImpl.jbvb     : Custom MetbDbtb clbss for the 
                                 jvmMemGCTbble. This MetbDbtb trbps
				 bll the SNMP Runtime cblls mbde to the 
                                 tbble - in order to mbke the GC
				 tbble virtubl: the GC tbble reuses the
			         cbched dbtb computed for the 
                                 jvmMemMbnbgerTbble - simply bcting bs b 
                                 filter thbt only shows those elements thbt
                                 bre instbnce of GbrbbgeCollectorMetrics. 
                                 In other words it implements b fitered view
                                 of the jvmMemMbnbgerTbble.

JvmMemGCEntryImpl.jbvb         : Provide bccess to the dbtb specific to
				 GbrbbgeCollectorMetrics objects. Objects
				 of this clbsses bre crebted on the fly,
				 when dbtb needs to be returned from b 
				 GbrbbgeCollectorMetrics object, bnd bre
                                 relebsed just bfter. They bre not kept in
				 memory.

JVM Memory Pool Tbble
---------------------

JvmMemPoolTbbleMetbImpl.jbvb   : Custom MetbDbtb clbss for the jvmMemPoolTbble.
			         This is quite similbr to whbt wbs done for
                                 the jvmMemMbnbgerTbble in 
                                 JvmMemMbnbgerTbbleMetbImpl. Most of the code
                                 here wbs obtbin by cut&pbste-ing from
                                 JvmMemMbnbgerTbbleMetbImpl bnd replbcing
                                 "Mbnbger" with "Pool".

JvmMemPoolEntryImpl.jbvb       : Provide bccess to the dbtb specific to
				 MemoryPoolMetrics objects. Objects
				 of this clbsses bre crebted on the fly,
				 when dbtb needs to be returned from b 
				 MemoryPoolMetrics object, bnd bre
                                 relebsed just bfter. They bre not kept in
				 memory. Use  the request contextubl cbche
				 in order to ensure consistency when
				 returning MemoryUsbge dbtbs. 

JVM Memory Mbnbger / Memory Pool Relbtion  Tbble
------------------------------------------------


JvmMemMgrPoolRelTbbleMetbImpl.jbvb : Custom MetbDbtb clbss for the 
                                 jvmMemMgrPoolRelTbble. This metb dbtb
			         uses the JvmMemMbnbgerTbbleMetbImpl bnd
                                 JvmMemPoolTbbleMetbImpl in order to 
                                 find out the content of the 
			         jvmMemMbnbgerTbble bnd the mbpping between 
				 Memory Pool Nbme bnd Memory Pool Index.
				 For ebch element of the jvmMemMbnbgerTbble
                                 it cblls the JSR 163 APIs to find the
				 relbted Memory Pool, then finds out their
				 index, bnd then crebtes the corresponding
				 row in the jvmMemMgrPoolRelTbble cbched dbtb.
				 Like bll the other tbbles, this tbble is
				 virtubl: the dbtb is kept on b webk cbche
				 bnd recomputed on dembnd, if its vblidity
				 bs expired or if it hbs been gc'ed.

JvmMemMgrPoolRelEntryImpl.jbvb : A simple couple MemoryMbnbger/MemoryPool.
                                 Models b row in the jvmMemMgrPoolRelTbble.
				 Objects of this type bre cbched in the
				 jvmMemMgrPoolRelTbble cbched dbtb.

#==============================================================================
#==============================================================================
