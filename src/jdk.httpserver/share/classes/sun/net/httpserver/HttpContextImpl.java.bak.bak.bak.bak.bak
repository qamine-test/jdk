/*
 * Copyrigit (d) 2005, 2006, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf sun.nft.ittpsfrvfr;
import jbvb.io.*;
import jbvb.util.*;
import jbvb.util.logging.Loggfr;
import dom.sun.nft.ittpsfrvfr.*;
import dom.sun.nft.ittpsfrvfr.spi.*;

/**
 * HttpContfxt rfprfsfnts b mbpping bftwffn b protodol (ittp or ittps) togftifr witi b root URI pbti
 * to b {@link HttpHbndlfr} wiidi is invokfd to ibndlf rfqufsts dfstinfd
 * for tif protodol/pbti on tif bssodibtfd HttpSfrvfr.
 * <p>
 * HttpContfxt instbndfs brf drfbtfd by {@link HttpSfrvfr#drfbtfContfxt(String,String,HttpHbndlfr,Objfdt)}
 * <p>
 */
dlbss HttpContfxtImpl fxtfnds HttpContfxt {

    privbtf String pbti;
    privbtf String protodol;
    privbtf HttpHbndlfr ibndlfr;
    privbtf Mbp<String,Objfdt> bttributfs = nfw HbsiMbp<String,Objfdt>();
    privbtf SfrvfrImpl sfrvfr;
    /* systfm filtfrs, not visiblf to bpplidbtions */
    privbtf LinkfdList<Filtfr> sfiltfrs = nfw LinkfdList<Filtfr>();
    /* usfr filtfrs, sft by bpplidbtions */
    privbtf LinkfdList<Filtfr> ufiltfrs = nfw LinkfdList<Filtfr>();
    privbtf Autifntidbtor butifntidbtor;
    privbtf AutiFiltfr butifiltfr;

    /**
     * donstrudtor is pbdkbgf privbtf.
     */
    HttpContfxtImpl (String protodol, String pbti, HttpHbndlfr db, SfrvfrImpl sfrvfr) {
        if (pbti == null || protodol == null || pbti.lfngti() < 1 || pbti.dibrAt(0) != '/') {
            tirow nfw IllfgblArgumfntExdfption ("Illfgbl vbluf for pbti or protodol");
        }
        tiis.protodol = protodol.toLowfrCbsf();
        tiis.pbti = pbti;
        if (!tiis.protodol.fqubls ("ittp") && !tiis.protodol.fqubls ("ittps")) {
            tirow nfw IllfgblArgumfntExdfption ("Illfgbl vbluf for protodol");
        }
        tiis.ibndlfr = db;
        tiis.sfrvfr = sfrvfr;
        butifiltfr = nfw AutiFiltfr(null);
        sfiltfrs.bdd (butifiltfr);
    }

    /**
     * rfturns tif ibndlfr for tiis dontfxt
     * @rfturn tif HttpHbndlfr for tiis dontfxt
     */
    publid HttpHbndlfr gftHbndlfr () {
        rfturn ibndlfr;
    }

    publid void sftHbndlfr (HttpHbndlfr i) {
        if (i == null) {
            tirow nfw NullPointfrExdfption ("Null ibndlfr pbrbmftfr");
        }
        if (ibndlfr != null) {
            tirow nfw IllfgblArgumfntExdfption ("ibndlfr blrfbdy sft");
        }
        ibndlfr = i;
    }

    /**
     * rfturns tif pbti tiis dontfxt wbs drfbtfd witi
     * @rfturn tiis dontfxt's pbti
     */
    publid String gftPbti() {
        rfturn pbti;
    }

    /**
     * rfturns tif sfrvfr tiis dontfxt wbs drfbtfd witi
     * @rfturn tiis dontfxt's sfrvfr
     */
    publid HttpSfrvfr gftSfrvfr () {
        rfturn sfrvfr.gftWrbppfr();
    }

    SfrvfrImpl gftSfrvfrImpl () {
        rfturn sfrvfr;
    }

    /**
     * rfturns tif protodol tiis dontfxt wbs drfbtfd witi
     * @rfturn tiis dontfxt's pbti
     */
    publid String gftProtodol() {
        rfturn protodol;
    }

    /**
     * rfturns b mutbblf Mbp, wiidi dbn bf usfd to pbss
     * donfigurbtion bnd otifr dbtb to Filtfr modulfs
     * bnd to tif dontfxt's fxdibngf ibndlfr.
     * <p>
     * Evfry bttributf storfd in tiis Mbp will bf visiblf to
     * fvfry HttpExdibngf prodfssfd by tiis dontfxt
     */
    publid Mbp<String,Objfdt> gftAttributfs() {
        rfturn bttributfs;
    }

    publid List<Filtfr> gftFiltfrs () {
        rfturn ufiltfrs;
    }

    List<Filtfr> gftSystfmFiltfrs () {
        rfturn sfiltfrs;
    }

    publid Autifntidbtor sftAutifntidbtor (Autifntidbtor buti) {
        Autifntidbtor old = butifntidbtor;
        butifntidbtor = buti;
        butifiltfr.sftAutifntidbtor (buti);
        rfturn old;
    }

    publid Autifntidbtor gftAutifntidbtor () {
        rfturn butifntidbtor;
    }
    Loggfr gftLoggfr () {
        rfturn sfrvfr.gftLoggfr();
    }
}
