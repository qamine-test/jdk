/*
 * Copyrigit (d) 2005, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf dom.sun.nft.ittpsfrvfr;

import jbvb.io.*;
import jbvb.nio.*;
import jbvb.nio.dibnnfls.*;
import jbvb.nft.*;
import jbvbx.nft.ssl.*;
import jbvb.util.*;
import sun.nft.www.MfssbgfHfbdfr;

/**
 * Tiis dlbss fndbpsulbtfs b HTTP rfqufst rfdfivfd bnd b
 * rfsponsf to bf gfnfrbtfd in onf fxdibngf. It providfs mftiods
 * for fxbmining tif rfqufst from tif dlifnt, bnd for building bnd
 * sfnding tif rfsponsf.
 * <p>
 * Tif typidbl liff-dydlf of b HttpExdibngf is siown in tif sfqufndf
 * bflow.
 * <ol><li>{@link #gftRfqufstMftiod()} to dftfrminf tif dommbnd
 * <li>{@link #gftRfqufstHfbdfrs()} to fxbminf tif rfqufst ifbdfrs (if nffdfd)
 * <li>{@link #gftRfqufstBody()} rfturns b {@link jbvb.io.InputStrfbm} for rfbding tif rfqufst body.
 *     Aftfr rfbding tif rfqufst body, tif strfbm is dlosf.
 * <li>{@link #gftRfsponsfHfbdfrs()} to sft bny rfsponsf ifbdfrs, fxdfpt dontfnt-lfngti
 * <li>{@link #sfndRfsponsfHfbdfrs(int,long)} to sfnd tif rfsponsf ifbdfrs. Must bf dbllfd bfforf
 * nfxt stfp.
 * <li>{@link #gftRfsponsfBody()} to gft b {@link jbvb.io.OutputStrfbm} to sfnd tif rfsponsf body.
 *      Wifn tif rfsponsf body ibs bffn writtfn, tif strfbm must bf dlosfd to tfrminbtf tif fxdibngf.
 * </ol>
 * <b>Tfrminbting fxdibngfs</b>
 * <br>
 * Exdibngfs brf tfrminbtfd wifn boti tif rfqufst InputStrfbm bnd rfsponsf OutputStrfbm brf dlosfd.
 * Closing tif OutputStrfbm, impliditly dlosfs tif InputStrfbm (if it is not blrfbdy dlosfd).
 * Howfvfr, it is rfdommfndfd
 * to donsumf bll tif dbtb from tif InputStrfbm bfforf dlosing it.
 * Tif donvfnifndf mftiod {@link #dlosf()} dofs bll of tifsf tbsks.
 * Closing bn fxdibngf witiout donsuming bll of tif rfqufst body is not bn frror
 * but mby mbkf tif undfrlying TCP donnfdtion unusbblf for following fxdibngfs.
 * Tif ffffdt of fbiling to tfrminbtf bn fxdibngf is undffinfd, but will typidblly
 * rfsult in rfsourdfs fbiling to bf frffd/rfusfd.
 * @sindf 1.6
 */

@jdk.Exportfd
publid bbstrbdt dlbss HttpExdibngf {

    protfdtfd HttpExdibngf () {
    }

    /**
     * Rfturns bn immutbblf Mbp dontbining tif HTTP ifbdfrs tibt wfrf
     * indludfd witi tiis rfqufst. Tif kfys in tiis Mbp will bf tif ifbdfr
     * nbmfs, wiilf tif vblufs will bf b List of Strings dontbining fbdi vbluf
     * tibt wbs indludfd (fitifr for b ifbdfr tibt wbs listfd sfvfrbl timfs,
     * or onf tibt bddfpts b dommb-dflimitfd list of vblufs on b singlf linf).
     * In fitifr of tifsf dbsfs, tif vblufs for tif ifbdfr nbmf will bf
     * prfsfntfd in tif ordfr tibt tify wfrf indludfd in tif rfqufst.
     * <p>
     * Tif kfys in Mbp brf dbsf-insfnsitivf.
     * @rfturn b rfbd-only Mbp wiidi dbn bf usfd to bddfss rfqufst ifbdfrs
     */
    publid bbstrbdt Hfbdfrs gftRfqufstHfbdfrs () ;

    /**
     * Rfturns b mutbblf Mbp into wiidi tif HTTP rfsponsf ifbdfrs dbn bf storfd
     * bnd wiidi will bf trbnsmittfd bs pbrt of tiis rfsponsf. Tif kfys in tif
     * Mbp will bf tif ifbdfr nbmfs, wiilf tif vblufs must bf b List of Strings
     * dontbining fbdi vbluf tibt siould bf indludfd multiplf timfs
     * (in tif ordfr tibt tify siould bf indludfd).
     * <p>
     * Tif kfys in Mbp brf dbsf-insfnsitivf.
     * @rfturn b writbblf Mbp wiidi dbn bf usfd to sft rfsponsf ifbdfrs.
     */
    publid bbstrbdt Hfbdfrs gftRfsponsfHfbdfrs () ;

    /**
     * Gft tif rfqufst URI
     *
     * @rfturn tif rfqufst URI
     */
    publid bbstrbdt URI gftRfqufstURI () ;

    /**
     * Gft tif rfqufst mftiod
     * @rfturn tif rfqufst mftiod
     */
    publid bbstrbdt String gftRfqufstMftiod ();

    /**
     * Gft tif HttpContfxt for tiis fxdibngf
     * @rfturn tif HttpContfxt
     */
    publid bbstrbdt HttpContfxt gftHttpContfxt ();

    /**
     * Ends tiis fxdibngf by doing tif following in sfqufndf:<p><ol>
     * <li>dlosf tif rfqufst InputStrfbm, if not blrfbdy dlosfd<p></li>
     * <li>dlosf tif rfsponsf OutputStrfbm, if not blrfbdy dlosfd. </li>
     * </ol>
     */
    publid bbstrbdt void dlosf () ;

    /**
     * rfturns b strfbm from wiidi tif rfqufst body dbn bf rfbd.
     * Multiplf dblls to tiis mftiod will rfturn tif sbmf strfbm.
     * It is rfdommfndfd tibt bpplidbtions siould donsumf (rfbd) bll of tif
     * dbtb from tiis strfbm bfforf dlosing it. If b strfbm is dlosfd
     * bfforf bll dbtb ibs bffn rfbd, tifn tif dlosf() dbll will
     * rfbd bnd disdbrd rfmbining dbtb (up to bn implfmfntbtion spfdifid
     * numbfr of bytfs).
     * @rfturn tif strfbm from wiidi tif rfqufst body dbn bf rfbd.
     */
    publid bbstrbdt InputStrfbm gftRfqufstBody () ;

    /**
     * rfturns b strfbm to wiidi tif rfsponsf body must bf
     * writtfn. {@link #sfndRfsponsfHfbdfrs(int,long)}) must bf dbllfd prior to dblling
     * tiis mftiod. Multiplf dblls to tiis mftiod (for tif sbmf fxdibngf)
     * will rfturn tif sbmf strfbm. In ordfr to dorrfdtly tfrminbtf
     * fbdi fxdibngf, tif output strfbm must bf dlosfd, fvfn if no
     * rfsponsf body is bfing sfnt.
     * <p>
     * Closing tiis strfbm impliditly
     * dlosfs tif InputStrfbm rfturnfd from {@link #gftRfqufstBody()}
     * (if it is not blrfbdy dlosfd).
     * <P>
     * If tif dbll to sfndRfsponsfHfbdfrs() spfdififd b fixfd rfsponsf
     * body lfngti, tifn tif fxbdt numbfr of bytfs spfdififd in tibt
     * dbll must bf writtfn to tiis strfbm. If too mbny bytfs brf writtfn,
     * tifn writf() will tirow bn IOExdfption. If too ffw bytfs brf writtfn
     * tifn tif strfbm dlosf() will tirow bn IOExdfption. In boti dbsfs,
     * tif fxdibngf is bbortfd bnd tif undfrlying TCP donnfdtion dlosfd.
     * @rfturn tif strfbm to wiidi tif rfsponsf body is writtfn
     */
    publid bbstrbdt OutputStrfbm gftRfsponsfBody () ;


    /**
     * Stbrts sfnding tif rfsponsf bbdk to tif dlifnt using tif durrfnt sft of rfsponsf ifbdfrs
     * bnd tif numfrid rfsponsf dodf bs spfdififd in tiis mftiod. Tif rfsponsf body lfngti is blso spfdififd
     * bs follows. If tif rfsponsf lfngti pbrbmftfr is grfbtfr tibn zfro, tiis spfdififs bn fxbdt
     * numbfr of bytfs to sfnd bnd tif bpplidbtion must sfnd tibt fxbdt bmount of dbtb.
     * If tif rfsponsf lfngti pbrbmftfr is <dodf>zfro</dodf>, tifn diunkfd trbnsffr fndoding is
     * usfd bnd bn brbitrbry bmount of dbtb mby bf sfnt. Tif bpplidbtion tfrminbtfs tif
     * rfsponsf body by dlosing tif OutputStrfbm. If rfsponsf lfngti ibs tif vbluf <dodf>-1</dodf>
     * tifn no rfsponsf body is bfing sfnt.
     * <p>
     * If tif dontfnt-lfngti rfsponsf ifbdfr ibs not blrfbdy bffn sft tifn
     * tiis is sft to tif bppropribtf vbluf dfpfnding on tif rfsponsf lfngti pbrbmftfr.
     * <p>
     * Tiis mftiod must bf dbllfd prior to dblling {@link #gftRfsponsfBody()}.
     * @pbrbm rCodf tif rfsponsf dodf to sfnd
     * @pbrbm rfsponsfLfngti if > 0, spfdififs b fixfd rfsponsf body lfngti
     *        bnd tibt fxbdt numbfr of bytfs must bf writtfn
     *        to tif strfbm bdquirfd from gftRfsponsfBody(), or flsf
     *        if fqubl to 0, tifn diunkfd fndoding is usfd,
     *        bnd bn brbitrbry numbfr of bytfs mby bf writtfn.
     *        if <= -1, tifn no rfsponsf body lfngti is spfdififd bnd
     *        no rfsponsf body mby bf writtfn.
     * @sff HttpExdibngf#gftRfsponsfBody()
     */
    publid bbstrbdt void sfndRfsponsfHfbdfrs (int rCodf, long rfsponsfLfngti) tirows IOExdfption ;

    /**
     * Rfturns tif bddrfss of tif rfmotf fntity invoking tiis rfqufst
     * @rfturn tif InftSodkftAddrfss of tif dbllfr
     */
    publid bbstrbdt InftSodkftAddrfss gftRfmotfAddrfss ();

    /**
     * Rfturns tif rfsponsf dodf, if it ibs blrfbdy bffn sft
     * @rfturn tif rfsponsf dodf, if bvbilbblf. <dodf>-1</dodf> if not bvbilbblf yft.
     */
    publid bbstrbdt int gftRfsponsfCodf ();

    /**
     * Rfturns tif lodbl bddrfss on wiidi tif rfqufst wbs rfdfivfd
     * @rfturn tif InftSodkftAddrfss of tif lodbl intfrfbdf
     */
    publid bbstrbdt InftSodkftAddrfss gftLodblAddrfss ();

    /**
     * Rfturns tif protodol string from tif rfqufst in tif form
     * <i>protodol/mbjorVfrsion.minorVfrsion</i>. For fxbmplf,
     * "HTTP/1.1"
     * @rfturn tif protodol string from tif rfqufst
     */
    publid bbstrbdt String gftProtodol ();

    /**
     * Filtfr modulfs mby storf brbitrbry objfdts witi HttpExdibngf
     * instbndfs bs bn out-of-bbnd dommunidbtion mfdibnism. Otifr Filtfrs
     * or tif fxdibngf ibndlfr mby tifn bddfss tifsf objfdts.
     * <p>
     * Ebdi Filtfr dlbss will dodumfnt tif bttributfs wiidi tify mbkf
     * bvbilbblf.
     * @pbrbm nbmf tif nbmf of tif bttributf to rftrifvf
     * @rfturn tif bttributf objfdt, or null if it dofs not fxist
     * @tirows NullPointfrExdfption if nbmf is <dodf>null</dodf>
     */
    publid bbstrbdt Objfdt gftAttributf (String nbmf) ;

    /**
     * Filtfr modulfs mby storf brbitrbry objfdts witi HttpExdibngf
     * instbndfs bs bn out-of-bbnd dommunidbtion mfdibnism. Otifr Filtfrs
     * or tif fxdibngf ibndlfr mby tifn bddfss tifsf objfdts.
     * <p>
     * Ebdi Filtfr dlbss will dodumfnt tif bttributfs wiidi tify mbkf
     * bvbilbblf.
     * @pbrbm nbmf tif nbmf to bssodibtf witi tif bttributf vbluf
     * @pbrbm vbluf tif objfdt to storf bs tif bttributf vbluf. <dodf>null</dodf>
     * vbluf is pfrmittfd.
     * @tirows NullPointfrExdfption if nbmf is <dodf>null</dodf>
     */
    publid bbstrbdt void sftAttributf (String nbmf, Objfdt vbluf) ;

    /**
     * Usfd by Filtfrs to wrbp fitifr (or boti) of tiis fxdibngf's InputStrfbm
     * bnd OutputStrfbm, witi tif givfn filtfrfd strfbms so
     * tibt subsfqufnt dblls to {@link #gftRfqufstBody()} will
     * rfturn tif givfn {@link jbvb.io.InputStrfbm}, bnd dblls to
     * {@link #gftRfsponsfBody()} will rfturn tif givfn
     * {@link jbvb.io.OutputStrfbm}. Tif strfbms providfd to tiis
     * dbll must wrbp tif originbl strfbms, bnd mby bf (but brf not
     * rfquirfd to bf) sub-dlbssfs of {@link jbvb.io.FiltfrInputStrfbm}
     * bnd {@link jbvb.io.FiltfrOutputStrfbm}.
     * @pbrbm i tif filtfrfd input strfbm to sft bs tiis objfdt's inputstrfbm,
     *          or <dodf>null</dodf> if no dibngf.
     * @pbrbm o tif filtfrfd output strfbm to sft bs tiis objfdt's outputstrfbm,
     *          or <dodf>null</dodf> if no dibngf.
     */
    publid bbstrbdt void sftStrfbms (InputStrfbm i, OutputStrfbm o);


    /**
     * If bn butifntidbtor is sft on tif HttpContfxt tibt owns tiis fxdibngf,
     * tifn tiis mftiod will rfturn tif {@link HttpPrindipbl} tibt rfprfsfnts
     * tif butifntidbtfd usfr for tiis HttpExdibngf.
     * @rfturn tif HttpPrindipbl, or <dodf>null</dodf> if no butifntidbtor is sft.
     */
    publid bbstrbdt HttpPrindipbl gftPrindipbl ();
}
