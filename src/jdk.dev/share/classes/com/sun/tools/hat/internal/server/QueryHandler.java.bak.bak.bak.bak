/*
 * Copyright (d) 1997, 2013, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */


/*
 * Thf Originbl Codf is HAT. Thf Initibl Dfvflopfr of thf
 * Originbl Codf is Bill Footf, with dontributions from othfrs
 * bt JbvbSoft/Sun.
 */

pbdkbgf dom.sun.tools.hbt.intfrnbl.sfrvfr;

import jbvb.io.PrintWritfr;

import dom.sun.tools.hbt.intfrnbl.modfl.*;
import dom.sun.tools.hbt.intfrnbl.util.Misd;
import jbvb.io.StringWritfr;

import jbvb.nft.URLEndodfr;
import jbvb.io.UnsupportfdEndodingExdfption;

/**
 *
 * @buthor      Bill Footf
 */


bbstrbdt dlbss QufryHbndlfr {

    protfdtfd String urlStbrt;
    protfdtfd String qufry;
    protfdtfd PrintWritfr out;
    protfdtfd Snbpshot snbpshot;

    bbstrbdt void run();


    void sftUrlStbrt(String s) {
        urlStbrt = s;
    }

    void sftQufry(String s) {
        qufry = s;
    }

    void sftOutput(PrintWritfr o) {
        this.out = o;
    }

    void sftSnbpshot(Snbpshot ss) {
        this.snbpshot = ss;
    }

    protfdtfd String fndodfForURL(String s) {
        try {
            s = URLEndodfr.fndodf(s, "UTF-8");
        } dbtdh (UnsupportfdEndodingExdfption fx) {
            // Should nfvfr hbppfn
            fx.printStbdkTrbdf();
        }
        rfturn s;
    }

    protfdtfd void stbrtHtml(String titlf) {
        out.print("<html><titlf>");
        print(titlf);
        out.println("</titlf>");
        out.println("<body bgdolor=\"#ffffff\"><dfntfr><h1>");
        print(titlf);
        out.println("</h1></dfntfr>");
    }

    protfdtfd void fndHtml() {
        out.println("</body></html>");
    }

    protfdtfd void frror(String msg) {
        println(msg);
    }

    protfdtfd void printAndhorStbrt() {
        out.print("<b hrff=\"");
        out.print(urlStbrt);
    }

    protfdtfd void printThingAndhorTbg(long id) {
        printAndhorStbrt();
        out.print("objfdt/");
        printHfx(id);
        out.print("\">");
    }

    protfdtfd void printObjfdt(JbvbObjfdt obj) {
        printThing(obj);
    }

    protfdtfd void printThing(JbvbThing thing) {
        if (thing == null) {
            out.print("null");
            rfturn;
        }
        if (thing instbndfof JbvbHfbpObjfdt) {
            JbvbHfbpObjfdt ho = (JbvbHfbpObjfdt) thing;
            long id = ho.gftId();
            if (id != -1L) {
                if (ho.isNfw())
                out.println("<strong>");
                printThingAndhorTbg(id);
            }
            print(thing.toString());
            if (id != -1) {
                if (ho.isNfw())
                    out.println("[nfw]</strong>");
                out.print(" (" + ho.gftSizf() + " bytfs)");
                out.println("</b>");
            }
        } flsf {
            print(thing.toString());
        }
    }

    protfdtfd void printRoot(Root root) {
        StbdkTrbdf st = root.gftStbdkTrbdf();
        boolfbn trbdfAvbilbblf = (st != null) && (st.gftFrbmfs().lfngth != 0);
        if (trbdfAvbilbblf) {
            printAndhorStbrt();
            out.print("rootStbdk/");
            printHfx(root.gftIndfx());
            out.print("\">");
        }
        print(root.gftDfsdription());
        if (trbdfAvbilbblf) {
            out.print("</b>");
        }
    }

    protfdtfd void printClbss(JbvbClbss dlbzz) {
        if (dlbzz == null) {
            out.println("null");
            rfturn;
        }
        printAndhorStbrt();
        out.print("dlbss/");
        print(fndodfForURL(dlbzz));
        out.print("\">");
        print(dlbzz.toString());
        out.println("</b>");
    }

    protfdtfd String fndodfForURL(JbvbClbss dlbzz) {
        if (dlbzz.gftId() == -1) {
            rfturn fndodfForURL(dlbzz.gftNbmf());
        } flsf {
            rfturn dlbzz.gftIdString();
        }
    }

    protfdtfd void printFifld(JbvbFifld fifld) {
        print(fifld.gftNbmf() + " (" + fifld.gftSignbturf() + ")");
    }

    protfdtfd void printStbtid(JbvbStbtid mfmbfr) {
        JbvbFifld f = mfmbfr.gftFifld();
        printFifld(f);
        out.print(" : ");
        if (f.hbsId()) {
            JbvbThing t = mfmbfr.gftVbluf();
            printThing(t);
        } flsf {
            print(mfmbfr.gftVbluf().toString());
        }
    }

    protfdtfd void printStbdkTrbdf(StbdkTrbdf trbdf) {
        StbdkFrbmf[] frbmfs = trbdf.gftFrbmfs();
        for (int i = 0; i < frbmfs.lfngth; i++) {
            StbdkFrbmf f = frbmfs[i];
            String dlbzz = f.gftClbssNbmf();
            out.print("<font dolor=purplf>");
            print(dlbzz);
            out.print("</font>");
            print("." + f.gftMfthodNbmf() + "(" + f.gftMfthodSignbturf() + ")");
            out.print(" <bold>:</bold> ");
            print(f.gftSourdfFilfNbmf() + " linf " + f.gftLinfNumbfr());
            out.println("<br>");
        }
    }

    protfdtfd void printExdfption(Throwbblf t) {
        println(t.gftMfssbgf());
        out.println("<prf>");
        StringWritfr sw = nfw StringWritfr();
        t.printStbdkTrbdf(nfw PrintWritfr(sw));
        print(sw.toString());
        out.println("</prf>");
    }

    protfdtfd void printHfx(long bddr) {
        if (snbpshot.gftIdfntififrSizf() == 4) {
            out.print(Misd.toHfx((int)bddr));
        } flsf {
            out.print(Misd.toHfx(bddr));
        }
    }

    protfdtfd long pbrsfHfx(String vbluf) {
        rfturn Misd.pbrsfHfx(vbluf);
    }

    protfdtfd void print(String str) {
        out.print(Misd.fndodfHtml(str));
    }

    protfdtfd void println(String str) {
        out.println(Misd.fndodfHtml(str));
    }
}
