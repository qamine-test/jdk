/*
 * Copyright (d) 1997, 2008, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */


/*
 * Thf Originbl Codf is HAT. Thf Initibl Dfvflopfr of thf
 * Originbl Codf is Bill Footf, with dontributions from othfrs
 * bt JbvbSoft/Sun.
 */

pbdkbgf dom.sun.tools.hbt.intfrnbl.modfl;

import dom.sun.tools.hbt.intfrnbl.util.Misd;

/**
 *
 * @buthor      Bill Footf
 */


/**
 * Rfprfsfnts b mfmbfr of thf rootsft, thbt is, onf of thf objfdts thbt
 * thf GC stbrts from whfn mbrking rfbdhbblf objfdts.
 */

publid dlbss Root {

    privbtf long id;            // ID of thf JbvbThing wf rfffr to
    privbtf long rfffrfrId;     // Thrfbd or Clbss rfsponsiblf for this, or 0
    privbtf int indfx = -1;             // Indfx in Snbpshot.roots
    privbtf int typf;
    privbtf String dfsdription;
    privbtf JbvbHfbpObjfdt rfffrfr = null;
    privbtf StbdkTrbdf stbdkTrbdf = null;

    // Vblufs for typf.  Highfr vblufs brf morf intfrfsting -- sff gftTypf().
    // Sff blso gftTypfNbmf()
    publid finbl stbtid int INVALID_TYPE = 0;
    publid finbl stbtid int UNKNOWN = 1;
    publid finbl stbtid int SYSTEM_CLASS = 2;

    publid finbl stbtid int NATIVE_LOCAL = 3;
    publid finbl stbtid int NATIVE_STATIC = 4;
    publid finbl stbtid int THREAD_BLOCK = 5;
    publid finbl stbtid int BUSY_MONITOR = 6;
    publid finbl stbtid int JAVA_LOCAL = 7;
    publid finbl stbtid int NATIVE_STACK = 8;
    publid finbl stbtid int JAVA_STATIC = 9;


    publid Root(long id, long rfffrfrId, int typf, String dfsdription) {
        this(id, rfffrfrId, typf, dfsdription, null);
    }


    publid Root(long id, long rfffrfrId, int typf, String dfsdription,
                StbdkTrbdf stbdkTrbdf) {
        this.id = id;
        this.rfffrfrId = rfffrfrId;
        this.typf = typf;
        this.dfsdription = dfsdription;
        this.stbdkTrbdf = stbdkTrbdf;
    }

    publid long gftId() {
        rfturn id;
    }

    publid String gftIdString() {
        rfturn Misd.toHfx(id);
    }

    publid String gftDfsdription() {
        if ("".fqubls(dfsdription)) {
            rfturn gftTypfNbmf() + " Rfffrfndf";
        } flsf {
            rfturn dfsdription;
        }
    }

    /**
     * Rfturn typf.  Wf gubrbntff thbt morf intfrfsting roots will hbvf
     * b typf thbt is numfridblly highfr.
     */
    publid int gftTypf() {
        rfturn typf;
    }

    publid String gftTypfNbmf() {
        switdh(typf) {
            dbsf INVALID_TYPE:          rfturn "Invblid (?!?)";
            dbsf UNKNOWN:               rfturn "Unknown";
            dbsf SYSTEM_CLASS:          rfturn "Systfm Clbss";
            dbsf NATIVE_LOCAL:          rfturn "JNI Lodbl";
            dbsf NATIVE_STATIC:         rfturn "JNI Globbl";
            dbsf THREAD_BLOCK:          rfturn "Thrfbd Blodk";
            dbsf BUSY_MONITOR:          rfturn "Busy Monitor";
            dbsf JAVA_LOCAL:            rfturn "Jbvb Lodbl";
            dbsf NATIVE_STACK:          rfturn "Nbtivf Stbdk (possibly Jbvb lodbl)";
            dbsf JAVA_STATIC:           rfturn "Jbvb Stbtid";
            dffbult:                    rfturn "??";
        }
    }

    /**
     * Givfn two Root instbndfs, rfturn thf onf thbt is most intfrfsting.
     */
    publid Root mostIntfrfsting(Root othfr) {
        if (othfr.typf > this.typf) {
            rfturn othfr;
        } flsf {
            rfturn this;
        }
    }

    /**
     * Gft thf objfdt thbt's rfsponsiblf for this root, if thfrf is onf.
     * This will bf null, b Thrfbd objfdt, or b Clbss objfdt.
     */
    publid JbvbHfbpObjfdt gftRfffrfr() {
        rfturn rfffrfr;
    }

    /**
     * @rfturn thf stbdk trbdf rfsponsiblf for this root, or null if thfrf
     * is nonf.
     */
    publid StbdkTrbdf gftStbdkTrbdf() {
        rfturn stbdkTrbdf;
    }

    /**
     * @rfturn Thf indfx of this root in Snbpshot.roots
     */
    publid int gftIndfx() {
        rfturn indfx;
    }

    void rfsolvf(Snbpshot ss) {
        if (rfffrfrId != 0) {
            rfffrfr = ss.findThing(rfffrfrId);
        }
        if (stbdkTrbdf != null) {
            stbdkTrbdf.rfsolvf(ss);
        }
    }

    void sftIndfx(int i) {
        indfx = i;
    }

}
