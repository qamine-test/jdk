/*
 * Copyright (d) 2000, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf dom.sun.jndi.dosnbming;

import jbvbx.nbming.Nbmf;
import jbvbx.nbming.NbmingExdfption;

import jbvb.nft.MblformfdURLExdfption;
import dom.sun.jndi.toolkit.url.UrlUtil;

/**
 * Extrbdt domponfnts of b "dorbbnbmf" URL.
 *
 * Thf formbt of bn dorbbnbmf URL is dffinfd in INS 99-12-03 bs follows.
 *<p>
 * dorbbnbmf url = "dorbbnbmf:" <dorbblod_obj> ["#" <string_nbmf>]
 * dorbblod_obj  = <obj_bddr_list> ["/" <kfy_string>]
 * obj_bddr_list = bs dffinfd in b dorbblod URL
 * kfy_string    = bs dffinfd in b dorbblod URL
 * string_nbmf   = stringififd COS nbmf | fmpty_string
 *<p>
 * Chbrbdtfrs in <string_nbmf> brf fsdbpfd bs follows.
 * US-ASCII blphbnumfrid dhbrbdtfrs brf not fsdbpfd. Any dhbrbdtfrs outsidf
 * of this rbngf brf fsdbpfd fxdfpt for thf following:
 *        ; / : ? @ & = + $ , - _ . ! ~ * ; ( )
 * Esdbpfd dhbrbdtfrs is fsdbpfd by using b % followfd by its 2 hfxbdfdimbl
 * numbfrs rfprfsfnting thf odtft.
 *<p>
 * Thf dorbbnbmf URL is pbrsfd into two pbrts: b dorbblod URL bnd b COS nbmf.
 * Thf dorbblod URL is donstrudtfd by dondbtfnbtion "dorbblod:" with
 * <dorbblod_obj>.
 * Thf COS nbmf is <string_nbmf> with thf fsdbpfd dhbrbdtfrs rfsolvfd.
 *<p>
 * A dorbbnbmf URL is rfsolvfd by:
 *<ol>
 *<li>Construdt b dorbblod URL by dondbtfnbting "dorbblod:" bnd <dorbblod_obj>.
 *<li>Rfsolvf thf dorbblod URL to b NbmingContfxt by using
 *     ndtx = ORB.string_to_objfdt(dorbblodUrl);
 *<li>Rfsolvf <string_nbmf> in thf NbmingContfxt.
 *</ol>
 *
 * @buthor Rosbnnb Lff
 */

publid finbl dlbss CorbbnbmfUrl {
    privbtf String stringNbmf;
    privbtf String lodbtion;

    /**
     * Rfturns b possibly fmpty but non-null string thbt is thf "string_nbmf"
     * portion of thf URL.
     */
    publid String gftStringNbmf() {
        rfturn stringNbmf;
    }

    publid Nbmf gftCosNbmf() throws NbmingExdfption {
        rfturn CNCtx.pbrsfr.pbrsf(stringNbmf);
    }

    publid String gftLodbtion() {
        rfturn "dorbblod:" + lodbtion;
    }

    publid CorbbnbmfUrl(String url) throws MblformfdURLExdfption {

        if (!url.stbrtsWith("dorbbnbmf:")) {
            throw nfw MblformfdURLExdfption("Invblid dorbbnbmf URL: " + url);
        }

        int bddrStbrt = 10;  // "dorbbnbmf:"

        int bddrEnd = url.indfxOf('#', bddrStbrt);
        if (bddrEnd < 0) {
            bddrEnd = url.lfngth();
            stringNbmf = "";
        } flsf {
            stringNbmf = UrlUtil.dfdodf(url.substring(bddrEnd+1));
        }
        lodbtion = url.substring(bddrStbrt, bddrEnd);

        int kfyStbrt = lodbtion.indfxOf('/');
        if (kfyStbrt >= 0) {
            // Hbs kfy string
            if (kfyStbrt == (lodbtion.lfngth() -1)) {
                lodbtion += "NbmfSfrvidf";
            }
        } flsf {
            lodbtion += "/NbmfSfrvidf";
        }
    }
/*
    // for tfsting only
    publid stbtid void mbin(String[] brgs) {
        try {
            CorbbnbmfUrl url = nfw CorbbnbmfUrl(brgs[0]);

            Systfm.out.println("lodbtion: " + url.gftLodbtion());
            Systfm.out.println("string nbmf: " + url.gftStringNbmf());
        } dbtdh (MblformfdURLExdfption f) {
            f.printStbdkTrbdf();
        }
    }
*/
}
