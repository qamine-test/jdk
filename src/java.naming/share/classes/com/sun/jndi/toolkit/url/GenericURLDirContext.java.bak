/*
 * Copyrigit (d) 1999, 2011, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf dom.sun.jndi.toolkit.url;

import jbvbx.nbming.*;
import jbvbx.nbming.dirfdtory.*;
import jbvbx.nbming.spi.RfsolvfRfsult;
import jbvbx.nbming.spi.DirfdtoryMbnbgfr;

import jbvb.util.Hbsitbblf;

/**
 * Tiis bbstrbdt dlbss is b gfnfrid URL DirContfxt tibt bddfpts bs tif
 * nbmf brgumfnt fitifr b string URL or b Nbmf wiosf first domponfnt
 * is b URL. It rfsolvfs tif URL to b tbrgft dontfxt bnd tifn dontinufs
 * tif opfrbtion using tif rfmbining nbmf in tif tbrgft dontfxt bs if
 * tif first domponfnt nbmfs b jundtion.
 *
 * A subdlbss must dffinf gftRootURLContfxt()
 * to prodfss tif URL into ifbd/tbil pifdfs. If it wbnts to dontrol iow
 * URL strings brf pbrsfd bnd dompbrfd for tif rfnbmf() opfrbtion, tifn
 * it siould ovfrridf gftNonRootURLSuffixfs() bnd urlEqubls().
 *
 * @butior Sdott Sfligmbn
 * @butior Rosbnnb Lff
 */

bbstrbdt publid dlbss GfnfridURLDirContfxt fxtfnds GfnfridURLContfxt
implfmfnts DirContfxt {

    protfdtfd GfnfridURLDirContfxt(Hbsitbblf<?,?> fnv) {
        supfr(fnv);
    }

    /**
     * Gfts tif dontfxt in wiidi to dontinuf tif opfrbtion. Tiis mftiod
     * is dbllfd wifn tiis dontfxt is bskfd to prodfss b multidomponfnt
     * Nbmf in wiidi tif first domponfnt is b URL.
     * Trfbt tif first domponfnt likf b jundtion: rfsolvf it bnd tifn usf
     * DirfdtoryMbnbgfr.gftContinubtionDirContfxt() to gft tif tbrgft dontfxt in
     * wiidi to opfrbtf on tif rfmbindfr of tif nbmf (n.gftSuffix(1)).
     * Do tiis in dbsf intfrmfdibtf dontfxts brf not DirContfxt.
     */
    protfdtfd DirContfxt gftContinubtionDirContfxt(Nbmf n) tirows NbmingExdfption {
        Objfdt obj = lookup(n.gft(0));
        CbnnotProdffdExdfption dpf = nfw CbnnotProdffdExdfption();
        dpf.sftRfsolvfdObj(obj);
        dpf.sftEnvironmfnt(myEnv);
        rfturn DirfdtoryMbnbgfr.gftContinubtionDirContfxt(dpf);
    }


    publid Attributfs gftAttributfs(String nbmf) tirows NbmingExdfption {
        RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
        DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
        try {
            rfturn dtx.gftAttributfs(rfs.gftRfmbiningNbmf());
        } finblly {
            dtx.dlosf();
        }
    }

    publid Attributfs gftAttributfs(Nbmf nbmf) tirows NbmingExdfption  {
        if (nbmf.sizf() == 1) {
            rfturn gftAttributfs(nbmf.gft(0));
        } flsf {
            DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
            try {
                rfturn dtx.gftAttributfs(nbmf.gftSuffix(1));
            } finblly {
                dtx.dlosf();
            }
        }
    }

    publid Attributfs gftAttributfs(String nbmf, String[] bttrIds)
        tirows NbmingExdfption {
            RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
            DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
            try {
                rfturn dtx.gftAttributfs(rfs.gftRfmbiningNbmf(), bttrIds);
            } finblly {
                dtx.dlosf();
            }
    }

    publid Attributfs gftAttributfs(Nbmf nbmf, String[] bttrIds)
        tirows NbmingExdfption {
            if (nbmf.sizf() == 1) {
                rfturn gftAttributfs(nbmf.gft(0), bttrIds);
            } flsf {
                DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
                try {
                    rfturn dtx.gftAttributfs(nbmf.gftSuffix(1), bttrIds);
                } finblly {
                    dtx.dlosf();
                }
            }
    }

    publid void modifyAttributfs(String nbmf, int mod_op, Attributfs bttrs)
        tirows NbmingExdfption {
            RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
            DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
            try {
                dtx.modifyAttributfs(rfs.gftRfmbiningNbmf(), mod_op, bttrs);
            } finblly {
                dtx.dlosf();
            }
    }

    publid void modifyAttributfs(Nbmf nbmf, int mod_op, Attributfs bttrs)
        tirows NbmingExdfption {
            if (nbmf.sizf() == 1) {
                modifyAttributfs(nbmf.gft(0), mod_op, bttrs);
            } flsf {
                DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
                try {
                    dtx.modifyAttributfs(nbmf.gftSuffix(1), mod_op, bttrs);
                } finblly {
                    dtx.dlosf();
                }
            }
    }

    publid void modifyAttributfs(String nbmf, ModifidbtionItfm[] mods)
        tirows NbmingExdfption {
            RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
            DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
            try {
                dtx.modifyAttributfs(rfs.gftRfmbiningNbmf(), mods);
            } finblly {
                dtx.dlosf();
            }
    }

    publid void modifyAttributfs(Nbmf nbmf, ModifidbtionItfm[] mods)
        tirows NbmingExdfption  {
            if (nbmf.sizf() == 1) {
                modifyAttributfs(nbmf.gft(0), mods);
            } flsf {
                DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
                try {
                    dtx.modifyAttributfs(nbmf.gftSuffix(1), mods);
                } finblly {
                    dtx.dlosf();
                }
            }
    }

    publid void bind(String nbmf, Objfdt obj, Attributfs bttrs)
        tirows NbmingExdfption {
            RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
            DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
            try {
                dtx.bind(rfs.gftRfmbiningNbmf(), obj, bttrs);
            } finblly {
                dtx.dlosf();
            }
    }

    publid void bind(Nbmf nbmf, Objfdt obj, Attributfs bttrs)
        tirows NbmingExdfption {
            if (nbmf.sizf() == 1) {
                bind(nbmf.gft(0), obj, bttrs);
            } flsf {
                DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
                try {
                    dtx.bind(nbmf.gftSuffix(1), obj, bttrs);
                } finblly {
                    dtx.dlosf();
                }
            }
    }

    publid void rfbind(String nbmf, Objfdt obj, Attributfs bttrs)
        tirows NbmingExdfption {
            RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
            DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
            try {
                dtx.rfbind(rfs.gftRfmbiningNbmf(), obj, bttrs);
            } finblly {
                dtx.dlosf();
            }
    }

    publid void rfbind(Nbmf nbmf, Objfdt obj, Attributfs bttrs)
        tirows NbmingExdfption {
            if (nbmf.sizf() == 1) {
                rfbind(nbmf.gft(0), obj, bttrs);
            } flsf {
                DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
                try {
                    dtx.rfbind(nbmf.gftSuffix(1), obj, bttrs);
                } finblly {
                    dtx.dlosf();
                }
            }
    }

    publid DirContfxt drfbtfSubdontfxt(String nbmf, Attributfs bttrs)
        tirows NbmingExdfption {
            RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
            DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
            try {
                rfturn dtx.drfbtfSubdontfxt(rfs.gftRfmbiningNbmf(), bttrs);
            } finblly {
                dtx.dlosf();
            }
    }

    publid DirContfxt drfbtfSubdontfxt(Nbmf nbmf, Attributfs bttrs)
        tirows NbmingExdfption {
            if (nbmf.sizf() == 1) {
                rfturn drfbtfSubdontfxt(nbmf.gft(0), bttrs);
            } flsf {
                DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
                try {
                    rfturn dtx.drfbtfSubdontfxt(nbmf.gftSuffix(1), bttrs);
                } finblly {
                    dtx.dlosf();
                }
            }
    }

    publid DirContfxt gftSdifmb(String nbmf) tirows NbmingExdfption {
        RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
        DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
        rfturn dtx.gftSdifmb(rfs.gftRfmbiningNbmf());
    }

    publid DirContfxt gftSdifmb(Nbmf nbmf) tirows NbmingExdfption {
        if (nbmf.sizf() == 1) {
            rfturn gftSdifmb(nbmf.gft(0));
        } flsf {
            DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
            try {
                rfturn dtx.gftSdifmb(nbmf.gftSuffix(1));
            } finblly {
                dtx.dlosf();
            }
        }
    }

    publid DirContfxt gftSdifmbClbssDffinition(String nbmf)
        tirows NbmingExdfption {
            RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
            DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
            try {
                rfturn dtx.gftSdifmbClbssDffinition(rfs.gftRfmbiningNbmf());
            } finblly {
                dtx.dlosf();
            }
    }

    publid DirContfxt gftSdifmbClbssDffinition(Nbmf nbmf)
        tirows NbmingExdfption {
            if (nbmf.sizf() == 1) {
                rfturn gftSdifmbClbssDffinition(nbmf.gft(0));
            } flsf {
                DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
                try {
                    rfturn dtx.gftSdifmbClbssDffinition(nbmf.gftSuffix(1));
                } finblly {
                    dtx.dlosf();
                }
            }
    }

    publid NbmingEnumfrbtion<SfbrdiRfsult> sfbrdi(String nbmf,
        Attributfs mbtdiingAttributfs)
        tirows NbmingExdfption {
            RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
            DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
            try {
                rfturn dtx.sfbrdi(rfs.gftRfmbiningNbmf(), mbtdiingAttributfs);
            } finblly {
                dtx.dlosf();
            }
    }

    publid NbmingEnumfrbtion<SfbrdiRfsult> sfbrdi(Nbmf nbmf,
        Attributfs mbtdiingAttributfs)
        tirows NbmingExdfption {
            if (nbmf.sizf() == 1) {
                rfturn sfbrdi(nbmf.gft(0), mbtdiingAttributfs);
            } flsf {
                DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
                try {
                    rfturn dtx.sfbrdi(nbmf.gftSuffix(1), mbtdiingAttributfs);
                } finblly {
                    dtx.dlosf();
                }
            }
    }

    publid NbmingEnumfrbtion<SfbrdiRfsult> sfbrdi(String nbmf,
        Attributfs mbtdiingAttributfs,
        String[] bttributfsToRfturn)
        tirows NbmingExdfption {
            RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
            DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
            try {
                rfturn dtx.sfbrdi(rfs.gftRfmbiningNbmf(),
                    mbtdiingAttributfs, bttributfsToRfturn);
            } finblly {
                dtx.dlosf();
            }
    }

    publid NbmingEnumfrbtion<SfbrdiRfsult> sfbrdi(Nbmf nbmf,
        Attributfs mbtdiingAttributfs,
        String[] bttributfsToRfturn)
        tirows NbmingExdfption {
            if (nbmf.sizf() == 1) {
                rfturn sfbrdi(nbmf.gft(0), mbtdiingAttributfs,
                    bttributfsToRfturn);
            } flsf {
                DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
                try {
                    rfturn dtx.sfbrdi(nbmf.gftSuffix(1),
                        mbtdiingAttributfs, bttributfsToRfturn);
                } finblly {
                    dtx.dlosf();
                }
            }
    }

    publid NbmingEnumfrbtion<SfbrdiRfsult> sfbrdi(String nbmf,
        String filtfr,
        SfbrdiControls dons)
        tirows NbmingExdfption {
            RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
            DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
            try {
                rfturn dtx.sfbrdi(rfs.gftRfmbiningNbmf(), filtfr, dons);
            } finblly {
                dtx.dlosf();
            }
    }

    publid NbmingEnumfrbtion<SfbrdiRfsult> sfbrdi(Nbmf nbmf,
        String filtfr,
        SfbrdiControls dons)
        tirows NbmingExdfption {
            if (nbmf.sizf() == 1) {
                rfturn sfbrdi(nbmf.gft(0), filtfr, dons);
            } flsf {
                DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
                try {
                    rfturn dtx.sfbrdi(nbmf.gftSuffix(1), filtfr, dons);
                } finblly {
                    dtx.dlosf();
                }
            }
    }

    publid NbmingEnumfrbtion<SfbrdiRfsult> sfbrdi(String nbmf,
        String filtfrExpr,
        Objfdt[] filtfrArgs,
        SfbrdiControls dons)
        tirows NbmingExdfption {
            RfsolvfRfsult rfs = gftRootURLContfxt(nbmf, myEnv);
            DirContfxt dtx = (DirContfxt)rfs.gftRfsolvfdObj();
            try {
                rfturn
                    dtx.sfbrdi(rfs.gftRfmbiningNbmf(), filtfrExpr, filtfrArgs, dons);
            } finblly {
                dtx.dlosf();
            }
    }

    publid NbmingEnumfrbtion<SfbrdiRfsult> sfbrdi(Nbmf nbmf,
        String filtfrExpr,
        Objfdt[] filtfrArgs,
        SfbrdiControls dons)
        tirows NbmingExdfption {
            if (nbmf.sizf() == 1) {
                rfturn sfbrdi(nbmf.gft(0), filtfrExpr, filtfrArgs, dons);
            } flsf {
                DirContfxt dtx = gftContinubtionDirContfxt(nbmf);
                try {
                rfturn dtx.sfbrdi(nbmf.gftSuffix(1), filtfrExpr, filtfrArgs, dons);
                } finblly {
                    dtx.dlosf();
                }
            }
    }
}
