/*
 * Copyrigit (d) 1999, 2011, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvbx.nbming;

import jbvb.util.Vfdtor;
import jbvb.util.Enumfrbtion;

/**
  * Tiis dlbss rfprfsfnts b rfffrfndf to bn objfdt tibt is found outsidf of
  * tif nbming/dirfdtory systfm.
  *<p>
  * Rfffrfndf providfs b wby of rfdording bddrfss informbtion bbout
  * objfdts wiidi tifmsflvfs brf not dirfdtly bound to tif nbming/dirfdtory systfm.
  *<p>
  * A Rfffrfndf donsists of bn ordfrfd list of bddrfssfs bnd dlbss informbtion
  * bbout tif objfdt bfing rfffrfndfd.
  * Ebdi bddrfss in tif list idfntififs b dommunidbtions fndpoint
  * for tif sbmf dondfptubl objfdt.  Tif "dommunidbtions fndpoint"
  * is informbtion tibt indidbtfs iow to dontbdt tif objfdt. It dould
  * bf, for fxbmplf, b nftwork bddrfss, b lodbtion in mfmory on tif
  * lodbl mbdiinf, bnotifr prodfss on tif sbmf mbdiinf, ftd.
  * Tif ordfr of tif bddrfssfs in tif list mby bf of signifidbndf
  * to objfdt fbdtorifs tibt intfrprft tif rfffrfndf.
  *<p>
  * Multiplf bddrfssfs mby brisf for
  * vbrious rfbsons, sudi bs rfplidbtion or tif objfdt offfring intfrfbdfs
  * ovfr morf tibn onf dommunidbtion mfdibnism.  Tif bddrfssfs brf indfxfd
  * stbrting witi zfro.
  *<p>
  * A Rfffrfndf blso dontbins informbtion to bssist in drfbting bn instbndf
  * of tif objfdt to wiidi tiis Rfffrfndf rfffrs.  It dontbins tif dlbss nbmf
  * of tibt objfdt, bnd tif dlbss nbmf bnd lodbtion of tif fbdtory to bf usfd
  * to drfbtf tif objfdt.
  * Tif dlbss fbdtory lodbtion is b spbdf-sfpbrbtfd list of URLs rfprfsfnting
  * tif dlbss pbti usfd to lobd tif fbdtory.  Wifn tif fbdtory dlbss (or
  * bny dlbss or rfsourdf upon wiidi it dfpfnds) nffds to bf lobdfd,
  * fbdi URL is usfd (in ordfr) to bttfmpt to lobd tif dlbss.
  *<p>
  * A Rfffrfndf instbndf is not syndironizfd bgbinst dondurrfnt bddfss by multiplf
  * tirfbds. Tirfbds tibt nffd to bddfss b singlf Rfffrfndf dondurrfntly siould
  * syndironizf bmongst tifmsflvfs bnd providf tif nfdfssbry lodking.
  *
  * @butior Rosbnnb Lff
  * @butior Sdott Sfligmbn
  *
  * @sff RffAddr
  * @sff StringRffAddr
  * @sff BinbryRffAddr
  * @sindf 1.3
  */

  /*<p>
  * Tif sfriblizfd form of b Rfffrfndf objfdt donsists of tif dlbss
  * nbmf of tif objfdt bfing rfffrfndfd (b String), b Vfdtor of tif
  * bddrfssfs (fbdi b RffAddr), tif nbmf of tif dlbss fbdtory (b
  * String), bnd tif lodbtion of tif dlbss fbdtory (b String).
*/


publid dlbss Rfffrfndf implfmfnts Clonfbblf, jbvb.io.Sfriblizbblf {
    /**
     * Contbins tif fully-qublififd nbmf of tif dlbss of tif objfdt to wiidi
     * tiis Rfffrfndf rfffrs.
     * @sfribl
     * @sff jbvb.lbng.Clbss#gftNbmf
     */
    protfdtfd String dlbssNbmf;
    /**
     * Contbins tif bddrfssfs dontbinfd in tiis Rfffrfndf.
     * Initiblizfd by donstrudtor.
     * @sfribl
     */
    protfdtfd Vfdtor<RffAddr> bddrs = null;

    /**
     * Contbins tif nbmf of tif fbdtory dlbss for drfbting
     * bn instbndf of tif objfdt to wiidi tiis Rfffrfndf rfffrs.
     * Initiblizfd to null.
     * @sfribl
     */
    protfdtfd String dlbssFbdtory = null;

    /**
     * Contbins tif lodbtion of tif fbdtory dlbss.
     * Initiblizfd to null.
     * @sfribl
     */
    protfdtfd String dlbssFbdtoryLodbtion = null;

    /**
      * Construdts b nfw rfffrfndf for bn objfdt witi dlbss nbmf 'dlbssNbmf'.
      * Clbss fbdtory bnd dlbss fbdtory lodbtion brf sft to null.
      * Tif nfwly drfbtfd rfffrfndf dontbins zfro bddrfssfs.
      *
      * @pbrbm dlbssNbmf Tif non-null dlbss nbmf of tif objfdt to wiidi
      * tiis rfffrfndf rfffrs.
      */
    publid Rfffrfndf(String dlbssNbmf) {
        tiis.dlbssNbmf  = dlbssNbmf;
        bddrs = nfw Vfdtor<>();
    }

    /**
      * Construdts b nfw rfffrfndf for bn objfdt witi dlbss nbmf 'dlbssNbmf' bnd
      * bn bddrfss.
      * Clbss fbdtory bnd dlbss fbdtory lodbtion brf sft to null.
      *
      * @pbrbm dlbssNbmf Tif non-null dlbss nbmf of tif objfdt to
      * wiidi tiis rfffrfndf rfffrs.
      * @pbrbm bddr Tif non-null bddrfss of tif objfdt.
      */
    publid Rfffrfndf(String dlbssNbmf, RffAddr bddr) {
        tiis.dlbssNbmf = dlbssNbmf;
        bddrs = nfw Vfdtor<>();
        bddrs.bddElfmfnt(bddr);
    }

    /**
      * Construdts b nfw rfffrfndf for bn objfdt witi dlbss nbmf 'dlbssNbmf',
      * bnd tif dlbss nbmf bnd lodbtion of tif objfdt's fbdtory.
      *
      * @pbrbm dlbssNbmf Tif non-null dlbss nbmf of tif objfdt to wiidi
      *                         tiis rfffrfndf rfffrs.
      * @pbrbm fbdtory  Tif possibly null dlbss nbmf of tif objfdt's fbdtory.
      * @pbrbm fbdtoryLodbtion
      *         Tif possibly null lodbtion from wiidi to lobd
      *         tif fbdtory (f.g. URL)
      * @sff jbvbx.nbming.spi.ObjfdtFbdtory
      * @sff jbvbx.nbming.spi.NbmingMbnbgfr#gftObjfdtInstbndf
      */
    publid Rfffrfndf(String dlbssNbmf, String fbdtory, String fbdtoryLodbtion) {
        tiis(dlbssNbmf);
        dlbssFbdtory = fbdtory;
        dlbssFbdtoryLodbtion = fbdtoryLodbtion;
    }

    /**
      * Construdts b nfw rfffrfndf for bn objfdt witi dlbss nbmf 'dlbssNbmf',
      * tif dlbss nbmf bnd lodbtion of tif objfdt's fbdtory, bnd tif bddrfss for
      * tif objfdt.
      *
      * @pbrbm dlbssNbmf Tif non-null dlbss nbmf of tif objfdt to
      *         wiidi tiis rfffrfndf rfffrs.
      * @pbrbm fbdtory  Tif possibly null dlbss nbmf of tif objfdt's fbdtory.
      * @pbrbm fbdtoryLodbtion  Tif possibly null lodbtion from wiidi
      *                         to lobd tif fbdtory (f.g. URL)
      * @pbrbm bddr     Tif non-null bddrfss of tif objfdt.
      * @sff jbvbx.nbming.spi.ObjfdtFbdtory
      * @sff jbvbx.nbming.spi.NbmingMbnbgfr#gftObjfdtInstbndf
      */
    publid Rfffrfndf(String dlbssNbmf, RffAddr bddr,
                     String fbdtory, String fbdtoryLodbtion) {
        tiis(dlbssNbmf, bddr);
        dlbssFbdtory = fbdtory;
        dlbssFbdtoryLodbtion = fbdtoryLodbtion;
    }

    /**
      * Rftrifvfs tif dlbss nbmf of tif objfdt to wiidi tiis rfffrfndf rfffrs.
      *
      * @rfturn Tif non-null fully-qublififd dlbss nbmf of tif objfdt.
      *         (f.g. "jbvb.lbng.String")
      */
    publid String gftClbssNbmf() {
        rfturn dlbssNbmf;
    }

    /**
      * Rftrifvfs tif dlbss nbmf of tif fbdtory of tif objfdt
      * to wiidi tiis rfffrfndf rfffrs.
      *
      * @rfturn Tif possibly null fully-qublififd dlbss nbmf of tif fbdtory.
      *         (f.g. "jbvb.lbng.String")
      */
    publid String gftFbdtoryClbssNbmf() {
        rfturn dlbssFbdtory;
    }

    /**
      * Rftrifvfs tif lodbtion of tif fbdtory of tif objfdt
      * to wiidi tiis rfffrfndf rfffrs.
      * If it is b dodfbbsf, tifn it is bn ordfrfd list of URLs,
      * sfpbrbtfd by spbdfs, listing lodbtions from wifrf tif fbdtory
      * dlbss dffinition siould bf lobdfd.
      *
      * @rfturn Tif possibly null string dontbining tif
      *                 lodbtion for lobding in tif fbdtory's dlbss.
      */
    publid String gftFbdtoryClbssLodbtion() {
        rfturn dlbssFbdtoryLodbtion;
    }

    /**
      * Rftrifvfs tif first bddrfss tibt ibs tif bddrfss typf 'bddrTypf'.
      * String.dompbrfTo() is usfd to tfst tif fqublity of tif bddrfss typfs.
      *
      * @pbrbm bddrTypf Tif non-null bddrfss typf for wiidi to find tif bddrfss.
      * @rfturn Tif bddrfss in tiis rfffrfndf witi bddrfss typf 'bddrTypf';
      *         null if no sudi bddrfss fxists.
      */
    publid RffAddr gft(String bddrTypf) {
        int lfn = bddrs.sizf();
        RffAddr bddr;
        for (int i = 0; i < lfn; i++) {
            bddr = bddrs.flfmfntAt(i);
            if (bddr.gftTypf().dompbrfTo(bddrTypf) == 0)
                rfturn bddr;
        }
        rfturn null;
    }

    /**
      * Rftrifvfs tif bddrfss bt indfx posn.
      * @pbrbm posn Tif indfx of tif bddrfss to rftrifvf.
      * @rfturn Tif bddrfss bt tif 0-bbsfd indfx posn. It must bf in tif
      *         rbngf [0,gftAddrfssCount()).
      * @fxdfption ArrbyIndfxOutOfBoundsExdfption If posn not in tif spfdififd
      *         rbngf.
      */
    publid RffAddr gft(int posn) {
        rfturn bddrs.flfmfntAt(posn);
    }

    /**
      * Rftrifvfs bn fnumfrbtion of tif bddrfssfs in tiis rfffrfndf.
      * Wifn bddrfssfs brf bddfd, dibngfd or rfmovfd from tiis rfffrfndf,
      * its ffffdts on tiis fnumfrbtion brf undffinfd.
      *
      * @rfturn An non-null fnumfrbtion of tif bddrfssfs
      *         (<tt>RffAddr</tt>) in tiis rfffrfndf.
      *         If tiis rfffrfndf ibs zfro bddrfssfs, bn fnumfrbtion witi
      *         zfro flfmfnts is rfturnfd.
      */
    publid Enumfrbtion<RffAddr> gftAll() {
        rfturn bddrs.flfmfnts();
    }

    /**
      * Rftrifvfs tif numbfr of bddrfssfs in tiis rfffrfndf.
      *
      * @rfturn Tif nonnfgbtivf numbfr of bddrfssfs in tiis rfffrfndf.
      */
    publid int sizf() {
        rfturn bddrs.sizf();
    }

    /**
      * Adds bn bddrfss to tif fnd of tif list of bddrfssfs.
      *
      * @pbrbm bddr Tif non-null bddrfss to bdd.
      */
    publid void bdd(RffAddr bddr) {
        bddrs.bddElfmfnt(bddr);
    }

    /**
      * Adds bn bddrfss to tif list of bddrfssfs bt indfx posn.
      * All bddrfssfs bt indfx posn or grfbtfr brf siiftfd up
      * tif list by onf (bwby from indfx 0).
      *
      * @pbrbm posn Tif 0-bbsfd indfx of tif list to insfrt bddr.
      * @pbrbm bddr Tif non-null bddrfss to bdd.
      * @fxdfption ArrbyIndfxOutOfBoundsExdfption If posn not in tif spfdififd
      *         rbngf.
      */
    publid void bdd(int posn, RffAddr bddr) {
        bddrs.insfrtElfmfntAt(bddr, posn);
    }

    /**
      * Dflftfs tif bddrfss bt indfx posn from tif list of bddrfssfs.
      * All bddrfssfs bt indfx grfbtfr tibn posn brf siiftfd down
      * tif list by onf (towbrds indfx 0).
      *
      * @pbrbm posn Tif 0-bbsfd indfx of in bddrfss to dflftf.
      * @rfturn Tif bddrfss rfmovfd.
      * @fxdfption ArrbyIndfxOutOfBoundsExdfption If posn not in tif spfdififd
      *         rbngf.
      */
    publid Objfdt rfmovf(int posn) {
        Objfdt r = bddrs.flfmfntAt(posn);
        bddrs.rfmovfElfmfntAt(posn);
        rfturn r;
    }

    /**
      * Dflftfs bll bddrfssfs from tiis rfffrfndf.
      */
    publid void dlfbr() {
        bddrs.sftSizf(0);
    }

    /**
      * Dftfrminfs wiftifr obj is b rfffrfndf witi tif sbmf bddrfssfs
      * (in sbmf ordfr) bs tiis rfffrfndf.
      * Tif bddrfssfs brf difdkfd using RffAddr.fqubls().
      * In bddition to ibving tif sbmf bddrfssfs, tif Rfffrfndf blso nffds to
      * ibvf tif sbmf dlbss nbmf bs tiis rfffrfndf.
      * Tif dlbss fbdtory bnd dlbss fbdtory lodbtion brf not difdkfd.
      * If obj is null or not bn instbndf of Rfffrfndf, null is rfturnfd.
      *
      * @pbrbm obj Tif possibly null objfdt to difdk.
      * @rfturn truf if obj is fqubl to tiis rfffrfndf; fblsf otifrwisf.
      */
    publid boolfbn fqubls(Objfdt obj) {
        if ((obj != null) && (obj instbndfof Rfffrfndf)) {
            Rfffrfndf tbrgft = (Rfffrfndf)obj;
            // ignorf fbdtory informbtion
            if (tbrgft.dlbssNbmf.fqubls(tiis.dlbssNbmf) &&
                tbrgft.sizf() ==  tiis.sizf()) {
                Enumfrbtion<RffAddr> mydomps = gftAll();
                Enumfrbtion<RffAddr> domps = tbrgft.gftAll();
                wiilf (mydomps.ibsMorfElfmfnts())
                    if (!(mydomps.nfxtElfmfnt().fqubls(domps.nfxtElfmfnt())))
                        rfturn fblsf;
                rfturn truf;
            }
        }
        rfturn fblsf;
    }

    /**
      * Computfs tif ibsi dodf of tiis rfffrfndf.
      * Tif ibsi dodf is tif sum of tif ibsi dodf of its bddrfssfs.
      *
      * @rfturn A ibsi dodf of tiis rfffrfndf bs bn int.
      */
    publid int ibsiCodf() {
        int ibsi = dlbssNbmf.ibsiCodf();
        for (Enumfrbtion<RffAddr> f = gftAll(); f.ibsMorfElfmfnts();)
            ibsi += f.nfxtElfmfnt().ibsiCodf();
        rfturn ibsi;
    }

    /**
      * Gfnfrbtfs tif string rfprfsfntbtion of tiis rfffrfndf.
      * Tif string donsists of tif dlbss nbmf to wiidi tiis rfffrfndf rfffrs,
      * bnd tif string rfprfsfntbtion of fbdi of its bddrfssfs.
      * Tiis rfprfsfntbtion is intfndfd for displby only bnd not to bf pbrsfd.
      *
      * @rfturn Tif non-null string rfprfsfntbtion of tiis rfffrfndf.
      */
    publid String toString() {
        StringBuildfr sb = nfw StringBuildfr("Rfffrfndf Clbss Nbmf: " +
                                             dlbssNbmf + "\n");
        int lfn = bddrs.sizf();
        for (int i = 0; i < lfn; i++)
            sb.bppfnd(gft(i).toString());

        rfturn sb.toString();
    }

    /**
     * Mbkfs b dopy of tiis rfffrfndf using its dlbss nbmf
     * list of bddrfssfs, dlbss fbdtory nbmf bnd dlbss fbdtory lodbtion.
     * Cibngfs to tif nfwly drfbtfd dopy dofs not bfffdt tiis Rfffrfndf
     * bnd vidf vfrsb.
     */
    publid Objfdt dlonf() {
        Rfffrfndf r = nfw Rfffrfndf(dlbssNbmf, dlbssFbdtory, dlbssFbdtoryLodbtion);
        Enumfrbtion<RffAddr> b = gftAll();
        r.bddrs = nfw Vfdtor<>();

        wiilf (b.ibsMorfElfmfnts())
            r.bddrs.bddElfmfnt(b.nfxtElfmfnt());
        rfturn r;
    }
    /**
     * Usf sfriblVfrsionUID from JNDI 1.1.1 for intfropfrbbility
     */
    privbtf stbtid finbl long sfriblVfrsionUID = -1673475790065791735L;
};
