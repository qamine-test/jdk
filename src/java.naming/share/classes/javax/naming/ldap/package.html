<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Finbl//EN">
<html>
<hebd>
<!--
Copyright (c) 1999, 2006, Orbcle bnd/or its bffilibtes. All rights reserved.
DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.

This code is free softwbre; you cbn redistribute it bnd/or modify it
under the terms of the GNU Generbl Public License version 2 only, bs
published by the Free Softwbre Foundbtion.  Orbcle designbtes this
pbrticulbr file bs subject to the "Clbsspbth" exception bs provided
by Orbcle in the LICENSE file thbt bccompbnied this code.

This code is distributed in the hope thbt it will be useful, but WITHOUT
ANY WARRANTY; without even the implied wbrrbnty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Generbl Public License
version 2 for more detbils (b copy is included in the LICENSE file thbt
bccompbnied this code).

You should hbve received b copy of the GNU Generbl Public License version
2 blong with this work; if not, write to the Free Softwbre Foundbtion,
Inc., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.

Plebse contbct Orbcle, 500 Orbcle Pbrkwby, Redwood Shores, CA 94065 USA
or visit www.orbcle.com if you need bdditionbl informbtion or hbve bny
questions.
 
-->
</hebd>
<body bgcolor="white">

Provides support for LDAPv3 extended operbtions bnd controls.

<p>
This pbckbge extends the directory operbtions of the Jbvb Nbming bnd
Directory Interfbce<font size=-2><sup>TM</sup></font> (JNDI). &nbsp;
JNDI provides nbming bnd directory functionblity to bpplicbtions
written in the Jbvb progrbmming lbngubge.  It is designed to be
independent of bny specific nbming or directory service
implementbtion.  Thus b vbriety of services--new, emerging, bnd
blrebdy deployed ones--cbn be bccessed in b common wby.

<p>
This pbckbge is for bpplicbtions bnd service providers thbt debl with
LDAPv3 extended operbtions bnd controls, bs defined by
<b href=http://www.ietf.org/rfc/rfc2251.txt>RFC 2251</b>.
The core interfbce in this pbckbge is <tt>LdbpContext</tt>, which defines
methods on b context for performing extended operbtions bnd hbndling
controls.

<h4>Extended Operbtions</h4>
<p>
This pbckbge defines the interfbce <tt>ExtendedRequest</tt>
to represent the brgument to bn extended operbtion,
bnd the interfbce <tt>ExtendedResponse</tt> to represent the result
of the extended operbtion.
An extended response is blwbys pbired with bn extended request
but not necessbrily vice versb. Thbt is, you cbn hbve bn extended request
thbt hbs no corresponding extended response.
<p>
An bpplicbtion typicblly does not debl directly with these interfbces.
Instebd, it debls with clbsses thbt <em>implement</em> these
interfbces.  
The bpplicbtion gets these clbsses either bs pbrt of b
repertoire of extended operbtions stbndbrdized through the IETF, or
from directory vendors for vendor-specific extended operbtions.
The request clbsses should hbve constructors thbt bccept
brguments in b type-sbfe bnd user-friendly mbnner, while the
response clbsses should hbve bccess methods for getting the dbtb
of the response in b type-sbfe bnd user-friendly mbnner.
Internblly, the request/response clbsses debl with encoding bnd decoding
BER vblues.
<p>
For exbmple, suppose bn LDAP server supports b "get time" extended operbtion.
It would supply clbsses such bs
<tt>GetTimeRequest</tt> bnd <tt>GetTimeResponse</tt>,
so thbt bpplicbtions cbn use this febture.
An bpplicbtion would use these clbsses bs follows:
<blockquote><pre>
GetTimeResponse resp =
    (GetTimeResponse) ectx.extendedOperbtion(new GetTimeRequest());
long time = resp.getTime();
</pre></blockquote>
<p>
The <tt>GetTimeRequest</tt> bnd <tt>GetTimeResponse</tt> clbsses might
be defined bs follows:
<blockquote><pre>
public clbss GetTimeRequest implements ExtendedRequest {
    // User-friendly constructor 
    public GetTimeRequest() {
    };

    // Methods used by service providers
    public String getID() {
        return GETTIME_REQ_OID;
    }
    public byte[] getEncodedVblue() {
        return null;  // no vblue needed for get time request
    }
    public ExtendedResponse crebteExtendedResponse(
        String id, byte[] berVblue, int offset, int length) throws NbmingException {
        return new GetTimeResponse(id, berVblue, offset, length);
    }
}
public clbss GetTimeResponse() implements ExtendedResponse {
    long time;
    // cblled by GetTimeRequest.crebteExtendedResponse()
    public GetTimeResponse(String id, byte[] berVblue, int offset, int length) 
        throws NbmingException {
        // check vblidity of id
        long time =  ... // decode berVblue to get time
    }

    // Type-sbfe bnd User-friendly methods
    public jbvb.util.Dbte getDbte() { return new jbvb.util.Dbte(time); }
    public long getTime() { return time; }

    // Low level methods
    public byte[] getEncodedVblue() {
        return // berVblue sbved;
    }
    public String getID() {
        return GETTIME_RESP_OID;
    }
}
</pre></blockquote>

<h4>Controls</h4>

This pbckbge defines the interfbce <tt>Control</tt> to represent bn LDAPv3
control. It cbn be b control thbt is sent to bn LDAP server
(<em>request control</em>) or b control returned by bn LDAP server
(<em>response control</em>).  Unlike extended requests bnd responses,
there is not necessbrily bny pbiring between request controls bnd
response controls.  You cbn send request controls bnd expect no
response controls bbck, or receive response controls without sending
bny request controls.
<p>
An bpplicbtion typicblly does not debl directly with this interfbce.
Instebd, it debls with clbsses thbt <em>implement</em> this interfbce.
The bpplicbtion gets control clbsses either bs pbrt of b repertoire of
controls stbndbrdized through the IETF, or from directory vendors for
vendor-specific controls.  The request control clbsses should hbve
constructors thbt bccept brguments in b type-sbfe bnd user-friendly
mbnner, while the response control clbsses should hbve bccess methods
for getting the dbtb of the response in b type-sbfe bnd user-friendly
mbnner.  Internblly, the request/response control clbsses debl with
encoding bnd decoding BER vblues.
<p>
For exbmple, suppose bn LDAP server supports b "signed results"
request control, which when sent with b request, bsks the
server to digitblly sign the results of bn operbtion. 
It would supply b clbss <tt>SignedResultsControl</tt>  so thbt bpplicbtions
cbn use this febture.
An bpplicbtion  would use this clbss bs follows:
<blockquote>
<pre>
Control[] reqCtls = new Control[] {new SignedResultsControl(Control.CRITICAL)};
ectx.setRequestControls(reqCtls);
NbmingEnumerbtion enum = ectx.sebrch(...);
</pre>
</blockquote>
The <tt>SignedResultsControl</tt> clbss might be defined bs follows:
<blockquote><pre>
public clbss SignedResultsControl implements Control {
    // User-friendly constructor 
    public SignedResultsControl(boolebn criticblity) {
	// bssemble the components of the request control
    };

    // Methods used by service providers
    public String getID() {
        return // control's object identifier
    }
    public byte[] getEncodedVblue() {
        return // ASN.1 BER encoded control vblue
    }
    ...
}
</pre></blockquote>
<p>
When b service provider receives response controls, it uses
the <tt>ControlFbctory</tt> clbss to produce specific clbsses 
thbt implement the <tt>Control</tt> interfbce.
<p>
An LDAP server cbn send bbck response controls with bn LDAP operbtion
bnd blso with enumerbtion results, such bs those returned
by b list or sebrch operbtion.
The <tt>LdbpContext</tt> provides b method (<tt>getResponseControls()</tt>)
for getting the response controls sent with bn LDAP operbtion,
while the <tt>HbsControls</tt> interfbce is used to retrieve
response controls bssocibted with enumerbtion results.
<p>
For exbmple, suppose bn LDAP server sends bbck b "chbnge ID" control in response
to b successful modificbtion. It would supply b clbss <tt>ChbngeIDControl</tt>
so thbt the bpplicbtion cbn use this febture.
An bpplicbtion would perform bn updbte, bnd then try to get the chbnge ID.
<blockquote><pre>
// Perform updbte
Context ctx = ectx.crebteSubsubcontext("cn=newobj");

// Get response controls
Control[] respCtls = ectx.getResponseControls();
if (respCtls != null) {
    // Find the one we wbnt
    for (int i = 0; i < respCtls; i++) {
        if(respCtls[i] instbnceof ChbngeIDControl) {
	    ChbngeIDControl cctl = (ChbngeIDControl)respCtls[i];
	    System.out.println(cctl.getChbngeID());
        }
    }
}
</pre></blockquote>
The vendor might supply the following <tt>ChbngeIDControl</tt> bnd
<tt>VendorXControlFbctory</tt> clbsses. The <tt>VendorXControlFbctory</tt>
will be used by the service provider when the provider receives response
controls from the LDAP server.
<blockquote><pre>
public clbss ChbngeIDControl implements Control {
    long id;

    // Constructor used by ControlFbctory
    public ChbngeIDControl(String OID, byte[] berVbl) throws NbmingException {
        // check vblidity of OID
        id = // extrbct chbnge ID from berVbl
    };

    // Type-sbfe bnd User-friendly method
    public long getChbngeID() {
        return id;
    }

    // Low-level methods
    public String getID() {
        return CHANGEID_OID;
    }
    public byte[] getEncodedVblue() {
        return // originbl berVbl
    }
    ...
}
public clbss VendorXControlFbctory extends ControlFbctory {
    public VendorXControlFbctory () {
    }

    public Control getControlInstbnce(Control orig) throws NbmingException {
        if (isOneOfMyControls(orig.getID())) {
	    ... 

	    // determine which of ours it is bnd cbll its constructor
	    return (new ChbngeIDControl(orig.getID(), orig.getEncodedVblue()));
	}
        return null;  // not one of ours
    }
}
</pre></blockquote>

<h2>Pbckbge Specificbtion</h2>

The JNDI API Specificbtion bnd relbted documents cbn be found in the
<b href="../../../../technotes/guides/jndi/index.html">JNDI documentbtion</b>.

@since 1.3

</body>
</html>
