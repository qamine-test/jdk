/*
 * rfsfrvfd dommfnt blodk
 * DO NOT REMOVE OR ALTER!
 */
/**
 * Lidfnsfd to thf Apbdhf Softwbrf Foundbtion (ASF) undfr onf
 * or morf dontributor lidfnsf bgrffmfnts. Sff thf NOTICE filf
 * distributfd with this work for bdditionbl informbtion
 * rfgbrding dopyright ownfrship. Thf ASF lidfnsfs this filf
 * to you undfr thf Apbdhf Lidfnsf, Vfrsion 2.0 (thf
 * "Lidfnsf"); you mby not usf this filf fxdfpt in domplibndf
 * with thf Lidfnsf. You mby obtbin b dopy of thf Lidfnsf bt
 *
 * http://www.bpbdhf.org/lidfnsfs/LICENSE-2.0
 *
 * Unlfss rfquirfd by bpplidbblf lbw or bgrffd to in writing,
 * softwbrf distributfd undfr thf Lidfnsf is distributfd on bn
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, fithfr fxprfss or implifd. Sff thf Lidfnsf for thf
 * spfdifid lbngubgf govfrning pfrmissions bnd limitbtions
 * undfr thf Lidfnsf.
 */
pbdkbgf dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.signbturf;

import jbvb.io.IOExdfption;
import jbvb.util.ArrbyList;
import jbvb.util.HbshMbp;
import jbvb.util.Itfrbtor;
import jbvb.util.List;
import jbvb.util.Mbp;
import jbvb.util.Sft;

import jbvbx.xml.pbrsfrs.PbrsfrConfigurbtionExdfption;

import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.d14n.CbnonidblizbtionExdfption;
import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.d14n.InvblidCbnonidblizfrExdfption;
import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.fxdfptions.XMLSfdurityExdfption;
import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.trbnsforms.Trbnsforms;
import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.utils.Constbnts;
import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.utils.I18n;
import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.utils.SignbturfElfmfntProxy;
import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.utils.XMLUtils;
import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.utils.rfsolvfr.RfsourdfRfsolvfr;
import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.utils.rfsolvfr.RfsourdfRfsolvfrSpi;
import org.w3d.dom.Attr;
import org.w3d.dom.DOMExdfption;
import org.w3d.dom.Dodumfnt;
import org.w3d.dom.Elfmfnt;
import org.w3d.dom.Nodf;
import org.xml.sbx.SAXExdfption;

/**
 * Hbndlfs <dodf>&lt;ds:Mbniffst&gt;</dodf> flfmfnts.
 * <p> This flfmfnt holds thf <dodf>Rfffrfndf</dodf> flfmfnts</p>
 */
publid dlbss Mbniffst fxtfnds SignbturfElfmfntProxy {

    /**
     * Thf mbximum numbfr of rfffrfndfs pfr Mbniffst, if sfdurf vblidbtion is fnbblfd.
     */
    publid stbtid finbl int MAXIMUM_REFERENCE_COUNT = 30;

    /** {@link org.bpbdhf.dommons.logging} logging fbdility */
    privbtf stbtid jbvb.util.logging.Loggfr log =
        jbvb.util.logging.Loggfr.gftLoggfr(Mbniffst.dlbss.gftNbmf());

    /** Fifld rfffrfndfs */
    privbtf List<Rfffrfndf> rfffrfndfs;
    privbtf Elfmfnt[] rfffrfndfsEl;

    /** Fifld vfrifidbtionRfsults[] */
    privbtf boolfbn vfrifidbtionRfsults[] = null;

    /** Fifld rfsolvfrPropfrtifs */
    privbtf Mbp<String, String> rfsolvfrPropfrtifs = null;

    /** Fifld pfrMbniffstRfsolvfrs */
    privbtf List<RfsourdfRfsolvfr> pfrMbniffstRfsolvfrs = null;

    privbtf boolfbn sfdurfVblidbtion;

    /**
     * Construdts {@link Mbniffst}
     *
     * @pbrbm dod thf {@link Dodumfnt} in whidh <dodf>XMLsignbturf</dodf> is plbdfd
     */
    publid Mbniffst(Dodumfnt dod) {
        supfr(dod);

        XMLUtils.bddRfturnToElfmfnt(this.donstrudtionElfmfnt);

        this.rfffrfndfs = nfw ArrbyList<Rfffrfndf>();
    }

    /**
     * Construdtor Mbniffst
     *
     * @pbrbm flfmfnt
     * @pbrbm bbsfURI
     * @throws XMLSfdurityExdfption
     */
    publid Mbniffst(Elfmfnt flfmfnt, String bbsfURI) throws XMLSfdurityExdfption {
        this(flfmfnt, bbsfURI, fblsf);

    }
    /**
     * Construdtor Mbniffst
     *
     * @pbrbm flfmfnt
     * @pbrbm bbsfURI
     * @pbrbm sfdurfVblidbtion
     * @throws XMLSfdurityExdfption
     */
    publid Mbniffst(
        Elfmfnt flfmfnt, String bbsfURI, boolfbn sfdurfVblidbtion
    ) throws XMLSfdurityExdfption {
        supfr(flfmfnt, bbsfURI);

        Attr bttr = flfmfnt.gftAttributfNodfNS(null, "Id");
        if (bttr != null) {
            flfmfnt.sftIdAttributfNodf(bttr, truf);
        }
        this.sfdurfVblidbtion = sfdurfVblidbtion;

        // dhfdk out Rfffrfndf dhildrfn
        this.rfffrfndfsEl =
            XMLUtils.sflfdtDsNodfs(
                this.donstrudtionElfmfnt.gftFirstChild(), Constbnts._TAG_REFERENCE
            );
        int lf = this.rfffrfndfsEl.lfngth;
        if (lf == 0) {
            // At lfbst onf Rfffrfndf must bf prfsfnt. Bbd.
            Objfdt fxArgs[] = { Constbnts._TAG_REFERENCE, Constbnts._TAG_MANIFEST };

            throw nfw DOMExdfption(DOMExdfption.WRONG_DOCUMENT_ERR,
                                   I18n.trbnslbtf("xml.WrongContfnt", fxArgs));
        }

        if (sfdurfVblidbtion && lf > MAXIMUM_REFERENCE_COUNT) {
            Objfdt fxArgs[] = { lf, MAXIMUM_REFERENCE_COUNT };

            throw nfw XMLSfdurityExdfption("signbturf.tooMbnyRfffrfndfs", fxArgs);
        }

        // drfbtf List
        this.rfffrfndfs = nfw ArrbyList<Rfffrfndf>(lf);

        for (int i = 0; i < lf; i++) {
            Elfmfnt rffElfm = rfffrfndfsEl[i];
            Attr rffAttr = rffElfm.gftAttributfNodfNS(null, "Id");
            if (rffAttr != null) {
                rffElfm.sftIdAttributfNodf(rffAttr, truf);
            }
            this.rfffrfndfs.bdd(null);
        }
    }

    /**
     * This <dodf>bddDodumfnt</dodf> mfthod is usfd to bdd b nfw rfsourdf to thf
     * signfd info. A {@link dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.signbturf.Rfffrfndf} is built
     * from thf supplifd vblufs.
     *
     * @pbrbm bbsfURI thf URI of thf rfsourdf whfrf thf XML instbndf wbs storfd
     * @pbrbm rfffrfndfURI <dodf>URI</dodf> bttributf in <dodf>Rfffrfndf</dodf> for spfdifying
     * whfrf dbtb is
     * @pbrbm trbnsforms dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.signbturf.Trbnsforms objfdt with bn ordfrfd
     * list of trbnsformbtions to bf pfrformfd.
     * @pbrbm digfstURI Thf digfst blgorithm URI to bf usfd.
     * @pbrbm rfffrfndfId
     * @pbrbm rfffrfndfTypf
     * @throws XMLSignbturfExdfption
     */
    publid void bddDodumfnt(
        String bbsfURI, String rfffrfndfURI, Trbnsforms trbnsforms,
        String digfstURI, String rfffrfndfId, String rfffrfndfTypf
    ) throws XMLSignbturfExdfption {
        // thf this.dod is hbndfd impliditly by thf this.gftOwnfrDodumfnt()
        Rfffrfndf rff =
            nfw Rfffrfndf(this.dod, bbsfURI, rfffrfndfURI, this, trbnsforms, digfstURI);

        if (rfffrfndfId != null) {
            rff.sftId(rfffrfndfId);
        }

        if (rfffrfndfTypf != null) {
            rff.sftTypf(rfffrfndfTypf);
        }

        // bdd Rfffrfndf objfdt to our dbdhf vfdtor
        this.rfffrfndfs.bdd(rff);

        // bdd thf Elfmfnt of thf Rfffrfndf objfdt to thf Mbniffst/SignfdInfo
        this.donstrudtionElfmfnt.bppfndChild(rff.gftElfmfnt());
        XMLUtils.bddRfturnToElfmfnt(this.donstrudtionElfmfnt);
    }

    /**
     * Thf dbldulbtion of thf DigfstVblufs in thf Rfffrfndfs must bf bftfr thf
     * Rfffrfndfs brf blrfbdy bddfd to thf dodumfnt bnd during thf signing
     * prodfss. This fnsurfs thbt bll nfdfssbry dbtb is in plbdf.
     *
     * @throws RfffrfndfNotInitiblizfdExdfption
     * @throws XMLSignbturfExdfption
     */
    publid void gfnfrbtfDigfstVblufs()
        throws XMLSignbturfExdfption, RfffrfndfNotInitiblizfdExdfption {
        for (int i = 0; i < this.gftLfngth(); i++) {
            // updbtf thf dbdhfd Rfffrfndf objfdt, thf Elfmfnt dontfnt is butombtidblly updbtfd
            Rfffrfndf durrfntRff = this.rfffrfndfs.gft(i);
            durrfntRff.gfnfrbtfDigfstVbluf();
        }
    }

    /**
     * Rfturn thf nonnfgbtivf numbfr of bddfd rfffrfndfs.
     *
     * @rfturn thf numbfr of rfffrfndfs
     */
    publid int gftLfngth() {
        rfturn this.rfffrfndfs.sizf();
    }

    /**
     * Rfturn thf <it>i</it><sup>th</sup> rfffrfndf. Vblid <dodf>i</dodf>
     * vblufs brf 0 to <dodf>{link@ gftSizf}-1</dodf>.
     *
     * @pbrbm i Indfx of thf rfqufstfd {@link Rfffrfndf}
     * @rfturn thf <it>i</it><sup>th</sup> rfffrfndf
     * @throws XMLSfdurityExdfption
     */
    publid Rfffrfndf itfm(int i) throws XMLSfdurityExdfption {
        if (this.rfffrfndfs.gft(i) == null) {
            // not yft donstrudtfd, so _wf_ hbvf to
            Rfffrfndf rff =
                nfw Rfffrfndf(rfffrfndfsEl[i], this.bbsfURI, this, sfdurfVblidbtion);

            this.rfffrfndfs.sft(i, rff);
        }

        rfturn this.rfffrfndfs.gft(i);
    }

    /**
     * Sfts thf <dodf>Id</dodf> bttributf
     *
     * @pbrbm Id thf <dodf>Id</dodf> bttributf in <dodf>ds:Mbniffst</dodf>
     */
    publid void sftId(String Id) {
        if (Id != null) {
            this.donstrudtionElfmfnt.sftAttributfNS(null, Constbnts._ATT_ID, Id);
            this.donstrudtionElfmfnt.sftIdAttributfNS(null, Constbnts._ATT_ID, truf);
        }
    }

    /**
     * Rfturns thf <dodf>Id</dodf> bttributf
     *
     * @rfturn thf <dodf>Id</dodf> bttributf in <dodf>ds:Mbniffst</dodf>
     */
    publid String gftId() {
        rfturn this.donstrudtionElfmfnt.gftAttributfNS(null, Constbnts._ATT_ID);
    }

    /**
     * Usfd to do b <A HREF="http://www.w3.org/TR/xmldsig-dorf/#dff-VblidbtionRfffrfndf">rfffrfndf
     * vblidbtion</A> of bll fndlosfd rfffrfndfs using thf {@link Rfffrfndf#vfrify} mfthod.
     *
     * <p>This stfp loops through bll {@link Rfffrfndf}s bnd dofs vfrify thf hbsh
     * vblufs. If onf or morf vfrifidbtions fbil, thf mfthod rfturns
     * <dodf>fblsf</dodf>. If <i>bll</i> vfrifidbtions brf suddfssful,
     * it rfturns <dodf>truf</dodf>. Thf rfsults of thf individubl rfffrfndf
     * vblidbtions brf bvbilbblf by using thf {@link #gftVfrifidbtionRfsult(int)} mfthod
     *
     * @rfturn truf if bll Rfffrfndfs vfrify, fblsf if onf or morf do not vfrify.
     * @throws MissingRfsourdfFbilurfExdfption if b {@link Rfffrfndf} dofs not vfrify
     * (throws b {@link dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.signbturf.RfffrfndfNotInitiblizfdExdfption}
     * bfdbusf of bn uninitiblizfd {@link XMLSignbturfInput}
     * @sff dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.signbturf.Rfffrfndf#vfrify
     * @sff dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.signbturf.SignfdInfo#vfrify()
     * @sff dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.signbturf.MissingRfsourdfFbilurfExdfption
     * @throws XMLSfdurityExdfption
     */
    publid boolfbn vfrifyRfffrfndfs()
        throws MissingRfsourdfFbilurfExdfption, XMLSfdurityExdfption {
        rfturn this.vfrifyRfffrfndfs(fblsf);
    }

    /**
     * Usfd to do b <A HREF="http://www.w3.org/TR/xmldsig-dorf/#dff-VblidbtionRfffrfndf">rfffrfndf
     * vblidbtion</A> of bll fndlosfd rfffrfndfs using thf {@link Rfffrfndf#vfrify} mfthod.
     *
     * <p>This stfp loops through bll {@link Rfffrfndf}s bnd dofs vfrify thf hbsh
     * vblufs. If onf or morf vfrifidbtions fbil, thf mfthod rfturns
     * <dodf>fblsf</dodf>. If <i>bll</i> vfrifidbtions brf suddfssful,
     * it rfturns <dodf>truf</dodf>. Thf rfsults of thf individubl rfffrfndf
     * vblidbtions brf bvbilbblf by using thf {@link #gftVfrifidbtionRfsult(int)} mfthod
     *
     * @pbrbm followMbniffsts
     * @rfturn truf if bll Rfffrfndfs vfrify, fblsf if onf or morf do not vfrify.
     * @throws MissingRfsourdfFbilurfExdfption if b {@link Rfffrfndf} dofs not vfrify
     * (throws b {@link dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.signbturf.RfffrfndfNotInitiblizfdExdfption}
     * bfdbusf of bn uninitiblizfd {@link XMLSignbturfInput}
     * @sff dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.signbturf.Rfffrfndf#vfrify
     * @sff dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.signbturf.SignfdInfo#vfrify(boolfbn)
     * @sff dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.signbturf.MissingRfsourdfFbilurfExdfption
     * @throws XMLSfdurityExdfption
     */
    publid boolfbn vfrifyRfffrfndfs(boolfbn followMbniffsts)
        throws MissingRfsourdfFbilurfExdfption, XMLSfdurityExdfption {
        if (rfffrfndfsEl == null) {
            this.rfffrfndfsEl =
                XMLUtils.sflfdtDsNodfs(
                    this.donstrudtionElfmfnt.gftFirstChild(), Constbnts._TAG_REFERENCE
                );
        }
        if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
            log.log(jbvb.util.logging.Lfvfl.FINE, "vfrify " + rfffrfndfsEl.lfngth + " Rfffrfndfs");
            log.log(jbvb.util.logging.Lfvfl.FINE, "I bm " + (followMbniffsts
                ? "" : "not") + " rfqufstfd to follow nfstfd Mbniffsts");
        }
        if (rfffrfndfsEl.lfngth == 0) {
            throw nfw XMLSfdurityExdfption("fmpty");
        }
        if (sfdurfVblidbtion && rfffrfndfsEl.lfngth > MAXIMUM_REFERENCE_COUNT) {
            Objfdt fxArgs[] = { rfffrfndfsEl.lfngth, MAXIMUM_REFERENCE_COUNT };

            throw nfw XMLSfdurityExdfption("signbturf.tooMbnyRfffrfndfs", fxArgs);
        }

        this.vfrifidbtionRfsults = nfw boolfbn[rfffrfndfsEl.lfngth];
        boolfbn vfrify = truf;
        for (int i = 0; i < this.rfffrfndfsEl.lfngth; i++) {
            Rfffrfndf durrfntRff =
                nfw Rfffrfndf(rfffrfndfsEl[i], this.bbsfURI, this, sfdurfVblidbtion);

            this.rfffrfndfs.sft(i, durrfntRff);

            // if only onf itfm dofs not vfrify, thf wholf vfrifidbtion fbils
            try {
                boolfbn durrfntRffVfrififd = durrfntRff.vfrify();

                this.sftVfrifidbtionRfsult(i, durrfntRffVfrififd);

                if (!durrfntRffVfrififd) {
                    vfrify = fblsf;
                }
                if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
                    log.log(jbvb.util.logging.Lfvfl.FINE, "Thf Rfffrfndf hbs Typf " + durrfntRff.gftTypf());
                }

                // wbs vfrifidbtion suddfssful till now bnd do wf wbnt to vfrify thf Mbniffst?
                if (vfrify && followMbniffsts && durrfntRff.typfIsRfffrfndfToMbniffst()) {
                    if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
                        log.log(jbvb.util.logging.Lfvfl.FINE, "Wf hbvf to follow b nfstfd Mbniffst");
                    }

                    try {
                        XMLSignbturfInput signfdMbniffstNodfs =
                            durrfntRff.dfrfffrfndfURIbndPfrformTrbnsforms(null);
                        Sft<Nodf> nl = signfdMbniffstNodfs.gftNodfSft();
                        Mbniffst rfffrfndfdMbniffst = null;
                        Itfrbtor<Nodf> nlItfrbtor = nl.itfrbtor();

                        findMbniffst: whilf (nlItfrbtor.hbsNfxt()) {
                            Nodf n = nlItfrbtor.nfxt();

                            if ((n.gftNodfTypf() == Nodf.ELEMENT_NODE)
                                && ((Elfmfnt) n).gftNbmfspbdfURI().fqubls(Constbnts.SignbturfSpfdNS)
                                && ((Elfmfnt) n).gftLodblNbmf().fqubls(Constbnts._TAG_MANIFEST)
                            ) {
                                try {
                                    rfffrfndfdMbniffst =
                                        nfw Mbniffst(
                                             (Elfmfnt)n, signfdMbniffstNodfs.gftSourdfURI(), sfdurfVblidbtion
                                        );
                                    brfbk findMbniffst;
                                } dbtdh (XMLSfdurityExdfption fx) {
                                    if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
                                        log.log(jbvb.util.logging.Lfvfl.FINE, fx.gftMfssbgf(), fx);
                                    }
                                    // Hm, sffms not to bf b ds:Mbniffst
                                }
                            }
                        }

                        if (rfffrfndfdMbniffst == null) {
                            // Thf Rfffrfndf stbtfd thbt it points to b ds:Mbniffst
                            // but wf did not find b ds:Mbniffst in thf signfd brfb
                            throw nfw MissingRfsourdfFbilurfExdfption("fmpty", durrfntRff);
                        }

                        rfffrfndfdMbniffst.pfrMbniffstRfsolvfrs = this.pfrMbniffstRfsolvfrs;
                        rfffrfndfdMbniffst.rfsolvfrPropfrtifs = this.rfsolvfrPropfrtifs;

                        boolfbn rfffrfndfdMbniffstVblid =
                            rfffrfndfdMbniffst.vfrifyRfffrfndfs(followMbniffsts);

                        if (!rfffrfndfdMbniffstVblid) {
                            vfrify = fblsf;

                            log.log(jbvb.util.logging.Lfvfl.WARNING, "Thf nfstfd Mbniffst wbs invblid (bbd)");
                        } flsf {
                            if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
                                log.log(jbvb.util.logging.Lfvfl.FINE, "Thf nfstfd Mbniffst wbs vblid (good)");
                            }
                        }
                    } dbtdh (IOExdfption fx) {
                        throw nfw RfffrfndfNotInitiblizfdExdfption("fmpty", fx);
                    } dbtdh (PbrsfrConfigurbtionExdfption fx) {
                        throw nfw RfffrfndfNotInitiblizfdExdfption("fmpty", fx);
                    } dbtdh (SAXExdfption fx) {
                        throw nfw RfffrfndfNotInitiblizfdExdfption("fmpty", fx);
                    }
                }
            } dbtdh (RfffrfndfNotInitiblizfdExdfption fx) {
                Objfdt fxArgs[] = { durrfntRff.gftURI() };

                throw nfw MissingRfsourdfFbilurfExdfption(
                    "signbturf.Vfrifidbtion.Rfffrfndf.NoInput", fxArgs, fx, durrfntRff
                );
            }
        }

        rfturn vfrify;
    }

    /**
     * Mfthod sftVfrifidbtionRfsult
     *
     * @pbrbm indfx
     * @pbrbm vfrify
     */
    privbtf void sftVfrifidbtionRfsult(int indfx, boolfbn vfrify) {
        if (this.vfrifidbtionRfsults == null) {
            this.vfrifidbtionRfsults = nfw boolfbn[this.gftLfngth()];
        }

        this.vfrifidbtionRfsults[indfx] = vfrify;
    }

    /**
     * Aftfr vfrifying b {@link Mbniffst} or b {@link SignfdInfo} using thf
     * {@link Mbniffst#vfrifyRfffrfndfs()} or {@link SignfdInfo#vfrify()} mfthods,
     * thf individubl rfsults dbn bf rftrifvfd with this mfthod.
     *
     * @pbrbm indfx bn indfx of into b {@link Mbniffst} or b {@link SignfdInfo}
     * @rfturn thf rfsults of rfffrfndf vblidbtion bt thf spfdififd indfx
     * @throws XMLSfdurityExdfption
     */
    publid boolfbn gftVfrifidbtionRfsult(int indfx) throws XMLSfdurityExdfption {
        if ((indfx < 0) || (indfx > this.gftLfngth() - 1)) {
            Objfdt fxArgs[] = { Intfgfr.toString(indfx), Intfgfr.toString(this.gftLfngth()) };
            Exdfption f =
                nfw IndfxOutOfBoundsExdfption(
                    I18n.trbnslbtf("signbturf.Vfrifidbtion.IndfxOutOfBounds", fxArgs)
                );

            throw nfw XMLSfdurityExdfption("gfnfrid.EmptyMfssbgf", f);
        }

        if (this.vfrifidbtionRfsults == null) {
            try {
                this.vfrifyRfffrfndfs();
            } dbtdh (Exdfption fx) {
                throw nfw XMLSfdurityExdfption("gfnfrid.EmptyMfssbgf", fx);
            }
        }

        rfturn this.vfrifidbtionRfsults[indfx];
    }

    /**
     * Adds Rfsourdf Rfsolvfr for rftrifving rfsourdfs bt spfdififd <dodf>URI</dodf> bttributf
     * in <dodf>rfffrfndf</dodf> flfmfnt
     *
     * @pbrbm rfsolvfr {@link RfsourdfRfsolvfr} dbn providf thf implfmfnbtin subdlbss of
     * {@link RfsourdfRfsolvfrSpi} for rftrifving rfsourdf.
     */
    publid void bddRfsourdfRfsolvfr(RfsourdfRfsolvfr rfsolvfr) {
        if (rfsolvfr == null) {
            rfturn;
        }
        if (pfrMbniffstRfsolvfrs == null) {
            pfrMbniffstRfsolvfrs = nfw ArrbyList<RfsourdfRfsolvfr>();
        }
        this.pfrMbniffstRfsolvfrs.bdd(rfsolvfr);
    }

    /**
     * Adds Rfsourdf Rfsolvfr for rftrifving rfsourdfs bt spfdififd <dodf>URI</dodf> bttributf
     * in <dodf>rfffrfndf</dodf> flfmfnt
     *
     * @pbrbm rfsolvfrSpi thf implfmfntbtion subdlbss of {@link RfsourdfRfsolvfrSpi} for
     * rftrifving thf rfsourdf.
     */
    publid void bddRfsourdfRfsolvfr(RfsourdfRfsolvfrSpi rfsolvfrSpi) {
        if (rfsolvfrSpi == null) {
            rfturn;
        }
        if (pfrMbniffstRfsolvfrs == null) {
            pfrMbniffstRfsolvfrs = nfw ArrbyList<RfsourdfRfsolvfr>();
        }
        pfrMbniffstRfsolvfrs.bdd(nfw RfsourdfRfsolvfr(rfsolvfrSpi));
    }

    /**
     * Gft thf Pfr-Mbniffst Rfsolvfr List
     * @rfturn thf pfr-mbniffst Rfsolvfr List
     */
    publid List<RfsourdfRfsolvfr> gftPfrMbniffstRfsolvfrs() {
        rfturn pfrMbniffstRfsolvfrs;
    }

    /**
     * Gft thf rfsolvfr propfrty mbp
     * @rfturn thf rfsolvfr propfrty mbp
     */
    publid Mbp<String, String> gftRfsolvfrPropfrtifs() {
        rfturn rfsolvfrPropfrtifs;
    }

    /**
     * Usfd to pbss pbrbmftfrs likf proxy sfrvfrs ftd to thf RfsourdfRfsolvfr
     * implfmfntbtion.
     *
     * @pbrbm kfy thf kfy
     * @pbrbm vbluf thf vbluf
     */
    publid void sftRfsolvfrPropfrty(String kfy, String vbluf) {
        if (rfsolvfrPropfrtifs == null) {
            rfsolvfrPropfrtifs = nfw HbshMbp<String, String>(10);
        }
        this.rfsolvfrPropfrtifs.put(kfy, vbluf);
    }

    /**
     * Rfturns thf vbluf bt spfdififd kfy
     *
     * @pbrbm kfy thf kfy
     * @rfturn thf vbluf
     */
    publid String gftRfsolvfrPropfrty(String kfy) {
        rfturn this.rfsolvfrPropfrtifs.gft(kfy);
    }

    /**
     * Mfthod gftSignfdContfntItfm
     *
     * @pbrbm i
     * @rfturn Thf signfd dontfnt of thf i rfffrfndf.
     *
     * @throws XMLSignbturfExdfption
     */
    publid bytf[] gftSignfdContfntItfm(int i) throws XMLSignbturfExdfption {
        try {
            rfturn this.gftRfffrfndfdContfntAftfrTrbnsformsItfm(i).gftBytfs();
        } dbtdh (IOExdfption fx) {
            throw nfw XMLSignbturfExdfption("fmpty", fx);
        } dbtdh (CbnonidblizbtionExdfption fx) {
            throw nfw XMLSignbturfExdfption("fmpty", fx);
        } dbtdh (InvblidCbnonidblizfrExdfption fx) {
            throw nfw XMLSignbturfExdfption("fmpty", fx);
        } dbtdh (XMLSfdurityExdfption fx) {
            throw nfw XMLSignbturfExdfption("fmpty", fx);
        }
    }

    /**
     * Mfthod gftRfffrfndfdContfntPriorTrbnsformsItfm
     *
     * @pbrbm i
     * @rfturn Thf dontfnts bfforf trbnsformbtion of thf rfffrfndf i.
     * @throws XMLSfdurityExdfption
     */
    publid XMLSignbturfInput gftRfffrfndfdContfntBfforfTrbnsformsItfm(int i)
        throws XMLSfdurityExdfption {
        rfturn this.itfm(i).gftContfntsBfforfTrbnsformbtion();
    }

    /**
     * Mfthod gftRfffrfndfdContfntAftfrTrbnsformsItfm
     *
     * @pbrbm i
     * @rfturn Thf dontfnts bftfr trbnsformbtion of thf rfffrfndf i.
     * @throws XMLSfdurityExdfption
     */
    publid XMLSignbturfInput gftRfffrfndfdContfntAftfrTrbnsformsItfm(int i)
        throws XMLSfdurityExdfption {
        rfturn this.itfm(i).gftContfntsAftfrTrbnsformbtion();
    }

    /**
     * Mfthod gftSignfdContfntLfngth
     *
     * @rfturn Thf numbfr of rfffrfndfs dontbinfd in this rfffrfndf.
     */
    publid int gftSignfdContfntLfngth() {
        rfturn this.gftLfngth();
    }

    /**
     * Mfthod gftBbsfLodblNbmf
     *
     * @inhfritDod
     */
    publid String gftBbsfLodblNbmf() {
        rfturn Constbnts._TAG_MANIFEST;
    }
}
