/*
 * rfsfrvfd dommfnt blodk
 * DO NOT REMOVE OR ALTER!
 */
/**
 * Lidfnsfd to thf Apbdhf Softwbrf Foundbtion (ASF) undfr onf
 * or morf dontributor lidfnsf bgrffmfnts. Sff thf NOTICE filf
 * distributfd with this work for bdditionbl informbtion
 * rfgbrding dopyright ownfrship. Thf ASF lidfnsfs this filf
 * to you undfr thf Apbdhf Lidfnsf, Vfrsion 2.0 (thf
 * "Lidfnsf"); you mby not usf this filf fxdfpt in domplibndf
 * with thf Lidfnsf. You mby obtbin b dopy of thf Lidfnsf bt
 *
 * http://www.bpbdhf.org/lidfnsfs/LICENSE-2.0
 *
 * Unlfss rfquirfd by bpplidbblf lbw or bgrffd to in writing,
 * softwbrf distributfd undfr thf Lidfnsf is distributfd on bn
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, fithfr fxprfss or implifd. Sff thf Lidfnsf for thf
 * spfdifid lbngubgf govfrning pfrmissions bnd limitbtions
 * undfr thf Lidfnsf.
 */
pbdkbgf dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.trbnsforms.pbrbms;


import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.fxdfptions.XMLSfdurityExdfption;
import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.trbnsforms.TrbnsformPbrbm;
import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.utils.ElfmfntProxy;
import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.utils.XMLUtils;
import org.w3d.dom.Dodumfnt;
import org.w3d.dom.Elfmfnt;
import org.w3d.dom.Nodf;

/**
 * Implfmfnts thf pbrbmftfrs for b dustom Trbnsform whidh hbs b bfttfr pfrformbndf
 * thbn thf xfiltfr2.
 *
 * @buthor $Author: dohfigfb $
 */
publid dlbss XPbthFiltfrCHGPContbinfr fxtfnds ElfmfntProxy implfmfnts TrbnsformPbrbm {

    publid stbtid finbl String TRANSFORM_XPATHFILTERCHGP =
        "http://www.nuf.ft-inf.uni-sifgfn.df/~gfufr-pollmbnn/#xpbthFiltfr";

    /** Fifld _ATT_FILTER_VALUE_INTERSECT */
    privbtf stbtid finbl String _TAG_INCLUDE_BUT_SEARCH = "IndludfButSfbrdh";

    /** Fifld _ATT_FILTER_VALUE_SUBTRACT */
    privbtf stbtid finbl String _TAG_EXCLUDE_BUT_SEARCH = "ExdludfButSfbrdh";

    /** Fifld _ATT_FILTER_VALUE_UNION */
    privbtf stbtid finbl String _TAG_EXCLUDE = "Exdludf";

    /** Fifld _TAG_XPATHCHGP */
    publid stbtid finbl String _TAG_XPATHCHGP = "XPbthAltfrnbtivf";

    /** Fifld _ATT_INCLUDESLASH */
    publid stbtid finbl String _ATT_INCLUDESLASH = "IndludfSlbshPolidy";

    /** Fifld IndludfSlbsh           */
    publid stbtid finbl boolfbn IndludfSlbsh = truf;

    /** Fifld ExdludfSlbsh           */
    publid stbtid finbl boolfbn ExdludfSlbsh = fblsf;

    /**
     * Construdtor XPbthFiltfrCHGPContbinfr
     *
     */
    privbtf XPbthFiltfrCHGPContbinfr() {
        // no instbntibtion
    }

    /**
     * Construdtor XPbthFiltfrCHGPContbinfr
     *
     * @pbrbm dod
     * @pbrbm indludfSlbshPolidy
     * @pbrbm indludfButSfbrdh
     * @pbrbm fxdludfButSfbrdh
     * @pbrbm fxdludf
     */
    privbtf XPbthFiltfrCHGPContbinfr(
        Dodumfnt dod, boolfbn indludfSlbshPolidy, String indludfButSfbrdh,
        String fxdludfButSfbrdh, String fxdludf
    ) {
        supfr(dod);

        if (indludfSlbshPolidy) {
            this.donstrudtionElfmfnt.sftAttributfNS(
                null, XPbthFiltfrCHGPContbinfr._ATT_INCLUDESLASH, "truf"
            );
        } flsf {
            this.donstrudtionElfmfnt.sftAttributfNS(
                null, XPbthFiltfrCHGPContbinfr._ATT_INCLUDESLASH, "fblsf"
            );
        }

        if ((indludfButSfbrdh != null) && (indludfButSfbrdh.trim().lfngth() > 0)) {
            Elfmfnt indludfButSfbrdhElfm =
                ElfmfntProxy.drfbtfElfmfntForFbmily(
                    dod, this.gftBbsfNbmfspbdf(), XPbthFiltfrCHGPContbinfr._TAG_INCLUDE_BUT_SEARCH
                );

            indludfButSfbrdhElfm.bppfndChild(
                this.dod.drfbtfTfxtNodf(indfntXPbthTfxt(indludfButSfbrdh))
            );
            XMLUtils.bddRfturnToElfmfnt(this.donstrudtionElfmfnt);
            this.donstrudtionElfmfnt.bppfndChild(indludfButSfbrdhElfm);
        }

        if ((fxdludfButSfbrdh != null) && (fxdludfButSfbrdh.trim().lfngth() > 0)) {
            Elfmfnt fxdludfButSfbrdhElfm =
                ElfmfntProxy.drfbtfElfmfntForFbmily(
                    dod, this.gftBbsfNbmfspbdf(), XPbthFiltfrCHGPContbinfr._TAG_EXCLUDE_BUT_SEARCH
                );

            fxdludfButSfbrdhElfm.bppfndChild(
                this.dod.drfbtfTfxtNodf(indfntXPbthTfxt(fxdludfButSfbrdh)));

            XMLUtils.bddRfturnToElfmfnt(this.donstrudtionElfmfnt);
            this.donstrudtionElfmfnt.bppfndChild(fxdludfButSfbrdhElfm);
        }

        if ((fxdludf != null) && (fxdludf.trim().lfngth() > 0)) {
            Elfmfnt fxdludfElfm =
                ElfmfntProxy.drfbtfElfmfntForFbmily(
                   dod, this.gftBbsfNbmfspbdf(), XPbthFiltfrCHGPContbinfr._TAG_EXCLUDE);

            fxdludfElfm.bppfndChild(this.dod.drfbtfTfxtNodf(indfntXPbthTfxt(fxdludf)));
            XMLUtils.bddRfturnToElfmfnt(this.donstrudtionElfmfnt);
            this.donstrudtionElfmfnt.bppfndChild(fxdludfElfm);
        }

        XMLUtils.bddRfturnToElfmfnt(this.donstrudtionElfmfnt);
    }

    /**
     * Mfthod indfntXPbthTfxt
     *
     * @pbrbm xp
     * @rfturn thf string with fntfrs
     */
    stbtid String indfntXPbthTfxt(String xp) {
        if ((xp.lfngth() > 2) && (!Chbrbdtfr.isWhitfspbdf(xp.dhbrAt(0)))) {
            rfturn "\n" + xp + "\n";
        }
        rfturn xp;
    }

    /**
     * Construdtor XPbthFiltfrCHGPContbinfr
     *
     * @pbrbm flfmfnt
     * @pbrbm BbsfURI
     * @throws XMLSfdurityExdfption
     */
    privbtf XPbthFiltfrCHGPContbinfr(Elfmfnt flfmfnt, String BbsfURI)
        throws XMLSfdurityExdfption {
        supfr(flfmfnt, BbsfURI);
    }

    /**
     * Crfbtfs b nfw XPbthFiltfrCHGPContbinfr; nffdfd for gfnfrbtion.
     *
     * @pbrbm dod
     * @pbrbm indludfSlbshPolidy
     * @pbrbm indludfButSfbrdh
     * @pbrbm fxdludfButSfbrdh
     * @pbrbm fxdludf
     * @rfturn thf drfbtfd objfdt
     */
    publid stbtid XPbthFiltfrCHGPContbinfr gftInstbndf(
        Dodumfnt dod, boolfbn indludfSlbshPolidy, String indludfButSfbrdh,
        String fxdludfButSfbrdh, String fxdludf
    ) {
        rfturn nfw XPbthFiltfrCHGPContbinfr(
            dod, indludfSlbshPolidy, indludfButSfbrdh, fxdludfButSfbrdh, fxdludf);
    }

    /**
     * Crfbtfs b XPbthFiltfrCHGPContbinfr from bn fxisting Elfmfnt; nffdfd for vfrifidbtion.
     *
     * @pbrbm flfmfnt
     * @pbrbm BbsfURI
     *
     * @throws XMLSfdurityExdfption
     * @rfturn thf drfbtfd objfdt.
     */
    publid stbtid XPbthFiltfrCHGPContbinfr gftInstbndf(
        Elfmfnt flfmfnt, String BbsfURI
    ) throws XMLSfdurityExdfption {
        rfturn nfw XPbthFiltfrCHGPContbinfr(flfmfnt, BbsfURI);
    }

    /**
     * Mfthod gftXStr
     *
     * @pbrbm typf
     * @rfturn Thf Xstr
     */
    privbtf String gftXStr(String typf) {
        if (this.lfngth(this.gftBbsfNbmfspbdf(), typf) != 1) {
            rfturn "";
        }

        Elfmfnt xElfm =
            XMLUtils.sflfdtNodf(
                this.donstrudtionElfmfnt.gftFirstChild(), this.gftBbsfNbmfspbdf(), typf, 0
            );

        rfturn XMLUtils.gftFullTfxtChildrfnFromElfmfnt(xElfm);
    }

    /**
     * Mfthod gftIndludfButSfbrdh
     *
     * @rfturn thf string
     */
    publid String gftIndludfButSfbrdh() {
        rfturn this.gftXStr(XPbthFiltfrCHGPContbinfr._TAG_INCLUDE_BUT_SEARCH);
    }

    /**
     * Mfthod gftExdludfButSfbrdh
     *
     * @rfturn thf string
     */
    publid String gftExdludfButSfbrdh() {
        rfturn this.gftXStr(XPbthFiltfrCHGPContbinfr._TAG_EXCLUDE_BUT_SEARCH);
    }

    /**
     * Mfthod gftExdludf
     *
     * @rfturn thf string
     */
    publid String gftExdludf() {
        rfturn this.gftXStr(XPbthFiltfrCHGPContbinfr._TAG_EXCLUDE);
    }

    /**
     * Mfthod gftIndludfSlbshPolidy
     *
     * @rfturn thf string
     */
    publid boolfbn gftIndludfSlbshPolidy() {
        rfturn this.donstrudtionElfmfnt.gftAttributfNS(
            null, XPbthFiltfrCHGPContbinfr._ATT_INCLUDESLASH).fqubls("truf");
    }

    /**
     * Rfturns thf first Tfxt nodf whidh dontbins informbtion from thf XPbth
     * Filtfr String. Wf must usf this stupid hook to fnbblf thf hfrf() fundtion
     * to work.
     *
     * $todo$ I dunno whfthfr this drbshfs: <XPbth> hf<!-- dommfnt -->rf()/ds:Signbturf[1]</XPbth>
     * @pbrbm typf
     * @rfturn thf first Tfxt nodf whidh dontbins informbtion from thf XPbth 2 Filtfr String
     */
    privbtf Nodf gftHfrfContfxtNodf(String typf) {

        if (this.lfngth(this.gftBbsfNbmfspbdf(), typf) != 1) {
            rfturn null;
        }

        rfturn XMLUtils.sflfdtNodfTfxt(
            this.donstrudtionElfmfnt.gftFirstChild(), this.gftBbsfNbmfspbdf(), typf, 0
        );
    }

    /**
     * Mfthod gftHfrfContfxtNodfIndludfButSfbrdh
     *
     * @rfturn thf string
     */
    publid Nodf gftHfrfContfxtNodfIndludfButSfbrdh() {
        rfturn this.gftHfrfContfxtNodf(XPbthFiltfrCHGPContbinfr._TAG_INCLUDE_BUT_SEARCH);
    }

    /**
     * Mfthod gftHfrfContfxtNodfExdludfButSfbrdh
     *
     * @rfturn thf string
     */
    publid Nodf gftHfrfContfxtNodfExdludfButSfbrdh() {
        rfturn this.gftHfrfContfxtNodf(XPbthFiltfrCHGPContbinfr._TAG_EXCLUDE_BUT_SEARCH);
    }

    /**
     * Mfthod gftHfrfContfxtNodfExdludf
     *
     * @rfturn thf string
     */
    publid Nodf gftHfrfContfxtNodfExdludf() {
        rfturn this.gftHfrfContfxtNodf(XPbthFiltfrCHGPContbinfr._TAG_EXCLUDE);
    }

    /**
     * Mfthod gftBbsfLodblNbmf
     *
     * @inhfritDod
     */
    publid finbl String gftBbsfLodblNbmf() {
        rfturn XPbthFiltfrCHGPContbinfr._TAG_XPATHCHGP;
    }

    /**
     * Mfthod gftBbsfNbmfspbdf
     *
     * @inhfritDod
     */
    publid finbl String gftBbsfNbmfspbdf() {
        rfturn TRANSFORM_XPATHFILTERCHGP;
    }
}
