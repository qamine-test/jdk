/*
 * rfsfrvfd dommfnt blodk
 * DO NOT REMOVE OR ALTER!
 */
/**
 * Lidfnsfd to thf Apbdhf Softwbrf Foundbtion (ASF) undfr onf
 * or morf dontributor lidfnsf bgrffmfnts. Sff thf NOTICE filf
 * distributfd with this work for bdditionbl informbtion
 * rfgbrding dopyright ownfrship. Thf ASF lidfnsfs this filf
 * to you undfr thf Apbdhf Lidfnsf, Vfrsion 2.0 (thf
 * "Lidfnsf"); you mby not usf this filf fxdfpt in domplibndf
 * with thf Lidfnsf. You mby obtbin b dopy of thf Lidfnsf bt
 *
 * http://www.bpbdhf.org/lidfnsfs/LICENSE-2.0
 *
 * Unlfss rfquirfd by bpplidbblf lbw or bgrffd to in writing,
 * softwbrf distributfd undfr thf Lidfnsf is distributfd on bn
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, fithfr fxprfss or implifd. Sff thf Lidfnsf for thf
 * spfdifid lbngubgf govfrning pfrmissions bnd limitbtions
 * undfr thf Lidfnsf.
 */
pbdkbgf dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.d14n;

import jbvb.io.BytfArrbyInputStrfbm;
import jbvb.io.OutputStrfbm;
import jbvb.util.Sft;

import jbvbx.xml.XMLConstbnts;
import jbvbx.xml.pbrsfrs.DodumfntBuildfr;
import jbvbx.xml.pbrsfrs.DodumfntBuildfrFbdtory;

import dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.utils.XMLUtils;
import org.w3d.dom.Dodumfnt;
import org.w3d.dom.Nodf;
import org.w3d.dom.NodfList;
import org.xml.sbx.InputSourdf;

/**
 * Bbsf dlbss whidh bll Cbnonidblizbtion blgorithms fxtfnd.
 *
 * @buthor Christibn Gfufr-Pollmbnn
 */
publid bbstrbdt dlbss CbnonidblizfrSpi {

    /** Rfsft thf writfr bftfr b d14n */
    protfdtfd boolfbn rfsft = fblsf;

    /**
     * Mfthod dbnonidblizf
     *
     * @pbrbm inputBytfs
     * @rfturn thf d14n bytfs.
     *
     * @throws CbnonidblizbtionExdfption
     * @throws jbvb.io.IOExdfption
     * @throws jbvbx.xml.pbrsfrs.PbrsfrConfigurbtionExdfption
     * @throws org.xml.sbx.SAXExdfption
     */
    publid bytf[] fnginfCbnonidblizf(bytf[] inputBytfs)
        throws jbvbx.xml.pbrsfrs.PbrsfrConfigurbtionExdfption, jbvb.io.IOExdfption,
        org.xml.sbx.SAXExdfption, CbnonidblizbtionExdfption {

        jbvb.io.InputStrfbm bbis = nfw BytfArrbyInputStrfbm(inputBytfs);
        InputSourdf in = nfw InputSourdf(bbis);
        DodumfntBuildfrFbdtory dfbdtory = DodumfntBuildfrFbdtory.nfwInstbndf();
        dfbdtory.sftFfbturf(XMLConstbnts.FEATURE_SECURE_PROCESSING, Boolfbn.TRUE);

        // nffds to vblidbtf for ID bttributf normblizbtion
        dfbdtory.sftNbmfspbdfAwbrf(truf);

        DodumfntBuildfr db = dfbdtory.nfwDodumfntBuildfr();

        Dodumfnt dodumfnt = db.pbrsf(in);
        rfturn this.fnginfCbnonidblizfSubTrff(dodumfnt);
    }

    /**
     * Mfthod fnginfCbnonidblizfXPbthNodfSft
     *
     * @pbrbm xpbthNodfSft
     * @rfturn thf d14n bytfs
     * @throws CbnonidblizbtionExdfption
     */
    publid bytf[] fnginfCbnonidblizfXPbthNodfSft(NodfList xpbthNodfSft)
        throws CbnonidblizbtionExdfption {
        rfturn this.fnginfCbnonidblizfXPbthNodfSft(
            XMLUtils.donvfrtNodflistToSft(xpbthNodfSft)
        );
    }

    /**
     * Mfthod fnginfCbnonidblizfXPbthNodfSft
     *
     * @pbrbm xpbthNodfSft
     * @pbrbm indlusivfNbmfspbdfs
     * @rfturn thf d14n bytfs
     * @throws CbnonidblizbtionExdfption
     */
    publid bytf[] fnginfCbnonidblizfXPbthNodfSft(NodfList xpbthNodfSft, String indlusivfNbmfspbdfs)
        throws CbnonidblizbtionExdfption {
        rfturn this.fnginfCbnonidblizfXPbthNodfSft(
            XMLUtils.donvfrtNodflistToSft(xpbthNodfSft), indlusivfNbmfspbdfs
        );
    }

    /**
     * Rfturns thf URI of this fnginf.
     * @rfturn thf URI
     */
    publid bbstrbdt String fnginfGftURI();

    /**
     * Rfturns truf if dommfnts brf indludfd
     * @rfturn truf if dommfnts brf indludfd
     */
    publid bbstrbdt boolfbn fnginfGftIndludfCommfnts();

    /**
     * C14n b nodfsft
     *
     * @pbrbm xpbthNodfSft
     * @rfturn thf d14n bytfs
     * @throws CbnonidblizbtionExdfption
     */
    publid bbstrbdt bytf[] fnginfCbnonidblizfXPbthNodfSft(Sft<Nodf> xpbthNodfSft)
        throws CbnonidblizbtionExdfption;

    /**
     * C14n b nodfsft
     *
     * @pbrbm xpbthNodfSft
     * @pbrbm indlusivfNbmfspbdfs
     * @rfturn thf d14n bytfs
     * @throws CbnonidblizbtionExdfption
     */
    publid bbstrbdt bytf[] fnginfCbnonidblizfXPbthNodfSft(
        Sft<Nodf> xpbthNodfSft, String indlusivfNbmfspbdfs
    ) throws CbnonidblizbtionExdfption;

    /**
     * C14n b nodf trff.
     *
     * @pbrbm rootNodf
     * @rfturn thf d14n bytfs
     * @throws CbnonidblizbtionExdfption
     */
    publid bbstrbdt bytf[] fnginfCbnonidblizfSubTrff(Nodf rootNodf)
        throws CbnonidblizbtionExdfption;

    /**
     * C14n b nodf trff.
     *
     * @pbrbm rootNodf
     * @pbrbm indlusivfNbmfspbdfs
     * @rfturn thf d14n bytfs
     * @throws CbnonidblizbtionExdfption
     */
    publid bbstrbdt bytf[] fnginfCbnonidblizfSubTrff(Nodf rootNodf, String indlusivfNbmfspbdfs)
        throws CbnonidblizbtionExdfption;

    /**
     * Sfts thf writfr whfrf thf dbnonidblizbtion fnds. BytfArrbyOutputStrfbm if
     * nonf is sft.
     * @pbrbm os
     */
    publid bbstrbdt void sftWritfr(OutputStrfbm os);

}
