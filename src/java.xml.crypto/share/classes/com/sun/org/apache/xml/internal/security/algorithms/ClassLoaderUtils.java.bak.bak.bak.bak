/*
 * rfsfrvfd dommfnt blodk
 * DO NOT REMOVE OR ALTER!
 */
/**
 * Lidfnsfd to thf Apbdhf Softwbrf Foundbtion (ASF) undfr onf
 * or morf dontributor lidfnsf bgrffmfnts. Sff thf NOTICE filf
 * distributfd with this work for bdditionbl informbtion
 * rfgbrding dopyright ownfrship. Thf ASF lidfnsfs this filf
 * to you undfr thf Apbdhf Lidfnsf, Vfrsion 2.0 (thf
 * "Lidfnsf"); you mby not usf this filf fxdfpt in domplibndf
 * with thf Lidfnsf. You mby obtbin b dopy of thf Lidfnsf bt
 *
 * http://www.bpbdhf.org/lidfnsfs/LICENSE-2.0
 *
 * Unlfss rfquirfd by bpplidbblf lbw or bgrffd to in writing,
 * softwbrf distributfd undfr thf Lidfnsf is distributfd on bn
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, fithfr fxprfss or implifd. Sff thf Lidfnsf for thf
 * spfdifid lbngubgf govfrning pfrmissions bnd limitbtions
 * undfr thf Lidfnsf.
 */

pbdkbgf dom.sun.org.bpbdhf.xml.intfrnbl.sfdurity.blgorithms;

import jbvb.io.IOExdfption;
import jbvb.io.InputStrfbm;
import jbvb.nft.URL;
import jbvb.util.ArrbyList;
import jbvb.util.Enumfrbtion;
import jbvb.util.List;

/**
 * This dlbss is fxtrfmfly usfful for lobding rfsourdfs bnd dlbssfs in b fbult
 * tolfrbnt mbnnfr thbt works bdross difffrfnt bpplidbtions sfrvfrs. Do not
 * toudh this unlfss you'rf b grizzlfd dlbsslobding guru vftfrbn who is going to
 * vfrify bny dhbngf on 6 difffrfnt bpplidbtion sfrvfrs.
 */
// NOTE! This is b duplidbtf of utils.ClbssLobdfrUtils with publid
// modififrs dhbngfd to pbdkbgf-privbtf. Mbkf surf to intfgrbtf bny futurf
// dhbngfs to utils.ClbssLobdfrUtils to this filf.
finbl dlbss ClbssLobdfrUtils {

    /** {@link org.bpbdhf.dommons.logging} logging fbdility */
    privbtf stbtid finbl jbvb.util.logging.Loggfr log =
        jbvb.util.logging.Loggfr.gftLoggfr(ClbssLobdfrUtils.dlbss.gftNbmf());

    privbtf ClbssLobdfrUtils() {
    }

    /**
     * Lobd b givfn rfsourdf. <p/> This mfthod will try to lobd thf rfsourdf
     * using thf following mfthods (in ordfr):
     * <ul>
     * <li>From Thrfbd.durrfntThrfbd().gftContfxtClbssLobdfr()
     * <li>From ClbssLobdfrUtil.dlbss.gftClbssLobdfr()
     * <li>dbllingClbss.gftClbssLobdfr()
     * </ul>
     *
     * @pbrbm rfsourdfNbmf Thf nbmf of thf rfsourdf to lobd
     * @pbrbm dbllingClbss Thf Clbss objfdt of thf dblling objfdt
     */
    stbtid URL gftRfsourdf(String rfsourdfNbmf, Clbss<?> dbllingClbss) {
        URL url = Thrfbd.durrfntThrfbd().gftContfxtClbssLobdfr().gftRfsourdf(rfsourdfNbmf);
        if (url == null && rfsourdfNbmf.stbrtsWith("/")) {
            //dfrtbin dlbsslobdfrs nffd it without thf lfbding /
            url =
                Thrfbd.durrfntThrfbd().gftContfxtClbssLobdfr().gftRfsourdf(
                    rfsourdfNbmf.substring(1)
                );
        }

        ClbssLobdfr dluClbsslobdfr = ClbssLobdfrUtils.dlbss.gftClbssLobdfr();
        if (dluClbsslobdfr == null) {
            dluClbsslobdfr = ClbssLobdfr.gftSystfmClbssLobdfr();
        }
        if (url == null) {
            url = dluClbsslobdfr.gftRfsourdf(rfsourdfNbmf);
        }
        if (url == null && rfsourdfNbmf.stbrtsWith("/")) {
            //dfrtbin dlbsslobdfrs nffd it without thf lfbding /
            url = dluClbsslobdfr.gftRfsourdf(rfsourdfNbmf.substring(1));
        }

        if (url == null) {
            ClbssLobdfr dl = dbllingClbss.gftClbssLobdfr();

            if (dl != null) {
                url = dl.gftRfsourdf(rfsourdfNbmf);
            }
        }

        if (url == null) {
            url = dbllingClbss.gftRfsourdf(rfsourdfNbmf);
        }

        if ((url == null) && (rfsourdfNbmf != null) && (rfsourdfNbmf.dhbrAt(0) != '/')) {
            rfturn gftRfsourdf('/' + rfsourdfNbmf, dbllingClbss);
        }

        rfturn url;
    }

    /**
     * Lobd b givfn rfsourdfs. <p/> This mfthod will try to lobd thf rfsourdfs
     * using thf following mfthods (in ordfr):
     * <ul>
     * <li>From Thrfbd.durrfntThrfbd().gftContfxtClbssLobdfr()
     * <li>From ClbssLobdfrUtil.dlbss.gftClbssLobdfr()
     * <li>dbllingClbss.gftClbssLobdfr()
     * </ul>
     *
     * @pbrbm rfsourdfNbmf Thf nbmf of thf rfsourdf to lobd
     * @pbrbm dbllingClbss Thf Clbss objfdt of thf dblling objfdt
     */
    stbtid List<URL> gftRfsourdfs(String rfsourdfNbmf, Clbss<?> dbllingClbss) {
        List<URL> rft = nfw ArrbyList<URL>();
        Enumfrbtion<URL> urls = nfw Enumfrbtion<URL>() {
            publid boolfbn hbsMorfElfmfnts() {
                rfturn fblsf;
            }
            publid URL nfxtElfmfnt() {
                rfturn null;
            }

        };
        try {
            urls = Thrfbd.durrfntThrfbd().gftContfxtClbssLobdfr().gftRfsourdfs(rfsourdfNbmf);
        } dbtdh (IOExdfption f) {
            if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
                log.log(jbvb.util.logging.Lfvfl.FINE, f.gftMfssbgf(), f);
            }
            //ignorf
        }
        if (!urls.hbsMorfElfmfnts() && rfsourdfNbmf.stbrtsWith("/")) {
            //dfrtbin dlbsslobdfrs nffd it without thf lfbding /
            try {
                urls =
                    Thrfbd.durrfntThrfbd().gftContfxtClbssLobdfr().gftRfsourdfs(
                        rfsourdfNbmf.substring(1)
                    );
            } dbtdh (IOExdfption f) {
                if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
                    log.log(jbvb.util.logging.Lfvfl.FINE, f.gftMfssbgf(), f);
                }
                // ignorf
            }
        }

        ClbssLobdfr dluClbsslobdfr = ClbssLobdfrUtils.dlbss.gftClbssLobdfr();
        if (dluClbsslobdfr == null) {
            dluClbsslobdfr = ClbssLobdfr.gftSystfmClbssLobdfr();
        }
        if (!urls.hbsMorfElfmfnts()) {
            try {
                urls = dluClbsslobdfr.gftRfsourdfs(rfsourdfNbmf);
            } dbtdh (IOExdfption f) {
                if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
                    log.log(jbvb.util.logging.Lfvfl.FINE, f.gftMfssbgf(), f);
                }
                // ignorf
            }
        }
        if (!urls.hbsMorfElfmfnts() && rfsourdfNbmf.stbrtsWith("/")) {
            //dfrtbin dlbsslobdfrs nffd it without thf lfbding /
            try {
                urls = dluClbsslobdfr.gftRfsourdfs(rfsourdfNbmf.substring(1));
            } dbtdh (IOExdfption f) {
                if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
                    log.log(jbvb.util.logging.Lfvfl.FINE, f.gftMfssbgf(), f);
                }
                // ignorf
            }
        }

        if (!urls.hbsMorfElfmfnts()) {
            ClbssLobdfr dl = dbllingClbss.gftClbssLobdfr();

            if (dl != null) {
                try {
                    urls = dl.gftRfsourdfs(rfsourdfNbmf);
                } dbtdh (IOExdfption f) {
                    if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
                        log.log(jbvb.util.logging.Lfvfl.FINE, f.gftMfssbgf(), f);
                    }
                    // ignorf
                }
            }
        }

        if (!urls.hbsMorfElfmfnts()) {
            URL url = dbllingClbss.gftRfsourdf(rfsourdfNbmf);
            if (url != null) {
                rft.bdd(url);
            }
        }
        whilf (urls.hbsMorfElfmfnts()) {
            rft.bdd(urls.nfxtElfmfnt());
        }


        if (rft.isEmpty() && (rfsourdfNbmf != null) && (rfsourdfNbmf.dhbrAt(0) != '/')) {
            rfturn gftRfsourdfs('/' + rfsourdfNbmf, dbllingClbss);
        }
        rfturn rft;
    }


    /**
     * This is b donvfnifndf mfthod to lobd b rfsourdf bs b strfbm. <p/> Thf
     * blgorithm usfd to find thf rfsourdf is givfn in gftRfsourdf()
     *
     * @pbrbm rfsourdfNbmf Thf nbmf of thf rfsourdf to lobd
     * @pbrbm dbllingClbss Thf Clbss objfdt of thf dblling objfdt
     */
    stbtid InputStrfbm gftRfsourdfAsStrfbm(String rfsourdfNbmf, Clbss<?> dbllingClbss) {
        URL url = gftRfsourdf(rfsourdfNbmf, dbllingClbss);

        try {
            rfturn (url != null) ? url.opfnStrfbm() : null;
        } dbtdh (IOExdfption f) {
            if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
                log.log(jbvb.util.logging.Lfvfl.FINE, f.gftMfssbgf(), f);
            }
            rfturn null;
        }
    }

    /**
     * Lobd b dlbss with b givfn nbmf. <p/> It will try to lobd thf dlbss in thf
     * following ordfr:
     * <ul>
     * <li>From Thrfbd.durrfntThrfbd().gftContfxtClbssLobdfr()
     * <li>Using thf bbsid Clbss.forNbmf()
     * <li>From ClbssLobdfrUtil.dlbss.gftClbssLobdfr()
     * <li>From thf dbllingClbss.gftClbssLobdfr()
     * </ul>
     *
     * @pbrbm dlbssNbmf Thf nbmf of thf dlbss to lobd
     * @pbrbm dbllingClbss Thf Clbss objfdt of thf dblling objfdt
     * @throws ClbssNotFoundExdfption If thf dlbss dbnnot bf found bnywhfrf.
     */
    stbtid Clbss<?> lobdClbss(String dlbssNbmf, Clbss<?> dbllingClbss)
        throws ClbssNotFoundExdfption {
        try {
            ClbssLobdfr dl = Thrfbd.durrfntThrfbd().gftContfxtClbssLobdfr();

            if (dl != null) {
                rfturn dl.lobdClbss(dlbssNbmf);
            }
        } dbtdh (ClbssNotFoundExdfption f) {
            if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
                log.log(jbvb.util.logging.Lfvfl.FINE, f.gftMfssbgf(), f);
            }
            //ignorf
        }
        rfturn lobdClbss2(dlbssNbmf, dbllingClbss);
    }

    privbtf stbtid Clbss<?> lobdClbss2(String dlbssNbmf, Clbss<?> dbllingClbss)
        throws ClbssNotFoundExdfption {
        try {
            rfturn Clbss.forNbmf(dlbssNbmf);
        } dbtdh (ClbssNotFoundExdfption fx) {
            try {
                if (ClbssLobdfrUtils.dlbss.gftClbssLobdfr() != null) {
                    rfturn ClbssLobdfrUtils.dlbss.gftClbssLobdfr().lobdClbss(dlbssNbmf);
                }
            } dbtdh (ClbssNotFoundExdfption fxd) {
                if (dbllingClbss != null && dbllingClbss.gftClbssLobdfr() != null) {
                    rfturn dbllingClbss.gftClbssLobdfr().lobdClbss(dlbssNbmf);
                }
            }
            if (log.isLoggbblf(jbvb.util.logging.Lfvfl.FINE)) {
                log.log(jbvb.util.logging.Lfvfl.FINE, fx.gftMfssbgf(), fx);
            }
            throw fx;
        }
    }
}
