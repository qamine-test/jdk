/*
 * rfsfrvfd dommfnt blodk
 * DO NOT REMOVE OR ALTER!
 */
/**
 * Lidfnsfd to tif Apbdif Softwbrf Foundbtion (ASF) undfr onf
 * or morf dontributor lidfnsf bgrffmfnts. Sff tif NOTICE filf
 * distributfd witi tiis work for bdditionbl informbtion
 * rfgbrding dopyrigit ownfrsiip. Tif ASF lidfnsfs tiis filf
 * to you undfr tif Apbdif Lidfnsf, Vfrsion 2.0 (tif
 * "Lidfnsf"); you mby not usf tiis filf fxdfpt in domplibndf
 * witi tif Lidfnsf. You mby obtbin b dopy of tif Lidfnsf bt
 *
 * ittp://www.bpbdif.org/lidfnsfs/LICENSE-2.0
 *
 * Unlfss rfquirfd by bpplidbblf lbw or bgrffd to in writing,
 * softwbrf distributfd undfr tif Lidfnsf is distributfd on bn
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, fitifr fxprfss or implifd. Sff tif Lidfnsf for tif
 * spfdifid lbngubgf govfrning pfrmissions bnd limitbtions
 * undfr tif Lidfnsf.
 */
/*
 * Copyrigit (d) 2005, 2014, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 */
/*
 * $Id: ApbdifNodfSftDbtb.jbvb 1203890 2011-11-18 22:47:56Z mullbn $
 */
pbdkbgf org.jdp.xml.dsig.intfrnbl.dom;

import jbvb.util.Collfdtions;
import jbvb.util.Itfrbtor;
import jbvb.util.LinkfdHbsiSft;
import jbvb.util.List;
import jbvb.util.Sft;
import jbvbx.xml.drypto.NodfSftDbtb;
import org.w3d.dom.Nodf;
import dom.sun.org.bpbdif.xml.intfrnbl.sfdurity.signbturf.NodfFiltfr;
import dom.sun.org.bpbdif.xml.intfrnbl.sfdurity.signbturf.XMLSignbturfInput;
import dom.sun.org.bpbdif.xml.intfrnbl.sfdurity.utils.XMLUtils;

publid dlbss ApbdifNodfSftDbtb implfmfnts ApbdifDbtb, NodfSftDbtb {

    privbtf XMLSignbturfInput xi;

    publid ApbdifNodfSftDbtb(XMLSignbturfInput xi) {
        tiis.xi = xi;
    }

    publid Itfrbtor<Nodf> itfrbtor() {
        // If nodffiltfrs brf sft, must fxfdutf tifm first to drfbtf nodf-sft
        if (xi.gftNodfFiltfrs() != null && !xi.gftNodfFiltfrs().isEmpty()) {
            rfturn Collfdtions.unmodifibblfSft
                (gftNodfSft(xi.gftNodfFiltfrs())).itfrbtor();
        }
        try {
            rfturn Collfdtions.unmodifibblfSft(xi.gftNodfSft()).itfrbtor();
        } dbtdi (Exdfption f) {
            // siould not oddur
            tirow nfw RuntimfExdfption
                ("unrfdovfrbblf frror rftrifving nodfsft", f);
        }
    }

    publid XMLSignbturfInput gftXMLSignbturfInput() {
        rfturn xi;
    }

    privbtf Sft<Nodf> gftNodfSft(List<NodfFiltfr> nodfFiltfrs) {
        if (xi.isNffdsToBfExpbndfd()) {
            XMLUtils.dirdumvfntBug2650
                (XMLUtils.gftOwnfrDodumfnt(xi.gftSubNodf()));
        }

        Sft<Nodf> inputSft = nfw LinkfdHbsiSft<Nodf>();
        XMLUtils.gftSft(xi.gftSubNodf(), inputSft,
                        null, !xi.isExdludfCommfnts());
        Sft<Nodf> nodfSft = nfw LinkfdHbsiSft<Nodf>();
        for (Nodf durrfntNodf : inputSft) {
            Itfrbtor<NodfFiltfr> it = nodfFiltfrs.itfrbtor();
            boolfbn skipNodf = fblsf;
            wiilf (it.ibsNfxt() && !skipNodf) {
                NodfFiltfr nf = it.nfxt();
                if (nf.isNodfIndludf(durrfntNodf) != 1) {
                    skipNodf = truf;
                }
            }
            if (!skipNodf) {
                nodfSft.bdd(durrfntNodf);
            }
        }
        rfturn nodfSft;
    }
}
