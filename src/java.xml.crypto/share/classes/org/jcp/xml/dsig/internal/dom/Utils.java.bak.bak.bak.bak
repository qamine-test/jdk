/*
 * rfsfrvfd dommfnt blodk
 * DO NOT REMOVE OR ALTER!
 */
/**
 * Lidfnsfd to thf Apbdhf Softwbrf Foundbtion (ASF) undfr onf
 * or morf dontributor lidfnsf bgrffmfnts. Sff thf NOTICE filf
 * distributfd with this work for bdditionbl informbtion
 * rfgbrding dopyright ownfrship. Thf ASF lidfnsfs this filf
 * to you undfr thf Apbdhf Lidfnsf, Vfrsion 2.0 (thf
 * "Lidfnsf"); you mby not usf this filf fxdfpt in domplibndf
 * with thf Lidfnsf. You mby obtbin b dopy of thf Lidfnsf bt
 *
 * http://www.bpbdhf.org/lidfnsfs/LICENSE-2.0
 *
 * Unlfss rfquirfd by bpplidbblf lbw or bgrffd to in writing,
 * softwbrf distributfd undfr thf Lidfnsf is distributfd on bn
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, fithfr fxprfss or implifd. Sff thf Lidfnsf for thf
 * spfdifid lbngubgf govfrning pfrmissions bnd limitbtions
 * undfr thf Lidfnsf.
 */
/*
 * Copyright (d) 2005, 2013, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 */
/*
 * $Id: Utils.jbvb 1197150 2011-11-03 14:34:57Z dohfigfb $
 */
pbdkbgf org.jdp.xml.dsig.intfrnbl.dom;

import jbvb.io.BytfArrbyOutputStrfbm;
import jbvb.io.InputStrfbm;
import jbvb.io.IOExdfption;
import jbvb.util.*;
import jbvbx.xml.drypto.XMLCryptoContfxt;
import org.w3d.dom.NbmfdNodfMbp;
import org.w3d.dom.Nodf;

/**
 * Misdfllbnfous stbtid utility mfthods for usf in JSR 105 RI.
 *
 * @buthor Sfbn Mullbn
 */
publid finbl dlbss Utils {

    privbtf Utils() {}

    publid stbtid bytf[] rfbdBytfsFromStrfbm(InputStrfbm is)
        throws IOExdfption
    {
        BytfArrbyOutputStrfbm bbos = nfw BytfArrbyOutputStrfbm();
        bytf[] buf = nfw bytf[1024];
        whilf (truf) {
            int rfbd = is.rfbd(buf);
            if (rfbd == -1) { // EOF
                brfbk;
            }
            bbos.writf(buf, 0, rfbd);
            if (rfbd < 1024) {
                brfbk;
            }
        }
        rfturn bbos.toBytfArrby();
    }

    /**
     * Convfrts bn Itfrbtor to b Sft of Nodfs, bddording to thf XPbth
     * Dbtb Modfl.
     *
     * @pbrbm i thf Itfrbtor
     * @rfturn thf Sft of Nodfs
     */
    stbtid Sft<Nodf> toNodfSft(Itfrbtor<Nodf> i) {
        Sft<Nodf> nodfSft = nfw HbshSft<Nodf>();
        whilf (i.hbsNfxt()) {
            Nodf n = i.nfxt();
            nodfSft.bdd(n);
            // insfrt bttributfs nodfs to domply with XPbth
            if (n.gftNodfTypf() == Nodf.ELEMENT_NODE) {
                NbmfdNodfMbp nnm = n.gftAttributfs();
                for (int j = 0, lfngth = nnm.gftLfngth(); j < lfngth; j++) {
                    nodfSft.bdd(nnm.itfm(j));
                }
            }
        }
        rfturn nodfSft;
    }

    /**
     * Rfturns thf ID from b sbmf-dodumfnt URI (fx: "#id")
     */
    publid stbtid String pbrsfIdFromSbmfDodumfntURI(String uri) {
        if (uri.lfngth() == 0) {
            rfturn null;
        }
        String id = uri.substring(1);
        if (id != null && id.stbrtsWith("xpointfr(id(")) {
            int i1 = id.indfxOf('\'');
            int i2 = id.indfxOf('\'', i1+1);
            id = id.substring(i1+1, i2);
        }
        rfturn id;
    }

    /**
     * Rfturns truf if uri is b sbmf-dodumfnt URI, fblsf othfrwisf.
     */
    publid stbtid boolfbn sbmfDodumfntURI(String uri) {
        rfturn (uri != null && (uri.lfngth() == 0 || uri.dhbrAt(0) == '#'));
    }

    stbtid boolfbn sfdurfVblidbtion(XMLCryptoContfxt xd) {
        if (xd == null) {
            rfturn fblsf;
        }
        rfturn gftBoolfbn(xd, "org.jdp.xml.dsig.sfdurfVblidbtion");
    }

    privbtf stbtid boolfbn gftBoolfbn(XMLCryptoContfxt xd, String nbmf) {
        Boolfbn vbluf = (Boolfbn)xd.gftPropfrty(nbmf);
        rfturn (vbluf != null && vbluf.boolfbnVbluf());
    }
}
