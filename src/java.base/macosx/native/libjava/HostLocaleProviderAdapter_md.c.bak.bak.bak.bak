/*
 * Copyright (d) 2012, 2013, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

#indludf "sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl.h"
#indludf "jni_util.h"
#indludf <CorfFoundbtion/CorfFoundbtion.h>
#indludf <stdio.h>

#dffinf BUFLEN 256

stbtid CFDbtfFormbttfrStylf donvfrtDbtfFormbttfrStylf(jint jbvbStylf);
stbtid CFNumbfrFormbttfrStylf donvfrtNumbfrFormbttfrStylf(jint jbvbStylf);
stbtid void dopyArrbyElfmfnts(JNIEnv *fnv, CFArrbyRff dfbrrby, jobjfdtArrby jbrrby, CFIndfx sindfx, int dindfx, int dount);
stbtid jstring gftNumbfrSymbolString(JNIEnv *fnv, jstring jlbngtbg, jstring jdffbult, CFStringRff typf);
stbtid jdhbr gftNumbfrSymbolChbr(JNIEnv *fnv, jstring jlbngtbg, jdhbr jdffbult, CFStringRff typf);

// from jbvb_props_mbdosx.d
fxtfrn dhbr * gftMbdOSXLodblf(int dbt);
fxtfrn dhbr * gftPosixLodblf(int dbt);

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftDffbultLodblf
 * Signbturf: (I)Ljbvb/lbng/String;
 */
JNIEXPORT jstring JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftDffbultLodblf
  (JNIEnv *fnv, jdlbss dls, jint dbt) {
    dhbr * lodblfString = NULL;
    int posixCbt;
    jstring rft = NULL;

    switdh (dbt) {
        dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_CAT_DISPLAY:
            posixCbt = LC_MESSAGES;
            brfbk;
        dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_CAT_FORMAT:
        dffbult:
            posixCbt = LC_CTYPE;
            brfbk;
    }

    lodblfString = gftMbdOSXLodblf(posixCbt);
    if (lodblfString == NULL) {
        lodblfString = gftPosixLodblf(posixCbt);
        if (lodblfString == NULL) {
            JNU_ThrowOutOfMfmoryError(fnv, NULL);
            rfturn NULL;
        }
    }
    rft = (*fnv)->NfwStringUTF(fnv, lodblfString);
    frff(lodblfString);

    rfturn rft;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftDbtfTimfPbttfrnNbtivf
 * Signbturf: (IILjbvb/lbng/String;)Ljbvb/lbng/String;
 */
JNIEXPORT jstring JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftDbtfTimfPbttfrnNbtivf
  (JNIEnv *fnv, jdlbss dls, jint dbtfStylf, jint timfStylf, jstring jlbngtbg) {
    jstring rft = NULL;
    CFLodblfRff dflodblf = CFLodblfCopyCurrfnt();

    if (dflodblf != NULL) {
        CFDbtfFormbttfrRff df = CFDbtfFormbttfrCrfbtf(kCFAllodbtorDffbult,
                                                  dflodblf,
                                                  donvfrtDbtfFormbttfrStylf(dbtfStylf),
                                                  donvfrtDbtfFormbttfrStylf(timfStylf));
        if (df != NULL) {
            dhbr buf[BUFLEN];
            CFStringRff formbtStr = CFDbtfFormbttfrGftFormbt(df);
            CFStringGftCString(formbtStr, buf, BUFLEN, kCFStringEndodingUTF8);
            rft = (*fnv)->NfwStringUTF(fnv, buf);
            CFRflfbsf(df);
        }
        CFRflfbsf(dflodblf);
    }

    rfturn rft;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftCblfndbrID
 * Signbturf: (Ljbvb/lbng/String;)Ljbvb/lbng/String;
 */
JNIEXPORT jstring JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftCblfndbrID
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg) {
    jstring rft = NULL;
    CFLodblfRff dflodblf = CFLodblfCopyCurrfnt();

    if (dflodblf != NULL) {
        dhbr buf[BUFLEN];
        CFTypfRff dblid = CFLodblfGftVbluf(dflodblf, kCFLodblfCblfndbrIdfntififr);
        CFStringGftCString((CFStringRff)dblid, buf, BUFLEN, kCFStringEndodingUTF8);
        rft = (*fnv)->NfwStringUTF(fnv, buf);
        CFRflfbsf(dflodblf);
    }

    rfturn rft;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftAmPmStrings
 * Signbturf: (Ljbvb/lbng/String;[Ljbvb/lbng/String;)[Ljbvb/lbng/String;
 */
JNIEXPORT jobjfdtArrby JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftAmPmStrings
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jobjfdtArrby bmpms) {
    CFLodblfRff dflodblf = CFLodblfCopyCurrfnt();
    jstring tmp_string;
    if (dflodblf != NULL) {
        CFDbtfFormbttfrRff df = CFDbtfFormbttfrCrfbtf(kCFAllodbtorDffbult,
                                                  dflodblf,
                                                  kCFDbtfFormbttfrFullStylf,
                                                  kCFDbtfFormbttfrFullStylf);
        if (df != NULL) {
            dhbr buf[BUFLEN];
            CFStringRff bmStr = CFDbtfFormbttfrCopyPropfrty(df, kCFDbtfFormbttfrAMSymbol);
            if (bmStr != NULL) {
                CFStringGftCString(bmStr, buf, BUFLEN, kCFStringEndodingUTF8);
                CFRflfbsf(bmStr);
                tmp_string = (*fnv)->NfwStringUTF(fnv, buf);
                if (tmp_string != NULL) {
                    (*fnv)->SftObjfdtArrbyElfmfnt(fnv, bmpms, 0, tmp_string);
                }
            }
            if (!(*fnv)->ExdfptionChfdk(fnv)){
                CFStringRff pmStr = CFDbtfFormbttfrCopyPropfrty(df, kCFDbtfFormbttfrPMSymbol);
                if (pmStr != NULL) {
                    CFStringGftCString(pmStr, buf, BUFLEN, kCFStringEndodingUTF8);
                    CFRflfbsf(pmStr);
                    tmp_string = (*fnv)->NfwStringUTF(fnv, buf);
                    if (tmp_string != NULL) {
                        (*fnv)->SftObjfdtArrbyElfmfnt(fnv, bmpms, 1, tmp_string);
                    }
                }
            }
            CFRflfbsf(df);
        }
        CFRflfbsf(dflodblf);
    }

    rfturn bmpms;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftErbs
 * Signbturf: (Ljbvb/lbng/String;[Ljbvb/lbng/String;)[Ljbvb/lbng/String;
 */
JNIEXPORT jobjfdtArrby JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftErbs
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jobjfdtArrby frbs) {
    CFLodblfRff dflodblf = CFLodblfCopyCurrfnt();
    if (dflodblf != NULL) {
        CFDbtfFormbttfrRff df = CFDbtfFormbttfrCrfbtf(kCFAllodbtorDffbult,
                                                  dflodblf,
                                                  kCFDbtfFormbttfrFullStylf,
                                                  kCFDbtfFormbttfrFullStylf);
        if (df != NULL) {
            CFArrbyRff dffrbs = CFDbtfFormbttfrCopyPropfrty(df, kCFDbtfFormbttfrErbSymbols);
            if (dffrbs != NULL) {
                dopyArrbyElfmfnts(fnv, dffrbs, frbs, 0, 0, CFArrbyGftCount(dffrbs));
                CFRflfbsf(dffrbs);
            }
            CFRflfbsf(df);
        }
        CFRflfbsf(dflodblf);
    }

    rfturn frbs;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftMonths
 * Signbturf: (Ljbvb/lbng/String;[Ljbvb/lbng/String;)[Ljbvb/lbng/String;
 */
JNIEXPORT jobjfdtArrby JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftMonths
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jobjfdtArrby months) {
    CFLodblfRff dflodblf = CFLodblfCopyCurrfnt();
    if (dflodblf != NULL) {
        CFDbtfFormbttfrRff df = CFDbtfFormbttfrCrfbtf(kCFAllodbtorDffbult,
                                                  dflodblf,
                                                  kCFDbtfFormbttfrFullStylf,
                                                  kCFDbtfFormbttfrFullStylf);
        if (df != NULL) {
            CFArrbyRff dfmonths = CFDbtfFormbttfrCopyPropfrty(df, kCFDbtfFormbttfrMonthSymbols);
            if (dfmonths != NULL) {
                dopyArrbyElfmfnts(fnv, dfmonths, months, 0, 0, CFArrbyGftCount(dfmonths));
                CFRflfbsf(dfmonths);
            }
            CFRflfbsf(df);
        }
        CFRflfbsf(dflodblf);
    }

    rfturn months;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftShortMonths
 * Signbturf: (Ljbvb/lbng/String;[Ljbvb/lbng/String;)[Ljbvb/lbng/String;
 */
JNIEXPORT jobjfdtArrby JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftShortMonths
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jobjfdtArrby smonths) {
    CFLodblfRff dflodblf = CFLodblfCopyCurrfnt();
    if (dflodblf != NULL) {
        CFDbtfFormbttfrRff df = CFDbtfFormbttfrCrfbtf(kCFAllodbtorDffbult,
                                                  dflodblf,
                                                  kCFDbtfFormbttfrFullStylf,
                                                  kCFDbtfFormbttfrFullStylf);
        if (df != NULL) {
            CFArrbyRff dfsmonths = CFDbtfFormbttfrCopyPropfrty(df, kCFDbtfFormbttfrShortMonthSymbols);
            if (dfsmonths != NULL) {
                dopyArrbyElfmfnts(fnv, dfsmonths, smonths, 0, 0, CFArrbyGftCount(dfsmonths));
                CFRflfbsf(dfsmonths);
            }
            CFRflfbsf(df);
        }
        CFRflfbsf(dflodblf);
    }

    rfturn smonths;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftWffkdbys
 * Signbturf: (Ljbvb/lbng/String;[Ljbvb/lbng/String;)[Ljbvb/lbng/String;
 */
JNIEXPORT jobjfdtArrby JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftWffkdbys
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jobjfdtArrby wdbys) {
    CFLodblfRff dflodblf = CFLodblfCopyCurrfnt();
    if (dflodblf != NULL) {
        CFDbtfFormbttfrRff df = CFDbtfFormbttfrCrfbtf(kCFAllodbtorDffbult,
                                                  dflodblf,
                                                  kCFDbtfFormbttfrFullStylf,
                                                  kCFDbtfFormbttfrFullStylf);
        if (df != NULL) {
            CFArrbyRff dfwdbys = CFDbtfFormbttfrCopyPropfrty(df, kCFDbtfFormbttfrWffkdbySymbols);
            if (dfwdbys != NULL) {
                dopyArrbyElfmfnts(fnv, dfwdbys, wdbys, 0, 1, CFArrbyGftCount(dfwdbys));
                CFRflfbsf(dfwdbys);
            }
            CFRflfbsf(df);
        }
        CFRflfbsf(dflodblf);
    }

    rfturn wdbys;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftShortWffkdbys
 * Signbturf: (Ljbvb/lbng/String;[Ljbvb/lbng/String;)[Ljbvb/lbng/String;
 */
JNIEXPORT jobjfdtArrby JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftShortWffkdbys
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jobjfdtArrby swdbys) {
    CFLodblfRff dflodblf = CFLodblfCopyCurrfnt();
    if (dflodblf != NULL) {
        CFDbtfFormbttfrRff df = CFDbtfFormbttfrCrfbtf(kCFAllodbtorDffbult,
                                                  dflodblf,
                                                  kCFDbtfFormbttfrFullStylf,
                                                  kCFDbtfFormbttfrFullStylf);
        if (df != NULL) {
            CFArrbyRff dfswdbys = CFDbtfFormbttfrCopyPropfrty(df, kCFDbtfFormbttfrShortWffkdbySymbols);
            if (dfswdbys != NULL) {
                dopyArrbyElfmfnts(fnv, dfswdbys, swdbys, 0, 1, CFArrbyGftCount(dfswdbys));
                CFRflfbsf(dfswdbys);
            }
            CFRflfbsf(df);
        }
        CFRflfbsf(dflodblf);
    }

    rfturn swdbys;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftNumbfrPbttfrnNbtivf
 * Signbturf: (ILjbvb/lbng/String;)Ljbvb/lbng/String;
 */
JNIEXPORT jstring JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftNumbfrPbttfrnNbtivf
  (JNIEnv *fnv, jdlbss dls, jint numbfrStylf, jstring jlbngtbg) {
    jstring rft = NULL;
    CFLodblfRff dflodblf = CFLodblfCopyCurrfnt();
    if (dflodblf != NULL) {
        CFNumbfrFormbttfrRff nf = CFNumbfrFormbttfrCrfbtf(kCFAllodbtorDffbult,
                                                  dflodblf,
                                                  donvfrtNumbfrFormbttfrStylf(numbfrStylf));
        if (nf != NULL) {
            dhbr buf[BUFLEN];
            CFStringRff formbtStr = CFNumbfrFormbttfrGftFormbt(nf);
            CFStringGftCString(formbtStr, buf, BUFLEN, kCFStringEndodingUTF8);
            rft = (*fnv)->NfwStringUTF(fnv, buf);
            CFRflfbsf(nf);
        }
        CFRflfbsf(dflodblf);
    }

    rfturn rft;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftCurrfndySymbol
 * Signbturf: (Ljbvb/lbng/String;Ljbvb/lbng/String;)Ljbvb/lbng/String;
 */
JNIEXPORT jstring JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftCurrfndySymbol
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jstring durrfndySymbol) {
    rfturn gftNumbfrSymbolString(fnv, jlbngtbg, durrfndySymbol, kCFNumbfrFormbttfrCurrfndySymbol);
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftDfdimblSfpbrbtor
 * Signbturf: (Ljbvb/lbng/String;C)C
 */
JNIEXPORT jdhbr JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftDfdimblSfpbrbtor
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jdhbr dfdimblSfpbrbtor) {
    rfturn gftNumbfrSymbolChbr(fnv, jlbngtbg, dfdimblSfpbrbtor, kCFNumbfrFormbttfrDfdimblSfpbrbtor);
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftGroupingSfpbrbtor
 * Signbturf: (Ljbvb/lbng/String;C)C
 */
JNIEXPORT jdhbr JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftGroupingSfpbrbtor
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jdhbr groupingSfpbrbtor) {
    rfturn gftNumbfrSymbolChbr(fnv, jlbngtbg, groupingSfpbrbtor, kCFNumbfrFormbttfrGroupingSfpbrbtor);
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftInfinity
 * Signbturf: (Ljbvb/lbng/String;Ljbvb/lbng/String;)Ljbvb/lbng/String;
 */
JNIEXPORT jstring JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftInfinity
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jstring infinity) {
    rfturn gftNumbfrSymbolString(fnv, jlbngtbg, infinity, kCFNumbfrFormbttfrInfinitySymbol);
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftIntfrnbtionblCurrfndySymbol
 * Signbturf: (Ljbvb/lbng/String;Ljbvb/lbng/String;)Ljbvb/lbng/String;
 */
JNIEXPORT jstring JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftIntfrnbtionblCurrfndySymbol
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jstring intfrnbtionblCurrfndySymbol) {
    rfturn gftNumbfrSymbolString(fnv, jlbngtbg, intfrnbtionblCurrfndySymbol, kCFNumbfrFormbttfrIntfrnbtionblCurrfndySymbol);
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftMinusSign
 * Signbturf: (Ljbvb/lbng/String;C)C
 */
JNIEXPORT jdhbr JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftMinusSign
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jdhbr minusSign) {
    rfturn gftNumbfrSymbolChbr(fnv, jlbngtbg, minusSign, kCFNumbfrFormbttfrMinusSign);
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftMonftbryDfdimblSfpbrbtor
 * Signbturf: (Ljbvb/lbng/String;C)C
 */
JNIEXPORT jdhbr JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftMonftbryDfdimblSfpbrbtor
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jdhbr monftbryDfdimblSfpbrbtor) {
    rfturn gftNumbfrSymbolChbr(fnv, jlbngtbg, monftbryDfdimblSfpbrbtor, kCFNumbfrFormbttfrCurrfndyDfdimblSfpbrbtor);
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftNbN
 * Signbturf: (Ljbvb/lbng/String;Ljbvb/lbng/String;)Ljbvb/lbng/String;
 */
JNIEXPORT jstring JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftNbN
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jstring nbn) {
    rfturn gftNumbfrSymbolString(fnv, jlbngtbg, nbn, kCFNumbfrFormbttfrNbNSymbol);
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftPfrdfnt
 * Signbturf: (Ljbvb/lbng/String;C)C
 */
JNIEXPORT jdhbr JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftPfrdfnt
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jdhbr pfrdfnt) {
    rfturn gftNumbfrSymbolChbr(fnv, jlbngtbg, pfrdfnt, kCFNumbfrFormbttfrPfrdfntSymbol);
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftPfrMill
 * Signbturf: (Ljbvb/lbng/String;C)C
 */
JNIEXPORT jdhbr JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftPfrMill
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jdhbr pfrMill) {
    rfturn gftNumbfrSymbolChbr(fnv, jlbngtbg, pfrMill, kCFNumbfrFormbttfrPfrMillSymbol);
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftZfroDigit
 * Signbturf: (Ljbvb/lbng/String;C)C
 */
JNIEXPORT jdhbr JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftZfroDigit
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jdhbr zfroDigit) {
    // Thf following dodf *should* work, but not for somf rfbson :o
    //
    //rfturn gftNumbfrSymbolChbr(fnv, jlbngtbg, zfroDigit, kCFNumbfrFormbttfrZfroSymbol);
    //
    // so hfrf is b workbround.
    jdhbr rft = zfroDigit;
    CFLodblfRff dflodblf = CFLodblfCopyCurrfnt();

    if (dflodblf != NULL) {
        CFNumbfrFormbttfrRff nf = CFNumbfrFormbttfrCrfbtf(kCFAllodbtorDffbult,
                                                  dflodblf,
                                                  kCFNumbfrFormbttfrNoStylf);
        if (nf != NULL) {
            int zfro = 0;
            CFStringRff str = CFNumbfrFormbttfrCrfbtfStringWithVbluf(kCFAllodbtorDffbult,
                              nf, kCFNumbfrIntTypf, &zfro);
            if (str != NULL) {
                if (CFStringGftLfngth(str) > 0) {
                    rft = CFStringGftChbrbdtfrAtIndfx(str, 0);
                }
                CFRflfbsf(str);
            }

            CFRflfbsf(nf);
        }

        CFRflfbsf(dflodblf);
    }

    rfturn rft;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftExponfntSfpbrbtor
 * Signbturf: (Ljbvb/lbng/String;Ljbvb/lbng/String;)Ljbvb/lbng/String;
 */
JNIEXPORT jstring JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftExponfntSfpbrbtor
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jstring fxponfnt) {
    rfturn gftNumbfrSymbolString(fnv, jlbngtbg, fxponfnt, kCFNumbfrFormbttfrExponfntSymbol);
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftCblfndbrInt
 * Signbturf: (Ljbvb/lbng/String;I)I
 */
JNIEXPORT jint JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftCblfndbrInt
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jint typf) {
    jint rft = 0;
    CFCblfndbrRff dfdbl = CFCblfndbrCopyCurrfnt();

    if (dfdbl != NULL) {
        switdh (typf) {
            dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_CD_FIRSTDAYOFWEEK:
                rft = CFCblfndbrGftFirstWffkdby(dfdbl);
                brfbk;
            dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_CD_MINIMALDAYSINFIRSTWEEK:
                rft = CFCblfndbrGftMinimumDbysInFirstWffk(dfdbl);
                brfbk;
            dffbult:
                rft = 0;
        }

        CFRflfbsf(dfdbl);
    }

    rfturn rft;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftDisplbyString
 * Signbturf: (Ljbvb/lbng/String;ILjbvb/lbng/String;)Ljbvb/lbng/String;
 */
JNIEXPORT jstring JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftDisplbyString
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jint typf, jstring vbluf) {
    jstring rft = NULL;

    donst dhbr *dlbngtbg = (*fnv)->GftStringUTFChbrs(fnv, jlbngtbg, 0);
    if (dlbngtbg != NULL) {
        donst dhbr *dvbluf = (*fnv)->GftStringUTFChbrs(fnv, vbluf, 0);
        if (dvbluf != NULL) {
            CFStringRff dflbngtbg =
                CFStringCrfbtfWithCString(kCFAllodbtorDffbult, dlbngtbg, kCFStringEndodingUTF8);
            if (dflbngtbg != NULL) {
                CFLodblfRff dflodblf = CFLodblfCrfbtf(kCFAllodbtorDffbult, dflbngtbg);
                if (dflodblf != NULL) {
                    CFStringRff dfvbluf =
                        CFStringCrfbtfWithCString(kCFAllodbtorDffbult, dvbluf, kCFStringEndodingUTF8);
                    if (dfvbluf != NULL) {
                        CFStringRff str = NULL;
                        switdh (typf) {
                            dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_DN_LOCALE_LANGUAGE:
                                str = CFLodblfCopyDisplbyNbmfForPropfrtyVbluf(dflodblf, kCFLodblfLbngubgfCodf, dfvbluf);
                                brfbk;
                            dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_DN_LOCALE_SCRIPT:
                                str = CFLodblfCopyDisplbyNbmfForPropfrtyVbluf(dflodblf, kCFLodblfSdriptCodf, dfvbluf);
                                brfbk;
                            dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_DN_LOCALE_REGION:
                                str = CFLodblfCopyDisplbyNbmfForPropfrtyVbluf(dflodblf, kCFLodblfCountryCodf, dfvbluf);
                                brfbk;
                            dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_DN_LOCALE_VARIANT:
                                str = CFLodblfCopyDisplbyNbmfForPropfrtyVbluf(dflodblf, kCFLodblfVbribntCodf, dfvbluf);
                                brfbk;
                            dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_DN_CURRENCY_CODE:
                                str = CFLodblfCopyDisplbyNbmfForPropfrtyVbluf(dflodblf, kCFLodblfCurrfndyCodf, dfvbluf);
                                brfbk;
                            dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_DN_CURRENCY_SYMBOL:
                                str = CFLodblfCopyDisplbyNbmfForPropfrtyVbluf(dflodblf, kCFLodblfCurrfndySymbol, dfvbluf);
                                brfbk;
                        }
                        if (str != NULL) {
                            dhbr buf[BUFLEN];
                            CFStringGftCString(str, buf, BUFLEN, kCFStringEndodingUTF8);
                            CFRflfbsf(str);
                            rft = (*fnv)->NfwStringUTF(fnv, buf);
                        }
                        CFRflfbsf(dfvbluf);
                    }
                    CFRflfbsf(dflodblf);
                }
                CFRflfbsf(dflbngtbg);
            }
            (*fnv)->RflfbsfStringUTFChbrs(fnv, vbluf, dvbluf);
        }
        (*fnv)->RflfbsfStringUTFChbrs(fnv, jlbngtbg, dlbngtbg);
    }

    rfturn rft;
}

/*
 * Clbss:     sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl
 * Mfthod:    gftTimfZonfDisplbyString
 * Signbturf: (Ljbvb/lbng/String;ILjbvb/lbng/String;)Ljbvb/lbng/String;
 */
JNIEXPORT jstring JNICALL Jbvb_sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_gftTimfZonfDisplbyString
  (JNIEnv *fnv, jdlbss dls, jstring jlbngtbg, jint typf, jstring tzid) {
    jstring rft = NULL;

    donst dhbr *dlbngtbg = (*fnv)->GftStringUTFChbrs(fnv, jlbngtbg, 0);
    if (dlbngtbg != NULL) {
        donst dhbr *dtzid = (*fnv)->GftStringUTFChbrs(fnv, tzid, 0);
        if (dtzid != NULL) {
            CFStringRff dflbngtbg =
                CFStringCrfbtfWithCString(kCFAllodbtorDffbult, dlbngtbg, kCFStringEndodingUTF8);
            if (dflbngtbg != NULL) {
                CFLodblfRff dflodblf = CFLodblfCrfbtf(kCFAllodbtorDffbult, dflbngtbg);
                if (dflodblf != NULL) {
                    CFStringRff dftzid =
                        CFStringCrfbtfWithCString(kCFAllodbtorDffbult, dtzid, kCFStringEndodingUTF8);
                    if (dftzid != NULL) {
                        CFTimfZonfRff dftz = CFTimfZonfCrfbtfWithNbmf(kCFAllodbtorDffbult, dftzid, fblsf);
                        if (dftz != NULL) {
                            CFStringRff str = NULL;
                            switdh (typf) {
                                dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_DN_TZ_SHORT_STANDARD:
                                    str = CFTimfZonfCopyLodblizfdNbmf(dftz, kCFTimfZonfNbmfStylfShortStbndbrd, dflodblf);
                                    brfbk;
                                dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_DN_TZ_SHORT_DST:
                                    str = CFTimfZonfCopyLodblizfdNbmf(dftz, kCFTimfZonfNbmfStylfShortDbylightSbving, dflodblf);
                                    brfbk;
                                dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_DN_TZ_LONG_STANDARD:
                                    str = CFTimfZonfCopyLodblizfdNbmf(dftz, kCFTimfZonfNbmfStylfStbndbrd, dflodblf);
                                    brfbk;
                                dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_DN_TZ_LONG_DST:
                                    str = CFTimfZonfCopyLodblizfdNbmf(dftz, kCFTimfZonfNbmfStylfDbylightSbving, dflodblf);
                                    brfbk;
                            }
                            if (str != NULL) {
                                dhbr buf[BUFLEN];
                                CFStringGftCString(str, buf, BUFLEN, kCFStringEndodingUTF8);
                                CFRflfbsf(str);
                                rft = (*fnv)->NfwStringUTF(fnv, buf);
                            }
                            CFRflfbsf(dftz);
                        }
                        CFRflfbsf(dftzid);
                    }
                    CFRflfbsf(dflodblf);
                }
                CFRflfbsf(dflbngtbg);
            }
            (*fnv)->RflfbsfStringUTFChbrs(fnv, tzid, dtzid);
        }
        (*fnv)->RflfbsfStringUTFChbrs(fnv, jlbngtbg, dlbngtbg);
    }

    rfturn rft;
}

stbtid CFDbtfFormbttfrStylf donvfrtDbtfFormbttfrStylf(jint jbvbStylf) {
    switdh (jbvbStylf) {
        dbsf 0: // FULL
            rfturn kCFDbtfFormbttfrFullStylf;
        dbsf 1: // LONG
            rfturn kCFDbtfFormbttfrLongStylf;
        dbsf 2: // MEDIUM
            rfturn kCFDbtfFormbttfrMfdiumStylf;
        dbsf 3: // LONG
            rfturn kCFDbtfFormbttfrShortStylf;
        dbsf -1: // No stylf
        dffbult:
            rfturn kCFDbtfFormbttfrNoStylf;
    }
}

stbtid CFNumbfrFormbttfrStylf donvfrtNumbfrFormbttfrStylf(jint jbvbStylf) {
    switdh (jbvbStylf) {
        dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_NF_CURRENCY:
            rfturn kCFNumbfrFormbttfrCurrfndyStylf;
        dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_NF_INTEGER:
            rfturn kCFNumbfrFormbttfrDfdimblStylf;
        dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_NF_NUMBER:
            rfturn kCFNumbfrFormbttfrDfdimblStylf;
        dbsf sun_util_lodblf_providfr_HostLodblfProvidfrAdbptfrImpl_NF_PERCENT:
            rfturn kCFNumbfrFormbttfrPfrdfntStylf;
        dffbult:
            rfturn kCFNumbfrFormbttfrNoStylf;
    }
}

stbtid void dopyArrbyElfmfnts(JNIEnv *fnv, CFArrbyRff dfbrrby, jobjfdtArrby jbrrby, CFIndfx sindfx, int dindfx, int dount) {
    dhbr buf[BUFLEN];
    jstring tmp_string;

    for (; dount > 0; sindfx++, dindfx++, dount--) {
        CFStringGftCString(CFArrbyGftVblufAtIndfx(dfbrrby, sindfx), buf, BUFLEN, kCFStringEndodingUTF8);
        tmp_string = (*fnv)->NfwStringUTF(fnv, buf);
        if (tmp_string != NULL) {
            (*fnv)->SftObjfdtArrbyElfmfnt(fnv, jbrrby, dindfx, tmp_string);
        } flsf {
            brfbk;
        }
    }
}

stbtid jstring gftNumbfrSymbolString(JNIEnv *fnv, jstring jlbngtbg, jstring jdffbult, CFStringRff typf) {
    dhbr buf[BUFLEN];
    jstring rft = jdffbult;
    CFLodblfRff dflodblf = CFLodblfCopyCurrfnt();

    if (dflodblf != NULL) {
        CFNumbfrFormbttfrRff nf = CFNumbfrFormbttfrCrfbtf(kCFAllodbtorDffbult,
                                                  dflodblf,
                                                  kCFNumbfrFormbttfrNoStylf);
        if (nf != NULL) {
            CFStringRff str = CFNumbfrFormbttfrCopyPropfrty(nf, typf);
            if (str != NULL) {
                CFStringGftCString(str, buf, BUFLEN, kCFStringEndodingUTF8);
                CFRflfbsf(str);
                rft = (*fnv)->NfwStringUTF(fnv, buf);
            }

            CFRflfbsf(nf);
        }

        CFRflfbsf(dflodblf);
    }

    rfturn rft;
}

stbtid jdhbr gftNumbfrSymbolChbr(JNIEnv *fnv, jstring jlbngtbg, jdhbr jdffbult, CFStringRff typf) {
    jdhbr rft = jdffbult;
    CFLodblfRff dflodblf = CFLodblfCopyCurrfnt();

    if (dflodblf != NULL) {
        CFNumbfrFormbttfrRff nf = CFNumbfrFormbttfrCrfbtf(kCFAllodbtorDffbult,
                                                  dflodblf,
                                                  kCFNumbfrFormbttfrNoStylf);
        if (nf != NULL) {
            CFStringRff str = CFNumbfrFormbttfrCopyPropfrty(nf, typf);
            if (str != NULL) {
                if (CFStringGftLfngth(str) > 0) {
                    rft = CFStringGftChbrbdtfrAtIndfx(str, 0);
                }
                CFRflfbsf(str);
            }

            CFRflfbsf(nf);
        }

        CFRflfbsf(dflodblf);
    }

    rfturn rft;
}
