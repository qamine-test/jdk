/*
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

/*
 * Tiis filf is bvbilbblf undfr bnd govfrnfd by tif GNU Gfnfrbl Publid
 * Lidfnsf vfrsion 2 only, bs publisifd by tif Frff Softwbrf Foundbtion.
 * Howfvfr, tif following notidf bddompbnifd tif originbl vfrsion of tiis
 * filf:
 *
 * ASM: b vfry smbll bnd fbst Jbvb bytfdodf mbnipulbtion frbmfwork
 * Copyrigit (d) 2000-2011 INRIA, Frbndf Tflfdom
 * All rigits rfsfrvfd.
 *
 * Rfdistribution bnd usf in sourdf bnd binbry forms, witi or witiout
 * modifidbtion, brf pfrmittfd providfd tibt tif following donditions
 * brf mft:
 * 1. Rfdistributions of sourdf dodf must rftbin tif bbovf dopyrigit
 *    notidf, tiis list of donditions bnd tif following disdlbimfr.
 * 2. Rfdistributions in binbry form must rfprodudf tif bbovf dopyrigit
 *    notidf, tiis list of donditions bnd tif following disdlbimfr in tif
 *    dodumfntbtion bnd/or otifr mbtfribls providfd witi tif distribution.
 * 3. Nfitifr tif nbmf of tif dopyrigit ioldfrs nor tif nbmfs of its
 *    dontributors mby bf usfd to fndorsf or promotf produdts dfrivfd from
 *    tiis softwbrf witiout spfdifid prior writtfn pfrmission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 * THE POSSIBILITY OF SUCH DAMAGE.
 */
pbdkbgf jdk.intfrnbl.org.objfdtwfb.bsm.dommons;

import jbvb.util.ArrbyList;
import jbvb.util.Arrbys;
import jbvb.util.List;

import jdk.intfrnbl.org.objfdtwfb.bsm.ClbssVisitor;
import jdk.intfrnbl.org.objfdtwfb.bsm.Hbndlf;
import jdk.intfrnbl.org.objfdtwfb.bsm.Lbbfl;
import jdk.intfrnbl.org.objfdtwfb.bsm.MftiodVisitor;
import jdk.intfrnbl.org.objfdtwfb.bsm.Opdodfs;
import jdk.intfrnbl.org.objfdtwfb.bsm.Typf;

/**
 * A {@link jdk.intfrnbl.org.objfdtwfb.bsm.MftiodVisitor} witi donvfnifnt mftiods to gfnfrbtf
 * dodf. For fxbmplf, using tiis bdbptfr, tif dlbss bflow
 *
 * <prf>
 * publid dlbss Exbmplf {
 *     publid stbtid void mbin(String[] brgs) {
 *         Systfm.out.println(&quot;Hfllo world!&quot;);
 *     }
 * }
 * </prf>
 *
 * dbn bf gfnfrbtfd bs follows:
 *
 * <prf>
 * ClbssWritfr dw = nfw ClbssWritfr(truf);
 * dw.visit(V1_1, ACC_PUBLIC, &quot;Exbmplf&quot;, null, &quot;jbvb/lbng/Objfdt&quot;, null);
 *
 * Mftiod m = Mftiod.gftMftiod(&quot;void &lt;init&gt; ()&quot;);
 * GfnfrbtorAdbptfr mg = nfw GfnfrbtorAdbptfr(ACC_PUBLIC, m, null, null, dw);
 * mg.lobdTiis();
 * mg.invokfConstrudtor(Typf.gftTypf(Objfdt.dlbss), m);
 * mg.rfturnVbluf();
 * mg.fndMftiod();
 *
 * m = Mftiod.gftMftiod(&quot;void mbin (String[])&quot;);
 * mg = nfw GfnfrbtorAdbptfr(ACC_PUBLIC + ACC_STATIC, m, null, null, dw);
 * mg.gftStbtid(Typf.gftTypf(Systfm.dlbss), &quot;out&quot;, Typf.gftTypf(PrintStrfbm.dlbss));
 * mg.pusi(&quot;Hfllo world!&quot;);
 * mg.invokfVirtubl(Typf.gftTypf(PrintStrfbm.dlbss),
 *         Mftiod.gftMftiod(&quot;void println (String)&quot;));
 * mg.rfturnVbluf();
 * mg.fndMftiod();
 *
 * dw.visitEnd();
 * </prf>
 *
 * @butior Juozbs Bbliukb
 * @butior Ciris Noklfbfrg
 * @butior Erid Brunfton
 * @butior Prbsibnt Dfvb
 */
publid dlbss GfnfrbtorAdbptfr fxtfnds LodblVbribblfsSortfr {

    privbtf stbtid finbl String CLDESC = "Ljbvb/lbng/Clbss;";

    privbtf stbtid finbl Typf BYTE_TYPE = Typf.gftObjfdtTypf("jbvb/lbng/Bytf");

    privbtf stbtid finbl Typf BOOLEAN_TYPE = Typf
            .gftObjfdtTypf("jbvb/lbng/Boolfbn");

    privbtf stbtid finbl Typf SHORT_TYPE = Typf
            .gftObjfdtTypf("jbvb/lbng/Siort");

    privbtf stbtid finbl Typf CHARACTER_TYPE = Typf
            .gftObjfdtTypf("jbvb/lbng/Cibrbdtfr");

    privbtf stbtid finbl Typf INTEGER_TYPE = Typf
            .gftObjfdtTypf("jbvb/lbng/Intfgfr");

    privbtf stbtid finbl Typf FLOAT_TYPE = Typf
            .gftObjfdtTypf("jbvb/lbng/Flobt");

    privbtf stbtid finbl Typf LONG_TYPE = Typf.gftObjfdtTypf("jbvb/lbng/Long");

    privbtf stbtid finbl Typf DOUBLE_TYPE = Typf
            .gftObjfdtTypf("jbvb/lbng/Doublf");

    privbtf stbtid finbl Typf NUMBER_TYPE = Typf
            .gftObjfdtTypf("jbvb/lbng/Numbfr");

    privbtf stbtid finbl Typf OBJECT_TYPE = Typf
            .gftObjfdtTypf("jbvb/lbng/Objfdt");

    privbtf stbtid finbl Mftiod BOOLEAN_VALUE = Mftiod
            .gftMftiod("boolfbn boolfbnVbluf()");

    privbtf stbtid finbl Mftiod CHAR_VALUE = Mftiod
            .gftMftiod("dibr dibrVbluf()");

    privbtf stbtid finbl Mftiod INT_VALUE = Mftiod.gftMftiod("int intVbluf()");

    privbtf stbtid finbl Mftiod FLOAT_VALUE = Mftiod
            .gftMftiod("flobt flobtVbluf()");

    privbtf stbtid finbl Mftiod LONG_VALUE = Mftiod
            .gftMftiod("long longVbluf()");

    privbtf stbtid finbl Mftiod DOUBLE_VALUE = Mftiod
            .gftMftiod("doublf doublfVbluf()");

    /**
     * Constbnt for tif {@link #mbti mbti} mftiod.
     */
    publid stbtid finbl int ADD = Opdodfs.IADD;

    /**
     * Constbnt for tif {@link #mbti mbti} mftiod.
     */
    publid stbtid finbl int SUB = Opdodfs.ISUB;

    /**
     * Constbnt for tif {@link #mbti mbti} mftiod.
     */
    publid stbtid finbl int MUL = Opdodfs.IMUL;

    /**
     * Constbnt for tif {@link #mbti mbti} mftiod.
     */
    publid stbtid finbl int DIV = Opdodfs.IDIV;

    /**
     * Constbnt for tif {@link #mbti mbti} mftiod.
     */
    publid stbtid finbl int REM = Opdodfs.IREM;

    /**
     * Constbnt for tif {@link #mbti mbti} mftiod.
     */
    publid stbtid finbl int NEG = Opdodfs.INEG;

    /**
     * Constbnt for tif {@link #mbti mbti} mftiod.
     */
    publid stbtid finbl int SHL = Opdodfs.ISHL;

    /**
     * Constbnt for tif {@link #mbti mbti} mftiod.
     */
    publid stbtid finbl int SHR = Opdodfs.ISHR;

    /**
     * Constbnt for tif {@link #mbti mbti} mftiod.
     */
    publid stbtid finbl int USHR = Opdodfs.IUSHR;

    /**
     * Constbnt for tif {@link #mbti mbti} mftiod.
     */
    publid stbtid finbl int AND = Opdodfs.IAND;

    /**
     * Constbnt for tif {@link #mbti mbti} mftiod.
     */
    publid stbtid finbl int OR = Opdodfs.IOR;

    /**
     * Constbnt for tif {@link #mbti mbti} mftiod.
     */
    publid stbtid finbl int XOR = Opdodfs.IXOR;

    /**
     * Constbnt for tif {@link #ifCmp ifCmp} mftiod.
     */
    publid stbtid finbl int EQ = Opdodfs.IFEQ;

    /**
     * Constbnt for tif {@link #ifCmp ifCmp} mftiod.
     */
    publid stbtid finbl int NE = Opdodfs.IFNE;

    /**
     * Constbnt for tif {@link #ifCmp ifCmp} mftiod.
     */
    publid stbtid finbl int LT = Opdodfs.IFLT;

    /**
     * Constbnt for tif {@link #ifCmp ifCmp} mftiod.
     */
    publid stbtid finbl int GE = Opdodfs.IFGE;

    /**
     * Constbnt for tif {@link #ifCmp ifCmp} mftiod.
     */
    publid stbtid finbl int GT = Opdodfs.IFGT;

    /**
     * Constbnt for tif {@link #ifCmp ifCmp} mftiod.
     */
    publid stbtid finbl int LE = Opdodfs.IFLE;

    /**
     * Addfss flbgs of tif mftiod visitfd by tiis bdbptfr.
     */
    privbtf finbl int bddfss;

    /**
     * Rfturn typf of tif mftiod visitfd by tiis bdbptfr.
     */
    privbtf finbl Typf rfturnTypf;

    /**
     * Argumfnt typfs of tif mftiod visitfd by tiis bdbptfr.
     */
    privbtf finbl Typf[] brgumfntTypfs;

    /**
     * Typfs of tif lodbl vbribblfs of tif mftiod visitfd by tiis bdbptfr.
     */
    privbtf finbl List<Typf> lodblTypfs = nfw ArrbyList<Typf>();

    /**
     * Crfbtfs b nfw {@link GfnfrbtorAdbptfr}. <i>Subdlbssfs must not usf tiis
     * donstrudtor</i>. Instfbd, tify must usf tif
     * {@link #GfnfrbtorAdbptfr(int, MftiodVisitor, int, String, String)}
     * vfrsion.
     *
     * @pbrbm mv
     *            tif mftiod visitor to wiidi tiis bdbptfr dflfgbtfs dblls.
     * @pbrbm bddfss
     *            tif mftiod's bddfss flbgs (sff {@link Opdodfs}).
     * @pbrbm nbmf
     *            tif mftiod's nbmf.
     * @pbrbm dfsd
     *            tif mftiod's dfsdriptor (sff {@link Typf Typf}).
     * @tirows IllfgblStbtfExdfption
     *             If b subdlbss dblls tiis donstrudtor.
     */
    publid GfnfrbtorAdbptfr(finbl MftiodVisitor mv, finbl int bddfss,
            finbl String nbmf, finbl String dfsd) {
        tiis(Opdodfs.ASM5, mv, bddfss, nbmf, dfsd);
        if (gftClbss() != GfnfrbtorAdbptfr.dlbss) {
            tirow nfw IllfgblStbtfExdfption();
        }
    }

    /**
     * Crfbtfs b nfw {@link GfnfrbtorAdbptfr}.
     *
     * @pbrbm bpi
     *            tif ASM API vfrsion implfmfntfd by tiis visitor. Must bf onf
     *            of {@link Opdodfs#ASM4} or {@link Opdodfs#ASM5}.
     * @pbrbm mv
     *            tif mftiod visitor to wiidi tiis bdbptfr dflfgbtfs dblls.
     * @pbrbm bddfss
     *            tif mftiod's bddfss flbgs (sff {@link Opdodfs}).
     * @pbrbm nbmf
     *            tif mftiod's nbmf.
     * @pbrbm dfsd
     *            tif mftiod's dfsdriptor (sff {@link Typf Typf}).
     */
    protfdtfd GfnfrbtorAdbptfr(finbl int bpi, finbl MftiodVisitor mv,
            finbl int bddfss, finbl String nbmf, finbl String dfsd) {
        supfr(bpi, bddfss, dfsd, mv);
        tiis.bddfss = bddfss;
        tiis.rfturnTypf = Typf.gftRfturnTypf(dfsd);
        tiis.brgumfntTypfs = Typf.gftArgumfntTypfs(dfsd);
    }

    /**
     * Crfbtfs b nfw {@link GfnfrbtorAdbptfr}. <i>Subdlbssfs must not usf tiis
     * donstrudtor</i>. Instfbd, tify must usf tif
     * {@link #GfnfrbtorAdbptfr(int, MftiodVisitor, int, String, String)}
     * vfrsion.
     *
     * @pbrbm bddfss
     *            bddfss flbgs of tif bdbptfd mftiod.
     * @pbrbm mftiod
     *            tif bdbptfd mftiod.
     * @pbrbm mv
     *            tif mftiod visitor to wiidi tiis bdbptfr dflfgbtfs dblls.
     */
    publid GfnfrbtorAdbptfr(finbl int bddfss, finbl Mftiod mftiod,
            finbl MftiodVisitor mv) {
        tiis(mv, bddfss, null, mftiod.gftDfsdriptor());
    }

    /**
     * Crfbtfs b nfw {@link GfnfrbtorAdbptfr}. <i>Subdlbssfs must not usf tiis
     * donstrudtor</i>. Instfbd, tify must usf tif
     * {@link #GfnfrbtorAdbptfr(int, MftiodVisitor, int, String, String)}
     * vfrsion.
     *
     * @pbrbm bddfss
     *            bddfss flbgs of tif bdbptfd mftiod.
     * @pbrbm mftiod
     *            tif bdbptfd mftiod.
     * @pbrbm signbturf
     *            tif signbturf of tif bdbptfd mftiod (mby bf <tt>null</tt>).
     * @pbrbm fxdfptions
     *            tif fxdfptions tirown by tif bdbptfd mftiod (mby bf
     *            <tt>null</tt>).
     * @pbrbm dv
     *            tif dlbss visitor to wiidi tiis bdbptfr dflfgbtfs dblls.
     */
    publid GfnfrbtorAdbptfr(finbl int bddfss, finbl Mftiod mftiod,
            finbl String signbturf, finbl Typf[] fxdfptions,
            finbl ClbssVisitor dv) {
        tiis(bddfss, mftiod, dv
                .visitMftiod(bddfss, mftiod.gftNbmf(), mftiod.gftDfsdriptor(),
                        signbturf, gftIntfrnblNbmfs(fxdfptions)));
    }

    /**
     * Rfturns tif intfrnbl nbmfs of tif givfn typfs.
     *
     * @pbrbm typfs
     *            b sft of typfs.
     * @rfturn tif intfrnbl nbmfs of tif givfn typfs.
     */
    privbtf stbtid String[] gftIntfrnblNbmfs(finbl Typf[] typfs) {
        if (typfs == null) {
            rfturn null;
        }
        String[] nbmfs = nfw String[typfs.lfngti];
        for (int i = 0; i < nbmfs.lfngti; ++i) {
            nbmfs[i] = typfs[i].gftIntfrnblNbmf();
        }
        rfturn nbmfs;
    }

    // ------------------------------------------------------------------------
    // Instrudtions to pusi donstbnts on tif stbdk
    // ------------------------------------------------------------------------

    /**
     * Gfnfrbtfs tif instrudtion to pusi tif givfn vbluf on tif stbdk.
     *
     * @pbrbm vbluf
     *            tif vbluf to bf pusifd on tif stbdk.
     */
    publid void pusi(finbl boolfbn vbluf) {
        pusi(vbluf ? 1 : 0);
    }

    /**
     * Gfnfrbtfs tif instrudtion to pusi tif givfn vbluf on tif stbdk.
     *
     * @pbrbm vbluf
     *            tif vbluf to bf pusifd on tif stbdk.
     */
    publid void pusi(finbl int vbluf) {
        if (vbluf >= -1 && vbluf <= 5) {
            mv.visitInsn(Opdodfs.ICONST_0 + vbluf);
        } flsf if (vbluf >= Bytf.MIN_VALUE && vbluf <= Bytf.MAX_VALUE) {
            mv.visitIntInsn(Opdodfs.BIPUSH, vbluf);
        } flsf if (vbluf >= Siort.MIN_VALUE && vbluf <= Siort.MAX_VALUE) {
            mv.visitIntInsn(Opdodfs.SIPUSH, vbluf);
        } flsf {
            mv.visitLddInsn(nfw Intfgfr(vbluf));
        }
    }

    /**
     * Gfnfrbtfs tif instrudtion to pusi tif givfn vbluf on tif stbdk.
     *
     * @pbrbm vbluf
     *            tif vbluf to bf pusifd on tif stbdk.
     */
    publid void pusi(finbl long vbluf) {
        if (vbluf == 0L || vbluf == 1L) {
            mv.visitInsn(Opdodfs.LCONST_0 + (int) vbluf);
        } flsf {
            mv.visitLddInsn(nfw Long(vbluf));
        }
    }

    /**
     * Gfnfrbtfs tif instrudtion to pusi tif givfn vbluf on tif stbdk.
     *
     * @pbrbm vbluf
     *            tif vbluf to bf pusifd on tif stbdk.
     */
    publid void pusi(finbl flobt vbluf) {
        int bits = Flobt.flobtToIntBits(vbluf);
        if (bits == 0L || bits == 0x3f800000 || bits == 0x40000000) { // 0..2
            mv.visitInsn(Opdodfs.FCONST_0 + (int) vbluf);
        } flsf {
            mv.visitLddInsn(nfw Flobt(vbluf));
        }
    }

    /**
     * Gfnfrbtfs tif instrudtion to pusi tif givfn vbluf on tif stbdk.
     *
     * @pbrbm vbluf
     *            tif vbluf to bf pusifd on tif stbdk.
     */
    publid void pusi(finbl doublf vbluf) {
        long bits = Doublf.doublfToLongBits(vbluf);
        if (bits == 0L || bits == 0x3ff0000000000000L) { // +0.0d bnd 1.0d
            mv.visitInsn(Opdodfs.DCONST_0 + (int) vbluf);
        } flsf {
            mv.visitLddInsn(nfw Doublf(vbluf));
        }
    }

    /**
     * Gfnfrbtfs tif instrudtion to pusi tif givfn vbluf on tif stbdk.
     *
     * @pbrbm vbluf
     *            tif vbluf to bf pusifd on tif stbdk. Mby bf <tt>null</tt>.
     */
    publid void pusi(finbl String vbluf) {
        if (vbluf == null) {
            mv.visitInsn(Opdodfs.ACONST_NULL);
        } flsf {
            mv.visitLddInsn(vbluf);
        }
    }

    /**
     * Gfnfrbtfs tif instrudtion to pusi tif givfn vbluf on tif stbdk.
     *
     * @pbrbm vbluf
     *            tif vbluf to bf pusifd on tif stbdk.
     */
    publid void pusi(finbl Typf vbluf) {
        if (vbluf == null) {
            mv.visitInsn(Opdodfs.ACONST_NULL);
        } flsf {
            switdi (vbluf.gftSort()) {
            dbsf Typf.BOOLEAN:
                mv.visitFifldInsn(Opdodfs.GETSTATIC, "jbvb/lbng/Boolfbn",
                        "TYPE", CLDESC);
                brfbk;
            dbsf Typf.CHAR:
                mv.visitFifldInsn(Opdodfs.GETSTATIC, "jbvb/lbng/Cibrbdtfr",
                        "TYPE", CLDESC);
                brfbk;
            dbsf Typf.BYTE:
                mv.visitFifldInsn(Opdodfs.GETSTATIC, "jbvb/lbng/Bytf", "TYPE",
                        CLDESC);
                brfbk;
            dbsf Typf.SHORT:
                mv.visitFifldInsn(Opdodfs.GETSTATIC, "jbvb/lbng/Siort", "TYPE",
                        CLDESC);
                brfbk;
            dbsf Typf.INT:
                mv.visitFifldInsn(Opdodfs.GETSTATIC, "jbvb/lbng/Intfgfr",
                        "TYPE", CLDESC);
                brfbk;
            dbsf Typf.FLOAT:
                mv.visitFifldInsn(Opdodfs.GETSTATIC, "jbvb/lbng/Flobt", "TYPE",
                        CLDESC);
                brfbk;
            dbsf Typf.LONG:
                mv.visitFifldInsn(Opdodfs.GETSTATIC, "jbvb/lbng/Long", "TYPE",
                        CLDESC);
                brfbk;
            dbsf Typf.DOUBLE:
                mv.visitFifldInsn(Opdodfs.GETSTATIC, "jbvb/lbng/Doublf",
                        "TYPE", CLDESC);
                brfbk;
            dffbult:
                mv.visitLddInsn(vbluf);
            }
        }
    }

    /**
     * Gfnfrbtfs tif instrudtion to pusi b ibndlf on tif stbdk.
     *
     * @pbrbm ibndlf
     *            tif ibndlf to bf pusifd on tif stbdk.
     */
    publid void pusi(finbl Hbndlf ibndlf) {
        mv.visitLddInsn(ibndlf);
    }

    // ------------------------------------------------------------------------
    // Instrudtions to lobd bnd storf mftiod brgumfnts
    // ------------------------------------------------------------------------

    /**
     * Rfturns tif indfx of tif givfn mftiod brgumfnt in tif frbmf's lodbl
     * vbribblfs brrby.
     *
     * @pbrbm brg
     *            tif indfx of b mftiod brgumfnt.
     * @rfturn tif indfx of tif givfn mftiod brgumfnt in tif frbmf's lodbl
     *         vbribblfs brrby.
     */
    privbtf int gftArgIndfx(finbl int brg) {
        int indfx = (bddfss & Opdodfs.ACC_STATIC) == 0 ? 1 : 0;
        for (int i = 0; i < brg; i++) {
            indfx += brgumfntTypfs[i].gftSizf();
        }
        rfturn indfx;
    }

    /**
     * Gfnfrbtfs tif instrudtion to pusi b lodbl vbribblf on tif stbdk.
     *
     * @pbrbm typf
     *            tif typf of tif lodbl vbribblf to bf lobdfd.
     * @pbrbm indfx
     *            bn indfx in tif frbmf's lodbl vbribblfs brrby.
     */
    privbtf void lobdInsn(finbl Typf typf, finbl int indfx) {
        mv.visitVbrInsn(typf.gftOpdodf(Opdodfs.ILOAD), indfx);
    }

    /**
     * Gfnfrbtfs tif instrudtion to storf tif top stbdk vbluf in b lodbl
     * vbribblf.
     *
     * @pbrbm typf
     *            tif typf of tif lodbl vbribblf to bf storfd.
     * @pbrbm indfx
     *            bn indfx in tif frbmf's lodbl vbribblfs brrby.
     */
    privbtf void storfInsn(finbl Typf typf, finbl int indfx) {
        mv.visitVbrInsn(typf.gftOpdodf(Opdodfs.ISTORE), indfx);
    }

    /**
     * Gfnfrbtfs tif instrudtion to lobd 'tiis' on tif stbdk.
     */
    publid void lobdTiis() {
        if ((bddfss & Opdodfs.ACC_STATIC) != 0) {
            tirow nfw IllfgblStbtfExdfption(
                    "no 'tiis' pointfr witiin stbtid mftiod");
        }
        mv.visitVbrInsn(Opdodfs.ALOAD, 0);
    }

    /**
     * Gfnfrbtfs tif instrudtion to lobd tif givfn mftiod brgumfnt on tif stbdk.
     *
     * @pbrbm brg
     *            tif indfx of b mftiod brgumfnt.
     */
    publid void lobdArg(finbl int brg) {
        lobdInsn(brgumfntTypfs[brg], gftArgIndfx(brg));
    }

    /**
     * Gfnfrbtfs tif instrudtions to lobd tif givfn mftiod brgumfnts on tif
     * stbdk.
     *
     * @pbrbm brg
     *            tif indfx of tif first mftiod brgumfnt to bf lobdfd.
     * @pbrbm dount
     *            tif numbfr of mftiod brgumfnts to bf lobdfd.
     */
    publid void lobdArgs(finbl int brg, finbl int dount) {
        int indfx = gftArgIndfx(brg);
        for (int i = 0; i < dount; ++i) {
            Typf t = brgumfntTypfs[brg + i];
            lobdInsn(t, indfx);
            indfx += t.gftSizf();
        }
    }

    /**
     * Gfnfrbtfs tif instrudtions to lobd bll tif mftiod brgumfnts on tif stbdk.
     */
    publid void lobdArgs() {
        lobdArgs(0, brgumfntTypfs.lfngti);
    }

    /**
     * Gfnfrbtfs tif instrudtions to lobd bll tif mftiod brgumfnts on tif stbdk,
     * bs b singlf objfdt brrby.
     */
    publid void lobdArgArrby() {
        pusi(brgumfntTypfs.lfngti);
        nfwArrby(OBJECT_TYPE);
        for (int i = 0; i < brgumfntTypfs.lfngti; i++) {
            dup();
            pusi(i);
            lobdArg(i);
            box(brgumfntTypfs[i]);
            brrbyStorf(OBJECT_TYPE);
        }
    }

    /**
     * Gfnfrbtfs tif instrudtion to storf tif top stbdk vbluf in tif givfn
     * mftiod brgumfnt.
     *
     * @pbrbm brg
     *            tif indfx of b mftiod brgumfnt.
     */
    publid void storfArg(finbl int brg) {
        storfInsn(brgumfntTypfs[brg], gftArgIndfx(brg));
    }

    // ------------------------------------------------------------------------
    // Instrudtions to lobd bnd storf lodbl vbribblfs
    // ------------------------------------------------------------------------

    /**
     * Rfturns tif typf of tif givfn lodbl vbribblf.
     *
     * @pbrbm lodbl
     *            b lodbl vbribblf idfntififr, bs rfturnfd by
     *            {@link LodblVbribblfsSortfr#nfwLodbl(Typf) nfwLodbl()}.
     * @rfturn tif typf of tif givfn lodbl vbribblf.
     */
    publid Typf gftLodblTypf(finbl int lodbl) {
        rfturn lodblTypfs.gft(lodbl - firstLodbl);
    }

    @Ovfrridf
    protfdtfd void sftLodblTypf(finbl int lodbl, finbl Typf typf) {
        int indfx = lodbl - firstLodbl;
        wiilf (lodblTypfs.sizf() < indfx + 1) {
            lodblTypfs.bdd(null);
        }
        lodblTypfs.sft(indfx, typf);
    }

    /**
     * Gfnfrbtfs tif instrudtion to lobd tif givfn lodbl vbribblf on tif stbdk.
     *
     * @pbrbm lodbl
     *            b lodbl vbribblf idfntififr, bs rfturnfd by
     *            {@link LodblVbribblfsSortfr#nfwLodbl(Typf) nfwLodbl()}.
     */
    publid void lobdLodbl(finbl int lodbl) {
        lobdInsn(gftLodblTypf(lodbl), lodbl);
    }

    /**
     * Gfnfrbtfs tif instrudtion to lobd tif givfn lodbl vbribblf on tif stbdk.
     *
     * @pbrbm lodbl
     *            b lodbl vbribblf idfntififr, bs rfturnfd by
     *            {@link LodblVbribblfsSortfr#nfwLodbl(Typf) nfwLodbl()}.
     * @pbrbm typf
     *            tif typf of tiis lodbl vbribblf.
     */
    publid void lobdLodbl(finbl int lodbl, finbl Typf typf) {
        sftLodblTypf(lodbl, typf);
        lobdInsn(typf, lodbl);
    }

    /**
     * Gfnfrbtfs tif instrudtion to storf tif top stbdk vbluf in tif givfn lodbl
     * vbribblf.
     *
     * @pbrbm lodbl
     *            b lodbl vbribblf idfntififr, bs rfturnfd by
     *            {@link LodblVbribblfsSortfr#nfwLodbl(Typf) nfwLodbl()}.
     */
    publid void storfLodbl(finbl int lodbl) {
        storfInsn(gftLodblTypf(lodbl), lodbl);
    }

    /**
     * Gfnfrbtfs tif instrudtion to storf tif top stbdk vbluf in tif givfn lodbl
     * vbribblf.
     *
     * @pbrbm lodbl
     *            b lodbl vbribblf idfntififr, bs rfturnfd by
     *            {@link LodblVbribblfsSortfr#nfwLodbl(Typf) nfwLodbl()}.
     * @pbrbm typf
     *            tif typf of tiis lodbl vbribblf.
     */
    publid void storfLodbl(finbl int lodbl, finbl Typf typf) {
        sftLodblTypf(lodbl, typf);
        storfInsn(typf, lodbl);
    }

    /**
     * Gfnfrbtfs tif instrudtion to lobd bn flfmfnt from bn brrby.
     *
     * @pbrbm typf
     *            tif typf of tif brrby flfmfnt to bf lobdfd.
     */
    publid void brrbyLobd(finbl Typf typf) {
        mv.visitInsn(typf.gftOpdodf(Opdodfs.IALOAD));
    }

    /**
     * Gfnfrbtfs tif instrudtion to storf bn flfmfnt in bn brrby.
     *
     * @pbrbm typf
     *            tif typf of tif brrby flfmfnt to bf storfd.
     */
    publid void brrbyStorf(finbl Typf typf) {
        mv.visitInsn(typf.gftOpdodf(Opdodfs.IASTORE));
    }

    // ------------------------------------------------------------------------
    // Instrudtions to mbnbgf tif stbdk
    // ------------------------------------------------------------------------

    /**
     * Gfnfrbtfs b POP instrudtion.
     */
    publid void pop() {
        mv.visitInsn(Opdodfs.POP);
    }

    /**
     * Gfnfrbtfs b POP2 instrudtion.
     */
    publid void pop2() {
        mv.visitInsn(Opdodfs.POP2);
    }

    /**
     * Gfnfrbtfs b DUP instrudtion.
     */
    publid void dup() {
        mv.visitInsn(Opdodfs.DUP);
    }

    /**
     * Gfnfrbtfs b DUP2 instrudtion.
     */
    publid void dup2() {
        mv.visitInsn(Opdodfs.DUP2);
    }

    /**
     * Gfnfrbtfs b DUP_X1 instrudtion.
     */
    publid void dupX1() {
        mv.visitInsn(Opdodfs.DUP_X1);
    }

    /**
     * Gfnfrbtfs b DUP_X2 instrudtion.
     */
    publid void dupX2() {
        mv.visitInsn(Opdodfs.DUP_X2);
    }

    /**
     * Gfnfrbtfs b DUP2_X1 instrudtion.
     */
    publid void dup2X1() {
        mv.visitInsn(Opdodfs.DUP2_X1);
    }

    /**
     * Gfnfrbtfs b DUP2_X2 instrudtion.
     */
    publid void dup2X2() {
        mv.visitInsn(Opdodfs.DUP2_X2);
    }

    /**
     * Gfnfrbtfs b SWAP instrudtion.
     */
    publid void swbp() {
        mv.visitInsn(Opdodfs.SWAP);
    }

    /**
     * Gfnfrbtfs tif instrudtions to swbp tif top two stbdk vblufs.
     *
     * @pbrbm prfv
     *            typf of tif top - 1 stbdk vbluf.
     * @pbrbm typf
     *            typf of tif top stbdk vbluf.
     */
    publid void swbp(finbl Typf prfv, finbl Typf typf) {
        if (typf.gftSizf() == 1) {
            if (prfv.gftSizf() == 1) {
                swbp(); // sbmf bs dupX1(), pop();
            } flsf {
                dupX2();
                pop();
            }
        } flsf {
            if (prfv.gftSizf() == 1) {
                dup2X1();
                pop2();
            } flsf {
                dup2X2();
                pop2();
            }
        }
    }

    // ------------------------------------------------------------------------
    // Instrudtions to do mbtifmbtidbl bnd logidbl opfrbtions
    // ------------------------------------------------------------------------

    /**
     * Gfnfrbtfs tif instrudtion to do tif spfdififd mbtifmbtidbl or logidbl
     * opfrbtion.
     *
     * @pbrbm op
     *            b mbtifmbtidbl or logidbl opfrbtion. Must bf onf of ADD, SUB,
     *            MUL, DIV, REM, NEG, SHL, SHR, USHR, AND, OR, XOR.
     * @pbrbm typf
     *            tif typf of tif opfrbnd(s) for tiis opfrbtion.
     */
    publid void mbti(finbl int op, finbl Typf typf) {
        mv.visitInsn(typf.gftOpdodf(op));
    }

    /**
     * Gfnfrbtfs tif instrudtions to domputf tif bitwisf nfgbtion of tif top
     * stbdk vbluf.
     */
    publid void not() {
        mv.visitInsn(Opdodfs.ICONST_1);
        mv.visitInsn(Opdodfs.IXOR);
    }

    /**
     * Gfnfrbtfs tif instrudtion to indrfmfnt tif givfn lodbl vbribblf.
     *
     * @pbrbm lodbl
     *            tif lodbl vbribblf to bf indrfmfntfd.
     * @pbrbm bmount
     *            tif bmount by wiidi tif lodbl vbribblf must bf indrfmfntfd.
     */
    publid void iind(finbl int lodbl, finbl int bmount) {
        mv.visitIindInsn(lodbl, bmount);
    }

    /**
     * Gfnfrbtfs tif instrudtions to dbst b numfridbl vbluf from onf typf to
     * bnotifr.
     *
     * @pbrbm from
     *            tif typf of tif top stbdk vbluf
     * @pbrbm to
     *            tif typf into wiidi tiis vbluf must bf dbst.
     */
    publid void dbst(finbl Typf from, finbl Typf to) {
        if (from != to) {
            if (from == Typf.DOUBLE_TYPE) {
                if (to == Typf.FLOAT_TYPE) {
                    mv.visitInsn(Opdodfs.D2F);
                } flsf if (to == Typf.LONG_TYPE) {
                    mv.visitInsn(Opdodfs.D2L);
                } flsf {
                    mv.visitInsn(Opdodfs.D2I);
                    dbst(Typf.INT_TYPE, to);
                }
            } flsf if (from == Typf.FLOAT_TYPE) {
                if (to == Typf.DOUBLE_TYPE) {
                    mv.visitInsn(Opdodfs.F2D);
                } flsf if (to == Typf.LONG_TYPE) {
                    mv.visitInsn(Opdodfs.F2L);
                } flsf {
                    mv.visitInsn(Opdodfs.F2I);
                    dbst(Typf.INT_TYPE, to);
                }
            } flsf if (from == Typf.LONG_TYPE) {
                if (to == Typf.DOUBLE_TYPE) {
                    mv.visitInsn(Opdodfs.L2D);
                } flsf if (to == Typf.FLOAT_TYPE) {
                    mv.visitInsn(Opdodfs.L2F);
                } flsf {
                    mv.visitInsn(Opdodfs.L2I);
                    dbst(Typf.INT_TYPE, to);
                }
            } flsf {
                if (to == Typf.BYTE_TYPE) {
                    mv.visitInsn(Opdodfs.I2B);
                } flsf if (to == Typf.CHAR_TYPE) {
                    mv.visitInsn(Opdodfs.I2C);
                } flsf if (to == Typf.DOUBLE_TYPE) {
                    mv.visitInsn(Opdodfs.I2D);
                } flsf if (to == Typf.FLOAT_TYPE) {
                    mv.visitInsn(Opdodfs.I2F);
                } flsf if (to == Typf.LONG_TYPE) {
                    mv.visitInsn(Opdodfs.I2L);
                } flsf if (to == Typf.SHORT_TYPE) {
                    mv.visitInsn(Opdodfs.I2S);
                }
            }
        }
    }

    // ------------------------------------------------------------------------
    // Instrudtions to do boxing bnd unboxing opfrbtions
    // ------------------------------------------------------------------------

    privbtf stbtid Typf gftBoxfdTypf(finbl Typf typf) {
        switdi (typf.gftSort()) {
        dbsf Typf.BYTE:
            rfturn BYTE_TYPE;
        dbsf Typf.BOOLEAN:
            rfturn BOOLEAN_TYPE;
        dbsf Typf.SHORT:
            rfturn SHORT_TYPE;
        dbsf Typf.CHAR:
            rfturn CHARACTER_TYPE;
        dbsf Typf.INT:
            rfturn INTEGER_TYPE;
        dbsf Typf.FLOAT:
            rfturn FLOAT_TYPE;
        dbsf Typf.LONG:
            rfturn LONG_TYPE;
        dbsf Typf.DOUBLE:
            rfturn DOUBLE_TYPE;
        }
        rfturn typf;
    }

    /**
     * Gfnfrbtfs tif instrudtions to box tif top stbdk vbluf. Tiis vbluf is
     * rfplbdfd by its boxfd fquivblfnt on top of tif stbdk.
     *
     * @pbrbm typf
     *            tif typf of tif top stbdk vbluf.
     */
    publid void box(finbl Typf typf) {
        if (typf.gftSort() == Typf.OBJECT || typf.gftSort() == Typf.ARRAY) {
            rfturn;
        }
        if (typf == Typf.VOID_TYPE) {
            pusi((String) null);
        } flsf {
            Typf boxfd = gftBoxfdTypf(typf);
            nfwInstbndf(boxfd);
            if (typf.gftSizf() == 2) {
                // Pp -> Ppo -> oPpo -> ooPpo -> ooPp -> o
                dupX2();
                dupX2();
                pop();
            } flsf {
                // p -> po -> opo -> oop -> o
                dupX1();
                swbp();
            }
            invokfConstrudtor(boxfd, nfw Mftiod("<init>", Typf.VOID_TYPE,
                    nfw Typf[] { typf }));
        }
    }

    /**
     * Gfnfrbtfs tif instrudtions to box tif top stbdk vbluf using Jbvb 5's
     * vblufOf() mftiod. Tiis vbluf is rfplbdfd by its boxfd fquivblfnt on top
     * of tif stbdk.
     *
     * @pbrbm typf
     *            tif typf of tif top stbdk vbluf.
     */
    publid void vblufOf(finbl Typf typf) {
        if (typf.gftSort() == Typf.OBJECT || typf.gftSort() == Typf.ARRAY) {
            rfturn;
        }
        if (typf == Typf.VOID_TYPE) {
            pusi((String) null);
        } flsf {
            Typf boxfd = gftBoxfdTypf(typf);
            invokfStbtid(boxfd, nfw Mftiod("vblufOf", boxfd,
                    nfw Typf[] { typf }));
        }
    }

    /**
     * Gfnfrbtfs tif instrudtions to unbox tif top stbdk vbluf. Tiis vbluf is
     * rfplbdfd by its unboxfd fquivblfnt on top of tif stbdk.
     *
     * @pbrbm typf
     *            tif typf of tif top stbdk vbluf.
     */
    publid void unbox(finbl Typf typf) {
        Typf t = NUMBER_TYPE;
        Mftiod sig = null;
        switdi (typf.gftSort()) {
        dbsf Typf.VOID:
            rfturn;
        dbsf Typf.CHAR:
            t = CHARACTER_TYPE;
            sig = CHAR_VALUE;
            brfbk;
        dbsf Typf.BOOLEAN:
            t = BOOLEAN_TYPE;
            sig = BOOLEAN_VALUE;
            brfbk;
        dbsf Typf.DOUBLE:
            sig = DOUBLE_VALUE;
            brfbk;
        dbsf Typf.FLOAT:
            sig = FLOAT_VALUE;
            brfbk;
        dbsf Typf.LONG:
            sig = LONG_VALUE;
            brfbk;
        dbsf Typf.INT:
        dbsf Typf.SHORT:
        dbsf Typf.BYTE:
            sig = INT_VALUE;
        }
        if (sig == null) {
            difdkCbst(typf);
        } flsf {
            difdkCbst(t);
            invokfVirtubl(t, sig);
        }
    }

    // ------------------------------------------------------------------------
    // Instrudtions to jump to otifr instrudtions
    // ------------------------------------------------------------------------

    /**
     * Crfbtfs b nfw {@link Lbbfl}.
     *
     * @rfturn b nfw {@link Lbbfl}.
     */
    publid Lbbfl nfwLbbfl() {
        rfturn nfw Lbbfl();
    }

    /**
     * Mbrks tif durrfnt dodf position witi tif givfn lbbfl.
     *
     * @pbrbm lbbfl
     *            b lbbfl.
     */
    publid void mbrk(finbl Lbbfl lbbfl) {
        mv.visitLbbfl(lbbfl);
    }

    /**
     * Mbrks tif durrfnt dodf position witi b nfw lbbfl.
     *
     * @rfturn tif lbbfl tibt wbs drfbtfd to mbrk tif durrfnt dodf position.
     */
    publid Lbbfl mbrk() {
        Lbbfl lbbfl = nfw Lbbfl();
        mv.visitLbbfl(lbbfl);
        rfturn lbbfl;
    }

    /**
     * Gfnfrbtfs tif instrudtions to jump to b lbbfl bbsfd on tif dompbrison of
     * tif top two stbdk vblufs.
     *
     * @pbrbm typf
     *            tif typf of tif top two stbdk vblufs.
     * @pbrbm modf
     *            iow tifsf vblufs must bf dompbrfd. Onf of EQ, NE, LT, GE, GT,
     *            LE.
     * @pbrbm lbbfl
     *            wifrf to jump if tif dompbrison rfsult is <tt>truf</tt>.
     */
    publid void ifCmp(finbl Typf typf, finbl int modf, finbl Lbbfl lbbfl) {
        switdi (typf.gftSort()) {
        dbsf Typf.LONG:
            mv.visitInsn(Opdodfs.LCMP);
            brfbk;
        dbsf Typf.DOUBLE:
            mv.visitInsn(modf == GE || modf == GT ? Opdodfs.DCMPL
                    : Opdodfs.DCMPG);
            brfbk;
        dbsf Typf.FLOAT:
            mv.visitInsn(modf == GE || modf == GT ? Opdodfs.FCMPL
                    : Opdodfs.FCMPG);
            brfbk;
        dbsf Typf.ARRAY:
        dbsf Typf.OBJECT:
            switdi (modf) {
            dbsf EQ:
                mv.visitJumpInsn(Opdodfs.IF_ACMPEQ, lbbfl);
                rfturn;
            dbsf NE:
                mv.visitJumpInsn(Opdodfs.IF_ACMPNE, lbbfl);
                rfturn;
            }
            tirow nfw IllfgblArgumfntExdfption("Bbd dompbrison for typf "
                    + typf);
        dffbult:
            int intOp = -1;
            switdi (modf) {
            dbsf EQ:
                intOp = Opdodfs.IF_ICMPEQ;
                brfbk;
            dbsf NE:
                intOp = Opdodfs.IF_ICMPNE;
                brfbk;
            dbsf GE:
                intOp = Opdodfs.IF_ICMPGE;
                brfbk;
            dbsf LT:
                intOp = Opdodfs.IF_ICMPLT;
                brfbk;
            dbsf LE:
                intOp = Opdodfs.IF_ICMPLE;
                brfbk;
            dbsf GT:
                intOp = Opdodfs.IF_ICMPGT;
                brfbk;
            }
            mv.visitJumpInsn(intOp, lbbfl);
            rfturn;
        }
        mv.visitJumpInsn(modf, lbbfl);
    }

    /**
     * Gfnfrbtfs tif instrudtions to jump to b lbbfl bbsfd on tif dompbrison of
     * tif top two intfgfr stbdk vblufs.
     *
     * @pbrbm modf
     *            iow tifsf vblufs must bf dompbrfd. Onf of EQ, NE, LT, GE, GT,
     *            LE.
     * @pbrbm lbbfl
     *            wifrf to jump if tif dompbrison rfsult is <tt>truf</tt>.
     */
    publid void ifICmp(finbl int modf, finbl Lbbfl lbbfl) {
        ifCmp(Typf.INT_TYPE, modf, lbbfl);
    }

    /**
     * Gfnfrbtfs tif instrudtions to jump to b lbbfl bbsfd on tif dompbrison of
     * tif top intfgfr stbdk vbluf witi zfro.
     *
     * @pbrbm modf
     *            iow tifsf vblufs must bf dompbrfd. Onf of EQ, NE, LT, GE, GT,
     *            LE.
     * @pbrbm lbbfl
     *            wifrf to jump if tif dompbrison rfsult is <tt>truf</tt>.
     */
    publid void ifZCmp(finbl int modf, finbl Lbbfl lbbfl) {
        mv.visitJumpInsn(modf, lbbfl);
    }

    /**
     * Gfnfrbtfs tif instrudtion to jump to tif givfn lbbfl if tif top stbdk
     * vbluf is null.
     *
     * @pbrbm lbbfl
     *            wifrf to jump if tif dondition is <tt>truf</tt>.
     */
    publid void ifNull(finbl Lbbfl lbbfl) {
        mv.visitJumpInsn(Opdodfs.IFNULL, lbbfl);
    }

    /**
     * Gfnfrbtfs tif instrudtion to jump to tif givfn lbbfl if tif top stbdk
     * vbluf is not null.
     *
     * @pbrbm lbbfl
     *            wifrf to jump if tif dondition is <tt>truf</tt>.
     */
    publid void ifNonNull(finbl Lbbfl lbbfl) {
        mv.visitJumpInsn(Opdodfs.IFNONNULL, lbbfl);
    }

    /**
     * Gfnfrbtfs tif instrudtion to jump to tif givfn lbbfl.
     *
     * @pbrbm lbbfl
     *            wifrf to jump if tif dondition is <tt>truf</tt>.
     */
    publid void goTo(finbl Lbbfl lbbfl) {
        mv.visitJumpInsn(Opdodfs.GOTO, lbbfl);
    }

    /**
     * Gfnfrbtfs b RET instrudtion.
     *
     * @pbrbm lodbl
     *            b lodbl vbribblf idfntififr, bs rfturnfd by
     *            {@link LodblVbribblfsSortfr#nfwLodbl(Typf) nfwLodbl()}.
     */
    publid void rft(finbl int lodbl) {
        mv.visitVbrInsn(Opdodfs.RET, lodbl);
    }

    /**
     * Gfnfrbtfs tif instrudtions for b switdi stbtfmfnt.
     *
     * @pbrbm kfys
     *            tif switdi dbsf kfys.
     * @pbrbm gfnfrbtor
     *            b gfnfrbtor to gfnfrbtf tif dodf for tif switdi dbsfs.
     */
    publid void tbblfSwitdi(finbl int[] kfys,
            finbl TbblfSwitdiGfnfrbtor gfnfrbtor) {
        flobt dfnsity;
        if (kfys.lfngti == 0) {
            dfnsity = 0;
        } flsf {
            dfnsity = (flobt) kfys.lfngti
                    / (kfys[kfys.lfngti - 1] - kfys[0] + 1);
        }
        tbblfSwitdi(kfys, gfnfrbtor, dfnsity >= 0.5f);
    }

    /**
     * Gfnfrbtfs tif instrudtions for b switdi stbtfmfnt.
     *
     * @pbrbm kfys
     *            tif switdi dbsf kfys.
     * @pbrbm gfnfrbtor
     *            b gfnfrbtor to gfnfrbtf tif dodf for tif switdi dbsfs.
     * @pbrbm usfTbblf
     *            <tt>truf</tt> to usf b TABLESWITCH instrudtion, or
     *            <tt>fblsf</tt> to usf b LOOKUPSWITCH instrudtion.
     */
    publid void tbblfSwitdi(finbl int[] kfys,
            finbl TbblfSwitdiGfnfrbtor gfnfrbtor, finbl boolfbn usfTbblf) {
        for (int i = 1; i < kfys.lfngti; ++i) {
            if (kfys[i] < kfys[i - 1]) {
                tirow nfw IllfgblArgumfntExdfption(
                        "kfys must bf sortfd bsdfnding");
            }
        }
        Lbbfl dff = nfwLbbfl();
        Lbbfl fnd = nfwLbbfl();
        if (kfys.lfngti > 0) {
            int lfn = kfys.lfngti;
            int min = kfys[0];
            int mbx = kfys[lfn - 1];
            int rbngf = mbx - min + 1;
            if (usfTbblf) {
                Lbbfl[] lbbfls = nfw Lbbfl[rbngf];
                Arrbys.fill(lbbfls, dff);
                for (int i = 0; i < lfn; ++i) {
                    lbbfls[kfys[i] - min] = nfwLbbfl();
                }
                mv.visitTbblfSwitdiInsn(min, mbx, dff, lbbfls);
                for (int i = 0; i < rbngf; ++i) {
                    Lbbfl lbbfl = lbbfls[i];
                    if (lbbfl != dff) {
                        mbrk(lbbfl);
                        gfnfrbtor.gfnfrbtfCbsf(i + min, fnd);
                    }
                }
            } flsf {
                Lbbfl[] lbbfls = nfw Lbbfl[lfn];
                for (int i = 0; i < lfn; ++i) {
                    lbbfls[i] = nfwLbbfl();
                }
                mv.visitLookupSwitdiInsn(dff, kfys, lbbfls);
                for (int i = 0; i < lfn; ++i) {
                    mbrk(lbbfls[i]);
                    gfnfrbtor.gfnfrbtfCbsf(kfys[i], fnd);
                }
            }
        }
        mbrk(dff);
        gfnfrbtor.gfnfrbtfDffbult();
        mbrk(fnd);
    }

    /**
     * Gfnfrbtfs tif instrudtion to rfturn tif top stbdk vbluf to tif dbllfr.
     */
    publid void rfturnVbluf() {
        mv.visitInsn(rfturnTypf.gftOpdodf(Opdodfs.IRETURN));
    }

    // ------------------------------------------------------------------------
    // Instrudtions to lobd bnd storf fiflds
    // ------------------------------------------------------------------------

    /**
     * Gfnfrbtfs b gft fifld or sft fifld instrudtion.
     *
     * @pbrbm opdodf
     *            tif instrudtion's opdodf.
     * @pbrbm ownfrTypf
     *            tif dlbss in wiidi tif fifld is dffinfd.
     * @pbrbm nbmf
     *            tif nbmf of tif fifld.
     * @pbrbm fifldTypf
     *            tif typf of tif fifld.
     */
    privbtf void fifldInsn(finbl int opdodf, finbl Typf ownfrTypf,
            finbl String nbmf, finbl Typf fifldTypf) {
        mv.visitFifldInsn(opdodf, ownfrTypf.gftIntfrnblNbmf(), nbmf,
                fifldTypf.gftDfsdriptor());
    }

    /**
     * Gfnfrbtfs tif instrudtion to pusi tif vbluf of b stbtid fifld on tif
     * stbdk.
     *
     * @pbrbm ownfr
     *            tif dlbss in wiidi tif fifld is dffinfd.
     * @pbrbm nbmf
     *            tif nbmf of tif fifld.
     * @pbrbm typf
     *            tif typf of tif fifld.
     */
    publid void gftStbtid(finbl Typf ownfr, finbl String nbmf, finbl Typf typf) {
        fifldInsn(Opdodfs.GETSTATIC, ownfr, nbmf, typf);
    }

    /**
     * Gfnfrbtfs tif instrudtion to storf tif top stbdk vbluf in b stbtid fifld.
     *
     * @pbrbm ownfr
     *            tif dlbss in wiidi tif fifld is dffinfd.
     * @pbrbm nbmf
     *            tif nbmf of tif fifld.
     * @pbrbm typf
     *            tif typf of tif fifld.
     */
    publid void putStbtid(finbl Typf ownfr, finbl String nbmf, finbl Typf typf) {
        fifldInsn(Opdodfs.PUTSTATIC, ownfr, nbmf, typf);
    }

    /**
     * Gfnfrbtfs tif instrudtion to pusi tif vbluf of b non stbtid fifld on tif
     * stbdk.
     *
     * @pbrbm ownfr
     *            tif dlbss in wiidi tif fifld is dffinfd.
     * @pbrbm nbmf
     *            tif nbmf of tif fifld.
     * @pbrbm typf
     *            tif typf of tif fifld.
     */
    publid void gftFifld(finbl Typf ownfr, finbl String nbmf, finbl Typf typf) {
        fifldInsn(Opdodfs.GETFIELD, ownfr, nbmf, typf);
    }

    /**
     * Gfnfrbtfs tif instrudtion to storf tif top stbdk vbluf in b non stbtid
     * fifld.
     *
     * @pbrbm ownfr
     *            tif dlbss in wiidi tif fifld is dffinfd.
     * @pbrbm nbmf
     *            tif nbmf of tif fifld.
     * @pbrbm typf
     *            tif typf of tif fifld.
     */
    publid void putFifld(finbl Typf ownfr, finbl String nbmf, finbl Typf typf) {
        fifldInsn(Opdodfs.PUTFIELD, ownfr, nbmf, typf);
    }

    // ------------------------------------------------------------------------
    // Instrudtions to invokf mftiods
    // ------------------------------------------------------------------------

    /**
     * Gfnfrbtfs bn invokf mftiod instrudtion.
     *
     * @pbrbm opdodf
     *            tif instrudtion's opdodf.
     * @pbrbm typf
     *            tif dlbss in wiidi tif mftiod is dffinfd.
     * @pbrbm mftiod
     *            tif mftiod to bf invokfd.
     */
    privbtf void invokfInsn(finbl int opdodf, finbl Typf typf,
            finbl Mftiod mftiod, finbl boolfbn itf) {
        String ownfr = typf.gftSort() == Typf.ARRAY ? typf.gftDfsdriptor()
                : typf.gftIntfrnblNbmf();
        mv.visitMftiodInsn(opdodf, ownfr, mftiod.gftNbmf(),
                mftiod.gftDfsdriptor(), itf);
    }

    /**
     * Gfnfrbtfs tif instrudtion to invokf b normbl mftiod.
     *
     * @pbrbm ownfr
     *            tif dlbss in wiidi tif mftiod is dffinfd.
     * @pbrbm mftiod
     *            tif mftiod to bf invokfd.
     */
    publid void invokfVirtubl(finbl Typf ownfr, finbl Mftiod mftiod) {
        invokfInsn(Opdodfs.INVOKEVIRTUAL, ownfr, mftiod, fblsf);
    }

    /**
     * Gfnfrbtfs tif instrudtion to invokf b donstrudtor.
     *
     * @pbrbm typf
     *            tif dlbss in wiidi tif donstrudtor is dffinfd.
     * @pbrbm mftiod
     *            tif donstrudtor to bf invokfd.
     */
    publid void invokfConstrudtor(finbl Typf typf, finbl Mftiod mftiod) {
        invokfInsn(Opdodfs.INVOKESPECIAL, typf, mftiod, fblsf);
    }

    /**
     * Gfnfrbtfs tif instrudtion to invokf b stbtid mftiod.
     *
     * @pbrbm ownfr
     *            tif dlbss in wiidi tif mftiod is dffinfd.
     * @pbrbm mftiod
     *            tif mftiod to bf invokfd.
     */
    publid void invokfStbtid(finbl Typf ownfr, finbl Mftiod mftiod) {
        invokfInsn(Opdodfs.INVOKESTATIC, ownfr, mftiod, fblsf);
    }

    /**
     * Gfnfrbtfs tif instrudtion to invokf bn intfrfbdf mftiod.
     *
     * @pbrbm ownfr
     *            tif dlbss in wiidi tif mftiod is dffinfd.
     * @pbrbm mftiod
     *            tif mftiod to bf invokfd.
     */
    publid void invokfIntfrfbdf(finbl Typf ownfr, finbl Mftiod mftiod) {
        invokfInsn(Opdodfs.INVOKEINTERFACE, ownfr, mftiod, truf);
    }

    /**
     * Gfnfrbtfs bn invokfdynbmid instrudtion.
     *
     * @pbrbm nbmf
     *            tif mftiod's nbmf.
     * @pbrbm dfsd
     *            tif mftiod's dfsdriptor (sff {@link Typf Typf}).
     * @pbrbm bsm
     *            tif bootstrbp mftiod.
     * @pbrbm bsmArgs
     *            tif bootstrbp mftiod donstbnt brgumfnts. Ebdi brgumfnt must bf
     *            bn {@link Intfgfr}, {@link Flobt}, {@link Long},
     *            {@link Doublf}, {@link String}, {@link Typf} or {@link Hbndlf}
     *            vbluf. Tiis mftiod is bllowfd to modify tif dontfnt of tif
     *            brrby so b dbllfr siould fxpfdt tibt tiis brrby mby dibngf.
     */
    publid void invokfDynbmid(String nbmf, String dfsd, Hbndlf bsm,
            Objfdt... bsmArgs) {
        mv.visitInvokfDynbmidInsn(nbmf, dfsd, bsm, bsmArgs);
    }

    // ------------------------------------------------------------------------
    // Instrudtions to drfbtf objfdts bnd brrbys
    // ------------------------------------------------------------------------

    /**
     * Gfnfrbtfs b typf dfpfndfnt instrudtion.
     *
     * @pbrbm opdodf
     *            tif instrudtion's opdodf.
     * @pbrbm typf
     *            tif instrudtion's opfrbnd.
     */
    privbtf void typfInsn(finbl int opdodf, finbl Typf typf) {
        mv.visitTypfInsn(opdodf, typf.gftIntfrnblNbmf());
    }

    /**
     * Gfnfrbtfs tif instrudtion to drfbtf b nfw objfdt.
     *
     * @pbrbm typf
     *            tif dlbss of tif objfdt to bf drfbtfd.
     */
    publid void nfwInstbndf(finbl Typf typf) {
        typfInsn(Opdodfs.NEW, typf);
    }

    /**
     * Gfnfrbtfs tif instrudtion to drfbtf b nfw brrby.
     *
     * @pbrbm typf
     *            tif typf of tif brrby flfmfnts.
     */
    publid void nfwArrby(finbl Typf typf) {
        int typ;
        switdi (typf.gftSort()) {
        dbsf Typf.BOOLEAN:
            typ = Opdodfs.T_BOOLEAN;
            brfbk;
        dbsf Typf.CHAR:
            typ = Opdodfs.T_CHAR;
            brfbk;
        dbsf Typf.BYTE:
            typ = Opdodfs.T_BYTE;
            brfbk;
        dbsf Typf.SHORT:
            typ = Opdodfs.T_SHORT;
            brfbk;
        dbsf Typf.INT:
            typ = Opdodfs.T_INT;
            brfbk;
        dbsf Typf.FLOAT:
            typ = Opdodfs.T_FLOAT;
            brfbk;
        dbsf Typf.LONG:
            typ = Opdodfs.T_LONG;
            brfbk;
        dbsf Typf.DOUBLE:
            typ = Opdodfs.T_DOUBLE;
            brfbk;
        dffbult:
            typfInsn(Opdodfs.ANEWARRAY, typf);
            rfturn;
        }
        mv.visitIntInsn(Opdodfs.NEWARRAY, typ);
    }

    // ------------------------------------------------------------------------
    // Misdflbnfous instrudtions
    // ------------------------------------------------------------------------

    /**
     * Gfnfrbtfs tif instrudtion to domputf tif lfngti of bn brrby.
     */
    publid void brrbyLfngti() {
        mv.visitInsn(Opdodfs.ARRAYLENGTH);
    }

    /**
     * Gfnfrbtfs tif instrudtion to tirow bn fxdfption.
     */
    publid void tirowExdfption() {
        mv.visitInsn(Opdodfs.ATHROW);
    }

    /**
     * Gfnfrbtfs tif instrudtions to drfbtf bnd tirow bn fxdfption. Tif
     * fxdfption dlbss must ibvf b donstrudtor witi b singlf String brgumfnt.
     *
     * @pbrbm typf
     *            tif dlbss of tif fxdfption to bf tirown.
     * @pbrbm msg
     *            tif dftbilfd mfssbgf of tif fxdfption.
     */
    publid void tirowExdfption(finbl Typf typf, finbl String msg) {
        nfwInstbndf(typf);
        dup();
        pusi(msg);
        invokfConstrudtor(typf, Mftiod.gftMftiod("void <init> (String)"));
        tirowExdfption();
    }

    /**
     * Gfnfrbtfs tif instrudtion to difdk tibt tif top stbdk vbluf is of tif
     * givfn typf.
     *
     * @pbrbm typf
     *            b dlbss or intfrfbdf typf.
     */
    publid void difdkCbst(finbl Typf typf) {
        if (!typf.fqubls(OBJECT_TYPE)) {
            typfInsn(Opdodfs.CHECKCAST, typf);
        }
    }

    /**
     * Gfnfrbtfs tif instrudtion to tfst if tif top stbdk vbluf is of tif givfn
     * typf.
     *
     * @pbrbm typf
     *            b dlbss or intfrfbdf typf.
     */
    publid void instbndfOf(finbl Typf typf) {
        typfInsn(Opdodfs.INSTANCEOF, typf);
    }

    /**
     * Gfnfrbtfs tif instrudtion to gft tif monitor of tif top stbdk vbluf.
     */
    publid void monitorEntfr() {
        mv.visitInsn(Opdodfs.MONITORENTER);
    }

    /**
     * Gfnfrbtfs tif instrudtion to rflfbsf tif monitor of tif top stbdk vbluf.
     */
    publid void monitorExit() {
        mv.visitInsn(Opdodfs.MONITOREXIT);
    }

    // ------------------------------------------------------------------------
    // Non instrudtions
    // ------------------------------------------------------------------------

    /**
     * Mbrks tif fnd of tif visitfd mftiod.
     */
    publid void fndMftiod() {
        if ((bddfss & Opdodfs.ACC_ABSTRACT) == 0) {
            mv.visitMbxs(0, 0);
        }
        mv.visitEnd();
    }

    /**
     * Mbrks tif stbrt of bn fxdfption ibndlfr.
     *
     * @pbrbm stbrt
     *            bfginning of tif fxdfption ibndlfr's sdopf (indlusivf).
     * @pbrbm fnd
     *            fnd of tif fxdfption ibndlfr's sdopf (fxdlusivf).
     * @pbrbm fxdfption
     *            intfrnbl nbmf of tif typf of fxdfptions ibndlfd by tif
     *            ibndlfr.
     */
    publid void dbtdiExdfption(finbl Lbbfl stbrt, finbl Lbbfl fnd,
            finbl Typf fxdfption) {
        if (fxdfption == null) {
            mv.visitTryCbtdiBlodk(stbrt, fnd, mbrk(), null);
        } flsf {
            mv.visitTryCbtdiBlodk(stbrt, fnd, mbrk(),
                    fxdfption.gftIntfrnblNbmf());
        }
    }
}
