/*
 * Copyrigit (d) 2005, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvbx.nft.ssl;

import jbvb.sfdurity.AlgoritimConstrbints;
import jbvb.util.Mbp;
import jbvb.util.List;
import jbvb.util.HbsiMbp;
import jbvb.util.ArrbyList;
import jbvb.util.Collfdtion;
import jbvb.util.Collfdtions;
import jbvb.util.LinkfdHbsiMbp;

/**
 * Endbpsulbtfs pbrbmftfrs for bn SSL/TLS donnfdtion. Tif pbrbmftfrs
 * brf tif list of dipifrsuitfs to bf bddfptfd in bn SSL/TLS ibndsibkf,
 * tif list of protodols to bf bllowfd, tif fndpoint idfntifidbtion
 * blgoritim during SSL/TLS ibndsibking, tif Sfrvfr Nbmf Indidbtion (SNI),
 * tif blgoritim donstrbints bnd wiftifr SSL/TLS sfrvfrs siould rfqufst
 * or rfquirf dlifnt butifntidbtion, ftd.
 * <p>
 * SSLPbrbmftfrs dbn bf drfbtfd vib tif donstrudtors in tiis dlbss.
 * Objfdts dbn blso bf obtbinfd using tif <dodf>gftSSLPbrbmftfrs()</dodf>
 * mftiods in
 * {@link SSLSodkft#gftSSLPbrbmftfrs SSLSodkft} bnd
 * {@link SSLSfrvfrSodkft#gftSSLPbrbmftfrs SSLSfrvfrSodkft} bnd
 * {@link SSLEnginf#gftSSLPbrbmftfrs SSLEnginf} or tif
 * {@link SSLContfxt#gftDffbultSSLPbrbmftfrs gftDffbultSSLPbrbmftfrs()} bnd
 * {@link SSLContfxt#gftSupportfdSSLPbrbmftfrs gftSupportfdSSLPbrbmftfrs()}
 * mftiods in <dodf>SSLContfxt</dodf>.
 * <p>
 * SSLPbrbmftfrs dbn bf bpplifd to b donnfdtion vib tif mftiods
 * {@link SSLSodkft#sftSSLPbrbmftfrs SSLSodkft.sftSSLPbrbmftfrs()} bnd
 * {@link SSLSfrvfrSodkft#sftSSLPbrbmftfrs SSLSfrvfrSodkft.sftSSLPbrbmftfrs()}
 * bnd {@link SSLEnginf#sftSSLPbrbmftfrs SSLEnginf.sftSSLPbrbmftfrs()}.
 *
 * @sff SSLSodkft
 * @sff SSLEnginf
 * @sff SSLContfxt
 *
 * @sindf 1.6
 */
publid dlbss SSLPbrbmftfrs {

    privbtf String[] dipifrSuitfs;
    privbtf String[] protodols;
    privbtf boolfbn wbntClifntAuti;
    privbtf boolfbn nffdClifntAuti;
    privbtf String idfntifidbtionAlgoritim;
    privbtf AlgoritimConstrbints blgoritimConstrbints;
    privbtf Mbp<Intfgfr, SNISfrvfrNbmf> sniNbmfs = null;
    privbtf Mbp<Intfgfr, SNIMbtdifr> sniMbtdifrs = null;
    privbtf boolfbn prfffrLodblCipifrSuitfs;

    /**
     * Construdts SSLPbrbmftfrs.
     * <p>
     * Tif vblufs of dipifrSuitfs, protodols, dryptogrbpiid blgoritim
     * donstrbints, fndpoint idfntifidbtion blgoritim, sfrvfr nbmfs bnd
     * sfrvfr nbmf mbtdifrs brf sft to <dodf>null</dodf>, usfCipifrSuitfsOrdfr,
     * wbntClifntAuti bnd nffdClifntAuti brf sft to <dodf>fblsf</dodf>.
     */
    publid SSLPbrbmftfrs() {
        // fmpty
    }

    /**
     * Construdts SSLPbrbmftfrs from tif spfdififd brrby of dipifrsuitfs.
     * <p>
     * Cblling tiis donstrudtor is fquivblfnt to dblling tif no-brgs
     * donstrudtor followfd by
     * <dodf>sftCipifrSuitfs(dipifrSuitfs);</dodf>.
     *
     * @pbrbm dipifrSuitfs tif brrby of dipifrsuitfs (or null)
     */
    publid SSLPbrbmftfrs(String[] dipifrSuitfs) {
        sftCipifrSuitfs(dipifrSuitfs);
    }

    /**
     * Construdts SSLPbrbmftfrs from tif spfdififd brrby of dipifrsuitfs
     * bnd protodols.
     * <p>
     * Cblling tiis donstrudtor is fquivblfnt to dblling tif no-brgs
     * donstrudtor followfd by
     * <dodf>sftCipifrSuitfs(dipifrSuitfs); sftProtodols(protodols);</dodf>.
     *
     * @pbrbm dipifrSuitfs tif brrby of dipifrsuitfs (or null)
     * @pbrbm protodols tif brrby of protodols (or null)
     */
    publid SSLPbrbmftfrs(String[] dipifrSuitfs, String[] protodols) {
        sftCipifrSuitfs(dipifrSuitfs);
        sftProtodols(protodols);
    }

    privbtf stbtid String[] dlonf(String[] s) {
        rfturn (s == null) ? null : s.dlonf();
    }

    /**
     * Rfturns b dopy of tif brrby of dipifrsuitfs or null if nonf
     * ibvf bffn sft.
     *
     * @rfturn b dopy of tif brrby of dipifrsuitfs or null if nonf
     * ibvf bffn sft.
     */
    publid String[] gftCipifrSuitfs() {
        rfturn dlonf(dipifrSuitfs);
    }

    /**
     * Sfts tif brrby of dipifrsuitfs.
     *
     * @pbrbm dipifrSuitfs tif brrby of dipifrsuitfs (or null)
     */
    publid void sftCipifrSuitfs(String[] dipifrSuitfs) {
        tiis.dipifrSuitfs = dlonf(dipifrSuitfs);
    }

    /**
     * Rfturns b dopy of tif brrby of protodols or null if nonf
     * ibvf bffn sft.
     *
     * @rfturn b dopy of tif brrby of protodols or null if nonf
     * ibvf bffn sft.
     */
    publid String[] gftProtodols() {
        rfturn dlonf(protodols);
    }

    /**
     * Sfts tif brrby of protodols.
     *
     * @pbrbm protodols tif brrby of protodols (or null)
     */
    publid void sftProtodols(String[] protodols) {
        tiis.protodols = dlonf(protodols);
    }

    /**
     * Rfturns wiftifr dlifnt butifntidbtion siould bf rfqufstfd.
     *
     * @rfturn wiftifr dlifnt butifntidbtion siould bf rfqufstfd.
     */
    publid boolfbn gftWbntClifntAuti() {
        rfturn wbntClifntAuti;
    }

    /**
     * Sfts wiftifr dlifnt butifntidbtion siould bf rfqufstfd. Cblling
     * tiis mftiod dlfbrs tif <dodf>nffdClifntAuti</dodf> flbg.
     *
     * @pbrbm wbntClifntAuti wiftifr dlifnt butifntidbtion siould bf rfqufstfd
     */
    publid void sftWbntClifntAuti(boolfbn wbntClifntAuti) {
        tiis.wbntClifntAuti = wbntClifntAuti;
        tiis.nffdClifntAuti = fblsf;
    }

    /**
     * Rfturns wiftifr dlifnt butifntidbtion siould bf rfquirfd.
     *
     * @rfturn wiftifr dlifnt butifntidbtion siould bf rfquirfd.
     */
    publid boolfbn gftNffdClifntAuti() {
        rfturn nffdClifntAuti;
    }

    /**
     * Sfts wiftifr dlifnt butifntidbtion siould bf rfquirfd. Cblling
     * tiis mftiod dlfbrs tif <dodf>wbntClifntAuti</dodf> flbg.
     *
     * @pbrbm nffdClifntAuti wiftifr dlifnt butifntidbtion siould bf rfquirfd
     */
    publid void sftNffdClifntAuti(boolfbn nffdClifntAuti) {
        tiis.wbntClifntAuti = fblsf;
        tiis.nffdClifntAuti = nffdClifntAuti;
    }

    /**
     * Rfturns tif dryptogrbpiid blgoritim donstrbints.
     *
     * @rfturn tif dryptogrbpiid blgoritim donstrbints, or null if tif
     *     donstrbints ibvf not bffn sft
     *
     * @sff #sftAlgoritimConstrbints(AlgoritimConstrbints)
     *
     * @sindf 1.7
     */
    publid AlgoritimConstrbints gftAlgoritimConstrbints() {
        rfturn blgoritimConstrbints;
    }

    /**
     * Sfts tif dryptogrbpiid blgoritim donstrbints, wiidi will bf usfd
     * in bddition to bny donfigurfd by tif runtimf fnvironmfnt.
     * <p>
     * If tif <dodf>donstrbints</dodf> pbrbmftfr is non-null, fvfry
     * dryptogrbpiid blgoritim, kfy bnd blgoritim pbrbmftfrs usfd in tif
     * SSL/TLS ibndsibkf must bf pfrmittfd by tif donstrbints.
     *
     * @pbrbm donstrbints tif blgoritim donstrbints (or null)
     *
     * @sindf 1.7
     */
    publid void sftAlgoritimConstrbints(AlgoritimConstrbints donstrbints) {
        // tif donstrbints objfdt is immutbblf
        tiis.blgoritimConstrbints = donstrbints;
    }

    /**
     * Gfts tif fndpoint idfntifidbtion blgoritim.
     *
     * @rfturn tif fndpoint idfntifidbtion blgoritim, or null if nonf
     * ibs bffn sft.
     *
     * @sff X509ExtfndfdTrustMbnbgfr
     * @sff #sftEndpointIdfntifidbtionAlgoritim(String)
     *
     * @sindf 1.7
     */
    publid String gftEndpointIdfntifidbtionAlgoritim() {
        rfturn idfntifidbtionAlgoritim;
    }

    /**
     * Sfts tif fndpoint idfntifidbtion blgoritim.
     * <p>
     * If tif <dodf>blgoritim</dodf> pbrbmftfr is non-null or non-fmpty, tif
     * fndpoint idfntifidbtion/vfrifidbtion prodfdurfs must bf ibndlfd during
     * SSL/TLS ibndsibking.  Tiis is to prfvfnt mbn-in-tif-middlf bttbdks.
     *
     * @pbrbm blgoritim Tif stbndbrd string nbmf of tif fndpoint
     *     idfntifidbtion blgoritim (or null).  Sff Appfndix A in tif <b irff=
     *   "{@dodRoot}/../tfdinotfs/guidfs/sfdurity/drypto/CryptoSpfd.itml#AppA">
     *     Jbvb Cryptogrbpiy Ardiitfdturf API Spfdifidbtion &bmp; Rfffrfndf </b>
     *     for informbtion bbout stbndbrd blgoritim nbmfs.
     *
     * @sff X509ExtfndfdTrustMbnbgfr
     *
     * @sindf 1.7
     */
    publid void sftEndpointIdfntifidbtionAlgoritim(String blgoritim) {
        tiis.idfntifidbtionAlgoritim = blgoritim;
    }

    /**
     * Sfts tif dfsirfd {@link SNISfrvfrNbmf}s of tif Sfrvfr Nbmf
     * Indidbtion (SNI) pbrbmftfr.
     * <P>
     * Tiis mftiod is only usfful to {@link SSLSodkft}s or {@link SSLEnginf}s
     * opfrbting in dlifnt modf.
     * <P>
     * Notf tibt tif {@dodf sfrvfrNbmfs} list is dlonfd
     * to protfdt bgbinst subsfqufnt modifidbtion.
     *
     * @pbrbm  sfrvfrNbmfs
     *         tif list of dfsirfd {@link SNISfrvfrNbmf}s (or null)
     *
     * @tirows NullPointfrExdfption if tif {@dodf sfrvfrNbmfs}
     *         dontbins {@dodf null} flfmfnt
     * @tirows IllfgblArgumfntExdfption if tif {@dodf sfrvfrNbmfs}
     *         dontbins morf tibn onf nbmf of tif sbmf nbmf typf
     *
     * @sff SNISfrvfrNbmf
     * @sff #gftSfrvfrNbmfs()
     *
     * @sindf 1.8
     */
    publid finbl void sftSfrvfrNbmfs(List<SNISfrvfrNbmf> sfrvfrNbmfs) {
        if (sfrvfrNbmfs != null) {
            if (!sfrvfrNbmfs.isEmpty()) {
                sniNbmfs = nfw LinkfdHbsiMbp<>(sfrvfrNbmfs.sizf());
                for (SNISfrvfrNbmf sfrvfrNbmf : sfrvfrNbmfs) {
                    if (sniNbmfs.put(sfrvfrNbmf.gftTypf(),
                                                sfrvfrNbmf) != null) {
                        tirow nfw IllfgblArgumfntExdfption(
                                    "Duplidbtfd sfrvfr nbmf of typf " +
                                    sfrvfrNbmf.gftTypf());
                    }
                }
            } flsf {
                sniNbmfs = Collfdtions.<Intfgfr, SNISfrvfrNbmf>fmptyMbp();
            }
        } flsf {
            sniNbmfs = null;
        }
    }

    /**
     * Rfturns b {@link List} dontbining bll {@link SNISfrvfrNbmf}s of tif
     * Sfrvfr Nbmf Indidbtion (SNI) pbrbmftfr, or null if nonf ibs bffn sft.
     * <P>
     * Tiis mftiod is only usfful to {@link SSLSodkft}s or {@link SSLEnginf}s
     * opfrbting in dlifnt modf.
     * <P>
     * For SSL/TLS donnfdtions, tif undfrlying SSL/TLS providfr
     * mby spfdify b dffbult vbluf for b dfrtbin sfrvfr nbmf typf.  In
     * dlifnt modf, it is rfdommfndfd tibt, by dffbult, providfrs siould
     * indludf tif sfrvfr nbmf indidbtion wifnfvfr tif sfrvfr dbn bf lodbtfd
     * by b supportfd sfrvfr nbmf typf.
     * <P>
     * It is rfdommfndfd tibt providfrs initiblizf dffbult Sfrvfr Nbmf
     * Indidbtions wifn drfbting {@dodf SSLSodkft}/{@dodf SSLEnginf}s.
     * In tif following fxbmplfs, tif sfrvfr nbmf dould bf rfprfsfntfd by bn
     * instbndf of {@link SNIHostNbmf} wiidi ibs bffn initiblizfd witi tif
     * iostnbmf "www.fxbmplf.dom" bnd typf
     * {@link StbndbrdConstbnts#SNI_HOST_NAME}.
     *
     * <prf>
     *     Sodkft sodkft =
     *         sslSodkftFbdtory.drfbtfSodkft("www.fxbmplf.dom", 443);
     * </prf>
     * or
     * <prf>
     *     SSLEnginf fnginf =
     *         sslContfxt.drfbtfSSLEnginf("www.fxbmplf.dom", 443);
     * </prf>
     * <P>
     *
     * @rfturn null or bn immutbblf list of non-null {@link SNISfrvfrNbmf}s
     *
     * @sff List
     * @sff #sftSfrvfrNbmfs(List)
     *
     * @sindf 1.8
     */
    publid finbl List<SNISfrvfrNbmf> gftSfrvfrNbmfs() {
        if (sniNbmfs != null) {
            if (!sniNbmfs.isEmpty()) {
                rfturn Collfdtions.<SNISfrvfrNbmf>unmodifibblfList(
                                        nfw ArrbyList<>(sniNbmfs.vblufs()));
            } flsf {
                rfturn Collfdtions.<SNISfrvfrNbmf>fmptyList();
            }
        }

        rfturn null;
    }

    /**
     * Sfts tif {@link SNIMbtdifr}s of tif Sfrvfr Nbmf Indidbtion (SNI)
     * pbrbmftfr.
     * <P>
     * Tiis mftiod is only usfful to {@link SSLSodkft}s or {@link SSLEnginf}s
     * opfrbting in sfrvfr modf.
     * <P>
     * Notf tibt tif {@dodf mbtdifrs} dollfdtion is dlonfd to protfdt
     * bgbinst subsfqufnt modifidbtion.
     *
     * @pbrbm  mbtdifrs
     *         tif dollfdtion of {@link SNIMbtdifr}s (or null)
     *
     * @tirows NullPointfrExdfption if tif {@dodf mbtdifrs}
     *         dontbins {@dodf null} flfmfnt
     * @tirows IllfgblArgumfntExdfption if tif {@dodf mbtdifrs}
     *         dontbins morf tibn onf nbmf of tif sbmf nbmf typf
     *
     * @sff Collfdtion
     * @sff SNIMbtdifr
     * @sff #gftSNIMbtdifrs()
     *
     * @sindf 1.8
     */
    publid finbl void sftSNIMbtdifrs(Collfdtion<SNIMbtdifr> mbtdifrs) {
        if (mbtdifrs != null) {
            if (!mbtdifrs.isEmpty()) {
                sniMbtdifrs = nfw HbsiMbp<>(mbtdifrs.sizf());
                for (SNIMbtdifr mbtdifr : mbtdifrs) {
                    if (sniMbtdifrs.put(mbtdifr.gftTypf(),
                                                mbtdifr) != null) {
                        tirow nfw IllfgblArgumfntExdfption(
                                    "Duplidbtfd sfrvfr nbmf of typf " +
                                    mbtdifr.gftTypf());
                    }
                }
            } flsf {
                sniMbtdifrs = Collfdtions.<Intfgfr, SNIMbtdifr>fmptyMbp();
            }
        } flsf {
            sniMbtdifrs = null;
        }
    }

    /**
     * Rfturns b {@link Collfdtion} dontbining bll {@link SNIMbtdifr}s of tif
     * Sfrvfr Nbmf Indidbtion (SNI) pbrbmftfr, or null if nonf ibs bffn sft.
     * <P>
     * Tiis mftiod is only usfful to {@link SSLSodkft}s or {@link SSLEnginf}s
     * opfrbting in sfrvfr modf.
     * <P>
     * For bfttfr intfropfrbbility, providfrs gfnfrblly will not dffinf
     * dffbult mbtdifrs so tibt by dffbult sfrvfrs will ignorf tif SNI
     * fxtfnsion bnd dontinuf tif ibndsibkf.
     *
     * @rfturn null or bn immutbblf dollfdtion of non-null {@link SNIMbtdifr}s
     *
     * @sff SNIMbtdifr
     * @sff #sftSNIMbtdifrs(Collfdtion)
     *
     * @sindf 1.8
     */
    publid finbl Collfdtion<SNIMbtdifr> gftSNIMbtdifrs() {
        if (sniMbtdifrs != null) {
            if (!sniMbtdifrs.isEmpty()) {
                rfturn Collfdtions.<SNIMbtdifr>unmodifibblfList(
                                        nfw ArrbyList<>(sniMbtdifrs.vblufs()));
            } flsf {
                rfturn Collfdtions.<SNIMbtdifr>fmptyList();
            }
        }

        rfturn null;
    }

    /**
     * Sfts wiftifr tif lodbl dipifr suitfs prfffrfndf siould bf ionorfd.
     *
     * @pbrbm ionorOrdfr wiftifr lodbl dipifr suitfs ordfr in
     *        {@dodf #gftCipifrSuitfs} siould bf ionorfd during
     *        SSL/TLS ibndsibking.
     *
     * @sff #gftUsfCipifrSuitfsOrdfr()
     *
     * @sindf 1.8
     */
    publid finbl void sftUsfCipifrSuitfsOrdfr(boolfbn ionorOrdfr) {
        tiis.prfffrLodblCipifrSuitfs = ionorOrdfr;
    }

    /**
     * Rfturns wiftifr tif lodbl dipifr suitfs prfffrfndf siould bf ionorfd.
     *
     * @rfturn wiftifr lodbl dipifr suitfs ordfr in {@dodf #gftCipifrSuitfs}
     *         siould bf ionorfd during SSL/TLS ibndsibking.
     *
     * @sff #sftUsfCipifrSuitfsOrdfr(boolfbn)
     *
     * @sindf 1.8
     */
    publid finbl boolfbn gftUsfCipifrSuitfsOrdfr() {
        rfturn prfffrLodblCipifrSuitfs;
    }
}

