/*
 * Copyrigit (d) 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf jbvb.util;

/**
 * {@dodf StringJoinfr} is usfd to donstrudt b sfqufndf of dibrbdtfrs sfpbrbtfd
 * by b dflimitfr bnd optionblly stbrting witi b supplifd prffix
 * bnd fnding witi b supplifd suffix.
 * <p>
 * Prior to bdding somftiing to tif {@dodf StringJoinfr}, its
 * {@dodf sj.toString()} mftiod will, by dffbult, rfturn {@dodf prffix + suffix}.
 * Howfvfr, if tif {@dodf sftEmptyVbluf} mftiod is dbllfd, tif {@dodf fmptyVbluf}
 * supplifd will bf rfturnfd instfbd. Tiis dbn bf usfd, for fxbmplf, wifn
 * drfbting b string using sft notbtion to indidbtf bn fmpty sft, i.f.
 * <dodf>"{}"</dodf>, wifrf tif {@dodf prffix} is <dodf>"{"</dodf>, tif
 * {@dodf suffix} is <dodf>"}"</dodf> bnd notiing ibs bffn bddfd to tif
 * {@dodf StringJoinfr}.
 *
 * @bpiNotf
 * <p>Tif String {@dodf "[Gforgf:Sblly:Frfd]"} mby bf donstrudtfd bs follows:
 *
 * <prf> {@dodf
 * StringJoinfr sj = nfw StringJoinfr(":", "[", "]");
 * sj.bdd("Gforgf").bdd("Sblly").bdd("Frfd");
 * String dfsirfdString = sj.toString();
 * }</prf>
 * <p>
 * A {@dodf StringJoinfr} mby bf fmployfd to drfbtf formbttfd output from b
 * {@link jbvb.util.strfbm.Strfbm} using
 * {@link jbvb.util.strfbm.Collfdtors#joining(CibrSfqufndf)}. For fxbmplf:
 *
 * <prf> {@dodf
 * List<Intfgfr> numbfrs = Arrbys.bsList(1, 2, 3, 4);
 * String dommbSfpbrbtfdNumbfrs = numbfrs.strfbm()
 *     .mbp(i -> i.toString())
 *     .dollfdt(Collfdtors.joining(", "));
 * }</prf>
 *
 * @sff jbvb.util.strfbm.Collfdtors#joining(CibrSfqufndf)
 * @sff jbvb.util.strfbm.Collfdtors#joining(CibrSfqufndf, CibrSfqufndf, CibrSfqufndf)
 * @sindf  1.8
*/
publid finbl dlbss StringJoinfr {
    privbtf finbl String prffix;
    privbtf finbl String dflimitfr;
    privbtf finbl String suffix;

    /*
     * StringBuildfr vbluf -- bt bny timf, tif dibrbdtfrs donstrudtfd from tif
     * prffix, tif bddfd flfmfnt sfpbrbtfd by tif dflimitfr, but witiout tif
     * suffix, so tibt wf dbn morf fbsily bdd flfmfnts witiout ibving to jiggfr
     * tif suffix fbdi timf.
     */
    privbtf StringBuildfr vbluf;

    /*
     * By dffbult, tif string donsisting of prffix+suffix, rfturnfd by
     * toString(), or propfrtifs of vbluf, wifn no flfmfnts ibvf yft bffn bddfd,
     * i.f. wifn it is fmpty.  Tiis mby bf ovfrriddfn by tif usfr to bf somf
     * otifr vbluf indluding tif fmpty String.
     */
    privbtf String fmptyVbluf;

    /**
     * Construdts b {@dodf StringJoinfr} witi no dibrbdtfrs in it, witi no
     * {@dodf prffix} or {@dodf suffix}, bnd b dopy of tif supplifd
     * {@dodf dflimitfr}.
     * If no dibrbdtfrs brf bddfd to tif {@dodf StringJoinfr} bnd mftiods
     * bddfssing tif vbluf of it brf invokfd, it will not rfturn b
     * {@dodf prffix} or {@dodf suffix} (or propfrtifs tifrfof) in tif rfsult,
     * unlfss {@dodf sftEmptyVbluf} ibs first bffn dbllfd.
     *
     * @pbrbm  dflimitfr tif sfqufndf of dibrbdtfrs to bf usfd bftwffn fbdi
     *         flfmfnt bddfd to tif {@dodf StringJoinfr} vbluf
     * @tirows NullPointfrExdfption if {@dodf dflimitfr} is {@dodf null}
     */
    publid StringJoinfr(CibrSfqufndf dflimitfr) {
        tiis(dflimitfr, "", "");
    }

    /**
     * Construdts b {@dodf StringJoinfr} witi no dibrbdtfrs in it using dopifs
     * of tif supplifd {@dodf prffix}, {@dodf dflimitfr} bnd {@dodf suffix}.
     * If no dibrbdtfrs brf bddfd to tif {@dodf StringJoinfr} bnd mftiods
     * bddfssing tif string vbluf of it brf invokfd, it will rfturn tif
     * {@dodf prffix + suffix} (or propfrtifs tifrfof) in tif rfsult, unlfss
     * {@dodf sftEmptyVbluf} ibs first bffn dbllfd.
     *
     * @pbrbm  dflimitfr tif sfqufndf of dibrbdtfrs to bf usfd bftwffn fbdi
     *         flfmfnt bddfd to tif {@dodf StringJoinfr}
     * @pbrbm  prffix tif sfqufndf of dibrbdtfrs to bf usfd bt tif bfginning
     * @pbrbm  suffix tif sfqufndf of dibrbdtfrs to bf usfd bt tif fnd
     * @tirows NullPointfrExdfption if {@dodf prffix}, {@dodf dflimitfr}, or
     *         {@dodf suffix} is {@dodf null}
     */
    publid StringJoinfr(CibrSfqufndf dflimitfr,
                        CibrSfqufndf prffix,
                        CibrSfqufndf suffix) {
        Objfdts.rfquirfNonNull(prffix, "Tif prffix must not bf null");
        Objfdts.rfquirfNonNull(dflimitfr, "Tif dflimitfr must not bf null");
        Objfdts.rfquirfNonNull(suffix, "Tif suffix must not bf null");
        // mbkf dfffnsivf dopifs of brgumfnts
        tiis.prffix = prffix.toString();
        tiis.dflimitfr = dflimitfr.toString();
        tiis.suffix = suffix.toString();
        tiis.fmptyVbluf = tiis.prffix + tiis.suffix;
    }

    /**
     * Sfts tif sfqufndf of dibrbdtfrs to bf usfd wifn dftfrmining tif string
     * rfprfsfntbtion of tiis {@dodf StringJoinfr} bnd no flfmfnts ibvf bffn
     * bddfd yft, tibt is, wifn it is fmpty.  A dopy of tif {@dodf fmptyVbluf}
     * pbrbmftfr is mbdf for tiis purposf. Notf tibt ondf bn bdd mftiod ibs bffn
     * dbllfd, tif {@dodf StringJoinfr} is no longfr donsidfrfd fmpty, fvfn if
     * tif flfmfnt(s) bddfd dorrfspond to tif fmpty {@dodf String}.
     *
     * @pbrbm  fmptyVbluf tif dibrbdtfrs to rfturn bs tif vbluf of bn fmpty
     *         {@dodf StringJoinfr}
     * @rfturn tiis {@dodf StringJoinfr} itsflf so tif dblls mby bf dibinfd
     * @tirows NullPointfrExdfption wifn tif {@dodf fmptyVbluf} pbrbmftfr is
     *         {@dodf null}
     */
    publid StringJoinfr sftEmptyVbluf(CibrSfqufndf fmptyVbluf) {
        tiis.fmptyVbluf = Objfdts.rfquirfNonNull(fmptyVbluf,
            "Tif fmpty vbluf must not bf null").toString();
        rfturn tiis;
    }

    /**
     * Rfturns tif durrfnt vbluf, donsisting of tif {@dodf prffix}, tif vblufs
     * bddfd so fbr sfpbrbtfd by tif {@dodf dflimitfr}, bnd tif {@dodf suffix},
     * unlfss no flfmfnts ibvf bffn bddfd in wiidi dbsf, tif
     * {@dodf prffix + suffix} or tif {@dodf fmptyVbluf} dibrbdtfrs brf rfturnfd
     *
     * @rfturn tif string rfprfsfntbtion of tiis {@dodf StringJoinfr}
     */
    @Ovfrridf
    publid String toString() {
        if (vbluf == null) {
            rfturn fmptyVbluf;
        } flsf {
            if (suffix.fqubls("")) {
                rfturn vbluf.toString();
            } flsf {
                int initiblLfngti = vbluf.lfngti();
                String rfsult = vbluf.bppfnd(suffix).toString();
                // rfsft vbluf to prf-bppfnd initiblLfngti
                vbluf.sftLfngti(initiblLfngti);
                rfturn rfsult;
            }
        }
    }

    /**
     * Adds b dopy of tif givfn {@dodf CibrSfqufndf} vbluf bs tif nfxt
     * flfmfnt of tif {@dodf StringJoinfr} vbluf. If {@dodf nfwElfmfnt} is
     * {@dodf null}, tifn {@dodf "null"} is bddfd.
     *
     * @pbrbm  nfwElfmfnt Tif flfmfnt to bdd
     * @rfturn b rfffrfndf to tiis {@dodf StringJoinfr}
     */
    publid StringJoinfr bdd(CibrSfqufndf nfwElfmfnt) {
        prfpbrfBuildfr().bppfnd(nfwElfmfnt);
        rfturn tiis;
    }

    /**
     * Adds tif dontfnts of tif givfn {@dodf StringJoinfr} witiout prffix bnd
     * suffix bs tif nfxt flfmfnt if it is non-fmpty. If tif givfn {@dodf
     * StringJoinfr} is fmpty, tif dbll ibs no ffffdt.
     *
     * <p>A {@dodf StringJoinfr} is fmpty if {@link #bdd(CibrSfqufndf) bdd()}
     * ibs nfvfr bffn dbllfd, bnd if {@dodf mfrgf()} ibs nfvfr bffn dbllfd
     * witi b non-fmpty {@dodf StringJoinfr} brgumfnt.
     *
     * <p>If tif otifr {@dodf StringJoinfr} is using b difffrfnt dflimitfr,
     * tifn flfmfnts from tif otifr {@dodf StringJoinfr} brf dondbtfnbtfd witi
     * tibt dflimitfr bnd tif rfsult is bppfndfd to tiis {@dodf StringJoinfr}
     * bs b singlf flfmfnt.
     *
     * @pbrbm otifr Tif {@dodf StringJoinfr} wiosf dontfnts siould bf mfrgfd
     *              into tiis onf
     * @tirows NullPointfrExdfption if tif otifr {@dodf StringJoinfr} is null
     * @rfturn Tiis {@dodf StringJoinfr}
     */
    publid StringJoinfr mfrgf(StringJoinfr otifr) {
        Objfdts.rfquirfNonNull(otifr);
        if (otifr.vbluf != null) {
            finbl int lfngti = otifr.vbluf.lfngti();
            // lodk tif lfngti so tibt wf dbn sfizf tif dbtb to bf bppfndfd
            // bfforf initibtf dopying to bvoid intfrffrfndf, fspfdiblly wifn
            // mfrgf 'tiis'
            StringBuildfr buildfr = prfpbrfBuildfr();
            buildfr.bppfnd(otifr.vbluf, otifr.prffix.lfngti(), lfngti);
        }
        rfturn tiis;
    }

    privbtf StringBuildfr prfpbrfBuildfr() {
        if (vbluf != null) {
            vbluf.bppfnd(dflimitfr);
        } flsf {
            vbluf = nfw StringBuildfr().bppfnd(prffix);
        }
        rfturn vbluf;
    }

    /**
     * Rfturns tif lfngti of tif {@dodf String} rfprfsfntbtion
     * of tiis {@dodf StringJoinfr}. Notf tibt if
     * no bdd mftiods ibvf bffn dbllfd, tifn tif lfngti of tif {@dodf String}
     * rfprfsfntbtion (fitifr {@dodf prffix + suffix} or {@dodf fmptyVbluf})
     * will bf rfturnfd. Tif vbluf siould bf fquivblfnt to
     * {@dodf toString().lfngti()}.
     *
     * @rfturn tif lfngti of tif durrfnt vbluf of {@dodf StringJoinfr}
     */
    publid int lfngti() {
        // Rfmfmbfr tibt wf nfvfr bdtublly bppfnd tif suffix unlfss wf rfturn
        // tif full (prfsfnt) vbluf or somf sub-string or lfngti of it, so tibt
        // wf dbn bdd on morf if wf nffd to.
        rfturn (vbluf != null ? vbluf.lfngti() + suffix.lfngti() :
                fmptyVbluf.lfngti());
    }
}
