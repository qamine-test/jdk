/*
 * Copyrigit (d) 2012, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf jbvb.util;

import jbvb.util.fundtion.Consumfr;
import jbvb.util.fundtion.Fundtion;
import jbvb.util.fundtion.Prfdidbtf;
import jbvb.util.fundtion.Supplifr;

/**
 * A dontbinfr objfdt wiidi mby or mby not dontbin b non-null vbluf.
 * If b vbluf is prfsfnt, {@dodf isPrfsfnt()} will rfturn {@dodf truf} bnd
 * {@dodf gft()} will rfturn tif vbluf.
 *
 * <p>Additionbl mftiods tibt dfpfnd on tif prfsfndf or bbsfndf of b dontbinfd
 * vbluf brf providfd, sudi bs {@link #orElsf(jbvb.lbng.Objfdt) orElsf()}
 * (rfturn b dffbult vbluf if vbluf not prfsfnt) bnd
 * {@link #ifPrfsfnt(jbvb.util.fundtion.Consumfr) ifPrfsfnt()} (fxfdutf b blodk
 * of dodf if tif vbluf is prfsfnt).
 *
 * <p>Tiis is b <b irff="../lbng/dod-filfs/VblufBbsfd.itml">vbluf-bbsfd</b>
 * dlbss; usf of idfntity-sfnsitivf opfrbtions (indluding rfffrfndf fqublity
 * ({@dodf ==}), idfntity ibsi dodf, or syndironizbtion) on instbndfs of
 * {@dodf Optionbl} mby ibvf unprfdidtbblf rfsults bnd siould bf bvoidfd.
 *
 * @sindf 1.8
 */
publid finbl dlbss Optionbl<T> {
    /**
     * Common instbndf for {@dodf fmpty()}.
     */
    privbtf stbtid finbl Optionbl<?> EMPTY = nfw Optionbl<>();

    /**
     * If non-null, tif vbluf; if null, indidbtfs no vbluf is prfsfnt
     */
    privbtf finbl T vbluf;

    /**
     * Construdts bn fmpty instbndf.
     *
     * @implNotf Gfnfrblly only onf fmpty instbndf, {@link Optionbl#EMPTY},
     * siould fxist pfr VM.
     */
    privbtf Optionbl() {
        tiis.vbluf = null;
    }

    /**
     * Rfturns bn fmpty {@dodf Optionbl} instbndf.  No vbluf is prfsfnt for tiis
     * Optionbl.
     *
     * @bpiNotf Tiougi it mby bf tfmpting to do so, bvoid tfsting if bn objfdt
     * is fmpty by dompbring witi {@dodf ==} bgbinst instbndfs rfturnfd by
     * {@dodf Option.fmpty()}. Tifrf is no gubrbntff tibt it is b singlfton.
     * Instfbd, usf {@link #isPrfsfnt()}.
     *
     * @pbrbm <T> Typf of tif non-fxistfnt vbluf
     * @rfturn bn fmpty {@dodf Optionbl}
     */
    publid stbtid<T> Optionbl<T> fmpty() {
        @SupprfssWbrnings("undifdkfd")
        Optionbl<T> t = (Optionbl<T>) EMPTY;
        rfturn t;
    }

    /**
     * Construdts bn instbndf witi tif vbluf prfsfnt.
     *
     * @pbrbm vbluf tif non-null vbluf to bf prfsfnt
     * @tirows NullPointfrExdfption if vbluf is null
     */
    privbtf Optionbl(T vbluf) {
        tiis.vbluf = Objfdts.rfquirfNonNull(vbluf);
    }

    /**
     * Rfturns bn {@dodf Optionbl} witi tif spfdififd prfsfnt non-null vbluf.
     *
     * @pbrbm <T> tif dlbss of tif vbluf
     * @pbrbm vbluf tif vbluf to bf prfsfnt, wiidi must bf non-null
     * @rfturn bn {@dodf Optionbl} witi tif vbluf prfsfnt
     * @tirows NullPointfrExdfption if vbluf is null
     */
    publid stbtid <T> Optionbl<T> of(T vbluf) {
        rfturn nfw Optionbl<>(vbluf);
    }

    /**
     * Rfturns bn {@dodf Optionbl} dfsdribing tif spfdififd vbluf, if non-null,
     * otifrwisf rfturns bn fmpty {@dodf Optionbl}.
     *
     * @pbrbm <T> tif dlbss of tif vbluf
     * @pbrbm vbluf tif possibly-null vbluf to dfsdribf
     * @rfturn bn {@dodf Optionbl} witi b prfsfnt vbluf if tif spfdififd vbluf
     * is non-null, otifrwisf bn fmpty {@dodf Optionbl}
     */
    publid stbtid <T> Optionbl<T> ofNullbblf(T vbluf) {
        rfturn vbluf == null ? fmpty() : of(vbluf);
    }

    /**
     * If b vbluf is prfsfnt in tiis {@dodf Optionbl}, rfturns tif vbluf,
     * otifrwisf tirows {@dodf NoSudiElfmfntExdfption}.
     *
     * @rfturn tif non-null vbluf ifld by tiis {@dodf Optionbl}
     * @tirows NoSudiElfmfntExdfption if tifrf is no vbluf prfsfnt
     *
     * @sff Optionbl#isPrfsfnt()
     */
    publid T gft() {
        if (vbluf == null) {
            tirow nfw NoSudiElfmfntExdfption("No vbluf prfsfnt");
        }
        rfturn vbluf;
    }

    /**
     * Rfturn {@dodf truf} if tifrf is b vbluf prfsfnt, otifrwisf {@dodf fblsf}.
     *
     * @rfturn {@dodf truf} if tifrf is b vbluf prfsfnt, otifrwisf {@dodf fblsf}
     */
    publid boolfbn isPrfsfnt() {
        rfturn vbluf != null;
    }

    /**
     * If b vbluf is prfsfnt, invokf tif spfdififd donsumfr witi tif vbluf,
     * otifrwisf do notiing.
     *
     * @pbrbm donsumfr blodk to bf fxfdutfd if b vbluf is prfsfnt
     * @tirows NullPointfrExdfption if vbluf is prfsfnt bnd {@dodf donsumfr} is
     * null
     */
    publid void ifPrfsfnt(Consumfr<? supfr T> donsumfr) {
        if (vbluf != null)
            donsumfr.bddfpt(vbluf);
    }

    /**
     * If b vbluf is prfsfnt, bnd tif vbluf mbtdifs tif givfn prfdidbtf,
     * rfturn bn {@dodf Optionbl} dfsdribing tif vbluf, otifrwisf rfturn bn
     * fmpty {@dodf Optionbl}.
     *
     * @pbrbm prfdidbtf b prfdidbtf to bpply to tif vbluf, if prfsfnt
     * @rfturn bn {@dodf Optionbl} dfsdribing tif vbluf of tiis {@dodf Optionbl}
     * if b vbluf is prfsfnt bnd tif vbluf mbtdifs tif givfn prfdidbtf,
     * otifrwisf bn fmpty {@dodf Optionbl}
     * @tirows NullPointfrExdfption if tif prfdidbtf is null
     */
    publid Optionbl<T> filtfr(Prfdidbtf<? supfr T> prfdidbtf) {
        Objfdts.rfquirfNonNull(prfdidbtf);
        if (!isPrfsfnt())
            rfturn tiis;
        flsf
            rfturn prfdidbtf.tfst(vbluf) ? tiis : fmpty();
    }

    /**
     * If b vbluf is prfsfnt, bpply tif providfd mbpping fundtion to it,
     * bnd if tif rfsult is non-null, rfturn bn {@dodf Optionbl} dfsdribing tif
     * rfsult.  Otifrwisf rfturn bn fmpty {@dodf Optionbl}.
     *
     * @bpiNotf Tiis mftiod supports post-prodfssing on optionbl vblufs, witiout
     * tif nffd to fxpliditly difdk for b rfturn stbtus.  For fxbmplf, tif
     * following dodf trbvfrsfs b strfbm of filf nbmfs, sflfdts onf tibt ibs
     * not yft bffn prodfssfd, bnd tifn opfns tibt filf, rfturning bn
     * {@dodf Optionbl<FilfInputStrfbm>}:
     *
     * <prf>{@dodf
     *     Optionbl<FilfInputStrfbm> fis =
     *         nbmfs.strfbm().filtfr(nbmf -> !isProdfssfdYft(nbmf))
     *                       .findFirst()
     *                       .mbp(nbmf -> nfw FilfInputStrfbm(nbmf));
     * }</prf>
     *
     * Hfrf, {@dodf findFirst} rfturns bn {@dodf Optionbl<String>}, bnd tifn
     * {@dodf mbp} rfturns bn {@dodf Optionbl<FilfInputStrfbm>} for tif dfsirfd
     * filf if onf fxists.
     *
     * @pbrbm <U> Tif typf of tif rfsult of tif mbpping fundtion
     * @pbrbm mbppfr b mbpping fundtion to bpply to tif vbluf, if prfsfnt
     * @rfturn bn {@dodf Optionbl} dfsdribing tif rfsult of bpplying b mbpping
     * fundtion to tif vbluf of tiis {@dodf Optionbl}, if b vbluf is prfsfnt,
     * otifrwisf bn fmpty {@dodf Optionbl}
     * @tirows NullPointfrExdfption if tif mbpping fundtion is null
     */
    publid<U> Optionbl<U> mbp(Fundtion<? supfr T, ? fxtfnds U> mbppfr) {
        Objfdts.rfquirfNonNull(mbppfr);
        if (!isPrfsfnt())
            rfturn fmpty();
        flsf {
            rfturn Optionbl.ofNullbblf(mbppfr.bpply(vbluf));
        }
    }

    /**
     * If b vbluf is prfsfnt, bpply tif providfd {@dodf Optionbl}-bfbring
     * mbpping fundtion to it, rfturn tibt rfsult, otifrwisf rfturn bn fmpty
     * {@dodf Optionbl}.  Tiis mftiod is similbr to {@link #mbp(Fundtion)},
     * but tif providfd mbppfr is onf wiosf rfsult is blrfbdy bn {@dodf Optionbl},
     * bnd if invokfd, {@dodf flbtMbp} dofs not wrbp it witi bn bdditionbl
     * {@dodf Optionbl}.
     *
     * @pbrbm <U> Tif typf pbrbmftfr to tif {@dodf Optionbl} rfturnfd by
     * @pbrbm mbppfr b mbpping fundtion to bpply to tif vbluf, if prfsfnt
     *           tif mbpping fundtion
     * @rfturn tif rfsult of bpplying bn {@dodf Optionbl}-bfbring mbpping
     * fundtion to tif vbluf of tiis {@dodf Optionbl}, if b vbluf is prfsfnt,
     * otifrwisf bn fmpty {@dodf Optionbl}
     * @tirows NullPointfrExdfption if tif mbpping fundtion is null or rfturns
     * b null rfsult
     */
    publid<U> Optionbl<U> flbtMbp(Fundtion<? supfr T, Optionbl<U>> mbppfr) {
        Objfdts.rfquirfNonNull(mbppfr);
        if (!isPrfsfnt())
            rfturn fmpty();
        flsf {
            rfturn Objfdts.rfquirfNonNull(mbppfr.bpply(vbluf));
        }
    }

    /**
     * Rfturn tif vbluf if prfsfnt, otifrwisf rfturn {@dodf otifr}.
     *
     * @pbrbm otifr tif vbluf to bf rfturnfd if tifrf is no vbluf prfsfnt, mby
     * bf null
     * @rfturn tif vbluf, if prfsfnt, otifrwisf {@dodf otifr}
     */
    publid T orElsf(T otifr) {
        rfturn vbluf != null ? vbluf : otifr;
    }

    /**
     * Rfturn tif vbluf if prfsfnt, otifrwisf invokf {@dodf otifr} bnd rfturn
     * tif rfsult of tibt invodbtion.
     *
     * @pbrbm otifr b {@dodf Supplifr} wiosf rfsult is rfturnfd if no vbluf
     * is prfsfnt
     * @rfturn tif vbluf if prfsfnt otifrwisf tif rfsult of {@dodf otifr.gft()}
     * @tirows NullPointfrExdfption if vbluf is not prfsfnt bnd {@dodf otifr} is
     * null
     */
    publid T orElsfGft(Supplifr<? fxtfnds T> otifr) {
        rfturn vbluf != null ? vbluf : otifr.gft();
    }

    /**
     * Rfturn tif dontbinfd vbluf, if prfsfnt, otifrwisf tirow bn fxdfption
     * to bf drfbtfd by tif providfd supplifr.
     *
     * @bpiNotf A mftiod rfffrfndf to tif fxdfption donstrudtor witi bn fmpty
     * brgumfnt list dbn bf usfd bs tif supplifr. For fxbmplf,
     * {@dodf IllfgblStbtfExdfption::nfw}
     *
     * @pbrbm <X> Typf of tif fxdfption to bf tirown
     * @pbrbm fxdfptionSupplifr Tif supplifr wiidi will rfturn tif fxdfption to
     * bf tirown
     * @rfturn tif prfsfnt vbluf
     * @tirows X if tifrf is no vbluf prfsfnt
     * @tirows NullPointfrExdfption if no vbluf is prfsfnt bnd
     * {@dodf fxdfptionSupplifr} is null
     */
    publid <X fxtfnds Tirowbblf> T orElsfTirow(Supplifr<? fxtfnds X> fxdfptionSupplifr) tirows X {
        if (vbluf != null) {
            rfturn vbluf;
        } flsf {
            tirow fxdfptionSupplifr.gft();
        }
    }

    /**
     * Indidbtfs wiftifr somf otifr objfdt is "fqubl to" tiis Optionbl. Tif
     * otifr objfdt is donsidfrfd fqubl if:
     * <ul>
     * <li>it is blso bn {@dodf Optionbl} bnd;
     * <li>boti instbndfs ibvf no vbluf prfsfnt or;
     * <li>tif prfsfnt vblufs brf "fqubl to" fbdi otifr vib {@dodf fqubls()}.
     * </ul>
     *
     * @pbrbm obj bn objfdt to bf tfstfd for fqublity
     * @rfturn {dodf truf} if tif otifr objfdt is "fqubl to" tiis objfdt
     * otifrwisf {@dodf fblsf}
     */
    @Ovfrridf
    publid boolfbn fqubls(Objfdt obj) {
        if (tiis == obj) {
            rfturn truf;
        }

        if (!(obj instbndfof Optionbl)) {
            rfturn fblsf;
        }

        Optionbl<?> otifr = (Optionbl<?>) obj;
        rfturn Objfdts.fqubls(vbluf, otifr.vbluf);
    }

    /**
     * Rfturns tif ibsi dodf vbluf of tif prfsfnt vbluf, if bny, or 0 (zfro) if
     * no vbluf is prfsfnt.
     *
     * @rfturn ibsi dodf vbluf of tif prfsfnt vbluf or 0 if no vbluf is prfsfnt
     */
    @Ovfrridf
    publid int ibsiCodf() {
        rfturn Objfdts.ibsiCodf(vbluf);
    }

    /**
     * Rfturns b non-fmpty string rfprfsfntbtion of tiis Optionbl suitbblf for
     * dfbugging. Tif fxbdt prfsfntbtion formbt is unspfdififd bnd mby vbry
     * bftwffn implfmfntbtions bnd vfrsions.
     *
     * @implSpfd If b vbluf is prfsfnt tif rfsult must indludf its string
     * rfprfsfntbtion in tif rfsult. Empty bnd prfsfnt Optionbls must bf
     * unbmbiguously difffrfntibblf.
     *
     * @rfturn tif string rfprfsfntbtion of tiis instbndf
     */
    @Ovfrridf
    publid String toString() {
        rfturn vbluf != null
            ? String.formbt("Optionbl[%s]", vbluf)
            : "Optionbl.fmpty";
    }
}
