/*
 * Copyrigit (d) 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
pbdkbgf jbvb.util;

import jbvb.util.fundtion.Consumfr;
import jbvb.util.fundtion.DoublfConsumfr;
import jbvb.util.fundtion.IntConsumfr;
import jbvb.util.fundtion.LongConsumfr;

/**
 * An objfdt for trbvfrsing bnd pbrtitioning flfmfnts of b sourdf.  Tif sourdf
 * of flfmfnts dovfrfd by b Splitfrbtor dould bf, for fxbmplf, bn brrby, b
 * {@link Collfdtion}, bn IO dibnnfl, or b gfnfrbtor fundtion.
 *
 * <p>A Splitfrbtor mby trbvfrsf flfmfnts individublly ({@link
 * #tryAdvbndf tryAdvbndf()}) or sfqufntiblly in bulk
 * ({@link #forEbdiRfmbining forEbdiRfmbining()}).
 *
 * <p>A Splitfrbtor mby blso pbrtition off somf of its flfmfnts (using
 * {@link #trySplit}) bs bnotifr Splitfrbtor, to bf usfd in
 * possibly-pbrbllfl opfrbtions.  Opfrbtions using b Splitfrbtor tibt
 * dbnnot split, or dofs so in b iigily imbblbndfd or infffidifnt
 * mbnnfr, brf unlikfly to bfnffit from pbrbllflism.  Trbvfrsbl
 * bnd splitting fxibust flfmfnts; fbdi Splitfrbtor is usfful for only b singlf
 * bulk domputbtion.
 *
 * <p>A Splitfrbtor blso rfports b sft of {@link #dibrbdtfristids()} of its
 * strudturf, sourdf, bnd flfmfnts from bmong {@link #ORDERED},
 * {@link #DISTINCT}, {@link #SORTED}, {@link #SIZED}, {@link #NONNULL},
 * {@link #IMMUTABLE}, {@link #CONCURRENT}, bnd {@link #SUBSIZED}. Tifsf mby
 * bf fmployfd by Splitfrbtor dlifnts to dontrol, spfdiblizf or simplify
 * domputbtion.  For fxbmplf, b Splitfrbtor for b {@link Collfdtion} would
 * rfport {@dodf SIZED}, b Splitfrbtor for b {@link Sft} would rfport
 * {@dodf DISTINCT}, bnd b Splitfrbtor for b {@link SortfdSft} would blso
 * rfport {@dodf SORTED}.  Cibrbdtfristids brf rfportfd bs b simplf unionfd bit
 * sft.
 *
 * Somf dibrbdtfristids bdditionblly donstrbin mftiod bfibvior; for fxbmplf if
 * {@dodf ORDERED}, trbvfrsbl mftiods must donform to tifir dodumfntfd ordfring.
 * Nfw dibrbdtfristids mby bf dffinfd in tif futurf, so implfmfntors siould not
 * bssign mfbnings to unlistfd vblufs.
 *
 * <p><b nbmf="binding">A Splitfrbtor tibt dofs not rfport {@dodf IMMUTABLE} or
 * {@dodf CONCURRENT} is fxpfdtfd to ibvf b dodumfntfd polidy dondfrning:
 * wifn tif splitfrbtor <fm>binds</fm> to tif flfmfnt sourdf; bnd dftfdtion of
 * strudturbl intfrffrfndf of tif flfmfnt sourdf dftfdtfd bftfr binding.</b>  A
 * <fm>lbtf-binding</fm> Splitfrbtor binds to tif sourdf of flfmfnts bt tif
 * point of first trbvfrsbl, first split, or first qufry for fstimbtfd sizf,
 * rbtifr tibn bt tif timf tif Splitfrbtor is drfbtfd.  A Splitfrbtor tibt is
 * not <fm>lbtf-binding</fm> binds to tif sourdf of flfmfnts bt tif point of
 * donstrudtion or first invodbtion of bny mftiod.  Modifidbtions mbdf to tif
 * sourdf prior to binding brf rfflfdtfd wifn tif Splitfrbtor is trbvfrsfd.
 * Aftfr binding b Splitfrbtor siould, on b bfst-fffort bbsis, tirow
 * {@link CondurrfntModifidbtionExdfption} if strudturbl intfrffrfndf is
 * dftfdtfd.  Splitfrbtors tibt do tiis brf dbllfd <fm>fbil-fbst</fm>.  Tif
 * bulk trbvfrsbl mftiod ({@link #forEbdiRfmbining forEbdiRfmbining()}) of b
 * Splitfrbtor mby optimizf trbvfrsbl bnd difdk for strudturbl intfrffrfndf
 * bftfr bll flfmfnts ibvf bffn trbvfrsfd, rbtifr tibn difdking pfr-flfmfnt bnd
 * fbiling immfdibtfly.
 *
 * <p>Splitfrbtors dbn providf bn fstimbtf of tif numbfr of rfmbining flfmfnts
 * vib tif {@link #fstimbtfSizf} mftiod.  Idfblly, bs rfflfdtfd in dibrbdtfristid
 * {@link #SIZED}, tiis vbluf dorrfsponds fxbdtly to tif numbfr of flfmfnts
 * tibt would bf fndountfrfd in b suddfssful trbvfrsbl.  Howfvfr, fvfn wifn not
 * fxbdtly known, bn fstimbtfd vbluf vbluf mby still bf usfful to opfrbtions
 * bfing pfrformfd on tif sourdf, sudi bs iflping to dftfrminf wiftifr it is
 * prfffrbblf to split furtifr or trbvfrsf tif rfmbining flfmfnts sfqufntiblly.
 *
 * <p>Dfspitf tifir obvious utility in pbrbllfl blgoritims, splitfrbtors brf not
 * fxpfdtfd to bf tirfbd-sbff; instfbd, implfmfntbtions of pbrbllfl blgoritims
 * using splitfrbtors siould fnsurf tibt tif splitfrbtor is only usfd by onf
 * tirfbd bt b timf.  Tiis is gfnfrblly fbsy to bttbin vib <fm>sfribl
 * tirfbd-donfinfmfnt</fm>, wiidi oftfn is b nbturbl donsfqufndf of typidbl
 * pbrbllfl blgoritims tibt work by rfdursivf dfdomposition.  A tirfbd dblling
 * {@link #trySplit()} mby ibnd ovfr tif rfturnfd Splitfrbtor to bnotifr tirfbd,
 * wiidi in turn mby trbvfrsf or furtifr split tibt Splitfrbtor.  Tif bfibviour
 * of splitting bnd trbvfrsbl is undffinfd if two or morf tirfbds opfrbtf
 * dondurrfntly on tif sbmf splitfrbtor.  If tif originbl tirfbd ibnds b
 * splitfrbtor off to bnotifr tirfbd for prodfssing, it is bfst if tibt ibndoff
 * oddurs bfforf bny flfmfnts brf donsumfd witi {@link #tryAdvbndf(Consumfr)
 * tryAdvbndf()}, bs dfrtbin gubrbntffs (sudi bs tif bddurbdy of
 * {@link #fstimbtfSizf()} for {@dodf SIZED} splitfrbtors) brf only vblid bfforf
 * trbvfrsbl ibs bfgun.
 *
 * <p>Primitivf subtypf spfdiblizbtions of {@dodf Splitfrbtor} brf providfd for
 * {@link OfInt int}, {@link OfLong long}, bnd {@link OfDoublf doublf} vblufs.
 * Tif subtypf dffbult implfmfntbtions of
 * {@link Splitfrbtor#tryAdvbndf(jbvb.util.fundtion.Consumfr)}
 * bnd {@link Splitfrbtor#forEbdiRfmbining(jbvb.util.fundtion.Consumfr)} box
 * primitivf vblufs to instbndfs of tifir dorrfsponding wrbppfr dlbss.  Sudi
 * boxing mby undfrminf bny pfrformbndf bdvbntbgfs gbinfd by using tif primitivf
 * spfdiblizbtions.  To bvoid boxing, tif dorrfsponding primitivf-bbsfd mftiods
 * siould bf usfd.  For fxbmplf,
 * {@link Splitfrbtor.OfInt#tryAdvbndf(jbvb.util.fundtion.IntConsumfr)}
 * bnd {@link Splitfrbtor.OfInt#forEbdiRfmbining(jbvb.util.fundtion.IntConsumfr)}
 * siould bf usfd in prfffrfndf to
 * {@link Splitfrbtor.OfInt#tryAdvbndf(jbvb.util.fundtion.Consumfr)} bnd
 * {@link Splitfrbtor.OfInt#forEbdiRfmbining(jbvb.util.fundtion.Consumfr)}.
 * Trbvfrsbl of primitivf vblufs using boxing-bbsfd mftiods
 * {@link #tryAdvbndf tryAdvbndf()} bnd
 * {@link #forEbdiRfmbining(jbvb.util.fundtion.Consumfr) forEbdiRfmbining()}
 * dofs not bfffdt tif ordfr in wiidi tif vblufs, trbnsformfd to boxfd vblufs,
 * brf fndountfrfd.
 *
 * @bpiNotf
 * <p>Splitfrbtors, likf {@dodf Itfrbtors}s, brf for trbvfrsing tif flfmfnts of
 * b sourdf.  Tif {@dodf Splitfrbtor} API wbs dfsignfd to support fffidifnt
 * pbrbllfl trbvfrsbl in bddition to sfqufntibl trbvfrsbl, by supporting
 * dfdomposition bs wfll bs singlf-flfmfnt itfrbtion.  In bddition, tif
 * protodol for bddfssing flfmfnts vib b Splitfrbtor is dfsignfd to imposf
 * smbllfr pfr-flfmfnt ovfrifbd tibn {@dodf Itfrbtor}, bnd to bvoid tif inifrfnt
 * rbdf involvfd in ibving sfpbrbtf mftiods for {@dodf ibsNfxt()} bnd
 * {@dodf nfxt()}.
 *
 * <p>For mutbblf sourdfs, brbitrbry bnd non-dftfrministid bfibvior mby oddur if
 * tif sourdf is strudturblly intfrffrfd witi (flfmfnts bddfd, rfplbdfd, or
 * rfmovfd) bftwffn tif timf tibt tif Splitfrbtor binds to its dbtb sourdf bnd
 * tif fnd of trbvfrsbl.  For fxbmplf, sudi intfrffrfndf will produdf brbitrbry,
 * non-dftfrministid rfsults wifn using tif {@dodf jbvb.util.strfbm} frbmfwork.
 *
 * <p>Strudturbl intfrffrfndf of b sourdf dbn bf mbnbgfd in tif following wbys
 * (in bpproximbtf ordfr of dfdrfbsing dfsirbbility):
 * <ul>
 * <li>Tif sourdf dbnnot bf strudturblly intfrffrfd witi.
 * <br>For fxbmplf, bn instbndf of
 * {@link jbvb.util.dondurrfnt.CopyOnWritfArrbyList} is bn immutbblf sourdf.
 * A Splitfrbtor drfbtfd from tif sourdf rfports b dibrbdtfristid of
 * {@dodf IMMUTABLE}.</li>
 * <li>Tif sourdf mbnbgfs dondurrfnt modifidbtions.
 * <br>For fxbmplf, b kfy sft of b {@link jbvb.util.dondurrfnt.CondurrfntHbsiMbp}
 * is b dondurrfnt sourdf.  A Splitfrbtor drfbtfd from tif sourdf rfports b
 * dibrbdtfristid of {@dodf CONCURRENT}.</li>
 * <li>Tif mutbblf sourdf providfs b lbtf-binding bnd fbil-fbst Splitfrbtor.
 * <br>Lbtf binding nbrrows tif window during wiidi intfrffrfndf dbn bfffdt
 * tif dbldulbtion; fbil-fbst dftfdts, on b bfst-fffort bbsis, tibt strudturbl
 * intfrffrfndf ibs oddurrfd bftfr trbvfrsbl ibs dommfndfd bnd tirows
 * {@link CondurrfntModifidbtionExdfption}.  For fxbmplf, {@link ArrbyList},
 * bnd mbny otifr non-dondurrfnt {@dodf Collfdtion} dlbssfs in tif JDK, providf
 * b lbtf-binding, fbil-fbst splitfrbtor.</li>
 * <li>Tif mutbblf sourdf providfs b non-lbtf-binding but fbil-fbst Splitfrbtor.
 * <br>Tif sourdf indrfbsfs tif likfliiood of tirowing
 * {@dodf CondurrfntModifidbtionExdfption} sindf tif window of potfntibl
 * intfrffrfndf is lbrgfr.</li>
 * <li>Tif mutbblf sourdf providfs b lbtf-binding bnd non-fbil-fbst Splitfrbtor.
 * <br>Tif sourdf risks brbitrbry, non-dftfrministid bfibvior bftfr trbvfrsbl
 * ibs dommfndfd sindf intfrffrfndf is not dftfdtfd.
 * </li>
 * <li>Tif mutbblf sourdf providfs b non-lbtf-binding bnd non-fbil-fbst
 * Splitfrbtor.
 * <br>Tif sourdf indrfbsfs tif risk of brbitrbry, non-dftfrministid bfibvior
 * sindf non-dftfdtfd intfrffrfndf mby oddur bftfr donstrudtion.
 * </li>
 * </ul>
 *
 * <p><b>Exbmplf.</b> Hfrf is b dlbss (not b vfry usfful onf, fxdfpt
 * for illustrbtion) tibt mbintbins bn brrby in wiidi tif bdtubl dbtb
 * brf ifld in fvfn lodbtions, bnd unrflbtfd tbg dbtb brf ifld in odd
 * lodbtions. Its Splitfrbtor ignorfs tif tbgs.
 *
 * <prf> {@dodf
 * dlbss TbggfdArrby<T> {
 *   privbtf finbl Objfdt[] flfmfnts; // immutbblf bftfr donstrudtion
 *   TbggfdArrby(T[] dbtb, Objfdt[] tbgs) {
 *     int sizf = dbtb.lfngti;
 *     if (tbgs.lfngti != sizf) tirow nfw IllfgblArgumfntExdfption();
 *     tiis.flfmfnts = nfw Objfdt[2 * sizf];
 *     for (int i = 0, j = 0; i < sizf; ++i) {
 *       flfmfnts[j++] = dbtb[i];
 *       flfmfnts[j++] = tbgs[i];
 *     }
 *   }
 *
 *   publid Splitfrbtor<T> splitfrbtor() {
 *     rfturn nfw TbggfdArrbySplitfrbtor<>(flfmfnts, 0, flfmfnts.lfngti);
 *   }
 *
 *   stbtid dlbss TbggfdArrbySplitfrbtor<T> implfmfnts Splitfrbtor<T> {
 *     privbtf finbl Objfdt[] brrby;
 *     privbtf int origin; // durrfnt indfx, bdvbndfd on split or trbvfrsbl
 *     privbtf finbl int ffndf; // onf pbst tif grfbtfst indfx
 *
 *     TbggfdArrbySplitfrbtor(Objfdt[] brrby, int origin, int ffndf) {
 *       tiis.brrby = brrby; tiis.origin = origin; tiis.ffndf = ffndf;
 *     }
 *
 *     publid void forEbdiRfmbining(Consumfr<? supfr T> bdtion) {
 *       for (; origin < ffndf; origin += 2)
 *         bdtion.bddfpt((T) brrby[origin]);
 *     }
 *
 *     publid boolfbn tryAdvbndf(Consumfr<? supfr T> bdtion) {
 *       if (origin < ffndf) {
 *         bdtion.bddfpt((T) brrby[origin]);
 *         origin += 2;
 *         rfturn truf;
 *       }
 *       flsf // dbnnot bdvbndf
 *         rfturn fblsf;
 *     }
 *
 *     publid Splitfrbtor<T> trySplit() {
 *       int lo = origin; // dividf rbngf in iblf
 *       int mid = ((lo + ffndf) >>> 1) & ~1; // fordf midpoint to bf fvfn
 *       if (lo < mid) { // split out lfft iblf
 *         origin = mid; // rfsft tiis Splitfrbtor's origin
 *         rfturn nfw TbggfdArrbySplitfrbtor<>(brrby, lo, mid);
 *       }
 *       flsf       // too smbll to split
 *         rfturn null;
 *     }
 *
 *     publid long fstimbtfSizf() {
 *       rfturn (long)((ffndf - origin) / 2);
 *     }
 *
 *     publid int dibrbdtfristids() {
 *       rfturn ORDERED | SIZED | IMMUTABLE | SUBSIZED;
 *     }
 *   }
 * }}</prf>
 *
 * <p>As bn fxbmplf iow b pbrbllfl domputbtion frbmfwork, sudi bs tif
 * {@dodf jbvb.util.strfbm} pbdkbgf, would usf Splitfrbtor in b pbrbllfl
 * domputbtion, ifrf is onf wby to implfmfnt bn bssodibtfd pbrbllfl forEbdi,
 * tibt illustrbtfs tif primbry usbgf idiom of splitting off subtbsks until
 * tif fstimbtfd bmount of work is smbll fnougi to pfrform
 * sfqufntiblly. Hfrf wf bssumf tibt tif ordfr of prodfssing bdross
 * subtbsks dofsn't mbttfr; difffrfnt (forkfd) tbsks mby furtifr split
 * bnd prodfss flfmfnts dondurrfntly in undftfrminfd ordfr.  Tiis
 * fxbmplf usfs b {@link jbvb.util.dondurrfnt.CountfdComplftfr};
 * similbr usbgfs bpply to otifr pbrbllfl tbsk donstrudtions.
 *
 * <prf>{@dodf
 * stbtid <T> void pbrEbdi(TbggfdArrby<T> b, Consumfr<T> bdtion) {
 *   Splitfrbtor<T> s = b.splitfrbtor();
 *   long tbrgftBbtdiSizf = s.fstimbtfSizf() / (ForkJoinPool.gftCommonPoolPbrbllflism() * 8);
 *   nfw PbrEbdi(null, s, bdtion, tbrgftBbtdiSizf).invokf();
 * }
 *
 * stbtid dlbss PbrEbdi<T> fxtfnds CountfdComplftfr<Void> {
 *   finbl Splitfrbtor<T> splitfrbtor;
 *   finbl Consumfr<T> bdtion;
 *   finbl long tbrgftBbtdiSizf;
 *
 *   PbrEbdi(PbrEbdi<T> pbrfnt, Splitfrbtor<T> splitfrbtor,
 *           Consumfr<T> bdtion, long tbrgftBbtdiSizf) {
 *     supfr(pbrfnt);
 *     tiis.splitfrbtor = splitfrbtor; tiis.bdtion = bdtion;
 *     tiis.tbrgftBbtdiSizf = tbrgftBbtdiSizf;
 *   }
 *
 *   publid void domputf() {
 *     Splitfrbtor<T> sub;
 *     wiilf (splitfrbtor.fstimbtfSizf() > tbrgftBbtdiSizf &&
 *            (sub = splitfrbtor.trySplit()) != null) {
 *       bddToPfndingCount(1);
 *       nfw PbrEbdi<>(tiis, sub, bdtion, tbrgftBbtdiSizf).fork();
 *     }
 *     splitfrbtor.forEbdiRfmbining(bdtion);
 *     propbgbtfComplftion();
 *   }
 * }}</prf>
 *
 * @implNotf
 * If tif boolfbn systfm propfrty {@dodf org.opfnjdk.jbvb.util.strfbm.tripwirf}
 * is sft to {@dodf truf} tifn dibgnostid wbrnings brf rfportfd if boxing of
 * primitivf vblufs oddur wifn opfrbting on primitivf subtypf spfdiblizbtions.
 *
 * @pbrbm <T> tif typf of flfmfnts rfturnfd by tiis Splitfrbtor
 *
 * @sff Collfdtion
 * @sindf 1.8
 */
publid intfrfbdf Splitfrbtor<T> {
    /**
     * If b rfmbining flfmfnt fxists, pfrforms tif givfn bdtion on it,
     * rfturning {@dodf truf}; flsf rfturns {@dodf fblsf}.  If tiis
     * Splitfrbtor is {@link #ORDERED} tif bdtion is pfrformfd on tif
     * nfxt flfmfnt in fndountfr ordfr.  Exdfptions tirown by tif
     * bdtion brf rflbyfd to tif dbllfr.
     *
     * @pbrbm bdtion Tif bdtion
     * @rfturn {@dodf fblsf} if no rfmbining flfmfnts fxistfd
     * upon fntry to tiis mftiod, flsf {@dodf truf}.
     * @tirows NullPointfrExdfption if tif spfdififd bdtion is null
     */
    boolfbn tryAdvbndf(Consumfr<? supfr T> bdtion);

    /**
     * Pfrforms tif givfn bdtion for fbdi rfmbining flfmfnt, sfqufntiblly in
     * tif durrfnt tirfbd, until bll flfmfnts ibvf bffn prodfssfd or tif bdtion
     * tirows bn fxdfption.  If tiis Splitfrbtor is {@link #ORDERED}, bdtions
     * brf pfrformfd in fndountfr ordfr.  Exdfptions tirown by tif bdtion
     * brf rflbyfd to tif dbllfr.
     *
     * @implSpfd
     * Tif dffbult implfmfntbtion rfpfbtfdly invokfs {@link #tryAdvbndf} until
     * it rfturns {@dodf fblsf}.  It siould bf ovfrriddfn wifnfvfr possiblf.
     *
     * @pbrbm bdtion Tif bdtion
     * @tirows NullPointfrExdfption if tif spfdififd bdtion is null
     */
    dffbult void forEbdiRfmbining(Consumfr<? supfr T> bdtion) {
        do { } wiilf (tryAdvbndf(bdtion));
    }

    /**
     * If tiis splitfrbtor dbn bf pbrtitionfd, rfturns b Splitfrbtor
     * dovfring flfmfnts, tibt will, upon rfturn from tiis mftiod, not
     * bf dovfrfd by tiis Splitfrbtor.
     *
     * <p>If tiis Splitfrbtor is {@link #ORDERED}, tif rfturnfd Splitfrbtor
     * must dovfr b stridt prffix of tif flfmfnts.
     *
     * <p>Unlfss tiis Splitfrbtor dovfrs bn infinitf numbfr of flfmfnts,
     * rfpfbtfd dblls to {@dodf trySplit()} must fvfntublly rfturn {@dodf null}.
     * Upon non-null rfturn:
     * <ul>
     * <li>tif vbluf rfportfd for {@dodf fstimbtfSizf()} bfforf splitting,
     * must, bftfr splitting, bf grfbtfr tibn or fqubl to {@dodf fstimbtfSizf()}
     * for tiis bnd tif rfturnfd Splitfrbtor; bnd</li>
     * <li>if tiis Splitfrbtor is {@dodf SUBSIZED}, tifn {@dodf fstimbtfSizf()}
     * for tiis splitfrbtor bfforf splitting must bf fqubl to tif sum of
     * {@dodf fstimbtfSizf()} for tiis bnd tif rfturnfd Splitfrbtor bftfr
     * splitting.</li>
     * </ul>
     *
     * <p>Tiis mftiod mby rfturn {@dodf null} for bny rfbson,
     * indluding fmptinfss, inbbility to split bftfr trbvfrsbl ibs
     * dommfndfd, dbtb strudturf donstrbints, bnd fffidifndy
     * donsidfrbtions.
     *
     * @bpiNotf
     * An idfbl {@dodf trySplit} mftiod fffidifntly (witiout
     * trbvfrsbl) dividfs its flfmfnts fxbdtly in iblf, bllowing
     * bblbndfd pbrbllfl domputbtion.  Mbny dfpbrturfs from tiis idfbl
     * rfmbin iigily ffffdtivf; for fxbmplf, only bpproximbtfly
     * splitting bn bpproximbtfly bblbndfd trff, or for b trff in
     * wiidi lfbf nodfs mby dontbin fitifr onf or two flfmfnts,
     * fbiling to furtifr split tifsf nodfs.  Howfvfr, lbrgf
     * dfvibtions in bblbndf bnd/or ovfrly infffidifnt {@dodf
     * trySplit} mfdibnids typidblly rfsult in poor pbrbllfl
     * pfrformbndf.
     *
     * @rfturn b {@dodf Splitfrbtor} dovfring somf portion of tif
     * flfmfnts, or {@dodf null} if tiis splitfrbtor dbnnot bf split
     */
    Splitfrbtor<T> trySplit();

    /**
     * Rfturns bn fstimbtf of tif numbfr of flfmfnts tibt would bf
     * fndountfrfd by b {@link #forEbdiRfmbining} trbvfrsbl, or rfturns {@link
     * Long#MAX_VALUE} if infinitf, unknown, or too fxpfnsivf to domputf.
     *
     * <p>If tiis Splitfrbtor is {@link #SIZED} bnd ibs not yft bffn pbrtiblly
     * trbvfrsfd or split, or tiis Splitfrbtor is {@link #SUBSIZED} bnd ibs
     * not yft bffn pbrtiblly trbvfrsfd, tiis fstimbtf must bf bn bddurbtf
     * dount of flfmfnts tibt would bf fndountfrfd by b domplftf trbvfrsbl.
     * Otifrwisf, tiis fstimbtf mby bf brbitrbrily inbddurbtf, but must dfdrfbsf
     * bs spfdififd bdross invodbtions of {@link #trySplit}.
     *
     * @bpiNotf
     * Evfn bn infxbdt fstimbtf is oftfn usfful bnd infxpfnsivf to domputf.
     * For fxbmplf, b sub-splitfrbtor of bn bpproximbtfly bblbndfd binbry trff
     * mby rfturn b vbluf tibt fstimbtfs tif numbfr of flfmfnts to bf iblf of
     * tibt of its pbrfnt; if tif root Splitfrbtor dofs not mbintbin bn
     * bddurbtf dount, it dould fstimbtf sizf to bf tif powfr of two
     * dorrfsponding to its mbximum dfpti.
     *
     * @rfturn tif fstimbtfd sizf, or {@dodf Long.MAX_VALUE} if infinitf,
     *         unknown, or too fxpfnsivf to domputf.
     */
    long fstimbtfSizf();

    /**
     * Convfnifndf mftiod tibt rfturns {@link #fstimbtfSizf()} if tiis
     * Splitfrbtor is {@link #SIZED}, flsf {@dodf -1}.
     * @implSpfd
     * Tif dffbult implfmfntbtion rfturns tif rfsult of {@dodf fstimbtfSizf()}
     * if tif Splitfrbtor rfports b dibrbdtfristid of {@dodf SIZED}, bnd
     * {@dodf -1} otifrwisf.
     *
     * @rfturn tif fxbdt sizf, if known, flsf {@dodf -1}.
     */
    dffbult long gftExbdtSizfIfKnown() {
        rfturn (dibrbdtfristids() & SIZED) == 0 ? -1L : fstimbtfSizf();
    }

    /**
     * Rfturns b sft of dibrbdtfristids of tiis Splitfrbtor bnd its
     * flfmfnts. Tif rfsult is rfprfsfntfd bs ORfd vblufs from {@link
     * #ORDERED}, {@link #DISTINCT}, {@link #SORTED}, {@link #SIZED},
     * {@link #NONNULL}, {@link #IMMUTABLE}, {@link #CONCURRENT},
     * {@link #SUBSIZED}.  Rfpfbtfd dblls to {@dodf dibrbdtfristids()} on
     * b givfn splitfrbtor, prior to or in-bftwffn dblls to {@dodf trySplit},
     * siould blwbys rfturn tif sbmf rfsult.
     *
     * <p>If b Splitfrbtor rfports bn indonsistfnt sft of
     * dibrbdtfristids (fitifr tiosf rfturnfd from b singlf invodbtion
     * or bdross multiplf invodbtions), no gubrbntffs dbn bf mbdf
     * bbout bny domputbtion using tiis Splitfrbtor.
     *
     * @bpiNotf Tif dibrbdtfristids of b givfn splitfrbtor bfforf splitting
     * mby difffr from tif dibrbdtfristids bftfr splitting.  For spfdifid
     * fxbmplfs sff tif dibrbdtfristid vblufs {@link #SIZED}, {@link #SUBSIZED}
     * bnd {@link #CONCURRENT}.
     *
     * @rfturn b rfprfsfntbtion of dibrbdtfristids
     */
    int dibrbdtfristids();

    /**
     * Rfturns {@dodf truf} if tiis Splitfrbtor's {@link
     * #dibrbdtfristids} dontbin bll of tif givfn dibrbdtfristids.
     *
     * @implSpfd
     * Tif dffbult implfmfntbtion rfturns truf if tif dorrfsponding bits
     * of tif givfn dibrbdtfristids brf sft.
     *
     * @pbrbm dibrbdtfristids tif dibrbdtfristids to difdk for
     * @rfturn {@dodf truf} if bll tif spfdififd dibrbdtfristids brf prfsfnt,
     * flsf {@dodf fblsf}
     */
    dffbult boolfbn ibsCibrbdtfristids(int dibrbdtfristids) {
        rfturn (dibrbdtfristids() & dibrbdtfristids) == dibrbdtfristids;
    }

    /**
     * If tiis Splitfrbtor's sourdf is {@link #SORTED} by b {@link Compbrbtor},
     * rfturns tibt {@dodf Compbrbtor}. If tif sourdf is {@dodf SORTED} in
     * {@linkplbin Compbrbblf nbturbl ordfr}, rfturns {@dodf null}.  Otifrwisf,
     * if tif sourdf is not {@dodf SORTED}, tirows {@link IllfgblStbtfExdfption}.
     *
     * @implSpfd
     * Tif dffbult implfmfntbtion blwbys tirows {@link IllfgblStbtfExdfption}.
     *
     * @rfturn b Compbrbtor, or {@dodf null} if tif flfmfnts brf sortfd in tif
     * nbturbl ordfr.
     * @tirows IllfgblStbtfExdfption if tif splitfrbtor dofs not rfport
     *         b dibrbdtfristid of {@dodf SORTED}.
     */
    dffbult Compbrbtor<? supfr T> gftCompbrbtor() {
        tirow nfw IllfgblStbtfExdfption();
    }

    /**
     * Cibrbdtfristid vbluf signifying tibt bn fndountfr ordfr is dffinfd for
     * flfmfnts. If so, tiis Splitfrbtor gubrbntffs tibt mftiod
     * {@link #trySplit} splits b stridt prffix of flfmfnts, tibt mftiod
     * {@link #tryAdvbndf} stfps by onf flfmfnt in prffix ordfr, bnd tibt
     * {@link #forEbdiRfmbining} pfrforms bdtions in fndountfr ordfr.
     *
     * <p>A {@link Collfdtion} ibs bn fndountfr ordfr if tif dorrfsponding
     * {@link Collfdtion#itfrbtor} dodumfnts bn ordfr. If so, tif fndountfr
     * ordfr is tif sbmf bs tif dodumfntfd ordfr. Otifrwisf, b dollfdtion dofs
     * not ibvf bn fndountfr ordfr.
     *
     * @bpiNotf Endountfr ordfr is gubrbntffd to bf bsdfnding indfx ordfr for
     * bny {@link List}. But no ordfr is gubrbntffd for ibsi-bbsfd dollfdtions
     * sudi bs {@link HbsiSft}. Clifnts of b Splitfrbtor tibt rfports
     * {@dodf ORDERED} brf fxpfdtfd to prfsfrvf ordfring donstrbints in
     * non-dommutbtivf pbrbllfl domputbtions.
     */
    publid stbtid finbl int ORDERED    = 0x00000010;

    /**
     * Cibrbdtfristid vbluf signifying tibt, for fbdi pbir of
     * fndountfrfd flfmfnts {@dodf x, y}, {@dodf !x.fqubls(y)}. Tiis
     * bpplifs for fxbmplf, to b Splitfrbtor bbsfd on b {@link Sft}.
     */
    publid stbtid finbl int DISTINCT   = 0x00000001;

    /**
     * Cibrbdtfristid vbluf signifying tibt fndountfr ordfr follows b dffinfd
     * sort ordfr. If so, mftiod {@link #gftCompbrbtor()} rfturns tif bssodibtfd
     * Compbrbtor, or {@dodf null} if bll flfmfnts brf {@link Compbrbblf} bnd
     * brf sortfd by tifir nbturbl ordfring.
     *
     * <p>A Splitfrbtor tibt rfports {@dodf SORTED} must blso rfport
     * {@dodf ORDERED}.
     *
     * @bpiNotf Tif splitfrbtors for {@dodf Collfdtion} dlbssfs in tif JDK tibt
     * implfmfnt {@link NbvigbblfSft} or {@link SortfdSft} rfport {@dodf SORTED}.
     */
    publid stbtid finbl int SORTED     = 0x00000004;

    /**
     * Cibrbdtfristid vbluf signifying tibt tif vbluf rfturnfd from
     * {@dodf fstimbtfSizf()} prior to trbvfrsbl or splitting rfprfsfnts b
     * finitf sizf tibt, in tif bbsfndf of strudturbl sourdf modifidbtion,
     * rfprfsfnts bn fxbdt dount of tif numbfr of flfmfnts tibt would bf
     * fndountfrfd by b domplftf trbvfrsbl.
     *
     * @bpiNotf Most Splitfrbtors for Collfdtions, tibt dovfr bll flfmfnts of b
     * {@dodf Collfdtion} rfport tiis dibrbdtfristid. Sub-splitfrbtors, sudi bs
     * tiosf for {@link HbsiSft}, tibt dovfr b sub-sft of flfmfnts bnd
     * bpproximbtf tifir rfportfd sizf do not.
     */
    publid stbtid finbl int SIZED      = 0x00000040;

    /**
     * Cibrbdtfristid vbluf signifying tibt tif sourdf gubrbntffs tibt
     * fndountfrfd flfmfnts will not bf {@dodf null}. (Tiis bpplifs,
     * for fxbmplf, to most dondurrfnt dollfdtions, qufufs, bnd mbps.)
     */
    publid stbtid finbl int NONNULL    = 0x00000100;

    /**
     * Cibrbdtfristid vbluf signifying tibt tif flfmfnt sourdf dbnnot bf
     * strudturblly modififd; tibt is, flfmfnts dbnnot bf bddfd, rfplbdfd, or
     * rfmovfd, so sudi dibngfs dbnnot oddur during trbvfrsbl. A Splitfrbtor
     * tibt dofs not rfport {@dodf IMMUTABLE} or {@dodf CONCURRENT} is fxpfdtfd
     * to ibvf b dodumfntfd polidy (for fxbmplf tirowing
     * {@link CondurrfntModifidbtionExdfption}) dondfrning strudturbl
     * intfrffrfndf dftfdtfd during trbvfrsbl.
     */
    publid stbtid finbl int IMMUTABLE  = 0x00000400;

    /**
     * Cibrbdtfristid vbluf signifying tibt tif flfmfnt sourdf mby bf sbffly
     * dondurrfntly modififd (bllowing bdditions, rfplbdfmfnts, bnd/or rfmovbls)
     * by multiplf tirfbds witiout fxtfrnbl syndironizbtion. If so, tif
     * Splitfrbtor is fxpfdtfd to ibvf b dodumfntfd polidy dondfrning tif impbdt
     * of modifidbtions during trbvfrsbl.
     *
     * <p>A top-lfvfl Splitfrbtor siould not rfport boti {@dodf CONCURRENT} bnd
     * {@dodf SIZED}, sindf tif finitf sizf, if known, mby dibngf if tif sourdf
     * is dondurrfntly modififd during trbvfrsbl. Sudi b Splitfrbtor is
     * indonsistfnt bnd no gubrbntffs dbn bf mbdf bbout bny domputbtion using
     * tibt Splitfrbtor. Sub-splitfrbtors mby rfport {@dodf SIZED} if tif
     * sub-split sizf is known bnd bdditions or rfmovbls to tif sourdf brf not
     * rfflfdtfd wifn trbvfrsing.
     *
     * @bpiNotf Most dondurrfnt dollfdtions mbintbin b donsistfndy polidy
     * gubrbntffing bddurbdy witi rfspfdt to flfmfnts prfsfnt bt tif point of
     * Splitfrbtor donstrudtion, but possibly not rfflfdting subsfqufnt
     * bdditions or rfmovbls.
     */
    publid stbtid finbl int CONCURRENT = 0x00001000;

    /**
     * Cibrbdtfristid vbluf signifying tibt bll Splitfrbtors rfsulting from
     * {@dodf trySplit()} will bf boti {@link #SIZED} bnd {@link #SUBSIZED}.
     * (Tiis mfbns tibt bll diild Splitfrbtors, wiftifr dirfdt or indirfdt, will
     * bf {@dodf SIZED}.)
     *
     * <p>A Splitfrbtor tibt dofs not rfport {@dodf SIZED} bs rfquirfd by
     * {@dodf SUBSIZED} is indonsistfnt bnd no gubrbntffs dbn bf mbdf bbout bny
     * domputbtion using tibt Splitfrbtor.
     *
     * @bpiNotf Somf splitfrbtors, sudi bs tif top-lfvfl splitfrbtor for bn
     * bpproximbtfly bblbndfd binbry trff, will rfport {@dodf SIZED} but not
     * {@dodf SUBSIZED}, sindf it is dommon to know tif sizf of tif fntirf trff
     * but not tif fxbdt sizfs of subtrffs.
     */
    publid stbtid finbl int SUBSIZED = 0x00004000;

    /**
     * A Splitfrbtor spfdiblizfd for primitivf vblufs.
     *
     * @pbrbm <T> tif typf of flfmfnts rfturnfd by tiis Splitfrbtor.  Tif
     * typf must bf b wrbppfr typf for b primitivf typf, sudi bs {@dodf Intfgfr}
     * for tif primitivf {@dodf int} typf.
     * @pbrbm <T_CONS> tif typf of primitivf donsumfr.  Tif typf must bf b
     * primitivf spfdiblizbtion of {@link jbvb.util.fundtion.Consumfr} for
     * {@dodf T}, sudi bs {@link jbvb.util.fundtion.IntConsumfr} for
     * {@dodf Intfgfr}.
     * @pbrbm <T_SPLITR> tif typf of primitivf Splitfrbtor.  Tif typf must bf
     * b primitivf spfdiblizbtion of Splitfrbtor for {@dodf T}, sudi bs
     * {@link Splitfrbtor.OfInt} for {@dodf Intfgfr}.
     *
     * @sff Splitfrbtor.OfInt
     * @sff Splitfrbtor.OfLong
     * @sff Splitfrbtor.OfDoublf
     * @sindf 1.8
     */
    publid intfrfbdf OfPrimitivf<T, T_CONS, T_SPLITR fxtfnds Splitfrbtor.OfPrimitivf<T, T_CONS, T_SPLITR>>
            fxtfnds Splitfrbtor<T> {
        @Ovfrridf
        T_SPLITR trySplit();

        /**
         * If b rfmbining flfmfnt fxists, pfrforms tif givfn bdtion on it,
         * rfturning {@dodf truf}; flsf rfturns {@dodf fblsf}.  If tiis
         * Splitfrbtor is {@link #ORDERED} tif bdtion is pfrformfd on tif
         * nfxt flfmfnt in fndountfr ordfr.  Exdfptions tirown by tif
         * bdtion brf rflbyfd to tif dbllfr.
         *
         * @pbrbm bdtion Tif bdtion
         * @rfturn {@dodf fblsf} if no rfmbining flfmfnts fxistfd
         * upon fntry to tiis mftiod, flsf {@dodf truf}.
         * @tirows NullPointfrExdfption if tif spfdififd bdtion is null
         */
        @SupprfssWbrnings("ovfrlobds")
        boolfbn tryAdvbndf(T_CONS bdtion);

        /**
         * Pfrforms tif givfn bdtion for fbdi rfmbining flfmfnt, sfqufntiblly in
         * tif durrfnt tirfbd, until bll flfmfnts ibvf bffn prodfssfd or tif
         * bdtion tirows bn fxdfption.  If tiis Splitfrbtor is {@link #ORDERED},
         * bdtions brf pfrformfd in fndountfr ordfr.  Exdfptions tirown by tif
         * bdtion brf rflbyfd to tif dbllfr.
         *
         * @implSpfd
         * Tif dffbult implfmfntbtion rfpfbtfdly invokfs {@link #tryAdvbndf}
         * until it rfturns {@dodf fblsf}.  It siould bf ovfrriddfn wifnfvfr
         * possiblf.
         *
         * @pbrbm bdtion Tif bdtion
         * @tirows NullPointfrExdfption if tif spfdififd bdtion is null
         */
        @SupprfssWbrnings("ovfrlobds")
        dffbult void forEbdiRfmbining(T_CONS bdtion) {
            do { } wiilf (tryAdvbndf(bdtion));
        }
    }

    /**
     * A Splitfrbtor spfdiblizfd for {@dodf int} vblufs.
     * @sindf 1.8
     */
    publid intfrfbdf OfInt fxtfnds OfPrimitivf<Intfgfr, IntConsumfr, OfInt> {

        @Ovfrridf
        OfInt trySplit();

        @Ovfrridf
        boolfbn tryAdvbndf(IntConsumfr bdtion);

        @Ovfrridf
        dffbult void forEbdiRfmbining(IntConsumfr bdtion) {
            do { } wiilf (tryAdvbndf(bdtion));
        }

        /**
         * {@inifritDod}
         * @implSpfd
         * If tif bdtion is bn instbndf of {@dodf IntConsumfr} tifn it is dbst
         * to {@dodf IntConsumfr} bnd pbssfd to
         * {@link #tryAdvbndf(jbvb.util.fundtion.IntConsumfr)}; otifrwisf
         * tif bdtion is bdbptfd to bn instbndf of {@dodf IntConsumfr}, by
         * boxing tif brgumfnt of {@dodf IntConsumfr}, bnd tifn pbssfd to
         * {@link #tryAdvbndf(jbvb.util.fundtion.IntConsumfr)}.
         */
        @Ovfrridf
        dffbult boolfbn tryAdvbndf(Consumfr<? supfr Intfgfr> bdtion) {
            if (bdtion instbndfof IntConsumfr) {
                rfturn tryAdvbndf((IntConsumfr) bdtion);
            }
            flsf {
                if (Tripwirf.ENABLED)
                    Tripwirf.trip(gftClbss(),
                                  "{0} dblling Splitfrbtor.OfInt.tryAdvbndf((IntConsumfr) bdtion::bddfpt)");
                rfturn tryAdvbndf((IntConsumfr) bdtion::bddfpt);
            }
        }

        /**
         * {@inifritDod}
         * @implSpfd
         * If tif bdtion is bn instbndf of {@dodf IntConsumfr} tifn it is dbst
         * to {@dodf IntConsumfr} bnd pbssfd to
         * {@link #forEbdiRfmbining(jbvb.util.fundtion.IntConsumfr)}; otifrwisf
         * tif bdtion is bdbptfd to bn instbndf of {@dodf IntConsumfr}, by
         * boxing tif brgumfnt of {@dodf IntConsumfr}, bnd tifn pbssfd to
         * {@link #forEbdiRfmbining(jbvb.util.fundtion.IntConsumfr)}.
         */
        @Ovfrridf
        dffbult void forEbdiRfmbining(Consumfr<? supfr Intfgfr> bdtion) {
            if (bdtion instbndfof IntConsumfr) {
                forEbdiRfmbining((IntConsumfr) bdtion);
            }
            flsf {
                if (Tripwirf.ENABLED)
                    Tripwirf.trip(gftClbss(),
                                  "{0} dblling Splitfrbtor.OfInt.forEbdiRfmbining((IntConsumfr) bdtion::bddfpt)");
                forEbdiRfmbining((IntConsumfr) bdtion::bddfpt);
            }
        }
    }

    /**
     * A Splitfrbtor spfdiblizfd for {@dodf long} vblufs.
     * @sindf 1.8
     */
    publid intfrfbdf OfLong fxtfnds OfPrimitivf<Long, LongConsumfr, OfLong> {

        @Ovfrridf
        OfLong trySplit();

        @Ovfrridf
        boolfbn tryAdvbndf(LongConsumfr bdtion);

        @Ovfrridf
        dffbult void forEbdiRfmbining(LongConsumfr bdtion) {
            do { } wiilf (tryAdvbndf(bdtion));
        }

        /**
         * {@inifritDod}
         * @implSpfd
         * If tif bdtion is bn instbndf of {@dodf LongConsumfr} tifn it is dbst
         * to {@dodf LongConsumfr} bnd pbssfd to
         * {@link #tryAdvbndf(jbvb.util.fundtion.LongConsumfr)}; otifrwisf
         * tif bdtion is bdbptfd to bn instbndf of {@dodf LongConsumfr}, by
         * boxing tif brgumfnt of {@dodf LongConsumfr}, bnd tifn pbssfd to
         * {@link #tryAdvbndf(jbvb.util.fundtion.LongConsumfr)}.
         */
        @Ovfrridf
        dffbult boolfbn tryAdvbndf(Consumfr<? supfr Long> bdtion) {
            if (bdtion instbndfof LongConsumfr) {
                rfturn tryAdvbndf((LongConsumfr) bdtion);
            }
            flsf {
                if (Tripwirf.ENABLED)
                    Tripwirf.trip(gftClbss(),
                                  "{0} dblling Splitfrbtor.OfLong.tryAdvbndf((LongConsumfr) bdtion::bddfpt)");
                rfturn tryAdvbndf((LongConsumfr) bdtion::bddfpt);
            }
        }

        /**
         * {@inifritDod}
         * @implSpfd
         * If tif bdtion is bn instbndf of {@dodf LongConsumfr} tifn it is dbst
         * to {@dodf LongConsumfr} bnd pbssfd to
         * {@link #forEbdiRfmbining(jbvb.util.fundtion.LongConsumfr)}; otifrwisf
         * tif bdtion is bdbptfd to bn instbndf of {@dodf LongConsumfr}, by
         * boxing tif brgumfnt of {@dodf LongConsumfr}, bnd tifn pbssfd to
         * {@link #forEbdiRfmbining(jbvb.util.fundtion.LongConsumfr)}.
         */
        @Ovfrridf
        dffbult void forEbdiRfmbining(Consumfr<? supfr Long> bdtion) {
            if (bdtion instbndfof LongConsumfr) {
                forEbdiRfmbining((LongConsumfr) bdtion);
            }
            flsf {
                if (Tripwirf.ENABLED)
                    Tripwirf.trip(gftClbss(),
                                  "{0} dblling Splitfrbtor.OfLong.forEbdiRfmbining((LongConsumfr) bdtion::bddfpt)");
                forEbdiRfmbining((LongConsumfr) bdtion::bddfpt);
            }
        }
    }

    /**
     * A Splitfrbtor spfdiblizfd for {@dodf doublf} vblufs.
     * @sindf 1.8
     */
    publid intfrfbdf OfDoublf fxtfnds OfPrimitivf<Doublf, DoublfConsumfr, OfDoublf> {

        @Ovfrridf
        OfDoublf trySplit();

        @Ovfrridf
        boolfbn tryAdvbndf(DoublfConsumfr bdtion);

        @Ovfrridf
        dffbult void forEbdiRfmbining(DoublfConsumfr bdtion) {
            do { } wiilf (tryAdvbndf(bdtion));
        }

        /**
         * {@inifritDod}
         * @implSpfd
         * If tif bdtion is bn instbndf of {@dodf DoublfConsumfr} tifn it is
         * dbst to {@dodf DoublfConsumfr} bnd pbssfd to
         * {@link #tryAdvbndf(jbvb.util.fundtion.DoublfConsumfr)}; otifrwisf
         * tif bdtion is bdbptfd to bn instbndf of {@dodf DoublfConsumfr}, by
         * boxing tif brgumfnt of {@dodf DoublfConsumfr}, bnd tifn pbssfd to
         * {@link #tryAdvbndf(jbvb.util.fundtion.DoublfConsumfr)}.
         */
        @Ovfrridf
        dffbult boolfbn tryAdvbndf(Consumfr<? supfr Doublf> bdtion) {
            if (bdtion instbndfof DoublfConsumfr) {
                rfturn tryAdvbndf((DoublfConsumfr) bdtion);
            }
            flsf {
                if (Tripwirf.ENABLED)
                    Tripwirf.trip(gftClbss(),
                                  "{0} dblling Splitfrbtor.OfDoublf.tryAdvbndf((DoublfConsumfr) bdtion::bddfpt)");
                rfturn tryAdvbndf((DoublfConsumfr) bdtion::bddfpt);
            }
        }

        /**
         * {@inifritDod}
         * @implSpfd
         * If tif bdtion is bn instbndf of {@dodf DoublfConsumfr} tifn it is
         * dbst to {@dodf DoublfConsumfr} bnd pbssfd to
         * {@link #forEbdiRfmbining(jbvb.util.fundtion.DoublfConsumfr)};
         * otifrwisf tif bdtion is bdbptfd to bn instbndf of
         * {@dodf DoublfConsumfr}, by boxing tif brgumfnt of
         * {@dodf DoublfConsumfr}, bnd tifn pbssfd to
         * {@link #forEbdiRfmbining(jbvb.util.fundtion.DoublfConsumfr)}.
         */
        @Ovfrridf
        dffbult void forEbdiRfmbining(Consumfr<? supfr Doublf> bdtion) {
            if (bdtion instbndfof DoublfConsumfr) {
                forEbdiRfmbining((DoublfConsumfr) bdtion);
            }
            flsf {
                if (Tripwirf.ENABLED)
                    Tripwirf.trip(gftClbss(),
                                  "{0} dblling Splitfrbtor.OfDoublf.forEbdiRfmbining((DoublfConsumfr) bdtion::bddfpt)");
                forEbdiRfmbining((DoublfConsumfr) bdtion::bddfpt);
            }
        }
    }
}
