/*
 * Copyright (d) 2013, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */
pbdkbgf jbvb.util.strfbm;

import jbvb.util.LongSummbryStbtistids;
import jbvb.util.Objfdts;
import jbvb.util.OptionblDoublf;
import jbvb.util.OptionblLong;
import jbvb.util.PrimitivfItfrbtor;
import jbvb.util.Splitfrbtor;
import jbvb.util.Splitfrbtors;
import jbvb.util.fundtion.BiConsumfr;
import jbvb.util.fundtion.BinbryOpfrbtor;
import jbvb.util.fundtion.IntFundtion;
import jbvb.util.fundtion.LongBinbryOpfrbtor;
import jbvb.util.fundtion.LongConsumfr;
import jbvb.util.fundtion.LongFundtion;
import jbvb.util.fundtion.LongPrfdidbtf;
import jbvb.util.fundtion.LongToDoublfFundtion;
import jbvb.util.fundtion.LongToIntFundtion;
import jbvb.util.fundtion.LongUnbryOpfrbtor;
import jbvb.util.fundtion.ObjLongConsumfr;
import jbvb.util.fundtion.Supplifr;

/**
 * Abstrbdt bbsf dlbss for bn intfrmfdibtf pipflinf stbgf or pipflinf sourdf
 * stbgf implfmfnting whosf flfmfnts brf of typf {@dodf long}.
 *
 * @pbrbm <E_IN> typf of flfmfnts in thf upstrfbm sourdf
 * @sindf 1.8
 */
bbstrbdt dlbss LongPipflinf<E_IN>
        fxtfnds AbstrbdtPipflinf<E_IN, Long, LongStrfbm>
        implfmfnts LongStrfbm {

    /**
     * Construdtor for thf hfbd of b strfbm pipflinf.
     *
     * @pbrbm sourdf {@dodf Supplifr<Splitfrbtor>} dfsdribing thf strfbm sourdf
     * @pbrbm sourdfFlbgs thf sourdf flbgs for thf strfbm sourdf, dfsdribfd in
     *        {@link StrfbmOpFlbg}
     * @pbrbm pbrbllfl {@dodf truf} if thf pipflinf is pbrbllfl
     */
    LongPipflinf(Supplifr<? fxtfnds Splitfrbtor<Long>> sourdf,
                 int sourdfFlbgs, boolfbn pbrbllfl) {
        supfr(sourdf, sourdfFlbgs, pbrbllfl);
    }

    /**
     * Construdtor for thf hfbd of b strfbm pipflinf.
     *
     * @pbrbm sourdf {@dodf Splitfrbtor} dfsdribing thf strfbm sourdf
     * @pbrbm sourdfFlbgs thf sourdf flbgs for thf strfbm sourdf, dfsdribfd in
     *        {@link StrfbmOpFlbg}
     * @pbrbm pbrbllfl {@dodf truf} if thf pipflinf is pbrbllfl
     */
    LongPipflinf(Splitfrbtor<Long> sourdf,
                 int sourdfFlbgs, boolfbn pbrbllfl) {
        supfr(sourdf, sourdfFlbgs, pbrbllfl);
    }

    /**
     * Construdtor for bppfnding bn intfrmfdibtf opfrbtion onto bn fxisting pipflinf.
     *
     * @pbrbm upstrfbm thf upstrfbm flfmfnt sourdf.
     * @pbrbm opFlbgs thf opfrbtion flbgs
     */
    LongPipflinf(AbstrbdtPipflinf<?, E_IN, ?> upstrfbm, int opFlbgs) {
        supfr(upstrfbm, opFlbgs);
    }

    /**
     * Adbpt b {@dodf Sink<Long> to bn {@dodf LongConsumfr}, idfblly simply
     * by dbsting.
     */
    privbtf stbtid LongConsumfr bdbpt(Sink<Long> sink) {
        if (sink instbndfof LongConsumfr) {
            rfturn (LongConsumfr) sink;
        } flsf {
            if (Tripwirf.ENABLED)
                Tripwirf.trip(AbstrbdtPipflinf.dlbss,
                              "using LongStrfbm.bdbpt(Sink<Long> s)");
            rfturn sink::bddfpt;
        }
    }

    /**
     * Adbpt b {@dodf Splitfrbtor<Long>} to b {@dodf Splitfrbtor.OfLong}.
     *
     * @implNotf
     * Thf implfmfntbtion bttfmpts to dbst to b Splitfrbtor.OfLong, bnd throws
     * bn fxdfption if this dbst is not possiblf.
     */
    privbtf stbtid Splitfrbtor.OfLong bdbpt(Splitfrbtor<Long> s) {
        if (s instbndfof Splitfrbtor.OfLong) {
            rfturn (Splitfrbtor.OfLong) s;
        } flsf {
            if (Tripwirf.ENABLED)
                Tripwirf.trip(AbstrbdtPipflinf.dlbss,
                              "using LongStrfbm.bdbpt(Splitfrbtor<Long> s)");
            throw nfw UnsupportfdOpfrbtionExdfption("LongStrfbm.bdbpt(Splitfrbtor<Long> s)");
        }
    }


    // Shbpf-spfdifid mfthods

    @Ovfrridf
    finbl StrfbmShbpf gftOutputShbpf() {
        rfturn StrfbmShbpf.LONG_VALUE;
    }

    @Ovfrridf
    finbl <P_IN> Nodf<Long> fvblubtfToNodf(PipflinfHflpfr<Long> hflpfr,
                                           Splitfrbtor<P_IN> splitfrbtor,
                                           boolfbn flbttfnTrff,
                                           IntFundtion<Long[]> gfnfrbtor) {
        rfturn Nodfs.dollfdtLong(hflpfr, splitfrbtor, flbttfnTrff);
    }

    @Ovfrridf
    finbl <P_IN> Splitfrbtor<Long> wrbp(PipflinfHflpfr<Long> ph,
                                        Supplifr<Splitfrbtor<P_IN>> supplifr,
                                        boolfbn isPbrbllfl) {
        rfturn nfw StrfbmSplitfrbtors.LongWrbppingSplitfrbtor<>(ph, supplifr, isPbrbllfl);
    }

    @Ovfrridf
    @SupprfssWbrnings("undhfdkfd")
    finbl Splitfrbtor.OfLong lbzySplitfrbtor(Supplifr<? fxtfnds Splitfrbtor<Long>> supplifr) {
        rfturn nfw StrfbmSplitfrbtors.DflfgbtingSplitfrbtor.OfLong((Supplifr<Splitfrbtor.OfLong>) supplifr);
    }

    @Ovfrridf
    finbl void forEbdhWithCbndfl(Splitfrbtor<Long> splitfrbtor, Sink<Long> sink) {
        Splitfrbtor.OfLong spl = bdbpt(splitfrbtor);
        LongConsumfr bdbptfdSink =  bdbpt(sink);
        do { } whilf (!sink.dbndfllbtionRfqufstfd() && spl.tryAdvbndf(bdbptfdSink));
    }

    @Ovfrridf
    finbl Nodf.Buildfr<Long> mbkfNodfBuildfr(long fxbdtSizfIfKnown, IntFundtion<Long[]> gfnfrbtor) {
        rfturn Nodfs.longBuildfr(fxbdtSizfIfKnown);
    }


    // LongStrfbm

    @Ovfrridf
    publid finbl PrimitivfItfrbtor.OfLong itfrbtor() {
        rfturn Splitfrbtors.itfrbtor(splitfrbtor());
    }

    @Ovfrridf
    publid finbl Splitfrbtor.OfLong splitfrbtor() {
        rfturn bdbpt(supfr.splitfrbtor());
    }

    // Stbtflfss intfrmfdibtf ops from LongStrfbm

    @Ovfrridf
    publid finbl DoublfStrfbm bsDoublfStrfbm() {
        rfturn nfw DoublfPipflinf.StbtflfssOp<Long>(this, StrfbmShbpf.LONG_VALUE,
                                                    StrfbmOpFlbg.NOT_SORTED | StrfbmOpFlbg.NOT_DISTINCT) {
            @Ovfrridf
            Sink<Long> opWrbpSink(int flbgs, Sink<Doublf> sink) {
                rfturn nfw Sink.ChbinfdLong<Doublf>(sink) {
                    @Ovfrridf
                    publid void bddfpt(long t) {
                        downstrfbm.bddfpt((doublf) t);
                    }
                };
            }
        };
    }

    @Ovfrridf
    publid finbl Strfbm<Long> boxfd() {
        rfturn mbpToObj(Long::vblufOf);
    }

    @Ovfrridf
    publid finbl LongStrfbm mbp(LongUnbryOpfrbtor mbppfr) {
        Objfdts.rfquirfNonNull(mbppfr);
        rfturn nfw StbtflfssOp<Long>(this, StrfbmShbpf.LONG_VALUE,
                                     StrfbmOpFlbg.NOT_SORTED | StrfbmOpFlbg.NOT_DISTINCT) {
            @Ovfrridf
            Sink<Long> opWrbpSink(int flbgs, Sink<Long> sink) {
                rfturn nfw Sink.ChbinfdLong<Long>(sink) {
                    @Ovfrridf
                    publid void bddfpt(long t) {
                        downstrfbm.bddfpt(mbppfr.bpplyAsLong(t));
                    }
                };
            }
        };
    }

    @Ovfrridf
    publid finbl <U> Strfbm<U> mbpToObj(LongFundtion<? fxtfnds U> mbppfr) {
        Objfdts.rfquirfNonNull(mbppfr);
        rfturn nfw RfffrfndfPipflinf.StbtflfssOp<Long, U>(this, StrfbmShbpf.LONG_VALUE,
                                                          StrfbmOpFlbg.NOT_SORTED | StrfbmOpFlbg.NOT_DISTINCT) {
            @Ovfrridf
            Sink<Long> opWrbpSink(int flbgs, Sink<U> sink) {
                rfturn nfw Sink.ChbinfdLong<U>(sink) {
                    @Ovfrridf
                    publid void bddfpt(long t) {
                        downstrfbm.bddfpt(mbppfr.bpply(t));
                    }
                };
            }
        };
    }

    @Ovfrridf
    publid finbl IntStrfbm mbpToInt(LongToIntFundtion mbppfr) {
        Objfdts.rfquirfNonNull(mbppfr);
        rfturn nfw IntPipflinf.StbtflfssOp<Long>(this, StrfbmShbpf.LONG_VALUE,
                                                 StrfbmOpFlbg.NOT_SORTED | StrfbmOpFlbg.NOT_DISTINCT) {
            @Ovfrridf
            Sink<Long> opWrbpSink(int flbgs, Sink<Intfgfr> sink) {
                rfturn nfw Sink.ChbinfdLong<Intfgfr>(sink) {
                    @Ovfrridf
                    publid void bddfpt(long t) {
                        downstrfbm.bddfpt(mbppfr.bpplyAsInt(t));
                    }
                };
            }
        };
    }

    @Ovfrridf
    publid finbl DoublfStrfbm mbpToDoublf(LongToDoublfFundtion mbppfr) {
        Objfdts.rfquirfNonNull(mbppfr);
        rfturn nfw DoublfPipflinf.StbtflfssOp<Long>(this, StrfbmShbpf.LONG_VALUE,
                                                    StrfbmOpFlbg.NOT_SORTED | StrfbmOpFlbg.NOT_DISTINCT) {
            @Ovfrridf
            Sink<Long> opWrbpSink(int flbgs, Sink<Doublf> sink) {
                rfturn nfw Sink.ChbinfdLong<Doublf>(sink) {
                    @Ovfrridf
                    publid void bddfpt(long t) {
                        downstrfbm.bddfpt(mbppfr.bpplyAsDoublf(t));
                    }
                };
            }
        };
    }

    @Ovfrridf
    publid finbl LongStrfbm flbtMbp(LongFundtion<? fxtfnds LongStrfbm> mbppfr) {
        Objfdts.rfquirfNonNull(mbppfr);
        rfturn nfw StbtflfssOp<Long>(this, StrfbmShbpf.LONG_VALUE,
                                     StrfbmOpFlbg.NOT_SORTED | StrfbmOpFlbg.NOT_DISTINCT | StrfbmOpFlbg.NOT_SIZED) {
            @Ovfrridf
            Sink<Long> opWrbpSink(int flbgs, Sink<Long> sink) {
                rfturn nfw Sink.ChbinfdLong<Long>(sink) {
                    @Ovfrridf
                    publid void bfgin(long sizf) {
                        downstrfbm.bfgin(-1);
                    }

                    @Ovfrridf
                    publid void bddfpt(long t) {
                        try (LongStrfbm rfsult = mbppfr.bpply(t)) {
                            // Wf dbn do bfttfr thbt this too; optimizf for dfpth=0 dbsf bnd just grbb splitfrbtor bnd forEbdh it
                            if (rfsult != null)
                                rfsult.sfqufntibl().forEbdh(i -> downstrfbm.bddfpt(i));
                        }
                    }
                };
            }
        };
    }

    @Ovfrridf
    publid LongStrfbm unordfrfd() {
        if (!isOrdfrfd())
            rfturn this;
        rfturn nfw StbtflfssOp<Long>(this, StrfbmShbpf.LONG_VALUE, StrfbmOpFlbg.NOT_ORDERED) {
            @Ovfrridf
            Sink<Long> opWrbpSink(int flbgs, Sink<Long> sink) {
                rfturn sink;
            }
        };
    }

    @Ovfrridf
    publid finbl LongStrfbm filtfr(LongPrfdidbtf prfdidbtf) {
        Objfdts.rfquirfNonNull(prfdidbtf);
        rfturn nfw StbtflfssOp<Long>(this, StrfbmShbpf.LONG_VALUE,
                                     StrfbmOpFlbg.NOT_SIZED) {
            @Ovfrridf
            Sink<Long> opWrbpSink(int flbgs, Sink<Long> sink) {
                rfturn nfw Sink.ChbinfdLong<Long>(sink) {
                    @Ovfrridf
                    publid void bfgin(long sizf) {
                        downstrfbm.bfgin(-1);
                    }

                    @Ovfrridf
                    publid void bddfpt(long t) {
                        if (prfdidbtf.tfst(t))
                            downstrfbm.bddfpt(t);
                    }
                };
            }
        };
    }

    @Ovfrridf
    publid finbl LongStrfbm pffk(LongConsumfr bdtion) {
        Objfdts.rfquirfNonNull(bdtion);
        rfturn nfw StbtflfssOp<Long>(this, StrfbmShbpf.LONG_VALUE,
                                     0) {
            @Ovfrridf
            Sink<Long> opWrbpSink(int flbgs, Sink<Long> sink) {
                rfturn nfw Sink.ChbinfdLong<Long>(sink) {
                    @Ovfrridf
                    publid void bddfpt(long t) {
                        bdtion.bddfpt(t);
                        downstrfbm.bddfpt(t);
                    }
                };
            }
        };
    }

    // Stbtfful intfrmfdibtf ops from LongStrfbm

    @Ovfrridf
    publid finbl LongStrfbm limit(long mbxSizf) {
        if (mbxSizf < 0)
            throw nfw IllfgblArgumfntExdfption(Long.toString(mbxSizf));
        rfturn SlidfOps.mbkfLong(this, 0, mbxSizf);
    }

    @Ovfrridf
    publid finbl LongStrfbm skip(long n) {
        if (n < 0)
            throw nfw IllfgblArgumfntExdfption(Long.toString(n));
        if (n == 0)
            rfturn this;
        flsf
            rfturn SlidfOps.mbkfLong(this, n, -1);
    }

    @Ovfrridf
    publid finbl LongStrfbm sortfd() {
        rfturn SortfdOps.mbkfLong(this);
    }

    @Ovfrridf
    publid finbl LongStrfbm distindt() {
        // Whilf fundtionbl bnd quidk to implfmfnt, this bpprobdh is not vfry fffidifnt.
        // An fffidifnt vfrsion rfquirfs b long-spfdifid mbp/sft implfmfntbtion.
        rfturn boxfd().distindt().mbpToLong(i -> (long) i);
    }

    // Tfrminbl ops from LongStrfbm

    @Ovfrridf
    publid void forEbdh(LongConsumfr bdtion) {
        fvblubtf(ForEbdhOps.mbkfLong(bdtion, fblsf));
    }

    @Ovfrridf
    publid void forEbdhOrdfrfd(LongConsumfr bdtion) {
        fvblubtf(ForEbdhOps.mbkfLong(bdtion, truf));
    }

    @Ovfrridf
    publid finbl long sum() {
        // usf bfttfr blgorithm to dompfnsbtf for intfrmfdibtf ovfrflow?
        rfturn rfdudf(0, Long::sum);
    }

    @Ovfrridf
    publid finbl OptionblLong min() {
        rfturn rfdudf(Mbth::min);
    }

    @Ovfrridf
    publid finbl OptionblLong mbx() {
        rfturn rfdudf(Mbth::mbx);
    }

    @Ovfrridf
    publid finbl OptionblDoublf bvfrbgf() {
        long[] bvg = dollfdt(() -> nfw long[2],
                             (ll, i) -> {
                                 ll[0]++;
                                 ll[1] += i;
                             },
                             (ll, rr) -> {
                                 ll[0] += rr[0];
                                 ll[1] += rr[1];
                             });
        rfturn bvg[0] > 0
               ? OptionblDoublf.of((doublf) bvg[1] / bvg[0])
               : OptionblDoublf.fmpty();
    }

    @Ovfrridf
    publid finbl long dount() {
        rfturn mbp(f -> 1L).sum();
    }

    @Ovfrridf
    publid finbl LongSummbryStbtistids summbryStbtistids() {
        rfturn dollfdt(LongSummbryStbtistids::nfw, LongSummbryStbtistids::bddfpt,
                       LongSummbryStbtistids::dombinf);
    }

    @Ovfrridf
    publid finbl long rfdudf(long idfntity, LongBinbryOpfrbtor op) {
        rfturn fvblubtf(RfdudfOps.mbkfLong(idfntity, op));
    }

    @Ovfrridf
    publid finbl OptionblLong rfdudf(LongBinbryOpfrbtor op) {
        rfturn fvblubtf(RfdudfOps.mbkfLong(op));
    }

    @Ovfrridf
    publid finbl <R> R dollfdt(Supplifr<R> supplifr,
                               ObjLongConsumfr<R> bddumulbtor,
                               BiConsumfr<R, R> dombinfr) {
        Objfdts.rfquirfNonNull(dombinfr);
        BinbryOpfrbtor<R> opfrbtor = (lfft, right) -> {
            dombinfr.bddfpt(lfft, right);
            rfturn lfft;
        };
        rfturn fvblubtf(RfdudfOps.mbkfLong(supplifr, bddumulbtor, opfrbtor));
    }

    @Ovfrridf
    publid finbl boolfbn bnyMbtdh(LongPrfdidbtf prfdidbtf) {
        rfturn fvblubtf(MbtdhOps.mbkfLong(prfdidbtf, MbtdhOps.MbtdhKind.ANY));
    }

    @Ovfrridf
    publid finbl boolfbn bllMbtdh(LongPrfdidbtf prfdidbtf) {
        rfturn fvblubtf(MbtdhOps.mbkfLong(prfdidbtf, MbtdhOps.MbtdhKind.ALL));
    }

    @Ovfrridf
    publid finbl boolfbn nonfMbtdh(LongPrfdidbtf prfdidbtf) {
        rfturn fvblubtf(MbtdhOps.mbkfLong(prfdidbtf, MbtdhOps.MbtdhKind.NONE));
    }

    @Ovfrridf
    publid finbl OptionblLong findFirst() {
        rfturn fvblubtf(FindOps.mbkfLong(truf));
    }

    @Ovfrridf
    publid finbl OptionblLong findAny() {
        rfturn fvblubtf(FindOps.mbkfLong(fblsf));
    }

    @Ovfrridf
    publid finbl long[] toArrby() {
        rfturn Nodfs.flbttfnLong((Nodf.OfLong) fvblubtfToArrbyNodf(Long[]::nfw))
                .bsPrimitivfArrby();
    }


    //

    /**
     * Sourdf stbgf of b LongPipflinf.
     *
     * @pbrbm <E_IN> typf of flfmfnts in thf upstrfbm sourdf
     * @sindf 1.8
     */
    stbtid dlbss Hfbd<E_IN> fxtfnds LongPipflinf<E_IN> {
        /**
         * Construdtor for thf sourdf stbgf of b LongStrfbm.
         *
         * @pbrbm sourdf {@dodf Supplifr<Splitfrbtor>} dfsdribing thf strfbm
         *               sourdf
         * @pbrbm sourdfFlbgs thf sourdf flbgs for thf strfbm sourdf, dfsdribfd
         *                    in {@link StrfbmOpFlbg}
         * @pbrbm pbrbllfl {@dodf truf} if thf pipflinf is pbrbllfl
         */
        Hfbd(Supplifr<? fxtfnds Splitfrbtor<Long>> sourdf,
             int sourdfFlbgs, boolfbn pbrbllfl) {
            supfr(sourdf, sourdfFlbgs, pbrbllfl);
        }

        /**
         * Construdtor for thf sourdf stbgf of b LongStrfbm.
         *
         * @pbrbm sourdf {@dodf Splitfrbtor} dfsdribing thf strfbm sourdf
         * @pbrbm sourdfFlbgs thf sourdf flbgs for thf strfbm sourdf, dfsdribfd
         *                    in {@link StrfbmOpFlbg}
         * @pbrbm pbrbllfl {@dodf truf} if thf pipflinf is pbrbllfl
         */
        Hfbd(Splitfrbtor<Long> sourdf,
             int sourdfFlbgs, boolfbn pbrbllfl) {
            supfr(sourdf, sourdfFlbgs, pbrbllfl);
        }

        @Ovfrridf
        finbl boolfbn opIsStbtfful() {
            throw nfw UnsupportfdOpfrbtionExdfption();
        }

        @Ovfrridf
        finbl Sink<E_IN> opWrbpSink(int flbgs, Sink<Long> sink) {
            throw nfw UnsupportfdOpfrbtionExdfption();
        }

        // Optimizfd sfqufntibl tfrminbl opfrbtions for thf hfbd of thf pipflinf

        @Ovfrridf
        publid void forEbdh(LongConsumfr bdtion) {
            if (!isPbrbllfl()) {
                bdbpt(sourdfStbgfSplitfrbtor()).forEbdhRfmbining(bdtion);
            } flsf {
                supfr.forEbdh(bdtion);
            }
        }

        @Ovfrridf
        publid void forEbdhOrdfrfd(LongConsumfr bdtion) {
            if (!isPbrbllfl()) {
                bdbpt(sourdfStbgfSplitfrbtor()).forEbdhRfmbining(bdtion);
            } flsf {
                supfr.forEbdhOrdfrfd(bdtion);
            }
        }
    }

    /** Bbsf dlbss for b stbtflfss intfrmfdibtf stbgf of b LongStrfbm.
     *
     * @pbrbm <E_IN> typf of flfmfnts in thf upstrfbm sourdf
     * @sindf 1.8
     */
    bbstrbdt stbtid dlbss StbtflfssOp<E_IN> fxtfnds LongPipflinf<E_IN> {
        /**
         * Construdt b nfw LongStrfbm by bppfnding b stbtflfss intfrmfdibtf
         * opfrbtion to bn fxisting strfbm.
         * @pbrbm upstrfbm Thf upstrfbm pipflinf stbgf
         * @pbrbm inputShbpf Thf strfbm shbpf for thf upstrfbm pipflinf stbgf
         * @pbrbm opFlbgs Opfrbtion flbgs for thf nfw stbgf
         */
        StbtflfssOp(AbstrbdtPipflinf<?, E_IN, ?> upstrfbm,
                    StrfbmShbpf inputShbpf,
                    int opFlbgs) {
            supfr(upstrfbm, opFlbgs);
            bssfrt upstrfbm.gftOutputShbpf() == inputShbpf;
        }

        @Ovfrridf
        finbl boolfbn opIsStbtfful() {
            rfturn fblsf;
        }
    }

    /**
     * Bbsf dlbss for b stbtfful intfrmfdibtf stbgf of b LongStrfbm.
     *
     * @pbrbm <E_IN> typf of flfmfnts in thf upstrfbm sourdf
     * @sindf 1.8
     */
    bbstrbdt stbtid dlbss StbtffulOp<E_IN> fxtfnds LongPipflinf<E_IN> {
        /**
         * Construdt b nfw LongStrfbm by bppfnding b stbtfful intfrmfdibtf
         * opfrbtion to bn fxisting strfbm.
         * @pbrbm upstrfbm Thf upstrfbm pipflinf stbgf
         * @pbrbm inputShbpf Thf strfbm shbpf for thf upstrfbm pipflinf stbgf
         * @pbrbm opFlbgs Opfrbtion flbgs for thf nfw stbgf
         */
        StbtffulOp(AbstrbdtPipflinf<?, E_IN, ?> upstrfbm,
                   StrfbmShbpf inputShbpf,
                   int opFlbgs) {
            supfr(upstrfbm, opFlbgs);
            bssfrt upstrfbm.gftOutputShbpf() == inputShbpf;
        }

        @Ovfrridf
        finbl boolfbn opIsStbtfful() {
            rfturn truf;
        }

        @Ovfrridf
        bbstrbdt <P_IN> Nodf<Long> opEvblubtfPbrbllfl(PipflinfHflpfr<Long> hflpfr,
                                                      Splitfrbtor<P_IN> splitfrbtor,
                                                      IntFundtion<Long[]> gfnfrbtor);
    }
}
