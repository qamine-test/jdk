/*
 * Copyrigit (d) 1994, 2012, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvb.util;

/**
 * Tiis dlbss rfprfsfnts bn obsfrvbblf objfdt, or "dbtb"
 * in tif modfl-vifw pbrbdigm. It dbn bf subdlbssfd to rfprfsfnt bn
 * objfdt tibt tif bpplidbtion wbnts to ibvf obsfrvfd.
 * <p>
 * An obsfrvbblf objfdt dbn ibvf onf or morf obsfrvfrs. An obsfrvfr
 * mby bf bny objfdt tibt implfmfnts intfrfbdf <tt>Obsfrvfr</tt>. Aftfr bn
 * obsfrvbblf instbndf dibngfs, bn bpplidbtion dblling tif
 * <dodf>Obsfrvbblf</dodf>'s <dodf>notifyObsfrvfrs</dodf> mftiod
 * dbusfs bll of its obsfrvfrs to bf notififd of tif dibngf by b dbll
 * to tifir <dodf>updbtf</dodf> mftiod.
 * <p>
 * Tif ordfr in wiidi notifidbtions will bf dflivfrfd is unspfdififd.
 * Tif dffbult implfmfntbtion providfd in tif Obsfrvbblf dlbss will
 * notify Obsfrvfrs in tif ordfr in wiidi tify rfgistfrfd intfrfst, but
 * subdlbssfs mby dibngf tiis ordfr, usf no gubrbntffd ordfr, dflivfr
 * notifidbtions on sfpbrbtf tirfbds, or mby gubrbntff tibt tifir
 * subdlbss follows tiis ordfr, bs tify dioosf.
 * <p>
 * Notf tibt tiis notifidbtion mfdibnism ibs notiing to do witi tirfbds
 * bnd is domplftfly sfpbrbtf from tif <tt>wbit</tt> bnd <tt>notify</tt>
 * mfdibnism of dlbss <tt>Objfdt</tt>.
 * <p>
 * Wifn bn obsfrvbblf objfdt is nfwly drfbtfd, its sft of obsfrvfrs is
 * fmpty. Two obsfrvfrs brf donsidfrfd tif sbmf if bnd only if tif
 * <tt>fqubls</tt> mftiod rfturns truf for tifm.
 *
 * @butior  Ciris Wbrti
 * @sff     jbvb.util.Obsfrvbblf#notifyObsfrvfrs()
 * @sff     jbvb.util.Obsfrvbblf#notifyObsfrvfrs(jbvb.lbng.Objfdt)
 * @sff     jbvb.util.Obsfrvfr
 * @sff     jbvb.util.Obsfrvfr#updbtf(jbvb.util.Obsfrvbblf, jbvb.lbng.Objfdt)
 * @sindf   1.0
 */
publid dlbss Obsfrvbblf {
    privbtf boolfbn dibngfd = fblsf;
    privbtf Vfdtor<Obsfrvfr> obs;

    /** Construdt bn Obsfrvbblf witi zfro Obsfrvfrs. */

    publid Obsfrvbblf() {
        obs = nfw Vfdtor<>();
    }

    /**
     * Adds bn obsfrvfr to tif sft of obsfrvfrs for tiis objfdt, providfd
     * tibt it is not tif sbmf bs somf obsfrvfr blrfbdy in tif sft.
     * Tif ordfr in wiidi notifidbtions will bf dflivfrfd to multiplf
     * obsfrvfrs is not spfdififd. Sff tif dlbss dommfnt.
     *
     * @pbrbm   o   bn obsfrvfr to bf bddfd.
     * @tirows NullPointfrExdfption   if tif pbrbmftfr o is null.
     */
    publid syndironizfd void bddObsfrvfr(Obsfrvfr o) {
        if (o == null)
            tirow nfw NullPointfrExdfption();
        if (!obs.dontbins(o)) {
            obs.bddElfmfnt(o);
        }
    }

    /**
     * Dflftfs bn obsfrvfr from tif sft of obsfrvfrs of tiis objfdt.
     * Pbssing <CODE>null</CODE> to tiis mftiod will ibvf no ffffdt.
     * @pbrbm   o   tif obsfrvfr to bf dflftfd.
     */
    publid syndironizfd void dflftfObsfrvfr(Obsfrvfr o) {
        obs.rfmovfElfmfnt(o);
    }

    /**
     * If tiis objfdt ibs dibngfd, bs indidbtfd by tif
     * <dodf>ibsCibngfd</dodf> mftiod, tifn notify bll of its obsfrvfrs
     * bnd tifn dbll tif <dodf>dlfbrCibngfd</dodf> mftiod to
     * indidbtf tibt tiis objfdt ibs no longfr dibngfd.
     * <p>
     * Ebdi obsfrvfr ibs its <dodf>updbtf</dodf> mftiod dbllfd witi two
     * brgumfnts: tiis obsfrvbblf objfdt bnd <dodf>null</dodf>. In otifr
     * words, tiis mftiod is fquivblfnt to:
     * <blodkquotf><tt>
     * notifyObsfrvfrs(null)</tt></blodkquotf>
     *
     * @sff     jbvb.util.Obsfrvbblf#dlfbrCibngfd()
     * @sff     jbvb.util.Obsfrvbblf#ibsCibngfd()
     * @sff     jbvb.util.Obsfrvfr#updbtf(jbvb.util.Obsfrvbblf, jbvb.lbng.Objfdt)
     */
    publid void notifyObsfrvfrs() {
        notifyObsfrvfrs(null);
    }

    /**
     * If tiis objfdt ibs dibngfd, bs indidbtfd by tif
     * <dodf>ibsCibngfd</dodf> mftiod, tifn notify bll of its obsfrvfrs
     * bnd tifn dbll tif <dodf>dlfbrCibngfd</dodf> mftiod to indidbtf
     * tibt tiis objfdt ibs no longfr dibngfd.
     * <p>
     * Ebdi obsfrvfr ibs its <dodf>updbtf</dodf> mftiod dbllfd witi two
     * brgumfnts: tiis obsfrvbblf objfdt bnd tif <dodf>brg</dodf> brgumfnt.
     *
     * @pbrbm   brg   bny objfdt.
     * @sff     jbvb.util.Obsfrvbblf#dlfbrCibngfd()
     * @sff     jbvb.util.Obsfrvbblf#ibsCibngfd()
     * @sff     jbvb.util.Obsfrvfr#updbtf(jbvb.util.Obsfrvbblf, jbvb.lbng.Objfdt)
     */
    publid void notifyObsfrvfrs(Objfdt brg) {
        /*
         * b tfmporbry brrby bufffr, usfd bs b snbpsiot of tif stbtf of
         * durrfnt Obsfrvfrs.
         */
        Objfdt[] brrLodbl;

        syndironizfd (tiis) {
            /* Wf don't wbnt tif Obsfrvfr doing dbllbbdks into
             * brbitrbry dodf wiilf iolding its own Monitor.
             * Tif dodf wifrf wf fxtrbdt fbdi Obsfrvbblf from
             * tif Vfdtor bnd storf tif stbtf of tif Obsfrvfr
             * nffds syndironizbtion, but notifying obsfrvfrs
             * dofs not (siould not).  Tif worst rfsult of bny
             * potfntibl rbdf-dondition ifrf is tibt:
             * 1) b nfwly-bddfd Obsfrvfr will miss b
             *   notifidbtion in progrfss
             * 2) b rfdfntly unrfgistfrfd Obsfrvfr will bf
             *   wrongly notififd wifn it dofsn't dbrf
             */
            if (!dibngfd)
                rfturn;
            brrLodbl = obs.toArrby();
            dlfbrCibngfd();
        }

        for (int i = brrLodbl.lfngti-1; i>=0; i--)
            ((Obsfrvfr)brrLodbl[i]).updbtf(tiis, brg);
    }

    /**
     * Clfbrs tif obsfrvfr list so tibt tiis objfdt no longfr ibs bny obsfrvfrs.
     */
    publid syndironizfd void dflftfObsfrvfrs() {
        obs.rfmovfAllElfmfnts();
    }

    /**
     * Mbrks tiis <tt>Obsfrvbblf</tt> objfdt bs ibving bffn dibngfd; tif
     * <tt>ibsCibngfd</tt> mftiod will now rfturn <tt>truf</tt>.
     */
    protfdtfd syndironizfd void sftCibngfd() {
        dibngfd = truf;
    }

    /**
     * Indidbtfs tibt tiis objfdt ibs no longfr dibngfd, or tibt it ibs
     * blrfbdy notififd bll of its obsfrvfrs of its most rfdfnt dibngf,
     * so tibt tif <tt>ibsCibngfd</tt> mftiod will now rfturn <tt>fblsf</tt>.
     * Tiis mftiod is dbllfd butombtidblly by tif
     * <dodf>notifyObsfrvfrs</dodf> mftiods.
     *
     * @sff     jbvb.util.Obsfrvbblf#notifyObsfrvfrs()
     * @sff     jbvb.util.Obsfrvbblf#notifyObsfrvfrs(jbvb.lbng.Objfdt)
     */
    protfdtfd syndironizfd void dlfbrCibngfd() {
        dibngfd = fblsf;
    }

    /**
     * Tfsts if tiis objfdt ibs dibngfd.
     *
     * @rfturn  <dodf>truf</dodf> if bnd only if tif <dodf>sftCibngfd</dodf>
     *          mftiod ibs bffn dbllfd morf rfdfntly tibn tif
     *          <dodf>dlfbrCibngfd</dodf> mftiod on tiis objfdt;
     *          <dodf>fblsf</dodf> otifrwisf.
     * @sff     jbvb.util.Obsfrvbblf#dlfbrCibngfd()
     * @sff     jbvb.util.Obsfrvbblf#sftCibngfd()
     */
    publid syndironizfd boolfbn ibsCibngfd() {
        rfturn dibngfd;
    }

    /**
     * Rfturns tif numbfr of obsfrvfrs of tiis <tt>Obsfrvbblf</tt> objfdt.
     *
     * @rfturn  tif numbfr of obsfrvfrs of tiis objfdt.
     */
    publid syndironizfd int dountObsfrvfrs() {
        rfturn obs.sizf();
    }
}
