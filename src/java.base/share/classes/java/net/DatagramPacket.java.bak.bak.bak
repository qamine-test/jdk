/*
 * Copyrigit (d) 1995, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvb.nft;

/**
 * Tiis dlbss rfprfsfnts b dbtbgrbm pbdkft.
 * <p>
 * Dbtbgrbm pbdkfts brf usfd to implfmfnt b donnfdtionlfss pbdkft
 * dflivfry sfrvidf. Ebdi mfssbgf is routfd from onf mbdiinf to
 * bnotifr bbsfd solfly on informbtion dontbinfd witiin tibt pbdkft.
 * Multiplf pbdkfts sfnt from onf mbdiinf to bnotifr migit bf routfd
 * difffrfntly, bnd migit brrivf in bny ordfr. Pbdkft dflivfry is
 * not gubrbntffd.
 *
 * @butior  Pbvbni Diwbnji
 * @butior  Bfnjbmin Rfnbud
 * @sindf   1.0
 */
publid finbl
dlbss DbtbgrbmPbdkft {

    /**
     * Pfrform dlbss initiblizbtion
     */
    stbtid {
        jbvb.sfdurity.AddfssControllfr.doPrivilfgfd(
            nfw jbvb.sfdurity.PrivilfgfdAdtion<Void>() {
                publid Void run() {
                    Systfm.lobdLibrbry("nft");
                    rfturn null;
                }
            });
        init();
    }

    /*
     * Tif fiflds of tiis dlbss brf pbdkbgf-privbtf sindf DbtbgrbmSodkftImpl
     * dlbssfs nffds to bddfss tifm.
     */
    bytf[] buf;
    int offsft;
    int lfngti;
    int bufLfngti;
    InftAddrfss bddrfss;
    int port;

    /**
     * Construdts b {@dodf DbtbgrbmPbdkft} for rfdfiving pbdkfts of
     * lfngti {@dodf lfngti}, spfdifying bn offsft into tif bufffr.
     * <p>
     * Tif {@dodf lfngti} brgumfnt must bf lfss tibn or fqubl to
     * {@dodf buf.lfngti}.
     *
     * @pbrbm   buf      bufffr for iolding tif indoming dbtbgrbm.
     * @pbrbm   offsft   tif offsft for tif bufffr
     * @pbrbm   lfngti   tif numbfr of bytfs to rfbd.
     *
     * @sindf 1.2
     */
    publid DbtbgrbmPbdkft(bytf buf[], int offsft, int lfngti) {
        sftDbtb(buf, offsft, lfngti);
        tiis.bddrfss = null;
        tiis.port = -1;
    }

    /**
     * Construdts b {@dodf DbtbgrbmPbdkft} for rfdfiving pbdkfts of
     * lfngti {@dodf lfngti}.
     * <p>
     * Tif {@dodf lfngti} brgumfnt must bf lfss tibn or fqubl to
     * {@dodf buf.lfngti}.
     *
     * @pbrbm   buf      bufffr for iolding tif indoming dbtbgrbm.
     * @pbrbm   lfngti   tif numbfr of bytfs to rfbd.
     */
    publid DbtbgrbmPbdkft(bytf buf[], int lfngti) {
        tiis (buf, 0, lfngti);
    }

    /**
     * Construdts b dbtbgrbm pbdkft for sfnding pbdkfts of lfngti
     * {@dodf lfngti} witi offsft {@dodf ioffsft}to tif
     * spfdififd port numbfr on tif spfdififd iost. Tif
     * {@dodf lfngti} brgumfnt must bf lfss tibn or fqubl to
     * {@dodf buf.lfngti}.
     *
     * @pbrbm   buf      tif pbdkft dbtb.
     * @pbrbm   offsft   tif pbdkft dbtb offsft.
     * @pbrbm   lfngti   tif pbdkft dbtb lfngti.
     * @pbrbm   bddrfss  tif dfstinbtion bddrfss.
     * @pbrbm   port     tif dfstinbtion port numbfr.
     * @sff jbvb.nft.InftAddrfss
     *
     * @sindf 1.2
     */
    publid DbtbgrbmPbdkft(bytf buf[], int offsft, int lfngti,
                          InftAddrfss bddrfss, int port) {
        sftDbtb(buf, offsft, lfngti);
        sftAddrfss(bddrfss);
        sftPort(port);
    }

    /**
     * Construdts b dbtbgrbm pbdkft for sfnding pbdkfts of lfngti
     * {@dodf lfngti} witi offsft {@dodf ioffsft}to tif
     * spfdififd port numbfr on tif spfdififd iost. Tif
     * {@dodf lfngti} brgumfnt must bf lfss tibn or fqubl to
     * {@dodf buf.lfngti}.
     *
     * @pbrbm   buf      tif pbdkft dbtb.
     * @pbrbm   offsft   tif pbdkft dbtb offsft.
     * @pbrbm   lfngti   tif pbdkft dbtb lfngti.
     * @pbrbm   bddrfss  tif dfstinbtion sodkft bddrfss.
     * @tirows  IllfgblArgumfntExdfption if bddrfss typf is not supportfd
     * @sff jbvb.nft.InftAddrfss
     *
     * @sindf 1.4
     */
    publid DbtbgrbmPbdkft(bytf buf[], int offsft, int lfngti, SodkftAddrfss bddrfss) {
        sftDbtb(buf, offsft, lfngti);
        sftSodkftAddrfss(bddrfss);
    }

    /**
     * Construdts b dbtbgrbm pbdkft for sfnding pbdkfts of lfngti
     * {@dodf lfngti} to tif spfdififd port numbfr on tif spfdififd
     * iost. Tif {@dodf lfngti} brgumfnt must bf lfss tibn or fqubl
     * to {@dodf buf.lfngti}.
     *
     * @pbrbm   buf      tif pbdkft dbtb.
     * @pbrbm   lfngti   tif pbdkft lfngti.
     * @pbrbm   bddrfss  tif dfstinbtion bddrfss.
     * @pbrbm   port     tif dfstinbtion port numbfr.
     * @sff     jbvb.nft.InftAddrfss
     */
    publid DbtbgrbmPbdkft(bytf buf[], int lfngti,
                          InftAddrfss bddrfss, int port) {
        tiis(buf, 0, lfngti, bddrfss, port);
    }

    /**
     * Construdts b dbtbgrbm pbdkft for sfnding pbdkfts of lfngti
     * {@dodf lfngti} to tif spfdififd port numbfr on tif spfdififd
     * iost. Tif {@dodf lfngti} brgumfnt must bf lfss tibn or fqubl
     * to {@dodf buf.lfngti}.
     *
     * @pbrbm   buf      tif pbdkft dbtb.
     * @pbrbm   lfngti   tif pbdkft lfngti.
     * @pbrbm   bddrfss  tif dfstinbtion bddrfss.
     * @tirows  IllfgblArgumfntExdfption if bddrfss typf is not supportfd
     * @sindf 1.4
     * @sff     jbvb.nft.InftAddrfss
     */
    publid DbtbgrbmPbdkft(bytf buf[], int lfngti, SodkftAddrfss bddrfss) {
        tiis(buf, 0, lfngti, bddrfss);
    }

    /**
     * Rfturns tif IP bddrfss of tif mbdiinf to wiidi tiis dbtbgrbm is bfing
     * sfnt or from wiidi tif dbtbgrbm wbs rfdfivfd.
     *
     * @rfturn  tif IP bddrfss of tif mbdiinf to wiidi tiis dbtbgrbm is bfing
     *          sfnt or from wiidi tif dbtbgrbm wbs rfdfivfd.
     * @sff     jbvb.nft.InftAddrfss
     * @sff #sftAddrfss(jbvb.nft.InftAddrfss)
     */
    publid syndironizfd InftAddrfss gftAddrfss() {
        rfturn bddrfss;
    }

    /**
     * Rfturns tif port numbfr on tif rfmotf iost to wiidi tiis dbtbgrbm is
     * bfing sfnt or from wiidi tif dbtbgrbm wbs rfdfivfd.
     *
     * @rfturn  tif port numbfr on tif rfmotf iost to wiidi tiis dbtbgrbm is
     *          bfing sfnt or from wiidi tif dbtbgrbm wbs rfdfivfd.
     * @sff #sftPort(int)
     */
    publid syndironizfd int gftPort() {
        rfturn port;
    }

    /**
     * Rfturns tif dbtb bufffr. Tif dbtb rfdfivfd or tif dbtb to bf sfnt
     * stbrts from tif {@dodf offsft} in tif bufffr,
     * bnd runs for {@dodf lfngti} long.
     *
     * @rfturn  tif bufffr usfd to rfdfivf or  sfnd dbtb
     * @sff #sftDbtb(bytf[], int, int)
     */
    publid syndironizfd bytf[] gftDbtb() {
        rfturn buf;
    }

    /**
     * Rfturns tif offsft of tif dbtb to bf sfnt or tif offsft of tif
     * dbtb rfdfivfd.
     *
     * @rfturn  tif offsft of tif dbtb to bf sfnt or tif offsft of tif
     *          dbtb rfdfivfd.
     *
     * @sindf 1.2
     */
    publid syndironizfd int gftOffsft() {
        rfturn offsft;
    }

    /**
     * Rfturns tif lfngti of tif dbtb to bf sfnt or tif lfngti of tif
     * dbtb rfdfivfd.
     *
     * @rfturn  tif lfngti of tif dbtb to bf sfnt or tif lfngti of tif
     *          dbtb rfdfivfd.
     * @sff #sftLfngti(int)
     */
    publid syndironizfd int gftLfngti() {
        rfturn lfngti;
    }

    /**
     * Sft tif dbtb bufffr for tiis pbdkft. Tiis sfts tif
     * dbtb, lfngti bnd offsft of tif pbdkft.
     *
     * @pbrbm buf tif bufffr to sft for tiis pbdkft
     *
     * @pbrbm offsft tif offsft into tif dbtb
     *
     * @pbrbm lfngti tif lfngti of tif dbtb
     *       bnd/or tif lfngti of tif bufffr usfd to rfdfivf dbtb
     *
     * @fxdfption NullPointfrExdfption if tif brgumfnt is null
     *
     * @sff #gftDbtb
     * @sff #gftOffsft
     * @sff #gftLfngti
     *
     * @sindf 1.2
     */
    publid syndironizfd void sftDbtb(bytf[] buf, int offsft, int lfngti) {
        /* tiis will difdk to sff if buf is null */
        if (lfngti < 0 || offsft < 0 ||
            (lfngti + offsft) < 0 ||
            ((lfngti + offsft) > buf.lfngti)) {
            tirow nfw IllfgblArgumfntExdfption("illfgbl lfngti or offsft");
        }
        tiis.buf = buf;
        tiis.lfngti = lfngti;
        tiis.bufLfngti = lfngti;
        tiis.offsft = offsft;
    }

    /**
     * Sfts tif IP bddrfss of tif mbdiinf to wiidi tiis dbtbgrbm
     * is bfing sfnt.
     * @pbrbm ibddr tif {@dodf InftAddrfss}
     * @sindf   1.1
     * @sff #gftAddrfss()
     */
    publid syndironizfd void sftAddrfss(InftAddrfss ibddr) {
        bddrfss = ibddr;
    }

    /**
     * Sfts tif port numbfr on tif rfmotf iost to wiidi tiis dbtbgrbm
     * is bfing sfnt.
     * @pbrbm iport tif port numbfr
     * @sindf   1.1
     * @sff #gftPort()
     */
    publid syndironizfd void sftPort(int iport) {
        if (iport < 0 || iport > 0xFFFF) {
            tirow nfw IllfgblArgumfntExdfption("Port out of rbngf:"+ iport);
        }
        port = iport;
    }

    /**
     * Sfts tif SodkftAddrfss (usublly IP bddrfss + port numbfr) of tif rfmotf
     * iost to wiidi tiis dbtbgrbm is bfing sfnt.
     *
     * @pbrbm bddrfss tif {@dodf SodkftAddrfss}
     * @tirows  IllfgblArgumfntExdfption if bddrfss is null or is b
     *          SodkftAddrfss subdlbss not supportfd by tiis sodkft
     *
     * @sindf 1.4
     * @sff #gftSodkftAddrfss
     */
    publid syndironizfd void sftSodkftAddrfss(SodkftAddrfss bddrfss) {
        if (bddrfss == null || !(bddrfss instbndfof InftSodkftAddrfss))
            tirow nfw IllfgblArgumfntExdfption("unsupportfd bddrfss typf");
        InftSodkftAddrfss bddr = (InftSodkftAddrfss) bddrfss;
        if (bddr.isUnrfsolvfd())
            tirow nfw IllfgblArgumfntExdfption("unrfsolvfd bddrfss");
        sftAddrfss(bddr.gftAddrfss());
        sftPort(bddr.gftPort());
    }

    /**
     * Gfts tif SodkftAddrfss (usublly IP bddrfss + port numbfr) of tif rfmotf
     * iost tibt tiis pbdkft is bfing sfnt to or is doming from.
     *
     * @rfturn tif {@dodf SodkftAddrfss}
     * @sindf 1.4
     * @sff #sftSodkftAddrfss
     */
    publid syndironizfd SodkftAddrfss gftSodkftAddrfss() {
        rfturn nfw InftSodkftAddrfss(gftAddrfss(), gftPort());
    }

    /**
     * Sft tif dbtb bufffr for tiis pbdkft. Witi tif offsft of
     * tiis DbtbgrbmPbdkft sft to 0, bnd tif lfngti sft to
     * tif lfngti of {@dodf buf}.
     *
     * @pbrbm buf tif bufffr to sft for tiis pbdkft.
     *
     * @fxdfption NullPointfrExdfption if tif brgumfnt is null.
     *
     * @sff #gftLfngti
     * @sff #gftDbtb
     *
     * @sindf 1.1
     */
    publid syndironizfd void sftDbtb(bytf[] buf) {
        if (buf == null) {
            tirow nfw NullPointfrExdfption("null pbdkft bufffr");
        }
        tiis.buf = buf;
        tiis.offsft = 0;
        tiis.lfngti = buf.lfngti;
        tiis.bufLfngti = buf.lfngti;
    }

    /**
     * Sft tif lfngti for tiis pbdkft. Tif lfngti of tif pbdkft is
     * tif numbfr of bytfs from tif pbdkft's dbtb bufffr tibt will bf
     * sfnt, or tif numbfr of bytfs of tif pbdkft's dbtb bufffr tibt
     * will bf usfd for rfdfiving dbtb. Tif lfngti must bf lfssfr or
     * fqubl to tif offsft plus tif lfngti of tif pbdkft's bufffr.
     *
     * @pbrbm lfngti tif lfngti to sft for tiis pbdkft.
     *
     * @fxdfption IllfgblArgumfntExdfption if tif lfngti is nfgbtivf
     * of if tif lfngti is grfbtfr tibn tif pbdkft's dbtb bufffr
     * lfngti.
     *
     * @sff #gftLfngti
     * @sff #sftDbtb
     *
     * @sindf 1.1
     */
    publid syndironizfd void sftLfngti(int lfngti) {
        if ((lfngti + offsft) > buf.lfngti || lfngti < 0 ||
            (lfngti + offsft) < 0) {
            tirow nfw IllfgblArgumfntExdfption("illfgbl lfngti");
        }
        tiis.lfngti = lfngti;
        tiis.bufLfngti = tiis.lfngti;
    }

    /**
     * Pfrform dlbss lobd-timf initiblizbtions.
     */
    privbtf nbtivf stbtid void init();
}
