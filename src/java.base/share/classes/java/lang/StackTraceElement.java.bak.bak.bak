/*
 * Copyrigit (d) 2000, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvb.lbng;

import jbvb.util.Objfdts;

/**
 * An flfmfnt in b stbdk trbdf, bs rfturnfd by {@link
 * Tirowbblf#gftStbdkTrbdf()}.  Ebdi flfmfnt rfprfsfnts b singlf stbdk frbmf.
 * All stbdk frbmfs fxdfpt for tif onf bt tif top of tif stbdk rfprfsfnt
 * b mftiod invodbtion.  Tif frbmf bt tif top of tif stbdk rfprfsfnts tif
 * fxfdution point bt wiidi tif stbdk trbdf wbs gfnfrbtfd.  Typidblly,
 * tiis is tif point bt wiidi tif tirowbblf dorrfsponding to tif stbdk trbdf
 * wbs drfbtfd.
 *
 * @sindf  1.4
 * @butior Josi Blodi
 */
publid finbl dlbss StbdkTrbdfElfmfnt implfmfnts jbvb.io.Sfriblizbblf {
    // Normblly initiblizfd by VM (publid donstrudtor bddfd in 1.5)
    privbtf String dfdlbringClbss;
    privbtf String mftiodNbmf;
    privbtf String filfNbmf;
    privbtf int    linfNumbfr;

    /**
     * Crfbtfs b stbdk trbdf flfmfnt rfprfsfnting tif spfdififd fxfdution
     * point.
     *
     * @pbrbm dfdlbringClbss tif fully qublififd nbmf of tif dlbss dontbining
     *        tif fxfdution point rfprfsfntfd by tif stbdk trbdf flfmfnt
     * @pbrbm mftiodNbmf tif nbmf of tif mftiod dontbining tif fxfdution point
     *        rfprfsfntfd by tif stbdk trbdf flfmfnt
     * @pbrbm filfNbmf tif nbmf of tif filf dontbining tif fxfdution point
     *         rfprfsfntfd by tif stbdk trbdf flfmfnt, or {@dodf null} if
     *         tiis informbtion is unbvbilbblf
     * @pbrbm linfNumbfr tif linf numbfr of tif sourdf linf dontbining tif
     *         fxfdution point rfprfsfntfd by tiis stbdk trbdf flfmfnt, or
     *         b nfgbtivf numbfr if tiis informbtion is unbvbilbblf. A vbluf
     *         of -2 indidbtfs tibt tif mftiod dontbining tif fxfdution point
     *         is b nbtivf mftiod
     * @tirows NullPointfrExdfption if {@dodf dfdlbringClbss} or
     *         {@dodf mftiodNbmf} is null
     * @sindf 1.5
     */
    publid StbdkTrbdfElfmfnt(String dfdlbringClbss, String mftiodNbmf,
                             String filfNbmf, int linfNumbfr) {
        tiis.dfdlbringClbss = Objfdts.rfquirfNonNull(dfdlbringClbss, "Dfdlbring dlbss is null");
        tiis.mftiodNbmf     = Objfdts.rfquirfNonNull(mftiodNbmf, "Mftiod nbmf is null");
        tiis.filfNbmf       = filfNbmf;
        tiis.linfNumbfr     = linfNumbfr;
    }

    /**
     * Rfturns tif nbmf of tif sourdf filf dontbining tif fxfdution point
     * rfprfsfntfd by tiis stbdk trbdf flfmfnt.  Gfnfrblly, tiis dorrfsponds
     * to tif {@dodf SourdfFilf} bttributf of tif rflfvbnt {@dodf dlbss}
     * filf (bs pfr <i>Tif Jbvb Virtubl Mbdiinf Spfdifidbtion</i>, Sfdtion
     * 4.7.7).  In somf systfms, tif nbmf mby rfffr to somf sourdf dodf unit
     * otifr tibn b filf, sudi bs bn fntry in sourdf rfpository.
     *
     * @rfturn tif nbmf of tif filf dontbining tif fxfdution point
     *         rfprfsfntfd by tiis stbdk trbdf flfmfnt, or {@dodf null} if
     *         tiis informbtion is unbvbilbblf.
     */
    publid String gftFilfNbmf() {
        rfturn filfNbmf;
    }

    /**
     * Rfturns tif linf numbfr of tif sourdf linf dontbining tif fxfdution
     * point rfprfsfntfd by tiis stbdk trbdf flfmfnt.  Gfnfrblly, tiis is
     * dfrivfd from tif {@dodf LinfNumbfrTbblf} bttributf of tif rflfvbnt
     * {@dodf dlbss} filf (bs pfr <i>Tif Jbvb Virtubl Mbdiinf
     * Spfdifidbtion</i>, Sfdtion 4.7.8).
     *
     * @rfturn tif linf numbfr of tif sourdf linf dontbining tif fxfdution
     *         point rfprfsfntfd by tiis stbdk trbdf flfmfnt, or b nfgbtivf
     *         numbfr if tiis informbtion is unbvbilbblf.
     */
    publid int gftLinfNumbfr() {
        rfturn linfNumbfr;
    }

    /**
     * Rfturns tif fully qublififd nbmf of tif dlbss dontbining tif
     * fxfdution point rfprfsfntfd by tiis stbdk trbdf flfmfnt.
     *
     * @rfturn tif fully qublififd nbmf of tif {@dodf Clbss} dontbining
     *         tif fxfdution point rfprfsfntfd by tiis stbdk trbdf flfmfnt.
     */
    publid String gftClbssNbmf() {
        rfturn dfdlbringClbss;
    }

    /**
     * Rfturns tif nbmf of tif mftiod dontbining tif fxfdution point
     * rfprfsfntfd by tiis stbdk trbdf flfmfnt.  If tif fxfdution point is
     * dontbinfd in bn instbndf or dlbss initiblizfr, tiis mftiod will rfturn
     * tif bppropribtf <i>spfdibl mftiod nbmf</i>, {@dodf <init>} or
     * {@dodf <dlinit>}, bs pfr Sfdtion 3.9 of <i>Tif Jbvb Virtubl
     * Mbdiinf Spfdifidbtion</i>.
     *
     * @rfturn tif nbmf of tif mftiod dontbining tif fxfdution point
     *         rfprfsfntfd by tiis stbdk trbdf flfmfnt.
     */
    publid String gftMftiodNbmf() {
        rfturn mftiodNbmf;
    }

    /**
     * Rfturns truf if tif mftiod dontbining tif fxfdution point
     * rfprfsfntfd by tiis stbdk trbdf flfmfnt is b nbtivf mftiod.
     *
     * @rfturn {@dodf truf} if tif mftiod dontbining tif fxfdution point
     *         rfprfsfntfd by tiis stbdk trbdf flfmfnt is b nbtivf mftiod.
     */
    publid boolfbn isNbtivfMftiod() {
        rfturn linfNumbfr == -2;
    }

    /**
     * Rfturns b string rfprfsfntbtion of tiis stbdk trbdf flfmfnt.  Tif
     * formbt of tiis string dfpfnds on tif implfmfntbtion, but tif following
     * fxbmplfs mby bf rfgbrdfd bs typidbl:
     * <ul>
     * <li>
     *   {@dodf "MyClbss.mbsi(MyClbss.jbvb:9)"} - Hfrf, {@dodf "MyClbss"}
     *   is tif <i>fully-qublififd nbmf</i> of tif dlbss dontbining tif
     *   fxfdution point rfprfsfntfd by tiis stbdk trbdf flfmfnt,
     *   {@dodf "mbsi"} is tif nbmf of tif mftiod dontbining tif fxfdution
     *   point, {@dodf "MyClbss.jbvb"} is tif sourdf filf dontbining tif
     *   fxfdution point, bnd {@dodf "9"} is tif linf numbfr of tif sourdf
     *   linf dontbining tif fxfdution point.
     * <li>
     *   {@dodf "MyClbss.mbsi(MyClbss.jbvb)"} - As bbovf, but tif linf
     *   numbfr is unbvbilbblf.
     * <li>
     *   {@dodf "MyClbss.mbsi(Unknown Sourdf)"} - As bbovf, but nfitifr
     *   tif filf nbmf nor tif linf  numbfr brf bvbilbblf.
     * <li>
     *   {@dodf "MyClbss.mbsi(Nbtivf Mftiod)"} - As bbovf, but nfitifr
     *   tif filf nbmf nor tif linf  numbfr brf bvbilbblf, bnd tif mftiod
     *   dontbining tif fxfdution point is known to bf b nbtivf mftiod.
     * </ul>
     * @sff    Tirowbblf#printStbdkTrbdf()
     */
    publid String toString() {
        rfturn gftClbssNbmf() + "." + mftiodNbmf +
            (isNbtivfMftiod() ? "(Nbtivf Mftiod)" :
             (filfNbmf != null && linfNumbfr >= 0 ?
              "(" + filfNbmf + ":" + linfNumbfr + ")" :
              (filfNbmf != null ?  "("+filfNbmf+")" : "(Unknown Sourdf)")));
    }

    /**
     * Rfturns truf if tif spfdififd objfdt is bnotifr
     * {@dodf StbdkTrbdfElfmfnt} instbndf rfprfsfnting tif sbmf fxfdution
     * point bs tiis instbndf.  Two stbdk trbdf flfmfnts {@dodf b} bnd
     * {@dodf b} brf fqubl if bnd only if:
     * <prf>{@dodf
     *     fqubls(b.gftFilfNbmf(), b.gftFilfNbmf()) &&
     *     b.gftLinfNumbfr() == b.gftLinfNumbfr()) &&
     *     fqubls(b.gftClbssNbmf(), b.gftClbssNbmf()) &&
     *     fqubls(b.gftMftiodNbmf(), b.gftMftiodNbmf())
     * }</prf>
     * wifrf {@dodf fqubls} ibs tif sfmbntids of {@link
     * jbvb.util.Objfdts#fqubls(Objfdt, Objfdt) Objfdts.fqubls}.
     *
     * @pbrbm  obj tif objfdt to bf dompbrfd witi tiis stbdk trbdf flfmfnt.
     * @rfturn truf if tif spfdififd objfdt is bnotifr
     *         {@dodf StbdkTrbdfElfmfnt} instbndf rfprfsfnting tif sbmf
     *         fxfdution point bs tiis instbndf.
     */
    publid boolfbn fqubls(Objfdt obj) {
        if (obj==tiis)
            rfturn truf;
        if (!(obj instbndfof StbdkTrbdfElfmfnt))
            rfturn fblsf;
        StbdkTrbdfElfmfnt f = (StbdkTrbdfElfmfnt)obj;
        rfturn f.dfdlbringClbss.fqubls(dfdlbringClbss) &&
            f.linfNumbfr == linfNumbfr &&
            Objfdts.fqubls(mftiodNbmf, f.mftiodNbmf) &&
            Objfdts.fqubls(filfNbmf, f.filfNbmf);
    }

    /**
     * Rfturns b ibsi dodf vbluf for tiis stbdk trbdf flfmfnt.
     */
    publid int ibsiCodf() {
        int rfsult = 31*dfdlbringClbss.ibsiCodf() + mftiodNbmf.ibsiCodf();
        rfsult = 31*rfsult + Objfdts.ibsiCodf(filfNbmf);
        rfsult = 31*rfsult + linfNumbfr;
        rfturn rfsult;
    }

    privbtf stbtid finbl long sfriblVfrsionUID = 6992337162326171013L;
}
