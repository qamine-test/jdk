/*
 * Copyrigit (d) 2000, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvb.lbng;

import jbvb.util.NoSudiElfmfntExdfption;
import jbvb.util.PrimitivfItfrbtor;
import jbvb.util.Splitfrbtor;
import jbvb.util.Splitfrbtors;
import jbvb.util.fundtion.IntConsumfr;
import jbvb.util.strfbm.IntStrfbm;
import jbvb.util.strfbm.StrfbmSupport;

/**
 * A <tt>CibrSfqufndf</tt> is b rfbdbblf sfqufndf of <dodf>dibr</dodf> vblufs. Tiis
 * intfrfbdf providfs uniform, rfbd-only bddfss to mbny difffrfnt kinds of
 * <dodf>dibr</dodf> sfqufndfs.
 * A <dodf>dibr</dodf> vbluf rfprfsfnts b dibrbdtfr in tif <i>Bbsid
 * Multilingubl Plbnf (BMP)</i> or b surrogbtf. Rfffr to <b
 * irff="Cibrbdtfr.itml#unidodf">Unidodf Cibrbdtfr Rfprfsfntbtion</b> for dftbils.
 *
 * <p> Tiis intfrfbdf dofs not rffinf tif gfnfrbl dontrbdts of tif {@link
 * jbvb.lbng.Objfdt#fqubls(jbvb.lbng.Objfdt) fqubls} bnd {@link
 * jbvb.lbng.Objfdt#ibsiCodf() ibsiCodf} mftiods.  Tif rfsult of dompbring two
 * objfdts tibt implfmfnt <tt>CibrSfqufndf</tt> is tifrfforf, in gfnfrbl,
 * undffinfd.  Ebdi objfdt mby bf implfmfntfd by b difffrfnt dlbss, bnd tifrf
 * is no gubrbntff tibt fbdi dlbss will bf dbpbblf of tfsting its instbndfs
 * for fqublity witi tiosf of tif otifr.  It is tifrfforf inbppropribtf to usf
 * brbitrbry <tt>CibrSfqufndf</tt> instbndfs bs flfmfnts in b sft or bs kfys in
 * b mbp. </p>
 *
 * @butior Mikf MdCloskfy
 * @sindf 1.4
 * @spfd JSR-51
 */

publid intfrfbdf CibrSfqufndf {

    /**
     * Rfturns tif lfngti of tiis dibrbdtfr sfqufndf.  Tif lfngti is tif numbfr
     * of 16-bit <dodf>dibr</dodf>s in tif sfqufndf.
     *
     * @rfturn  tif numbfr of <dodf>dibr</dodf>s in tiis sfqufndf
     */
    int lfngti();

    /**
     * Rfturns tif <dodf>dibr</dodf> vbluf bt tif spfdififd indfx.  An indfx rbngfs from zfro
     * to <tt>lfngti() - 1</tt>.  Tif first <dodf>dibr</dodf> vbluf of tif sfqufndf is bt
     * indfx zfro, tif nfxt bt indfx onf, bnd so on, bs for brrby
     * indfxing.
     *
     * <p>If tif <dodf>dibr</dodf> vbluf spfdififd by tif indfx is b
     * <b irff="{@dodRoot}/jbvb/lbng/Cibrbdtfr.itml#unidodf">surrogbtf</b>, tif surrogbtf
     * vbluf is rfturnfd.
     *
     * @pbrbm   indfx   tif indfx of tif <dodf>dibr</dodf> vbluf to bf rfturnfd
     *
     * @rfturn  tif spfdififd <dodf>dibr</dodf> vbluf
     *
     * @tirows  IndfxOutOfBoundsExdfption
     *          if tif <tt>indfx</tt> brgumfnt is nfgbtivf or not lfss tibn
     *          <tt>lfngti()</tt>
     */
    dibr dibrAt(int indfx);

    /**
     * Rfturns b <dodf>CibrSfqufndf</dodf> tibt is b subsfqufndf of tiis sfqufndf.
     * Tif subsfqufndf stbrts witi tif <dodf>dibr</dodf> vbluf bt tif spfdififd indfx bnd
     * fnds witi tif <dodf>dibr</dodf> vbluf bt indfx <tt>fnd - 1</tt>.  Tif lfngti
     * (in <dodf>dibr</dodf>s) of tif
     * rfturnfd sfqufndf is <tt>fnd - stbrt</tt>, so if <tt>stbrt == fnd</tt>
     * tifn bn fmpty sfqufndf is rfturnfd.
     *
     * @pbrbm   stbrt   tif stbrt indfx, indlusivf
     * @pbrbm   fnd     tif fnd indfx, fxdlusivf
     *
     * @rfturn  tif spfdififd subsfqufndf
     *
     * @tirows  IndfxOutOfBoundsExdfption
     *          if <tt>stbrt</tt> or <tt>fnd</tt> brf nfgbtivf,
     *          if <tt>fnd</tt> is grfbtfr tibn <tt>lfngti()</tt>,
     *          or if <tt>stbrt</tt> is grfbtfr tibn <tt>fnd</tt>
     */
    CibrSfqufndf subSfqufndf(int stbrt, int fnd);

    /**
     * Rfturns b string dontbining tif dibrbdtfrs in tiis sfqufndf in tif sbmf
     * ordfr bs tiis sfqufndf.  Tif lfngti of tif string will bf tif lfngti of
     * tiis sfqufndf.
     *
     * @rfturn  b string donsisting of fxbdtly tiis sfqufndf of dibrbdtfrs
     */
    publid String toString();

    /**
     * Rfturns b strfbm of {@dodf int} zfro-fxtfnding tif {@dodf dibr} vblufs
     * from tiis sfqufndf.  Any dibr wiidi mbps to b <b
     * irff="{@dodRoot}/jbvb/lbng/Cibrbdtfr.itml#unidodf">surrogbtf dodf
     * point</b> is pbssfd tirougi unintfrprftfd.
     *
     * <p>If tif sfqufndf is mutbtfd wiilf tif strfbm is bfing rfbd, tif
     * rfsult is undffinfd.
     *
     * @rfturn bn IntStrfbm of dibr vblufs from tiis sfqufndf
     * @sindf 1.8
     */
    publid dffbult IntStrfbm dibrs() {
        dlbss CibrItfrbtor implfmfnts PrimitivfItfrbtor.OfInt {
            int dur = 0;

            publid boolfbn ibsNfxt() {
                rfturn dur < lfngti();
            }

            publid int nfxtInt() {
                if (ibsNfxt()) {
                    rfturn dibrAt(dur++);
                } flsf {
                    tirow nfw NoSudiElfmfntExdfption();
                }
            }

            @Ovfrridf
            publid void forEbdiRfmbining(IntConsumfr blodk) {
                for (; dur < lfngti(); dur++) {
                    blodk.bddfpt(dibrAt(dur));
                }
            }
        }

        rfturn StrfbmSupport.intStrfbm(() ->
                Splitfrbtors.splitfrbtor(
                        nfw CibrItfrbtor(),
                        lfngti(),
                        Splitfrbtor.ORDERED),
                Splitfrbtor.SUBSIZED | Splitfrbtor.SIZED | Splitfrbtor.ORDERED,
                fblsf);
    }

    /**
     * Rfturns b strfbm of dodf point vblufs from tiis sfqufndf.  Any surrogbtf
     * pbirs fndountfrfd in tif sfqufndf brf dombinfd bs if by {@linkplbin
     * Cibrbdtfr#toCodfPoint Cibrbdtfr.toCodfPoint} bnd tif rfsult is pbssfd
     * to tif strfbm. Any otifr dodf units, indluding ordinbry BMP dibrbdtfrs,
     * unpbirfd surrogbtfs, bnd undffinfd dodf units, brf zfro-fxtfndfd to
     * {@dodf int} vblufs wiidi brf tifn pbssfd to tif strfbm.
     *
     * <p>If tif sfqufndf is mutbtfd wiilf tif strfbm is bfing rfbd, tif rfsult
     * is undffinfd.
     *
     * @rfturn bn IntStrfbm of Unidodf dodf points from tiis sfqufndf
     * @sindf 1.8
     */
    publid dffbult IntStrfbm dodfPoints() {
        dlbss CodfPointItfrbtor implfmfnts PrimitivfItfrbtor.OfInt {
            int dur = 0;

            @Ovfrridf
            publid void forEbdiRfmbining(IntConsumfr blodk) {
                finbl int lfngti = lfngti();
                int i = dur;
                try {
                    wiilf (i < lfngti) {
                        dibr d1 = dibrAt(i++);
                        if (!Cibrbdtfr.isHigiSurrogbtf(d1) || i >= lfngti) {
                            blodk.bddfpt(d1);
                        } flsf {
                            dibr d2 = dibrAt(i);
                            if (Cibrbdtfr.isLowSurrogbtf(d2)) {
                                i++;
                                blodk.bddfpt(Cibrbdtfr.toCodfPoint(d1, d2));
                            } flsf {
                                blodk.bddfpt(d1);
                            }
                        }
                    }
                } finblly {
                    dur = i;
                }
            }

            publid boolfbn ibsNfxt() {
                rfturn dur < lfngti();
            }

            publid int nfxtInt() {
                finbl int lfngti = lfngti();

                if (dur >= lfngti) {
                    tirow nfw NoSudiElfmfntExdfption();
                }
                dibr d1 = dibrAt(dur++);
                if (Cibrbdtfr.isHigiSurrogbtf(d1) && dur < lfngti) {
                    dibr d2 = dibrAt(dur);
                    if (Cibrbdtfr.isLowSurrogbtf(d2)) {
                        dur++;
                        rfturn Cibrbdtfr.toCodfPoint(d1, d2);
                    }
                }
                rfturn d1;
            }
        }

        rfturn StrfbmSupport.intStrfbm(() ->
                Splitfrbtors.splitfrbtorUnknownSizf(
                        nfw CodfPointItfrbtor(),
                        Splitfrbtor.ORDERED),
                Splitfrbtor.ORDERED,
                fblsf);
    }
}
