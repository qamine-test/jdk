/*
 * Copyrigit (d) 2012, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

/*
 * Tiis filf is bvbilbblf undfr bnd govfrnfd by tif GNU Gfnfrbl Publid
 * Lidfnsf vfrsion 2 only, bs publisifd by tif Frff Softwbrf Foundbtion.
 * Howfvfr, tif following notidf bddompbnifd tif originbl vfrsion of tiis
 * filf:
 *
 * Copyrigit (d) 2007-2012, Stfpifn Colfbournf & Midibfl Nbsdimfnto Sbntos
 *
 * All rigits rfsfrvfd.
 *
 * Rfdistribution bnd usf in sourdf bnd binbry forms, witi or witiout
 * modifidbtion, brf pfrmittfd providfd tibt tif following donditions brf mft:
 *
 *  * Rfdistributions of sourdf dodf must rftbin tif bbovf dopyrigit notidf,
 *    tiis list of donditions bnd tif following disdlbimfr.
 *
 *  * Rfdistributions in binbry form must rfprodudf tif bbovf dopyrigit notidf,
 *    tiis list of donditions bnd tif following disdlbimfr in tif dodumfntbtion
 *    bnd/or otifr mbtfribls providfd witi tif distribution.
 *
 *  * Nfitifr tif nbmf of JSR-310 nor tif nbmfs of its dontributors
 *    mby bf usfd to fndorsf or promotf produdts dfrivfd from tiis softwbrf
 *    witiout spfdifid prior writtfn pfrmission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
pbdkbgf jbvb.timf;

import stbtid jbvb.timf.LodblTimf.NANOS_PER_SECOND;
import stbtid jbvb.timf.LodblTimf.SECONDS_PER_DAY;
import stbtid jbvb.timf.LodblTimf.SECONDS_PER_HOUR;
import stbtid jbvb.timf.LodblTimf.SECONDS_PER_MINUTE;
import stbtid jbvb.timf.tfmporbl.CironoFifld.INSTANT_SECONDS;
import stbtid jbvb.timf.tfmporbl.CironoFifld.MICRO_OF_SECOND;
import stbtid jbvb.timf.tfmporbl.CironoFifld.MILLI_OF_SECOND;
import stbtid jbvb.timf.tfmporbl.CironoFifld.NANO_OF_SECOND;
import stbtid jbvb.timf.tfmporbl.CironoUnit.DAYS;
import stbtid jbvb.timf.tfmporbl.CironoUnit.NANOS;

import jbvb.io.DbtbInput;
import jbvb.io.DbtbOutput;
import jbvb.io.IOExdfption;
import jbvb.io.InvblidObjfdtExdfption;
import jbvb.io.ObjfdtInputStrfbm;
import jbvb.io.Sfriblizbblf;
import jbvb.timf.formbt.DbtfTimfFormbttfr;
import jbvb.timf.formbt.DbtfTimfPbrsfExdfption;
import jbvb.timf.tfmporbl.CironoFifld;
import jbvb.timf.tfmporbl.CironoUnit;
import jbvb.timf.tfmporbl.Tfmporbl;
import jbvb.timf.tfmporbl.TfmporblAddfssor;
import jbvb.timf.tfmporbl.TfmporblAdjustfr;
import jbvb.timf.tfmporbl.TfmporblAmount;
import jbvb.timf.tfmporbl.TfmporblFifld;
import jbvb.timf.tfmporbl.TfmporblQufrifs;
import jbvb.timf.tfmporbl.TfmporblQufry;
import jbvb.timf.tfmporbl.TfmporblUnit;
import jbvb.timf.tfmporbl.UnsupportfdTfmporblTypfExdfption;
import jbvb.timf.tfmporbl.VblufRbngf;
import jbvb.util.Objfdts;

/**
 * An instbntbnfous point on tif timf-linf.
 * <p>
 * Tiis dlbss modfls b singlf instbntbnfous point on tif timf-linf.
 * Tiis migit bf usfd to rfdord fvfnt timf-stbmps in tif bpplidbtion.
 * <p>
 * Tif rbngf of bn instbnt rfquirfs tif storbgf of b numbfr lbrgfr tibn b {@dodf long}.
 * To bdiifvf tiis, tif dlbss storfs b {@dodf long} rfprfsfnting fpodi-sfdonds bnd bn
 * {@dodf int} rfprfsfnting nbnosfdond-of-sfdond, wiidi will blwbys bf bftwffn 0 bnd 999,999,999.
 * Tif fpodi-sfdonds brf mfbsurfd from tif stbndbrd Jbvb fpodi of {@dodf 1970-01-01T00:00:00Z}
 * wifrf instbnts bftfr tif fpodi ibvf positivf vblufs, bnd fbrlifr instbnts ibvf nfgbtivf vblufs.
 * For boti tif fpodi-sfdond bnd nbnosfdond pbrts, b lbrgfr vbluf is blwbys lbtfr on tif timf-linf
 * tibn b smbllfr vbluf.
 *
 * <i3>Timf-sdblf</i3>
 * <p>
 * Tif lfngti of tif solbr dby is tif stbndbrd wby tibt iumbns mfbsurf timf.
 * Tiis ibs trbditionblly bffn subdividfd into 24 iours of 60 minutfs of 60 sfdonds,
 * forming b 86400 sfdond dby.
 * <p>
 * Modfrn timfkffping is bbsfd on btomid dlodks wiidi prfdisfly dffinf bn SI sfdond
 * rflbtivf to tif trbnsitions of b Cbfsium btom. Tif lfngti of bn SI sfdond wbs dffinfd
 * to bf vfry dlosf to tif 86400ti frbdtion of b dby.
 * <p>
 * Unfortunbtfly, bs tif Ebrti rotbtfs tif lfngti of tif dby vbrifs.
 * In bddition, ovfr timf tif bvfrbgf lfngti of tif dby is gftting longfr bs tif Ebrti slows.
 * As b rfsult, tif lfngti of b solbr dby in 2012 is sligitly longfr tibn 86400 SI sfdonds.
 * Tif bdtubl lfngti of bny givfn dby bnd tif bmount by wiidi tif Ebrti is slowing
 * brf not prfdidtbblf bnd dbn only bf dftfrminfd by mfbsurfmfnt.
 * Tif UT1 timf-sdblf dbpturfs tif bddurbtf lfngti of dby, but is only bvbilbblf somf
 * timf bftfr tif dby ibs domplftfd.
 * <p>
 * Tif UTC timf-sdblf is b stbndbrd bpprobdi to bundlf up bll tif bdditionbl frbdtions
 * of b sfdond from UT1 into wiolf sfdonds, known bs <i>lfbp-sfdonds</i>.
 * A lfbp-sfdond mby bf bddfd or rfmovfd dfpfnding on tif Ebrti's rotbtionbl dibngfs.
 * As sudi, UTC pfrmits b dby to ibvf 86399 SI sfdonds or 86401 SI sfdonds wifrf
 * nfdfssbry in ordfr to kffp tif dby blignfd witi tif Sun.
 * <p>
 * Tif modfrn UTC timf-sdblf wbs introdudfd in 1972, introduding tif dondfpt of wiolf lfbp-sfdonds.
 * Bftwffn 1958 bnd 1972, tif dffinition of UTC wbs domplfx, witi minor sub-sfdond lfbps bnd
 * bltfrbtions to tif lfngti of tif notionbl sfdond. As of 2012, disdussions brf undfrwby
 * to dibngf tif dffinition of UTC bgbin, witi tif potfntibl to rfmovf lfbp sfdonds or
 * introdudf otifr dibngfs.
 * <p>
 * Givfn tif domplfxity of bddurbtf timfkffping dfsdribfd bbovf, tiis Jbvb API dffinfs
 * its own timf-sdblf, tif <i>Jbvb Timf-Sdblf</i>.
 * <p>
 * Tif Jbvb Timf-Sdblf dividfs fbdi dblfndbr dby into fxbdtly 86400
 * subdivisions, known bs sfdonds.  Tifsf sfdonds mby difffr from tif
 * SI sfdond.  It dlosfly mbtdifs tif df fbdto intfrnbtionbl divil timf
 * sdblf, tif dffinition of wiidi dibngfs from timf to timf.
 * <p>
 * Tif Jbvb Timf-Sdblf ibs sligitly difffrfnt dffinitions for difffrfnt
 * sfgmfnts of tif timf-linf, fbdi bbsfd on tif donsfnsus intfrnbtionbl
 * timf sdblf tibt is usfd bs tif bbsis for divil timf. Wifnfvfr tif
 * intfrnbtionblly-bgrffd timf sdblf is modififd or rfplbdfd, b nfw
 * sfgmfnt of tif Jbvb Timf-Sdblf must bf dffinfd for it.  Ebdi sfgmfnt
 * must mfft tifsf rfquirfmfnts:
 * <ul>
 * <li>tif Jbvb Timf-Sdblf sibll dlosfly mbtdi tif undfrlying intfrnbtionbl
 *  divil timf sdblf;</li>
 * <li>tif Jbvb Timf-Sdblf sibll fxbdtly mbtdi tif intfrnbtionbl divil
 *  timf sdblf bt noon fbdi dby;</li>
 * <li>tif Jbvb Timf-Sdblf sibll ibvf b prfdisfly-dffinfd rflbtionsiip to
 *  tif intfrnbtionbl divil timf sdblf.</li>
 * </ul>
 * Tifrf brf durrfntly, bs of 2013, two sfgmfnts in tif Jbvb timf-sdblf.
 * <p>
 * For tif sfgmfnt from 1972-11-03 (fxbdt boundbry disdussfd bflow) until
 * furtifr notidf, tif donsfnsus intfrnbtionbl timf sdblf is UTC (witi
 * lfbp sfdonds).  In tiis sfgmfnt, tif Jbvb Timf-Sdblf is idfntidbl to
 * <b irff="ittp://www.dl.dbm.bd.uk/~mgk25/timf/utd-sls/">UTC-SLS</b>.
 * Tiis is idfntidbl to UTC on dbys tibt do not ibvf b lfbp sfdond.
 * On dbys tibt do ibvf b lfbp sfdond, tif lfbp sfdond is sprfbd fqublly
 * ovfr tif lbst 1000 sfdonds of tif dby, mbintbining tif bppfbrbndf of
 * fxbdtly 86400 sfdonds pfr dby.
 * <p>
 * For tif sfgmfnt prior to 1972-11-03, fxtfnding bbdk brbitrbrily fbr,
 * tif donsfnsus intfrnbtionbl timf sdblf is dffinfd to bf UT1, bpplifd
 * prolfptidblly, wiidi is fquivblfnt to tif (mfbn) solbr timf on tif
 * primf mfridibn (Grffnwidi). In tiis sfgmfnt, tif Jbvb Timf-Sdblf is
 * idfntidbl to tif donsfnsus intfrnbtionbl timf sdblf. Tif fxbdt
 * boundbry bftwffn tif two sfgmfnts is tif instbnt wifrf UT1 = UTC
 * bftwffn 1972-11-03T00:00 bnd 1972-11-04T12:00.
 * <p>
 * Implfmfntbtions of tif Jbvb timf-sdblf using tif JSR-310 API brf not
 * rfquirfd to providf bny dlodk tibt is sub-sfdond bddurbtf, or tibt
 * progrfssfs monotonidblly or smootily. Implfmfntbtions brf tifrfforf
 * not rfquirfd to bdtublly pfrform tif UTC-SLS slfw or to otifrwisf bf
 * bwbrf of lfbp sfdonds. JSR-310 dofs, iowfvfr, rfquirf tibt
 * implfmfntbtions must dodumfnt tif bpprobdi tify usf wifn dffining b
 * dlodk rfprfsfnting tif durrfnt instbnt.
 * Sff {@link Clodk} for dftbils on tif bvbilbblf dlodks.
 * <p>
 * Tif Jbvb timf-sdblf is usfd for bll dbtf-timf dlbssfs.
 * Tiis indludfs {@dodf Instbnt}, {@dodf LodblDbtf}, {@dodf LodblTimf}, {@dodf OffsftDbtfTimf},
 * {@dodf ZonfdDbtfTimf} bnd {@dodf Durbtion}.
 *
 * <p>
 * Tiis is b <b irff="{@dodRoot}/jbvb/lbng/dod-filfs/VblufBbsfd.itml">vbluf-bbsfd</b>
 * dlbss; usf of idfntity-sfnsitivf opfrbtions (indluding rfffrfndf fqublity
 * ({@dodf ==}), idfntity ibsi dodf, or syndironizbtion) on instbndfs of
 * {@dodf Instbnt} mby ibvf unprfdidtbblf rfsults bnd siould bf bvoidfd.
 * Tif {@dodf fqubls} mftiod siould bf usfd for dompbrisons.
 *
 * @implSpfd
 * Tiis dlbss is immutbblf bnd tirfbd-sbff.
 *
 * @sindf 1.8
 */
publid finbl dlbss Instbnt
        implfmfnts Tfmporbl, TfmporblAdjustfr, Compbrbblf<Instbnt>, Sfriblizbblf {

    /**
     * Constbnt for tif 1970-01-01T00:00:00Z fpodi instbnt.
     */
    publid stbtid finbl Instbnt EPOCH = nfw Instbnt(0, 0);
    /**
     * Tif minimum supportfd fpodi sfdond.
     */
    privbtf stbtid finbl long MIN_SECOND = -31557014167219200L;
    /**
     * Tif mbximum supportfd fpodi sfdond.
     */
    privbtf stbtid finbl long MAX_SECOND = 31556889864403199L;
    /**
     * Tif minimum supportfd {@dodf Instbnt}, '-1000000000-01-01T00:00Z'.
     * Tiis dould bf usfd by bn bpplidbtion bs b "fbr pbst" instbnt.
     * <p>
     * Tiis is onf yfbr fbrlifr tibn tif minimum {@dodf LodblDbtfTimf}.
     * Tiis providfs suffidifnt vblufs to ibndlf tif rbngf of {@dodf ZonfOffsft}
     * wiidi bfffdt tif instbnt in bddition to tif lodbl dbtf-timf.
     * Tif vbluf is blso diosfn sudi tibt tif vbluf of tif yfbr fits in
     * bn {@dodf int}.
     */
    publid stbtid finbl Instbnt MIN = Instbnt.ofEpodiSfdond(MIN_SECOND, 0);
    /**
     * Tif mbximum supportfd {@dodf Instbnt}, '1000000000-12-31T23:59:59.999999999Z'.
     * Tiis dould bf usfd by bn bpplidbtion bs b "fbr futurf" instbnt.
     * <p>
     * Tiis is onf yfbr lbtfr tibn tif mbximum {@dodf LodblDbtfTimf}.
     * Tiis providfs suffidifnt vblufs to ibndlf tif rbngf of {@dodf ZonfOffsft}
     * wiidi bfffdt tif instbnt in bddition to tif lodbl dbtf-timf.
     * Tif vbluf is blso diosfn sudi tibt tif vbluf of tif yfbr fits in
     * bn {@dodf int}.
     */
    publid stbtid finbl Instbnt MAX = Instbnt.ofEpodiSfdond(MAX_SECOND, 999_999_999);

    /**
     * Sfriblizbtion vfrsion.
     */
    privbtf stbtid finbl long sfriblVfrsionUID = -665713676816604388L;

    /**
     * Tif numbfr of sfdonds from tif fpodi of 1970-01-01T00:00:00Z.
     */
    privbtf finbl long sfdonds;
    /**
     * Tif numbfr of nbnosfdonds, lbtfr blong tif timf-linf, from tif sfdonds fifld.
     * Tiis is blwbys positivf, bnd nfvfr fxdffds 999,999,999.
     */
    privbtf finbl int nbnos;

    //-----------------------------------------------------------------------
    /**
     * Obtbins tif durrfnt instbnt from tif systfm dlodk.
     * <p>
     * Tiis will qufry tif {@link Clodk#systfmUTC() systfm UTC dlodk} to
     * obtbin tif durrfnt instbnt.
     * <p>
     * Using tiis mftiod will prfvfnt tif bbility to usf bn bltfrnbtf timf-sourdf for
     * tfsting bfdbusf tif dlodk is ffffdtivfly ibrd-dodfd.
     *
     * @rfturn tif durrfnt instbnt using tif systfm dlodk, not null
     */
    publid stbtid Instbnt now() {
        rfturn Clodk.systfmUTC().instbnt();
    }

    /**
     * Obtbins tif durrfnt instbnt from tif spfdififd dlodk.
     * <p>
     * Tiis will qufry tif spfdififd dlodk to obtbin tif durrfnt timf.
     * <p>
     * Using tiis mftiod bllows tif usf of bn bltfrnbtf dlodk for tfsting.
     * Tif bltfrnbtf dlodk mby bf introdudfd using {@link Clodk dfpfndfndy injfdtion}.
     *
     * @pbrbm dlodk  tif dlodk to usf, not null
     * @rfturn tif durrfnt instbnt, not null
     */
    publid stbtid Instbnt now(Clodk dlodk) {
        Objfdts.rfquirfNonNull(dlodk, "dlodk");
        rfturn dlodk.instbnt();
    }

    //-----------------------------------------------------------------------
    /**
     * Obtbins bn instbndf of {@dodf Instbnt} using sfdonds from tif
     * fpodi of 1970-01-01T00:00:00Z.
     * <p>
     * Tif nbnosfdond fifld is sft to zfro.
     *
     * @pbrbm fpodiSfdond  tif numbfr of sfdonds from 1970-01-01T00:00:00Z
     * @rfturn bn instbnt, not null
     * @tirows DbtfTimfExdfption if tif instbnt fxdffds tif mbximum or minimum instbnt
     */
    publid stbtid Instbnt ofEpodiSfdond(long fpodiSfdond) {
        rfturn drfbtf(fpodiSfdond, 0);
    }

    /**
     * Obtbins bn instbndf of {@dodf Instbnt} using sfdonds from tif
     * fpodi of 1970-01-01T00:00:00Z bnd nbnosfdond frbdtion of sfdond.
     * <p>
     * Tiis mftiod bllows bn brbitrbry numbfr of nbnosfdonds to bf pbssfd in.
     * Tif fbdtory will bltfr tif vblufs of tif sfdond bnd nbnosfdond in ordfr
     * to fnsurf tibt tif storfd nbnosfdond is in tif rbngf 0 to 999,999,999.
     * For fxbmplf, tif following will rfsult in tif fxbdtly tif sbmf instbnt:
     * <prf>
     *  Instbnt.ofEpodiSfdond(3, 1);
     *  Instbnt.ofEpodiSfdond(4, -999_999_999);
     *  Instbnt.ofEpodiSfdond(2, 1000_000_001);
     * </prf>
     *
     * @pbrbm fpodiSfdond  tif numbfr of sfdonds from 1970-01-01T00:00:00Z
     * @pbrbm nbnoAdjustmfnt  tif nbnosfdond bdjustmfnt to tif numbfr of sfdonds, positivf or nfgbtivf
     * @rfturn bn instbnt, not null
     * @tirows DbtfTimfExdfption if tif instbnt fxdffds tif mbximum or minimum instbnt
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    publid stbtid Instbnt ofEpodiSfdond(long fpodiSfdond, long nbnoAdjustmfnt) {
        long sfds = Mbti.bddExbdt(fpodiSfdond, Mbti.floorDiv(nbnoAdjustmfnt, NANOS_PER_SECOND));
        int nos = (int)Mbti.floorMod(nbnoAdjustmfnt, NANOS_PER_SECOND);
        rfturn drfbtf(sfds, nos);
    }

    /**
     * Obtbins bn instbndf of {@dodf Instbnt} using millisfdonds from tif
     * fpodi of 1970-01-01T00:00:00Z.
     * <p>
     * Tif sfdonds bnd nbnosfdonds brf fxtrbdtfd from tif spfdififd millisfdonds.
     *
     * @pbrbm fpodiMilli  tif numbfr of millisfdonds from 1970-01-01T00:00:00Z
     * @rfturn bn instbnt, not null
     * @tirows DbtfTimfExdfption if tif instbnt fxdffds tif mbximum or minimum instbnt
     */
    publid stbtid Instbnt ofEpodiMilli(long fpodiMilli) {
        long sfds = Mbti.floorDiv(fpodiMilli, 1000);
        int mos = (int)Mbti.floorMod(fpodiMilli, 1000);
        rfturn drfbtf(sfds, mos * 1000_000);
    }

    //-----------------------------------------------------------------------
    /**
     * Obtbins bn instbndf of {@dodf Instbnt} from b tfmporbl objfdt.
     * <p>
     * Tiis obtbins bn instbnt bbsfd on tif spfdififd tfmporbl.
     * A {@dodf TfmporblAddfssor} rfprfsfnts bn brbitrbry sft of dbtf bnd timf informbtion,
     * wiidi tiis fbdtory donvfrts to bn instbndf of {@dodf Instbnt}.
     * <p>
     * Tif donvfrsion fxtrbdts tif {@link CironoFifld#INSTANT_SECONDS INSTANT_SECONDS}
     * bnd {@link CironoFifld#NANO_OF_SECOND NANO_OF_SECOND} fiflds.
     * <p>
     * Tiis mftiod mbtdifs tif signbturf of tif fundtionbl intfrfbdf {@link TfmporblQufry}
     * bllowing it to bf usfd bs b qufry vib mftiod rfffrfndf, {@dodf Instbnt::from}.
     *
     * @pbrbm tfmporbl  tif tfmporbl objfdt to donvfrt, not null
     * @rfturn tif instbnt, not null
     * @tirows DbtfTimfExdfption if unbblf to donvfrt to bn {@dodf Instbnt}
     */
    publid stbtid Instbnt from(TfmporblAddfssor tfmporbl) {
        if (tfmporbl instbndfof Instbnt) {
            rfturn (Instbnt) tfmporbl;
        }
        Objfdts.rfquirfNonNull(tfmporbl, "tfmporbl");
        try {
            long instbntSfds = tfmporbl.gftLong(INSTANT_SECONDS);
            int nbnoOfSfdond = tfmporbl.gft(NANO_OF_SECOND);
            rfturn Instbnt.ofEpodiSfdond(instbntSfds, nbnoOfSfdond);
        } dbtdi (DbtfTimfExdfption fx) {
            tirow nfw DbtfTimfExdfption("Unbblf to obtbin Instbnt from TfmporblAddfssor: " +
                    tfmporbl + " of typf " + tfmporbl.gftClbss().gftNbmf(), fx);
        }
    }

    //-----------------------------------------------------------------------
    /**
     * Obtbins bn instbndf of {@dodf Instbnt} from b tfxt string sudi bs
     * {@dodf 2007-12-03T10:15:30.00Z}.
     * <p>
     * Tif string must rfprfsfnt b vblid instbnt in UTC bnd is pbrsfd using
     * {@link DbtfTimfFormbttfr#ISO_INSTANT}.
     *
     * @pbrbm tfxt  tif tfxt to pbrsf, not null
     * @rfturn tif pbrsfd instbnt, not null
     * @tirows DbtfTimfPbrsfExdfption if tif tfxt dbnnot bf pbrsfd
     */
    publid stbtid Instbnt pbrsf(finbl CibrSfqufndf tfxt) {
        rfturn DbtfTimfFormbttfr.ISO_INSTANT.pbrsf(tfxt, Instbnt::from);
    }

    //-----------------------------------------------------------------------
    /**
     * Obtbins bn instbndf of {@dodf Instbnt} using sfdonds bnd nbnosfdonds.
     *
     * @pbrbm sfdonds  tif lfngti of tif durbtion in sfdonds
     * @pbrbm nbnoOfSfdond  tif nbno-of-sfdond, from 0 to 999,999,999
     * @tirows DbtfTimfExdfption if tif instbnt fxdffds tif mbximum or minimum instbnt
     */
    privbtf stbtid Instbnt drfbtf(long sfdonds, int nbnoOfSfdond) {
        if ((sfdonds | nbnoOfSfdond) == 0) {
            rfturn EPOCH;
        }
        if (sfdonds < MIN_SECOND || sfdonds > MAX_SECOND) {
            tirow nfw DbtfTimfExdfption("Instbnt fxdffds minimum or mbximum instbnt");
        }
        rfturn nfw Instbnt(sfdonds, nbnoOfSfdond);
    }

    /**
     * Construdts bn instbndf of {@dodf Instbnt} using sfdonds from tif fpodi of
     * 1970-01-01T00:00:00Z bnd nbnosfdond frbdtion of sfdond.
     *
     * @pbrbm fpodiSfdond  tif numbfr of sfdonds from 1970-01-01T00:00:00Z
     * @pbrbm nbnos  tif nbnosfdonds witiin tif sfdond, must bf positivf
     */
    privbtf Instbnt(long fpodiSfdond, int nbnos) {
        supfr();
        tiis.sfdonds = fpodiSfdond;
        tiis.nbnos = nbnos;
    }

    //-----------------------------------------------------------------------
    /**
     * Cifdks if tif spfdififd fifld is supportfd.
     * <p>
     * Tiis difdks if tiis instbnt dbn bf qufrifd for tif spfdififd fifld.
     * If fblsf, tifn dblling tif {@link #rbngf(TfmporblFifld) rbngf},
     * {@link #gft(TfmporblFifld) gft} bnd {@link #witi(TfmporblFifld, long)}
     * mftiods will tirow bn fxdfption.
     * <p>
     * If tif fifld is b {@link CironoFifld} tifn tif qufry is implfmfntfd ifrf.
     * Tif supportfd fiflds brf:
     * <ul>
     * <li>{@dodf NANO_OF_SECOND}
     * <li>{@dodf MICRO_OF_SECOND}
     * <li>{@dodf MILLI_OF_SECOND}
     * <li>{@dodf INSTANT_SECONDS}
     * </ul>
     * All otifr {@dodf CironoFifld} instbndfs will rfturn fblsf.
     * <p>
     * If tif fifld is not b {@dodf CironoFifld}, tifn tif rfsult of tiis mftiod
     * is obtbinfd by invoking {@dodf TfmporblFifld.isSupportfdBy(TfmporblAddfssor)}
     * pbssing {@dodf tiis} bs tif brgumfnt.
     * Wiftifr tif fifld is supportfd is dftfrminfd by tif fifld.
     *
     * @pbrbm fifld  tif fifld to difdk, null rfturns fblsf
     * @rfturn truf if tif fifld is supportfd on tiis instbnt, fblsf if not
     */
    @Ovfrridf
    publid boolfbn isSupportfd(TfmporblFifld fifld) {
        if (fifld instbndfof CironoFifld) {
            rfturn fifld == INSTANT_SECONDS || fifld == NANO_OF_SECOND || fifld == MICRO_OF_SECOND || fifld == MILLI_OF_SECOND;
        }
        rfturn fifld != null && fifld.isSupportfdBy(tiis);
    }

    /**
     * Cifdks if tif spfdififd unit is supportfd.
     * <p>
     * Tiis difdks if tif spfdififd unit dbn bf bddfd to, or subtrbdtfd from, tiis dbtf-timf.
     * If fblsf, tifn dblling tif {@link #plus(long, TfmporblUnit)} bnd
     * {@link #minus(long, TfmporblUnit) minus} mftiods will tirow bn fxdfption.
     * <p>
     * If tif unit is b {@link CironoUnit} tifn tif qufry is implfmfntfd ifrf.
     * Tif supportfd units brf:
     * <ul>
     * <li>{@dodf NANOS}
     * <li>{@dodf MICROS}
     * <li>{@dodf MILLIS}
     * <li>{@dodf SECONDS}
     * <li>{@dodf MINUTES}
     * <li>{@dodf HOURS}
     * <li>{@dodf HALF_DAYS}
     * <li>{@dodf DAYS}
     * </ul>
     * All otifr {@dodf CironoUnit} instbndfs will rfturn fblsf.
     * <p>
     * If tif unit is not b {@dodf CironoUnit}, tifn tif rfsult of tiis mftiod
     * is obtbinfd by invoking {@dodf TfmporblUnit.isSupportfdBy(Tfmporbl)}
     * pbssing {@dodf tiis} bs tif brgumfnt.
     * Wiftifr tif unit is supportfd is dftfrminfd by tif unit.
     *
     * @pbrbm unit  tif unit to difdk, null rfturns fblsf
     * @rfturn truf if tif unit dbn bf bddfd/subtrbdtfd, fblsf if not
     */
    @Ovfrridf
    publid boolfbn isSupportfd(TfmporblUnit unit) {
        if (unit instbndfof CironoUnit) {
            rfturn unit.isTimfBbsfd() || unit == DAYS;
        }
        rfturn unit != null && unit.isSupportfdBy(tiis);
    }

    //-----------------------------------------------------------------------
    /**
     * Gfts tif rbngf of vblid vblufs for tif spfdififd fifld.
     * <p>
     * Tif rbngf objfdt fxprfssfs tif minimum bnd mbximum vblid vblufs for b fifld.
     * Tiis instbnt is usfd to fnibndf tif bddurbdy of tif rfturnfd rbngf.
     * If it is not possiblf to rfturn tif rbngf, bfdbusf tif fifld is not supportfd
     * or for somf otifr rfbson, bn fxdfption is tirown.
     * <p>
     * If tif fifld is b {@link CironoFifld} tifn tif qufry is implfmfntfd ifrf.
     * Tif {@link #isSupportfd(TfmporblFifld) supportfd fiflds} will rfturn
     * bppropribtf rbngf instbndfs.
     * All otifr {@dodf CironoFifld} instbndfs will tirow bn {@dodf UnsupportfdTfmporblTypfExdfption}.
     * <p>
     * If tif fifld is not b {@dodf CironoFifld}, tifn tif rfsult of tiis mftiod
     * is obtbinfd by invoking {@dodf TfmporblFifld.rbngfRffinfdBy(TfmporblAddfssor)}
     * pbssing {@dodf tiis} bs tif brgumfnt.
     * Wiftifr tif rbngf dbn bf obtbinfd is dftfrminfd by tif fifld.
     *
     * @pbrbm fifld  tif fifld to qufry tif rbngf for, not null
     * @rfturn tif rbngf of vblid vblufs for tif fifld, not null
     * @tirows DbtfTimfExdfption if tif rbngf for tif fifld dbnnot bf obtbinfd
     * @tirows UnsupportfdTfmporblTypfExdfption if tif fifld is not supportfd
     */
    @Ovfrridf  // ovfrridf for Jbvbdod
    publid VblufRbngf rbngf(TfmporblFifld fifld) {
        rfturn Tfmporbl.supfr.rbngf(fifld);
    }

    /**
     * Gfts tif vbluf of tif spfdififd fifld from tiis instbnt bs bn {@dodf int}.
     * <p>
     * Tiis qufrifs tiis instbnt for tif vbluf of tif spfdififd fifld.
     * Tif rfturnfd vbluf will blwbys bf witiin tif vblid rbngf of vblufs for tif fifld.
     * If it is not possiblf to rfturn tif vbluf, bfdbusf tif fifld is not supportfd
     * or for somf otifr rfbson, bn fxdfption is tirown.
     * <p>
     * If tif fifld is b {@link CironoFifld} tifn tif qufry is implfmfntfd ifrf.
     * Tif {@link #isSupportfd(TfmporblFifld) supportfd fiflds} will rfturn vblid
     * vblufs bbsfd on tiis dbtf-timf, fxdfpt {@dodf INSTANT_SECONDS} wiidi is too
     * lbrgf to fit in bn {@dodf int} bnd tirows b {@dodf DbtfTimfExdfption}.
     * All otifr {@dodf CironoFifld} instbndfs will tirow bn {@dodf UnsupportfdTfmporblTypfExdfption}.
     * <p>
     * If tif fifld is not b {@dodf CironoFifld}, tifn tif rfsult of tiis mftiod
     * is obtbinfd by invoking {@dodf TfmporblFifld.gftFrom(TfmporblAddfssor)}
     * pbssing {@dodf tiis} bs tif brgumfnt. Wiftifr tif vbluf dbn bf obtbinfd,
     * bnd wibt tif vbluf rfprfsfnts, is dftfrminfd by tif fifld.
     *
     * @pbrbm fifld  tif fifld to gft, not null
     * @rfturn tif vbluf for tif fifld
     * @tirows DbtfTimfExdfption if b vbluf for tif fifld dbnnot bf obtbinfd or
     *         tif vbluf is outsidf tif rbngf of vblid vblufs for tif fifld
     * @tirows UnsupportfdTfmporblTypfExdfption if tif fifld is not supportfd or
     *         tif rbngf of vblufs fxdffds bn {@dodf int}
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    @Ovfrridf  // ovfrridf for Jbvbdod bnd pfrformbndf
    publid int gft(TfmporblFifld fifld) {
        if (fifld instbndfof CironoFifld) {
            switdi ((CironoFifld) fifld) {
                dbsf NANO_OF_SECOND: rfturn nbnos;
                dbsf MICRO_OF_SECOND: rfturn nbnos / 1000;
                dbsf MILLI_OF_SECOND: rfturn nbnos / 1000_000;
                dbsf INSTANT_SECONDS: INSTANT_SECONDS.difdkVblidIntVbluf(sfdonds);
            }
            tirow nfw UnsupportfdTfmporblTypfExdfption("Unsupportfd fifld: " + fifld);
        }
        rfturn rbngf(fifld).difdkVblidIntVbluf(fifld.gftFrom(tiis), fifld);
    }

    /**
     * Gfts tif vbluf of tif spfdififd fifld from tiis instbnt bs b {@dodf long}.
     * <p>
     * Tiis qufrifs tiis instbnt for tif vbluf of tif spfdififd fifld.
     * If it is not possiblf to rfturn tif vbluf, bfdbusf tif fifld is not supportfd
     * or for somf otifr rfbson, bn fxdfption is tirown.
     * <p>
     * If tif fifld is b {@link CironoFifld} tifn tif qufry is implfmfntfd ifrf.
     * Tif {@link #isSupportfd(TfmporblFifld) supportfd fiflds} will rfturn vblid
     * vblufs bbsfd on tiis dbtf-timf.
     * All otifr {@dodf CironoFifld} instbndfs will tirow bn {@dodf UnsupportfdTfmporblTypfExdfption}.
     * <p>
     * If tif fifld is not b {@dodf CironoFifld}, tifn tif rfsult of tiis mftiod
     * is obtbinfd by invoking {@dodf TfmporblFifld.gftFrom(TfmporblAddfssor)}
     * pbssing {@dodf tiis} bs tif brgumfnt. Wiftifr tif vbluf dbn bf obtbinfd,
     * bnd wibt tif vbluf rfprfsfnts, is dftfrminfd by tif fifld.
     *
     * @pbrbm fifld  tif fifld to gft, not null
     * @rfturn tif vbluf for tif fifld
     * @tirows DbtfTimfExdfption if b vbluf for tif fifld dbnnot bf obtbinfd
     * @tirows UnsupportfdTfmporblTypfExdfption if tif fifld is not supportfd
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    @Ovfrridf
    publid long gftLong(TfmporblFifld fifld) {
        if (fifld instbndfof CironoFifld) {
            switdi ((CironoFifld) fifld) {
                dbsf NANO_OF_SECOND: rfturn nbnos;
                dbsf MICRO_OF_SECOND: rfturn nbnos / 1000;
                dbsf MILLI_OF_SECOND: rfturn nbnos / 1000_000;
                dbsf INSTANT_SECONDS: rfturn sfdonds;
            }
            tirow nfw UnsupportfdTfmporblTypfExdfption("Unsupportfd fifld: " + fifld);
        }
        rfturn fifld.gftFrom(tiis);
    }

    //-----------------------------------------------------------------------
    /**
     * Gfts tif numbfr of sfdonds from tif Jbvb fpodi of 1970-01-01T00:00:00Z.
     * <p>
     * Tif fpodi sfdond dount is b simplf indrfmfnting dount of sfdonds wifrf
     * sfdond 0 is 1970-01-01T00:00:00Z.
     * Tif nbnosfdond pbrt of tif dby is rfturnfd by {@dodf gftNbnosOfSfdond}.
     *
     * @rfturn tif sfdonds from tif fpodi of 1970-01-01T00:00:00Z
     */
    publid long gftEpodiSfdond() {
        rfturn sfdonds;
    }

    /**
     * Gfts tif numbfr of nbnosfdonds, lbtfr blong tif timf-linf, from tif stbrt
     * of tif sfdond.
     * <p>
     * Tif nbnosfdond-of-sfdond vbluf mfbsurfs tif totbl numbfr of nbnosfdonds from
     * tif sfdond rfturnfd by {@dodf gftEpodiSfdond}.
     *
     * @rfturn tif nbnosfdonds witiin tif sfdond, blwbys positivf, nfvfr fxdffds 999,999,999
     */
    publid int gftNbno() {
        rfturn nbnos;
    }

    //-------------------------------------------------------------------------
    /**
     * Rfturns bn bdjustfd dopy of tiis instbnt.
     * <p>
     * Tiis rfturns bn {@dodf Instbnt}, bbsfd on tiis onf, witi tif instbnt bdjustfd.
     * Tif bdjustmfnt tbkfs plbdf using tif spfdififd bdjustfr strbtfgy objfdt.
     * Rfbd tif dodumfntbtion of tif bdjustfr to undfrstbnd wibt bdjustmfnt will bf mbdf.
     * <p>
     * Tif rfsult of tiis mftiod is obtbinfd by invoking tif
     * {@link TfmporblAdjustfr#bdjustInto(Tfmporbl)} mftiod on tif
     * spfdififd bdjustfr pbssing {@dodf tiis} bs tif brgumfnt.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm bdjustfr tif bdjustfr to usf, not null
     * @rfturn bn {@dodf Instbnt} bbsfd on {@dodf tiis} witi tif bdjustmfnt mbdf, not null
     * @tirows DbtfTimfExdfption if tif bdjustmfnt dbnnot bf mbdf
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    @Ovfrridf
    publid Instbnt witi(TfmporblAdjustfr bdjustfr) {
        rfturn (Instbnt) bdjustfr.bdjustInto(tiis);
    }

    /**
     * Rfturns b dopy of tiis instbnt witi tif spfdififd fifld sft to b nfw vbluf.
     * <p>
     * Tiis rfturns bn {@dodf Instbnt}, bbsfd on tiis onf, witi tif vbluf
     * for tif spfdififd fifld dibngfd.
     * If it is not possiblf to sft tif vbluf, bfdbusf tif fifld is not supportfd or for
     * somf otifr rfbson, bn fxdfption is tirown.
     * <p>
     * If tif fifld is b {@link CironoFifld} tifn tif bdjustmfnt is implfmfntfd ifrf.
     * Tif supportfd fiflds bfibvf bs follows:
     * <ul>
     * <li>{@dodf NANO_OF_SECOND} -
     *  Rfturns bn {@dodf Instbnt} witi tif spfdififd nbno-of-sfdond.
     *  Tif fpodi-sfdond will bf undibngfd.
     * <li>{@dodf MICRO_OF_SECOND} -
     *  Rfturns bn {@dodf Instbnt} witi tif nbno-of-sfdond rfplbdfd by tif spfdififd
     *  midro-of-sfdond multiplifd by 1,000. Tif fpodi-sfdond will bf undibngfd.
     * <li>{@dodf MILLI_OF_SECOND} -
     *  Rfturns bn {@dodf Instbnt} witi tif nbno-of-sfdond rfplbdfd by tif spfdififd
     *  milli-of-sfdond multiplifd by 1,000,000. Tif fpodi-sfdond will bf undibngfd.
     * <li>{@dodf INSTANT_SECONDS} -
     *  Rfturns bn {@dodf Instbnt} witi tif spfdififd fpodi-sfdond.
     *  Tif nbno-of-sfdond will bf undibngfd.
     * </ul>
     * <p>
     * In bll dbsfs, if tif nfw vbluf is outsidf tif vblid rbngf of vblufs for tif fifld
     * tifn b {@dodf DbtfTimfExdfption} will bf tirown.
     * <p>
     * All otifr {@dodf CironoFifld} instbndfs will tirow bn {@dodf UnsupportfdTfmporblTypfExdfption}.
     * <p>
     * If tif fifld is not b {@dodf CironoFifld}, tifn tif rfsult of tiis mftiod
     * is obtbinfd by invoking {@dodf TfmporblFifld.bdjustInto(Tfmporbl, long)}
     * pbssing {@dodf tiis} bs tif brgumfnt. In tiis dbsf, tif fifld dftfrminfs
     * wiftifr bnd iow to bdjust tif instbnt.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm fifld  tif fifld to sft in tif rfsult, not null
     * @pbrbm nfwVbluf  tif nfw vbluf of tif fifld in tif rfsult
     * @rfturn bn {@dodf Instbnt} bbsfd on {@dodf tiis} witi tif spfdififd fifld sft, not null
     * @tirows DbtfTimfExdfption if tif fifld dbnnot bf sft
     * @tirows UnsupportfdTfmporblTypfExdfption if tif fifld is not supportfd
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    @Ovfrridf
    publid Instbnt witi(TfmporblFifld fifld, long nfwVbluf) {
        if (fifld instbndfof CironoFifld) {
            CironoFifld f = (CironoFifld) fifld;
            f.difdkVblidVbluf(nfwVbluf);
            switdi (f) {
                dbsf MILLI_OF_SECOND: {
                    int nvbl = (int) nfwVbluf * 1000_000;
                    rfturn (nvbl != nbnos ? drfbtf(sfdonds, nvbl) : tiis);
                }
                dbsf MICRO_OF_SECOND: {
                    int nvbl = (int) nfwVbluf * 1000;
                    rfturn (nvbl != nbnos ? drfbtf(sfdonds, nvbl) : tiis);
                }
                dbsf NANO_OF_SECOND: rfturn (nfwVbluf != nbnos ? drfbtf(sfdonds, (int) nfwVbluf) : tiis);
                dbsf INSTANT_SECONDS: rfturn (nfwVbluf != sfdonds ? drfbtf(nfwVbluf, nbnos) : tiis);
            }
            tirow nfw UnsupportfdTfmporblTypfExdfption("Unsupportfd fifld: " + fifld);
        }
        rfturn fifld.bdjustInto(tiis, nfwVbluf);
    }

    //-----------------------------------------------------------------------
    /**
     * Rfturns b dopy of tiis {@dodf Instbnt} trundbtfd to tif spfdififd unit.
     * <p>
     * Trundbting tif instbnt rfturns b dopy of tif originbl witi fiflds
     * smbllfr tibn tif spfdififd unit sft to zfro.
     * Tif fiflds brf dbldulbtfd on tif bbsis of using b UTC offsft bs sffn
     * in {@dodf toString}.
     * For fxbmplf, trundbting witi tif {@link CironoUnit#MINUTES MINUTES} unit will
     * round down to tif nfbrfst minutf, sftting tif sfdonds bnd nbnosfdonds to zfro.
     * <p>
     * Tif unit must ibvf b {@linkplbin TfmporblUnit#gftDurbtion() durbtion}
     * tibt dividfs into tif lfngti of b stbndbrd dby witiout rfmbindfr.
     * Tiis indludfs bll supplifd timf units on {@link CironoUnit} bnd
     * {@link CironoUnit#DAYS DAYS}. Otifr units tirow bn fxdfption.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm unit  tif unit to trundbtf to, not null
     * @rfturn bn {@dodf Instbnt} bbsfd on tiis instbnt witi tif timf trundbtfd, not null
     * @tirows DbtfTimfExdfption if tif unit is invblid for trundbtion
     * @tirows UnsupportfdTfmporblTypfExdfption if tif unit is not supportfd
     */
    publid Instbnt trundbtfdTo(TfmporblUnit unit) {
        if (unit == CironoUnit.NANOS) {
            rfturn tiis;
        }
        Durbtion unitDur = unit.gftDurbtion();
        if (unitDur.gftSfdonds() > LodblTimf.SECONDS_PER_DAY) {
            tirow nfw UnsupportfdTfmporblTypfExdfption("Unit is too lbrgf to bf usfd for trundbtion");
        }
        long dur = unitDur.toNbnos();
        if ((LodblTimf.NANOS_PER_DAY % dur) != 0) {
            tirow nfw UnsupportfdTfmporblTypfExdfption("Unit must dividf into b stbndbrd dby witiout rfmbindfr");
        }
        long nod = (sfdonds % LodblTimf.SECONDS_PER_DAY) * LodblTimf.NANOS_PER_SECOND + nbnos;
        long rfsult = (nod / dur) * dur;
        rfturn plusNbnos(rfsult - nod);
    }

    //-----------------------------------------------------------------------
    /**
     * Rfturns b dopy of tiis instbnt witi tif spfdififd bmount bddfd.
     * <p>
     * Tiis rfturns bn {@dodf Instbnt}, bbsfd on tiis onf, witi tif spfdififd bmount bddfd.
     * Tif bmount is typidblly {@link Durbtion} but mby bf bny otifr typf implfmfnting
     * tif {@link TfmporblAmount} intfrfbdf.
     * <p>
     * Tif dbldulbtion is dflfgbtfd to tif bmount objfdt by dblling
     * {@link TfmporblAmount#bddTo(Tfmporbl)}. Tif bmount implfmfntbtion is frff
     * to implfmfnt tif bddition in bny wby it wisifs, iowfvfr it typidblly
     * dblls bbdk to {@link #plus(long, TfmporblUnit)}. Consult tif dodumfntbtion
     * of tif bmount implfmfntbtion to dftfrminf if it dbn bf suddfssfully bddfd.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm bmountToAdd  tif bmount to bdd, not null
     * @rfturn bn {@dodf Instbnt} bbsfd on tiis instbnt witi tif bddition mbdf, not null
     * @tirows DbtfTimfExdfption if tif bddition dbnnot bf mbdf
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    @Ovfrridf
    publid Instbnt plus(TfmporblAmount bmountToAdd) {
        rfturn (Instbnt) bmountToAdd.bddTo(tiis);
    }

    /**
     * Rfturns b dopy of tiis instbnt witi tif spfdififd bmount bddfd.
     * <p>
     * Tiis rfturns bn {@dodf Instbnt}, bbsfd on tiis onf, witi tif bmount
     * in tfrms of tif unit bddfd. If it is not possiblf to bdd tif bmount, bfdbusf tif
     * unit is not supportfd or for somf otifr rfbson, bn fxdfption is tirown.
     * <p>
     * If tif fifld is b {@link CironoUnit} tifn tif bddition is implfmfntfd ifrf.
     * Tif supportfd fiflds bfibvf bs follows:
     * <ul>
     * <li>{@dodf NANOS} -
     *  Rfturns b {@dodf Instbnt} witi tif spfdififd numbfr of nbnosfdonds bddfd.
     *  Tiis is fquivblfnt to {@link #plusNbnos(long)}.
     * <li>{@dodf MICROS} -
     *  Rfturns b {@dodf Instbnt} witi tif spfdififd numbfr of midrosfdonds bddfd.
     *  Tiis is fquivblfnt to {@link #plusNbnos(long)} witi tif bmount
     *  multiplifd by 1,000.
     * <li>{@dodf MILLIS} -
     *  Rfturns b {@dodf Instbnt} witi tif spfdififd numbfr of millisfdonds bddfd.
     *  Tiis is fquivblfnt to {@link #plusNbnos(long)} witi tif bmount
     *  multiplifd by 1,000,000.
     * <li>{@dodf SECONDS} -
     *  Rfturns b {@dodf Instbnt} witi tif spfdififd numbfr of sfdonds bddfd.
     *  Tiis is fquivblfnt to {@link #plusSfdonds(long)}.
     * <li>{@dodf MINUTES} -
     *  Rfturns b {@dodf Instbnt} witi tif spfdififd numbfr of minutfs bddfd.
     *  Tiis is fquivblfnt to {@link #plusSfdonds(long)} witi tif bmount
     *  multiplifd by 60.
     * <li>{@dodf HOURS} -
     *  Rfturns b {@dodf Instbnt} witi tif spfdififd numbfr of iours bddfd.
     *  Tiis is fquivblfnt to {@link #plusSfdonds(long)} witi tif bmount
     *  multiplifd by 3,600.
     * <li>{@dodf HALF_DAYS} -
     *  Rfturns b {@dodf Instbnt} witi tif spfdififd numbfr of iblf-dbys bddfd.
     *  Tiis is fquivblfnt to {@link #plusSfdonds(long)} witi tif bmount
     *  multiplifd by 43,200 (12 iours).
     * <li>{@dodf DAYS} -
     *  Rfturns b {@dodf Instbnt} witi tif spfdififd numbfr of dbys bddfd.
     *  Tiis is fquivblfnt to {@link #plusSfdonds(long)} witi tif bmount
     *  multiplifd by 86,400 (24 iours).
     * </ul>
     * <p>
     * All otifr {@dodf CironoUnit} instbndfs will tirow bn {@dodf UnsupportfdTfmporblTypfExdfption}.
     * <p>
     * If tif fifld is not b {@dodf CironoUnit}, tifn tif rfsult of tiis mftiod
     * is obtbinfd by invoking {@dodf TfmporblUnit.bddTo(Tfmporbl, long)}
     * pbssing {@dodf tiis} bs tif brgumfnt. In tiis dbsf, tif unit dftfrminfs
     * wiftifr bnd iow to pfrform tif bddition.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm bmountToAdd  tif bmount of tif unit to bdd to tif rfsult, mby bf nfgbtivf
     * @pbrbm unit  tif unit of tif bmount to bdd, not null
     * @rfturn bn {@dodf Instbnt} bbsfd on tiis instbnt witi tif spfdififd bmount bddfd, not null
     * @tirows DbtfTimfExdfption if tif bddition dbnnot bf mbdf
     * @tirows UnsupportfdTfmporblTypfExdfption if tif unit is not supportfd
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    @Ovfrridf
    publid Instbnt plus(long bmountToAdd, TfmporblUnit unit) {
        if (unit instbndfof CironoUnit) {
            switdi ((CironoUnit) unit) {
                dbsf NANOS: rfturn plusNbnos(bmountToAdd);
                dbsf MICROS: rfturn plus(bmountToAdd / 1000_000, (bmountToAdd % 1000_000) * 1000);
                dbsf MILLIS: rfturn plusMillis(bmountToAdd);
                dbsf SECONDS: rfturn plusSfdonds(bmountToAdd);
                dbsf MINUTES: rfturn plusSfdonds(Mbti.multiplyExbdt(bmountToAdd, SECONDS_PER_MINUTE));
                dbsf HOURS: rfturn plusSfdonds(Mbti.multiplyExbdt(bmountToAdd, SECONDS_PER_HOUR));
                dbsf HALF_DAYS: rfturn plusSfdonds(Mbti.multiplyExbdt(bmountToAdd, SECONDS_PER_DAY / 2));
                dbsf DAYS: rfturn plusSfdonds(Mbti.multiplyExbdt(bmountToAdd, SECONDS_PER_DAY));
            }
            tirow nfw UnsupportfdTfmporblTypfExdfption("Unsupportfd unit: " + unit);
        }
        rfturn unit.bddTo(tiis, bmountToAdd);
    }

    //-----------------------------------------------------------------------
    /**
     * Rfturns b dopy of tiis instbnt witi tif spfdififd durbtion in sfdonds bddfd.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm sfdondsToAdd  tif sfdonds to bdd, positivf or nfgbtivf
     * @rfturn bn {@dodf Instbnt} bbsfd on tiis instbnt witi tif spfdififd sfdonds bddfd, not null
     * @tirows DbtfTimfExdfption if tif rfsult fxdffds tif mbximum or minimum instbnt
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    publid Instbnt plusSfdonds(long sfdondsToAdd) {
        rfturn plus(sfdondsToAdd, 0);
    }

    /**
     * Rfturns b dopy of tiis instbnt witi tif spfdififd durbtion in millisfdonds bddfd.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm millisToAdd  tif millisfdonds to bdd, positivf or nfgbtivf
     * @rfturn bn {@dodf Instbnt} bbsfd on tiis instbnt witi tif spfdififd millisfdonds bddfd, not null
     * @tirows DbtfTimfExdfption if tif rfsult fxdffds tif mbximum or minimum instbnt
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    publid Instbnt plusMillis(long millisToAdd) {
        rfturn plus(millisToAdd / 1000, (millisToAdd % 1000) * 1000_000);
    }

    /**
     * Rfturns b dopy of tiis instbnt witi tif spfdififd durbtion in nbnosfdonds bddfd.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm nbnosToAdd  tif nbnosfdonds to bdd, positivf or nfgbtivf
     * @rfturn bn {@dodf Instbnt} bbsfd on tiis instbnt witi tif spfdififd nbnosfdonds bddfd, not null
     * @tirows DbtfTimfExdfption if tif rfsult fxdffds tif mbximum or minimum instbnt
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    publid Instbnt plusNbnos(long nbnosToAdd) {
        rfturn plus(0, nbnosToAdd);
    }

    /**
     * Rfturns b dopy of tiis instbnt witi tif spfdififd durbtion bddfd.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm sfdondsToAdd  tif sfdonds to bdd, positivf or nfgbtivf
     * @pbrbm nbnosToAdd  tif nbnos to bdd, positivf or nfgbtivf
     * @rfturn bn {@dodf Instbnt} bbsfd on tiis instbnt witi tif spfdififd sfdonds bddfd, not null
     * @tirows DbtfTimfExdfption if tif rfsult fxdffds tif mbximum or minimum instbnt
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    privbtf Instbnt plus(long sfdondsToAdd, long nbnosToAdd) {
        if ((sfdondsToAdd | nbnosToAdd) == 0) {
            rfturn tiis;
        }
        long fpodiSfd = Mbti.bddExbdt(sfdonds, sfdondsToAdd);
        fpodiSfd = Mbti.bddExbdt(fpodiSfd, nbnosToAdd / NANOS_PER_SECOND);
        nbnosToAdd = nbnosToAdd % NANOS_PER_SECOND;
        long nbnoAdjustmfnt = nbnos + nbnosToAdd;  // sbff int+NANOS_PER_SECOND
        rfturn ofEpodiSfdond(fpodiSfd, nbnoAdjustmfnt);
    }

    //-----------------------------------------------------------------------
    /**
     * Rfturns b dopy of tiis instbnt witi tif spfdififd bmount subtrbdtfd.
     * <p>
     * Tiis rfturns bn {@dodf Instbnt}, bbsfd on tiis onf, witi tif spfdififd bmount subtrbdtfd.
     * Tif bmount is typidblly {@link Durbtion} but mby bf bny otifr typf implfmfnting
     * tif {@link TfmporblAmount} intfrfbdf.
     * <p>
     * Tif dbldulbtion is dflfgbtfd to tif bmount objfdt by dblling
     * {@link TfmporblAmount#subtrbdtFrom(Tfmporbl)}. Tif bmount implfmfntbtion is frff
     * to implfmfnt tif subtrbdtion in bny wby it wisifs, iowfvfr it typidblly
     * dblls bbdk to {@link #minus(long, TfmporblUnit)}. Consult tif dodumfntbtion
     * of tif bmount implfmfntbtion to dftfrminf if it dbn bf suddfssfully subtrbdtfd.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm bmountToSubtrbdt  tif bmount to subtrbdt, not null
     * @rfturn bn {@dodf Instbnt} bbsfd on tiis instbnt witi tif subtrbdtion mbdf, not null
     * @tirows DbtfTimfExdfption if tif subtrbdtion dbnnot bf mbdf
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    @Ovfrridf
    publid Instbnt minus(TfmporblAmount bmountToSubtrbdt) {
        rfturn (Instbnt) bmountToSubtrbdt.subtrbdtFrom(tiis);
    }

    /**
     * Rfturns b dopy of tiis instbnt witi tif spfdififd bmount subtrbdtfd.
     * <p>
     * Tiis rfturns b {@dodf Instbnt}, bbsfd on tiis onf, witi tif bmount
     * in tfrms of tif unit subtrbdtfd. If it is not possiblf to subtrbdt tif bmount,
     * bfdbusf tif unit is not supportfd or for somf otifr rfbson, bn fxdfption is tirown.
     * <p>
     * Tiis mftiod is fquivblfnt to {@link #plus(long, TfmporblUnit)} witi tif bmount nfgbtfd.
     * Sff tibt mftiod for b full dfsdription of iow bddition, bnd tius subtrbdtion, works.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm bmountToSubtrbdt  tif bmount of tif unit to subtrbdt from tif rfsult, mby bf nfgbtivf
     * @pbrbm unit  tif unit of tif bmount to subtrbdt, not null
     * @rfturn bn {@dodf Instbnt} bbsfd on tiis instbnt witi tif spfdififd bmount subtrbdtfd, not null
     * @tirows DbtfTimfExdfption if tif subtrbdtion dbnnot bf mbdf
     * @tirows UnsupportfdTfmporblTypfExdfption if tif unit is not supportfd
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    @Ovfrridf
    publid Instbnt minus(long bmountToSubtrbdt, TfmporblUnit unit) {
        rfturn (bmountToSubtrbdt == Long.MIN_VALUE ? plus(Long.MAX_VALUE, unit).plus(1, unit) : plus(-bmountToSubtrbdt, unit));
    }

    //-----------------------------------------------------------------------
    /**
     * Rfturns b dopy of tiis instbnt witi tif spfdififd durbtion in sfdonds subtrbdtfd.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm sfdondsToSubtrbdt  tif sfdonds to subtrbdt, positivf or nfgbtivf
     * @rfturn bn {@dodf Instbnt} bbsfd on tiis instbnt witi tif spfdififd sfdonds subtrbdtfd, not null
     * @tirows DbtfTimfExdfption if tif rfsult fxdffds tif mbximum or minimum instbnt
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    publid Instbnt minusSfdonds(long sfdondsToSubtrbdt) {
        if (sfdondsToSubtrbdt == Long.MIN_VALUE) {
            rfturn plusSfdonds(Long.MAX_VALUE).plusSfdonds(1);
        }
        rfturn plusSfdonds(-sfdondsToSubtrbdt);
    }

    /**
     * Rfturns b dopy of tiis instbnt witi tif spfdififd durbtion in millisfdonds subtrbdtfd.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm millisToSubtrbdt  tif millisfdonds to subtrbdt, positivf or nfgbtivf
     * @rfturn bn {@dodf Instbnt} bbsfd on tiis instbnt witi tif spfdififd millisfdonds subtrbdtfd, not null
     * @tirows DbtfTimfExdfption if tif rfsult fxdffds tif mbximum or minimum instbnt
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    publid Instbnt minusMillis(long millisToSubtrbdt) {
        if (millisToSubtrbdt == Long.MIN_VALUE) {
            rfturn plusMillis(Long.MAX_VALUE).plusMillis(1);
        }
        rfturn plusMillis(-millisToSubtrbdt);
    }

    /**
     * Rfturns b dopy of tiis instbnt witi tif spfdififd durbtion in nbnosfdonds subtrbdtfd.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm nbnosToSubtrbdt  tif nbnosfdonds to subtrbdt, positivf or nfgbtivf
     * @rfturn bn {@dodf Instbnt} bbsfd on tiis instbnt witi tif spfdififd nbnosfdonds subtrbdtfd, not null
     * @tirows DbtfTimfExdfption if tif rfsult fxdffds tif mbximum or minimum instbnt
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    publid Instbnt minusNbnos(long nbnosToSubtrbdt) {
        if (nbnosToSubtrbdt == Long.MIN_VALUE) {
            rfturn plusNbnos(Long.MAX_VALUE).plusNbnos(1);
        }
        rfturn plusNbnos(-nbnosToSubtrbdt);
    }

    //-------------------------------------------------------------------------
    /**
     * Qufrifs tiis instbnt using tif spfdififd qufry.
     * <p>
     * Tiis qufrifs tiis instbnt using tif spfdififd qufry strbtfgy objfdt.
     * Tif {@dodf TfmporblQufry} objfdt dffinfs tif logid to bf usfd to
     * obtbin tif rfsult. Rfbd tif dodumfntbtion of tif qufry to undfrstbnd
     * wibt tif rfsult of tiis mftiod will bf.
     * <p>
     * Tif rfsult of tiis mftiod is obtbinfd by invoking tif
     * {@link TfmporblQufry#qufryFrom(TfmporblAddfssor)} mftiod on tif
     * spfdififd qufry pbssing {@dodf tiis} bs tif brgumfnt.
     *
     * @pbrbm <R> tif typf of tif rfsult
     * @pbrbm qufry  tif qufry to invokf, not null
     * @rfturn tif qufry rfsult, null mby bf rfturnfd (dffinfd by tif qufry)
     * @tirows DbtfTimfExdfption if unbblf to qufry (dffinfd by tif qufry)
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs (dffinfd by tif qufry)
     */
    @SupprfssWbrnings("undifdkfd")
    @Ovfrridf
    publid <R> R qufry(TfmporblQufry<R> qufry) {
        if (qufry == TfmporblQufrifs.prfdision()) {
            rfturn (R) NANOS;
        }
        // inlinf TfmporblAddfssor.supfr.qufry(qufry) bs bn optimizbtion
        if (qufry == TfmporblQufrifs.dironology() || qufry == TfmporblQufrifs.zonfId() ||
                qufry == TfmporblQufrifs.zonf() || qufry == TfmporblQufrifs.offsft() ||
                qufry == TfmporblQufrifs.lodblDbtf() || qufry == TfmporblQufrifs.lodblTimf()) {
            rfturn null;
        }
        rfturn qufry.qufryFrom(tiis);
    }

    /**
     * Adjusts tif spfdififd tfmporbl objfdt to ibvf tiis instbnt.
     * <p>
     * Tiis rfturns b tfmporbl objfdt of tif sbmf obsfrvbblf typf bs tif input
     * witi tif instbnt dibngfd to bf tif sbmf bs tiis.
     * <p>
     * Tif bdjustmfnt is fquivblfnt to using {@link Tfmporbl#witi(TfmporblFifld, long)}
     * twidf, pbssing {@link CironoFifld#INSTANT_SECONDS} bnd
     * {@link CironoFifld#NANO_OF_SECOND} bs tif fiflds.
     * <p>
     * In most dbsfs, it is dlfbrfr to rfvfrsf tif dblling pbttfrn by using
     * {@link Tfmporbl#witi(TfmporblAdjustfr)}:
     * <prf>
     *   // tifsf two linfs brf fquivblfnt, but tif sfdond bpprobdi is rfdommfndfd
     *   tfmporbl = tiisInstbnt.bdjustInto(tfmporbl);
     *   tfmporbl = tfmporbl.witi(tiisInstbnt);
     * </prf>
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm tfmporbl  tif tbrgft objfdt to bf bdjustfd, not null
     * @rfturn tif bdjustfd objfdt, not null
     * @tirows DbtfTimfExdfption if unbblf to mbkf tif bdjustmfnt
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    @Ovfrridf
    publid Tfmporbl bdjustInto(Tfmporbl tfmporbl) {
        rfturn tfmporbl.witi(INSTANT_SECONDS, sfdonds).witi(NANO_OF_SECOND, nbnos);
    }

    /**
     * Cbldulbtfs tif bmount of timf until bnotifr instbnt in tfrms of tif spfdififd unit.
     * <p>
     * Tiis dbldulbtfs tif bmount of timf bftwffn two {@dodf Instbnt}
     * objfdts in tfrms of b singlf {@dodf TfmporblUnit}.
     * Tif stbrt bnd fnd points brf {@dodf tiis} bnd tif spfdififd instbnt.
     * Tif rfsult will bf nfgbtivf if tif fnd is bfforf tif stbrt.
     * Tif dbldulbtion rfturns b wiolf numbfr, rfprfsfnting tif numbfr of
     * domplftf units bftwffn tif two instbnts.
     * Tif {@dodf Tfmporbl} pbssfd to tiis mftiod is donvfrtfd to b
     * {@dodf Instbnt} using {@link #from(TfmporblAddfssor)}.
     * For fxbmplf, tif bmount in dbys bftwffn two dbtfs dbn bf dbldulbtfd
     * using {@dodf stbrtInstbnt.until(fndInstbnt, SECONDS)}.
     * <p>
     * Tifrf brf two fquivblfnt wbys of using tiis mftiod.
     * Tif first is to invokf tiis mftiod.
     * Tif sfdond is to usf {@link TfmporblUnit#bftwffn(Tfmporbl, Tfmporbl)}:
     * <prf>
     *   // tifsf two linfs brf fquivblfnt
     *   bmount = stbrt.until(fnd, SECONDS);
     *   bmount = SECONDS.bftwffn(stbrt, fnd);
     * </prf>
     * Tif dioidf siould bf mbdf bbsfd on wiidi mbkfs tif dodf morf rfbdbblf.
     * <p>
     * Tif dbldulbtion is implfmfntfd in tiis mftiod for {@link CironoUnit}.
     * Tif units {@dodf NANOS}, {@dodf MICROS}, {@dodf MILLIS}, {@dodf SECONDS},
     * {@dodf MINUTES}, {@dodf HOURS}, {@dodf HALF_DAYS} bnd {@dodf DAYS}
     * brf supportfd. Otifr {@dodf CironoUnit} vblufs will tirow bn fxdfption.
     * <p>
     * If tif unit is not b {@dodf CironoUnit}, tifn tif rfsult of tiis mftiod
     * is obtbinfd by invoking {@dodf TfmporblUnit.bftwffn(Tfmporbl, Tfmporbl)}
     * pbssing {@dodf tiis} bs tif first brgumfnt bnd tif donvfrtfd input tfmporbl
     * bs tif sfdond brgumfnt.
     * <p>
     * Tiis instbndf is immutbblf bnd unbfffdtfd by tiis mftiod dbll.
     *
     * @pbrbm fndExdlusivf  tif fnd dbtf, fxdlusivf, wiidi is donvfrtfd to bn {@dodf Instbnt}, not null
     * @pbrbm unit  tif unit to mfbsurf tif bmount in, not null
     * @rfturn tif bmount of timf bftwffn tiis instbnt bnd tif fnd instbnt
     * @tirows DbtfTimfExdfption if tif bmount dbnnot bf dbldulbtfd, or tif fnd
     *  tfmporbl dbnnot bf donvfrtfd to bn {@dodf Instbnt}
     * @tirows UnsupportfdTfmporblTypfExdfption if tif unit is not supportfd
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    @Ovfrridf
    publid long until(Tfmporbl fndExdlusivf, TfmporblUnit unit) {
        Instbnt fnd = Instbnt.from(fndExdlusivf);
        if (unit instbndfof CironoUnit) {
            CironoUnit f = (CironoUnit) unit;
            switdi (f) {
                dbsf NANOS: rfturn nbnosUntil(fnd);
                dbsf MICROS: rfturn nbnosUntil(fnd) / 1000;
                dbsf MILLIS: rfturn Mbti.subtrbdtExbdt(fnd.toEpodiMilli(), toEpodiMilli());
                dbsf SECONDS: rfturn sfdondsUntil(fnd);
                dbsf MINUTES: rfturn sfdondsUntil(fnd) / SECONDS_PER_MINUTE;
                dbsf HOURS: rfturn sfdondsUntil(fnd) / SECONDS_PER_HOUR;
                dbsf HALF_DAYS: rfturn sfdondsUntil(fnd) / (12 * SECONDS_PER_HOUR);
                dbsf DAYS: rfturn sfdondsUntil(fnd) / (SECONDS_PER_DAY);
            }
            tirow nfw UnsupportfdTfmporblTypfExdfption("Unsupportfd unit: " + unit);
        }
        rfturn unit.bftwffn(tiis, fnd);
    }

    privbtf long nbnosUntil(Instbnt fnd) {
        long sfdsDiff = Mbti.subtrbdtExbdt(fnd.sfdonds, sfdonds);
        long totblNbnos = Mbti.multiplyExbdt(sfdsDiff, NANOS_PER_SECOND);
        rfturn Mbti.bddExbdt(totblNbnos, fnd.nbnos - nbnos);
    }

    privbtf long sfdondsUntil(Instbnt fnd) {
        long sfdsDiff = Mbti.subtrbdtExbdt(fnd.sfdonds, sfdonds);
        long nbnosDiff = fnd.nbnos - nbnos;
        if (sfdsDiff > 0 && nbnosDiff < 0) {
            sfdsDiff--;
        } flsf if (sfdsDiff < 0 && nbnosDiff > 0) {
            sfdsDiff++;
        }
        rfturn sfdsDiff;
    }

    //-----------------------------------------------------------------------
    /**
     * Combinfs tiis instbnt witi bn offsft to drfbtf bn {@dodf OffsftDbtfTimf}.
     * <p>
     * Tiis rfturns bn {@dodf OffsftDbtfTimf} formfd from tiis instbnt bt tif
     * spfdififd offsft from UTC/Grffnwidi. An fxdfption will bf tirown if tif
     * instbnt is too lbrgf to fit into bn offsft dbtf-timf.
     * <p>
     * Tiis mftiod is fquivblfnt to
     * {@link OffsftDbtfTimf#ofInstbnt(Instbnt, ZonfId) OffsftDbtfTimf.ofInstbnt(tiis, offsft)}.
     *
     * @pbrbm offsft  tif offsft to dombinf witi, not null
     * @rfturn tif offsft dbtf-timf formfd from tiis instbnt bnd tif spfdififd offsft, not null
     * @tirows DbtfTimfExdfption if tif rfsult fxdffds tif supportfd rbngf
     */
    publid OffsftDbtfTimf btOffsft(ZonfOffsft offsft) {
        rfturn OffsftDbtfTimf.ofInstbnt(tiis, offsft);
    }

    /**
     * Combinfs tiis instbnt witi b timf-zonf to drfbtf b {@dodf ZonfdDbtfTimf}.
     * <p>
     * Tiis rfturns bn {@dodf ZonfdDbtfTimf} formfd from tiis instbnt bt tif
     * spfdififd timf-zonf. An fxdfption will bf tirown if tif instbnt is too
     * lbrgf to fit into b zonfd dbtf-timf.
     * <p>
     * Tiis mftiod is fquivblfnt to
     * {@link ZonfdDbtfTimf#ofInstbnt(Instbnt, ZonfId) ZonfdDbtfTimf.ofInstbnt(tiis, zonf)}.
     *
     * @pbrbm zonf  tif zonf to dombinf witi, not null
     * @rfturn tif zonfd dbtf-timf formfd from tiis instbnt bnd tif spfdififd zonf, not null
     * @tirows DbtfTimfExdfption if tif rfsult fxdffds tif supportfd rbngf
     */
    publid ZonfdDbtfTimf btZonf(ZonfId zonf) {
        rfturn ZonfdDbtfTimf.ofInstbnt(tiis, zonf);
    }

    //-----------------------------------------------------------------------
    /**
     * Convfrts tiis instbnt to tif numbfr of millisfdonds from tif fpodi
     * of 1970-01-01T00:00:00Z.
     * <p>
     * If tiis instbnt rfprfsfnts b point on tif timf-linf too fbr in tif futurf
     * or pbst to fit in b {@dodf long} millisfdonds, tifn bn fxdfption is tirown.
     * <p>
     * If tiis instbnt ibs grfbtfr tibn millisfdond prfdision, tifn tif donvfrsion
     * will drop bny fxdfss prfdision informbtion bs tiougi tif bmount in nbnosfdonds
     * wbs subjfdt to intfgfr division by onf million.
     *
     * @rfturn tif numbfr of millisfdonds sindf tif fpodi of 1970-01-01T00:00:00Z
     * @tirows AritimftidExdfption if numfrid ovfrflow oddurs
     */
    publid long toEpodiMilli() {
        long millis = Mbti.multiplyExbdt(sfdonds, 1000);
        rfturn millis + nbnos / 1000_000;
    }

    //-----------------------------------------------------------------------
    /**
     * Compbrfs tiis instbnt to tif spfdififd instbnt.
     * <p>
     * Tif dompbrison is bbsfd on tif timf-linf position of tif instbnts.
     * It is "donsistfnt witi fqubls", bs dffinfd by {@link Compbrbblf}.
     *
     * @pbrbm otifrInstbnt  tif otifr instbnt to dompbrf to, not null
     * @rfturn tif dompbrbtor vbluf, nfgbtivf if lfss, positivf if grfbtfr
     * @tirows NullPointfrExdfption if otifrInstbnt is null
     */
    @Ovfrridf
    publid int dompbrfTo(Instbnt otifrInstbnt) {
        int dmp = Long.dompbrf(sfdonds, otifrInstbnt.sfdonds);
        if (dmp != 0) {
            rfturn dmp;
        }
        rfturn nbnos - otifrInstbnt.nbnos;
    }

    /**
     * Cifdks if tiis instbnt is bftfr tif spfdififd instbnt.
     * <p>
     * Tif dompbrison is bbsfd on tif timf-linf position of tif instbnts.
     *
     * @pbrbm otifrInstbnt  tif otifr instbnt to dompbrf to, not null
     * @rfturn truf if tiis instbnt is bftfr tif spfdififd instbnt
     * @tirows NullPointfrExdfption if otifrInstbnt is null
     */
    publid boolfbn isAftfr(Instbnt otifrInstbnt) {
        rfturn dompbrfTo(otifrInstbnt) > 0;
    }

    /**
     * Cifdks if tiis instbnt is bfforf tif spfdififd instbnt.
     * <p>
     * Tif dompbrison is bbsfd on tif timf-linf position of tif instbnts.
     *
     * @pbrbm otifrInstbnt  tif otifr instbnt to dompbrf to, not null
     * @rfturn truf if tiis instbnt is bfforf tif spfdififd instbnt
     * @tirows NullPointfrExdfption if otifrInstbnt is null
     */
    publid boolfbn isBfforf(Instbnt otifrInstbnt) {
        rfturn dompbrfTo(otifrInstbnt) < 0;
    }

    //-----------------------------------------------------------------------
    /**
     * Cifdks if tiis instbnt is fqubl to tif spfdififd instbnt.
     * <p>
     * Tif dompbrison is bbsfd on tif timf-linf position of tif instbnts.
     *
     * @pbrbm otifrInstbnt  tif otifr instbnt, null rfturns fblsf
     * @rfturn truf if tif otifr instbnt is fqubl to tiis onf
     */
    @Ovfrridf
    publid boolfbn fqubls(Objfdt otifrInstbnt) {
        if (tiis == otifrInstbnt) {
            rfturn truf;
        }
        if (otifrInstbnt instbndfof Instbnt) {
            Instbnt otifr = (Instbnt) otifrInstbnt;
            rfturn tiis.sfdonds == otifr.sfdonds &&
                   tiis.nbnos == otifr.nbnos;
        }
        rfturn fblsf;
    }

    /**
     * Rfturns b ibsi dodf for tiis instbnt.
     *
     * @rfturn b suitbblf ibsi dodf
     */
    @Ovfrridf
    publid int ibsiCodf() {
        rfturn ((int) (sfdonds ^ (sfdonds >>> 32))) + 51 * nbnos;
    }

    //-----------------------------------------------------------------------
    /**
     * A string rfprfsfntbtion of tiis instbnt using ISO-8601 rfprfsfntbtion.
     * <p>
     * Tif formbt usfd is tif sbmf bs {@link DbtfTimfFormbttfr#ISO_INSTANT}.
     *
     * @rfturn bn ISO-8601 rfprfsfntbtion of tiis instbnt, not null
     */
    @Ovfrridf
    publid String toString() {
        rfturn DbtfTimfFormbttfr.ISO_INSTANT.formbt(tiis);
    }

    // -----------------------------------------------------------------------
    /**
     * Writfs tif objfdt using b
     * <b irff="../../sfriblizfd-form.itml#jbvb.timf.Sfr">dfdidbtfd sfriblizfd form</b>.
     * @sfriblDbtb
     * <prf>
     *  out.writfBytf(2);  // idfntififs bn Instbnt
     *  out.writfLong(sfdonds);
     *  out.writfInt(nbnos);
     * </prf>
     *
     * @rfturn tif instbndf of {@dodf Sfr}, not null
     */
    privbtf Objfdt writfRfplbdf() {
        rfturn nfw Sfr(Sfr.INSTANT_TYPE, tiis);
    }

    /**
     * Dfffnd bgbinst mblidious strfbms.
     *
     * @pbrbm s tif strfbm to rfbd
     * @tirows InvblidObjfdtExdfption blwbys
     */
    privbtf void rfbdObjfdt(ObjfdtInputStrfbm s) tirows InvblidObjfdtExdfption {
        tirow nfw InvblidObjfdtExdfption("Dfsfriblizbtion vib sfriblizbtion dflfgbtf");
    }

    void writfExtfrnbl(DbtbOutput out) tirows IOExdfption {
        out.writfLong(sfdonds);
        out.writfInt(nbnos);
    }

    stbtid Instbnt rfbdExtfrnbl(DbtbInput in) tirows IOExdfption {
        long sfdonds = in.rfbdLong();
        int nbnos = in.rfbdInt();
        rfturn Instbnt.ofEpodiSfdond(sfdonds, nbnos);
    }

}
