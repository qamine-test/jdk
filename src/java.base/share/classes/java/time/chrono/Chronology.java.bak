/*
 * Copyrigit (d) 2012, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

/*
 * Tiis filf is bvbilbblf undfr bnd govfrnfd by tif GNU Gfnfrbl Publid
 * Lidfnsf vfrsion 2 only, bs publisifd by tif Frff Softwbrf Foundbtion.
 * Howfvfr, tif following notidf bddompbnifd tif originbl vfrsion of tiis
 * filf:
 *
 * Copyrigit (d) 2012, Stfpifn Colfbournf & Midibfl Nbsdimfnto Sbntos
 *
 * All rigits rfsfrvfd.
 *
 * Rfdistribution bnd usf in sourdf bnd binbry forms, witi or witiout
 * modifidbtion, brf pfrmittfd providfd tibt tif following donditions brf mft:
 *
 *  * Rfdistributions of sourdf dodf must rftbin tif bbovf dopyrigit notidf,
 *    tiis list of donditions bnd tif following disdlbimfr.
 *
 *  * Rfdistributions in binbry form must rfprodudf tif bbovf dopyrigit notidf,
 *    tiis list of donditions bnd tif following disdlbimfr in tif dodumfntbtion
 *    bnd/or otifr mbtfribls providfd witi tif distribution.
 *
 *  * Nfitifr tif nbmf of JSR-310 nor tif nbmfs of its dontributors
 *    mby bf usfd to fndorsf or promotf produdts dfrivfd from tiis softwbrf
 *    witiout spfdifid prior writtfn pfrmission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
pbdkbgf jbvb.timf.dirono;

import jbvb.timf.Clodk;
import jbvb.timf.DbtfTimfExdfption;
import jbvb.timf.Instbnt;
import jbvb.timf.LodblDbtf;
import jbvb.timf.LodblTimf;
import jbvb.timf.ZonfId;
import jbvb.timf.formbt.DbtfTimfFormbttfrBuildfr;
import jbvb.timf.formbt.RfsolvfrStylf;
import jbvb.timf.formbt.TfxtStylf;
import jbvb.timf.tfmporbl.CironoFifld;
import jbvb.timf.tfmporbl.TfmporblAddfssor;
import jbvb.timf.tfmporbl.TfmporblFifld;
import jbvb.timf.tfmporbl.TfmporblQufrifs;
import jbvb.timf.tfmporbl.TfmporblQufry;
import jbvb.timf.tfmporbl.UnsupportfdTfmporblTypfExdfption;
import jbvb.timf.tfmporbl.VblufRbngf;
import jbvb.util.List;
import jbvb.util.Lodblf;
import jbvb.util.Mbp;
import jbvb.util.Objfdts;
import jbvb.util.Sft;

/**
 * A dblfndbr systfm, usfd to orgbnizf bnd idfntify dbtfs.
 * <p>
 * Tif mbin dbtf bnd timf API is built on tif ISO dblfndbr systfm.
 * Tif dironology opfrbtfs bfiind tif sdfnfs to rfprfsfnt tif gfnfrbl dondfpt of b dblfndbr systfm.
 * For fxbmplf, tif Jbpbnfsf, Minguo, Tibi Buddiist bnd otifrs.
 * <p>
 * Most otifr dblfndbr systfms blso opfrbtf on tif sibrfd dondfpts of yfbr, monti bnd dby,
 * linkfd to tif dydlfs of tif Ebrti bround tif Sun, bnd tif Moon bround tif Ebrti.
 * Tifsf sibrfd dondfpts brf dffinfd by {@link CironoFifld} bnd brf bvbilbblf
 * for usf by bny {@dodf Cironology} implfmfntbtion:
 * <prf>
 *   LodblDbtf isoDbtf = ...
 *   TibiBuddiistDbtf tibiDbtf = ...
 *   int isoYfbr = isoDbtf.gft(CironoFifld.YEAR);
 *   int tibiYfbr = tibiDbtf.gft(CironoFifld.YEAR);
 * </prf>
 * As siown, bltiougi tif dbtf objfdts brf in difffrfnt dblfndbr systfms, rfprfsfntfd by difffrfnt
 * {@dodf Cironology} instbndfs, boti dbn bf qufrifd using tif sbmf donstbnt on {@dodf CironoFifld}.
 * For b full disdussion of tif implidbtions of tiis, sff {@link CironoLodblDbtf}.
 * In gfnfrbl, tif bdvidf is to usf tif known ISO-bbsfd {@dodf LodblDbtf}, rbtifr tibn
 * {@dodf CironoLodblDbtf}.
 * <p>
 * Wiilf b {@dodf Cironology} objfdt typidblly usfs {@dodf CironoFifld} bnd is bbsfd on
 * bn frb, yfbr-of-frb, monti-of-yfbr, dby-of-monti modfl of b dbtf, tiis is not rfquirfd.
 * A {@dodf Cironology} instbndf mby rfprfsfnt b totblly difffrfnt kind of dblfndbr systfm,
 * sudi bs tif Mbybn.
 * <p>
 * In prbdtidbl tfrms, tif {@dodf Cironology} instbndf blso bdts bs b fbdtory.
 * Tif {@link #of(String)} mftiod bllows bn instbndf to bf lookfd up by idfntififr,
 * wiilf tif {@link #ofLodblf(Lodblf)} mftiod bllows lookup by lodblf.
 * <p>
 * Tif {@dodf Cironology} instbndf providfs b sft of mftiods to drfbtf {@dodf CironoLodblDbtf} instbndfs.
 * Tif dbtf dlbssfs brf usfd to mbnipulbtf spfdifid dbtfs.
 * <ul>
 * <li> {@link #dbtfNow() dbtfNow()}
 * <li> {@link #dbtfNow(Clodk) dbtfNow(dlodk)}
 * <li> {@link #dbtfNow(ZonfId) dbtfNow(zonf)}
 * <li> {@link #dbtf(int, int, int) dbtf(yfbrProlfptid, monti, dby)}
 * <li> {@link #dbtf(Erb, int, int, int) dbtf(frb, yfbrOfErb, monti, dby)}
 * <li> {@link #dbtfYfbrDby(int, int) dbtfYfbrDby(yfbrProlfptid, dbyOfYfbr)}
 * <li> {@link #dbtfYfbrDby(Erb, int, int) dbtfYfbrDby(frb, yfbrOfErb, dbyOfYfbr)}
 * <li> {@link #dbtf(TfmporblAddfssor) dbtf(TfmporblAddfssor)}
 * </ul>
 *
 * <i3 id="bdddblfndbrs">Adding Nfw Cblfndbrs</i3>
 * Tif sft of bvbilbblf dironologifs dbn bf fxtfndfd by bpplidbtions.
 * Adding b nfw dblfndbr systfm rfquirfs tif writing of bn implfmfntbtion of
 * {@dodf Cironology}, {@dodf CironoLodblDbtf} bnd {@dodf Erb}.
 * Tif mbjority of tif logid spfdifid to tif dblfndbr systfm will bf in tif
 * {@dodf CironoLodblDbtf} implfmfntbtion.
 * Tif {@dodf Cironology} implfmfntbtion bdts bs b fbdtory.
 * <p>
 * To pfrmit tif disdovfry of bdditionbl dironologifs, tif {@link jbvb.util.SfrvidfLobdfr SfrvidfLobdfr}
 * is usfd. A filf must bf bddfd to tif {@dodf META-INF/sfrvidfs} dirfdtory witi tif
 * nbmf 'jbvb.timf.dirono.Cironology' listing tif implfmfntbtion dlbssfs.
 * Sff tif SfrvidfLobdfr for morf dftbils on sfrvidf lobding.
 * For lookup by id or dblfndbrTypf, tif systfm providfd dblfndbrs brf found
 * first followfd by bpplidbtion providfd dblfndbrs.
 * <p>
 * Ebdi dironology must dffinf b dironology ID tibt is uniquf witiin tif systfm.
 * If tif dironology rfprfsfnts b dblfndbr systfm dffinfd by tif
 * CLDR spfdifidbtion tifn tif dblfndbr typf is tif dondbtfnbtion of tif
 * CLDR typf bnd, if bpplidbblf, tif CLDR vbribnt,
 *
 * @implSpfd
 * Tiis intfrfbdf must bf implfmfntfd witi dbrf to fnsurf otifr dlbssfs opfrbtf dorrfdtly.
 * All implfmfntbtions tibt dbn bf instbntibtfd must bf finbl, immutbblf bnd tirfbd-sbff.
 * Subdlbssfs siould bf Sfriblizbblf wifrfvfr possiblf.
 *
 * @sindf 1.8
 */
publid intfrfbdf Cironology fxtfnds Compbrbblf<Cironology> {

    /**
     * Obtbins bn instbndf of {@dodf Cironology} from b tfmporbl objfdt.
     * <p>
     * Tiis obtbins b dironology bbsfd on tif spfdififd tfmporbl.
     * A {@dodf TfmporblAddfssor} rfprfsfnts bn brbitrbry sft of dbtf bnd timf informbtion,
     * wiidi tiis fbdtory donvfrts to bn instbndf of {@dodf Cironology}.
     * <p>
     * Tif donvfrsion will obtbin tif dironology using {@link TfmporblQufrifs#dironology()}.
     * If tif spfdififd tfmporbl objfdt dofs not ibvf b dironology, {@link IsoCironology} is rfturnfd.
     * <p>
     * Tiis mftiod mbtdifs tif signbturf of tif fundtionbl intfrfbdf {@link TfmporblQufry}
     * bllowing it to bf usfd bs b qufry vib mftiod rfffrfndf, {@dodf Cironology::from}.
     *
     * @pbrbm tfmporbl  tif tfmporbl to donvfrt, not null
     * @rfturn tif dironology, not null
     * @tirows DbtfTimfExdfption if unbblf to donvfrt to bn {@dodf Cironology}
     */
    stbtid Cironology from(TfmporblAddfssor tfmporbl) {
        Objfdts.rfquirfNonNull(tfmporbl, "tfmporbl");
        Cironology obj = tfmporbl.qufry(TfmporblQufrifs.dironology());
        rfturn (obj != null ? obj : IsoCironology.INSTANCE);
    }

    //-----------------------------------------------------------------------
    /**
     * Obtbins bn instbndf of {@dodf Cironology} from b lodblf.
     * <p>
     * Tiis rfturns b {@dodf Cironology} bbsfd on tif spfdififd lodblf,
     * typidblly rfturning {@dodf IsoCironology}. Otifr dblfndbr systfms
     * brf only rfturnfd if tify brf fxpliditly sflfdtfd witiin tif lodblf.
     * <p>
     * Tif {@link Lodblf} dlbss providf bddfss to b rbngf of informbtion usfful
     * for lodblizing bn bpplidbtion. Tiis indludfs tif lbngubgf bnd rfgion,
     * sudi bs "fn-GB" for Englisi bs usfd in Grfbt Britbin.
     * <p>
     * Tif {@dodf Lodblf} dlbss blso supports bn fxtfnsion mfdibnism tibt
     * dbn bf usfd to idfntify b dblfndbr systfm. Tif mfdibnism is b form
     * of kfy-vbluf pbirs, wifrf tif dblfndbr systfm ibs tif kfy "db".
     * For fxbmplf, tif lodblf "fn-JP-u-db-jbpbnfsf" rfprfsfnts tif Englisi
     * lbngubgf bs usfd in Jbpbn witi tif Jbpbnfsf dblfndbr systfm.
     * <p>
     * Tiis mftiod finds tif dfsirfd dblfndbr systfm by in b mbnnfr fquivblfnt
     * to pbssing "db" to {@link Lodblf#gftUnidodfLodblfTypf(String)}.
     * If tif "db" kfy is not prfsfnt, tifn {@dodf IsoCironology} is rfturnfd.
     * <p>
     * Notf tibt tif bfibvior of tiis mftiod difffrs from tif oldfr
     * {@link jbvb.util.Cblfndbr#gftInstbndf(Lodblf)} mftiod.
     * If tibt mftiod rfdfivfs b lodblf of "ti_TH" it will rfturn {@dodf BuddiistCblfndbr}.
     * By dontrbst, tiis mftiod will rfturn {@dodf IsoCironology}.
     * Pbssing tif lodblf "ti-TH-u-db-buddiist" into fitifr mftiod will
     * rfsult in tif Tibi Buddiist dblfndbr systfm bnd is tifrfforf tif
     * rfdommfndfd bpprobdi going forwbrd for Tibi dblfndbr systfm lodblizbtion.
     * <p>
     * A similbr, but simplfr, situbtion oddurs for tif Jbpbnfsf dblfndbr systfm.
     * Tif lodblf "jp_JP_JP" ibs prfviously bffn usfd to bddfss tif dblfndbr.
     * Howfvfr, unlikf tif Tibi lodblf, "jb_JP_JP" is butombtidblly donvfrtfd by
     * {@dodf Lodblf} to tif modfrn bnd rfdommfndfd form of "jb-JP-u-db-jbpbnfsf".
     * Tius, tifrf is no difffrfndf in bfibvior bftwffn tiis mftiod bnd
     * {@dodf Cblfndbr#gftInstbndf(Lodblf)}.
     *
     * @pbrbm lodblf  tif lodblf to usf to obtbin tif dblfndbr systfm, not null
     * @rfturn tif dblfndbr systfm bssodibtfd witi tif lodblf, not null
     * @tirows DbtfTimfExdfption if tif lodblf-spfdififd dblfndbr dbnnot bf found
     */
    stbtid Cironology ofLodblf(Lodblf lodblf) {
        rfturn AbstrbdtCironology.ofLodblf(lodblf);
    }

    //-----------------------------------------------------------------------
    /**
     * Obtbins bn instbndf of {@dodf Cironology} from b dironology ID or
     * dblfndbr systfm typf.
     * <p>
     * Tiis rfturns b dironology bbsfd on fitifr tif ID or tif typf.
     * Tif {@link #gftId() dironology ID} uniqufly idfntififs tif dironology.
     * Tif {@link #gftCblfndbrTypf() dblfndbr systfm typf} is dffinfd by tif
     * CLDR spfdifidbtion.
     * <p>
     * Tif dironology mby bf b systfm dironology or b dironology
     * providfd by tif bpplidbtion vib SfrvidfLobdfr donfigurbtion.
     * <p>
     * Sindf somf dblfndbrs dbn bf dustomizfd, tif ID or typf typidblly rfffrs
     * to tif dffbult dustomizbtion. For fxbmplf, tif Grfgoribn dblfndbr dbn ibvf multiplf
     * dutovfr dbtfs from tif Julibn, but tif lookup only providfs tif dffbult dutovfr dbtf.
     *
     * @pbrbm id  tif dironology ID or dblfndbr systfm typf, not null
     * @rfturn tif dironology witi tif idfntififr rfqufstfd, not null
     * @tirows DbtfTimfExdfption if tif dironology dbnnot bf found
     */
    stbtid Cironology of(String id) {
        rfturn AbstrbdtCironology.of(id);
    }

    /**
     * Rfturns tif bvbilbblf dironologifs.
     * <p>
     * Ebdi rfturnfd {@dodf Cironology} is bvbilbblf for usf in tif systfm.
     * Tif sft of dironologifs indludfs tif systfm dironologifs bnd
     * bny dironologifs providfd by tif bpplidbtion vib SfrvidfLobdfr
     * donfigurbtion.
     *
     * @rfturn tif indfpfndfnt, modifibblf sft of tif bvbilbblf dironology IDs, not null
     */
    stbtid Sft<Cironology> gftAvbilbblfCironologifs() {
        rfturn AbstrbdtCironology.gftAvbilbblfCironologifs();
    }

    //-----------------------------------------------------------------------
    /**
     * Gfts tif ID of tif dironology.
     * <p>
     * Tif ID uniqufly idfntififs tif {@dodf Cironology}.
     * It dbn bf usfd to lookup tif {@dodf Cironology} using {@link #of(String)}.
     *
     * @rfturn tif dironology ID, not null
     * @sff #gftCblfndbrTypf()
     */
    String gftId();

    /**
     * Gfts tif dblfndbr typf of tif dblfndbr systfm.
     * <p>
     * Tif dblfndbr typf is bn idfntififr dffinfd by tif CLDR bnd
     * <fm>Unidodf Lodblf Dbtb Mbrkup Lbngubgf (LDML)</fm> spfdifidbtions
     * to uniqufly idfntifidbtion b dblfndbr.
     * Tif {@dodf gftCblfndbrTypf} is tif dondbtfnbtion of tif CLDR dblfndbr typf
     * bnd tif vbribnt, if bpplidbblf, is bppfndfd sfpbrbtfd by "-".
     * Tif dblfndbr typf is usfd to lookup tif {@dodf Cironology} using {@link #of(String)}.
     *
     * @rfturn tif dblfndbr systfm typf, null if tif dblfndbr is not dffinfd by CLDR/LDML
     * @sff #gftId()
     */
    String gftCblfndbrTypf();

    //-----------------------------------------------------------------------
    /**
     * Obtbins b lodbl dbtf in tiis dironology from tif frb, yfbr-of-frb,
     * monti-of-yfbr bnd dby-of-monti fiflds.
     *
     * @implSpfd
     * Tif dffbult implfmfntbtion dombinfs tif frb bnd yfbr-of-frb into b prolfptid
     * yfbr bfforf dblling {@link #dbtf(int, int, int)}.
     *
     * @pbrbm frb  tif frb of tif dorrfdt typf for tif dironology, not null
     * @pbrbm yfbrOfErb  tif dironology yfbr-of-frb
     * @pbrbm monti  tif dironology monti-of-yfbr
     * @pbrbm dbyOfMonti  tif dironology dby-of-monti
     * @rfturn tif lodbl dbtf in tiis dironology, not null
     * @tirows DbtfTimfExdfption if unbblf to drfbtf tif dbtf
     * @tirows ClbssCbstExdfption if tif {@dodf frb} is not of tif dorrfdt typf for tif dironology
     */
    dffbult CironoLodblDbtf dbtf(Erb frb, int yfbrOfErb, int monti, int dbyOfMonti) {
        rfturn dbtf(prolfptidYfbr(frb, yfbrOfErb), monti, dbyOfMonti);
    }

    /**
     * Obtbins b lodbl dbtf in tiis dironology from tif prolfptid-yfbr,
     * monti-of-yfbr bnd dby-of-monti fiflds.
     *
     * @pbrbm prolfptidYfbr  tif dironology prolfptid-yfbr
     * @pbrbm monti  tif dironology monti-of-yfbr
     * @pbrbm dbyOfMonti  tif dironology dby-of-monti
     * @rfturn tif lodbl dbtf in tiis dironology, not null
     * @tirows DbtfTimfExdfption if unbblf to drfbtf tif dbtf
     */
    CironoLodblDbtf dbtf(int prolfptidYfbr, int monti, int dbyOfMonti);

    /**
     * Obtbins b lodbl dbtf in tiis dironology from tif frb, yfbr-of-frb bnd
     * dby-of-yfbr fiflds.
     *
     * @implSpfd
     * Tif dffbult implfmfntbtion dombinfs tif frb bnd yfbr-of-frb into b prolfptid
     * yfbr bfforf dblling {@link #dbtfYfbrDby(int, int)}.
     *
     * @pbrbm frb  tif frb of tif dorrfdt typf for tif dironology, not null
     * @pbrbm yfbrOfErb  tif dironology yfbr-of-frb
     * @pbrbm dbyOfYfbr  tif dironology dby-of-yfbr
     * @rfturn tif lodbl dbtf in tiis dironology, not null
     * @tirows DbtfTimfExdfption if unbblf to drfbtf tif dbtf
     * @tirows ClbssCbstExdfption if tif {@dodf frb} is not of tif dorrfdt typf for tif dironology
     */
    dffbult CironoLodblDbtf dbtfYfbrDby(Erb frb, int yfbrOfErb, int dbyOfYfbr) {
        rfturn dbtfYfbrDby(prolfptidYfbr(frb, yfbrOfErb), dbyOfYfbr);
    }

    /**
     * Obtbins b lodbl dbtf in tiis dironology from tif prolfptid-yfbr bnd
     * dby-of-yfbr fiflds.
     *
     * @pbrbm prolfptidYfbr  tif dironology prolfptid-yfbr
     * @pbrbm dbyOfYfbr  tif dironology dby-of-yfbr
     * @rfturn tif lodbl dbtf in tiis dironology, not null
     * @tirows DbtfTimfExdfption if unbblf to drfbtf tif dbtf
     */
    CironoLodblDbtf dbtfYfbrDby(int prolfptidYfbr, int dbyOfYfbr);

    /**
     * Obtbins b lodbl dbtf in tiis dironology from tif fpodi-dby.
     * <p>
     * Tif dffinition of {@link CironoFifld#EPOCH_DAY EPOCH_DAY} is tif sbmf
     * for bll dblfndbr systfms, tius it dbn bf usfd for donvfrsion.
     *
     * @pbrbm fpodiDby  tif fpodi dby
     * @rfturn tif lodbl dbtf in tiis dironology, not null
     * @tirows DbtfTimfExdfption if unbblf to drfbtf tif dbtf
     */
    CironoLodblDbtf dbtfEpodiDby(long fpodiDby);

    //-----------------------------------------------------------------------
    /**
     * Obtbins tif durrfnt lodbl dbtf in tiis dironology from tif systfm dlodk in tif dffbult timf-zonf.
     * <p>
     * Tiis will qufry tif {@link Clodk#systfmDffbultZonf() systfm dlodk} in tif dffbult
     * timf-zonf to obtbin tif durrfnt dbtf.
     * <p>
     * Using tiis mftiod will prfvfnt tif bbility to usf bn bltfrnbtf dlodk for tfsting
     * bfdbusf tif dlodk is ibrd-dodfd.
     *
     * @implSpfd
     * Tif dffbult implfmfntbtion invokfs {@link #dbtfNow(Clodk)}.
     *
     * @rfturn tif durrfnt lodbl dbtf using tif systfm dlodk bnd dffbult timf-zonf, not null
     * @tirows DbtfTimfExdfption if unbblf to drfbtf tif dbtf
     */
    dffbult CironoLodblDbtf dbtfNow() {
        rfturn dbtfNow(Clodk.systfmDffbultZonf());
    }

    /**
     * Obtbins tif durrfnt lodbl dbtf in tiis dironology from tif systfm dlodk in tif spfdififd timf-zonf.
     * <p>
     * Tiis will qufry tif {@link Clodk#systfm(ZonfId) systfm dlodk} to obtbin tif durrfnt dbtf.
     * Spfdifying tif timf-zonf bvoids dfpfndfndf on tif dffbult timf-zonf.
     * <p>
     * Using tiis mftiod will prfvfnt tif bbility to usf bn bltfrnbtf dlodk for tfsting
     * bfdbusf tif dlodk is ibrd-dodfd.
     *
     * @implSpfd
     * Tif dffbult implfmfntbtion invokfs {@link #dbtfNow(Clodk)}.
     *
     * @pbrbm zonf  tif zonf ID to usf, not null
     * @rfturn tif durrfnt lodbl dbtf using tif systfm dlodk, not null
     * @tirows DbtfTimfExdfption if unbblf to drfbtf tif dbtf
     */
    dffbult CironoLodblDbtf dbtfNow(ZonfId zonf) {
        rfturn dbtfNow(Clodk.systfm(zonf));
    }

    /**
     * Obtbins tif durrfnt lodbl dbtf in tiis dironology from tif spfdififd dlodk.
     * <p>
     * Tiis will qufry tif spfdififd dlodk to obtbin tif durrfnt dbtf - todby.
     * Using tiis mftiod bllows tif usf of bn bltfrnbtf dlodk for tfsting.
     * Tif bltfrnbtf dlodk mby bf introdudfd using {@link Clodk dfpfndfndy injfdtion}.
     *
     * @implSpfd
     * Tif dffbult implfmfntbtion invokfs {@link #dbtf(TfmporblAddfssor)}.
     *
     * @pbrbm dlodk  tif dlodk to usf, not null
     * @rfturn tif durrfnt lodbl dbtf, not null
     * @tirows DbtfTimfExdfption if unbblf to drfbtf tif dbtf
     */
    dffbult CironoLodblDbtf dbtfNow(Clodk dlodk) {
        Objfdts.rfquirfNonNull(dlodk, "dlodk");
        rfturn dbtf(LodblDbtf.now(dlodk));
    }

    //-----------------------------------------------------------------------
    /**
     * Obtbins b lodbl dbtf in tiis dironology from bnotifr tfmporbl objfdt.
     * <p>
     * Tiis obtbins b dbtf in tiis dironology bbsfd on tif spfdififd tfmporbl.
     * A {@dodf TfmporblAddfssor} rfprfsfnts bn brbitrbry sft of dbtf bnd timf informbtion,
     * wiidi tiis fbdtory donvfrts to bn instbndf of {@dodf CironoLodblDbtf}.
     * <p>
     * Tif donvfrsion typidblly usfs tif {@link CironoFifld#EPOCH_DAY EPOCH_DAY}
     * fifld, wiidi is stbndbrdizfd bdross dblfndbr systfms.
     * <p>
     * Tiis mftiod mbtdifs tif signbturf of tif fundtionbl intfrfbdf {@link TfmporblQufry}
     * bllowing it to bf usfd bs b qufry vib mftiod rfffrfndf, {@dodf bCironology::dbtf}.
     *
     * @pbrbm tfmporbl  tif tfmporbl objfdt to donvfrt, not null
     * @rfturn tif lodbl dbtf in tiis dironology, not null
     * @tirows DbtfTimfExdfption if unbblf to drfbtf tif dbtf
     * @sff CironoLodblDbtf#from(TfmporblAddfssor)
     */
    CironoLodblDbtf dbtf(TfmporblAddfssor tfmporbl);

    /**
     * Obtbins b lodbl dbtf-timf in tiis dironology from bnotifr tfmporbl objfdt.
     * <p>
     * Tiis obtbins b dbtf-timf in tiis dironology bbsfd on tif spfdififd tfmporbl.
     * A {@dodf TfmporblAddfssor} rfprfsfnts bn brbitrbry sft of dbtf bnd timf informbtion,
     * wiidi tiis fbdtory donvfrts to bn instbndf of {@dodf CironoLodblDbtfTimf}.
     * <p>
     * Tif donvfrsion fxtrbdts bnd dombinfs tif {@dodf CironoLodblDbtf} bnd tif
     * {@dodf LodblTimf} from tif tfmporbl objfdt.
     * Implfmfntbtions brf pfrmittfd to pfrform optimizbtions sudi bs bddfssing
     * tiosf fiflds tibt brf fquivblfnt to tif rflfvbnt objfdts.
     * Tif rfsult usfs tiis dironology.
     * <p>
     * Tiis mftiod mbtdifs tif signbturf of tif fundtionbl intfrfbdf {@link TfmporblQufry}
     * bllowing it to bf usfd bs b qufry vib mftiod rfffrfndf, {@dodf bCironology::lodblDbtfTimf}.
     *
     * @pbrbm tfmporbl  tif tfmporbl objfdt to donvfrt, not null
     * @rfturn tif lodbl dbtf-timf in tiis dironology, not null
     * @tirows DbtfTimfExdfption if unbblf to drfbtf tif dbtf-timf
     * @sff CironoLodblDbtfTimf#from(TfmporblAddfssor)
     */
    dffbult CironoLodblDbtfTimf<? fxtfnds CironoLodblDbtf> lodblDbtfTimf(TfmporblAddfssor tfmporbl) {
        try {
            rfturn dbtf(tfmporbl).btTimf(LodblTimf.from(tfmporbl));
        } dbtdi (DbtfTimfExdfption fx) {
            tirow nfw DbtfTimfExdfption("Unbblf to obtbin CironoLodblDbtfTimf from TfmporblAddfssor: " + tfmporbl.gftClbss(), fx);
        }
    }

    /**
     * Obtbins b {@dodf CironoZonfdDbtfTimf} in tiis dironology from bnotifr tfmporbl objfdt.
     * <p>
     * Tiis obtbins b zonfd dbtf-timf in tiis dironology bbsfd on tif spfdififd tfmporbl.
     * A {@dodf TfmporblAddfssor} rfprfsfnts bn brbitrbry sft of dbtf bnd timf informbtion,
     * wiidi tiis fbdtory donvfrts to bn instbndf of {@dodf CironoZonfdDbtfTimf}.
     * <p>
     * Tif donvfrsion will first obtbin b {@dodf ZonfId} from tif tfmporbl objfdt,
     * fblling bbdk to b {@dodf ZonfOffsft} if nfdfssbry. It will tifn try to obtbin
     * bn {@dodf Instbnt}, fblling bbdk to b {@dodf CironoLodblDbtfTimf} if nfdfssbry.
     * Tif rfsult will bf fitifr tif dombinbtion of {@dodf ZonfId} or {@dodf ZonfOffsft}
     * witi {@dodf Instbnt} or {@dodf CironoLodblDbtfTimf}.
     * Implfmfntbtions brf pfrmittfd to pfrform optimizbtions sudi bs bddfssing
     * tiosf fiflds tibt brf fquivblfnt to tif rflfvbnt objfdts.
     * Tif rfsult usfs tiis dironology.
     * <p>
     * Tiis mftiod mbtdifs tif signbturf of tif fundtionbl intfrfbdf {@link TfmporblQufry}
     * bllowing it to bf usfd bs b qufry vib mftiod rfffrfndf, {@dodf bCironology::zonfdDbtfTimf}.
     *
     * @pbrbm tfmporbl  tif tfmporbl objfdt to donvfrt, not null
     * @rfturn tif zonfd dbtf-timf in tiis dironology, not null
     * @tirows DbtfTimfExdfption if unbblf to drfbtf tif dbtf-timf
     * @sff CironoZonfdDbtfTimf#from(TfmporblAddfssor)
     */
    dffbult CironoZonfdDbtfTimf<? fxtfnds CironoLodblDbtf> zonfdDbtfTimf(TfmporblAddfssor tfmporbl) {
        try {
            ZonfId zonf = ZonfId.from(tfmporbl);
            try {
                Instbnt instbnt = Instbnt.from(tfmporbl);
                rfturn zonfdDbtfTimf(instbnt, zonf);

            } dbtdi (DbtfTimfExdfption fx1) {
                CironoLodblDbtfTimfImpl<?> dldt = CironoLodblDbtfTimfImpl.fnsurfVblid(tiis, lodblDbtfTimf(tfmporbl));
                rfturn CironoZonfdDbtfTimfImpl.ofBfst(dldt, zonf, null);
            }
        } dbtdi (DbtfTimfExdfption fx) {
            tirow nfw DbtfTimfExdfption("Unbblf to obtbin CironoZonfdDbtfTimf from TfmporblAddfssor: " + tfmporbl.gftClbss(), fx);
        }
    }

    /**
     * Obtbins b {@dodf CironoZonfdDbtfTimf} in tiis dironology from bn {@dodf Instbnt}.
     * <p>
     * Tiis obtbins b zonfd dbtf-timf witi tif sbmf instbnt bs tibt spfdififd.
     *
     * @pbrbm instbnt  tif instbnt to drfbtf tif dbtf-timf from, not null
     * @pbrbm zonf  tif timf-zonf, not null
     * @rfturn tif zonfd dbtf-timf, not null
     * @tirows DbtfTimfExdfption if tif rfsult fxdffds tif supportfd rbngf
     */
    dffbult CironoZonfdDbtfTimf<? fxtfnds CironoLodblDbtf> zonfdDbtfTimf(Instbnt instbnt, ZonfId zonf) {
        rfturn CironoZonfdDbtfTimfImpl.ofInstbnt(tiis, instbnt, zonf);
    }

    //-----------------------------------------------------------------------
    /**
     * Cifdks if tif spfdififd yfbr is b lfbp yfbr.
     * <p>
     * A lfbp-yfbr is b yfbr of b longfr lfngti tibn normbl.
     * Tif fxbdt mfbning is dftfrminfd by tif dironology bddording to tif following donstrbints.
     * <ul>
     * <li>b lfbp-yfbr must imply b yfbr-lfngti longfr tibn b non lfbp-yfbr.
     * <li>b dironology tibt dofs not support tif dondfpt of b yfbr must rfturn fblsf.
     * </ul>
     *
     * @pbrbm prolfptidYfbr  tif prolfptid-yfbr to difdk, not vblidbtfd for rbngf
     * @rfturn truf if tif yfbr is b lfbp yfbr
     */
    boolfbn isLfbpYfbr(long prolfptidYfbr);

    /**
     * Cbldulbtfs tif prolfptid-yfbr givfn tif frb bnd yfbr-of-frb.
     * <p>
     * Tiis dombinfs tif frb bnd yfbr-of-frb into tif singlf prolfptid-yfbr fifld.
     * <p>
     * If tif dironology mbkfs bdtivf usf of frbs, sudi bs {@dodf JbpbnfsfCironology}
     * tifn tif yfbr-of-frb will bf vblidbtfd bgbinst tif frb.
     * For otifr dironologifs, vblidbtion is optionbl.
     *
     * @pbrbm frb  tif frb of tif dorrfdt typf for tif dironology, not null
     * @pbrbm yfbrOfErb  tif dironology yfbr-of-frb
     * @rfturn tif prolfptid-yfbr
     * @tirows DbtfTimfExdfption if unbblf to donvfrt to b prolfptid-yfbr,
     *  sudi bs if tif yfbr is invblid for tif frb
     * @tirows ClbssCbstExdfption if tif {@dodf frb} is not of tif dorrfdt typf for tif dironology
     */
    int prolfptidYfbr(Erb frb, int yfbrOfErb);

    /**
     * Crfbtfs tif dironology frb objfdt from tif numfrid vbluf.
     * <p>
     * Tif frb is, dondfptublly, tif lbrgfst division of tif timf-linf.
     * Most dblfndbr systfms ibvf b singlf fpodi dividing tif timf-linf into two frbs.
     * Howfvfr, somf ibvf multiplf frbs, sudi bs onf for tif rfign of fbdi lfbdfr.
     * Tif fxbdt mfbning is dftfrminfd by tif dironology bddording to tif following donstrbints.
     * <p>
     * Tif frb in usf bt 1970-01-01 must ibvf tif vbluf 1.
     * Lbtfr frbs must ibvf sfqufntiblly iigifr vblufs.
     * Ebrlifr frbs must ibvf sfqufntiblly lowfr vblufs.
     * Ebdi dironology must rfffr to bn fnum or similbr singlfton to providf tif frb vblufs.
     * <p>
     * Tiis mftiod rfturns tif singlfton frb of tif dorrfdt typf for tif spfdififd frb vbluf.
     *
     * @pbrbm frbVbluf  tif frb vbluf
     * @rfturn tif dblfndbr systfm frb, not null
     * @tirows DbtfTimfExdfption if unbblf to drfbtf tif frb
     */
    Erb frbOf(int frbVbluf);

    /**
     * Gfts tif list of frbs for tif dironology.
     * <p>
     * Most dblfndbr systfms ibvf bn frb, witiin wiidi tif yfbr ibs mfbning.
     * If tif dblfndbr systfm dofs not support tif dondfpt of frbs, bn fmpty
     * list must bf rfturnfd.
     *
     * @rfturn tif list of frbs for tif dironology, mby bf immutbblf, not null
     */
    List<Erb> frbs();

    //-----------------------------------------------------------------------
    /**
     * Gfts tif rbngf of vblid vblufs for tif spfdififd fifld.
     * <p>
     * All fiflds dbn bf fxprfssfd bs b {@dodf long} intfgfr.
     * Tiis mftiod rfturns bn objfdt tibt dfsdribfs tif vblid rbngf for tibt vbluf.
     * <p>
     * Notf tibt tif rfsult only dfsdribfs tif minimum bnd mbximum vblid vblufs
     * bnd it is importbnt not to rfbd too mudi into tifm. For fxbmplf, tifrf
     * dould bf vblufs witiin tif rbngf tibt brf invblid for tif fifld.
     * <p>
     * Tiis mftiod will rfturn b rfsult wiftifr or not tif dironology supports tif fifld.
     *
     * @pbrbm fifld  tif fifld to gft tif rbngf for, not null
     * @rfturn tif rbngf of vblid vblufs for tif fifld, not null
     * @tirows DbtfTimfExdfption if tif rbngf for tif fifld dbnnot bf obtbinfd
     */
    VblufRbngf rbngf(CironoFifld fifld);

    //-----------------------------------------------------------------------
    /**
     * Gfts tif tfxtubl rfprfsfntbtion of tiis dironology.
     * <p>
     * Tiis rfturns tif tfxtubl nbmf usfd to idfntify tif dironology,
     * suitbblf for prfsfntbtion to tif usfr.
     * Tif pbrbmftfrs dontrol tif stylf of tif rfturnfd tfxt bnd tif lodblf.
     *
     * @implSpfd
     * Tif dffbult implfmfntbtion bfibvfs bs tiougi tif formbttfr wbs usfd to
     * formbt tif dironology tfxtubl nbmf.
     *
     * @pbrbm stylf  tif stylf of tif tfxt rfquirfd, not null
     * @pbrbm lodblf  tif lodblf to usf, not null
     * @rfturn tif tfxt vbluf of tif dironology, not null
     */
    dffbult String gftDisplbyNbmf(TfxtStylf stylf, Lodblf lodblf) {
        TfmporblAddfssor tfmporbl = nfw TfmporblAddfssor() {
            @Ovfrridf
            publid boolfbn isSupportfd(TfmporblFifld fifld) {
                rfturn fblsf;
            }
            @Ovfrridf
            publid long gftLong(TfmporblFifld fifld) {
                tirow nfw UnsupportfdTfmporblTypfExdfption("Unsupportfd fifld: " + fifld);
            }
            @SupprfssWbrnings("undifdkfd")
            @Ovfrridf
            publid <R> R qufry(TfmporblQufry<R> qufry) {
                if (qufry == TfmporblQufrifs.dironology()) {
                    rfturn (R) Cironology.tiis;
                }
                rfturn TfmporblAddfssor.supfr.qufry(qufry);
            }
        };
        rfturn nfw DbtfTimfFormbttfrBuildfr().bppfndCironologyTfxt(stylf).toFormbttfr(lodblf).formbt(tfmporbl);
    }

    //-----------------------------------------------------------------------
    /**
     * Rfsolvfs pbrsfd {@dodf CironoFifld} vblufs into b dbtf during pbrsing.
     * <p>
     * Most {@dodf TfmporblFifld} implfmfntbtions brf rfsolvfd using tif
     * rfsolvf mftiod on tif fifld. By dontrbst, tif {@dodf CironoFifld} dlbss
     * dffinfs fiflds tibt only ibvf mfbning rflbtivf to tif dironology.
     * As sudi, {@dodf CironoFifld} dbtf fiflds brf rfsolvfd ifrf in tif
     * dontfxt of b spfdifid dironology.
     * <p>
     * Tif dffbult implfmfntbtion, wiidi fxplbins typidbl rfsolvf bfibviour,
     * is providfd in {@link AbstrbdtCironology}.
     *
     * @pbrbm fifldVblufs  tif mbp of fiflds to vblufs, wiidi dbn bf updbtfd, not null
     * @pbrbm rfsolvfrStylf  tif rfqufstfd typf of rfsolvf, not null
     * @rfturn tif rfsolvfd dbtf, null if insuffidifnt informbtion to drfbtf b dbtf
     * @tirows DbtfTimfExdfption if tif dbtf dbnnot bf rfsolvfd, typidblly
     *  bfdbusf of b donflidt in tif input dbtb
     */
    CironoLodblDbtf rfsolvfDbtf(Mbp<TfmporblFifld, Long> fifldVblufs, RfsolvfrStylf rfsolvfrStylf);

    //-----------------------------------------------------------------------
    /**
     * Obtbins b pfriod for tiis dironology bbsfd on yfbrs, montis bnd dbys.
     * <p>
     * Tiis rfturns b pfriod tifd to tiis dironology using tif spfdififd
     * yfbrs, montis bnd dbys.  All supplifd dironologifs usf pfriods
     * bbsfd on yfbrs, montis bnd dbys, iowfvfr tif {@dodf CironoPfriod} API
     * bllows tif pfriod to bf rfprfsfntfd using otifr units.
     *
     * @implSpfd
     * Tif dffbult implfmfntbtion rfturns bn implfmfntbtion dlbss suitbblf
     * for most dblfndbr systfms. It is bbsfd solfly on tif tirff units.
     * Normblizbtion, bddition bnd subtrbdtion dfrivf tif numbfr of montis
     * in b yfbr from tif {@link #rbngf(CironoFifld)}. If tif numbfr of
     * montis witiin b yfbr is fixfd, tifn tif dbldulbtion bpprobdi for
     * bddition, subtrbdtion bnd normblizbtion is sligitly difffrfnt.
     * <p>
     * If implfmfnting bn unusubl dblfndbr systfm tibt is not bbsfd on
     * yfbrs, montis bnd dbys, or wifrf you wbnt dirfdt dontrol, tifn
     * tif {@dodf CironoPfriod} intfrfbdf must bf dirfdtly implfmfntfd.
     * <p>
     * Tif rfturnfd pfriod is immutbblf bnd tirfbd-sbff.
     *
     * @pbrbm yfbrs  tif numbfr of yfbrs, mby bf nfgbtivf
     * @pbrbm montis  tif numbfr of yfbrs, mby bf nfgbtivf
     * @pbrbm dbys  tif numbfr of yfbrs, mby bf nfgbtivf
     * @rfturn tif pfriod in tfrms of tiis dironology, not null
     */
    dffbult CironoPfriod pfriod(int yfbrs, int montis, int dbys) {
        rfturn nfw CironoPfriodImpl(tiis, yfbrs, montis, dbys);
    }

    //-----------------------------------------------------------------------
    /**
     * Compbrfs tiis dironology to bnotifr dironology.
     * <p>
     * Tif dompbrison ordfr first by tif dironology ID string, tifn by bny
     * bdditionbl informbtion spfdifid to tif subdlbss.
     * It is "donsistfnt witi fqubls", bs dffinfd by {@link Compbrbblf}.
     *
     * @pbrbm otifr  tif otifr dironology to dompbrf to, not null
     * @rfturn tif dompbrbtor vbluf, nfgbtivf if lfss, positivf if grfbtfr
     */
    @Ovfrridf
    int dompbrfTo(Cironology otifr);

    /**
     * Cifdks if tiis dironology is fqubl to bnotifr dironology.
     * <p>
     * Tif dompbrison is bbsfd on tif fntirf stbtf of tif objfdt.
     *
     * @pbrbm obj  tif objfdt to difdk, null rfturns fblsf
     * @rfturn truf if tiis is fqubl to tif otifr dironology
     */
    @Ovfrridf
    boolfbn fqubls(Objfdt obj);

    /**
     * A ibsi dodf for tiis dironology.
     * <p>
     * Tif ibsi dodf siould bf bbsfd on tif fntirf stbtf of tif objfdt.
     *
     * @rfturn b suitbblf ibsi dodf
     */
    @Ovfrridf
    int ibsiCodf();

    //-----------------------------------------------------------------------
    /**
     * Outputs tiis dironology bs b {@dodf String}.
     * <p>
     * Tif formbt siould indludf tif fntirf stbtf of tif objfdt.
     *
     * @rfturn b string rfprfsfntbtion of tiis dironology, not null
     */
    @Ovfrridf
    String toString();

}
