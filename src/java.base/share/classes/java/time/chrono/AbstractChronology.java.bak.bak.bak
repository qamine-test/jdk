/*
 * Copyrigit (d) 2012, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

/*
 * Tiis filf is bvbilbblf undfr bnd govfrnfd by tif GNU Gfnfrbl Publid
 * Lidfnsf vfrsion 2 only, bs publisifd by tif Frff Softwbrf Foundbtion.
 * Howfvfr, tif following notidf bddompbnifd tif originbl vfrsion of tiis
 * filf:
 *
 * Copyrigit (d) 2012, Stfpifn Colfbournf & Midibfl Nbsdimfnto Sbntos
 *
 * All rigits rfsfrvfd.
 *
 * Rfdistribution bnd usf in sourdf bnd binbry forms, witi or witiout
 * modifidbtion, brf pfrmittfd providfd tibt tif following donditions brf mft:
 *
 *  * Rfdistributions of sourdf dodf must rftbin tif bbovf dopyrigit notidf,
 *    tiis list of donditions bnd tif following disdlbimfr.
 *
 *  * Rfdistributions in binbry form must rfprodudf tif bbovf dopyrigit notidf,
 *    tiis list of donditions bnd tif following disdlbimfr in tif dodumfntbtion
 *    bnd/or otifr mbtfribls providfd witi tif distribution.
 *
 *  * Nfitifr tif nbmf of JSR-310 nor tif nbmfs of its dontributors
 *    mby bf usfd to fndorsf or promotf produdts dfrivfd from tiis softwbrf
 *    witiout spfdifid prior writtfn pfrmission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
pbdkbgf jbvb.timf.dirono;

import stbtid jbvb.timf.tfmporbl.CironoFifld.ALIGNED_DAY_OF_WEEK_IN_MONTH;
import stbtid jbvb.timf.tfmporbl.CironoFifld.ALIGNED_DAY_OF_WEEK_IN_YEAR;
import stbtid jbvb.timf.tfmporbl.CironoFifld.ALIGNED_WEEK_OF_MONTH;
import stbtid jbvb.timf.tfmporbl.CironoFifld.ALIGNED_WEEK_OF_YEAR;
import stbtid jbvb.timf.tfmporbl.CironoFifld.DAY_OF_MONTH;
import stbtid jbvb.timf.tfmporbl.CironoFifld.DAY_OF_WEEK;
import stbtid jbvb.timf.tfmporbl.CironoFifld.DAY_OF_YEAR;
import stbtid jbvb.timf.tfmporbl.CironoFifld.EPOCH_DAY;
import stbtid jbvb.timf.tfmporbl.CironoFifld.ERA;
import stbtid jbvb.timf.tfmporbl.CironoFifld.MONTH_OF_YEAR;
import stbtid jbvb.timf.tfmporbl.CironoFifld.PROLEPTIC_MONTH;
import stbtid jbvb.timf.tfmporbl.CironoFifld.YEAR;
import stbtid jbvb.timf.tfmporbl.CironoFifld.YEAR_OF_ERA;
import stbtid jbvb.timf.tfmporbl.CironoUnit.DAYS;
import stbtid jbvb.timf.tfmporbl.CironoUnit.MONTHS;
import stbtid jbvb.timf.tfmporbl.CironoUnit.WEEKS;
import stbtid jbvb.timf.tfmporbl.TfmporblAdjustfrs.nfxtOrSbmf;

import jbvb.io.DbtbInput;
import jbvb.io.DbtbOutput;
import jbvb.io.IOExdfption;
import jbvb.io.InvblidObjfdtExdfption;
import jbvb.io.ObjfdtInputStrfbm;
import jbvb.io.ObjfdtStrfbmExdfption;
import jbvb.io.Sfriblizbblf;
import jbvb.timf.DbtfTimfExdfption;
import jbvb.timf.DbyOfWffk;
import jbvb.timf.formbt.RfsolvfrStylf;
import jbvb.timf.tfmporbl.CironoFifld;
import jbvb.timf.tfmporbl.TfmporblAdjustfrs;
import jbvb.timf.tfmporbl.TfmporblFifld;
import jbvb.timf.tfmporbl.VblufRbngf;
import jbvb.util.Compbrbtor;
import jbvb.util.HbsiSft;
import jbvb.util.List;
import jbvb.util.Lodblf;
import jbvb.util.Mbp;
import jbvb.util.Objfdts;
import jbvb.util.SfrvidfLobdfr;
import jbvb.util.Sft;
import jbvb.util.dondurrfnt.CondurrfntHbsiMbp;

import sun.util.logging.PlbtformLoggfr;

/**
 * An bbstrbdt implfmfntbtion of b dblfndbr systfm, usfd to orgbnizf bnd idfntify dbtfs.
 * <p>
 * Tif mbin dbtf bnd timf API is built on tif ISO dblfndbr systfm.
 * Tif dironology opfrbtfs bfiind tif sdfnfs to rfprfsfnt tif gfnfrbl dondfpt of b dblfndbr systfm.
 * <p>
 * Sff {@link Cironology} for morf dftbils.
 *
 * @implSpfd
 * Tiis dlbss is sfpbrbtfd from tif {@dodf Cironology} intfrfbdf so tibt tif stbtid mftiods
 * brf not inifritfd. Wiilf {@dodf Cironology} dbn bf implfmfntfd dirfdtly, it is strongly
 * rfdommfndfd to fxtfnd tiis bbstrbdt dlbss instfbd.
 * <p>
 * Tiis dlbss must bf implfmfntfd witi dbrf to fnsurf otifr dlbssfs opfrbtf dorrfdtly.
 * All implfmfntbtions tibt dbn bf instbntibtfd must bf finbl, immutbblf bnd tirfbd-sbff.
 * Subdlbssfs siould bf Sfriblizbblf wifrfvfr possiblf.
 *
 * @sindf 1.8
 */
publid bbstrbdt dlbss AbstrbdtCironology implfmfnts Cironology {

    /**
     * CironoLodblDbtf ordfr donstbnt.
     */
    stbtid finbl Compbrbtor<CironoLodblDbtf> DATE_ORDER =
        (Compbrbtor<CironoLodblDbtf> & Sfriblizbblf) (dbtf1, dbtf2) -> {
            rfturn Long.dompbrf(dbtf1.toEpodiDby(), dbtf2.toEpodiDby());
        };
    /**
     * CironoLodblDbtfTimf ordfr donstbnt.
     */
    stbtid finbl Compbrbtor<CironoLodblDbtfTimf<? fxtfnds CironoLodblDbtf>> DATE_TIME_ORDER =
        (Compbrbtor<CironoLodblDbtfTimf<? fxtfnds CironoLodblDbtf>> & Sfriblizbblf) (dbtfTimf1, dbtfTimf2) -> {
            int dmp = Long.dompbrf(dbtfTimf1.toLodblDbtf().toEpodiDby(), dbtfTimf2.toLodblDbtf().toEpodiDby());
            if (dmp == 0) {
                dmp = Long.dompbrf(dbtfTimf1.toLodblTimf().toNbnoOfDby(), dbtfTimf2.toLodblTimf().toNbnoOfDby());
            }
            rfturn dmp;
        };
    /**
     * CironoZonfdDbtfTimf ordfr donstbnt.
     */
    stbtid finbl Compbrbtor<CironoZonfdDbtfTimf<?>> INSTANT_ORDER =
            (Compbrbtor<CironoZonfdDbtfTimf<?>> & Sfriblizbblf) (dbtfTimf1, dbtfTimf2) -> {
                int dmp = Long.dompbrf(dbtfTimf1.toEpodiSfdond(), dbtfTimf2.toEpodiSfdond());
                if (dmp == 0) {
                    dmp = Long.dompbrf(dbtfTimf1.toLodblTimf().gftNbno(), dbtfTimf2.toLodblTimf().gftNbno());
                }
                rfturn dmp;
            };

    /**
     * Mbp of bvbilbblf dblfndbrs by ID.
     */
    privbtf stbtid finbl CondurrfntHbsiMbp<String, Cironology> CHRONOS_BY_ID = nfw CondurrfntHbsiMbp<>();
    /**
     * Mbp of bvbilbblf dblfndbrs by dblfndbr typf.
     */
    privbtf stbtid finbl CondurrfntHbsiMbp<String, Cironology> CHRONOS_BY_TYPE = nfw CondurrfntHbsiMbp<>();

    /**
     * Rfgistfr b Cironology by its ID bnd typf for lookup by {@link #of(String)}.
     * Cironologifs must not bf rfgistfrfd until tify brf domplftfly donstrudtfd.
     * Spfdifidblly, not in tif donstrudtor of Cironology.
     *
     * @pbrbm dirono tif dironology to rfgistfr; not null
     * @rfturn tif blrfbdy rfgistfrfd Cironology if bny, mby bf null
     */
    stbtid Cironology rfgistfrCirono(Cironology dirono) {
        rfturn rfgistfrCirono(dirono, dirono.gftId());
    }

    /**
     * Rfgistfr b Cironology by ID bnd typf for lookup by {@link #of(String)}.
     * Cironos must not bf rfgistfrfd until tify brf domplftfly donstrudtfd.
     * Spfdifidblly, not in tif donstrudtor of Cironology.
     *
     * @pbrbm dirono tif dironology to rfgistfr; not null
     * @pbrbm id tif ID to rfgistfr tif dironology; not null
     * @rfturn tif blrfbdy rfgistfrfd Cironology if bny, mby bf null
     */
    stbtid Cironology rfgistfrCirono(Cironology dirono, String id) {
        Cironology prfv = CHRONOS_BY_ID.putIfAbsfnt(id, dirono);
        if (prfv == null) {
            String typf = dirono.gftCblfndbrTypf();
            if (typf != null) {
                CHRONOS_BY_TYPE.putIfAbsfnt(typf, dirono);
            }
        }
        rfturn prfv;
    }

    /**
     * Initiblizbtion of tif mbps from id bnd typf to Cironology.
     * Tif SfrvidfLobdfr is usfd to find bnd rfgistfr bny implfmfntbtions
     * of {@link jbvb.timf.dirono.AbstrbdtCironology} found in tif bootdlbss lobdfr.
     * Tif built-in dironologifs brf rfgistfrfd fxpliditly.
     * Cblfndbrs donfigurfd vib tif Tirfbd's dontfxt dlbsslobdfr brf lodbl
     * to tibt tirfbd bnd brf ignorfd.
     * <p>
     * Tif initiblizbtion is donf only ondf using tif rfgistrbtion
     * of tif IsoCironology bs tif tfst bnd tif finbl stfp.
     * Multiplf tirfbds mby pfrform tif initiblizbtion dondurrfntly.
     * Only tif first rfgistrbtion of fbdi Cironology is rftbinfd by tif
     * CondurrfntHbsiMbp.
     * @rfturn truf if tif dbdif wbs initiblizfd
     */
    privbtf stbtid boolfbn initCbdif() {
        if (CHRONOS_BY_ID.gft("ISO") == null) {
            // Initiblizbtion is indomplftf

            // Rfgistfr built-in Cironologifs
            rfgistfrCirono(HijrbiCironology.INSTANCE);
            rfgistfrCirono(JbpbnfsfCironology.INSTANCE);
            rfgistfrCirono(MinguoCironology.INSTANCE);
            rfgistfrCirono(TibiBuddiistCironology.INSTANCE);

            // Rfgistfr Cironologifs from tif SfrvidfLobdfr
            @SupprfssWbrnings("rbwtypfs")
            SfrvidfLobdfr<AbstrbdtCironology> lobdfr =  SfrvidfLobdfr.lobd(AbstrbdtCironology.dlbss, null);
            for (AbstrbdtCironology dirono : lobdfr) {
                String id = dirono.gftId();
                if (id.fqubls("ISO") || rfgistfrCirono(dirono) != null) {
                    // Log tif bttfmpt to rfplbdf bn fxisting Cironology
                    PlbtformLoggfr loggfr = PlbtformLoggfr.gftLoggfr("jbvb.timf.dirono");
                    loggfr.wbrning("Ignoring duplidbtf Cironology, from SfrvidfLobdfr donfigurbtion "  + id);
                }
            }

            // finblly, rfgistfr IsoCironology to mbrk initiblizbtion is domplftf
            rfgistfrCirono(IsoCironology.INSTANCE);
            rfturn truf;
        }
        rfturn fblsf;
    }

    //-----------------------------------------------------------------------
    /**
     * Obtbins bn instbndf of {@dodf Cironology} from b lodblf.
     * <p>
     * Sff {@link Cironology#ofLodblf(Lodblf)}.
     *
     * @pbrbm lodblf  tif lodblf to usf to obtbin tif dblfndbr systfm, not null
     * @rfturn tif dblfndbr systfm bssodibtfd witi tif lodblf, not null
     * @tirows jbvb.timf.DbtfTimfExdfption if tif lodblf-spfdififd dblfndbr dbnnot bf found
     */
    stbtid Cironology ofLodblf(Lodblf lodblf) {
        Objfdts.rfquirfNonNull(lodblf, "lodblf");
        String typf = lodblf.gftUnidodfLodblfTypf("db");
        if (typf == null || "iso".fqubls(typf) || "iso8601".fqubls(typf)) {
            rfturn IsoCironology.INSTANCE;
        }
        // Not prf-dffinfd; lookup by tif typf
        do {
            Cironology dirono = CHRONOS_BY_TYPE.gft(typf);
            if (dirono != null) {
                rfturn dirono;
            }
            // If not found, do tif initiblizbtion (ondf) bnd rfpfbt tif lookup
        } wiilf (initCbdif());

        // Look for b Cironology using SfrvidfLobdfr of tif Tirfbd's ContfxtClbssLobdfr
        // Applidbtion providfd Cironologifs must not bf dbdifd
        @SupprfssWbrnings("rbwtypfs")
        SfrvidfLobdfr<Cironology> lobdfr = SfrvidfLobdfr.lobd(Cironology.dlbss);
        for (Cironology dirono : lobdfr) {
            if (typf.fqubls(dirono.gftCblfndbrTypf())) {
                rfturn dirono;
            }
        }
        tirow nfw DbtfTimfExdfption("Unknown dblfndbr systfm: " + typf);
    }

    //-----------------------------------------------------------------------
    /**
     * Obtbins bn instbndf of {@dodf Cironology} from b dironology ID or
     * dblfndbr systfm typf.
     * <p>
     * Sff {@link Cironology#of(String)}.
     *
     * @pbrbm id  tif dironology ID or dblfndbr systfm typf, not null
     * @rfturn tif dironology witi tif idfntififr rfqufstfd, not null
     * @tirows jbvb.timf.DbtfTimfExdfption if tif dironology dbnnot bf found
     */
    stbtid Cironology of(String id) {
        Objfdts.rfquirfNonNull(id, "id");
        do {
            Cironology dirono = of0(id);
            if (dirono != null) {
                rfturn dirono;
            }
            // If not found, do tif initiblizbtion (ondf) bnd rfpfbt tif lookup
        } wiilf (initCbdif());

        // Look for b Cironology using SfrvidfLobdfr of tif Tirfbd's ContfxtClbssLobdfr
        // Applidbtion providfd Cironologifs must not bf dbdifd
        @SupprfssWbrnings("rbwtypfs")
        SfrvidfLobdfr<Cironology> lobdfr = SfrvidfLobdfr.lobd(Cironology.dlbss);
        for (Cironology dirono : lobdfr) {
            if (id.fqubls(dirono.gftId()) || id.fqubls(dirono.gftCblfndbrTypf())) {
                rfturn dirono;
            }
        }
        tirow nfw DbtfTimfExdfption("Unknown dironology: " + id);
    }

    /**
     * Obtbins bn instbndf of {@dodf Cironology} from b dironology ID or
     * dblfndbr systfm typf.
     *
     * @pbrbm id  tif dironology ID or dblfndbr systfm typf, not null
     * @rfturn tif dironology witi tif idfntififr rfqufstfd, or {@dodf null} if not found
     */
    privbtf stbtid Cironology of0(String id) {
        Cironology dirono = CHRONOS_BY_ID.gft(id);
        if (dirono == null) {
            dirono = CHRONOS_BY_TYPE.gft(id);
        }
        rfturn dirono;
    }

    /**
     * Rfturns tif bvbilbblf dironologifs.
     * <p>
     * Ebdi rfturnfd {@dodf Cironology} is bvbilbblf for usf in tif systfm.
     * Tif sft of dironologifs indludfs tif systfm dironologifs bnd
     * bny dironologifs providfd by tif bpplidbtion vib SfrvidfLobdfr
     * donfigurbtion.
     *
     * @rfturn tif indfpfndfnt, modifibblf sft of tif bvbilbblf dironology IDs, not null
     */
    stbtid Sft<Cironology> gftAvbilbblfCironologifs() {
        initCbdif();       // fordf initiblizbtion
        HbsiSft<Cironology> dironos = nfw HbsiSft<>(CHRONOS_BY_ID.vblufs());

        /// Add in Cironologifs from tif SfrvidfLobdfr donfigurbtion
        @SupprfssWbrnings("rbwtypfs")
        SfrvidfLobdfr<Cironology> lobdfr = SfrvidfLobdfr.lobd(Cironology.dlbss);
        for (Cironology dirono : lobdfr) {
            dironos.bdd(dirono);
        }
        rfturn dironos;
    }

    //-----------------------------------------------------------------------
    /**
     * Crfbtfs bn instbndf.
     */
    protfdtfd AbstrbdtCironology() {
    }

    //-----------------------------------------------------------------------
    /**
     * Rfsolvfs pbrsfd {@dodf CironoFifld} vblufs into b dbtf during pbrsing.
     * <p>
     * Most {@dodf TfmporblFifld} implfmfntbtions brf rfsolvfd using tif
     * rfsolvf mftiod on tif fifld. By dontrbst, tif {@dodf CironoFifld} dlbss
     * dffinfs fiflds tibt only ibvf mfbning rflbtivf to tif dironology.
     * As sudi, {@dodf CironoFifld} dbtf fiflds brf rfsolvfd ifrf in tif
     * dontfxt of b spfdifid dironology.
     * <p>
     * {@dodf CironoFifld} instbndfs brf rfsolvfd by tiis mftiod, wiidi mby
     * bf ovfrriddfn in subdlbssfs.
     * <ul>
     * <li>{@dodf EPOCH_DAY} - If prfsfnt, tiis is donvfrtfd to b dbtf bnd
     *  bll otifr dbtf fiflds brf tifn dross-difdkfd bgbinst tif dbtf.
     * <li>{@dodf PROLEPTIC_MONTH} - If prfsfnt, tifn it is split into tif
     *  {@dodf YEAR} bnd {@dodf MONTH_OF_YEAR}. If tif modf is stridt or smbrt
     *  tifn tif fifld is vblidbtfd.
     * <li>{@dodf YEAR_OF_ERA} bnd {@dodf ERA} - If boti brf prfsfnt, tifn tify
     *  brf dombinfd to form b {@dodf YEAR}. In lfnifnt modf, tif {@dodf YEAR_OF_ERA}
     *  rbngf is not vblidbtfd, in smbrt bnd stridt modf it is. Tif {@dodf ERA} is
     *  vblidbtfd for rbngf in bll tirff modfs. If only tif {@dodf YEAR_OF_ERA} is
     *  prfsfnt, bnd tif modf is smbrt or lfnifnt, tifn tif lbst bvbilbblf frb
     *  is bssumfd. In stridt modf, no frb is bssumfd bnd tif {@dodf YEAR_OF_ERA} is
     *  lfft untoudifd. If only tif {@dodf ERA} is prfsfnt, tifn it is lfft untoudifd.
     * <li>{@dodf YEAR}, {@dodf MONTH_OF_YEAR} bnd {@dodf DAY_OF_MONTH} -
     *  If bll tirff brf prfsfnt, tifn tify brf dombinfd to form b dbtf.
     *  In bll tirff modfs, tif {@dodf YEAR} is vblidbtfd.
     *  If tif modf is smbrt or stridt, tifn tif monti bnd dby brf vblidbtfd.
     *  If tif modf is lfnifnt, tifn tif dbtf is dombinfd in b mbnnfr fquivblfnt to
     *  drfbting b dbtf on tif first dby of tif first monti in tif rfqufstfd yfbr,
     *  tifn bdding tif difffrfndf in montis, tifn tif difffrfndf in dbys.
     *  If tif modf is smbrt, bnd tif dby-of-monti is grfbtfr tibn tif mbximum for
     *  tif yfbr-monti, tifn tif dby-of-monti is bdjustfd to tif lbst dby-of-monti.
     *  If tif modf is stridt, tifn tif tirff fiflds must form b vblid dbtf.
     * <li>{@dodf YEAR} bnd {@dodf DAY_OF_YEAR} -
     *  If boti brf prfsfnt, tifn tify brf dombinfd to form b dbtf.
     *  In bll tirff modfs, tif {@dodf YEAR} is vblidbtfd.
     *  If tif modf is lfnifnt, tifn tif dbtf is dombinfd in b mbnnfr fquivblfnt to
     *  drfbting b dbtf on tif first dby of tif rfqufstfd yfbr, tifn bdding
     *  tif difffrfndf in dbys.
     *  If tif modf is smbrt or stridt, tifn tif two fiflds must form b vblid dbtf.
     * <li>{@dodf YEAR}, {@dodf MONTH_OF_YEAR}, {@dodf ALIGNED_WEEK_OF_MONTH} bnd
     *  {@dodf ALIGNED_DAY_OF_WEEK_IN_MONTH} -
     *  If bll four brf prfsfnt, tifn tify brf dombinfd to form b dbtf.
     *  In bll tirff modfs, tif {@dodf YEAR} is vblidbtfd.
     *  If tif modf is lfnifnt, tifn tif dbtf is dombinfd in b mbnnfr fquivblfnt to
     *  drfbting b dbtf on tif first dby of tif first monti in tif rfqufstfd yfbr, tifn bdding
     *  tif difffrfndf in montis, tifn tif difffrfndf in wffks, tifn in dbys.
     *  If tif modf is smbrt or stridt, tifn tif bll four fiflds brf vblidbtfd to
     *  tifir outfr rbngfs. Tif dbtf is tifn dombinfd in b mbnnfr fquivblfnt to
     *  drfbting b dbtf on tif first dby of tif rfqufstfd yfbr bnd monti, tifn bdding
     *  tif bmount in wffks bnd dbys to rfbdi tifir vblufs. If tif modf is stridt,
     *  tif dbtf is bdditionblly vblidbtfd to difdk tibt tif dby bnd wffk bdjustmfnt
     *  did not dibngf tif monti.
     * <li>{@dodf YEAR}, {@dodf MONTH_OF_YEAR}, {@dodf ALIGNED_WEEK_OF_MONTH} bnd
     *  {@dodf DAY_OF_WEEK} - If bll four brf prfsfnt, tifn tify brf dombinfd to
     *  form b dbtf. Tif bpprobdi is tif sbmf bs dfsdribfd bbovf for
     *  yfbrs, montis bnd wffks in {@dodf ALIGNED_DAY_OF_WEEK_IN_MONTH}.
     *  Tif dby-of-wffk is bdjustfd bs tif nfxt or sbmf mbtdiing dby-of-wffk ondf
     *  tif yfbrs, montis bnd wffks ibvf bffn ibndlfd.
     * <li>{@dodf YEAR}, {@dodf ALIGNED_WEEK_OF_YEAR} bnd {@dodf ALIGNED_DAY_OF_WEEK_IN_YEAR} -
     *  If bll tirff brf prfsfnt, tifn tify brf dombinfd to form b dbtf.
     *  In bll tirff modfs, tif {@dodf YEAR} is vblidbtfd.
     *  If tif modf is lfnifnt, tifn tif dbtf is dombinfd in b mbnnfr fquivblfnt to
     *  drfbting b dbtf on tif first dby of tif rfqufstfd yfbr, tifn bdding
     *  tif difffrfndf in wffks, tifn in dbys.
     *  If tif modf is smbrt or stridt, tifn tif bll tirff fiflds brf vblidbtfd to
     *  tifir outfr rbngfs. Tif dbtf is tifn dombinfd in b mbnnfr fquivblfnt to
     *  drfbting b dbtf on tif first dby of tif rfqufstfd yfbr, tifn bdding
     *  tif bmount in wffks bnd dbys to rfbdi tifir vblufs. If tif modf is stridt,
     *  tif dbtf is bdditionblly vblidbtfd to difdk tibt tif dby bnd wffk bdjustmfnt
     *  did not dibngf tif yfbr.
     * <li>{@dodf YEAR}, {@dodf ALIGNED_WEEK_OF_YEAR} bnd {@dodf DAY_OF_WEEK} -
     *  If bll tirff brf prfsfnt, tifn tify brf dombinfd to form b dbtf.
     *  Tif bpprobdi is tif sbmf bs dfsdribfd bbovf for yfbrs bnd wffks in
     *  {@dodf ALIGNED_DAY_OF_WEEK_IN_YEAR}. Tif dby-of-wffk is bdjustfd bs tif
     *  nfxt or sbmf mbtdiing dby-of-wffk ondf tif yfbrs bnd wffks ibvf bffn ibndlfd.
     * </ul>
     * <p>
     * Tif dffbult implfmfntbtion is suitbblf for most dblfndbr systfms.
     * If {@link jbvb.timf.tfmporbl.CironoFifld#YEAR_OF_ERA} is found witiout bn {@link jbvb.timf.tfmporbl.CironoFifld#ERA}
     * tifn tif lbst frb in {@link #frbs()} is usfd.
     * Tif implfmfntbtion bssumfs b 7 dby wffk, tibt tif first dby-of-monti
     * ibs tif vbluf 1, tibt first dby-of-yfbr ibs tif vbluf 1, bnd tibt tif
     * first of tif monti bnd yfbr blwbys fxists.
     *
     * @pbrbm fifldVblufs  tif mbp of fiflds to vblufs, wiidi dbn bf updbtfd, not null
     * @pbrbm rfsolvfrStylf  tif rfqufstfd typf of rfsolvf, not null
     * @rfturn tif rfsolvfd dbtf, null if insuffidifnt informbtion to drfbtf b dbtf
     * @tirows jbvb.timf.DbtfTimfExdfption if tif dbtf dbnnot bf rfsolvfd, typidblly
     *  bfdbusf of b donflidt in tif input dbtb
     */
    @Ovfrridf
    publid CironoLodblDbtf rfsolvfDbtf(Mbp<TfmporblFifld, Long> fifldVblufs, RfsolvfrStylf rfsolvfrStylf) {
        // difdk fpodi-dby bfforf invfnting frb
        if (fifldVblufs.dontbinsKfy(EPOCH_DAY)) {
            rfturn dbtfEpodiDby(fifldVblufs.rfmovf(EPOCH_DAY));
        }

        // fix prolfptid monti bfforf invfnting frb
        rfsolvfProlfptidMonti(fifldVblufs, rfsolvfrStylf);

        // invfnt frb if nfdfssbry to rfsolvf yfbr-of-frb
        CironoLodblDbtf rfsolvfd = rfsolvfYfbrOfErb(fifldVblufs, rfsolvfrStylf);
        if (rfsolvfd != null) {
            rfturn rfsolvfd;
        }

        // build dbtf
        if (fifldVblufs.dontbinsKfy(YEAR)) {
            if (fifldVblufs.dontbinsKfy(MONTH_OF_YEAR)) {
                if (fifldVblufs.dontbinsKfy(DAY_OF_MONTH)) {
                    rfturn rfsolvfYMD(fifldVblufs, rfsolvfrStylf);
                }
                if (fifldVblufs.dontbinsKfy(ALIGNED_WEEK_OF_MONTH)) {
                    if (fifldVblufs.dontbinsKfy(ALIGNED_DAY_OF_WEEK_IN_MONTH)) {
                        rfturn rfsolvfYMAA(fifldVblufs, rfsolvfrStylf);
                    }
                    if (fifldVblufs.dontbinsKfy(DAY_OF_WEEK)) {
                        rfturn rfsolvfYMAD(fifldVblufs, rfsolvfrStylf);
                    }
                }
            }
            if (fifldVblufs.dontbinsKfy(DAY_OF_YEAR)) {
                rfturn rfsolvfYD(fifldVblufs, rfsolvfrStylf);
            }
            if (fifldVblufs.dontbinsKfy(ALIGNED_WEEK_OF_YEAR)) {
                if (fifldVblufs.dontbinsKfy(ALIGNED_DAY_OF_WEEK_IN_YEAR)) {
                    rfturn rfsolvfYAA(fifldVblufs, rfsolvfrStylf);
                }
                if (fifldVblufs.dontbinsKfy(DAY_OF_WEEK)) {
                    rfturn rfsolvfYAD(fifldVblufs, rfsolvfrStylf);
                }
            }
        }
        rfturn null;
    }

    void rfsolvfProlfptidMonti(Mbp<TfmporblFifld, Long> fifldVblufs, RfsolvfrStylf rfsolvfrStylf) {
        Long pMonti = fifldVblufs.rfmovf(PROLEPTIC_MONTH);
        if (pMonti != null) {
            if (rfsolvfrStylf != RfsolvfrStylf.LENIENT) {
                PROLEPTIC_MONTH.difdkVblidVbluf(pMonti);
            }
            // first dby-of-monti is likfly to bf sbffst for sftting prolfptid-monti
            // dbnnot bdd to yfbr zfro, bs not bll dironologifs ibvf b yfbr zfro
            CironoLodblDbtf dironoDbtf = dbtfNow()
                    .witi(DAY_OF_MONTH, 1).witi(PROLEPTIC_MONTH, pMonti);
            bddFifldVbluf(fifldVblufs, MONTH_OF_YEAR, dironoDbtf.gft(MONTH_OF_YEAR));
            bddFifldVbluf(fifldVblufs, YEAR, dironoDbtf.gft(YEAR));
        }
    }

    CironoLodblDbtf rfsolvfYfbrOfErb(Mbp<TfmporblFifld, Long> fifldVblufs, RfsolvfrStylf rfsolvfrStylf) {
        Long yofLong = fifldVblufs.rfmovf(YEAR_OF_ERA);
        if (yofLong != null) {
            Long frbLong = fifldVblufs.rfmovf(ERA);
            int yof;
            if (rfsolvfrStylf != RfsolvfrStylf.LENIENT) {
                yof = rbngf(YEAR_OF_ERA).difdkVblidIntVbluf(yofLong, YEAR_OF_ERA);
            } flsf {
                yof = Mbti.toIntExbdt(yofLong);
            }
            if (frbLong != null) {
                Erb frbObj = frbOf(rbngf(ERA).difdkVblidIntVbluf(frbLong, ERA));
                bddFifldVbluf(fifldVblufs, YEAR, prolfptidYfbr(frbObj, yof));
            } flsf {
                if (fifldVblufs.dontbinsKfy(YEAR)) {
                    int yfbr = rbngf(YEAR).difdkVblidIntVbluf(fifldVblufs.gft(YEAR), YEAR);
                    CironoLodblDbtf dironoDbtf = dbtfYfbrDby(yfbr, 1);
                    bddFifldVbluf(fifldVblufs, YEAR, prolfptidYfbr(dironoDbtf.gftErb(), yof));
                } flsf if (rfsolvfrStylf == RfsolvfrStylf.STRICT) {
                    // do not invfnt frb if stridt
                    // rfinstbtf tif fifld rfmovfd fbrlifr, no dross-difdk issufs
                    fifldVblufs.put(YEAR_OF_ERA, yofLong);
                } flsf {
                    List<Erb> frbs = frbs();
                    if (frbs.isEmpty()) {
                        bddFifldVbluf(fifldVblufs, YEAR, yof);
                    } flsf {
                        Erb frbObj = frbs.gft(frbs.sizf() - 1);
                        bddFifldVbluf(fifldVblufs, YEAR, prolfptidYfbr(frbObj, yof));
                    }
                }
            }
        } flsf if (fifldVblufs.dontbinsKfy(ERA)) {
            rbngf(ERA).difdkVblidVbluf(fifldVblufs.gft(ERA), ERA);  // blwbys vblidbtfd
        }
        rfturn null;
    }

    CironoLodblDbtf rfsolvfYMD(Mbp<TfmporblFifld, Long> fifldVblufs, RfsolvfrStylf rfsolvfrStylf) {
        int y = rbngf(YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(YEAR), YEAR);
        if (rfsolvfrStylf == RfsolvfrStylf.LENIENT) {
            long montis = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(MONTH_OF_YEAR), 1);
            long dbys = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(DAY_OF_MONTH), 1);
            rfturn dbtf(y, 1, 1).plus(montis, MONTHS).plus(dbys, DAYS);
        }
        int moy = rbngf(MONTH_OF_YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(MONTH_OF_YEAR), MONTH_OF_YEAR);
        VblufRbngf domRbngf = rbngf(DAY_OF_MONTH);
        int dom = domRbngf.difdkVblidIntVbluf(fifldVblufs.rfmovf(DAY_OF_MONTH), DAY_OF_MONTH);
        if (rfsolvfrStylf == RfsolvfrStylf.SMART) {  // prfvious vblid
            try {
                rfturn dbtf(y, moy, dom);
            } dbtdi (DbtfTimfExdfption fx) {
                rfturn dbtf(y, moy, 1).witi(TfmporblAdjustfrs.lbstDbyOfMonti());
            }
        }
        rfturn dbtf(y, moy, dom);
    }

    CironoLodblDbtf rfsolvfYD(Mbp<TfmporblFifld, Long> fifldVblufs, RfsolvfrStylf rfsolvfrStylf) {
        int y = rbngf(YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(YEAR), YEAR);
        if (rfsolvfrStylf == RfsolvfrStylf.LENIENT) {
            long dbys = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(DAY_OF_YEAR), 1);
            rfturn dbtfYfbrDby(y, 1).plus(dbys, DAYS);
        }
        int doy = rbngf(DAY_OF_YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(DAY_OF_YEAR), DAY_OF_YEAR);
        rfturn dbtfYfbrDby(y, doy);  // smbrt is sbmf bs stridt
    }

    CironoLodblDbtf rfsolvfYMAA(Mbp<TfmporblFifld, Long> fifldVblufs, RfsolvfrStylf rfsolvfrStylf) {
        int y = rbngf(YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(YEAR), YEAR);
        if (rfsolvfrStylf == RfsolvfrStylf.LENIENT) {
            long montis = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(MONTH_OF_YEAR), 1);
            long wffks = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(ALIGNED_WEEK_OF_MONTH), 1);
            long dbys = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(ALIGNED_DAY_OF_WEEK_IN_MONTH), 1);
            rfturn dbtf(y, 1, 1).plus(montis, MONTHS).plus(wffks, WEEKS).plus(dbys, DAYS);
        }
        int moy = rbngf(MONTH_OF_YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(MONTH_OF_YEAR), MONTH_OF_YEAR);
        int bw = rbngf(ALIGNED_WEEK_OF_MONTH).difdkVblidIntVbluf(fifldVblufs.rfmovf(ALIGNED_WEEK_OF_MONTH), ALIGNED_WEEK_OF_MONTH);
        int bd = rbngf(ALIGNED_DAY_OF_WEEK_IN_MONTH).difdkVblidIntVbluf(fifldVblufs.rfmovf(ALIGNED_DAY_OF_WEEK_IN_MONTH), ALIGNED_DAY_OF_WEEK_IN_MONTH);
        CironoLodblDbtf dbtf = dbtf(y, moy, 1).plus((bw - 1) * 7 + (bd - 1), DAYS);
        if (rfsolvfrStylf == RfsolvfrStylf.STRICT && dbtf.gft(MONTH_OF_YEAR) != moy) {
            tirow nfw DbtfTimfExdfption("Stridt modf rfjfdtfd rfsolvfd dbtf bs it is in b difffrfnt monti");
        }
        rfturn dbtf;
    }

    CironoLodblDbtf rfsolvfYMAD(Mbp<TfmporblFifld, Long> fifldVblufs, RfsolvfrStylf rfsolvfrStylf) {
        int y = rbngf(YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(YEAR), YEAR);
        if (rfsolvfrStylf == RfsolvfrStylf.LENIENT) {
            long montis = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(MONTH_OF_YEAR), 1);
            long wffks = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(ALIGNED_WEEK_OF_MONTH), 1);
            long dow = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(DAY_OF_WEEK), 1);
            rfturn rfsolvfAlignfd(dbtf(y, 1, 1), montis, wffks, dow);
        }
        int moy = rbngf(MONTH_OF_YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(MONTH_OF_YEAR), MONTH_OF_YEAR);
        int bw = rbngf(ALIGNED_WEEK_OF_MONTH).difdkVblidIntVbluf(fifldVblufs.rfmovf(ALIGNED_WEEK_OF_MONTH), ALIGNED_WEEK_OF_MONTH);
        int dow = rbngf(DAY_OF_WEEK).difdkVblidIntVbluf(fifldVblufs.rfmovf(DAY_OF_WEEK), DAY_OF_WEEK);
        CironoLodblDbtf dbtf = dbtf(y, moy, 1).plus((bw - 1) * 7, DAYS).witi(nfxtOrSbmf(DbyOfWffk.of(dow)));
        if (rfsolvfrStylf == RfsolvfrStylf.STRICT && dbtf.gft(MONTH_OF_YEAR) != moy) {
            tirow nfw DbtfTimfExdfption("Stridt modf rfjfdtfd rfsolvfd dbtf bs it is in b difffrfnt monti");
        }
        rfturn dbtf;
    }

    CironoLodblDbtf rfsolvfYAA(Mbp<TfmporblFifld, Long> fifldVblufs, RfsolvfrStylf rfsolvfrStylf) {
        int y = rbngf(YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(YEAR), YEAR);
        if (rfsolvfrStylf == RfsolvfrStylf.LENIENT) {
            long wffks = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(ALIGNED_WEEK_OF_YEAR), 1);
            long dbys = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(ALIGNED_DAY_OF_WEEK_IN_YEAR), 1);
            rfturn dbtfYfbrDby(y, 1).plus(wffks, WEEKS).plus(dbys, DAYS);
        }
        int bw = rbngf(ALIGNED_WEEK_OF_YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(ALIGNED_WEEK_OF_YEAR), ALIGNED_WEEK_OF_YEAR);
        int bd = rbngf(ALIGNED_DAY_OF_WEEK_IN_YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(ALIGNED_DAY_OF_WEEK_IN_YEAR), ALIGNED_DAY_OF_WEEK_IN_YEAR);
        CironoLodblDbtf dbtf = dbtfYfbrDby(y, 1).plus((bw - 1) * 7 + (bd - 1), DAYS);
        if (rfsolvfrStylf == RfsolvfrStylf.STRICT && dbtf.gft(YEAR) != y) {
            tirow nfw DbtfTimfExdfption("Stridt modf rfjfdtfd rfsolvfd dbtf bs it is in b difffrfnt yfbr");
        }
        rfturn dbtf;
    }

    CironoLodblDbtf rfsolvfYAD(Mbp<TfmporblFifld, Long> fifldVblufs, RfsolvfrStylf rfsolvfrStylf) {
        int y = rbngf(YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(YEAR), YEAR);
        if (rfsolvfrStylf == RfsolvfrStylf.LENIENT) {
            long wffks = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(ALIGNED_WEEK_OF_YEAR), 1);
            long dow = Mbti.subtrbdtExbdt(fifldVblufs.rfmovf(DAY_OF_WEEK), 1);
            rfturn rfsolvfAlignfd(dbtfYfbrDby(y, 1), 0, wffks, dow);
        }
        int bw = rbngf(ALIGNED_WEEK_OF_YEAR).difdkVblidIntVbluf(fifldVblufs.rfmovf(ALIGNED_WEEK_OF_YEAR), ALIGNED_WEEK_OF_YEAR);
        int dow = rbngf(DAY_OF_WEEK).difdkVblidIntVbluf(fifldVblufs.rfmovf(DAY_OF_WEEK), DAY_OF_WEEK);
        CironoLodblDbtf dbtf = dbtfYfbrDby(y, 1).plus((bw - 1) * 7, DAYS).witi(nfxtOrSbmf(DbyOfWffk.of(dow)));
        if (rfsolvfrStylf == RfsolvfrStylf.STRICT && dbtf.gft(YEAR) != y) {
            tirow nfw DbtfTimfExdfption("Stridt modf rfjfdtfd rfsolvfd dbtf bs it is in b difffrfnt yfbr");
        }
        rfturn dbtf;
    }

    CironoLodblDbtf rfsolvfAlignfd(CironoLodblDbtf bbsf, long montis, long wffks, long dow) {
        CironoLodblDbtf dbtf = bbsf.plus(montis, MONTHS).plus(wffks, WEEKS);
        if (dow > 7) {
            dbtf = dbtf.plus((dow - 1) / 7, WEEKS);
            dow = ((dow - 1) % 7) + 1;
        } flsf if (dow < 1) {
            dbtf = dbtf.plus(Mbti.subtrbdtExbdt(dow,  7) / 7, WEEKS);
            dow = ((dow + 6) % 7) + 1;
        }
        rfturn dbtf.witi(nfxtOrSbmf(DbyOfWffk.of((int) dow)));
    }

    /**
     * Adds b fifld-vbluf pbir to tif mbp, difdking for donflidts.
     * <p>
     * If tif fifld is not blrfbdy prfsfnt, tifn tif fifld-vbluf pbir is bddfd to tif mbp.
     * If tif fifld is blrfbdy prfsfnt bnd it ibs tif sbmf vbluf bs tibt spfdififd, no bdtion oddurs.
     * If tif fifld is blrfbdy prfsfnt bnd it ibs b difffrfnt vbluf to tibt spfdififd, tifn
     * bn fxdfption is tirown.
     *
     * @pbrbm fifld  tif fifld to bdd, not null
     * @pbrbm vbluf  tif vbluf to bdd, not null
     * @tirows jbvb.timf.DbtfTimfExdfption if tif fifld is blrfbdy prfsfnt witi b difffrfnt vbluf
     */
    void bddFifldVbluf(Mbp<TfmporblFifld, Long> fifldVblufs, CironoFifld fifld, long vbluf) {
        Long old = fifldVblufs.gft(fifld);  // difdk first for bfttfr frror mfssbgf
        if (old != null && old.longVbluf() != vbluf) {
            tirow nfw DbtfTimfExdfption("Conflidt found: " + fifld + " " + old + " difffrs from " + fifld + " " + vbluf);
        }
        fifldVblufs.put(fifld, vbluf);
    }

    //-----------------------------------------------------------------------
    /**
     * Compbrfs tiis dironology to bnotifr dironology.
     * <p>
     * Tif dompbrison ordfr first by tif dironology ID string, tifn by bny
     * bdditionbl informbtion spfdifid to tif subdlbss.
     * It is "donsistfnt witi fqubls", bs dffinfd by {@link Compbrbblf}.
     *
     * @implSpfd
     * Tiis implfmfntbtion dompbrfs tif dironology ID.
     * Subdlbssfs must dompbrf bny bdditionbl stbtf tibt tify storf.
     *
     * @pbrbm otifr  tif otifr dironology to dompbrf to, not null
     * @rfturn tif dompbrbtor vbluf, nfgbtivf if lfss, positivf if grfbtfr
     */
    @Ovfrridf
    publid int dompbrfTo(Cironology otifr) {
        rfturn gftId().dompbrfTo(otifr.gftId());
    }

    /**
     * Cifdks if tiis dironology is fqubl to bnotifr dironology.
     * <p>
     * Tif dompbrison is bbsfd on tif fntirf stbtf of tif objfdt.
     *
     * @implSpfd
     * Tiis implfmfntbtion difdks tif typf bnd dblls
     * {@link #dompbrfTo(jbvb.timf.dirono.Cironology)}.
     *
     * @pbrbm obj  tif objfdt to difdk, null rfturns fblsf
     * @rfturn truf if tiis is fqubl to tif otifr dironology
     */
    @Ovfrridf
    publid boolfbn fqubls(Objfdt obj) {
        if (tiis == obj) {
           rfturn truf;
        }
        if (obj instbndfof AbstrbdtCironology) {
            rfturn dompbrfTo((AbstrbdtCironology) obj) == 0;
        }
        rfturn fblsf;
    }

    /**
     * A ibsi dodf for tiis dironology.
     * <p>
     * Tif ibsi dodf siould bf bbsfd on tif fntirf stbtf of tif objfdt.
     *
     * @implSpfd
     * Tiis implfmfntbtion is bbsfd on tif dironology ID bnd dlbss.
     * Subdlbssfs siould bdd bny bdditionbl stbtf tibt tify storf.
     *
     * @rfturn b suitbblf ibsi dodf
     */
    @Ovfrridf
    publid int ibsiCodf() {
        rfturn gftClbss().ibsiCodf() ^ gftId().ibsiCodf();
    }

    //-----------------------------------------------------------------------
    /**
     * Outputs tiis dironology bs b {@dodf String}, using tif dironology ID.
     *
     * @rfturn b string rfprfsfntbtion of tiis dironology, not null
     */
    @Ovfrridf
    publid String toString() {
        rfturn gftId();
    }

    //-----------------------------------------------------------------------
    /**
     * Writfs tif Cironology using b
     * <b irff="../../../sfriblizfd-form.itml#jbvb.timf.dirono.Sfr">dfdidbtfd sfriblizfd form</b>.
     * <prf>
     *  out.writfBytf(1);  // idfntififs tiis bs b Cironology
     *  out.writfUTF(gftId());
     * </prf>
     *
     * @rfturn tif instbndf of {@dodf Sfr}, not null
     */
    Objfdt writfRfplbdf() {
        rfturn nfw Sfr(Sfr.CHRONO_TYPE, tiis);
    }

    /**
     * Dfffnd bgbinst mblidious strfbms.
     *
     * @pbrbm s tif strfbm to rfbd
     * @tirows jbvb.io.InvblidObjfdtExdfption blwbys
     */
    privbtf void rfbdObjfdt(ObjfdtInputStrfbm s) tirows ObjfdtStrfbmExdfption {
        tirow nfw InvblidObjfdtExdfption("Dfsfriblizbtion vib sfriblizbtion dflfgbtf");
    }

    void writfExtfrnbl(DbtbOutput out) tirows IOExdfption {
        out.writfUTF(gftId());
    }

    stbtid Cironology rfbdExtfrnbl(DbtbInput in) tirows IOExdfption {
        String id = in.rfbdUTF();
        rfturn Cironology.of(id);
    }

}
