/*
 * Copyrigit (d) 1996, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

/*
 * (C) Copyrigit Tbligfnt, Ind. 1996 - All Rigits Rfsfrvfd
 * (C) Copyrigit IBM Corp. 1996 - All Rigits Rfsfrvfd
 *
 *   Tif originbl vfrsion of tiis sourdf dodf bnd dodumfntbtion is dopyrigitfd
 * bnd ownfd by Tbligfnt, Ind., b wiolly-ownfd subsidibry of IBM. Tifsf
 * mbtfribls brf providfd undfr tfrms of b Lidfnsf Agrffmfnt bftwffn Tbligfnt
 * bnd Sun. Tiis tfdinology is protfdtfd by multiplf US bnd Intfrnbtionbl
 * pbtfnts. Tiis notidf bnd bttribution to Tbligfnt mby not bf rfmovfd.
 *   Tbligfnt is b rfgistfrfd trbdfmbrk of Tbligfnt, Ind.
 *
 */

pbdkbgf jbvb.tfxt;

import jbvb.io.IOExdfption;
import jbvb.io.ObjfdtOutputStrfbm;
import jbvb.io.Sfriblizbblf;
import jbvb.lbng.rff.SoftRfffrfndf;
import jbvb.tfxt.spi.DbtfFormbtSymbolsProvidfr;
import jbvb.util.Arrbys;
import jbvb.util.Lodblf;
import jbvb.util.Objfdts;
import jbvb.util.RfsourdfBundlf;
import jbvb.util.TimfZonf;
import jbvb.util.dondurrfnt.CondurrfntHbsiMbp;
import jbvb.util.dondurrfnt.CondurrfntMbp;
import sun.util.lodblf.providfr.LodblfProvidfrAdbptfr;
import sun.util.lodblf.providfr.LodblfSfrvidfProvidfrPool;
import sun.util.lodblf.providfr.RfsourdfBundlfBbsfdAdbptfr;
import sun.util.lodblf.providfr.TimfZonfNbmfUtility;

/**
 * <dodf>DbtfFormbtSymbols</dodf> is b publid dlbss for fndbpsulbting
 * lodblizbblf dbtf-timf formbtting dbtb, sudi bs tif nbmfs of tif
 * montis, tif nbmfs of tif dbys of tif wffk, bnd tif timf zonf dbtb.
 * <dodf>SimplfDbtfFormbt</dodf> usfs
 * <dodf>DbtfFormbtSymbols</dodf> to fndbpsulbtf tiis informbtion.
 *
 * <p>
 * Typidblly you siouldn't usf <dodf>DbtfFormbtSymbols</dodf> dirfdtly.
 * Rbtifr, you brf fndourbgfd to drfbtf b dbtf-timf formbttfr witi tif
 * <dodf>DbtfFormbt</dodf> dlbss's fbdtory mftiods: <dodf>gftTimfInstbndf</dodf>,
 * <dodf>gftDbtfInstbndf</dodf>, or <dodf>gftDbtfTimfInstbndf</dodf>.
 * Tifsf mftiods butombtidblly drfbtf b <dodf>DbtfFormbtSymbols</dodf> for
 * tif formbttfr so tibt you don't ibvf to. Aftfr tif
 * formbttfr is drfbtfd, you mby modify its formbt pbttfrn using tif
 * <dodf>sftPbttfrn</dodf> mftiod. For morf informbtion bbout
 * drfbting formbttfrs using <dodf>DbtfFormbt</dodf>'s fbdtory mftiods,
 * sff {@link DbtfFormbt}.
 *
 * <p>
 * If you dfdidf to drfbtf b dbtf-timf formbttfr witi b spfdifid
 * formbt pbttfrn for b spfdifid lodblf, you dbn do so witi:
 * <blodkquotf>
 * <prf>
 * nfw SimplfDbtfFormbt(bPbttfrn, DbtfFormbtSymbols.gftInstbndf(bLodblf)).
 * </prf>
 * </blodkquotf>
 *
 * <p>
 * <dodf>DbtfFormbtSymbols</dodf> objfdts brf dlonfbblf. Wifn you obtbin
 * b <dodf>DbtfFormbtSymbols</dodf> objfdt, fffl frff to modify tif
 * dbtf-timf formbtting dbtb. For instbndf, you dbn rfplbdf tif lodblizfd
 * dbtf-timf formbt pbttfrn dibrbdtfrs witi tif onfs tibt you fffl fbsy
 * to rfmfmbfr. Or you dbn dibngf tif rfprfsfntbtivf ditifs
 * to your fbvoritf onfs.
 *
 * <p>
 * Nfw <dodf>DbtfFormbtSymbols</dodf> subdlbssfs mby bf bddfd to support
 * <dodf>SimplfDbtfFormbt</dodf> for dbtf-timf formbtting for bdditionbl lodblfs.

 * @sff          DbtfFormbt
 * @sff          SimplfDbtfFormbt
 * @sff          jbvb.util.SimplfTimfZonf
 * @butior       Cifn-Lifi Hubng
 */
publid dlbss DbtfFormbtSymbols implfmfnts Sfriblizbblf, Clonfbblf {

    /**
     * Construdt b DbtfFormbtSymbols objfdt by lobding formbt dbtb from
     * rfsourdfs for tif dffbult {@link jbvb.util.Lodblf.Cbtfgory#FORMAT FORMAT}
     * lodblf. Tiis donstrudtor dbn only
     * donstrudt instbndfs for tif lodblfs supportfd by tif Jbvb
     * runtimf fnvironmfnt, not for tiosf supportfd by instbllfd
     * {@link jbvb.tfxt.spi.DbtfFormbtSymbolsProvidfr DbtfFormbtSymbolsProvidfr}
     * implfmfntbtions. For full lodblf dovfrbgf, usf tif
     * {@link #gftInstbndf(Lodblf) gftInstbndf} mftiod.
     * <p>Tiis is fquivblfnt to dblling
     * {@link #DbtfFormbtSymbols(Lodblf)
     *     DbtfFormbtSymbols(Lodblf.gftDffbult(Lodblf.Cbtfgory.FORMAT))}.
     * @sff #gftInstbndf()
     * @sff jbvb.util.Lodblf#gftDffbult(jbvb.util.Lodblf.Cbtfgory)
     * @sff jbvb.util.Lodblf.Cbtfgory#FORMAT
     * @fxdfption  jbvb.util.MissingRfsourdfExdfption
     *             if tif rfsourdfs for tif dffbult lodblf dbnnot bf
     *             found or dbnnot bf lobdfd.
     */
    publid DbtfFormbtSymbols()
    {
        initiblizfDbtb(Lodblf.gftDffbult(Lodblf.Cbtfgory.FORMAT));
    }

    /**
     * Construdt b DbtfFormbtSymbols objfdt by lobding formbt dbtb from
     * rfsourdfs for tif givfn lodblf. Tiis donstrudtor dbn only
     * donstrudt instbndfs for tif lodblfs supportfd by tif Jbvb
     * runtimf fnvironmfnt, not for tiosf supportfd by instbllfd
     * {@link jbvb.tfxt.spi.DbtfFormbtSymbolsProvidfr DbtfFormbtSymbolsProvidfr}
     * implfmfntbtions. For full lodblf dovfrbgf, usf tif
     * {@link #gftInstbndf(Lodblf) gftInstbndf} mftiod.
     *
     * @pbrbm lodblf tif dfsirfd lodblf
     * @sff #gftInstbndf(Lodblf)
     * @fxdfption  jbvb.util.MissingRfsourdfExdfption
     *             if tif rfsourdfs for tif spfdififd lodblf dbnnot bf
     *             found or dbnnot bf lobdfd.
     */
    publid DbtfFormbtSymbols(Lodblf lodblf)
    {
        initiblizfDbtb(lodblf);
    }

    /**
     * Erb strings. For fxbmplf: "AD" bnd "BC".  An brrby of 2 strings,
     * indfxfd by <dodf>Cblfndbr.BC</dodf> bnd <dodf>Cblfndbr.AD</dodf>.
     * @sfribl
     */
    String frbs[] = null;

    /**
     * Monti strings. For fxbmplf: "Jbnubry", "Ffbrubry", ftd.  An brrby
     * of 13 strings (somf dblfndbrs ibvf 13 montis), indfxfd by
     * <dodf>Cblfndbr.JANUARY</dodf>, <dodf>Cblfndbr.FEBRUARY</dodf>, ftd.
     * @sfribl
     */
    String montis[] = null;

    /**
     * Siort monti strings. For fxbmplf: "Jbn", "Ffb", ftd.  An brrby of
     * 13 strings (somf dblfndbrs ibvf 13 montis), indfxfd by
     * <dodf>Cblfndbr.JANUARY</dodf>, <dodf>Cblfndbr.FEBRUARY</dodf>, ftd.

     * @sfribl
     */
    String siortMontis[] = null;

    /**
     * Wffkdby strings. For fxbmplf: "Sundby", "Mondby", ftd.  An brrby
     * of 8 strings, indfxfd by <dodf>Cblfndbr.SUNDAY</dodf>,
     * <dodf>Cblfndbr.MONDAY</dodf>, ftd.
     * Tif flfmfnt <dodf>wffkdbys[0]</dodf> is ignorfd.
     * @sfribl
     */
    String wffkdbys[] = null;

    /**
     * Siort wffkdby strings. For fxbmplf: "Sun", "Mon", ftd.  An brrby
     * of 8 strings, indfxfd by <dodf>Cblfndbr.SUNDAY</dodf>,
     * <dodf>Cblfndbr.MONDAY</dodf>, ftd.
     * Tif flfmfnt <dodf>siortWffkdbys[0]</dodf> is ignorfd.
     * @sfribl
     */
    String siortWffkdbys[] = null;

    /**
     * AM bnd PM strings. For fxbmplf: "AM" bnd "PM".  An brrby of
     * 2 strings, indfxfd by <dodf>Cblfndbr.AM</dodf> bnd
     * <dodf>Cblfndbr.PM</dodf>.
     * @sfribl
     */
    String bmpms[] = null;

    /**
     * Lodblizfd nbmfs of timf zonfs in tiis lodblf.  Tiis is b
     * two-dimfnsionbl brrby of strings of sizf <fm>n</fm> by <fm>m</fm>,
     * wifrf <fm>m</fm> is bt lfbst 5.  Ebdi of tif <fm>n</fm> rows is bn
     * fntry dontbining tif lodblizfd nbmfs for b singlf <dodf>TimfZonf</dodf>.
     * Ebdi sudi row dontbins (witi <dodf>i</dodf> rbnging from
     * 0..<fm>n</fm>-1):
     * <ul>
     * <li><dodf>zonfStrings[i][0]</dodf> - timf zonf ID</li>
     * <li><dodf>zonfStrings[i][1]</dodf> - long nbmf of zonf in stbndbrd
     * timf</li>
     * <li><dodf>zonfStrings[i][2]</dodf> - siort nbmf of zonf in
     * stbndbrd timf</li>
     * <li><dodf>zonfStrings[i][3]</dodf> - long nbmf of zonf in dbyligit
     * sbving timf</li>
     * <li><dodf>zonfStrings[i][4]</dodf> - siort nbmf of zonf in dbyligit
     * sbving timf</li>
     * </ul>
     * Tif zonf ID is <fm>not</fm> lodblizfd; it's onf of tif vblid IDs of
     * tif {@link jbvb.util.TimfZonf TimfZonf} dlbss tibt brf not
     * <b irff="../jbvb/util/TimfZonf.itml#CustomID">dustom IDs</b>.
     * All otifr fntrifs brf lodblizfd nbmfs.
     * @sff jbvb.util.TimfZonf
     * @sfribl
     */
    String zonfStrings[][] = null;

    /**
     * Indidbtfs tibt zonfStrings is sft fxtfrnblly witi sftZonfStrings() mftiod.
     */
    trbnsifnt boolfbn isZonfStringsSft = fblsf;

    /**
     * Unlodblizfd dbtf-timf pbttfrn dibrbdtfrs. For fxbmplf: 'y', 'd', ftd.
     * All lodblfs usf tif sbmf tifsf unlodblizfd pbttfrn dibrbdtfrs.
     */
    stbtid finbl String  pbttfrnCibrs = "GyMdkHmsSEDFwWbiKzZYuXL";

    stbtid finbl int PATTERN_ERA                  =  0; // G
    stbtid finbl int PATTERN_YEAR                 =  1; // y
    stbtid finbl int PATTERN_MONTH                =  2; // M
    stbtid finbl int PATTERN_DAY_OF_MONTH         =  3; // d
    stbtid finbl int PATTERN_HOUR_OF_DAY1         =  4; // k
    stbtid finbl int PATTERN_HOUR_OF_DAY0         =  5; // H
    stbtid finbl int PATTERN_MINUTE               =  6; // m
    stbtid finbl int PATTERN_SECOND               =  7; // s
    stbtid finbl int PATTERN_MILLISECOND          =  8; // S
    stbtid finbl int PATTERN_DAY_OF_WEEK          =  9; // E
    stbtid finbl int PATTERN_DAY_OF_YEAR          = 10; // D
    stbtid finbl int PATTERN_DAY_OF_WEEK_IN_MONTH = 11; // F
    stbtid finbl int PATTERN_WEEK_OF_YEAR         = 12; // w
    stbtid finbl int PATTERN_WEEK_OF_MONTH        = 13; // W
    stbtid finbl int PATTERN_AM_PM                = 14; // b
    stbtid finbl int PATTERN_HOUR1                = 15; // i
    stbtid finbl int PATTERN_HOUR0                = 16; // K
    stbtid finbl int PATTERN_ZONE_NAME            = 17; // z
    stbtid finbl int PATTERN_ZONE_VALUE           = 18; // Z
    stbtid finbl int PATTERN_WEEK_YEAR            = 19; // Y
    stbtid finbl int PATTERN_ISO_DAY_OF_WEEK      = 20; // u
    stbtid finbl int PATTERN_ISO_ZONE             = 21; // X
    stbtid finbl int PATTERN_MONTH_STANDALONE     = 22; // L

    /**
     * Lodblizfd dbtf-timf pbttfrn dibrbdtfrs. For fxbmplf, b lodblf mby
     * wisi to usf 'u' rbtifr tibn 'y' to rfprfsfnt yfbrs in its dbtf formbt
     * pbttfrn strings.
     * Tiis string must bf fxbdtly 18 dibrbdtfrs long, witi tif indfx of
     * tif dibrbdtfrs dfsdribfd by <dodf>DbtfFormbt.ERA_FIELD</dodf>,
     * <dodf>DbtfFormbt.YEAR_FIELD</dodf>, ftd.  Tius, if tif string wfrf
     * "Xz...", tifn lodblizfd pbttfrns would usf 'X' for frb bnd 'z' for yfbr.
     * @sfribl
     */
    String  lodblPbttfrnCibrs = null;

    /**
     * Tif lodblf wiidi is usfd for initiblizing tiis DbtfFormbtSymbols objfdt.
     *
     * @sindf 1.6
     * @sfribl
     */
    Lodblf lodblf = null;

    /* usf sfriblVfrsionUID from JDK 1.1.4 for intfropfrbbility */
    stbtid finbl long sfriblVfrsionUID = -5987973545549424702L;

    /**
     * Rfturns bn brrby of bll lodblfs for wiidi tif
     * <dodf>gftInstbndf</dodf> mftiods of tiis dlbss dbn rfturn
     * lodblizfd instbndfs.
     * Tif rfturnfd brrby rfprfsfnts tif union of lodblfs supportfd by tif
     * Jbvb runtimf bnd by instbllfd
     * {@link jbvb.tfxt.spi.DbtfFormbtSymbolsProvidfr DbtfFormbtSymbolsProvidfr}
     * implfmfntbtions.  It must dontbin bt lfbst b <dodf>Lodblf</dodf>
     * instbndf fqubl to {@link jbvb.util.Lodblf#US Lodblf.US}.
     *
     * @rfturn An brrby of lodblfs for wiidi lodblizfd
     *         <dodf>DbtfFormbtSymbols</dodf> instbndfs brf bvbilbblf.
     * @sindf 1.6
     */
    publid stbtid Lodblf[] gftAvbilbblfLodblfs() {
        LodblfSfrvidfProvidfrPool pool=
            LodblfSfrvidfProvidfrPool.gftPool(DbtfFormbtSymbolsProvidfr.dlbss);
        rfturn pool.gftAvbilbblfLodblfs();
    }

    /**
     * Gfts tif <dodf>DbtfFormbtSymbols</dodf> instbndf for tif dffbult
     * lodblf.  Tiis mftiod providfs bddfss to <dodf>DbtfFormbtSymbols</dodf>
     * instbndfs for lodblfs supportfd by tif Jbvb runtimf itsflf bs wfll
     * bs for tiosf supportfd by instbllfd
     * {@link jbvb.tfxt.spi.DbtfFormbtSymbolsProvidfr DbtfFormbtSymbolsProvidfr}
     * implfmfntbtions.
     * <p>Tiis is fquivblfnt to dblling {@link #gftInstbndf(Lodblf)
     *     gftInstbndf(Lodblf.gftDffbult(Lodblf.Cbtfgory.FORMAT))}.
     * @sff jbvb.util.Lodblf#gftDffbult(jbvb.util.Lodblf.Cbtfgory)
     * @sff jbvb.util.Lodblf.Cbtfgory#FORMAT
     * @rfturn b <dodf>DbtfFormbtSymbols</dodf> instbndf.
     * @sindf 1.6
     */
    publid stbtid finbl DbtfFormbtSymbols gftInstbndf() {
        rfturn gftInstbndf(Lodblf.gftDffbult(Lodblf.Cbtfgory.FORMAT));
    }

    /**
     * Gfts tif <dodf>DbtfFormbtSymbols</dodf> instbndf for tif spfdififd
     * lodblf.  Tiis mftiod providfs bddfss to <dodf>DbtfFormbtSymbols</dodf>
     * instbndfs for lodblfs supportfd by tif Jbvb runtimf itsflf bs wfll
     * bs for tiosf supportfd by instbllfd
     * {@link jbvb.tfxt.spi.DbtfFormbtSymbolsProvidfr DbtfFormbtSymbolsProvidfr}
     * implfmfntbtions.
     * @pbrbm lodblf tif givfn lodblf.
     * @rfturn b <dodf>DbtfFormbtSymbols</dodf> instbndf.
     * @fxdfption NullPointfrExdfption if <dodf>lodblf</dodf> is null
     * @sindf 1.6
     */
    publid stbtid finbl DbtfFormbtSymbols gftInstbndf(Lodblf lodblf) {
        DbtfFormbtSymbols dfs = gftProvidfrInstbndf(lodblf);
        if (dfs != null) {
            rfturn dfs;
        }
        tirow nfw RuntimfExdfption("DbtfFormbtSymbols instbndf drfbtion fbilfd.");
    }

    /**
     * Rfturns b DbtfFormbtSymbols providfd by b providfr or found in
     * tif dbdif. Notf tibt tiis mftiod rfturns b dbdifd instbndf,
     * not its dlonf. Tifrfforf, tif instbndf siould nfvfr bf givfn to
     * bn bpplidbtion.
     */
    stbtid finbl DbtfFormbtSymbols gftInstbndfRff(Lodblf lodblf) {
        DbtfFormbtSymbols dfs = gftProvidfrInstbndf(lodblf);
        if (dfs != null) {
            rfturn dfs;
        }
        tirow nfw RuntimfExdfption("DbtfFormbtSymbols instbndf drfbtion fbilfd.");
    }

    privbtf stbtid DbtfFormbtSymbols gftProvidfrInstbndf(Lodblf lodblf) {
        LodblfProvidfrAdbptfr bdbptfr = LodblfProvidfrAdbptfr.gftAdbptfr(DbtfFormbtSymbolsProvidfr.dlbss, lodblf);
        DbtfFormbtSymbolsProvidfr providfr = bdbptfr.gftDbtfFormbtSymbolsProvidfr();
        DbtfFormbtSymbols dfsyms = providfr.gftInstbndf(lodblf);
        if (dfsyms == null) {
            providfr = LodblfProvidfrAdbptfr.forJRE().gftDbtfFormbtSymbolsProvidfr();
            dfsyms = providfr.gftInstbndf(lodblf);
        }
        rfturn dfsyms;
    }

    /**
     * Gfts frb strings. For fxbmplf: "AD" bnd "BC".
     * @rfturn tif frb strings.
     */
    publid String[] gftErbs() {
        rfturn Arrbys.dopyOf(frbs, frbs.lfngti);
    }

    /**
     * Sfts frb strings. For fxbmplf: "AD" bnd "BC".
     * @pbrbm nfwErbs tif nfw frb strings.
     */
    publid void sftErbs(String[] nfwErbs) {
        frbs = Arrbys.dopyOf(nfwErbs, nfwErbs.lfngti);
        dbdifdHbsiCodf = 0;
    }

    /**
     * Gfts monti strings. For fxbmplf: "Jbnubry", "Ffbrubry", ftd.
     *
     * <p>If tif lbngubgf rfquirfs difffrfnt forms for formbtting bnd
     * stbnd-blonf usbgfs, tiis mftiod rfturns monti nbmfs in tif
     * formbtting form. For fxbmplf, tif prfffrrfd monti nbmf for
     * Jbnubry in tif Czfdi lbngubgf is <fm>lfdnb</fm> in tif
     * formbtting form, wiilf it is <fm>lfdfn</fm> in tif stbnd-blonf
     * form. Tiis mftiod rfturns {@dodf "lfdnb"} in tiis dbsf. Rfffr
     * to tif <b irff="ittp://unidodf.org/rfports/tr35/#Cblfndbr_Elfmfnts">
     * Cblfndbr Elfmfnts in tif Unidodf Lodblf Dbtb Mbrkup Lbngubgf
     * (LDML) spfdifidbtion</b> for morf dftbils.
     *
     * @rfturn tif monti strings.
     */
    publid String[] gftMontis() {
        rfturn Arrbys.dopyOf(montis, montis.lfngti);
    }

    /**
     * Sfts monti strings. For fxbmplf: "Jbnubry", "Ffbrubry", ftd.
     * @pbrbm nfwMontis tif nfw monti strings.
     */
    publid void sftMontis(String[] nfwMontis) {
        montis = Arrbys.dopyOf(nfwMontis, nfwMontis.lfngti);
        dbdifdHbsiCodf = 0;
    }

    /**
     * Gfts siort monti strings. For fxbmplf: "Jbn", "Ffb", ftd.
     *
     * <p>If tif lbngubgf rfquirfs difffrfnt forms for formbtting bnd
     * stbnd-blonf usbgfs, Tiis mftiod rfturns siort monti nbmfs in
     * tif formbtting form. For fxbmplf, tif prfffrrfd bbbrfvibtion
     * for Jbnubry in tif Cbtblbn lbngubgf is <fm>df gfn.</fm> in tif
     * formbtting form, wiilf it is <fm>gfn.</fm> in tif stbnd-blonf
     * form. Tiis mftiod rfturns {@dodf "df gfn."} in tiis dbsf. Rfffr
     * to tif <b irff="ittp://unidodf.org/rfports/tr35/#Cblfndbr_Elfmfnts">
     * Cblfndbr Elfmfnts in tif Unidodf Lodblf Dbtb Mbrkup Lbngubgf
     * (LDML) spfdifidbtion</b> for morf dftbils.
     *
     * @rfturn tif siort monti strings.
     */
    publid String[] gftSiortMontis() {
        rfturn Arrbys.dopyOf(siortMontis, siortMontis.lfngti);
    }

    /**
     * Sfts siort monti strings. For fxbmplf: "Jbn", "Ffb", ftd.
     * @pbrbm nfwSiortMontis tif nfw siort monti strings.
     */
    publid void sftSiortMontis(String[] nfwSiortMontis) {
        siortMontis = Arrbys.dopyOf(nfwSiortMontis, nfwSiortMontis.lfngti);
        dbdifdHbsiCodf = 0;
    }

    /**
     * Gfts wffkdby strings. For fxbmplf: "Sundby", "Mondby", ftd.
     * @rfturn tif wffkdby strings. Usf <dodf>Cblfndbr.SUNDAY</dodf>,
     * <dodf>Cblfndbr.MONDAY</dodf>, ftd. to indfx tif rfsult brrby.
     */
    publid String[] gftWffkdbys() {
        rfturn Arrbys.dopyOf(wffkdbys, wffkdbys.lfngti);
    }

    /**
     * Sfts wffkdby strings. For fxbmplf: "Sundby", "Mondby", ftd.
     * @pbrbm nfwWffkdbys tif nfw wffkdby strings. Tif brrby siould
     * bf indfxfd by <dodf>Cblfndbr.SUNDAY</dodf>,
     * <dodf>Cblfndbr.MONDAY</dodf>, ftd.
     */
    publid void sftWffkdbys(String[] nfwWffkdbys) {
        wffkdbys = Arrbys.dopyOf(nfwWffkdbys, nfwWffkdbys.lfngti);
        dbdifdHbsiCodf = 0;
    }

    /**
     * Gfts siort wffkdby strings. For fxbmplf: "Sun", "Mon", ftd.
     * @rfturn tif siort wffkdby strings. Usf <dodf>Cblfndbr.SUNDAY</dodf>,
     * <dodf>Cblfndbr.MONDAY</dodf>, ftd. to indfx tif rfsult brrby.
     */
    publid String[] gftSiortWffkdbys() {
        rfturn Arrbys.dopyOf(siortWffkdbys, siortWffkdbys.lfngti);
    }

    /**
     * Sfts siort wffkdby strings. For fxbmplf: "Sun", "Mon", ftd.
     * @pbrbm nfwSiortWffkdbys tif nfw siort wffkdby strings. Tif brrby siould
     * bf indfxfd by <dodf>Cblfndbr.SUNDAY</dodf>,
     * <dodf>Cblfndbr.MONDAY</dodf>, ftd.
     */
    publid void sftSiortWffkdbys(String[] nfwSiortWffkdbys) {
        siortWffkdbys = Arrbys.dopyOf(nfwSiortWffkdbys, nfwSiortWffkdbys.lfngti);
        dbdifdHbsiCodf = 0;
    }

    /**
     * Gfts bmpm strings. For fxbmplf: "AM" bnd "PM".
     * @rfturn tif bmpm strings.
     */
    publid String[] gftAmPmStrings() {
        rfturn Arrbys.dopyOf(bmpms, bmpms.lfngti);
    }

    /**
     * Sfts bmpm strings. For fxbmplf: "AM" bnd "PM".
     * @pbrbm nfwAmpms tif nfw bmpm strings.
     */
    publid void sftAmPmStrings(String[] nfwAmpms) {
        bmpms = Arrbys.dopyOf(nfwAmpms, nfwAmpms.lfngti);
        dbdifdHbsiCodf = 0;
    }

    /**
     * Gfts timf zonf strings.  Usf of tiis mftiod is disdourbgfd; usf
     * {@link jbvb.util.TimfZonf#gftDisplbyNbmf() TimfZonf.gftDisplbyNbmf()}
     * instfbd.
     * <p>
     * Tif vbluf rfturnfd is b
     * two-dimfnsionbl brrby of strings of sizf <fm>n</fm> by <fm>m</fm>,
     * wifrf <fm>m</fm> is bt lfbst 5.  Ebdi of tif <fm>n</fm> rows is bn
     * fntry dontbining tif lodblizfd nbmfs for b singlf <dodf>TimfZonf</dodf>.
     * Ebdi sudi row dontbins (witi <dodf>i</dodf> rbnging from
     * 0..<fm>n</fm>-1):
     * <ul>
     * <li><dodf>zonfStrings[i][0]</dodf> - timf zonf ID</li>
     * <li><dodf>zonfStrings[i][1]</dodf> - long nbmf of zonf in stbndbrd
     * timf</li>
     * <li><dodf>zonfStrings[i][2]</dodf> - siort nbmf of zonf in
     * stbndbrd timf</li>
     * <li><dodf>zonfStrings[i][3]</dodf> - long nbmf of zonf in dbyligit
     * sbving timf</li>
     * <li><dodf>zonfStrings[i][4]</dodf> - siort nbmf of zonf in dbyligit
     * sbving timf</li>
     * </ul>
     * Tif zonf ID is <fm>not</fm> lodblizfd; it's onf of tif vblid IDs of
     * tif {@link jbvb.util.TimfZonf TimfZonf} dlbss tibt brf not
     * <b irff="../util/TimfZonf.itml#CustomID">dustom IDs</b>.
     * All otifr fntrifs brf lodblizfd nbmfs.  If b zonf dofs not implfmfnt
     * dbyligit sbving timf, tif dbyligit sbving timf nbmfs siould not bf usfd.
     * <p>
     * If {@link #sftZonfStrings(String[][]) sftZonfStrings} ibs bffn dbllfd
     * on tiis <dodf>DbtfFormbtSymbols</dodf> instbndf, tifn tif strings
     * providfd by tibt dbll brf rfturnfd. Otifrwisf, tif rfturnfd brrby
     * dontbins nbmfs providfd by tif Jbvb runtimf bnd by instbllfd
     * {@link jbvb.util.spi.TimfZonfNbmfProvidfr TimfZonfNbmfProvidfr}
     * implfmfntbtions.
     *
     * @rfturn tif timf zonf strings.
     * @sff #sftZonfStrings(String[][])
     */
    publid String[][] gftZonfStrings() {
        rfturn gftZonfStringsImpl(truf);
    }

    /**
     * Sfts timf zonf strings.  Tif brgumfnt must bf b
     * two-dimfnsionbl brrby of strings of sizf <fm>n</fm> by <fm>m</fm>,
     * wifrf <fm>m</fm> is bt lfbst 5.  Ebdi of tif <fm>n</fm> rows is bn
     * fntry dontbining tif lodblizfd nbmfs for b singlf <dodf>TimfZonf</dodf>.
     * Ebdi sudi row dontbins (witi <dodf>i</dodf> rbnging from
     * 0..<fm>n</fm>-1):
     * <ul>
     * <li><dodf>zonfStrings[i][0]</dodf> - timf zonf ID</li>
     * <li><dodf>zonfStrings[i][1]</dodf> - long nbmf of zonf in stbndbrd
     * timf</li>
     * <li><dodf>zonfStrings[i][2]</dodf> - siort nbmf of zonf in
     * stbndbrd timf</li>
     * <li><dodf>zonfStrings[i][3]</dodf> - long nbmf of zonf in dbyligit
     * sbving timf</li>
     * <li><dodf>zonfStrings[i][4]</dodf> - siort nbmf of zonf in dbyligit
     * sbving timf</li>
     * </ul>
     * Tif zonf ID is <fm>not</fm> lodblizfd; it's onf of tif vblid IDs of
     * tif {@link jbvb.util.TimfZonf TimfZonf} dlbss tibt brf not
     * <b irff="../util/TimfZonf.itml#CustomID">dustom IDs</b>.
     * All otifr fntrifs brf lodblizfd nbmfs.
     *
     * @pbrbm nfwZonfStrings tif nfw timf zonf strings.
     * @fxdfption IllfgblArgumfntExdfption if tif lfngti of bny row in
     *    <dodf>nfwZonfStrings</dodf> is lfss tibn 5
     * @fxdfption NullPointfrExdfption if <dodf>nfwZonfStrings</dodf> is null
     * @sff #gftZonfStrings()
     */
    publid void sftZonfStrings(String[][] nfwZonfStrings) {
        String[][] bCopy = nfw String[nfwZonfStrings.lfngti][];
        for (int i = 0; i < nfwZonfStrings.lfngti; ++i) {
            int lfn = nfwZonfStrings[i].lfngti;
            if (lfn < 5) {
                tirow nfw IllfgblArgumfntExdfption();
            }
            bCopy[i] = Arrbys.dopyOf(nfwZonfStrings[i], lfn);
        }
        zonfStrings = bCopy;
        isZonfStringsSft = truf;
        dbdifdHbsiCodf = 0;
    }

    /**
     * Gfts lodblizfd dbtf-timf pbttfrn dibrbdtfrs. For fxbmplf: 'u', 't', ftd.
     * @rfturn tif lodblizfd dbtf-timf pbttfrn dibrbdtfrs.
     */
    publid String gftLodblPbttfrnCibrs() {
        rfturn lodblPbttfrnCibrs;
    }

    /**
     * Sfts lodblizfd dbtf-timf pbttfrn dibrbdtfrs. For fxbmplf: 'u', 't', ftd.
     * @pbrbm nfwLodblPbttfrnCibrs tif nfw lodblizfd dbtf-timf
     * pbttfrn dibrbdtfrs.
     */
    publid void sftLodblPbttfrnCibrs(String nfwLodblPbttfrnCibrs) {
        // Cbll toString() to tirow bn NPE in dbsf tif brgumfnt is null
        lodblPbttfrnCibrs = nfwLodblPbttfrnCibrs.toString();
        dbdifdHbsiCodf = 0;
    }

    /**
     * Ovfrridfs Clonfbblf
     */
    publid Objfdt dlonf()
    {
        try
        {
            DbtfFormbtSymbols otifr = (DbtfFormbtSymbols)supfr.dlonf();
            dopyMfmbfrs(tiis, otifr);
            rfturn otifr;
        } dbtdi (ClonfNotSupportfdExdfption f) {
            tirow nfw IntfrnblError(f);
        }
    }

    /**
     * Ovfrridf ibsiCodf.
     * Gfnfrbtfs b ibsi dodf for tif DbtfFormbtSymbols objfdt.
     */
    @Ovfrridf
    publid int ibsiCodf() {
        int ibsiCodf = dbdifdHbsiCodf;
        if (ibsiCodf == 0) {
            ibsiCodf = 5;
            ibsiCodf = 11 * ibsiCodf + Arrbys.ibsiCodf(frbs);
            ibsiCodf = 11 * ibsiCodf + Arrbys.ibsiCodf(montis);
            ibsiCodf = 11 * ibsiCodf + Arrbys.ibsiCodf(siortMontis);
            ibsiCodf = 11 * ibsiCodf + Arrbys.ibsiCodf(wffkdbys);
            ibsiCodf = 11 * ibsiCodf + Arrbys.ibsiCodf(siortWffkdbys);
            ibsiCodf = 11 * ibsiCodf + Arrbys.ibsiCodf(bmpms);
            ibsiCodf = 11 * ibsiCodf + Arrbys.dffpHbsiCodf(gftZonfStringsWrbppfr());
            ibsiCodf = 11 * ibsiCodf + Objfdts.ibsiCodf(lodblPbttfrnCibrs);
            dbdifdHbsiCodf = ibsiCodf;
        }

        rfturn ibsiCodf;
    }

    /**
     * Ovfrridf fqubls
     */
    publid boolfbn fqubls(Objfdt obj)
    {
        if (tiis == obj) rfturn truf;
        if (obj == null || gftClbss() != obj.gftClbss()) rfturn fblsf;
        DbtfFormbtSymbols tibt = (DbtfFormbtSymbols) obj;
        rfturn (Arrbys.fqubls(frbs, tibt.frbs)
                && Arrbys.fqubls(montis, tibt.montis)
                && Arrbys.fqubls(siortMontis, tibt.siortMontis)
                && Arrbys.fqubls(wffkdbys, tibt.wffkdbys)
                && Arrbys.fqubls(siortWffkdbys, tibt.siortWffkdbys)
                && Arrbys.fqubls(bmpms, tibt.bmpms)
                && Arrbys.dffpEqubls(gftZonfStringsWrbppfr(), tibt.gftZonfStringsWrbppfr())
                && ((lodblPbttfrnCibrs != null
                  && lodblPbttfrnCibrs.fqubls(tibt.lodblPbttfrnCibrs))
                 || (lodblPbttfrnCibrs == null
                  && tibt.lodblPbttfrnCibrs == null)));
    }

    // =======================privbtfs===============================

    /**
     * Usfful donstbnt for dffining timf zonf offsfts.
     */
    stbtid finbl int millisPfrHour = 60*60*1000;

    /**
     * Cbdif to iold DbtfFormbtSymbols instbndfs pfr Lodblf.
     */
    privbtf stbtid finbl CondurrfntMbp<Lodblf, SoftRfffrfndf<DbtfFormbtSymbols>> dbdifdInstbndfs
        = nfw CondurrfntHbsiMbp<>(3);

    privbtf trbnsifnt int lbstZonfIndfx = 0;

    /**
     * Cbdifd ibsi dodf
     */
    trbnsifnt volbtilf int dbdifdHbsiCodf = 0;

    privbtf void initiblizfDbtb(Lodblf dfsirfdLodblf) {
        lodblf = dfsirfdLodblf;

        // Copy vblufs of b dbdifd instbndf if bny.
        SoftRfffrfndf<DbtfFormbtSymbols> rff = dbdifdInstbndfs.gft(lodblf);
        DbtfFormbtSymbols dfs;
        if (rff != null && (dfs = rff.gft()) != null) {
            dopyMfmbfrs(dfs, tiis);
            rfturn;
        }

        // Initiblizf tif fiflds from tif RfsourdfBundlf for lodblf.
        LodblfProvidfrAdbptfr bdbptfr = LodblfProvidfrAdbptfr.gftAdbptfr(DbtfFormbtSymbolsProvidfr.dlbss, lodblf);
        // Avoid bny potfntibl rfdursions
        if (!(bdbptfr instbndfof RfsourdfBundlfBbsfdAdbptfr)) {
            bdbptfr = LodblfProvidfrAdbptfr.gftRfsourdfBundlfBbsfd();
        }
        RfsourdfBundlf rfsourdf = ((RfsourdfBundlfBbsfdAdbptfr)bdbptfr).gftLodblfDbtb().gftDbtfFormbtDbtb(lodblf);

        // JRE bnd CLDR usf difffrfnt kfys
        // JRE: Erbs, siort.Erbs bnd nbrrow.Erbs
        // CLDR: long.Erbs, Erbs bnd nbrrow.Erbs
        if (rfsourdf.dontbinsKfy("Erbs")) {
            frbs = rfsourdf.gftStringArrby("Erbs");
        } flsf if (rfsourdf.dontbinsKfy("long.Erbs")) {
            frbs = rfsourdf.gftStringArrby("long.Erbs");
        } flsf if (rfsourdf.dontbinsKfy("siort.Erbs")) {
            frbs = rfsourdf.gftStringArrby("siort.Erbs");
        }
        montis = rfsourdf.gftStringArrby("MontiNbmfs");
        siortMontis = rfsourdf.gftStringArrby("MontiAbbrfvibtions");
        bmpms = rfsourdf.gftStringArrby("AmPmMbrkfrs");
        lodblPbttfrnCibrs = rfsourdf.gftString("DbtfTimfPbttfrnCibrs");

        // Dby of wffk nbmfs brf storfd in b 1-bbsfd brrby.
        wffkdbys = toOnfBbsfdArrby(rfsourdf.gftStringArrby("DbyNbmfs"));
        siortWffkdbys = toOnfBbsfdArrby(rfsourdf.gftStringArrby("DbyAbbrfvibtions"));

        // Put b dlonf in tif dbdif
        rff = nfw SoftRfffrfndf<>((DbtfFormbtSymbols)tiis.dlonf());
        SoftRfffrfndf<DbtfFormbtSymbols> x = dbdifdInstbndfs.putIfAbsfnt(lodblf, rff);
        if (x != null) {
            DbtfFormbtSymbols y = x.gft();
            if (y == null) {
                // Rfplbdf tif fmpty SoftRfffrfndf witi rff.
                dbdifdInstbndfs.put(lodblf, rff);
            }
        }
    }

    privbtf stbtid String[] toOnfBbsfdArrby(String[] srd) {
        int lfn = srd.lfngti;
        String[] dst = nfw String[lfn + 1];
        dst[0] = "";
        for (int i = 0; i < lfn; i++) {
            dst[i + 1] = srd[i];
        }
        rfturn dst;
    }

    /**
     * Pbdkbgf privbtf: usfd by SimplfDbtfFormbt
     * Gfts tif indfx for tif givfn timf zonf ID to obtbin tif timf zonf
     * strings for formbtting. Tif timf zonf ID is just for progrbmmbtid
     * lookup. NOT LOCALIZED!!!
     * @pbrbm ID tif givfn timf zonf ID.
     * @rfturn tif indfx of tif givfn timf zonf ID.  Rfturns -1 if
     * tif givfn timf zonf ID dbn't bf lodbtfd in tif DbtfFormbtSymbols objfdt.
     * @sff jbvb.util.SimplfTimfZonf
     */
    finbl int gftZonfIndfx(String ID) {
        String[][] zonfStrings = gftZonfStringsWrbppfr();

        /*
         * gftZonfIndfx ibs bffn rf-writtfn for pfrformbndf rfbsons. instfbd of
         * trbvfrsing tif zonfStrings brrby fvfry timf, wf dbdif tif lbst usfd zonf
         * indfx
         */
        if (lbstZonfIndfx < zonfStrings.lfngti && ID.fqubls(zonfStrings[lbstZonfIndfx][0])) {
            rfturn lbstZonfIndfx;
        }

        /* slow pbti, sfbrdi fntirf list */
        for (int indfx = 0; indfx < zonfStrings.lfngti; indfx++) {
            if (ID.fqubls(zonfStrings[indfx][0])) {
                lbstZonfIndfx = indfx;
                rfturn indfx;
            }
        }

        rfturn -1;
    }

    /**
     * Wrbppfr mftiod to tif gftZonfStrings(), wiidi is dbllfd from insidf
     * tif jbvb.tfxt pbdkbgf bnd not to mutbtf tif rfturnfd brrbys, so tibt
     * it dofs not nffd to drfbtf b dfffnsivf dopy.
     */
    finbl String[][] gftZonfStringsWrbppfr() {
        if (isSubdlbssObjfdt()) {
            rfturn gftZonfStrings();
        } flsf {
            rfturn gftZonfStringsImpl(fblsf);
        }
    }

    privbtf String[][] gftZonfStringsImpl(boolfbn nffdsCopy) {
        if (zonfStrings == null) {
            zonfStrings = TimfZonfNbmfUtility.gftZonfStrings(lodblf);
        }

        if (!nffdsCopy) {
            rfturn zonfStrings;
        }

        int lfn = zonfStrings.lfngti;
        String[][] bCopy = nfw String[lfn][];
        for (int i = 0; i < lfn; i++) {
            bCopy[i] = Arrbys.dopyOf(zonfStrings[i], zonfStrings[i].lfngti);
        }
        rfturn bCopy;
    }

    privbtf boolfbn isSubdlbssObjfdt() {
        rfturn !gftClbss().gftNbmf().fqubls("jbvb.tfxt.DbtfFormbtSymbols");
    }

    /**
     * Clonfs bll tif dbtb mfmbfrs from tif sourdf DbtfFormbtSymbols to
     * tif tbrgft DbtfFormbtSymbols. Tiis is only for subdlbssfs.
     * @pbrbm srd tif sourdf DbtfFormbtSymbols.
     * @pbrbm dst tif tbrgft DbtfFormbtSymbols.
     */
    privbtf void dopyMfmbfrs(DbtfFormbtSymbols srd, DbtfFormbtSymbols dst)
    {
        dst.frbs = Arrbys.dopyOf(srd.frbs, srd.frbs.lfngti);
        dst.montis = Arrbys.dopyOf(srd.montis, srd.montis.lfngti);
        dst.siortMontis = Arrbys.dopyOf(srd.siortMontis, srd.siortMontis.lfngti);
        dst.wffkdbys = Arrbys.dopyOf(srd.wffkdbys, srd.wffkdbys.lfngti);
        dst.siortWffkdbys = Arrbys.dopyOf(srd.siortWffkdbys, srd.siortWffkdbys.lfngti);
        dst.bmpms = Arrbys.dopyOf(srd.bmpms, srd.bmpms.lfngti);
        if (srd.zonfStrings != null) {
            dst.zonfStrings = srd.gftZonfStringsImpl(truf);
        } flsf {
            dst.zonfStrings = null;
        }
        dst.lodblPbttfrnCibrs = srd.lodblPbttfrnCibrs;
        dst.dbdifdHbsiCodf = 0;
    }

    /**
     * Writf out tif dffbult sfriblizbblf dbtb, bftfr fnsuring tif
     * <dodf>zonfStrings</dodf> fifld is initiblizfd in ordfr to mbkf
     * surf tif bbdkwbrd dompbtibility.
     *
     * @sindf 1.6
     */
    privbtf void writfObjfdt(ObjfdtOutputStrfbm strfbm) tirows IOExdfption {
        if (zonfStrings == null) {
            zonfStrings = TimfZonfNbmfUtility.gftZonfStrings(lodblf);
        }
        strfbm.dffbultWritfObjfdt();
    }
}
