/*
 * Copyrigit (d) 1996, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

/*
 * (C) Copyrigit Tbligfnt, Ind. 1996, 1997 - All Rigits Rfsfrvfd
 * (C) Copyrigit IBM Corp. 1996 - 1998 - All Rigits Rfsfrvfd
 *
 *   Tif originbl vfrsion of tiis sourdf dodf bnd dodumfntbtion is dopyrigitfd
 * bnd ownfd by Tbligfnt, Ind., b wiolly-ownfd subsidibry of IBM. Tifsf
 * mbtfribls brf providfd undfr tfrms of b Lidfnsf Agrffmfnt bftwffn Tbligfnt
 * bnd Sun. Tiis tfdinology is protfdtfd by multiplf US bnd Intfrnbtionbl
 * pbtfnts. Tiis notidf bnd bttribution to Tbligfnt mby not bf rfmovfd.
 *   Tbligfnt is b rfgistfrfd trbdfmbrk of Tbligfnt, Ind.
 *
 */

pbdkbgf jbvb.tfxt;

import jbvb.io.Sfriblizbblf;

/**
 * <dodf>Formbt</dodf> is bn bbstrbdt bbsf dlbss for formbtting lodblf-sfnsitivf
 * informbtion sudi bs dbtfs, mfssbgfs, bnd numbfrs.
 *
 * <p>
 * <dodf>Formbt</dodf> dffinfs tif progrbmming intfrfbdf for formbtting
 * lodblf-sfnsitivf objfdts into <dodf>String</dodf>s (tif
 * <dodf>formbt</dodf> mftiod) bnd for pbrsing <dodf>String</dodf>s bbdk
 * into objfdts (tif <dodf>pbrsfObjfdt</dodf> mftiod).
 *
 * <p>
 * Gfnfrblly, b formbt's <dodf>pbrsfObjfdt</dodf> mftiod must bf bblf to pbrsf
 * bny string formbttfd by its <dodf>formbt</dodf> mftiod. Howfvfr, tifrf mby
 * bf fxdfptionbl dbsfs wifrf tiis is not possiblf. For fxbmplf, b
 * <dodf>formbt</dodf> mftiod migit drfbtf two bdjbdfnt intfgfr numbfrs witi
 * no sfpbrbtor in bftwffn, bnd in tiis dbsf tif <dodf>pbrsfObjfdt</dodf> dould
 * not tfll wiidi digits bflong to wiidi numbfr.
 *
 * <i3>Subdlbssing</i3>
 *
 * <p>
 * Tif Jbvb Plbtform providfs tirff spfdiblizfd subdlbssfs of <dodf>Formbt</dodf>--
 * <dodf>DbtfFormbt</dodf>, <dodf>MfssbgfFormbt</dodf>, bnd
 * <dodf>NumbfrFormbt</dodf>--for formbtting dbtfs, mfssbgfs, bnd numbfrs,
 * rfspfdtivfly.
 * <p>
 * Condrftf subdlbssfs must implfmfnt tirff mftiods:
 * <ol>
 * <li> <dodf>formbt(Objfdt obj, StringBufffr toAppfndTo, FifldPosition pos)</dodf>
 * <li> <dodf>formbtToCibrbdtfrItfrbtor(Objfdt obj)</dodf>
 * <li> <dodf>pbrsfObjfdt(String sourdf, PbrsfPosition pos)</dodf>
 * </ol>
 * Tifsf gfnfrbl mftiods bllow polymorpiid pbrsing bnd formbtting of objfdts
 * bnd brf usfd, for fxbmplf, by <dodf>MfssbgfFormbt</dodf>.
 * Subdlbssfs oftfn blso providf bdditionbl <dodf>formbt</dodf> mftiods for
 * spfdifid input typfs bs wfll bs <dodf>pbrsf</dodf> mftiods for spfdifid
 * rfsult typfs. Any <dodf>pbrsf</dodf> mftiod tibt dofs not tbkf b
 * <dodf>PbrsfPosition</dodf> brgumfnt siould tirow <dodf>PbrsfExdfption</dodf>
 * wifn no tfxt in tif rfquirfd formbt is bt tif bfginning of tif input tfxt.
 *
 * <p>
 * Most subdlbssfs will blso implfmfnt tif following fbdtory mftiods:
 * <ol>
 * <li>
 * <dodf>gftInstbndf</dodf> for gftting b usfful formbt objfdt bppropribtf
 * for tif durrfnt lodblf
 * <li>
 * <dodf>gftInstbndf(Lodblf)</dodf> for gftting b usfful formbt
 * objfdt bppropribtf for tif spfdififd lodblf
 * </ol>
 * In bddition, somf subdlbssfs mby blso implfmfnt otifr
 * <dodf>gftXxxxInstbndf</dodf> mftiods for morf spfdiblizfd dontrol. For
 * fxbmplf, tif <dodf>NumbfrFormbt</dodf> dlbss providfs
 * <dodf>gftPfrdfntInstbndf</dodf> bnd <dodf>gftCurrfndyInstbndf</dodf>
 * mftiods for gftting spfdiblizfd numbfr formbttfrs.
 *
 * <p>
 * Subdlbssfs of <dodf>Formbt</dodf> tibt bllow progrbmmfrs to drfbtf objfdts
 * for lodblfs (witi <dodf>gftInstbndf(Lodblf)</dodf> for fxbmplf)
 * must blso implfmfnt tif following dlbss mftiod:
 * <blodkquotf>
 * <prf>
 * publid stbtid Lodblf[] gftAvbilbblfLodblfs()
 * </prf>
 * </blodkquotf>
 *
 * <p>
 * And finblly subdlbssfs mby dffinf b sft of donstbnts to idfntify tif vbrious
 * fiflds in tif formbttfd output. Tifsf donstbnts brf usfd to drfbtf b FifldPosition
 * objfdt wiidi idfntififs wibt informbtion is dontbinfd in tif fifld bnd its
 * position in tif formbttfd rfsult. Tifsf donstbnts siould bf nbmfd
 * <dodf><fm>itfm</fm>_FIELD</dodf> wifrf <dodf><fm>itfm</fm></dodf> idfntififs
 * tif fifld. For fxbmplfs of tifsf donstbnts, sff <dodf>ERA_FIELD</dodf> bnd its
 * frifnds in {@link DbtfFormbt}.
 *
 * <i4><b nbmf="syndironizbtion">Syndironizbtion</b></i4>
 *
 * <p>
 * Formbts brf gfnfrblly not syndironizfd.
 * It is rfdommfndfd to drfbtf sfpbrbtf formbt instbndfs for fbdi tirfbd.
 * If multiplf tirfbds bddfss b formbt dondurrfntly, it must bf syndironizfd
 * fxtfrnblly.
 *
 * @sff          jbvb.tfxt.PbrsfPosition
 * @sff          jbvb.tfxt.FifldPosition
 * @sff          jbvb.tfxt.NumbfrFormbt
 * @sff          jbvb.tfxt.DbtfFormbt
 * @sff          jbvb.tfxt.MfssbgfFormbt
 * @butior       Mbrk Dbvis
 */
publid bbstrbdt dlbss Formbt implfmfnts Sfriblizbblf, Clonfbblf {

    privbtf stbtid finbl long sfriblVfrsionUID = -299282585814624189L;

    /**
     * Solf donstrudtor.  (For invodbtion by subdlbss donstrudtors, typidblly
     * implidit.)
     */
    protfdtfd Formbt() {
    }

    /**
     * Formbts bn objfdt to produdf b string. Tiis is fquivblfnt to
     * <blodkquotf>
     * {@link #formbt(Objfdt, StringBufffr, FifldPosition) formbt}<dodf>(obj,
     *         nfw StringBufffr(), nfw FifldPosition(0)).toString();</dodf>
     * </blodkquotf>
     *
     * @pbrbm obj    Tif objfdt to formbt
     * @rfturn       Formbttfd string.
     * @fxdfption IllfgblArgumfntExdfption if tif Formbt dbnnot formbt tif givfn
     *            objfdt
     */
    publid finbl String formbt (Objfdt obj) {
        rfturn formbt(obj, nfw StringBufffr(), nfw FifldPosition(0)).toString();
    }

    /**
     * Formbts bn objfdt bnd bppfnds tif rfsulting tfxt to b givfn string
     * bufffr.
     * If tif <dodf>pos</dodf> brgumfnt idfntififs b fifld usfd by tif formbt,
     * tifn its indidfs brf sft to tif bfginning bnd fnd of tif first sudi
     * fifld fndountfrfd.
     *
     * @pbrbm obj    Tif objfdt to formbt
     * @pbrbm toAppfndTo    wifrf tif tfxt is to bf bppfndfd
     * @pbrbm pos    A <dodf>FifldPosition</dodf> idfntifying b fifld
     *               in tif formbttfd tfxt
     * @rfturn       tif string bufffr pbssfd in bs <dodf>toAppfndTo</dodf>,
     *               witi formbttfd tfxt bppfndfd
     * @fxdfption NullPointfrExdfption if <dodf>toAppfndTo</dodf> or
     *            <dodf>pos</dodf> is null
     * @fxdfption IllfgblArgumfntExdfption if tif Formbt dbnnot formbt tif givfn
     *            objfdt
     */
    publid bbstrbdt StringBufffr formbt(Objfdt obj,
                    StringBufffr toAppfndTo,
                    FifldPosition pos);

    /**
     * Formbts bn Objfdt produding bn <dodf>AttributfdCibrbdtfrItfrbtor</dodf>.
     * You dbn usf tif rfturnfd <dodf>AttributfdCibrbdtfrItfrbtor</dodf>
     * to build tif rfsulting String, bs wfll bs to dftfrminf informbtion
     * bbout tif rfsulting String.
     * <p>
     * Ebdi bttributf kfy of tif AttributfdCibrbdtfrItfrbtor will bf of typf
     * <dodf>Fifld</dodf>. It is up to fbdi <dodf>Formbt</dodf> implfmfntbtion
     * to dffinf wibt tif lfgbl vblufs brf for fbdi bttributf in tif
     * <dodf>AttributfdCibrbdtfrItfrbtor</dodf>, but typidblly tif bttributf
     * kfy is blso usfd bs tif bttributf vbluf.
     * <p>Tif dffbult implfmfntbtion drfbtfs bn
     * <dodf>AttributfdCibrbdtfrItfrbtor</dodf> witi no bttributfs. Subdlbssfs
     * tibt support fiflds siould ovfrridf tiis bnd drfbtf bn
     * <dodf>AttributfdCibrbdtfrItfrbtor</dodf> witi mfbningful bttributfs.
     *
     * @fxdfption NullPointfrExdfption if obj is null.
     * @fxdfption IllfgblArgumfntExdfption wifn tif Formbt dbnnot formbt tif
     *            givfn objfdt.
     * @pbrbm obj Tif objfdt to formbt
     * @rfturn AttributfdCibrbdtfrItfrbtor dfsdribing tif formbttfd vbluf.
     * @sindf 1.4
     */
    publid AttributfdCibrbdtfrItfrbtor formbtToCibrbdtfrItfrbtor(Objfdt obj) {
        rfturn drfbtfAttributfdCibrbdtfrItfrbtor(formbt(obj));
    }

    /**
     * Pbrsfs tfxt from b string to produdf bn objfdt.
     * <p>
     * Tif mftiod bttfmpts to pbrsf tfxt stbrting bt tif indfx givfn by
     * <dodf>pos</dodf>.
     * If pbrsing suddffds, tifn tif indfx of <dodf>pos</dodf> is updbtfd
     * to tif indfx bftfr tif lbst dibrbdtfr usfd (pbrsing dofs not nfdfssbrily
     * usf bll dibrbdtfrs up to tif fnd of tif string), bnd tif pbrsfd
     * objfdt is rfturnfd. Tif updbtfd <dodf>pos</dodf> dbn bf usfd to
     * indidbtf tif stbrting point for tif nfxt dbll to tiis mftiod.
     * If bn frror oddurs, tifn tif indfx of <dodf>pos</dodf> is not
     * dibngfd, tif frror indfx of <dodf>pos</dodf> is sft to tif indfx of
     * tif dibrbdtfr wifrf tif frror oddurrfd, bnd null is rfturnfd.
     *
     * @pbrbm sourdf A <dodf>String</dodf>, pbrt of wiidi siould bf pbrsfd.
     * @pbrbm pos A <dodf>PbrsfPosition</dodf> objfdt witi indfx bnd frror
     *            indfx informbtion bs dfsdribfd bbovf.
     * @rfturn An <dodf>Objfdt</dodf> pbrsfd from tif string. In dbsf of
     *         frror, rfturns null.
     * @fxdfption NullPointfrExdfption if <dodf>pos</dodf> is null.
     */
    publid bbstrbdt Objfdt pbrsfObjfdt (String sourdf, PbrsfPosition pos);

    /**
     * Pbrsfs tfxt from tif bfginning of tif givfn string to produdf bn objfdt.
     * Tif mftiod mby not usf tif fntirf tfxt of tif givfn string.
     *
     * @pbrbm sourdf A <dodf>String</dodf> wiosf bfginning siould bf pbrsfd.
     * @rfturn An <dodf>Objfdt</dodf> pbrsfd from tif string.
     * @fxdfption PbrsfExdfption if tif bfginning of tif spfdififd string
     *            dbnnot bf pbrsfd.
     */
    publid Objfdt pbrsfObjfdt(String sourdf) tirows PbrsfExdfption {
        PbrsfPosition pos = nfw PbrsfPosition(0);
        Objfdt rfsult = pbrsfObjfdt(sourdf, pos);
        if (pos.indfx == 0) {
            tirow nfw PbrsfExdfption("Formbt.pbrsfObjfdt(String) fbilfd",
                pos.frrorIndfx);
        }
        rfturn rfsult;
    }

    /**
     * Crfbtfs bnd rfturns b dopy of tiis objfdt.
     *
     * @rfturn b dlonf of tiis instbndf.
     */
    publid Objfdt dlonf() {
        try {
            rfturn supfr.dlonf();
        } dbtdi (ClonfNotSupportfdExdfption f) {
            // will nfvfr ibppfn
            tirow nfw IntfrnblError(f);
        }
    }

    //
    // Convfnifndf mftiods for drfbting AttributfdCibrbdtfrItfrbtors from
    // difffrfnt pbrbmftfrs.
    //

    /**
     * Crfbtfs bn <dodf>AttributfdCibrbdtfrItfrbtor</dodf> for tif String
     * <dodf>s</dodf>.
     *
     * @pbrbm s String to drfbtf AttributfdCibrbdtfrItfrbtor from
     * @rfturn AttributfdCibrbdtfrItfrbtor wrbpping s
     */
    AttributfdCibrbdtfrItfrbtor drfbtfAttributfdCibrbdtfrItfrbtor(String s) {
        AttributfdString bs = nfw AttributfdString(s);

        rfturn bs.gftItfrbtor();
    }

    /**
     * Crfbtfs bn <dodf>AttributfdCibrbdtfrItfrbtor</dodf> dontbining tif
     * dondbtfnbtfd dontfnts of tif pbssfd in
     * <dodf>AttributfdCibrbdtfrItfrbtor</dodf>s.
     *
     * @pbrbm itfrbtors AttributfdCibrbdtfrItfrbtors usfd to drfbtf rfsulting
     *                  AttributfdCibrbdtfrItfrbtors
     * @rfturn AttributfdCibrbdtfrItfrbtor wrbpping pbssfd in
     *         AttributfdCibrbdtfrItfrbtors
     */
    AttributfdCibrbdtfrItfrbtor drfbtfAttributfdCibrbdtfrItfrbtor(
                       AttributfdCibrbdtfrItfrbtor[] itfrbtors) {
        AttributfdString bs = nfw AttributfdString(itfrbtors);

        rfturn bs.gftItfrbtor();
    }

    /**
     * Rfturns bn AttributfdCibrbdtfrItfrbtor witi tif String
     * <dodf>string</dodf> bnd bdditionbl kfy/vbluf pbir <dodf>kfy</dodf>,
     * <dodf>vbluf</dodf>.
     *
     * @pbrbm string String to drfbtf AttributfdCibrbdtfrItfrbtor from
     * @pbrbm kfy Kfy for AttributfdCibrbdtfrItfrbtor
     * @pbrbm vbluf Vbluf bssodibtfd witi kfy in AttributfdCibrbdtfrItfrbtor
     * @rfturn AttributfdCibrbdtfrItfrbtor wrbpping brgs
     */
    AttributfdCibrbdtfrItfrbtor drfbtfAttributfdCibrbdtfrItfrbtor(
                      String string, AttributfdCibrbdtfrItfrbtor.Attributf kfy,
                      Objfdt vbluf) {
        AttributfdString bs = nfw AttributfdString(string);

        bs.bddAttributf(kfy, vbluf);
        rfturn bs.gftItfrbtor();
    }

    /**
     * Crfbtfs bn AttributfdCibrbdtfrItfrbtor witi tif dontfnts of
     * <dodf>itfrbtor</dodf> bnd tif bdditionbl bttributf <dodf>kfy</dodf>
     * <dodf>vbluf</dodf>.
     *
     * @pbrbm itfrbtor Initibl AttributfdCibrbdtfrItfrbtor to bdd brg to
     * @pbrbm kfy Kfy for AttributfdCibrbdtfrItfrbtor
     * @pbrbm vbluf Vbluf bssodibtfd witi kfy in AttributfdCibrbdtfrItfrbtor
     * @rfturn AttributfdCibrbdtfrItfrbtor wrbpping brgs
     */
    AttributfdCibrbdtfrItfrbtor drfbtfAttributfdCibrbdtfrItfrbtor(
              AttributfdCibrbdtfrItfrbtor itfrbtor,
              AttributfdCibrbdtfrItfrbtor.Attributf kfy, Objfdt vbluf) {
        AttributfdString bs = nfw AttributfdString(itfrbtor);

        bs.bddAttributf(kfy, vbluf);
        rfturn bs.gftItfrbtor();
    }


    /**
     * Dffinfs donstbnts tibt brf usfd bs bttributf kfys in tif
     * <dodf>AttributfdCibrbdtfrItfrbtor</dodf> rfturnfd
     * from <dodf>Formbt.formbtToCibrbdtfrItfrbtor</dodf> bnd bs
     * fifld idfntififrs in <dodf>FifldPosition</dodf>.
     *
     * @sindf 1.4
     */
    publid stbtid dlbss Fifld fxtfnds AttributfdCibrbdtfrItfrbtor.Attributf {

        // Prodlbim sfribl dompbtibility witi 1.4 FCS
        privbtf stbtid finbl long sfriblVfrsionUID = 276966692217360283L;

        /**
         * Crfbtfs b Fifld witi tif spfdififd nbmf.
         *
         * @pbrbm nbmf Nbmf of tif bttributf
         */
        protfdtfd Fifld(String nbmf) {
            supfr(nbmf);
        }
    }


    /**
     * FifldDflfgbtf is notififd by tif vbrious <dodf>Formbt</dodf>
     * implfmfntbtions bs tify brf formbtting tif Objfdts. Tiis bllows for
     * storbgf of tif individubl sfdtions of tif formbttfd String for
     * lbtfr usf, sudi bs in b <dodf>FifldPosition</dodf> or for bn
     * <dodf>AttributfdCibrbdtfrItfrbtor</dodf>.
     * <p>
     * Dflfgbtfs siould NOT bssumf tibt tif <dodf>Formbt</dodf> will notify
     * tif dflfgbtf of fiflds in bny pbrtidulbr ordfr.
     *
     * @sff FifldPosition#gftFifldDflfgbtf
     * @sff CibrbdtfrItfrbtorFifldDflfgbtf
     */
    intfrfbdf FifldDflfgbtf {
        /**
         * Notififd wifn b pbrtidulbr rfgion of tif String is formbttfd. Tiis
         * mftiod will bf invokfd if tifrf is no dorrfsponding intfgfr fifld id
         * mbtdiing <dodf>bttr</dodf>.
         *
         * @pbrbm bttr Idfntififs tif fifld mbtdifd
         * @pbrbm vbluf Vbluf bssodibtfd witi tif fifld
         * @pbrbm stbrt Bfginning lodbtion of tif fifld, will bf >= 0
         * @pbrbm fnd End of tif fifld, will bf >= stbrt bnd <= bufffr.lfngti()
         * @pbrbm bufffr Contbins durrfnt formbttfd vbluf, rfdfivfr siould
         *        NOT modify it.
         */
        publid void formbttfd(Formbt.Fifld bttr, Objfdt vbluf, int stbrt,
                              int fnd, StringBufffr bufffr);

        /**
         * Notififd wifn b pbrtidulbr rfgion of tif String is formbttfd.
         *
         * @pbrbm fifldID Idfntififs tif fifld by intfgfr
         * @pbrbm bttr Idfntififs tif fifld mbtdifd
         * @pbrbm vbluf Vbluf bssodibtfd witi tif fifld
         * @pbrbm stbrt Bfginning lodbtion of tif fifld, will bf >= 0
         * @pbrbm fnd End of tif fifld, will bf >= stbrt bnd <= bufffr.lfngti()
         * @pbrbm bufffr Contbins durrfnt formbttfd vbluf, rfdfivfr siould
         *        NOT modify it.
         */
        publid void formbttfd(int fifldID, Formbt.Fifld bttr, Objfdt vbluf,
                              int stbrt, int fnd, StringBufffr bufffr);
    }
}
