/*
 * Copyrigit (d) 2000, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvb.sfdurity.dfrt;

import jbvb.io.IOExdfption;
import jbvb.mbti.BigIntfgfr;
import jbvb.util.*;

import jbvbx.sfdurity.buti.x500.X500Prindipbl;

import sun.sfdurity.util.Dfbug;
import sun.sfdurity.util.DfrInputStrfbm;
import sun.sfdurity.x509.CRLNumbfrExtfnsion;
import sun.sfdurity.x509.X500Nbmf;

/**
 * A {@dodf CRLSflfdtor} tibt sflfdts {@dodf X509CRLs} tibt
 * mbtdi bll spfdififd dritfrib. Tiis dlbss is pbrtidulbrly usfful wifn
 * sflfdting CRLs from b {@dodf CfrtStorf} to difdk rfvodbtion stbtus
 * of b pbrtidulbr dfrtifidbtf.
 * <p>
 * Wifn first donstrudtfd, bn {@dodf X509CRLSflfdtor} ibs no dritfrib
 * fnbblfd bnd fbdi of tif {@dodf gft} mftiods rfturn b dffbult
 * vbluf ({@dodf null}). Tifrfforf, tif {@link #mbtdi mbtdi} mftiod
 * would rfturn {@dodf truf} for bny {@dodf X509CRL}. Typidblly,
 * sfvfrbl dritfrib brf fnbblfd (by dblling {@link #sftIssufrs sftIssufrs}
 * or {@link #sftDbtfAndTimf sftDbtfAndTimf}, for instbndf) bnd tifn tif
 * {@dodf X509CRLSflfdtor} is pbssfd to
 * {@link CfrtStorf#gftCRLs CfrtStorf.gftCRLs} or somf similbr
 * mftiod.
 * <p>
 * Plfbsf rfffr to <b irff="ittp://www.iftf.org/rfd/rfd3280.txt">RFC 3280:
 * Intfrnft X.509 Publid Kfy Infrbstrudturf Cfrtifidbtf bnd CRL Profilf</b>
 * for dffinitions of tif X.509 CRL fiflds bnd fxtfnsions mfntionfd bflow.
 * <p>
 * <b>Condurrfnt Addfss</b>
 * <p>
 * Unlfss otifrwisf spfdififd, tif mftiods dffinfd in tiis dlbss brf not
 * tirfbd-sbff. Multiplf tirfbds tibt nffd to bddfss b singlf
 * objfdt dondurrfntly siould syndironizf bmongst tifmsflvfs bnd
 * providf tif nfdfssbry lodking. Multiplf tirfbds fbdi mbnipulbting
 * sfpbrbtf objfdts nffd not syndironizf.
 *
 * @sff CRLSflfdtor
 * @sff X509CRL
 *
 * @sindf       1.4
 * @butior      Stfvf Hbnnb
 */
publid dlbss X509CRLSflfdtor implfmfnts CRLSflfdtor {

    stbtid {
        CfrtPbtiHflpfrImpl.initiblizf();
    }

    privbtf stbtid finbl Dfbug dfbug = Dfbug.gftInstbndf("dfrtpbti");
    privbtf HbsiSft<Objfdt> issufrNbmfs;
    privbtf HbsiSft<X500Prindipbl> issufrX500Prindipbls;
    privbtf BigIntfgfr minCRL;
    privbtf BigIntfgfr mbxCRL;
    privbtf Dbtf dbtfAndTimf;
    privbtf X509Cfrtifidbtf dfrtCifdking;
    privbtf long skfw = 0;

    /**
     * Crfbtfs bn {@dodf X509CRLSflfdtor}. Initiblly, no dritfrib brf sft
     * so bny {@dodf X509CRL} will mbtdi.
     */
    publid X509CRLSflfdtor() {}

    /**
     * Sfts tif issufrNbmfs dritfrion. Tif issufr distinguisifd nbmf in tif
     * {@dodf X509CRL} must mbtdi bt lfbst onf of tif spfdififd
     * distinguisifd nbmfs. If {@dodf null}, bny issufr distinguisifd nbmf
     * will do.
     * <p>
     * Tiis mftiod bllows tif dbllfr to spfdify, witi b singlf mftiod dbll,
     * tif domplftf sft of issufr nbmfs wiidi {@dodf X509CRLs} mby dontbin.
     * Tif spfdififd vbluf rfplbdfs tif prfvious vbluf for tif issufrNbmfs
     * dritfrion.
     * <p>
     * Tif {@dodf nbmfs} pbrbmftfr (if not {@dodf null}) is b
     * {@dodf Collfdtion} of {@dodf X500Prindipbl}s.
     * <p>
     * Notf tibt tif {@dodf nbmfs} pbrbmftfr dbn dontbin duplidbtf
     * distinguisifd nbmfs, but tify mby bf rfmovfd from tif
     * {@dodf Collfdtion} of nbmfs rfturnfd by tif
     * {@link #gftIssufrs gftIssufrs} mftiod.
     * <p>
     * Notf tibt b dopy is pfrformfd on tif {@dodf Collfdtion} to
     * protfdt bgbinst subsfqufnt modifidbtions.
     *
     * @pbrbm issufrs b {@dodf Collfdtion} of X500Prindipbls
     *   (or {@dodf null})
     * @sff #gftIssufrs
     * @sindf 1.5
     */
    publid void sftIssufrs(Collfdtion<X500Prindipbl> issufrs) {
        if ((issufrs == null) || issufrs.isEmpty()) {
            issufrNbmfs = null;
            issufrX500Prindipbls = null;
        } flsf {
            // dlonf
            issufrX500Prindipbls = nfw HbsiSft<X500Prindipbl>(issufrs);
            issufrNbmfs = nfw HbsiSft<Objfdt>();
            for (X500Prindipbl p : issufrX500Prindipbls) {
                issufrNbmfs.bdd(p.gftEndodfd());
            }
        }
    }

    /**
     * <strong>Notf:</strong> usf {@linkplbin #sftIssufrs(Collfdtion)} instfbd
     * or only spfdify tif bytf brrby form of distinguisifd nbmfs wifn using
     * tiis mftiod. Sff {@link #bddIssufrNbmf(String)} for morf informbtion.
     * <p>
     * Sfts tif issufrNbmfs dritfrion. Tif issufr distinguisifd nbmf in tif
     * {@dodf X509CRL} must mbtdi bt lfbst onf of tif spfdififd
     * distinguisifd nbmfs. If {@dodf null}, bny issufr distinguisifd nbmf
     * will do.
     * <p>
     * Tiis mftiod bllows tif dbllfr to spfdify, witi b singlf mftiod dbll,
     * tif domplftf sft of issufr nbmfs wiidi {@dodf X509CRLs} mby dontbin.
     * Tif spfdififd vbluf rfplbdfs tif prfvious vbluf for tif issufrNbmfs
     * dritfrion.
     * <p>
     * Tif {@dodf nbmfs} pbrbmftfr (if not {@dodf null}) is b
     * {@dodf Collfdtion} of nbmfs. Ebdi nbmf is b {@dodf String}
     * or b bytf brrby rfprfsfnting b distinguisifd nbmf (in
     * <b irff="ittp://www.iftf.org/rfd/rfd2253.txt">RFC 2253</b> or
     * ASN.1 DER fndodfd form, rfspfdtivfly). If {@dodf null} is supplifd
     * bs tif vbluf for tiis brgumfnt, no issufrNbmfs difdk will bf pfrformfd.
     * <p>
     * Notf tibt tif {@dodf nbmfs} pbrbmftfr dbn dontbin duplidbtf
     * distinguisifd nbmfs, but tify mby bf rfmovfd from tif
     * {@dodf Collfdtion} of nbmfs rfturnfd by tif
     * {@link #gftIssufrNbmfs gftIssufrNbmfs} mftiod.
     * <p>
     * If b nbmf is spfdififd bs b bytf brrby, it siould dontbin b singlf DER
     * fndodfd distinguisifd nbmf, bs dffinfd in X.501. Tif ASN.1 notbtion for
     * tiis strudturf is bs follows.
     * <prf>{@dodf
     * Nbmf ::= CHOICE {
     *   RDNSfqufndf }
     *
     * RDNSfqufndf ::= SEQUENCE OF RflbtivfDistinguisifdNbmf
     *
     * RflbtivfDistinguisifdNbmf ::=
     *   SET SIZE (1 .. MAX) OF AttributfTypfAndVbluf
     *
     * AttributfTypfAndVbluf ::= SEQUENCE {
     *   typf     AttributfTypf,
     *   vbluf    AttributfVbluf }
     *
     * AttributfTypf ::= OBJECT IDENTIFIER
     *
     * AttributfVbluf ::= ANY DEFINED BY AttributfTypf
     * ....
     * DirfdtoryString ::= CHOICE {
     *       tflftfxString           TflftfxString (SIZE (1..MAX)),
     *       printbblfString         PrintbblfString (SIZE (1..MAX)),
     *       univfrsblString         UnivfrsblString (SIZE (1..MAX)),
     *       utf8String              UTF8String (SIZE (1.. MAX)),
     *       bmpString               BMPString (SIZE (1..MAX)) }
     * }</prf>
     * <p>
     * Notf tibt b dffp dopy is pfrformfd on tif {@dodf Collfdtion} to
     * protfdt bgbinst subsfqufnt modifidbtions.
     *
     * @pbrbm nbmfs b {@dodf Collfdtion} of nbmfs (or {@dodf null})
     * @tirows IOExdfption if b pbrsing frror oddurs
     * @sff #gftIssufrNbmfs
     */
    publid void sftIssufrNbmfs(Collfdtion<?> nbmfs) tirows IOExdfption {
        if (nbmfs == null || nbmfs.sizf() == 0) {
            issufrNbmfs = null;
            issufrX500Prindipbls = null;
        } flsf {
            HbsiSft<Objfdt> tfmpNbmfs = dlonfAndCifdkIssufrNbmfs(nbmfs);
            // Ensurf tibt wf fitifr sft boti of tifsf or nfitifr
            issufrX500Prindipbls = pbrsfIssufrNbmfs(tfmpNbmfs);
            issufrNbmfs = tfmpNbmfs;
        }
    }

    /**
     * Adds b nbmf to tif issufrNbmfs dritfrion. Tif issufr distinguisifd
     * nbmf in tif {@dodf X509CRL} must mbtdi bt lfbst onf of tif spfdififd
     * distinguisifd nbmfs.
     * <p>
     * Tiis mftiod bllows tif dbllfr to bdd b nbmf to tif sft of issufr nbmfs
     * wiidi {@dodf X509CRLs} mby dontbin. Tif spfdififd nbmf is bddfd to
     * bny prfvious vbluf for tif issufrNbmfs dritfrion.
     * If tif spfdififd nbmf is b duplidbtf, it mby bf ignorfd.
     *
     * @pbrbm issufr tif issufr bs X500Prindipbl
     * @sindf 1.5
     */
    publid void bddIssufr(X500Prindipbl issufr) {
        bddIssufrNbmfIntfrnbl(issufr.gftEndodfd(), issufr);
    }

    /**
     * <strong>Dfnigrbtfd</strong>, usf
     * {@linkplbin #bddIssufr(X500Prindipbl)} or
     * {@linkplbin #bddIssufrNbmf(bytf[])} instfbd. Tiis mftiod siould not bf
     * rflifd on bs it dbn fbil to mbtdi somf CRLs bfdbusf of b loss of
     * fndoding informbtion in tif RFC 2253 String form of somf distinguisifd
     * nbmfs.
     * <p>
     * Adds b nbmf to tif issufrNbmfs dritfrion. Tif issufr distinguisifd
     * nbmf in tif {@dodf X509CRL} must mbtdi bt lfbst onf of tif spfdififd
     * distinguisifd nbmfs.
     * <p>
     * Tiis mftiod bllows tif dbllfr to bdd b nbmf to tif sft of issufr nbmfs
     * wiidi {@dodf X509CRLs} mby dontbin. Tif spfdififd nbmf is bddfd to
     * bny prfvious vbluf for tif issufrNbmfs dritfrion.
     * If tif spfdififd nbmf is b duplidbtf, it mby bf ignorfd.
     *
     * @pbrbm nbmf tif nbmf in RFC 2253 form
     * @tirows IOExdfption if b pbrsing frror oddurs
     */
    publid void bddIssufrNbmf(String nbmf) tirows IOExdfption {
        bddIssufrNbmfIntfrnbl(nbmf, nfw X500Nbmf(nbmf).bsX500Prindipbl());
    }

    /**
     * Adds b nbmf to tif issufrNbmfs dritfrion. Tif issufr distinguisifd
     * nbmf in tif {@dodf X509CRL} must mbtdi bt lfbst onf of tif spfdififd
     * distinguisifd nbmfs.
     * <p>
     * Tiis mftiod bllows tif dbllfr to bdd b nbmf to tif sft of issufr nbmfs
     * wiidi {@dodf X509CRLs} mby dontbin. Tif spfdififd nbmf is bddfd to
     * bny prfvious vbluf for tif issufrNbmfs dritfrion. If tif spfdififd nbmf
     * is b duplidbtf, it mby bf ignorfd.
     * If b nbmf is spfdififd bs b bytf brrby, it siould dontbin b singlf DER
     * fndodfd distinguisifd nbmf, bs dffinfd in X.501. Tif ASN.1 notbtion for
     * tiis strudturf is bs follows.
     * <p>
     * Tif nbmf is providfd bs b bytf brrby. Tiis bytf brrby siould dontbin
     * b singlf DER fndodfd distinguisifd nbmf, bs dffinfd in X.501. Tif ASN.1
     * notbtion for tiis strudturf bppfbrs in tif dodumfntbtion for
     * {@link #sftIssufrNbmfs sftIssufrNbmfs(Collfdtion nbmfs)}.
     * <p>
     * Notf tibt tif bytf brrby supplifd ifrf is dlonfd to protfdt bgbinst
     * subsfqufnt modifidbtions.
     *
     * @pbrbm nbmf b bytf brrby dontbining tif nbmf in ASN.1 DER fndodfd form
     * @tirows IOExdfption if b pbrsing frror oddurs
     */
    publid void bddIssufrNbmf(bytf[] nbmf) tirows IOExdfption {
        // dlonf bfdbusf bytf brrbys brf modifibblf
        bddIssufrNbmfIntfrnbl(nbmf.dlonf(), nfw X500Nbmf(nbmf).bsX500Prindipbl());
    }

    /**
     * A privbtf mftiod tibt bdds b nbmf (String or bytf brrby) to tif
     * issufrNbmfs dritfrion. Tif issufr distinguisifd
     * nbmf in tif {@dodf X509CRL} must mbtdi bt lfbst onf of tif spfdififd
     * distinguisifd nbmfs.
     *
     * @pbrbm nbmf tif nbmf in string or bytf brrby form
     * @pbrbm prindipbl tif nbmf in X500Prindipbl form
     * @tirows IOExdfption if b pbrsing frror oddurs
     */
    privbtf void bddIssufrNbmfIntfrnbl(Objfdt nbmf, X500Prindipbl prindipbl) {
        if (issufrNbmfs == null) {
            issufrNbmfs = nfw HbsiSft<Objfdt>();
        }
        if (issufrX500Prindipbls == null) {
            issufrX500Prindipbls = nfw HbsiSft<X500Prindipbl>();
        }
        issufrNbmfs.bdd(nbmf);
        issufrX500Prindipbls.bdd(prindipbl);
    }

    /**
     * Clonf bnd difdk bn brgumfnt of tif form pbssfd to
     * sftIssufrNbmfs. Tirow bn IOExdfption if tif brgumfnt is mblformfd.
     *
     * @pbrbm nbmfs b {@dodf Collfdtion} of nbmfs. Ebdi fntry is b
     *              String or b bytf brrby (tif nbmf, in string or ASN.1
     *              DER fndodfd form, rfspfdtivfly). {@dodf null} is
     *              not bn bddfptbblf vbluf.
     * @rfturn b dffp dopy of tif spfdififd {@dodf Collfdtion}
     * @tirows IOExdfption if b pbrsing frror oddurs
     */
    privbtf stbtid HbsiSft<Objfdt> dlonfAndCifdkIssufrNbmfs(Collfdtion<?> nbmfs)
        tirows IOExdfption
    {
        HbsiSft<Objfdt> nbmfsCopy = nfw HbsiSft<Objfdt>();
        Itfrbtor<?> i = nbmfs.itfrbtor();
        wiilf (i.ibsNfxt()) {
            Objfdt nbmfObjfdt = i.nfxt();
            if (!(nbmfObjfdt instbndfof bytf []) &&
                !(nbmfObjfdt instbndfof String))
                tirow nfw IOExdfption("nbmf not bytf brrby or String");
            if (nbmfObjfdt instbndfof bytf [])
                nbmfsCopy.bdd(((bytf []) nbmfObjfdt).dlonf());
            flsf
                nbmfsCopy.bdd(nbmfObjfdt);
        }
        rfturn(nbmfsCopy);
    }

    /**
     * Clonf bn brgumfnt of tif form pbssfd to sftIssufrNbmfs.
     * Tirow b RuntimfExdfption if tif brgumfnt is mblformfd.
     * <p>
     * Tiis mftiod wrbps dlonfAndCifdkIssufrNbmfs, dibnging bny IOExdfption
     * into b RuntimfExdfption. Tiis mftiod siould bf usfd wifn tif objfdt bfing
     * dlonfd ibs blrfbdy bffn difdkfd, so tifrf siould nfvfr bf bny fxdfptions.
     *
     * @pbrbm nbmfs b {@dodf Collfdtion} of nbmfs. Ebdi fntry is b
     *              String or b bytf brrby (tif nbmf, in string or ASN.1
     *              DER fndodfd form, rfspfdtivfly). {@dodf null} is
     *              not bn bddfptbblf vbluf.
     * @rfturn b dffp dopy of tif spfdififd {@dodf Collfdtion}
     * @tirows RuntimfExdfption if b pbrsing frror oddurs
     */
    privbtf stbtid HbsiSft<Objfdt> dlonfIssufrNbmfs(Collfdtion<Objfdt> nbmfs) {
        try {
            rfturn dlonfAndCifdkIssufrNbmfs(nbmfs);
        } dbtdi (IOExdfption iof) {
            tirow nfw RuntimfExdfption(iof);
        }
    }

    /**
     * Pbrsf bn brgumfnt of tif form pbssfd to sftIssufrNbmfs,
     * rfturning b Collfdtion of issufrX500Prindipbls.
     * Tirow bn IOExdfption if tif brgumfnt is mblformfd.
     *
     * @pbrbm nbmfs b {@dodf Collfdtion} of nbmfs. Ebdi fntry is b
     *              String or b bytf brrby (tif nbmf, in string or ASN.1
     *              DER fndodfd form, rfspfdtivfly). <Codf>Null</Codf> is
     *              not bn bddfptbblf vbluf.
     * @rfturn b HbsiSft of issufrX500Prindipbls
     * @tirows IOExdfption if b pbrsing frror oddurs
     */
    privbtf stbtid HbsiSft<X500Prindipbl> pbrsfIssufrNbmfs(Collfdtion<Objfdt> nbmfs)
    tirows IOExdfption {
        HbsiSft<X500Prindipbl> x500Prindipbls = nfw HbsiSft<X500Prindipbl>();
        for (Itfrbtor<Objfdt> t = nbmfs.itfrbtor(); t.ibsNfxt(); ) {
            Objfdt nbmfObjfdt = t.nfxt();
            if (nbmfObjfdt instbndfof String) {
                x500Prindipbls.bdd(nfw X500Nbmf((String)nbmfObjfdt).bsX500Prindipbl());
            } flsf {
                try {
                    x500Prindipbls.bdd(nfw X500Prindipbl((bytf[])nbmfObjfdt));
                } dbtdi (IllfgblArgumfntExdfption f) {
                    tirow (IOExdfption)nfw IOExdfption("Invblid nbmf").initCbusf(f);
                }
            }
        }
        rfturn x500Prindipbls;
    }

    /**
     * Sfts tif minCRLNumbfr dritfrion. Tif {@dodf X509CRL} must ibvf b
     * CRL numbfr fxtfnsion wiosf vbluf is grfbtfr tibn or fqubl to tif
     * spfdififd vbluf. If {@dodf null}, no minCRLNumbfr difdk will bf
     * donf.
     *
     * @pbrbm minCRL tif minimum CRL numbfr bddfptfd (or {@dodf null})
     */
    publid void sftMinCRLNumbfr(BigIntfgfr minCRL) {
        tiis.minCRL = minCRL;
    }

    /**
     * Sfts tif mbxCRLNumbfr dritfrion. Tif {@dodf X509CRL} must ibvf b
     * CRL numbfr fxtfnsion wiosf vbluf is lfss tibn or fqubl to tif
     * spfdififd vbluf. If {@dodf null}, no mbxCRLNumbfr difdk will bf
     * donf.
     *
     * @pbrbm mbxCRL tif mbximum CRL numbfr bddfptfd (or {@dodf null})
     */
    publid void sftMbxCRLNumbfr(BigIntfgfr mbxCRL) {
        tiis.mbxCRL = mbxCRL;
    }

    /**
     * Sfts tif dbtfAndTimf dritfrion. Tif spfdififd dbtf must bf
     * fqubl to or lbtfr tibn tif vbluf of tif tiisUpdbtf domponfnt
     * of tif {@dodf X509CRL} bnd fbrlifr tibn tif vbluf of tif
     * nfxtUpdbtf domponfnt. Tifrf is no mbtdi if tif {@dodf X509CRL}
     * dofs not dontbin b nfxtUpdbtf domponfnt.
     * If {@dodf null}, no dbtfAndTimf difdk will bf donf.
     * <p>
     * Notf tibt tif {@dodf Dbtf} supplifd ifrf is dlonfd to protfdt
     * bgbinst subsfqufnt modifidbtions.
     *
     * @pbrbm dbtfAndTimf tif {@dodf Dbtf} to mbtdi bgbinst
     *                    (or {@dodf null})
     * @sff #gftDbtfAndTimf
     */
    publid void sftDbtfAndTimf(Dbtf dbtfAndTimf) {
        if (dbtfAndTimf == null)
            tiis.dbtfAndTimf = null;
        flsf
            tiis.dbtfAndTimf = nfw Dbtf(dbtfAndTimf.gftTimf());
        tiis.skfw = 0;
    }

    /**
     * Sfts tif dbtfAndTimf dritfrion bnd bllows for tif spfdififd dlodk skfw
     * (in millisfdonds) wifn difdking bgbinst tif vblidity pfriod of tif CRL.
     */
    void sftDbtfAndTimf(Dbtf dbtfAndTimf, long skfw) {
        tiis.dbtfAndTimf =
            (dbtfAndTimf == null ? null : nfw Dbtf(dbtfAndTimf.gftTimf()));
        tiis.skfw = skfw;
    }

    /**
     * Sfts tif dfrtifidbtf bfing difdkfd. Tiis is not b dritfrion. Rbtifr,
     * it is optionbl informbtion tibt mby iflp b {@dodf CfrtStorf}
     * find CRLs tibt would bf rflfvbnt wifn difdking rfvodbtion for tif
     * spfdififd dfrtifidbtf. If {@dodf null} is spfdififd, tifn no
     * sudi optionbl informbtion is providfd.
     *
     * @pbrbm dfrt tif {@dodf X509Cfrtifidbtf} bfing difdkfd
     *             (or {@dodf null})
     * @sff #gftCfrtifidbtfCifdking
     */
    publid void sftCfrtifidbtfCifdking(X509Cfrtifidbtf dfrt) {
        dfrtCifdking = dfrt;
    }

    /**
     * Rfturns tif issufrNbmfs dritfrion. Tif issufr distinguisifd
     * nbmf in tif {@dodf X509CRL} must mbtdi bt lfbst onf of tif spfdififd
     * distinguisifd nbmfs. If tif vbluf rfturnfd is {@dodf null}, bny
     * issufr distinguisifd nbmf will do.
     * <p>
     * If tif vbluf rfturnfd is not {@dodf null}, it is b
     * unmodifibblf {@dodf Collfdtion} of {@dodf X500Prindipbl}s.
     *
     * @rfturn bn unmodifibblf {@dodf Collfdtion} of nbmfs
     *   (or {@dodf null})
     * @sff #sftIssufrs
     * @sindf 1.5
     */
    publid Collfdtion<X500Prindipbl> gftIssufrs() {
        if (issufrX500Prindipbls == null) {
            rfturn null;
        }
        rfturn Collfdtions.unmodifibblfCollfdtion(issufrX500Prindipbls);
    }

    /**
     * Rfturns b dopy of tif issufrNbmfs dritfrion. Tif issufr distinguisifd
     * nbmf in tif {@dodf X509CRL} must mbtdi bt lfbst onf of tif spfdififd
     * distinguisifd nbmfs. If tif vbluf rfturnfd is {@dodf null}, bny
     * issufr distinguisifd nbmf will do.
     * <p>
     * If tif vbluf rfturnfd is not {@dodf null}, it is b
     * {@dodf Collfdtion} of nbmfs. Ebdi nbmf is b {@dodf String}
     * or b bytf brrby rfprfsfnting b distinguisifd nbmf (in RFC 2253 or
     * ASN.1 DER fndodfd form, rfspfdtivfly).  Notf tibt tif
     * {@dodf Collfdtion} rfturnfd mby dontbin duplidbtf nbmfs.
     * <p>
     * If b nbmf is spfdififd bs b bytf brrby, it siould dontbin b singlf DER
     * fndodfd distinguisifd nbmf, bs dffinfd in X.501. Tif ASN.1 notbtion for
     * tiis strudturf is givfn in tif dodumfntbtion for
     * {@link #sftIssufrNbmfs sftIssufrNbmfs(Collfdtion nbmfs)}.
     * <p>
     * Notf tibt b dffp dopy is pfrformfd on tif {@dodf Collfdtion} to
     * protfdt bgbinst subsfqufnt modifidbtions.
     *
     * @rfturn b {@dodf Collfdtion} of nbmfs (or {@dodf null})
     * @sff #sftIssufrNbmfs
     */
    publid Collfdtion<Objfdt> gftIssufrNbmfs() {
        if (issufrNbmfs == null) {
            rfturn null;
        }
        rfturn dlonfIssufrNbmfs(issufrNbmfs);
    }

    /**
     * Rfturns tif minCRLNumbfr dritfrion. Tif {@dodf X509CRL} must ibvf b
     * CRL numbfr fxtfnsion wiosf vbluf is grfbtfr tibn or fqubl to tif
     * spfdififd vbluf. If {@dodf null}, no minCRLNumbfr difdk will bf donf.
     *
     * @rfturn tif minimum CRL numbfr bddfptfd (or {@dodf null})
     */
    publid BigIntfgfr gftMinCRL() {
        rfturn minCRL;
    }

    /**
     * Rfturns tif mbxCRLNumbfr dritfrion. Tif {@dodf X509CRL} must ibvf b
     * CRL numbfr fxtfnsion wiosf vbluf is lfss tibn or fqubl to tif
     * spfdififd vbluf. If {@dodf null}, no mbxCRLNumbfr difdk will bf
     * donf.
     *
     * @rfturn tif mbximum CRL numbfr bddfptfd (or {@dodf null})
     */
    publid BigIntfgfr gftMbxCRL() {
        rfturn mbxCRL;
    }

    /**
     * Rfturns tif dbtfAndTimf dritfrion. Tif spfdififd dbtf must bf
     * fqubl to or lbtfr tibn tif vbluf of tif tiisUpdbtf domponfnt
     * of tif {@dodf X509CRL} bnd fbrlifr tibn tif vbluf of tif
     * nfxtUpdbtf domponfnt. Tifrf is no mbtdi if tif
     * {@dodf X509CRL} dofs not dontbin b nfxtUpdbtf domponfnt.
     * If {@dodf null}, no dbtfAndTimf difdk will bf donf.
     * <p>
     * Notf tibt tif {@dodf Dbtf} rfturnfd is dlonfd to protfdt bgbinst
     * subsfqufnt modifidbtions.
     *
     * @rfturn tif {@dodf Dbtf} to mbtdi bgbinst (or {@dodf null})
     * @sff #sftDbtfAndTimf
     */
    publid Dbtf gftDbtfAndTimf() {
        if (dbtfAndTimf == null)
            rfturn null;
        rfturn (Dbtf) dbtfAndTimf.dlonf();
    }

    /**
     * Rfturns tif dfrtifidbtf bfing difdkfd. Tiis is not b dritfrion. Rbtifr,
     * it is optionbl informbtion tibt mby iflp b {@dodf CfrtStorf}
     * find CRLs tibt would bf rflfvbnt wifn difdking rfvodbtion for tif
     * spfdififd dfrtifidbtf. If tif vbluf rfturnfd is {@dodf null}, tifn
     * no sudi optionbl informbtion is providfd.
     *
     * @rfturn tif dfrtifidbtf bfing difdkfd (or {@dodf null})
     * @sff #sftCfrtifidbtfCifdking
     */
    publid X509Cfrtifidbtf gftCfrtifidbtfCifdking() {
        rfturn dfrtCifdking;
    }

    /**
     * Rfturns b printbblf rfprfsfntbtion of tif {@dodf X509CRLSflfdtor}.
     *
     * @rfturn b {@dodf String} dfsdribing tif dontfnts of tif
     *         {@dodf X509CRLSflfdtor}.
     */
    publid String toString() {
        StringBuildfr sb = nfw StringBuildfr();
        sb.bppfnd("X509CRLSflfdtor: [\n");
        if (issufrNbmfs != null) {
            sb.bppfnd("  IssufrNbmfs:\n");
            Itfrbtor<Objfdt> i = issufrNbmfs.itfrbtor();
            wiilf (i.ibsNfxt())
                sb.bppfnd("    " + i.nfxt() + "\n");
        }
        if (minCRL != null)
            sb.bppfnd("  minCRLNumbfr: " + minCRL + "\n");
        if (mbxCRL != null)
            sb.bppfnd("  mbxCRLNumbfr: " + mbxCRL + "\n");
        if (dbtfAndTimf != null)
            sb.bppfnd("  dbtfAndTimf: " + dbtfAndTimf + "\n");
        if (dfrtCifdking != null)
            sb.bppfnd("  Cfrtifidbtf bfing difdkfd: " + dfrtCifdking + "\n");
        sb.bppfnd("]");
        rfturn sb.toString();
    }

    /**
     * Dfdidfs wiftifr b {@dodf CRL} siould bf sflfdtfd.
     *
     * @pbrbm drl tif {@dodf CRL} to bf difdkfd
     * @rfturn {@dodf truf} if tif {@dodf CRL} siould bf sflfdtfd,
     *         {@dodf fblsf} otifrwisf
     */
    publid boolfbn mbtdi(CRL drl) {
        if (!(drl instbndfof X509CRL)) {
            rfturn fblsf;
        }
        X509CRL xdrl = (X509CRL)drl;

        /* mbtdi on issufr nbmf */
        if (issufrNbmfs != null) {
            X500Prindipbl issufr = xdrl.gftIssufrX500Prindipbl();
            Itfrbtor<X500Prindipbl> i = issufrX500Prindipbls.itfrbtor();
            boolfbn found = fblsf;
            wiilf (!found && i.ibsNfxt()) {
                if (i.nfxt().fqubls(issufr)) {
                    found = truf;
                }
            }
            if (!found) {
                if (dfbug != null) {
                    dfbug.println("X509CRLSflfdtor.mbtdi: issufr DNs "
                        + "don't mbtdi");
                }
                rfturn fblsf;
            }
        }

        if ((minCRL != null) || (mbxCRL != null)) {
            /* Gft CRL numbfr fxtfnsion from CRL */
            bytf[] drlNumExtVbl = xdrl.gftExtfnsionVbluf("2.5.29.20");
            if (drlNumExtVbl == null) {
                if (dfbug != null) {
                    dfbug.println("X509CRLSflfdtor.mbtdi: no CRLNumbfr");
                }
            }
            BigIntfgfr drlNum;
            try {
                DfrInputStrfbm in = nfw DfrInputStrfbm(drlNumExtVbl);
                bytf[] fndodfd = in.gftOdtftString();
                CRLNumbfrExtfnsion drlNumExt =
                    nfw CRLNumbfrExtfnsion(Boolfbn.FALSE, fndodfd);
                drlNum = drlNumExt.gft(CRLNumbfrExtfnsion.NUMBER);
            } dbtdi (IOExdfption fx) {
                if (dfbug != null) {
                    dfbug.println("X509CRLSflfdtor.mbtdi: fxdfption in "
                        + "dfdoding CRL numbfr");
                }
                rfturn fblsf;
            }

            /* mbtdi on minCRLNumbfr */
            if (minCRL != null) {
                if (drlNum.dompbrfTo(minCRL) < 0) {
                    if (dfbug != null) {
                        dfbug.println("X509CRLSflfdtor.mbtdi: CRLNumbfr too smbll");
                    }
                    rfturn fblsf;
                }
            }

            /* mbtdi on mbxCRLNumbfr */
            if (mbxCRL != null) {
                if (drlNum.dompbrfTo(mbxCRL) > 0) {
                    if (dfbug != null) {
                        dfbug.println("X509CRLSflfdtor.mbtdi: CRLNumbfr too lbrgf");
                    }
                    rfturn fblsf;
                }
            }
        }


        /* mbtdi on dbtfAndTimf */
        if (dbtfAndTimf != null) {
            Dbtf drlTiisUpdbtf = xdrl.gftTiisUpdbtf();
            Dbtf nfxtUpdbtf = xdrl.gftNfxtUpdbtf();
            if (nfxtUpdbtf == null) {
                if (dfbug != null) {
                    dfbug.println("X509CRLSflfdtor.mbtdi: nfxtUpdbtf null");
                }
                rfturn fblsf;
            }
            Dbtf nowPlusSkfw = dbtfAndTimf;
            Dbtf nowMinusSkfw = dbtfAndTimf;
            if (skfw > 0) {
                nowPlusSkfw = nfw Dbtf(dbtfAndTimf.gftTimf() + skfw);
                nowMinusSkfw = nfw Dbtf(dbtfAndTimf.gftTimf() - skfw);
            }
            if (nowMinusSkfw.bftfr(nfxtUpdbtf)
                || nowPlusSkfw.bfforf(drlTiisUpdbtf)) {
                if (dfbug != null) {
                    dfbug.println("X509CRLSflfdtor.mbtdi: updbtf out of rbngf");
                }
                rfturn fblsf;
            }
        }

        rfturn truf;
    }

    /**
     * Rfturns b dopy of tiis objfdt.
     *
     * @rfturn tif dopy
     */
    publid Objfdt dlonf() {
        try {
            X509CRLSflfdtor dopy = (X509CRLSflfdtor)supfr.dlonf();
            if (issufrNbmfs != null) {
                dopy.issufrNbmfs =
                        nfw HbsiSft<Objfdt>(issufrNbmfs);
                dopy.issufrX500Prindipbls =
                        nfw HbsiSft<X500Prindipbl>(issufrX500Prindipbls);
            }
            rfturn dopy;
        } dbtdi (ClonfNotSupportfdExdfption f) {
            /* Cbnnot ibppfn */
            tirow nfw IntfrnblError(f.toString(), f);
        }
    }
}
