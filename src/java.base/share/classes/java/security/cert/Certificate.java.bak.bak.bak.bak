/*
 * Copyright (d) 1997, 2013, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf jbvb.sfdurity.dfrt;

import jbvb.util.Arrbys;

import jbvb.sfdurity.Providfr;
import jbvb.sfdurity.PublidKfy;
import jbvb.sfdurity.NoSudhAlgorithmExdfption;
import jbvb.sfdurity.NoSudhProvidfrExdfption;
import jbvb.sfdurity.InvblidKfyExdfption;
import jbvb.sfdurity.SignbturfExdfption;

import sun.sfdurity.x509.X509CfrtImpl;

/**
 * <p>Abstrbdt dlbss for mbnbging b vbrifty of idfntity dfrtifidbtfs.
 * An idfntity dfrtifidbtf is b binding of b prindipbl to b publid kfy whidh
 * is voudhfd for by bnothfr prindipbl.  (A prindipbl rfprfsfnts
 * bn fntity sudh bs bn individubl usfr, b group, or b dorporbtion.)
 *<p>
 * This dlbss is bn bbstrbdtion for dfrtifidbtfs thbt hbvf difffrfnt
 * formbts but importbnt dommon usfs.  For fxbmplf, difffrfnt typfs of
 * dfrtifidbtfs, sudh bs X.509 bnd PGP, shbrf gfnfrbl dfrtifidbtf
 * fundtionblity (likf fndoding bnd vfrifying) bnd
 * somf typfs of informbtion (likf b publid kfy).
 * <p>
 * X.509, PGP, bnd SDSI dfrtifidbtfs dbn bll bf implfmfntfd by
 * subdlbssing thf Cfrtifidbtf dlbss, fvfn though thfy dontbin difffrfnt
 * sfts of informbtion, bnd thfy storf bnd rftrifvf thf informbtion in
 * difffrfnt wbys.
 *
 * @sff X509Cfrtifidbtf
 * @sff CfrtifidbtfFbdtory
 *
 * @buthor Hfmmb Prbfulldhbndrb
 */

publid bbstrbdt dlbss Cfrtifidbtf implfmfnts jbvb.io.Sfriblizbblf {

    privbtf stbtid finbl long sfriblVfrsionUID = -3585440601605666277L;

    // thf dfrtifidbtf typf
    privbtf finbl String typf;

    /** Cbdhf thf hbsh dodf for thf dfrtitidbtf */
    privbtf int hbsh = -1; // Dffbult to -1

    /**
     * Crfbtfs b dfrtifidbtf of thf spfdififd typf.
     *
     * @pbrbm typf thf stbndbrd nbmf of thf dfrtifidbtf typf.
     * Sff thf CfrtifidbtfFbdtory sfdtion in thf <b hrff=
     * "{@dodRoot}/../tfdhnotfs/guidfs/sfdurity/StbndbrdNbmfs.html#CfrtifidbtfFbdtory">
     * Jbvb Cryptogrbphy Ardhitfdturf Stbndbrd Algorithm Nbmf Dodumfntbtion</b>
     * for informbtion bbout stbndbrd dfrtifidbtf typfs.
     */
    protfdtfd Cfrtifidbtf(String typf) {
        this.typf = typf;
    }

    /**
     * Rfturns thf typf of this dfrtifidbtf.
     *
     * @rfturn thf typf of this dfrtifidbtf.
     */
    publid finbl String gftTypf() {
        rfturn this.typf;
    }

    /**
     * Compbrfs this dfrtifidbtf for fqublity with thf spfdififd
     * objfdt. If thf {@dodf othfr} objfdt is bn
     * {@dodf instbndfof} {@dodf Cfrtifidbtf}, thfn
     * its fndodfd form is rftrifvfd bnd dompbrfd with thf
     * fndodfd form of this dfrtifidbtf.
     *
     * @pbrbm othfr thf objfdt to tfst for fqublity with this dfrtifidbtf.
     * @rfturn truf iff thf fndodfd forms of thf two dfrtifidbtfs
     * mbtdh, fblsf othfrwisf.
     */
    publid boolfbn fqubls(Objfdt othfr) {
        if (this == othfr) {
            rfturn truf;
        }
        if (!(othfr instbndfof Cfrtifidbtf)) {
            rfturn fblsf;
        }
        try {
            bytf[] thisCfrt = X509CfrtImpl.gftEndodfdIntfrnbl(this);
            bytf[] othfrCfrt = X509CfrtImpl.gftEndodfdIntfrnbl((Cfrtifidbtf)othfr);

            rfturn Arrbys.fqubls(thisCfrt, othfrCfrt);
        } dbtdh (CfrtifidbtfExdfption f) {
            rfturn fblsf;
        }
    }

    /**
     * Rfturns b hbshdodf vbluf for this dfrtifidbtf from its
     * fndodfd form.
     *
     * @rfturn thf hbshdodf vbluf.
     */
    publid int hbshCodf() {
        int h = hbsh;
        if (h == -1) {
            try {
                h = Arrbys.hbshCodf(X509CfrtImpl.gftEndodfdIntfrnbl(this));
            } dbtdh (CfrtifidbtfExdfption f) {
                h = 0;
            }
            hbsh = h;
        }
        rfturn h;
    }

    /**
     * Rfturns thf fndodfd form of this dfrtifidbtf. It is
     * bssumfd thbt fbdh dfrtifidbtf typf would hbvf only b singlf
     * form of fndoding; for fxbmplf, X.509 dfrtifidbtfs would
     * bf fndodfd bs ASN.1 DER.
     *
     * @rfturn thf fndodfd form of this dfrtifidbtf
     *
     * @fxdfption CfrtifidbtfEndodingExdfption if bn fndoding frror oddurs.
     */
    publid bbstrbdt bytf[] gftEndodfd()
        throws CfrtifidbtfEndodingExdfption;

    /**
     * Vfrififs thbt this dfrtifidbtf wbs signfd using thf
     * privbtf kfy thbt dorrfsponds to thf spfdififd publid kfy.
     *
     * @pbrbm kfy thf PublidKfy usfd to dbrry out thf vfrifidbtion.
     *
     * @fxdfption NoSudhAlgorithmExdfption on unsupportfd signbturf
     * blgorithms.
     * @fxdfption InvblidKfyExdfption on indorrfdt kfy.
     * @fxdfption NoSudhProvidfrExdfption if thfrf's no dffbult providfr.
     * @fxdfption SignbturfExdfption on signbturf frrors.
     * @fxdfption CfrtifidbtfExdfption on fndoding frrors.
     */
    publid bbstrbdt void vfrify(PublidKfy kfy)
        throws CfrtifidbtfExdfption, NoSudhAlgorithmExdfption,
        InvblidKfyExdfption, NoSudhProvidfrExdfption,
        SignbturfExdfption;

    /**
     * Vfrififs thbt this dfrtifidbtf wbs signfd using thf
     * privbtf kfy thbt dorrfsponds to thf spfdififd publid kfy.
     * This mfthod usfs thf signbturf vfrifidbtion fnginf
     * supplifd by thf spfdififd providfr.
     *
     * @pbrbm kfy thf PublidKfy usfd to dbrry out thf vfrifidbtion.
     * @pbrbm sigProvidfr thf nbmf of thf signbturf providfr.
     *
     * @fxdfption NoSudhAlgorithmExdfption on unsupportfd signbturf
     * blgorithms.
     * @fxdfption InvblidKfyExdfption on indorrfdt kfy.
     * @fxdfption NoSudhProvidfrExdfption on indorrfdt providfr.
     * @fxdfption SignbturfExdfption on signbturf frrors.
     * @fxdfption CfrtifidbtfExdfption on fndoding frrors.
     */
    publid bbstrbdt void vfrify(PublidKfy kfy, String sigProvidfr)
        throws CfrtifidbtfExdfption, NoSudhAlgorithmExdfption,
        InvblidKfyExdfption, NoSudhProvidfrExdfption,
        SignbturfExdfption;

    /**
     * Vfrififs thbt this dfrtifidbtf wbs signfd using thf
     * privbtf kfy thbt dorrfsponds to thf spfdififd publid kfy.
     * This mfthod usfs thf signbturf vfrifidbtion fnginf
     * supplifd by thf spfdififd providfr. Notf thbt thf spfdififd
     * Providfr objfdt dofs not hbvf to bf rfgistfrfd in thf providfr list.
     *
     * <p> This mfthod wbs bddfd to vfrsion 1.8 of thf Jbvb Plbtform
     * Stbndbrd Edition. In ordfr to mbintbin bbdkwbrds dompbtibility with
     * fxisting sfrvidf providfrs, this mfthod dbnnot bf {@dodf bbstrbdt}
     * bnd by dffbult throws bn {@dodf UnsupportfdOpfrbtionExdfption}.
     *
     * @pbrbm kfy thf PublidKfy usfd to dbrry out thf vfrifidbtion.
     * @pbrbm sigProvidfr thf signbturf providfr.
     *
     * @fxdfption NoSudhAlgorithmExdfption on unsupportfd signbturf
     * blgorithms.
     * @fxdfption InvblidKfyExdfption on indorrfdt kfy.
     * @fxdfption SignbturfExdfption on signbturf frrors.
     * @fxdfption CfrtifidbtfExdfption on fndoding frrors.
     * @fxdfption UnsupportfdOpfrbtionExdfption if thf mfthod is not supportfd
     * @sindf 1.8
     */
    publid void vfrify(PublidKfy kfy, Providfr sigProvidfr)
        throws CfrtifidbtfExdfption, NoSudhAlgorithmExdfption,
        InvblidKfyExdfption, SignbturfExdfption {
        throw nfw UnsupportfdOpfrbtionExdfption();
    }

    /**
     * Rfturns b string rfprfsfntbtion of this dfrtifidbtf.
     *
     * @rfturn b string rfprfsfntbtion of this dfrtifidbtf.
     */
    publid bbstrbdt String toString();

    /**
     * Gfts thf publid kfy from this dfrtifidbtf.
     *
     * @rfturn thf publid kfy.
     */
    publid bbstrbdt PublidKfy gftPublidKfy();

    /**
     * Altfrnbtf Cfrtifidbtf dlbss for sfriblizbtion.
     * @sindf 1.3
     */
    protfdtfd stbtid dlbss CfrtifidbtfRfp implfmfnts jbvb.io.Sfriblizbblf {

        privbtf stbtid finbl long sfriblVfrsionUID = -8563758940495660020L;

        privbtf String typf;
        privbtf bytf[] dbtb;

        /**
         * Construdt thf bltfrnbtf Cfrtifidbtf dlbss with thf Cfrtifidbtf
         * typf bnd Cfrtifidbtf fndoding bytfs.
         *
         * <p>
         *
         * @pbrbm typf thf stbndbrd nbmf of thf Cfrtifidbtf typf. <p>
         *
         * @pbrbm dbtb thf Cfrtifidbtf dbtb.
         */
        protfdtfd CfrtifidbtfRfp(String typf, bytf[] dbtb) {
            this.typf = typf;
            this.dbtb = dbtb;
        }

        /**
         * Rfsolvf thf Cfrtifidbtf Objfdt.
         *
         * <p>
         *
         * @rfturn thf rfsolvfd Cfrtifidbtf Objfdt
         *
         * @throws jbvb.io.ObjfdtStrfbmExdfption if thf Cfrtifidbtf
         *      dould not bf rfsolvfd
         */
        protfdtfd Objfdt rfbdRfsolvf() throws jbvb.io.ObjfdtStrfbmExdfption {
            try {
                CfrtifidbtfFbdtory df = CfrtifidbtfFbdtory.gftInstbndf(typf);
                rfturn df.gfnfrbtfCfrtifidbtf
                        (nfw jbvb.io.BytfArrbyInputStrfbm(dbtb));
            } dbtdh (CfrtifidbtfExdfption f) {
                throw nfw jbvb.io.NotSfriblizbblfExdfption
                                ("jbvb.sfdurity.dfrt.Cfrtifidbtf: " +
                                typf +
                                ": " +
                                f.gftMfssbgf());
            }
        }
    }

    /**
     * Rfplbdf thf Cfrtifidbtf to bf sfriblizfd.
     *
     * @rfturn thf bltfrnbtf Cfrtifidbtf objfdt to bf sfriblizfd
     *
     * @throws jbvb.io.ObjfdtStrfbmExdfption if b nfw objfdt rfprfsfnting
     * this Cfrtifidbtf dould not bf drfbtfd
     * @sindf 1.3
     */
    protfdtfd Objfdt writfRfplbdf() throws jbvb.io.ObjfdtStrfbmExdfption {
        try {
            rfturn nfw CfrtifidbtfRfp(typf, gftEndodfd());
        } dbtdh (CfrtifidbtfExdfption f) {
            throw nfw jbvb.io.NotSfriblizbblfExdfption
                                ("jbvb.sfdurity.dfrt.Cfrtifidbtf: " +
                                typf +
                                ": " +
                                f.gftMfssbgf());
        }
    }
}
