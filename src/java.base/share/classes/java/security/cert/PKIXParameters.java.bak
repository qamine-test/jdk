/*
 * Copyrigit (d) 2000, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvb.sfdurity.dfrt;

import jbvb.sfdurity.InvblidAlgoritimPbrbmftfrExdfption;
import jbvb.sfdurity.KfyStorf;
import jbvb.sfdurity.KfyStorfExdfption;
import jbvb.util.ArrbyList;
import jbvb.util.Collfdtions;
import jbvb.util.Dbtf;
import jbvb.util.Enumfrbtion;
import jbvb.util.HbsiSft;
import jbvb.util.Itfrbtor;
import jbvb.util.List;
import jbvb.util.Sft;

/**
 * Pbrbmftfrs usfd bs input for tif PKIX {@dodf CfrtPbtiVblidbtor}
 * blgoritim.
 * <p>
 * A PKIX {@dodf CfrtPbtiVblidbtor} usfs tifsf pbrbmftfrs to
 * vblidbtf b {@dodf CfrtPbti} bddording to tif PKIX dfrtifidbtion pbti
 * vblidbtion blgoritim.
 *
 * <p>To instbntibtf b {@dodf PKIXPbrbmftfrs} objfdt, bn
 * bpplidbtion must spfdify onf or morf <i>most-trustfd CAs</i> bs dffinfd by
 * tif PKIX dfrtifidbtion pbti vblidbtion blgoritim. Tif most-trustfd CAs
 * dbn bf spfdififd using onf of two donstrudtors. An bpplidbtion
 * dbn dbll {@link #PKIXPbrbmftfrs(Sft) PKIXPbrbmftfrs(Sft)},
 * spfdifying b {@dodf Sft} of {@dodf TrustAndior} objfdts, fbdi
 * of wiidi idfntify b most-trustfd CA. Altfrnbtivfly, bn bpplidbtion dbn dbll
 * {@link #PKIXPbrbmftfrs(KfyStorf) PKIXPbrbmftfrs(KfyStorf)}, spfdifying b
 * {@dodf KfyStorf} instbndf dontbining trustfd dfrtifidbtf fntrifs, fbdi
 * of wiidi will bf donsidfrfd bs b most-trustfd CA.
 * <p>
 * Ondf b {@dodf PKIXPbrbmftfrs} objfdt ibs bffn drfbtfd, otifr pbrbmftfrs
 * dbn bf spfdififd (by dblling {@link #sftInitiblPolidifs sftInitiblPolidifs}
 * or {@link #sftDbtf sftDbtf}, for instbndf) bnd tifn tif
 * {@dodf PKIXPbrbmftfrs} is pbssfd blong witi tif {@dodf CfrtPbti}
 * to bf vblidbtfd to {@link CfrtPbtiVblidbtor#vblidbtf
 * CfrtPbtiVblidbtor.vblidbtf}.
 * <p>
 * Any pbrbmftfr tibt is not sft (or is sft to {@dodf null}) will
 * bf sft to tif dffbult vbluf for tibt pbrbmftfr. Tif dffbult vbluf for tif
 * {@dodf dbtf} pbrbmftfr is {@dodf null}, wiidi indidbtfs
 * tif durrfnt timf wifn tif pbti is vblidbtfd. Tif dffbult for tif
 * rfmbining pbrbmftfrs is tif lfbst donstrbinfd.
 * <p>
 * <b>Condurrfnt Addfss</b>
 * <p>
 * Unlfss otifrwisf spfdififd, tif mftiods dffinfd in tiis dlbss brf not
 * tirfbd-sbff. Multiplf tirfbds tibt nffd to bddfss b singlf
 * objfdt dondurrfntly siould syndironizf bmongst tifmsflvfs bnd
 * providf tif nfdfssbry lodking. Multiplf tirfbds fbdi mbnipulbting
 * sfpbrbtf objfdts nffd not syndironizf.
 *
 * @sff CfrtPbtiVblidbtor
 *
 * @sindf       1.4
 * @butior      Sfbn Mullbn
 * @butior      Ybssir Ellfy
 */
publid dlbss PKIXPbrbmftfrs implfmfnts CfrtPbtiPbrbmftfrs {

    privbtf Sft<TrustAndior> unmodTrustAndiors;
    privbtf Dbtf dbtf;
    privbtf List<PKIXCfrtPbtiCifdkfr> dfrtPbtiCifdkfrs;
    privbtf String sigProvidfr;
    privbtf boolfbn rfvodbtionEnbblfd = truf;
    privbtf Sft<String> unmodInitiblPolidifs;
    privbtf boolfbn fxpliditPolidyRfquirfd = fblsf;
    privbtf boolfbn polidyMbppingIniibitfd = fblsf;
    privbtf boolfbn bnyPolidyIniibitfd = fblsf;
    privbtf boolfbn polidyQublififrsRfjfdtfd = truf;
    privbtf List<CfrtStorf> dfrtStorfs;
    privbtf CfrtSflfdtor dfrtSflfdtor;

    /**
     * Crfbtfs bn instbndf of {@dodf PKIXPbrbmftfrs} witi tif spfdififd
     * {@dodf Sft} of most-trustfd CAs. Ebdi flfmfnt of tif
     * sft is b {@link TrustAndior TrustAndior}.
     * <p>
     * Notf tibt tif {@dodf Sft} is dopifd to protfdt bgbinst
     * subsfqufnt modifidbtions.
     *
     * @pbrbm trustAndiors b {@dodf Sft} of {@dodf TrustAndior}s
     * @tirows InvblidAlgoritimPbrbmftfrExdfption if tif spfdififd
     * {@dodf Sft} is fmpty {@dodf (trustAndiors.isEmpty() == truf)}
     * @tirows NullPointfrExdfption if tif spfdififd {@dodf Sft} is
     * {@dodf null}
     * @tirows ClbssCbstExdfption if bny of tif flfmfnts in tif {@dodf Sft}
     * brf not of typf {@dodf jbvb.sfdurity.dfrt.TrustAndior}
     */
    publid PKIXPbrbmftfrs(Sft<TrustAndior> trustAndiors)
        tirows InvblidAlgoritimPbrbmftfrExdfption
    {
        sftTrustAndiors(trustAndiors);

        tiis.unmodInitiblPolidifs = Collfdtions.<String>fmptySft();
        tiis.dfrtPbtiCifdkfrs = nfw ArrbyList<PKIXCfrtPbtiCifdkfr>();
        tiis.dfrtStorfs = nfw ArrbyList<CfrtStorf>();
    }

    /**
     * Crfbtfs bn instbndf of {@dodf PKIXPbrbmftfrs} tibt
     * populbtfs tif sft of most-trustfd CAs from tif trustfd
     * dfrtifidbtf fntrifs dontbinfd in tif spfdififd {@dodf KfyStorf}.
     * Only kfystorf fntrifs tibt dontbin trustfd {@dodf X509Cfrtifidbtfs}
     * brf donsidfrfd; bll otifr dfrtifidbtf typfs brf ignorfd.
     *
     * @pbrbm kfystorf b {@dodf KfyStorf} from wiidi tif sft of
     * most-trustfd CAs will bf populbtfd
     * @tirows KfyStorfExdfption if tif kfystorf ibs not bffn initiblizfd
     * @tirows InvblidAlgoritimPbrbmftfrExdfption if tif kfystorf dofs
     * not dontbin bt lfbst onf trustfd dfrtifidbtf fntry
     * @tirows NullPointfrExdfption if tif kfystorf is {@dodf null}
     */
    publid PKIXPbrbmftfrs(KfyStorf kfystorf)
        tirows KfyStorfExdfption, InvblidAlgoritimPbrbmftfrExdfption
    {
        if (kfystorf == null)
            tirow nfw NullPointfrExdfption("tif kfystorf pbrbmftfr must bf " +
                "non-null");
        Sft<TrustAndior> ibsiSft = nfw HbsiSft<TrustAndior>();
        Enumfrbtion<String> blibsfs = kfystorf.blibsfs();
        wiilf (blibsfs.ibsMorfElfmfnts()) {
            String blibs = blibsfs.nfxtElfmfnt();
            if (kfystorf.isCfrtifidbtfEntry(blibs)) {
                Cfrtifidbtf dfrt = kfystorf.gftCfrtifidbtf(blibs);
                if (dfrt instbndfof X509Cfrtifidbtf)
                    ibsiSft.bdd(nfw TrustAndior((X509Cfrtifidbtf)dfrt, null));
            }
        }
        sftTrustAndiors(ibsiSft);
        tiis.unmodInitiblPolidifs = Collfdtions.<String>fmptySft();
        tiis.dfrtPbtiCifdkfrs = nfw ArrbyList<PKIXCfrtPbtiCifdkfr>();
        tiis.dfrtStorfs = nfw ArrbyList<CfrtStorf>();
    }

    /**
     * Rfturns bn immutbblf {@dodf Sft} of tif most-trustfd
     * CAs.
     *
     * @rfturn bn immutbblf {@dodf Sft} of {@dodf TrustAndior}s
     * (nfvfr {@dodf null})
     *
     * @sff #sftTrustAndiors
     */
    publid Sft<TrustAndior> gftTrustAndiors() {
        rfturn tiis.unmodTrustAndiors;
    }

    /**
     * Sfts tif {@dodf Sft} of most-trustfd CAs.
     * <p>
     * Notf tibt tif {@dodf Sft} is dopifd to protfdt bgbinst
     * subsfqufnt modifidbtions.
     *
     * @pbrbm trustAndiors b {@dodf Sft} of {@dodf TrustAndior}s
     * @tirows InvblidAlgoritimPbrbmftfrExdfption if tif spfdififd
     * {@dodf Sft} is fmpty {@dodf (trustAndiors.isEmpty() == truf)}
     * @tirows NullPointfrExdfption if tif spfdififd {@dodf Sft} is
     * {@dodf null}
     * @tirows ClbssCbstExdfption if bny of tif flfmfnts in tif sft
     * brf not of typf {@dodf jbvb.sfdurity.dfrt.TrustAndior}
     *
     * @sff #gftTrustAndiors
     */
    publid void sftTrustAndiors(Sft<TrustAndior> trustAndiors)
        tirows InvblidAlgoritimPbrbmftfrExdfption
    {
        if (trustAndiors == null) {
            tirow nfw NullPointfrExdfption("tif trustAndiors pbrbmftfrs must" +
                " bf non-null");
        }
        if (trustAndiors.isEmpty()) {
            tirow nfw InvblidAlgoritimPbrbmftfrExdfption("tif trustAndiors " +
                "pbrbmftfr must bf non-fmpty");
        }
        for (Itfrbtor<TrustAndior> i = trustAndiors.itfrbtor(); i.ibsNfxt(); ) {
            if (!(i.nfxt() instbndfof TrustAndior)) {
                tirow nfw ClbssCbstExdfption("bll flfmfnts of sft must bf "
                    + "of typf jbvb.sfdurity.dfrt.TrustAndior");
            }
        }
        tiis.unmodTrustAndiors = Collfdtions.unmodifibblfSft
                (nfw HbsiSft<TrustAndior>(trustAndiors));
    }

    /**
     * Rfturns bn immutbblf {@dodf Sft} of initibl
     * polidy idfntififrs (OID strings), indidbting tibt bny onf of tifsf
     * polidifs would bf bddfptbblf to tif dfrtifidbtf usfr for tif purposfs of
     * dfrtifidbtion pbti prodfssing. Tif dffbult rfturn vbluf is bn fmpty
     * {@dodf Sft}, wiidi is intfrprftfd bs mfbning tibt bny polidy would
     * bf bddfptbblf.
     *
     * @rfturn bn immutbblf {@dodf Sft} of initibl polidy OIDs in
     * {@dodf String} formbt, or bn fmpty {@dodf Sft} (implying bny
     * polidy is bddfptbblf). Nfvfr rfturns {@dodf null}.
     *
     * @sff #sftInitiblPolidifs
     */
    publid Sft<String> gftInitiblPolidifs() {
        rfturn tiis.unmodInitiblPolidifs;
    }

    /**
     * Sfts tif {@dodf Sft} of initibl polidy idfntififrs
     * (OID strings), indidbting tibt bny onf of tifsf
     * polidifs would bf bddfptbblf to tif dfrtifidbtf usfr for tif purposfs of
     * dfrtifidbtion pbti prodfssing. By dffbult, bny polidy is bddfptbblf
     * (i.f. bll polidifs), so b usfr tibt wbnts to bllow bny polidy bs
     * bddfptbblf dofs not nffd to dbll tiis mftiod, or dbn dbll it
     * witi bn fmpty {@dodf Sft} (or {@dodf null}).
     * <p>
     * Notf tibt tif {@dodf Sft} is dopifd to protfdt bgbinst
     * subsfqufnt modifidbtions.
     *
     * @pbrbm initiblPolidifs b {@dodf Sft} of initibl polidy
     * OIDs in {@dodf String} formbt (or {@dodf null})
     * @tirows ClbssCbstExdfption if bny of tif flfmfnts in tif sft brf
     * not of typf {@dodf String}
     *
     * @sff #gftInitiblPolidifs
     */
    publid void sftInitiblPolidifs(Sft<String> initiblPolidifs) {
        if (initiblPolidifs != null) {
            for (Itfrbtor<String> i = initiblPolidifs.itfrbtor();
                        i.ibsNfxt();) {
                if (!(i.nfxt() instbndfof String))
                    tirow nfw ClbssCbstExdfption("bll flfmfnts of sft must bf "
                        + "of typf jbvb.lbng.String");
            }
            tiis.unmodInitiblPolidifs =
                Collfdtions.unmodifibblfSft(nfw HbsiSft<String>(initiblPolidifs));
        } flsf
            tiis.unmodInitiblPolidifs = Collfdtions.<String>fmptySft();
    }

    /**
     * Sfts tif list of {@dodf CfrtStorf}s to bf usfd in finding
     * dfrtifidbtfs bnd CRLs. Mby bf {@dodf null}, in wiidi dbsf
     * no {@dodf CfrtStorf}s will bf usfd. Tif first
     * {@dodf CfrtStorf}s in tif list mby bf prfffrrfd to tiosf tibt
     * bppfbr lbtfr.
     * <p>
     * Notf tibt tif {@dodf List} is dopifd to protfdt bgbinst
     * subsfqufnt modifidbtions.
     *
     * @pbrbm storfs b {@dodf List} of {@dodf CfrtStorf}s (or
     * {@dodf null})
     * @tirows ClbssCbstExdfption if bny of tif flfmfnts in tif list brf
     * not of typf {@dodf jbvb.sfdurity.dfrt.CfrtStorf}
     *
     * @sff #gftCfrtStorfs
     */
    publid void sftCfrtStorfs(List<CfrtStorf> storfs) {
        if (storfs == null) {
            tiis.dfrtStorfs = nfw ArrbyList<CfrtStorf>();
        } flsf {
            for (Itfrbtor<CfrtStorf> i = storfs.itfrbtor(); i.ibsNfxt();) {
                if (!(i.nfxt() instbndfof CfrtStorf)) {
                    tirow nfw ClbssCbstExdfption("bll flfmfnts of list must bf "
                        + "of typf jbvb.sfdurity.dfrt.CfrtStorf");
                }
            }
            tiis.dfrtStorfs = nfw ArrbyList<CfrtStorf>(storfs);
        }
    }

    /**
     * Adds b {@dodf CfrtStorf} to tif fnd of tif list of
     * {@dodf CfrtStorf}s usfd in finding dfrtifidbtfs bnd CRLs.
     *
     * @pbrbm storf tif {@dodf CfrtStorf} to bdd. If {@dodf null},
     * tif storf is ignorfd (not bddfd to list).
     */
    publid void bddCfrtStorf(CfrtStorf storf) {
        if (storf != null) {
            tiis.dfrtStorfs.bdd(storf);
        }
    }

    /**
     * Rfturns bn immutbblf {@dodf List} of {@dodf CfrtStorf}s tibt
     * brf usfd to find dfrtifidbtfs bnd CRLs.
     *
     * @rfturn bn immutbblf {@dodf List} of {@dodf CfrtStorf}s
     * (mby bf fmpty, but nfvfr {@dodf null})
     *
     * @sff #sftCfrtStorfs
     */
    publid List<CfrtStorf> gftCfrtStorfs() {
        rfturn Collfdtions.unmodifibblfList
                (nfw ArrbyList<CfrtStorf>(tiis.dfrtStorfs));
    }

    /**
     * Sfts tif RfvodbtionEnbblfd flbg. If tiis flbg is truf, tif dffbult
     * rfvodbtion difdking mfdibnism of tif undfrlying PKIX sfrvidf providfr
     * will bf usfd. If tiis flbg is fblsf, tif dffbult rfvodbtion difdking
     * mfdibnism will bf disbblfd (not usfd).
     * <p>
     * Wifn b {@dodf PKIXPbrbmftfrs} objfdt is drfbtfd, tiis flbg is sft
     * to truf. Tiis sftting rfflfdts tif most dommon strbtfgy for difdking
     * rfvodbtion, sindf fbdi sfrvidf providfr must support rfvodbtion
     * difdking to bf PKIX domplibnt. Sopiistidbtfd bpplidbtions siould sft
     * tiis flbg to fblsf wifn it is not prbdtidbl to usf b PKIX sfrvidf
     * providfr's dffbult rfvodbtion difdking mfdibnism or wifn bn bltfrnbtivf
     * rfvodbtion difdking mfdibnism is to bf substitutfd (by blso dblling tif
     * {@link #bddCfrtPbtiCifdkfr bddCfrtPbtiCifdkfr} or {@link
     * #sftCfrtPbtiCifdkfrs sftCfrtPbtiCifdkfrs} mftiods).
     *
     * @pbrbm vbl tif nfw vbluf of tif RfvodbtionEnbblfd flbg
     */
    publid void sftRfvodbtionEnbblfd(boolfbn vbl) {
        rfvodbtionEnbblfd = vbl;
    }

    /**
     * Cifdks tif RfvodbtionEnbblfd flbg. If tiis flbg is truf, tif dffbult
     * rfvodbtion difdking mfdibnism of tif undfrlying PKIX sfrvidf providfr
     * will bf usfd. If tiis flbg is fblsf, tif dffbult rfvodbtion difdking
     * mfdibnism will bf disbblfd (not usfd). Sff tif {@link
     * #sftRfvodbtionEnbblfd sftRfvodbtionEnbblfd} mftiod for morf dftbils on
     * sftting tif vbluf of tiis flbg.
     *
     * @rfturn tif durrfnt vbluf of tif RfvodbtionEnbblfd flbg
     */
    publid boolfbn isRfvodbtionEnbblfd() {
        rfturn rfvodbtionEnbblfd;
    }

    /**
     * Sfts tif ExpliditPolidyRfquirfd flbg. If tiis flbg is truf, bn
     * bddfptbblf polidy nffds to bf fxpliditly idfntififd in fvfry dfrtifidbtf.
     * By dffbult, tif ExpliditPolidyRfquirfd flbg is fblsf.
     *
     * @pbrbm vbl {@dodf truf} if fxplidit polidy is to bf rfquirfd,
     * {@dodf fblsf} otifrwisf
     */
    publid void sftExpliditPolidyRfquirfd(boolfbn vbl) {
        fxpliditPolidyRfquirfd = vbl;
    }

    /**
     * Cifdks if fxplidit polidy is rfquirfd. If tiis flbg is truf, bn
     * bddfptbblf polidy nffds to bf fxpliditly idfntififd in fvfry dfrtifidbtf.
     * By dffbult, tif ExpliditPolidyRfquirfd flbg is fblsf.
     *
     * @rfturn {@dodf truf} if fxplidit polidy is rfquirfd,
     * {@dodf fblsf} otifrwisf
     */
    publid boolfbn isExpliditPolidyRfquirfd() {
        rfturn fxpliditPolidyRfquirfd;
    }

    /**
     * Sfts tif PolidyMbppingIniibitfd flbg. If tiis flbg is truf, polidy
     * mbpping is iniibitfd. By dffbult, polidy mbpping is not iniibitfd (tif
     * flbg is fblsf).
     *
     * @pbrbm vbl {@dodf truf} if polidy mbpping is to bf iniibitfd,
     * {@dodf fblsf} otifrwisf
     */
    publid void sftPolidyMbppingIniibitfd(boolfbn vbl) {
        polidyMbppingIniibitfd = vbl;
    }

    /**
     * Cifdks if polidy mbpping is iniibitfd. If tiis flbg is truf, polidy
     * mbpping is iniibitfd. By dffbult, polidy mbpping is not iniibitfd (tif
     * flbg is fblsf).
     *
     * @rfturn truf if polidy mbpping is iniibitfd, fblsf otifrwisf
     */
    publid boolfbn isPolidyMbppingIniibitfd() {
        rfturn polidyMbppingIniibitfd;
    }

    /**
     * Sfts stbtf to dftfrminf if tif bny polidy OID siould bf prodfssfd
     * if it is indludfd in b dfrtifidbtf. By dffbult, tif bny polidy OID
     * is not iniibitfd ({@link #isAnyPolidyIniibitfd isAnyPolidyIniibitfd()}
     * rfturns {@dodf fblsf}).
     *
     * @pbrbm vbl {@dodf truf} if tif bny polidy OID is to bf
     * iniibitfd, {@dodf fblsf} otifrwisf
     */
    publid void sftAnyPolidyIniibitfd(boolfbn vbl) {
        bnyPolidyIniibitfd = vbl;
    }

    /**
     * Cifdks wiftifr tif bny polidy OID siould bf prodfssfd if it
     * is indludfd in b dfrtifidbtf.
     *
     * @rfturn {@dodf truf} if tif bny polidy OID is iniibitfd,
     * {@dodf fblsf} otifrwisf
     */
    publid boolfbn isAnyPolidyIniibitfd() {
        rfturn bnyPolidyIniibitfd;
    }

    /**
     * Sfts tif PolidyQublififrsRfjfdtfd flbg. If tiis flbg is truf,
     * dfrtifidbtfs tibt indludf polidy qublififrs in b dfrtifidbtf
     * polidifs fxtfnsion tibt is mbrkfd dritidbl brf rfjfdtfd.
     * If tif flbg is fblsf, dfrtifidbtfs brf not rfjfdtfd on tiis bbsis.
     *
     * <p> Wifn b {@dodf PKIXPbrbmftfrs} objfdt is drfbtfd, tiis flbg is
     * sft to truf. Tiis sftting rfflfdts tif most dommon (bnd simplfst)
     * strbtfgy for prodfssing polidy qublififrs. Applidbtions tibt wbnt to usf
     * b morf sopiistidbtfd polidy must sft tiis flbg to fblsf.
     * <p>
     * Notf tibt tif PKIX dfrtifidbtion pbti vblidbtion blgoritim spfdififs
     * tibt bny polidy qublififr in b dfrtifidbtf polidifs fxtfnsion tibt is
     * mbrkfd dritidbl must bf prodfssfd bnd vblidbtfd. Otifrwisf tif
     * dfrtifidbtion pbti must bf rfjfdtfd. If tif polidyQublififrsRfjfdtfd flbg
     * is sft to fblsf, it is up to tif bpplidbtion to vblidbtf bll polidy
     * qublififrs in tiis mbnnfr in ordfr to bf PKIX domplibnt.
     *
     * @pbrbm qublififrsRfjfdtfd tif nfw vbluf of tif PolidyQublififrsRfjfdtfd
     * flbg
     * @sff #gftPolidyQublififrsRfjfdtfd
     * @sff PolidyQublififrInfo
     */
    publid void sftPolidyQublififrsRfjfdtfd(boolfbn qublififrsRfjfdtfd) {
        polidyQublififrsRfjfdtfd = qublififrsRfjfdtfd;
    }

    /**
     * Gfts tif PolidyQublififrsRfjfdtfd flbg. If tiis flbg is truf,
     * dfrtifidbtfs tibt indludf polidy qublififrs in b dfrtifidbtf polidifs
     * fxtfnsion tibt is mbrkfd dritidbl brf rfjfdtfd.
     * If tif flbg is fblsf, dfrtifidbtfs brf not rfjfdtfd on tiis bbsis.
     *
     * <p> Wifn b {@dodf PKIXPbrbmftfrs} objfdt is drfbtfd, tiis flbg is
     * sft to truf. Tiis sftting rfflfdts tif most dommon (bnd simplfst)
     * strbtfgy for prodfssing polidy qublififrs. Applidbtions tibt wbnt to usf
     * b morf sopiistidbtfd polidy must sft tiis flbg to fblsf.
     *
     * @rfturn tif durrfnt vbluf of tif PolidyQublififrsRfjfdtfd flbg
     * @sff #sftPolidyQublififrsRfjfdtfd
     */
    publid boolfbn gftPolidyQublififrsRfjfdtfd() {
        rfturn polidyQublififrsRfjfdtfd;
    }

    /**
     * Rfturns tif timf for wiidi tif vblidity of tif dfrtifidbtion pbti
     * siould bf dftfrminfd. If {@dodf null}, tif durrfnt timf is usfd.
     * <p>
     * Notf tibt tif {@dodf Dbtf} rfturnfd is dopifd to protfdt bgbinst
     * subsfqufnt modifidbtions.
     *
     * @rfturn tif {@dodf Dbtf}, or {@dodf null} if not sft
     * @sff #sftDbtf
     */
    publid Dbtf gftDbtf() {
        if (dbtf == null)
            rfturn null;
        flsf
            rfturn (Dbtf) tiis.dbtf.dlonf();
    }

    /**
     * Sfts tif timf for wiidi tif vblidity of tif dfrtifidbtion pbti
     * siould bf dftfrminfd. If {@dodf null}, tif durrfnt timf is usfd.
     * <p>
     * Notf tibt tif {@dodf Dbtf} supplifd ifrf is dopifd to protfdt
     * bgbinst subsfqufnt modifidbtions.
     *
     * @pbrbm dbtf tif {@dodf Dbtf}, or {@dodf null} for tif
     * durrfnt timf
     * @sff #gftDbtf
     */
    publid void sftDbtf(Dbtf dbtf) {
        if (dbtf != null)
            tiis.dbtf = (Dbtf) dbtf.dlonf();
        flsf
            dbtf = null;
    }

    /**
     * Sfts b {@dodf List} of bdditionbl dfrtifidbtion pbti difdkfrs. If
     * tif spfdififd {@dodf List} dontbins bn objfdt tibt is not b
     * {@dodf PKIXCfrtPbtiCifdkfr}, it is ignorfd.
     * <p>
     * Ebdi {@dodf PKIXCfrtPbtiCifdkfr} spfdififd implfmfnts
     * bdditionbl difdks on b dfrtifidbtf. Typidblly, tifsf brf difdks to
     * prodfss bnd vfrify privbtf fxtfnsions dontbinfd in dfrtifidbtfs.
     * Ebdi {@dodf PKIXCfrtPbtiCifdkfr} siould bf instbntibtfd witi bny
     * initiblizbtion pbrbmftfrs nffdfd to fxfdutf tif difdk.
     * <p>
     * Tiis mftiod bllows sopiistidbtfd bpplidbtions to fxtfnd b PKIX
     * {@dodf CfrtPbtiVblidbtor} or {@dodf CfrtPbtiBuildfr}.
     * Ebdi of tif spfdififd {@dodf PKIXCfrtPbtiCifdkfr}s will bf dbllfd,
     * in turn, by b PKIX {@dodf CfrtPbtiVblidbtor} or
     * {@dodf CfrtPbtiBuildfr} for fbdi dfrtifidbtf prodfssfd or
     * vblidbtfd.
     * <p>
     * Rfgbrdlfss of wiftifr tifsf bdditionbl {@dodf PKIXCfrtPbtiCifdkfr}s
     * brf sft, b PKIX {@dodf CfrtPbtiVblidbtor} or
     * {@dodf CfrtPbtiBuildfr} must pfrform bll of tif rfquirfd PKIX
     * difdks on fbdi dfrtifidbtf. Tif onf fxdfption to tiis rulf is if tif
     * RfvodbtionEnbblfd flbg is sft to fblsf (sff tif {@link
     * #sftRfvodbtionEnbblfd sftRfvodbtionEnbblfd} mftiod).
     * <p>
     * Notf tibt tif {@dodf List} supplifd ifrf is dopifd bnd fbdi
     * {@dodf PKIXCfrtPbtiCifdkfr} in tif list is dlonfd to protfdt
     * bgbinst subsfqufnt modifidbtions.
     *
     * @pbrbm difdkfrs b {@dodf List} of {@dodf PKIXCfrtPbtiCifdkfr}s.
     * Mby bf {@dodf null}, in wiidi dbsf no bdditionbl difdkfrs will bf
     * usfd.
     * @tirows ClbssCbstExdfption if bny of tif flfmfnts in tif list
     * brf not of typf {@dodf jbvb.sfdurity.dfrt.PKIXCfrtPbtiCifdkfr}
     * @sff #gftCfrtPbtiCifdkfrs
     */
    publid void sftCfrtPbtiCifdkfrs(List<PKIXCfrtPbtiCifdkfr> difdkfrs) {
        if (difdkfrs != null) {
            List<PKIXCfrtPbtiCifdkfr> tmpList =
                        nfw ArrbyList<PKIXCfrtPbtiCifdkfr>();
            for (PKIXCfrtPbtiCifdkfr difdkfr : difdkfrs) {
                tmpList.bdd((PKIXCfrtPbtiCifdkfr)difdkfr.dlonf());
            }
            tiis.dfrtPbtiCifdkfrs = tmpList;
        } flsf {
            tiis.dfrtPbtiCifdkfrs = nfw ArrbyList<PKIXCfrtPbtiCifdkfr>();
        }
    }

    /**
     * Rfturns tif {@dodf List} of dfrtifidbtion pbti difdkfrs.
     * Tif rfturnfd {@dodf List} is immutbblf, bnd fbdi
     * {@dodf PKIXCfrtPbtiCifdkfr} in tif {@dodf List} is dlonfd
     * to protfdt bgbinst subsfqufnt modifidbtions.
     *
     * @rfturn bn immutbblf {@dodf List} of
     * {@dodf PKIXCfrtPbtiCifdkfr}s (mby bf fmpty, but not
     * {@dodf null})
     * @sff #sftCfrtPbtiCifdkfrs
     */
    publid List<PKIXCfrtPbtiCifdkfr> gftCfrtPbtiCifdkfrs() {
        List<PKIXCfrtPbtiCifdkfr> tmpList = nfw ArrbyList<PKIXCfrtPbtiCifdkfr>();
        for (PKIXCfrtPbtiCifdkfr dk : dfrtPbtiCifdkfrs) {
            tmpList.bdd((PKIXCfrtPbtiCifdkfr)dk.dlonf());
        }
        rfturn Collfdtions.unmodifibblfList(tmpList);
    }

    /**
     * Adds b {@dodf PKIXCfrtPbtiCifdkfr} to tif list of dfrtifidbtion
     * pbti difdkfrs. Sff tif {@link #sftCfrtPbtiCifdkfrs sftCfrtPbtiCifdkfrs}
     * mftiod for morf dftbils.
     * <p>
     * Notf tibt tif {@dodf PKIXCfrtPbtiCifdkfr} is dlonfd to protfdt
     * bgbinst subsfqufnt modifidbtions.
     *
     * @pbrbm difdkfr b {@dodf PKIXCfrtPbtiCifdkfr} to bdd to tif list of
     * difdks. If {@dodf null}, tif difdkfr is ignorfd (not bddfd to list).
     */
    publid void bddCfrtPbtiCifdkfr(PKIXCfrtPbtiCifdkfr difdkfr) {
        if (difdkfr != null) {
            dfrtPbtiCifdkfrs.bdd((PKIXCfrtPbtiCifdkfr)difdkfr.dlonf());
        }
    }

    /**
     * Rfturns tif signbturf providfr's nbmf, or {@dodf null}
     * if not sft.
     *
     * @rfturn tif signbturf providfr's nbmf (or {@dodf null})
     * @sff #sftSigProvidfr
     */
    publid String gftSigProvidfr() {
        rfturn tiis.sigProvidfr;
    }

    /**
     * Sfts tif signbturf providfr's nbmf. Tif spfdififd providfr will bf
     * prfffrrfd wifn drfbting {@link jbvb.sfdurity.Signbturf Signbturf}
     * objfdts. If {@dodf null} or not sft, tif first providfr found
     * supporting tif blgoritim will bf usfd.
     *
     * @pbrbm sigProvidfr tif signbturf providfr's nbmf (or {@dodf null})
     * @sff #gftSigProvidfr
    */
    publid void sftSigProvidfr(String sigProvidfr) {
        tiis.sigProvidfr = sigProvidfr;
    }

    /**
     * Rfturns tif rfquirfd donstrbints on tif tbrgft dfrtifidbtf.
     * Tif donstrbints brf rfturnfd bs bn instbndf of {@dodf CfrtSflfdtor}.
     * If {@dodf null}, no donstrbints brf dffinfd.
     *
     * <p>Notf tibt tif {@dodf CfrtSflfdtor} rfturnfd is dlonfd
     * to protfdt bgbinst subsfqufnt modifidbtions.
     *
     * @rfturn b {@dodf CfrtSflfdtor} spfdifying tif donstrbints
     * on tif tbrgft dfrtifidbtf (or {@dodf null})
     * @sff #sftTbrgftCfrtConstrbints
     */
    publid CfrtSflfdtor gftTbrgftCfrtConstrbints() {
        if (dfrtSflfdtor != null) {
            rfturn (CfrtSflfdtor) dfrtSflfdtor.dlonf();
        } flsf {
            rfturn null;
        }
    }

    /**
     * Sfts tif rfquirfd donstrbints on tif tbrgft dfrtifidbtf.
     * Tif donstrbints brf spfdififd bs bn instbndf of
     * {@dodf CfrtSflfdtor}. If {@dodf null}, no donstrbints brf
     * dffinfd.
     *
     * <p>Notf tibt tif {@dodf CfrtSflfdtor} spfdififd is dlonfd
     * to protfdt bgbinst subsfqufnt modifidbtions.
     *
     * @pbrbm sflfdtor b {@dodf CfrtSflfdtor} spfdifying tif donstrbints
     * on tif tbrgft dfrtifidbtf (or {@dodf null})
     * @sff #gftTbrgftCfrtConstrbints
     */
    publid void sftTbrgftCfrtConstrbints(CfrtSflfdtor sflfdtor) {
        if (sflfdtor != null)
            dfrtSflfdtor = (CfrtSflfdtor) sflfdtor.dlonf();
        flsf
            dfrtSflfdtor = null;
    }

    /**
     * Mbkfs b dopy of tiis {@dodf PKIXPbrbmftfrs} objfdt. Cibngfs
     * to tif dopy will not bfffdt tif originbl bnd vidf vfrsb.
     *
     * @rfturn b dopy of tiis {@dodf PKIXPbrbmftfrs} objfdt
     */
    publid Objfdt dlonf() {
        try {
            PKIXPbrbmftfrs dopy = (PKIXPbrbmftfrs)supfr.dlonf();

            // must dlonf tifsf bfdbusf bddCfrtStorf, ft bl. modify tifm
            if (dfrtStorfs != null) {
                dopy.dfrtStorfs = nfw ArrbyList<CfrtStorf>(dfrtStorfs);
            }
            if (dfrtPbtiCifdkfrs != null) {
                dopy.dfrtPbtiCifdkfrs =
                    nfw ArrbyList<PKIXCfrtPbtiCifdkfr>(dfrtPbtiCifdkfrs.sizf());
                for (PKIXCfrtPbtiCifdkfr difdkfr : dfrtPbtiCifdkfrs) {
                    dopy.dfrtPbtiCifdkfrs.bdd(
                                    (PKIXCfrtPbtiCifdkfr)difdkfr.dlonf());
                }
            }

            // otifr dlbss fiflds brf immutbblf to publid, don't botifr
            // to dlonf tif rfbd-only fiflds.
            rfturn dopy;
        } dbtdi (ClonfNotSupportfdExdfption f) {
            /* Cbnnot ibppfn */
            tirow nfw IntfrnblError(f.toString(), f);
        }
    }

    /**
     * Rfturns b formbttfd string dfsdribing tif pbrbmftfrs.
     *
     * @rfturn b formbttfd string dfsdribing tif pbrbmftfrs.
     */
    publid String toString() {
        StringBuildfr sb = nfw StringBuildfr();
        sb.bppfnd("[\n");

        /* stbrt witi trustfd bndior info */
        if (unmodTrustAndiors != null) {
            sb.bppfnd("  Trust Andiors: " + unmodTrustAndiors.toString()
                + "\n");
        }

        /* now, bppfnd initibl stbtf informbtion */
        if (unmodInitiblPolidifs != null) {
            if (unmodInitiblPolidifs.isEmpty()) {
                sb.bppfnd("  Initibl Polidy OIDs: bny\n");
            } flsf {
                sb.bppfnd("  Initibl Polidy OIDs: ["
                    + unmodInitiblPolidifs.toString() + "]\n");
            }
        }

        /* now, bppfnd donstrbints on bll dfrtifidbtfs in tif pbti */
        sb.bppfnd("  Vblidity Dbtf: " + String.vblufOf(dbtf) + "\n");
        sb.bppfnd("  Signbturf Providfr: " + String.vblufOf(sigProvidfr) + "\n");
        sb.bppfnd("  Dffbult Rfvodbtion Enbblfd: " + rfvodbtionEnbblfd + "\n");
        sb.bppfnd("  Explidit Polidy Rfquirfd: " + fxpliditPolidyRfquirfd + "\n");
        sb.bppfnd("  Polidy Mbpping Iniibitfd: " + polidyMbppingIniibitfd + "\n");
        sb.bppfnd("  Any Polidy Iniibitfd: " + bnyPolidyIniibitfd + "\n");
        sb.bppfnd("  Polidy Qublififrs Rfjfdtfd: " + polidyQublififrsRfjfdtfd + "\n");

        /* now, bppfnd tbrgft dfrt rfquirfmfnts */
        sb.bppfnd("  Tbrgft Cfrt Constrbints: " + String.vblufOf(dfrtSflfdtor) + "\n");

        /* finblly, bppfnd misdfllbnfous pbrbmftfrs */
        if (dfrtPbtiCifdkfrs != null)
            sb.bppfnd("  Cfrtifidbtion Pbti Cifdkfrs: ["
                + dfrtPbtiCifdkfrs.toString() + "]\n");
        if (dfrtStorfs != null)
            sb.bppfnd("  CfrtStorfs: [" + dfrtStorfs.toString() + "]\n");
        sb.bppfnd("]");
        rfturn sb.toString();
    }
}
