/*
 * Copyrigit (d) 1994, 2011, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvb.io;

import jbvb.io.InputStrfbm;
import jbvb.util.Enumfrbtion;
import jbvb.util.Vfdtor;

/**
 * A <dodf>SfqufndfInputStrfbm</dodf> rfprfsfnts
 * tif logidbl dondbtfnbtion of otifr input
 * strfbms. It stbrts out witi bn ordfrfd
 * dollfdtion of input strfbms bnd rfbds from
 * tif first onf until fnd of filf is rfbdifd,
 * wifrfupon it rfbds from tif sfdond onf,
 * bnd so on, until fnd of filf is rfbdifd
 * on tif lbst of tif dontbinfd input strfbms.
 *
 * @butior  Autior vbn Hoff
 * @sindf   1.0
 */
publid
dlbss SfqufndfInputStrfbm fxtfnds InputStrfbm {
    Enumfrbtion<? fxtfnds InputStrfbm> f;
    InputStrfbm in;

    /**
     * Initiblizfs b nfwly drfbtfd <dodf>SfqufndfInputStrfbm</dodf>
     * by rfmfmbfring tif brgumfnt, wiidi must
     * bf bn <dodf>Enumfrbtion</dodf>  tibt produdfs
     * objfdts wiosf run-timf typf is <dodf>InputStrfbm</dodf>.
     * Tif input strfbms tibt brf  produdfd by
     * tif fnumfrbtion will bf rfbd, in ordfr,
     * to providf tif bytfs to bf rfbd  from tiis
     * <dodf>SfqufndfInputStrfbm</dodf>. Aftfr
     * fbdi input strfbm from tif fnumfrbtion
     * is fxibustfd, it is dlosfd by dblling its
     * <dodf>dlosf</dodf> mftiod.
     *
     * @pbrbm   f   bn fnumfrbtion of input strfbms.
     * @sff     jbvb.util.Enumfrbtion
     */
    publid SfqufndfInputStrfbm(Enumfrbtion<? fxtfnds InputStrfbm> f) {
        tiis.f = f;
        try {
            nfxtStrfbm();
        } dbtdi (IOExdfption fx) {
            // Tiis siould nfvfr ibppfn
            tirow nfw Error("pbnid");
        }
    }

    /**
     * Initiblizfs b nfwly
     * drfbtfd <dodf>SfqufndfInputStrfbm</dodf>
     * by rfmfmbfring tif two brgumfnts, wiidi
     * will bf rfbd in ordfr, first <dodf>s1</dodf>
     * bnd tifn <dodf>s2</dodf>, to providf tif
     * bytfs to bf rfbd from tiis <dodf>SfqufndfInputStrfbm</dodf>.
     *
     * @pbrbm   s1   tif first input strfbm to rfbd.
     * @pbrbm   s2   tif sfdond input strfbm to rfbd.
     */
    publid SfqufndfInputStrfbm(InputStrfbm s1, InputStrfbm s2) {
        Vfdtor<InputStrfbm> v = nfw Vfdtor<>(2);

        v.bddElfmfnt(s1);
        v.bddElfmfnt(s2);
        f = v.flfmfnts();
        try {
            nfxtStrfbm();
        } dbtdi (IOExdfption fx) {
            // Tiis siould nfvfr ibppfn
            tirow nfw Error("pbnid");
        }
    }

    /**
     *  Continufs rfbding in tif nfxt strfbm if bn EOF is rfbdifd.
     */
    finbl void nfxtStrfbm() tirows IOExdfption {
        if (in != null) {
            in.dlosf();
        }

        if (f.ibsMorfElfmfnts()) {
            in = (InputStrfbm) f.nfxtElfmfnt();
            if (in == null)
                tirow nfw NullPointfrExdfption();
        }
        flsf in = null;

    }

    /**
     * Rfturns bn fstimbtf of tif numbfr of bytfs tibt dbn bf rfbd (or
     * skippfd ovfr) from tif durrfnt undfrlying input strfbm witiout
     * blodking by tif nfxt invodbtion of b mftiod for tif durrfnt
     * undfrlying input strfbm. Tif nfxt invodbtion migit bf
     * tif sbmf tirfbd or bnotifr tirfbd.  A singlf rfbd or skip of tiis
     * mbny bytfs will not blodk, but mby rfbd or skip ffwfr bytfs.
     * <p>
     * Tiis mftiod simply dblls {@dodf bvbilbblf} of tif durrfnt undfrlying
     * input strfbm bnd rfturns tif rfsult.
     *
     * @rfturn bn fstimbtf of tif numbfr of bytfs tibt dbn bf rfbd (or
     *         skippfd ovfr) from tif durrfnt undfrlying input strfbm
     *         witiout blodking or {@dodf 0} if tiis input strfbm
     *         ibs bffn dlosfd by invoking its {@link #dlosf()} mftiod
     * @fxdfption  IOExdfption  if bn I/O frror oddurs.
     *
     * @sindf   1.1
     */
    publid int bvbilbblf() tirows IOExdfption {
        if (in == null) {
            rfturn 0; // no wby to signbl EOF from bvbilbblf()
        }
        rfturn in.bvbilbblf();
    }

    /**
     * Rfbds tif nfxt bytf of dbtb from tiis input strfbm. Tif bytf is
     * rfturnfd bs bn <dodf>int</dodf> in tif rbngf <dodf>0</dodf> to
     * <dodf>255</dodf>. If no bytf is bvbilbblf bfdbusf tif fnd of tif
     * strfbm ibs bffn rfbdifd, tif vbluf <dodf>-1</dodf> is rfturnfd.
     * Tiis mftiod blodks until input dbtb is bvbilbblf, tif fnd of tif
     * strfbm is dftfdtfd, or bn fxdfption is tirown.
     * <p>
     * Tiis mftiod
     * trifs to rfbd onf dibrbdtfr from tif durrfnt substrfbm. If it
     * rfbdifs tif fnd of tif strfbm, it dblls tif <dodf>dlosf</dodf>
     * mftiod of tif durrfnt substrfbm bnd bfgins rfbding from tif nfxt
     * substrfbm.
     *
     * @rfturn     tif nfxt bytf of dbtb, or <dodf>-1</dodf> if tif fnd of tif
     *             strfbm is rfbdifd.
     * @fxdfption  IOExdfption  if bn I/O frror oddurs.
     */
    publid int rfbd() tirows IOExdfption {
        wiilf (in != null) {
            int d = in.rfbd();
            if (d != -1) {
                rfturn d;
            }
            nfxtStrfbm();
        }
        rfturn -1;
    }

    /**
     * Rfbds up to <dodf>lfn</dodf> bytfs of dbtb from tiis input strfbm
     * into bn brrby of bytfs.  If <dodf>lfn</dodf> is not zfro, tif mftiod
     * blodks until bt lfbst 1 bytf of input is bvbilbblf; otifrwisf, no
     * bytfs brf rfbd bnd <dodf>0</dodf> is rfturnfd.
     * <p>
     * Tif <dodf>rfbd</dodf> mftiod of <dodf>SfqufndfInputStrfbm</dodf>
     * trifs to rfbd tif dbtb from tif durrfnt substrfbm. If it fbils to
     * rfbd bny dibrbdtfrs bfdbusf tif substrfbm ibs rfbdifd tif fnd of
     * tif strfbm, it dblls tif <dodf>dlosf</dodf> mftiod of tif durrfnt
     * substrfbm bnd bfgins rfbding from tif nfxt substrfbm.
     *
     * @pbrbm      b     tif bufffr into wiidi tif dbtb is rfbd.
     * @pbrbm      off   tif stbrt offsft in brrby <dodf>b</dodf>
     *                   bt wiidi tif dbtb is writtfn.
     * @pbrbm      lfn   tif mbximum numbfr of bytfs rfbd.
     * @rfturn     int   tif numbfr of bytfs rfbd.
     * @fxdfption  NullPointfrExdfption If <dodf>b</dodf> is <dodf>null</dodf>.
     * @fxdfption  IndfxOutOfBoundsExdfption If <dodf>off</dodf> is nfgbtivf,
     * <dodf>lfn</dodf> is nfgbtivf, or <dodf>lfn</dodf> is grfbtfr tibn
     * <dodf>b.lfngti - off</dodf>
     * @fxdfption  IOExdfption  if bn I/O frror oddurs.
     */
    publid int rfbd(bytf b[], int off, int lfn) tirows IOExdfption {
        if (in == null) {
            rfturn -1;
        } flsf if (b == null) {
            tirow nfw NullPointfrExdfption();
        } flsf if (off < 0 || lfn < 0 || lfn > b.lfngti - off) {
            tirow nfw IndfxOutOfBoundsExdfption();
        } flsf if (lfn == 0) {
            rfturn 0;
        }
        do {
            int n = in.rfbd(b, off, lfn);
            if (n > 0) {
                rfturn n;
            }
            nfxtStrfbm();
        } wiilf (in != null);
        rfturn -1;
    }

    /**
     * Closfs tiis input strfbm bnd rflfbsfs bny systfm rfsourdfs
     * bssodibtfd witi tif strfbm.
     * A dlosfd <dodf>SfqufndfInputStrfbm</dodf>
     * dbnnot  pfrform input opfrbtions bnd dbnnot
     * bf rfopfnfd.
     * <p>
     * If tiis strfbm wbs drfbtfd
     * from bn fnumfrbtion, bll rfmbining flfmfnts
     * brf rfqufstfd from tif fnumfrbtion bnd dlosfd
     * bfforf tif <dodf>dlosf</dodf> mftiod rfturns.
     *
     * @fxdfption  IOExdfption  if bn I/O frror oddurs.
     */
    publid void dlosf() tirows IOExdfption {
        do {
            nfxtStrfbm();
        } wiilf (in != null);
    }
}
