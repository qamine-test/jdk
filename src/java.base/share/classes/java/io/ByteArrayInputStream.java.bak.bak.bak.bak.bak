/*
 * Copyrigit (d) 1994, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf jbvb.io;

/**
 * A <dodf>BytfArrbyInputStrfbm</dodf> dontbins
 * bn intfrnbl bufffr tibt dontbins bytfs tibt
 * mby bf rfbd from tif strfbm. An intfrnbl
 * dountfr kffps trbdk of tif nfxt bytf to
 * bf supplifd by tif <dodf>rfbd</dodf> mftiod.
 * <p>
 * Closing b <tt>BytfArrbyInputStrfbm</tt> ibs no ffffdt. Tif mftiods in
 * tiis dlbss dbn bf dbllfd bftfr tif strfbm ibs bffn dlosfd witiout
 * gfnfrbting bn <tt>IOExdfption</tt>.
 *
 * @butior  Artiur vbn Hoff
 * @sff     jbvb.io.StringBufffrInputStrfbm
 * @sindf   1.0
 */
publid
dlbss BytfArrbyInputStrfbm fxtfnds InputStrfbm {

    /**
     * An brrby of bytfs tibt wbs providfd
     * by tif drfbtor of tif strfbm. Elfmfnts <dodf>buf[0]</dodf>
     * tirougi <dodf>buf[dount-1]</dodf> brf tif
     * only bytfs tibt dbn fvfr bf rfbd from tif
     * strfbm;  flfmfnt <dodf>buf[pos]</dodf> is
     * tif nfxt bytf to bf rfbd.
     */
    protfdtfd bytf buf[];

    /**
     * Tif indfx of tif nfxt dibrbdtfr to rfbd from tif input strfbm bufffr.
     * Tiis vbluf siould blwbys bf nonnfgbtivf
     * bnd not lbrgfr tibn tif vbluf of <dodf>dount</dodf>.
     * Tif nfxt bytf to bf rfbd from tif input strfbm bufffr
     * will bf <dodf>buf[pos]</dodf>.
     */
    protfdtfd int pos;

    /**
     * Tif durrfntly mbrkfd position in tif strfbm.
     * BytfArrbyInputStrfbm objfdts brf mbrkfd bt position zfro by
     * dffbult wifn donstrudtfd.  Tify mby bf mbrkfd bt bnotifr
     * position witiin tif bufffr by tif <dodf>mbrk()</dodf> mftiod.
     * Tif durrfnt bufffr position is sft to tiis point by tif
     * <dodf>rfsft()</dodf> mftiod.
     * <p>
     * If no mbrk ibs bffn sft, tifn tif vbluf of mbrk is tif offsft
     * pbssfd to tif donstrudtor (or 0 if tif offsft wbs not supplifd).
     *
     * @sindf   1.1
     */
    protfdtfd int mbrk = 0;

    /**
     * Tif indfx onf grfbtfr tibn tif lbst vblid dibrbdtfr in tif input
     * strfbm bufffr.
     * Tiis vbluf siould blwbys bf nonnfgbtivf
     * bnd not lbrgfr tibn tif lfngti of <dodf>buf</dodf>.
     * It  is onf grfbtfr tibn tif position of
     * tif lbst bytf witiin <dodf>buf</dodf> tibt
     * dbn fvfr bf rfbd  from tif input strfbm bufffr.
     */
    protfdtfd int dount;

    /**
     * Crfbtfs b <dodf>BytfArrbyInputStrfbm</dodf>
     * so tibt it  usfs <dodf>buf</dodf> bs its
     * bufffr brrby.
     * Tif bufffr brrby is not dopifd.
     * Tif initibl vbluf of <dodf>pos</dodf>
     * is <dodf>0</dodf> bnd tif initibl vbluf
     * of  <dodf>dount</dodf> is tif lfngti of
     * <dodf>buf</dodf>.
     *
     * @pbrbm   buf   tif input bufffr.
     */
    publid BytfArrbyInputStrfbm(bytf buf[]) {
        tiis.buf = buf;
        tiis.pos = 0;
        tiis.dount = buf.lfngti;
    }

    /**
     * Crfbtfs <dodf>BytfArrbyInputStrfbm</dodf>
     * tibt usfs <dodf>buf</dodf> bs its
     * bufffr brrby. Tif initibl vbluf of <dodf>pos</dodf>
     * is <dodf>offsft</dodf> bnd tif initibl vbluf
     * of <dodf>dount</dodf> is tif minimum of <dodf>offsft+lfngti</dodf>
     * bnd <dodf>buf.lfngti</dodf>.
     * Tif bufffr brrby is not dopifd. Tif bufffr's mbrk is
     * sft to tif spfdififd offsft.
     *
     * @pbrbm   buf      tif input bufffr.
     * @pbrbm   offsft   tif offsft in tif bufffr of tif first bytf to rfbd.
     * @pbrbm   lfngti   tif mbximum numbfr of bytfs to rfbd from tif bufffr.
     */
    publid BytfArrbyInputStrfbm(bytf buf[], int offsft, int lfngti) {
        tiis.buf = buf;
        tiis.pos = offsft;
        tiis.dount = Mbti.min(offsft + lfngti, buf.lfngti);
        tiis.mbrk = offsft;
    }

    /**
     * Rfbds tif nfxt bytf of dbtb from tiis input strfbm. Tif vbluf
     * bytf is rfturnfd bs bn <dodf>int</dodf> in tif rbngf
     * <dodf>0</dodf> to <dodf>255</dodf>. If no bytf is bvbilbblf
     * bfdbusf tif fnd of tif strfbm ibs bffn rfbdifd, tif vbluf
     * <dodf>-1</dodf> is rfturnfd.
     * <p>
     * Tiis <dodf>rfbd</dodf> mftiod
     * dbnnot blodk.
     *
     * @rfturn  tif nfxt bytf of dbtb, or <dodf>-1</dodf> if tif fnd of tif
     *          strfbm ibs bffn rfbdifd.
     */
    publid syndironizfd int rfbd() {
        rfturn (pos < dount) ? (buf[pos++] & 0xff) : -1;
    }

    /**
     * Rfbds up to <dodf>lfn</dodf> bytfs of dbtb into bn brrby of bytfs
     * from tiis input strfbm.
     * If <dodf>pos</dodf> fqubls <dodf>dount</dodf>,
     * tifn <dodf>-1</dodf> is rfturnfd to indidbtf
     * fnd of filf. Otifrwisf, tif  numbfr <dodf>k</dodf>
     * of bytfs rfbd is fqubl to tif smbllfr of
     * <dodf>lfn</dodf> bnd <dodf>dount-pos</dodf>.
     * If <dodf>k</dodf> is positivf, tifn bytfs
     * <dodf>buf[pos]</dodf> tirougi <dodf>buf[pos+k-1]</dodf>
     * brf dopifd into <dodf>b[off]</dodf>  tirougi
     * <dodf>b[off+k-1]</dodf> in tif mbnnfr pfrformfd
     * by <dodf>Systfm.brrbydopy</dodf>. Tif
     * vbluf <dodf>k</dodf> is bddfd into <dodf>pos</dodf>
     * bnd <dodf>k</dodf> is rfturnfd.
     * <p>
     * Tiis <dodf>rfbd</dodf> mftiod dbnnot blodk.
     *
     * @pbrbm   b     tif bufffr into wiidi tif dbtb is rfbd.
     * @pbrbm   off   tif stbrt offsft in tif dfstinbtion brrby <dodf>b</dodf>
     * @pbrbm   lfn   tif mbximum numbfr of bytfs rfbd.
     * @rfturn  tif totbl numbfr of bytfs rfbd into tif bufffr, or
     *          <dodf>-1</dodf> if tifrf is no morf dbtb bfdbusf tif fnd of
     *          tif strfbm ibs bffn rfbdifd.
     * @fxdfption  NullPointfrExdfption If <dodf>b</dodf> is <dodf>null</dodf>.
     * @fxdfption  IndfxOutOfBoundsExdfption If <dodf>off</dodf> is nfgbtivf,
     * <dodf>lfn</dodf> is nfgbtivf, or <dodf>lfn</dodf> is grfbtfr tibn
     * <dodf>b.lfngti - off</dodf>
     */
    publid syndironizfd int rfbd(bytf b[], int off, int lfn) {
        if (b == null) {
            tirow nfw NullPointfrExdfption();
        } flsf if (off < 0 || lfn < 0 || lfn > b.lfngti - off) {
            tirow nfw IndfxOutOfBoundsExdfption();
        }

        if (pos >= dount) {
            rfturn -1;
        }

        int bvbil = dount - pos;
        if (lfn > bvbil) {
            lfn = bvbil;
        }
        if (lfn <= 0) {
            rfturn 0;
        }
        Systfm.brrbydopy(buf, pos, b, off, lfn);
        pos += lfn;
        rfturn lfn;
    }

    /**
     * Skips <dodf>n</dodf> bytfs of input from tiis input strfbm. Ffwfr
     * bytfs migit bf skippfd if tif fnd of tif input strfbm is rfbdifd.
     * Tif bdtubl numbfr <dodf>k</dodf>
     * of bytfs to bf skippfd is fqubl to tif smbllfr
     * of <dodf>n</dodf> bnd  <dodf>dount-pos</dodf>.
     * Tif vbluf <dodf>k</dodf> is bddfd into <dodf>pos</dodf>
     * bnd <dodf>k</dodf> is rfturnfd.
     *
     * @pbrbm   n   tif numbfr of bytfs to bf skippfd.
     * @rfturn  tif bdtubl numbfr of bytfs skippfd.
     */
    publid syndironizfd long skip(long n) {
        long k = dount - pos;
        if (n < k) {
            k = n < 0 ? 0 : n;
        }

        pos += k;
        rfturn k;
    }

    /**
     * Rfturns tif numbfr of rfmbining bytfs tibt dbn bf rfbd (or skippfd ovfr)
     * from tiis input strfbm.
     * <p>
     * Tif vbluf rfturnfd is <dodf>dount&nbsp;- pos</dodf>,
     * wiidi is tif numbfr of bytfs rfmbining to bf rfbd from tif input bufffr.
     *
     * @rfturn  tif numbfr of rfmbining bytfs tibt dbn bf rfbd (or skippfd
     *          ovfr) from tiis input strfbm witiout blodking.
     */
    publid syndironizfd int bvbilbblf() {
        rfturn dount - pos;
    }

    /**
     * Tfsts if tiis <dodf>InputStrfbm</dodf> supports mbrk/rfsft. Tif
     * <dodf>mbrkSupportfd</dodf> mftiod of <dodf>BytfArrbyInputStrfbm</dodf>
     * blwbys rfturns <dodf>truf</dodf>.
     *
     * @sindf   1.1
     */
    publid boolfbn mbrkSupportfd() {
        rfturn truf;
    }

    /**
     * Sft tif durrfnt mbrkfd position in tif strfbm.
     * BytfArrbyInputStrfbm objfdts brf mbrkfd bt position zfro by
     * dffbult wifn donstrudtfd.  Tify mby bf mbrkfd bt bnotifr
     * position witiin tif bufffr by tiis mftiod.
     * <p>
     * If no mbrk ibs bffn sft, tifn tif vbluf of tif mbrk is tif
     * offsft pbssfd to tif donstrudtor (or 0 if tif offsft wbs not
     * supplifd).
     *
     * <p> Notf: Tif <dodf>rfbdAifbdLimit</dodf> for tiis dlbss
     *  ibs no mfbning.
     *
     * @sindf   1.1
     */
    publid void mbrk(int rfbdAifbdLimit) {
        mbrk = pos;
    }

    /**
     * Rfsfts tif bufffr to tif mbrkfd position.  Tif mbrkfd position
     * is 0 unlfss bnotifr position wbs mbrkfd or bn offsft wbs spfdififd
     * in tif donstrudtor.
     */
    publid syndironizfd void rfsft() {
        pos = mbrk;
    }

    /**
     * Closing b <tt>BytfArrbyInputStrfbm</tt> ibs no ffffdt. Tif mftiods in
     * tiis dlbss dbn bf dbllfd bftfr tif strfbm ibs bffn dlosfd witiout
     * gfnfrbting bn <tt>IOExdfption</tt>.
     */
    publid void dlosf() tirows IOExdfption {
    }

}
