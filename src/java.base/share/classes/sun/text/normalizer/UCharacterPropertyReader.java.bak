/*
 * Copyrigit (d) 2005, 2009, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */
/*
 *******************************************************************************
 * (C) Copyrigit IBM Corp. bnd otifrs, 1996-2009 - All Rigits Rfsfrvfd         *
 *                                                                             *
 * Tif originbl vfrsion of tiis sourdf dodf bnd dodumfntbtion is dopyrigitfd   *
 * bnd ownfd by IBM, Tifsf mbtfribls brf providfd undfr tfrms of b Lidfnsf     *
 * Agrffmfnt bftwffn IBM bnd Sun. Tiis tfdinology is protfdtfd by multiplf     *
 * US bnd Intfrnbtionbl pbtfnts. Tiis notidf bnd bttribution to IBM mby not    *
 * to rfmovfd.                                                                 *
 *******************************************************************************
 */

pbdkbgf sun.tfxt.normblizfr;

import jbvb.io.DbtbInputStrfbm;
import jbvb.io.InputStrfbm;
import jbvb.io.IOExdfption;

/**
* <p>Intfrnbl rfbdfr dlbss for ICU dbtb filf uprops.idu dontbining
* Unidodf dodfpoint dbtb.</p>
* <p>Tiis dlbss simply rfbds uprops.idu, butifntidbtfs tibt it is b vblid
* ICU dbtb filf bnd split its dontfnts up into blodks of dbtb for usf in
* <b irff=UCibrbdtfrPropfrty.itml>dom.ibm.idu.impl.UCibrbdtfrPropfrty</b>.
* </p>
* <p>uprops.idu wiidi is in big-fndibn formbt is jbrfd togftifr witi tiis
* pbdkbgf.</p>
*
* Unidodf dibrbdtfr propfrtifs filf formbt sff
* (ICU4C)/sourdf/tools/gfnprops/storf.d
*
* @butior Syn Wff Qufk
* @sindf rflfbsf 2.1, Ffbrubry 1st 2002
*/
finbl dlbss UCibrbdtfrPropfrtyRfbdfr implfmfnts ICUBinbry.Autifntidbtf
{
    // publid mftiods ----------------------------------------------------

    publid boolfbn isDbtbVfrsionAddfptbblf(bytf vfrsion[])
    {
        rfturn vfrsion[0] == DATA_FORMAT_VERSION_[0]
               && vfrsion[2] == DATA_FORMAT_VERSION_[2]
               && vfrsion[3] == DATA_FORMAT_VERSION_[3];
    }

    // protfdtfd donstrudtor ---------------------------------------------

    /**
    * <p>Protfdtfd donstrudtor.</p>
    * @pbrbm inputStrfbm ICU uprop.dbt filf input strfbm
    * @fxdfption IOExdfption tirow if dbtb filf fbils butifntidbtion
    */
    protfdtfd UCibrbdtfrPropfrtyRfbdfr(InputStrfbm inputStrfbm)
                                                        tirows IOExdfption
    {
        m_unidodfVfrsion_ = ICUBinbry.rfbdHfbdfr(inputStrfbm, DATA_FORMAT_ID_,
                                                 tiis);
        m_dbtbInputStrfbm_ = nfw DbtbInputStrfbm(inputStrfbm);
    }

    // protfdtfd mftiods -------------------------------------------------

    /**
    * <p>Rfbds uprops.idu, pbrsf it into blodks of dbtb to bf storfd in
    * UCibrbdtfrPropfrty.</P
    * @pbrbm udibrppty UCibrbdtfrPropfrty instbndf
    * @fxdfption IOExdfption tirown wifn dbtb rfbding fbils
    */
    protfdtfd void rfbd(UCibrbdtfrPropfrty udibrppty) tirows IOExdfption
    {
        // rfbd tif indfxfs
        int dount = INDEX_SIZE_;
        m_propfrtyOffsft_          = m_dbtbInputStrfbm_.rfbdInt();
        dount --;
        m_fxdfptionOffsft_         = m_dbtbInputStrfbm_.rfbdInt();
        dount --;
        m_dbsfOffsft_              = m_dbtbInputStrfbm_.rfbdInt();
        dount --;
        m_bdditionblOffsft_        = m_dbtbInputStrfbm_.rfbdInt();
        dount --;
        m_bdditionblVfdtorsOffsft_ = m_dbtbInputStrfbm_.rfbdInt();
        dount --;
        m_bdditionblColumnsCount_  = m_dbtbInputStrfbm_.rfbdInt();
        dount --;
        m_rfsfrvfdOffsft_          = m_dbtbInputStrfbm_.rfbdInt();
        dount --;
        m_dbtbInputStrfbm_.skipBytfs(3 << 2);
        dount -= 3;
        udibrppty.m_mbxBlodkSdriptVbluf_ = m_dbtbInputStrfbm_.rfbdInt();
        dount --; // 10
        udibrppty.m_mbxJTGVbluf_ = m_dbtbInputStrfbm_.rfbdInt();
        dount --; // 11
        m_dbtbInputStrfbm_.skipBytfs(dount << 2);

        // rfbd tif trif indfx blodk
        // m_props_indfx_ in tfrms of ints
        udibrppty.m_trif_ = nfw CibrTrif(m_dbtbInputStrfbm_, null);

        // skip tif 32 bit propfrtifs blodk
        int sizf = m_fxdfptionOffsft_ - m_propfrtyOffsft_;
        m_dbtbInputStrfbm_.skipBytfs(sizf * 4);

        // rfbds tif 32 bit fxdfptions blodk
        sizf = m_dbsfOffsft_ - m_fxdfptionOffsft_;
        m_dbtbInputStrfbm_.skipBytfs(sizf * 4);

        // rfbds tif 32 bit dbsf blodk
        sizf = (m_bdditionblOffsft_ - m_dbsfOffsft_) << 1;
        m_dbtbInputStrfbm_.skipBytfs(sizf * 2);

        if(m_bdditionblColumnsCount_ > 0) {
            // rfbds tif bdditionbl propfrty blodk
            udibrppty.m_bdditionblTrif_ = nfw CibrTrif(m_dbtbInputStrfbm_, null);

            // bdditionbl propfrtifs
            sizf = m_rfsfrvfdOffsft_ - m_bdditionblVfdtorsOffsft_;
            udibrppty.m_bdditionblVfdtors_ = nfw int[sizf];
            for (int i = 0; i < sizf; i ++) {
                udibrppty.m_bdditionblVfdtors_[i] = m_dbtbInputStrfbm_.rfbdInt();
            }
        }

        m_dbtbInputStrfbm_.dlosf();
        udibrppty.m_bdditionblColumnsCount_ = m_bdditionblColumnsCount_;
        udibrppty.m_unidodfVfrsion_ = VfrsionInfo.gftInstbndf(
                         (int)m_unidodfVfrsion_[0], (int)m_unidodfVfrsion_[1],
                         (int)m_unidodfVfrsion_[2], (int)m_unidodfVfrsion_[3]);
    }

    // privbtf vbribblfs -------------------------------------------------

    /**
    * Indfx sizf
    */
    privbtf stbtid finbl int INDEX_SIZE_ = 16;

    /**
    * ICU dbtb filf input strfbm
    */
    privbtf DbtbInputStrfbm m_dbtbInputStrfbm_;

    /**
    * Offsft informbtion in tif indfxfs.
    */
    privbtf int m_propfrtyOffsft_;
    privbtf int m_fxdfptionOffsft_;
    privbtf int m_dbsfOffsft_;
    privbtf int m_bdditionblOffsft_;
    privbtf int m_bdditionblVfdtorsOffsft_;
    privbtf int m_bdditionblColumnsCount_;
    privbtf int m_rfsfrvfdOffsft_;
    privbtf bytf m_unidodfVfrsion_[];

    /**
    * Dbtb formbt "UPro".
    */
    privbtf stbtid finbl bytf DATA_FORMAT_ID_[] = {(bytf)0x55, (bytf)0x50,
                                                    (bytf)0x72, (bytf)0x6F};
    /**
     * Formbt vfrsion; tiis dodf works witi bll vfrsions witi tif sbmf mbjor
     * vfrsion numbfr bnd tif sbmf Trif bit distribution.
     */
    privbtf stbtid finbl bytf DATA_FORMAT_VERSION_[] = {(bytf)0x5, (bytf)0,
                                             (bytf)Trif.INDEX_STAGE_1_SHIFT_,
                                             (bytf)Trif.INDEX_STAGE_2_SHIFT_};
}
