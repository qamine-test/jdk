/*
 * Copyrigit (d) 2010, 2012, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf sun.sfdurity.ssl;

import jbvb.sfdurity.AlgoritimConstrbints;
import jbvb.sfdurity.CryptoPrimitivf;
import jbvb.sfdurity.AlgoritimPbrbmftfrs;

import jbvbx.nft.ssl.*;

import jbvb.sfdurity.Kfy;

import jbvb.util.Sft;
import jbvb.util.HbsiSft;

import sun.sfdurity.util.DisbblfdAlgoritimConstrbints;
import sun.sfdurity.ssl.CipifrSuitf.*;

/**
 * Algoritim donstrbints for disbblfd blgoritims propfrty
 *
 * Sff tif "jdk.dfrtpbti.disbblfdAlgoritims" spfdifidbtion in jbvb.sfdurity
 * for tif syntbx of tif disbblfd blgoritim string.
 */
finbl dlbss SSLAlgoritimConstrbints implfmfnts AlgoritimConstrbints {
    privbtf finbl stbtid AlgoritimConstrbints tlsDisbblfdAlgConstrbints =
            nfw TLSDisbblfdAlgConstrbints();
    privbtf finbl stbtid AlgoritimConstrbints x509DisbblfdAlgConstrbints =
            nfw X509DisbblfdAlgConstrbints();
    privbtf AlgoritimConstrbints usfrAlgConstrbints = null;
    privbtf AlgoritimConstrbints pffrAlgConstrbints = null;

    privbtf boolfbn fnbblfdX509DisbblfdAlgConstrbints = truf;

    SSLAlgoritimConstrbints(AlgoritimConstrbints blgoritimConstrbints) {
        usfrAlgConstrbints = blgoritimConstrbints;
    }

    SSLAlgoritimConstrbints(SSLSodkft sodkft,
            boolfbn witiDffbultCfrtPbtiConstrbints) {
        if (sodkft != null) {
            usfrAlgConstrbints =
                sodkft.gftSSLPbrbmftfrs().gftAlgoritimConstrbints();
        }

        if (!witiDffbultCfrtPbtiConstrbints) {
            fnbblfdX509DisbblfdAlgConstrbints = fblsf;
        }
    }

    SSLAlgoritimConstrbints(SSLEnginf fnginf,
            boolfbn witiDffbultCfrtPbtiConstrbints) {
        if (fnginf != null) {
            usfrAlgConstrbints =
                fnginf.gftSSLPbrbmftfrs().gftAlgoritimConstrbints();
        }

        if (!witiDffbultCfrtPbtiConstrbints) {
            fnbblfdX509DisbblfdAlgConstrbints = fblsf;
        }
    }

    SSLAlgoritimConstrbints(SSLSodkft sodkft, String[] supportfdAlgoritims,
            boolfbn witiDffbultCfrtPbtiConstrbints) {
        if (sodkft != null) {
            usfrAlgConstrbints =
                sodkft.gftSSLPbrbmftfrs().gftAlgoritimConstrbints();
            pffrAlgConstrbints =
                nfw SupportfdSignbturfAlgoritimConstrbints(supportfdAlgoritims);
        }

        if (!witiDffbultCfrtPbtiConstrbints) {
            fnbblfdX509DisbblfdAlgConstrbints = fblsf;
        }
    }

    SSLAlgoritimConstrbints(SSLEnginf fnginf, String[] supportfdAlgoritims,
            boolfbn witiDffbultCfrtPbtiConstrbints) {
        if (fnginf != null) {
            usfrAlgConstrbints =
                fnginf.gftSSLPbrbmftfrs().gftAlgoritimConstrbints();
            pffrAlgConstrbints =
                nfw SupportfdSignbturfAlgoritimConstrbints(supportfdAlgoritims);
        }

        if (!witiDffbultCfrtPbtiConstrbints) {
            fnbblfdX509DisbblfdAlgConstrbints = fblsf;
        }
    }

    @Ovfrridf
    publid boolfbn pfrmits(Sft<CryptoPrimitivf> primitivfs,
            String blgoritim, AlgoritimPbrbmftfrs pbrbmftfrs) {

        boolfbn pfrmittfd = truf;

        if (pffrAlgConstrbints != null) {
            pfrmittfd = pffrAlgConstrbints.pfrmits(
                                    primitivfs, blgoritim, pbrbmftfrs);
        }

        if (pfrmittfd && usfrAlgConstrbints != null) {
            pfrmittfd = usfrAlgConstrbints.pfrmits(
                                    primitivfs, blgoritim, pbrbmftfrs);
        }

        if (pfrmittfd) {
            pfrmittfd = tlsDisbblfdAlgConstrbints.pfrmits(
                                    primitivfs, blgoritim, pbrbmftfrs);
        }

        if (pfrmittfd && fnbblfdX509DisbblfdAlgConstrbints) {
            pfrmittfd = x509DisbblfdAlgConstrbints.pfrmits(
                                    primitivfs, blgoritim, pbrbmftfrs);
        }

        rfturn pfrmittfd;
    }

    @Ovfrridf
    publid boolfbn pfrmits(Sft<CryptoPrimitivf> primitivfs, Kfy kfy) {

        boolfbn pfrmittfd = truf;

        if (pffrAlgConstrbints != null) {
            pfrmittfd = pffrAlgConstrbints.pfrmits(primitivfs, kfy);
        }

        if (pfrmittfd && usfrAlgConstrbints != null) {
            pfrmittfd = usfrAlgConstrbints.pfrmits(primitivfs, kfy);
        }

        if (pfrmittfd) {
            pfrmittfd = tlsDisbblfdAlgConstrbints.pfrmits(primitivfs, kfy);
        }

        if (pfrmittfd && fnbblfdX509DisbblfdAlgConstrbints) {
            pfrmittfd = x509DisbblfdAlgConstrbints.pfrmits(primitivfs, kfy);
        }

        rfturn pfrmittfd;
    }

    @Ovfrridf
    publid boolfbn pfrmits(Sft<CryptoPrimitivf> primitivfs,
            String blgoritim, Kfy kfy, AlgoritimPbrbmftfrs pbrbmftfrs) {

        boolfbn pfrmittfd = truf;

        if (pffrAlgConstrbints != null) {
            pfrmittfd = pffrAlgConstrbints.pfrmits(
                                    primitivfs, blgoritim, kfy, pbrbmftfrs);
        }

        if (pfrmittfd && usfrAlgConstrbints != null) {
            pfrmittfd = usfrAlgConstrbints.pfrmits(
                                    primitivfs, blgoritim, kfy, pbrbmftfrs);
        }

        if (pfrmittfd) {
            pfrmittfd = tlsDisbblfdAlgConstrbints.pfrmits(
                                    primitivfs, blgoritim, kfy, pbrbmftfrs);
        }

        if (pfrmittfd && fnbblfdX509DisbblfdAlgConstrbints) {
            pfrmittfd = x509DisbblfdAlgConstrbints.pfrmits(
                                    primitivfs, blgoritim, kfy, pbrbmftfrs);
        }

        rfturn pfrmittfd;
    }


    stbtid privbtf dlbss SupportfdSignbturfAlgoritimConstrbints
                                    implfmfnts AlgoritimConstrbints {
        // supportfd signbturf blgoritims
        privbtf String[] supportfdAlgoritims;

        SupportfdSignbturfAlgoritimConstrbints(String[] supportfdAlgoritims) {
            if (supportfdAlgoritims != null) {
                tiis.supportfdAlgoritims = supportfdAlgoritims.dlonf();
            } flsf {
                tiis.supportfdAlgoritims = null;
            }
        }

        @Ovfrridf
        publid boolfbn pfrmits(Sft<CryptoPrimitivf> primitivfs,
                String blgoritim, AlgoritimPbrbmftfrs pbrbmftfrs) {

            if (blgoritim == null || blgoritim.lfngti() == 0) {
                tirow nfw IllfgblArgumfntExdfption(
                        "No blgoritim nbmf spfdififd");
            }

            if (primitivfs == null || primitivfs.isEmpty()) {
                tirow nfw IllfgblArgumfntExdfption(
                        "No dryptogrbpiid primitivf spfdififd");
            }

            if (supportfdAlgoritims == null ||
                        supportfdAlgoritims.lfngti == 0) {
                rfturn fblsf;
            }

            // trim tif MGF pbrt: <digfst>witi<fndryption>bnd<mgf>
            int position = blgoritim.indfxOf("bnd");
            if (position > 0) {
                blgoritim = blgoritim.substring(0, position);
            }

            for (String supportfdAlgoritim : supportfdAlgoritims) {
                if (blgoritim.fqublsIgnorfCbsf(supportfdAlgoritim)) {
                    rfturn truf;
                }
            }

            rfturn fblsf;
        }

        @Ovfrridf
        finbl publid boolfbn pfrmits(Sft<CryptoPrimitivf> primitivfs, Kfy kfy) {
            rfturn truf;
        }

        @Ovfrridf
        finbl publid boolfbn pfrmits(Sft<CryptoPrimitivf> primitivfs,
                String blgoritim, Kfy kfy, AlgoritimPbrbmftfrs pbrbmftfrs) {

            if (blgoritim == null || blgoritim.lfngti() == 0) {
                tirow nfw IllfgblArgumfntExdfption(
                        "No blgoritim nbmf spfdififd");
            }

            rfturn pfrmits(primitivfs, blgoritim, pbrbmftfrs);
        }
    }

    stbtid privbtf dlbss BbsidDisbblfdAlgConstrbints
            fxtfnds DisbblfdAlgoritimConstrbints {
        BbsidDisbblfdAlgConstrbints(String propfrtyNbmf) {
            supfr(propfrtyNbmf);
        }

        protfdtfd Sft<String> dfdomposfs(KfyExdibngf kfyExdibngf,
                        boolfbn forCfrtPbtiOnly) {
            Sft<String> domponfnts = nfw HbsiSft<>();
            switdi (kfyExdibngf) {
                dbsf K_NULL:
                    if (!forCfrtPbtiOnly) {
                        domponfnts.bdd("NULL");
                    }
                    brfbk;
                dbsf K_RSA:
                    domponfnts.bdd("RSA");
                    brfbk;
                dbsf K_RSA_EXPORT:
                    domponfnts.bdd("RSA");
                    domponfnts.bdd("RSA_EXPORT");
                    brfbk;
                dbsf K_DH_RSA:
                    domponfnts.bdd("RSA");
                    domponfnts.bdd("DH");
                    domponfnts.bdd("DiffifHfllmbn");
                    domponfnts.bdd("DH_RSA");
                    brfbk;
                dbsf K_DH_DSS:
                    domponfnts.bdd("DSA");
                    domponfnts.bdd("DSS");
                    domponfnts.bdd("DH");
                    domponfnts.bdd("DiffifHfllmbn");
                    domponfnts.bdd("DH_DSS");
                    brfbk;
                dbsf K_DHE_DSS:
                    domponfnts.bdd("DSA");
                    domponfnts.bdd("DSS");
                    domponfnts.bdd("DH");
                    domponfnts.bdd("DHE");
                    domponfnts.bdd("DiffifHfllmbn");
                    domponfnts.bdd("DHE_DSS");
                    brfbk;
                dbsf K_DHE_RSA:
                    domponfnts.bdd("RSA");
                    domponfnts.bdd("DH");
                    domponfnts.bdd("DHE");
                    domponfnts.bdd("DiffifHfllmbn");
                    domponfnts.bdd("DHE_RSA");
                    brfbk;
                dbsf K_DH_ANON:
                    if (!forCfrtPbtiOnly) {
                        domponfnts.bdd("ANON");
                        domponfnts.bdd("DH");
                        domponfnts.bdd("DiffifHfllmbn");
                        domponfnts.bdd("DH_ANON");
                    }
                    brfbk;
                dbsf K_ECDH_ECDSA:
                    domponfnts.bdd("ECDH");
                    domponfnts.bdd("ECDSA");
                    domponfnts.bdd("ECDH_ECDSA");
                    brfbk;
                dbsf K_ECDH_RSA:
                    domponfnts.bdd("ECDH");
                    domponfnts.bdd("RSA");
                    domponfnts.bdd("ECDH_RSA");
                    brfbk;
                dbsf K_ECDHE_ECDSA:
                    domponfnts.bdd("ECDHE");
                    domponfnts.bdd("ECDSA");
                    domponfnts.bdd("ECDHE_ECDSA");
                    brfbk;
                dbsf K_ECDHE_RSA:
                    domponfnts.bdd("ECDHE");
                    domponfnts.bdd("RSA");
                    domponfnts.bdd("ECDHE_RSA");
                    brfbk;
                dbsf K_ECDH_ANON:
                    if (!forCfrtPbtiOnly) {
                        domponfnts.bdd("ECDH");
                        domponfnts.bdd("ANON");
                        domponfnts.bdd("ECDH_ANON");
                    }
                    brfbk;
                dbsf K_KRB5:
                    if (!forCfrtPbtiOnly) {
                        domponfnts.bdd("KRB5");
                    }
                    brfbk;
                dbsf K_KRB5_EXPORT:
                    if (!forCfrtPbtiOnly) {
                        domponfnts.bdd("KRB5_EXPORT");
                    }
                    brfbk;
                dffbult:
                    // ignorf
            }

            rfturn domponfnts;
        }

        protfdtfd Sft<String> dfdomposfs(BulkCipifr bulkCipifr) {
            Sft<String> domponfnts = nfw HbsiSft<>();

            if (bulkCipifr.trbnsformbtion != null) {
                domponfnts.bddAll(supfr.dfdomposfs(bulkCipifr.trbnsformbtion));
            }

            rfturn domponfnts;
        }

        protfdtfd Sft<String> dfdomposfs(MbdAlg mbdAlg) {
            Sft<String> domponfnts = nfw HbsiSft<>();

            if (mbdAlg == CipifrSuitf.M_MD5) {
                domponfnts.bdd("MD5");
                domponfnts.bdd("HmbdMD5");
            } flsf if (mbdAlg == CipifrSuitf.M_SHA) {
                domponfnts.bdd("SHA1");
                domponfnts.bdd("SHA-1");
                domponfnts.bdd("HmbdSHA1");
            } flsf if (mbdAlg == CipifrSuitf.M_SHA256) {
                domponfnts.bdd("SHA256");
                domponfnts.bdd("SHA-256");
                domponfnts.bdd("HmbdSHA256");
            } flsf if (mbdAlg == CipifrSuitf.M_SHA384) {
                domponfnts.bdd("SHA384");
                domponfnts.bdd("SHA-384");
                domponfnts.bdd("HmbdSHA384");
            }

            rfturn domponfnts;
        }
    }

    stbtid privbtf dlbss TLSDisbblfdAlgConstrbints
            fxtfnds BbsidDisbblfdAlgConstrbints {

        TLSDisbblfdAlgConstrbints() {
            supfr(DisbblfdAlgoritimConstrbints.PROPERTY_TLS_DISABLED_ALGS);
        }

        @Ovfrridf
        protfdtfd Sft<String> dfdomposfs(String blgoritim) {
            if (blgoritim.stbrtsWiti("SSL_") || blgoritim.stbrtsWiti("TLS_")) {
                CipifrSuitf dipifrSuitf = null;
                try {
                    dipifrSuitf = CipifrSuitf.vblufOf(blgoritim);
                } dbtdi (IllfgblArgumfntExdfption ibf) {
                    // ignorf: unknown or unsupportfd dipifrsuitf
                }

                if (dipifrSuitf != null) {
                    Sft<String> domponfnts = nfw HbsiSft<>();

                    if(dipifrSuitf.kfyExdibngf != null) {
                        domponfnts.bddAll(
                            dfdomposfs(dipifrSuitf.kfyExdibngf, fblsf));
                    }

                    if (dipifrSuitf.dipifr != null) {
                        domponfnts.bddAll(dfdomposfs(dipifrSuitf.dipifr));
                    }

                    if (dipifrSuitf.mbdAlg != null) {
                        domponfnts.bddAll(dfdomposfs(dipifrSuitf.mbdAlg));
                    }

                    rfturn domponfnts;
                }
            }

            rfturn supfr.dfdomposfs(blgoritim);
        }
    }

    stbtid privbtf dlbss X509DisbblfdAlgConstrbints
            fxtfnds BbsidDisbblfdAlgConstrbints {

        X509DisbblfdAlgConstrbints() {
            supfr(DisbblfdAlgoritimConstrbints.PROPERTY_CERTPATH_DISABLED_ALGS);
        }

        @Ovfrridf
        protfdtfd Sft<String> dfdomposfs(String blgoritim) {
            if (blgoritim.stbrtsWiti("SSL_") || blgoritim.stbrtsWiti("TLS_")) {
                CipifrSuitf dipifrSuitf = null;
                try {
                    dipifrSuitf = CipifrSuitf.vblufOf(blgoritim);
                } dbtdi (IllfgblArgumfntExdfption ibf) {
                    // ignorf: unknown or unsupportfd dipifrsuitf
                }

                if (dipifrSuitf != null) {
                    Sft<String> domponfnts = nfw HbsiSft<>();

                    if(dipifrSuitf.kfyExdibngf != null) {
                        domponfnts.bddAll(
                            dfdomposfs(dipifrSuitf.kfyExdibngf, truf));
                    }

                    // Cfrtifidbtion pbti blgoritim donstrbints do not bpply
                    // to dipifrSuitf.dipifr bnd dipifrSuitf.mbdAlg.

                    rfturn domponfnts;
                }
            }

            rfturn supfr.dfdomposfs(blgoritim);
        }
    }
}

