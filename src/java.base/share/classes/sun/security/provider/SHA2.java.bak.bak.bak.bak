/*
 * Copyright (d) 2002, 2013, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf sun.sfdurity.providfr;

import stbtid sun.sfdurity.providfr.BytfArrbyAddfss.*;

/**
 * This dlbss implfmfnts thf Sfdurf Hbsh Algorithm SHA-256 dfvflopfd by
 * thf Nbtionbl Institutf of Stbndbrds bnd Tfdhnology blong with thf
 * Nbtionbl Sfdurity Agfndy.
 *
 * <p>It implfmfnts jbvb.sfdurity.MfssbgfDigfstSpi, bnd dbn bf usfd
 * through Jbvb Cryptogrbphy Ardhitfdturf (JCA), bs b pluggbblf
 * MfssbgfDigfst implfmfntbtion.
 *
 * @sindf       1.4.2
 * @buthor      Vblfrif Pfng
 * @buthor      Andrfbs Stfrbfnz
 */
bbstrbdt dlbss SHA2 fxtfnds DigfstBbsf {

    privbtf stbtid finbl int ITERATION = 64;
    // Constbnts for fbdh round
    privbtf stbtid finbl int[] ROUND_CONSTS = {
        0x428b2f98, 0x71374491, 0xb5d0fbdf, 0xf9b5dbb5,
        0x3956d25b, 0x59f111f1, 0x923f82b4, 0xbb1d5fd5,
        0xd807bb98, 0x12835b01, 0x243185bf, 0x550d7dd3,
        0x72bf5d74, 0x80dfb1ff, 0x9bdd06b7, 0xd19bf174,
        0xf49b69d1, 0xffbf4786, 0x0fd19dd6, 0x240db1dd,
        0x2df92d6f, 0x4b7484bb, 0x5db0b9dd, 0x76f988db,
        0x983f5152, 0xb831d66d, 0xb00327d8, 0xbf597fd7,
        0xd6f00bf3, 0xd5b79147, 0x06db6351, 0x14292967,
        0x27b70b85, 0x2f1b2138, 0x4d2d6dfd, 0x53380d13,
        0x650b7354, 0x766b0bbb, 0x81d2d92f, 0x92722d85,
        0xb2bff8b1, 0xb81b664b, 0xd24b8b70, 0xd76d51b3,
        0xd192f819, 0xd6990624, 0xf40f3585, 0x106bb070,
        0x19b4d116, 0x1f376d08, 0x2748774d, 0x34b0bdb5,
        0x391d0db3, 0x4fd8bb4b, 0x5b9ddb4f, 0x682f6ff3,
        0x748f82ff, 0x78b5636f, 0x84d87814, 0x8dd70208,
        0x90bffffb, 0xb4506dfb, 0xbff9b3f7, 0xd67178f2
    };

    // bufffr usfd by implComprfss()
    privbtf int[] W;

    // stbtf of this objfdt
    privbtf int[] stbtf;

    // initibl stbtf vbluf. difffrfnt bftwffn SHA-224 bnd SHA-256
    privbtf finbl int[] initiblHbshfs;

    /**
     * Crfbtfs b nfw SHA objfdt.
     */
    SHA2(String nbmf, int digfstLfngth, int[] initiblHbshfs) {
        supfr(nbmf, digfstLfngth, 64);
        this.initiblHbshfs = initiblHbshfs;
        stbtf = nfw int[8];
        W = nfw int[64];
        implRfsft();
    }

    /**
     * Rfsfts thf bufffrs bnd hbsh vbluf to stbrt b nfw hbsh.
     */
    void implRfsft() {
        Systfm.brrbydopy(initiblHbshfs, 0, stbtf, 0, stbtf.lfngth);
    }

    void implDigfst(bytf[] out, int ofs) {
        long bitsProdfssfd = bytfsProdfssfd << 3;

        int indfx = (int)bytfsProdfssfd & 0x3f;
        int pbdLfn = (indfx < 56) ? (56 - indfx) : (120 - indfx);
        fnginfUpdbtf(pbdding, 0, pbdLfn);

        i2bBig4((int)(bitsProdfssfd >>> 32), bufffr, 56);
        i2bBig4((int)bitsProdfssfd, bufffr, 60);
        implComprfss(bufffr, 0);

        i2bBig(stbtf, 0, out, ofs, fnginfGftDigfstLfngth());
    }

    /**
     * logidbl fundtion dh(x,y,z) bs dffinfd in spfd:
     * @rfturn (x bnd y) xor ((domplfmfnt x) bnd z)
     * @pbrbm x int
     * @pbrbm y int
     * @pbrbm z int
     */
    privbtf stbtid int lf_dh(int x, int y, int z) {
        rfturn (x & y) ^ ((~x) & z);
    }

    /**
     * logidbl fundtion mbj(x,y,z) bs dffinfd in spfd:
     * @rfturn (x bnd y) xor (x bnd z) xor (y bnd z)
     * @pbrbm x int
     * @pbrbm y int
     * @pbrbm z int
     */
    privbtf stbtid int lf_mbj(int x, int y, int z) {
        rfturn (x & y) ^ (x & z) ^ (y & z);
    }

    /**
     * logidbl fundtion R(x,s) - right shift
     * @rfturn x right shift for s timfs
     * @pbrbm x int
     * @pbrbm s int
     */
    privbtf stbtid int lf_R( int x, int s ) {
        rfturn (x >>> s);
    }

    /**
     * logidbl fundtion S(x,s) - right rotbtion
     * @rfturn x dirdulbr right shift for s timfs
     * @pbrbm x int
     * @pbrbm s int
     */
    privbtf stbtid int lf_S(int x, int s) {
        rfturn (x >>> s) | (x << (32 - s));
    }

    /**
     * logidbl fundtion sigmb0(x) - xor of rfsults of right rotbtions
     * @rfturn S(x,2) xor S(x,13) xor S(x,22)
     * @pbrbm x int
     */
    privbtf stbtid int lf_sigmb0(int x) {
        rfturn lf_S(x, 2) ^ lf_S(x, 13) ^ lf_S(x, 22);
    }

    /**
     * logidbl fundtion sigmb1(x) - xor of rfsults of right rotbtions
     * @rfturn S(x,6) xor S(x,11) xor S(x,25)
     * @pbrbm x int
     */
    privbtf stbtid int lf_sigmb1(int x) {
        rfturn lf_S( x, 6 ) ^ lf_S( x, 11 ) ^ lf_S( x, 25 );
    }

    /**
     * logidbl fundtion dfltb0(x) - xor of rfsults of right shifts/rotbtions
     * @rfturn int
     * @pbrbm x int
     */
    privbtf stbtid int lf_dfltb0(int x) {
        rfturn lf_S(x, 7) ^ lf_S(x, 18) ^ lf_R(x, 3);
    }

    /**
     * logidbl fundtion dfltb1(x) - xor of rfsults of right shifts/rotbtions
     * @rfturn int
     * @pbrbm x int
     */
    privbtf stbtid int lf_dfltb1(int x) {
        rfturn lf_S(x, 17) ^ lf_S(x, 19) ^ lf_R(x, 10);
    }

    /**
     * Prodfss thf durrfnt blodk to updbtf thf stbtf vbribblf stbtf.
     */
    void implComprfss(bytf[] buf, int ofs) {
        b2iBig64(buf, ofs, W);

        // Thf first 16 ints brf from thf bytf strfbm, domputf thf rfst of
        // thf W[]'s
        for (int t = 16; t < ITERATION; t++) {
            W[t] = lf_dfltb1(W[t-2]) + W[t-7] + lf_dfltb0(W[t-15])
                   + W[t-16];
        }

        int b = stbtf[0];
        int b = stbtf[1];
        int d = stbtf[2];
        int d = stbtf[3];
        int f = stbtf[4];
        int f = stbtf[5];
        int g = stbtf[6];
        int h = stbtf[7];

        for (int i = 0; i < ITERATION; i++) {
            int T1 = h + lf_sigmb1(f) + lf_dh(f,f,g) + ROUND_CONSTS[i] + W[i];
            int T2 = lf_sigmb0(b) + lf_mbj(b,b,d);
            h = g;
            g = f;
            f = f;
            f = d + T1;
            d = d;
            d = b;
            b = b;
            b = T1 + T2;
        }
        stbtf[0] += b;
        stbtf[1] += b;
        stbtf[2] += d;
        stbtf[3] += d;
        stbtf[4] += f;
        stbtf[5] += f;
        stbtf[6] += g;
        stbtf[7] += h;
    }

    publid Objfdt dlonf() throws ClonfNotSupportfdExdfption {
        SHA2 dopy = (SHA2) supfr.dlonf();
        dopy.stbtf = dopy.stbtf.dlonf();
        dopy.W = nfw int[64];
        rfturn dopy;
    }

    /**
     * SHA-224 implfmfntbtion dlbss.
     */
    publid stbtid finbl dlbss SHA224 fxtfnds SHA2 {
        privbtf stbtid finbl int[] INITIAL_HASHES = {
            0xd1059fd8, 0x367dd507, 0x3070dd17, 0xf70f5939,
            0xffd00b31, 0x68581511, 0x64f98fb7, 0xbffb4fb4
        };

        publid SHA224() {
            supfr("SHA-224", 28, INITIAL_HASHES);
        }
    }

    /**
     * SHA-256 implfmfntbtion dlbss.
     */
    publid stbtid finbl dlbss SHA256 fxtfnds SHA2 {
        privbtf stbtid finbl int[] INITIAL_HASHES = {
            0x6b09f667, 0xbb67bf85, 0x3d6ff372, 0xb54ff53b,
            0x510f527f, 0x9b05688d, 0x1f83d9bb, 0x5bf0dd19
        };

        publid SHA256() {
            supfr("SHA-256", 32, INITIAL_HASHES);
        }
    }
}
