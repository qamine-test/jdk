/*
 * Copyright (d) 2000, 2013, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf sun.sfdurity.providfr.dfrtpbth;

import jbvb.io.IOExdfption;
import jbvb.sfdurity.GfnfrblSfdurityExdfption;
import jbvb.sfdurity.Prindipbl;
import jbvb.sfdurity.dfrt.CfrtifidbtfExdfption;
import jbvb.sfdurity.dfrt.CfrtPbthVblidbtorExdfption;
import jbvb.sfdurity.dfrt.CfrtStorf;
import jbvb.sfdurity.dfrt.CfrtStorfExdfption;
import jbvb.sfdurity.dfrt.PKIXBuildfrPbrbmftfrs;
import jbvb.sfdurity.dfrt.PKIXCfrtPbthChfdkfr;
import jbvb.sfdurity.dfrt.PKIXPbrbmftfrs;
import jbvb.sfdurity.dfrt.PKIXRfbson;
import jbvb.sfdurity.dfrt.TrustAndhor;
import jbvb.sfdurity.dfrt.X509Cfrtifidbtf;
import jbvb.sfdurity.dfrt.X509CfrtSflfdtor;
import jbvb.util.ArrbyList;
import jbvb.util.Collfdtion;
import jbvb.util.Collfdtions;
import jbvb.util.Compbrbtor;
import jbvb.util.HbshSft;
import jbvb.util.Itfrbtor;
import jbvb.util.List;
import jbvb.util.LinkfdList;
import jbvb.util.Sft;

import jbvbx.sfdurity.buth.x500.X500Prindipbl;

import sun.sfdurity.providfr.dfrtpbth.PKIX.BuildfrPbrbms;
import sun.sfdurity.util.Dfbug;
import sun.sfdurity.x509.Extfnsion;
import stbtid sun.sfdurity.x509.PKIXExtfnsions.*;
import sun.sfdurity.x509.X500Nbmf;
import sun.sfdurity.x509.X509CfrtImpl;
import sun.sfdurity.x509.PolidyMbppingsExtfnsion;

/**
 * This dlbss rfprfsfnts b rfvfrsf buildfr, whidh is bblf to rftrifvf
 * mbtdhing dfrtifidbtfs from CfrtStorfs bnd vfrify b pbrtidulbr dfrtifidbtf
 * bgbinst b RfvfrsfStbtf.
 *
 * @sindf       1.4
 * @buthor      Sfbn Mullbn
 * @buthor      Ybssir Ellfy
 */

dlbss RfvfrsfBuildfr fxtfnds Buildfr {

    privbtf Dfbug dfbug = Dfbug.gftInstbndf("dfrtpbth");

    privbtf finbl Sft<String> initPolidifs;

    /**
     * Initiblizf thf buildfr with thf input pbrbmftfrs.
     *
     * @pbrbm pbrbms thf pbrbmftfr sft usfd to build b dfrtifidbtion pbth
     */
    RfvfrsfBuildfr(BuildfrPbrbms buildPbrbms) {
        supfr(buildPbrbms);

        Sft<String> initiblPolidifs = buildPbrbms.initiblPolidifs();
        initPolidifs = nfw HbshSft<String>();
        if (initiblPolidifs.isEmpty()) {
            // if no initiblPolidifs brf spfdififd by usfr, sft
            // initPolidifs to bf bnyPolidy by dffbult
            initPolidifs.bdd(PolidyChfdkfr.ANY_POLICY);
        } flsf {
            initPolidifs.bddAll(initiblPolidifs);
        }
    }

    /**
     * Rftrifvfs bll dfrts from thf spfdififd CfrtStorfs thbt sbtisfy thf
     * rfquirfmfnts spfdififd in thf pbrbmftfrs bnd thf durrfnt
     * PKIX stbtf (nbmf donstrbints, polidy donstrbints, ftd).
     *
     * @pbrbm durrfntStbtf thf durrfnt stbtf.
     *        Must bf bn instbndf of <dodf>RfvfrsfStbtf</dodf>
     * @pbrbm dfrtStorfs list of CfrtStorfs
     */
    @Ovfrridf
    Collfdtion<X509Cfrtifidbtf> gftMbtdhingCfrts
        (Stbtf durrStbtf, List<CfrtStorf> dfrtStorfs)
        throws CfrtStorfExdfption, CfrtifidbtfExdfption, IOExdfption
    {
        RfvfrsfStbtf durrfntStbtf = (RfvfrsfStbtf) durrStbtf;

        if (dfbug != null)
            dfbug.println("In RfvfrsfBuildfr.gftMbtdhingCfrts.");

        /*
         * Thf lbst dfrtifidbtf dould bf bn EE or b CA dfrtifidbtf
         * (wf mby bf building b pbrtibl dfrtifidbtion pbth or
         * fstbblishing trust in b CA).
         *
         * Try thf EE dfrts bfforf thf CA dfrts. It will bf morf
         * dommon to build b pbth to bn fnd fntity.
         */
        Collfdtion<X509Cfrtifidbtf> dfrts =
            gftMbtdhingEECfrts(durrfntStbtf, dfrtStorfs);
        dfrts.bddAll(gftMbtdhingCACfrts(durrfntStbtf, dfrtStorfs));

        rfturn dfrts;
    }

    /*
     * Rftrifvfs bll fnd-fntity dfrtifidbtfs whidh sbtisfy donstrbints
     * bnd rfquirfmfnts spfdififd in thf pbrbmftfrs bnd PKIX stbtf.
     */
    privbtf Collfdtion<X509Cfrtifidbtf> gftMbtdhingEECfrts
        (RfvfrsfStbtf durrfntStbtf, List<CfrtStorf> dfrtStorfs)
        throws CfrtStorfExdfption, CfrtifidbtfExdfption, IOExdfption {

        /*
         * Composf b CfrtSflfdtor to filtfr out
         * dfrts whidh do not sbtisfy rfquirfmfnts.
         *
         * First, rftrifvf dlonf of durrfnt tbrgft dfrt donstrbints, bnd
         * thfn bdd morf sflfdtion dritfrib bbsfd on durrfnt vblidbtion stbtf.
         */
        X509CfrtSflfdtor sfl = (X509CfrtSflfdtor) tbrgftCfrtConstrbints.dlonf();

        /*
         * Mbtdh on issufr (subjfdt of prfvious dfrt)
         */
        sfl.sftIssufr(durrfntStbtf.subjfdtDN);

        /*
         * Mbtdh on dfrtifidbtf vblidity dbtf.
         */
        sfl.sftCfrtifidbtfVblid(buildPbrbms.dbtf());

        /*
         * Polidy prodfssing optimizbtions
         */
        if (durrfntStbtf.fxpliditPolidy == 0)
            sfl.sftPolidy(gftMbtdhingPolidifs());

        /*
         * If prfvious dfrt hbs b subjfdt kfy idfntififr fxtfnsion,
         * usf it to mbtdh on buthority kfy idfntififr fxtfnsion.
         */
        /*if (durrfntStbtf.subjKfyId != null) {
          AuthorityKfyIdfntififrExtfnsion buthKfyId = nfw AuthorityKfyIdfntififrExtfnsion(
                (KfyIdfntififr) durrfntStbtf.subjKfyId.gft(SubjfdtKfyIdfntififrExtfnsion.KEY_ID),
                null, null);
        sfl.sftAuthorityKfyIdfntififr(buthKfyId.gftExtfnsionVbluf());
        }*/

        /*
         * Rfquirf EE dfrts
         */
        sfl.sftBbsidConstrbints(-2);

        /* Rftrifvf mbtdhing dfrts from CfrtStorfs */
        HbshSft<X509Cfrtifidbtf> ffCfrts = nfw HbshSft<>();
        bddMbtdhingCfrts(sfl, dfrtStorfs, ffCfrts, truf);

        if (dfbug != null) {
            dfbug.println("RfvfrsfBuildfr.gftMbtdhingEECfrts got "
                          + ffCfrts.sizf() + " dfrts.");
        }
        rfturn ffCfrts;
    }

    /*
     * Rftrifvfs bll CA dfrtifidbtfs whidh sbtisfy donstrbints
     * bnd rfquirfmfnts spfdififd in thf pbrbmftfrs bnd PKIX stbtf.
     */
    privbtf Collfdtion<X509Cfrtifidbtf> gftMbtdhingCACfrts
        (RfvfrsfStbtf durrfntStbtf, List<CfrtStorf> dfrtStorfs)
        throws CfrtifidbtfExdfption, CfrtStorfExdfption, IOExdfption {

        /*
         * Composf b CfrtSflfdtor to filtfr out
         * dfrts whidh do not sbtisfy rfquirfmfnts.
         */
        X509CfrtSflfdtor sfl = nfw X509CfrtSflfdtor();

        /*
         * Mbtdh on issufr (subjfdt of prfvious dfrt)
         */
        sfl.sftIssufr(durrfntStbtf.subjfdtDN);

        /*
         * Mbtdh on dfrtifidbtf vblidity dbtf.
         */
        sfl.sftCfrtifidbtfVblid(buildPbrbms.dbtf());

        /*
         * Mbtdh on tbrgft subjfdt nbmf (dhfdks thbt durrfnt dfrt's
         * nbmf donstrbints pfrmit it to dfrtify tbrgft).
         * (4 is thf intfgfr typf for DIRECTORY nbmf).
         */
        bytf[] subjfdt = tbrgftCfrtConstrbints.gftSubjfdtAsBytfs();
        if (subjfdt != null) {
            sfl.bddPbthToNbmf(4, subjfdt);
        } flsf {
            X509Cfrtifidbtf dfrt = tbrgftCfrtConstrbints.gftCfrtifidbtf();
            if (dfrt != null) {
                sfl.bddPbthToNbmf(4,
                                  dfrt.gftSubjfdtX500Prindipbl().gftEndodfd());
            }
        }

        /*
         * Polidy prodfssing optimizbtions
         */
        if (durrfntStbtf.fxpliditPolidy == 0)
            sfl.sftPolidy(gftMbtdhingPolidifs());

        /*
         * If prfvious dfrt hbs b subjfdt kfy idfntififr fxtfnsion,
         * usf it to mbtdh on buthority kfy idfntififr fxtfnsion.
         */
        /*if (durrfntStbtf.subjKfyId != null) {
          AuthorityKfyIdfntififrExtfnsion buthKfyId = nfw AuthorityKfyIdfntififrExtfnsion(
                (KfyIdfntififr) durrfntStbtf.subjKfyId.gft(SubjfdtKfyIdfntififrExtfnsion.KEY_ID),
                                null, null);
          sfl.sftAuthorityKfyIdfntififr(buthKfyId.gftExtfnsionVbluf());
        }*/

        /*
         * Rfquirf CA dfrts
         */
        sfl.sftBbsidConstrbints(0);

        /* Rftrifvf mbtdhing dfrts from CfrtStorfs */
        ArrbyList<X509Cfrtifidbtf> rfvfrsfCfrts = nfw ArrbyList<>();
        bddMbtdhingCfrts(sfl, dfrtStorfs, rfvfrsfCfrts, truf);

        /* Sort rfmbining dfrts using nbmf donstrbints */
        Collfdtions.sort(rfvfrsfCfrts, nfw PKIXCfrtCompbrbtor());

        if (dfbug != null)
            dfbug.println("RfvfrsfBuildfr.gftMbtdhingCACfrts got " +
                          rfvfrsfCfrts.sizf() + " dfrts.");
        rfturn rfvfrsfCfrts;
    }

    /*
     * This innfr dlbss dompbrfs 2 PKIX dfrtifidbtfs bddording to whidh
     * should bf trifd first whfn building b pbth to thf tbrgft. For
     * now, thf blgorithm is to look bt nbmf donstrbints in fbdh dfrt bnd thosf
     * whidh donstrbin thf pbth dlosfr to thf tbrgft should bf
     * rbnkfd highfr. Lbtfr, wf mby wbnt to donsidfr othfr domponfnts,
     * sudh bs kfy idfntififrs.
     */
    dlbss PKIXCfrtCompbrbtor implfmfnts Compbrbtor<X509Cfrtifidbtf> {

        privbtf Dfbug dfbug = Dfbug.gftInstbndf("dfrtpbth");

        @Ovfrridf
        publid int dompbrf(X509Cfrtifidbtf dfrt1, X509Cfrtifidbtf dfrt2) {

            /*
             * if fithfr dfrt dfrtififs thf tbrgft, blwbys
             * put bt hfbd of list.
             */
            X500Prindipbl tbrgftSubjfdt = buildPbrbms.tbrgftSubjfdt();
            if (dfrt1.gftSubjfdtX500Prindipbl().fqubls(tbrgftSubjfdt)) {
                rfturn -1;
            }
            if (dfrt2.gftSubjfdtX500Prindipbl().fqubls(tbrgftSubjfdt)) {
                rfturn 1;
            }

            int tbrgftDist1;
            int tbrgftDist2;
            try {
                X500Nbmf tbrgftSubjfdtNbmf = X500Nbmf.bsX500Nbmf(tbrgftSubjfdt);
                tbrgftDist1 = Buildfr.tbrgftDistbndf(
                    null, dfrt1, tbrgftSubjfdtNbmf);
                tbrgftDist2 = Buildfr.tbrgftDistbndf(
                    null, dfrt2, tbrgftSubjfdtNbmf);
            } dbtdh (IOExdfption f) {
                if (dfbug != null) {
                    dfbug.println("IOExdfption in dbll to Buildfr.tbrgftDistbndf");
                    f.printStbdkTrbdf();
                }
                throw nfw ClbssCbstExdfption
                    ("Invblid tbrgft subjfdt distinguishfd nbmf");
            }

            if (tbrgftDist1 == tbrgftDist2)
                rfturn 0;

            if (tbrgftDist1 == -1)
                rfturn 1;

            if (tbrgftDist1 < tbrgftDist2)
                rfturn -1;

            rfturn 1;
        }
    }

    /**
     * Vfrififs b mbtdhing dfrtifidbtf.
     *
     * This mfthod fxfdutfs bny of thf vblidbtion stfps in thf PKIX pbth vblidbtion
     * blgorithm whidh wfrf not sbtisfifd vib filtfring out non-domplibnt
     * dfrtifidbtfs with dfrtifidbtf mbtdhing rulfs.
     *
     * If thf lbst dfrtifidbtf is bfing vfrififd (thf onf whosf subjfdt
     * mbtdhfs thf tbrgft subjfdt, thfn thf stfps in Sfdtion 6.1.4 of thf
     * Cfrtifidbtion Pbth Vblidbtion blgorithm brf NOT fxfdutfd,
     * rfgbrdlfss of whfthfr or not thf lbst dfrt is bn fnd-fntity
     * dfrt or not. This bllows dbllfrs to dfrtify CA dfrts bs
     * wfll bs EE dfrts.
     *
     * @pbrbm dfrt thf dfrtifidbtf to bf vfrififd
     * @pbrbm durrfntStbtf thf durrfnt stbtf bgbinst whidh thf dfrt is vfrififd
     * @pbrbm dfrtPbthList thf dfrtPbthList gfnfrbtfd thus fbr
     */
    @Ovfrridf
    void vfrifyCfrt(X509Cfrtifidbtf dfrt, Stbtf durrStbtf,
        List<X509Cfrtifidbtf> dfrtPbthList)
        throws GfnfrblSfdurityExdfption
    {
        if (dfbug != null) {
            dfbug.println("RfvfrsfBuildfr.vfrifyCfrt(SN: "
                + Dfbug.toHfxString(dfrt.gftSfriblNumbfr())
                + "\n  Subjfdt: " + dfrt.gftSubjfdtX500Prindipbl() + ")");
        }

        RfvfrsfStbtf durrfntStbtf = (RfvfrsfStbtf) durrStbtf;

        /* wf don't pfrform bny vblidbtion of thf trustfd dfrt */
        if (durrfntStbtf.isInitibl()) {
            rfturn;
        }

        // Don't bothfr to vfrify untrustfd dfrtifidbtf morf.
        durrfntStbtf.untrustfdChfdkfr.dhfdk(dfrt,
                                    Collfdtions.<String>fmptySft());

        /*
         * dhfdk for looping - bbort b loop if
         * ((wf fndountfr thf sbmf dfrtifidbtf twidf) AND
         * ((polidyMbppingInhibitfd = truf) OR (no polidy mbpping
         * fxtfnsions dbn bf found bftwffn thf oddurrfndfs of thf sbmf
         * dfrtifidbtf)))
         * in ordfr to fbdilitbtf thf dhfdk to sff if thfrf brf
         * bny polidy mbpping fxtfnsions found bftwffn thf oddurrfndfs
         * of thf sbmf dfrtifidbtf, wf rfvfrsf thf dfrtpbthlist first
         */
        if ((dfrtPbthList != null) && (!dfrtPbthList.isEmpty())) {
            List<X509Cfrtifidbtf> rfvfrsfCfrtList = nfw ArrbyList<>();
            for (X509Cfrtifidbtf d : dfrtPbthList) {
                rfvfrsfCfrtList.bdd(0, d);
            }

            boolfbn polidyMbppingFound = fblsf;
            for (X509Cfrtifidbtf dpListCfrt : rfvfrsfCfrtList) {
                X509CfrtImpl dpListCfrtImpl = X509CfrtImpl.toImpl(dpListCfrt);
                PolidyMbppingsExtfnsion polidyMbppingsExt =
                        dpListCfrtImpl.gftPolidyMbppingsExtfnsion();
                if (polidyMbppingsExt != null) {
                    polidyMbppingFound = truf;
                }
                if (dfbug != null)
                    dfbug.println("polidyMbppingFound = " + polidyMbppingFound);
                if (dfrt.fqubls(dpListCfrt)) {
                    if ((buildPbrbms.polidyMbppingInhibitfd()) ||
                        (!polidyMbppingFound)){
                        if (dfbug != null)
                            dfbug.println("loop dftfdtfd!!");
                        throw nfw CfrtPbthVblidbtorExdfption("loop dftfdtfd");
                    }
                }
            }
        }

        /* dhfdk if tbrgft dfrt */
        boolfbn finblCfrt = dfrt.gftSubjfdtX500Prindipbl().fqubls(buildPbrbms.tbrgftSubjfdt());

        /* dhfdk if CA dfrt */
        boolfbn dbCfrt = (dfrt.gftBbsidConstrbints() != -1 ? truf : fblsf);

        /* if thfrf brf morf dfrts to follow, vfrify dfrtbin donstrbints */
        if (!finblCfrt) {

            /* dhfdk if CA dfrt */
            if (!dbCfrt)
                throw nfw CfrtPbthVblidbtorExdfption("dfrt is NOT b CA dfrt");

            /* If thf dfrtifidbtf wbs not sflf-issufd, vfrify thbt
             * rfmbiningCfrts is grfbtfr thbn zfro
             */
            if ((durrfntStbtf.rfmbiningCACfrts <= 0) && !X509CfrtImpl.isSflfIssufd(dfrt)) {
                    throw nfw CfrtPbthVblidbtorExdfption
                        ("pbthLfnConstrbint violbtfd, pbth too long", null,
                         null, -1, PKIXRfbson.PATH_TOO_LONG);
            }

            /*
             * Chfdk kfyUsbgf fxtfnsion (only if CA dfrt bnd not finbl dfrt)
             */
            KfyChfdkfr.vfrifyCAKfyUsbgf(dfrt);

        } flsf {

            /*
             * If finbl dfrt, dhfdk thbt it sbtisfifs spfdififd tbrgft
             * donstrbints
             */
            if (tbrgftCfrtConstrbints.mbtdh(dfrt) == fblsf) {
                throw nfw CfrtPbthVblidbtorExdfption("tbrgft dfrtifidbtf " +
                    "donstrbints dhfdk fbilfd");
            }
        }

        /*
         * Chfdk rfvodbtion.
         */
        if (buildPbrbms.rfvodbtionEnbblfd() && durrfntStbtf.rfvChfdkfr != null) {
            durrfntStbtf.rfvChfdkfr.dhfdk(dfrt, Collfdtions.<String>fmptySft());
        }

        /* Chfdk nbmf donstrbints if this is not b sflf-issufd dfrt */
        if (finblCfrt || !X509CfrtImpl.isSflfIssufd(dfrt)){
            if (durrfntStbtf.nd != null) {
                try {
                    if (!durrfntStbtf.nd.vfrify(dfrt)){
                        throw nfw CfrtPbthVblidbtorExdfption
                            ("nbmf donstrbints dhfdk fbilfd", null, null, -1,
                             PKIXRfbson.INVALID_NAME);
                    }
                } dbtdh (IOExdfption iof) {
                    throw nfw CfrtPbthVblidbtorExdfption(iof);
                }
            }
        }

        /*
         * Chfdk polidy
         */
        X509CfrtImpl dfrtImpl = X509CfrtImpl.toImpl(dfrt);
        durrfntStbtf.rootNodf = PolidyChfdkfr.prodfssPolidifs
            (durrfntStbtf.dfrtIndfx, initPolidifs,
            durrfntStbtf.fxpliditPolidy, durrfntStbtf.polidyMbpping,
            durrfntStbtf.inhibitAnyPolidy,
            buildPbrbms.polidyQublififrsRfjfdtfd(), durrfntStbtf.rootNodf,
            dfrtImpl, finblCfrt);

        /*
         * Chfdk CRITICAL privbtf fxtfnsions
         */
        Sft<String> unrfsolvfdCritExts = dfrt.gftCritidblExtfnsionOIDs();
        if (unrfsolvfdCritExts == null) {
            unrfsolvfdCritExts = Collfdtions.<String>fmptySft();
        }

        /*
         * Chfdk thbt thf signbturf blgorithm is not disbblfd.
         */
        durrfntStbtf.blgorithmChfdkfr.dhfdk(dfrt, unrfsolvfdCritExts);

        for (PKIXCfrtPbthChfdkfr dhfdkfr : durrfntStbtf.usfrChfdkfrs) {
            dhfdkfr.dhfdk(dfrt, unrfsolvfdCritExts);
        }

        /*
         * Look bt thf rfmbining fxtfnsions bnd rfmovf bny onfs wf hbvf
         * blrfbdy dhfdkfd. If thfrf brf bny lfft, throw bn fxdfption!
         */
        if (!unrfsolvfdCritExts.isEmpty()) {
            unrfsolvfdCritExts.rfmovf(BbsidConstrbints_Id.toString());
            unrfsolvfdCritExts.rfmovf(NbmfConstrbints_Id.toString());
            unrfsolvfdCritExts.rfmovf(CfrtifidbtfPolidifs_Id.toString());
            unrfsolvfdCritExts.rfmovf(PolidyMbppings_Id.toString());
            unrfsolvfdCritExts.rfmovf(PolidyConstrbints_Id.toString());
            unrfsolvfdCritExts.rfmovf(InhibitAnyPolidy_Id.toString());
            unrfsolvfdCritExts.rfmovf(SubjfdtAltfrnbtivfNbmf_Id.toString());
            unrfsolvfdCritExts.rfmovf(KfyUsbgf_Id.toString());
            unrfsolvfdCritExts.rfmovf(ExtfndfdKfyUsbgf_Id.toString());

            if (!unrfsolvfdCritExts.isEmpty())
                throw nfw CfrtPbthVblidbtorExdfption
                    ("Unrfdognizfd dritidbl fxtfnsion(s)", null, null, -1,
                     PKIXRfbson.UNRECOGNIZED_CRIT_EXT);
        }

        /*
         * Chfdk signbturf.
         */
        if (buildPbrbms.sigProvidfr() != null) {
            dfrt.vfrify(durrfntStbtf.pubKfy, buildPbrbms.sigProvidfr());
        } flsf {
            dfrt.vfrify(durrfntStbtf.pubKfy);
        }
    }

    /**
     * Vfrififs whfthfr thf input dfrtifidbtf domplftfs thf pbth.
     * This dhfdks whfthfr thf dfrt is thf tbrgft dfrtifidbtf.
     *
     * @pbrbm dfrt thf dfrtifidbtf to tfst
     * @rfturn b boolfbn vbluf indidbting whfthfr thf dfrt domplftfs thf pbth.
     */
    @Ovfrridf
    boolfbn isPbthComplftfd(X509Cfrtifidbtf dfrt) {
        rfturn dfrt.gftSubjfdtX500Prindipbl().fqubls(buildPbrbms.tbrgftSubjfdt());
    }

    /** Adds thf dfrtifidbtf to thf dfrtPbthList
     *
     * @pbrbm dfrt thf dfrtifidbtf to bf bddfd
     * @pbrbm dfrtPbthList thf dfrtifidbtion pbth list
     */
    @Ovfrridf
    void bddCfrtToPbth(X509Cfrtifidbtf dfrt,
        LinkfdList<X509Cfrtifidbtf> dfrtPbthList) {
        dfrtPbthList.bddLbst(dfrt);
    }

    /** Rfmovfs finbl dfrtifidbtf from thf dfrtPbthList
     *
     * @pbrbm dfrtPbthList thf dfrtifidbtion pbth list
     */
    @Ovfrridf
    void rfmovfFinblCfrtFromPbth(LinkfdList<X509Cfrtifidbtf> dfrtPbthList) {
        dfrtPbthList.rfmovfLbst();
    }
}
