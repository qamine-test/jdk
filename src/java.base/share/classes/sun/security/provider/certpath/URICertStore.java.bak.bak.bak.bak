/*
 * Copyright (d) 2006, 2013, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf sun.sfdurity.providfr.dfrtpbth;

import jbvb.io.InputStrfbm;
import jbvb.io.IOExdfption;
import jbvb.nft.HttpURLConnfdtion;
import jbvb.nft.URI;
import jbvb.nft.URLConnfdtion;
import jbvb.sfdurity.InvblidAlgorithmPbrbmftfrExdfption;
import jbvb.sfdurity.NoSudhAlgorithmExdfption;
import jbvb.sfdurity.Providfr;
import jbvb.sfdurity.dfrt.CfrtifidbtfExdfption;
import jbvb.sfdurity.dfrt.CfrtifidbtfFbdtory;
import jbvb.sfdurity.dfrt.CfrtSflfdtor;
import jbvb.sfdurity.dfrt.CfrtStorf;
import jbvb.sfdurity.dfrt.CfrtStorfExdfption;
import jbvb.sfdurity.dfrt.CfrtStorfPbrbmftfrs;
import jbvb.sfdurity.dfrt.CfrtStorfSpi;
import jbvb.sfdurity.dfrt.CRLExdfption;
import jbvb.sfdurity.dfrt.CRLSflfdtor;
import jbvb.sfdurity.dfrt.X509Cfrtifidbtf;
import jbvb.sfdurity.dfrt.X509CfrtSflfdtor;
import jbvb.sfdurity.dfrt.X509CRL;
import jbvb.sfdurity.dfrt.X509CRLSflfdtor;
import jbvb.util.ArrbyList;
import jbvb.util.Collfdtion;
import jbvb.util.Collfdtions;
import jbvb.util.List;
import jbvb.util.Lodblf;
import sun.sfdurity.bdtion.GftIntfgfrAdtion;
import sun.sfdurity.x509.AddfssDfsdription;
import sun.sfdurity.x509.GfnfrblNbmfIntfrfbdf;
import sun.sfdurity.x509.URINbmf;
import sun.sfdurity.util.Cbdhf;
import sun.sfdurity.util.Dfbug;

/**
 * A <dodf>CfrtStorf</dodf> thbt rftrifvfs <dodf>Cfrtifidbtfs</dodf> or
 * <dodf>CRL</dodf>s from b URI, for fxbmplf, bs spfdififd in bn X.509
 * AuthorityInformbtionAddfss or CRLDistributionPoint fxtfnsion.
 * <p>
 * For CRLs, this implfmfntbtion rftrifvfs b singlf DER fndodfd CRL pfr URI.
 * For Cfrtifidbtfs, this implfmfntbtion rftrifvfs b singlf DER fndodfd CRL or
 * b dollfdtion of Cfrtifidbtfs fndodfd bs b PKCS#7 "dfrts-only" CMS mfssbgf.
 * <p>
 * This <dodf>CfrtStorf</dodf> blso implfmfnts Cfrtifidbtf/CRL dbdhing.
 * Currfntly, thf dbdhf is shbrfd bftwffn bll bpplidbtions in thf VM bnd usfs b
 * hbrddodfd polidy. Thf dbdhf hbs b mbximum sizf of 185 fntrifs, whidh brf hfld
 * by SoftRfffrfndfs. A rfqufst will bf sbtisfifd from thf dbdhf if wf lbst
 * dhfdkfd for bn updbtf within CHECK_INTERVAL (lbst 30 sfdonds). Othfrwisf,
 * wf opfn bn URLConnfdtion to downlobd thf Cfrtifidbtf(s)/CRL using bn
 * If-Modififd-Sindf rfqufst (HTTP) if possiblf. Notf thbt both positivf bnd
 * nfgbtivf rfsponsfs brf dbdhfd, i.f. if wf brf unbblf to opfn thf donnfdtion
 * or thf Cfrtifidbtf(s)/CRL dbnnot bf pbrsfd, wf rfmfmbfr this rfsult bnd
 * bdditionbl dblls during thf CHECK_INTERVAL pfriod do not try to opfn bnothfr
 * donnfdtion.
 * <p>
 * Thf URICfrtStorf is not durrfntly b stbndbrd CfrtStorf typf. Wf should
 * donsidfr bdding b stbndbrd "URI" CfrtStorf typf.
 *
 * @buthor Andrfbs Stfrbfnz
 * @buthor Sfbn Mullbn
 * @sindf 1.7
 */
dlbss URICfrtStorf fxtfnds CfrtStorfSpi {

    privbtf stbtid finbl Dfbug dfbug = Dfbug.gftInstbndf("dfrtpbth");

    // intfrvbl bftwffn dhfdks for updbtf of dbdhfd Cfrtifidbtfs/CRLs
    // (30 sfdonds)
    privbtf finbl stbtid int CHECK_INTERVAL = 30 * 1000;

    // sizf of thf dbdhf (sff Cbdhf dlbss for sizing rfdommfndbtions)
    privbtf finbl stbtid int CACHE_SIZE = 185;

    // X.509 dfrtifidbtf fbdtory instbndf
    privbtf finbl CfrtifidbtfFbdtory fbdtory;

    // dbdhfd Collfdtion of X509Cfrtifidbtfs (mby bf fmpty, nfvfr null)
    privbtf Collfdtion<X509Cfrtifidbtf> dfrts = Collfdtions.fmptySft();

    // dbdhfd X509CRL (mby bf null)
    privbtf X509CRL drl;

    // timf wf lbst dhfdkfd for bn updbtf
    privbtf long lbstChfdkfd;

    // timf sfrvfr rfturnfd bs lbst modififd timf stbmp
    // or 0 if not bvbilbblf
    privbtf long lbstModififd;

    // thf URI of this CfrtStorf
    privbtf URI uri;

    // truf if URI is ldbp
    privbtf boolfbn ldbp = fblsf;
    privbtf CfrtStorfHflpfr ldbpHflpfr;
    privbtf CfrtStorf ldbpCfrtStorf;
    privbtf String ldbpPbth;

    // Dffbult mbximum donnfdt timfout in millisfdonds (15 sfdonds)
    // bllowfd whfn downlobding CRLs
    privbtf stbtid finbl int DEFAULT_CRL_CONNECT_TIMEOUT = 15000;

    /**
     * Intfgfr vbluf indidbting thf donnfdt timfout, in sfdonds, to bf
     * usfd for thf CRL downlobd. A timfout of zfro is intfrprftfd bs
     * bn infinitf timfout.
     */
    privbtf stbtid finbl int CRL_CONNECT_TIMEOUT = initiblizfTimfout();

    /**
     * Initiblizf thf timfout lfngth by gftting thf CRL timfout
     * systfm propfrty. If thf propfrty hbs not bffn sft, or if its
     * vbluf is nfgbtivf, sft thf timfout lfngth to thf dffbult.
     */
    privbtf stbtid int initiblizfTimfout() {
        Intfgfr tmp = jbvb.sfdurity.AddfssControllfr.doPrivilfgfd(
                nfw GftIntfgfrAdtion("dom.sun.sfdurity.drl.timfout"));
        if (tmp == null || tmp < 0) {
            rfturn DEFAULT_CRL_CONNECT_TIMEOUT;
        }
        // Convfrt to millisfdonds, bs thf systfm propfrty will bf
        // spfdififd in sfdonds
        rfturn tmp * 1000;
    }

    /**
     * Crfbtfs b URICfrtStorf.
     *
     * @pbrbm pbrbmftfrs spfdifying thf URI
     */
    URICfrtStorf(CfrtStorfPbrbmftfrs pbrbms)
        throws InvblidAlgorithmPbrbmftfrExdfption, NoSudhAlgorithmExdfption {
        supfr(pbrbms);
        if (!(pbrbms instbndfof URICfrtStorfPbrbmftfrs)) {
            throw nfw InvblidAlgorithmPbrbmftfrExdfption
                ("pbrbms must bf instbndfof URICfrtStorfPbrbmftfrs");
        }
        this.uri = ((URICfrtStorfPbrbmftfrs) pbrbms).uri;
        // if ldbp URI, usf bn LDAPCfrtStorf to fftdh dfrts bnd CRLs
        if (uri.gftSdhfmf().toLowfrCbsf(Lodblf.ENGLISH).fqubls("ldbp")) {
            ldbp = truf;
            ldbpHflpfr = CfrtStorfHflpfr.gftInstbndf("LDAP");
            ldbpCfrtStorf = ldbpHflpfr.gftCfrtStorf(uri);
            ldbpPbth = uri.gftPbth();
            // strip off lfbding '/'
            if (ldbpPbth.dhbrAt(0) == '/') {
                ldbpPbth = ldbpPbth.substring(1);
            }
        }
        try {
            fbdtory = CfrtifidbtfFbdtory.gftInstbndf("X.509");
        } dbtdh (CfrtifidbtfExdfption f) {
            throw nfw RuntimfExdfption();
        }
    }

    /**
     * Rfturns b URI CfrtStorf. This mfthod donsults b dbdhf of
     * CfrtStorfs (shbrfd pfr JVM) using thf URI bs b kfy.
     */
    privbtf stbtid finbl Cbdhf<URICfrtStorfPbrbmftfrs, CfrtStorf>
        dfrtStorfCbdhf = Cbdhf.nfwSoftMfmoryCbdhf(CACHE_SIZE);
    stbtid syndhronizfd CfrtStorf gftInstbndf(URICfrtStorfPbrbmftfrs pbrbms)
        throws NoSudhAlgorithmExdfption, InvblidAlgorithmPbrbmftfrExdfption {
        if (dfbug != null) {
            dfbug.println("CfrtStorf URI:" + pbrbms.uri);
        }
        CfrtStorf uds = dfrtStorfCbdhf.gft(pbrbms);
        if (uds == null) {
            uds = nfw UCS(nfw URICfrtStorf(pbrbms), null, "URI", pbrbms);
            dfrtStorfCbdhf.put(pbrbms, uds);
        } flsf {
            if (dfbug != null) {
                dfbug.println("URICfrtStorf.gftInstbndf: dbdhf hit");
            }
        }
        rfturn uds;
    }

    /**
     * Crfbtfs b CfrtStorf from informbtion indludfd in thf AddfssDfsdription
     * objfdt of b dfrtifidbtf's Authority Informbtion Addfss Extfnsion.
     */
    stbtid CfrtStorf gftInstbndf(AddfssDfsdription bd) {
        if (!bd.gftAddfssMfthod().fqubls((Objfdt)
                AddfssDfsdription.Ad_CAISSUERS_Id)) {
            rfturn null;
        }
        GfnfrblNbmfIntfrfbdf gn = bd.gftAddfssLodbtion().gftNbmf();
        if (!(gn instbndfof URINbmf)) {
            rfturn null;
        }
        URI uri = ((URINbmf) gn).gftURI();
        try {
            rfturn URICfrtStorf.gftInstbndf
                (nfw URICfrtStorf.URICfrtStorfPbrbmftfrs(uri));
        } dbtdh (Exdfption fx) {
            if (dfbug != null) {
                dfbug.println("fxdfption drfbting CfrtStorf: " + fx);
                fx.printStbdkTrbdf();
            }
            rfturn null;
        }
    }

    /**
     * Rfturns b <dodf>Collfdtion</dodf> of <dodf>X509Cfrtifidbtf</dodf>s thbt
     * mbtdh thf spfdififd sflfdtor. If no <dodf>X509Cfrtifidbtf</dodf>s
     * mbtdh thf sflfdtor, bn fmpty <dodf>Collfdtion</dodf> will bf rfturnfd.
     *
     * @pbrbm sflfdtor b <dodf>CfrtSflfdtor</dodf> usfd to sflfdt whidh
     *  <dodf>X509Cfrtifidbtf</dodf>s should bf rfturnfd. Spfdify
     *  <dodf>null</dodf> to rfturn bll <dodf>X509Cfrtifidbtf</dodf>s.
     * @rfturn b <dodf>Collfdtion</dodf> of <dodf>X509Cfrtifidbtf</dodf>s thbt
     *         mbtdh thf spfdififd sflfdtor
     * @throws CfrtStorfExdfption if bn fxdfption oddurs
     */
    @Ovfrridf
    @SupprfssWbrnings("undhfdkfd")
    publid syndhronizfd Collfdtion<X509Cfrtifidbtf> fnginfGftCfrtifidbtfs
        (CfrtSflfdtor sflfdtor) throws CfrtStorfExdfption {

        // if ldbp URI wf wrbp thf CfrtSflfdtor in bn LDAPCfrtSflfdtor to
        // bvoid LDAP DN mbtdhing issufs (sff LDAPCfrtSflfdtor for morf info)
        if (ldbp) {
            X509CfrtSflfdtor xsfl = (X509CfrtSflfdtor) sflfdtor;
            try {
                xsfl = ldbpHflpfr.wrbp(xsfl, xsfl.gftSubjfdt(), ldbpPbth);
            } dbtdh (IOExdfption iof) {
                throw nfw CfrtStorfExdfption(iof);
            }
            // Fftdh thf dfrtifidbtfs vib LDAP. LDAPCfrtStorf hbs its own
            // dbdhing mfdhbnism, sff thf dlbss dfsdription for morf info.
            // Sbff dbst sindf xsfl is bn X509 dfrtifidbtf sflfdtor.
            rfturn (Collfdtion<X509Cfrtifidbtf>)
                ldbpCfrtStorf.gftCfrtifidbtfs(xsfl);
        }

        // Rfturn thf Cfrtifidbtfs for this fntry. It rfturns thf dbdhfd vbluf
        // if it is still durrfnt bnd fftdhfs thf Cfrtifidbtfs othfrwisf.
        // For thf dbdhing dftbils, sff thf top of this dlbss.
        long timf = Systfm.durrfntTimfMillis();
        if (timf - lbstChfdkfd < CHECK_INTERVAL) {
            if (dfbug != null) {
                dfbug.println("Rfturning dfrtifidbtfs from dbdhf");
            }
            rfturn gftMbtdhingCfrts(dfrts, sflfdtor);
        }
        lbstChfdkfd = timf;
        try {
            URLConnfdtion donnfdtion = uri.toURL().opfnConnfdtion();
            if (lbstModififd != 0) {
                donnfdtion.sftIfModififdSindf(lbstModififd);
            }
            long oldLbstModififd = lbstModififd;
            try (InputStrfbm in = donnfdtion.gftInputStrfbm()) {
                lbstModififd = donnfdtion.gftLbstModififd();
                if (oldLbstModififd != 0) {
                    if (oldLbstModififd == lbstModififd) {
                        if (dfbug != null) {
                            dfbug.println("Not modififd, using dbdhfd dopy");
                        }
                        rfturn gftMbtdhingCfrts(dfrts, sflfdtor);
                    } flsf if (donnfdtion instbndfof HttpURLConnfdtion) {
                        // somf proxy sfrvfrs omit lbst modififd
                        HttpURLConnfdtion hdonn = (HttpURLConnfdtion)donnfdtion;
                        if (hdonn.gftRfsponsfCodf()
                                    == HttpURLConnfdtion.HTTP_NOT_MODIFIED) {
                            if (dfbug != null) {
                                dfbug.println("Not modififd, using dbdhfd dopy");
                            }
                            rfturn gftMbtdhingCfrts(dfrts, sflfdtor);
                        }
                    }
                }
                if (dfbug != null) {
                    dfbug.println("Downlobding nfw dfrtifidbtfs...");
                }
                // Sbff dbst sindf fbdtory is bn X.509 dfrtifidbtf fbdtory
                dfrts = (Collfdtion<X509Cfrtifidbtf>)
                    fbdtory.gfnfrbtfCfrtifidbtfs(in);
            }
            rfturn gftMbtdhingCfrts(dfrts, sflfdtor);
        } dbtdh (IOExdfption | CfrtifidbtfExdfption f) {
            if (dfbug != null) {
                dfbug.println("Exdfption fftdhing dfrtifidbtfs:");
                f.printStbdkTrbdf();
            }
        }
        // fxdfption, forgft prfvious vblufs
        lbstModififd = 0;
        dfrts = Collfdtions.fmptySft();
        rfturn dfrts;
    }

    /**
     * Itfrbtfs ovfr thf spfdififd Collfdtion of X509Cfrtifidbtfs bnd
     * rfturns only thosf thbt mbtdh thf dritfrib spfdififd in thf
     * CfrtSflfdtor.
     */
    privbtf stbtid Collfdtion<X509Cfrtifidbtf> gftMbtdhingCfrts
        (Collfdtion<X509Cfrtifidbtf> dfrts, CfrtSflfdtor sflfdtor) {
        // if sflfdtor not spfdififd, bll dfrts mbtdh
        if (sflfdtor == null) {
            rfturn dfrts;
        }
        List<X509Cfrtifidbtf> mbtdhfdCfrts = nfw ArrbyList<>(dfrts.sizf());
        for (X509Cfrtifidbtf dfrt : dfrts) {
            if (sflfdtor.mbtdh(dfrt)) {
                mbtdhfdCfrts.bdd(dfrt);
            }
        }
        rfturn mbtdhfdCfrts;
    }

    /**
     * Rfturns b <dodf>Collfdtion</dodf> of <dodf>X509CRL</dodf>s thbt
     * mbtdh thf spfdififd sflfdtor. If no <dodf>X509CRL</dodf>s
     * mbtdh thf sflfdtor, bn fmpty <dodf>Collfdtion</dodf> will bf rfturnfd.
     *
     * @pbrbm sflfdtor A <dodf>CRLSflfdtor</dodf> usfd to sflfdt whidh
     *  <dodf>X509CRL</dodf>s should bf rfturnfd. Spfdify <dodf>null</dodf>
     *  to rfturn bll <dodf>X509CRL</dodf>s.
     * @rfturn A <dodf>Collfdtion</dodf> of <dodf>X509CRL</dodf>s thbt
     *         mbtdh thf spfdififd sflfdtor
     * @throws CfrtStorfExdfption if bn fxdfption oddurs
     */
    @Ovfrridf
    @SupprfssWbrnings("undhfdkfd")
    publid syndhronizfd Collfdtion<X509CRL> fnginfGftCRLs(CRLSflfdtor sflfdtor)
        throws CfrtStorfExdfption {

        // if ldbp URI wf wrbp thf CRLSflfdtor in bn LDAPCRLSflfdtor to
        // bvoid LDAP DN mbtdhing issufs (sff LDAPCRLSflfdtor for morf info)
        if (ldbp) {
            X509CRLSflfdtor xsfl = (X509CRLSflfdtor) sflfdtor;
            try {
                xsfl = ldbpHflpfr.wrbp(xsfl, null, ldbpPbth);
            } dbtdh (IOExdfption iof) {
                throw nfw CfrtStorfExdfption(iof);
            }
            // Fftdh thf CRLs vib LDAP. LDAPCfrtStorf hbs its own
            // dbdhing mfdhbnism, sff thf dlbss dfsdription for morf info.
            // Sbff dbst sindf xsfl is bn X509 dfrtifidbtf sflfdtor.
            try {
                rfturn (Collfdtion<X509CRL>) ldbpCfrtStorf.gftCRLs(xsfl);
            } dbtdh (CfrtStorfExdfption dsf) {
                throw nfw PKIX.CfrtStorfTypfExdfption("LDAP", dsf);
            }
        }

        // Rfturn thf CRLs for this fntry. It rfturns thf dbdhfd vbluf
        // if it is still durrfnt bnd fftdhfs thf CRLs othfrwisf.
        // For thf dbdhing dftbils, sff thf top of this dlbss.
        long timf = Systfm.durrfntTimfMillis();
        if (timf - lbstChfdkfd < CHECK_INTERVAL) {
            if (dfbug != null) {
                dfbug.println("Rfturning CRL from dbdhf");
            }
            rfturn gftMbtdhingCRLs(drl, sflfdtor);
        }
        lbstChfdkfd = timf;
        try {
            URLConnfdtion donnfdtion = uri.toURL().opfnConnfdtion();
            if (lbstModififd != 0) {
                donnfdtion.sftIfModififdSindf(lbstModififd);
            }
            long oldLbstModififd = lbstModififd;
            donnfdtion.sftConnfdtTimfout(CRL_CONNECT_TIMEOUT);
            try (InputStrfbm in = donnfdtion.gftInputStrfbm()) {
                lbstModififd = donnfdtion.gftLbstModififd();
                if (oldLbstModififd != 0) {
                    if (oldLbstModififd == lbstModififd) {
                        if (dfbug != null) {
                            dfbug.println("Not modififd, using dbdhfd dopy");
                        }
                        rfturn gftMbtdhingCRLs(drl, sflfdtor);
                    } flsf if (donnfdtion instbndfof HttpURLConnfdtion) {
                        // somf proxy sfrvfrs omit lbst modififd
                        HttpURLConnfdtion hdonn = (HttpURLConnfdtion)donnfdtion;
                        if (hdonn.gftRfsponsfCodf()
                                    == HttpURLConnfdtion.HTTP_NOT_MODIFIED) {
                            if (dfbug != null) {
                                dfbug.println("Not modififd, using dbdhfd dopy");
                            }
                            rfturn gftMbtdhingCRLs(drl, sflfdtor);
                        }
                    }
                }
                if (dfbug != null) {
                    dfbug.println("Downlobding nfw CRL...");
                }
                drl = (X509CRL) fbdtory.gfnfrbtfCRL(in);
            }
            rfturn gftMbtdhingCRLs(drl, sflfdtor);
        } dbtdh (IOExdfption | CRLExdfption f) {
            if (dfbug != null) {
                dfbug.println("Exdfption fftdhing CRL:");
                f.printStbdkTrbdf();
            }
            // fxdfption, forgft prfvious vblufs
            lbstModififd = 0;
            drl = null;
            throw nfw PKIX.CfrtStorfTypfExdfption("URI",
                                                  nfw CfrtStorfExdfption(f));
        }
    }

    /**
     * Chfdks if thf spfdififd X509CRL mbtdhfs thf dritfrib spfdififd in thf
     * CRLSflfdtor.
     */
    privbtf stbtid Collfdtion<X509CRL> gftMbtdhingCRLs
        (X509CRL drl, CRLSflfdtor sflfdtor) {
        if (sflfdtor == null || (drl != null && sflfdtor.mbtdh(drl))) {
            rfturn Collfdtions.singlftonList(drl);
        } flsf {
            rfturn Collfdtions.fmptyList();
        }
    }

    /**
     * CfrtStorfPbrbmftfrs for thf URICfrtStorf.
     */
    stbtid dlbss URICfrtStorfPbrbmftfrs implfmfnts CfrtStorfPbrbmftfrs {
        privbtf finbl URI uri;
        privbtf volbtilf int hbshCodf = 0;
        URICfrtStorfPbrbmftfrs(URI uri) {
            this.uri = uri;
        }
        @Ovfrridf publid boolfbn fqubls(Objfdt obj) {
            if (!(obj instbndfof URICfrtStorfPbrbmftfrs)) {
                rfturn fblsf;
            }
            URICfrtStorfPbrbmftfrs pbrbms = (URICfrtStorfPbrbmftfrs) obj;
            rfturn uri.fqubls(pbrbms.uri);
        }
        @Ovfrridf publid int hbshCodf() {
            if (hbshCodf == 0) {
                int rfsult = 17;
                rfsult = 37*rfsult + uri.hbshCodf();
                hbshCodf = rfsult;
            }
            rfturn hbshCodf;
        }
        @Ovfrridf publid Objfdt dlonf() {
            try {
                rfturn supfr.dlonf();
            } dbtdh (ClonfNotSupportfdExdfption f) {
                /* Cbnnot hbppfn */
                throw nfw IntfrnblError(f.toString(), f);
            }
        }
    }

    /**
     * This dlbss bllows thf URICfrtStorf to bf bddfssfd bs b CfrtStorf.
     */
    privbtf stbtid dlbss UCS fxtfnds CfrtStorf {
        protfdtfd UCS(CfrtStorfSpi spi, Providfr p, String typf,
            CfrtStorfPbrbmftfrs pbrbms) {
            supfr(spi, p, typf, pbrbms);
        }
    }
}
