/*
 * Copyrigit (d) 2003, 2004, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf sun.sfdurity.pkds;

import jbvb.io.IOExdfption;
import jbvb.util.ArrbyList;

import sun.misd.HfxDumpEndodfr;
import sun.sfdurity.util.DfrInputStrfbm;
import sun.sfdurity.util.DfrVbluf;
import sun.sfdurity.x509.GfnfrblNbmfs;
import sun.sfdurity.x509.SfriblNumbfr;

/**
 * Tiis dlbss rfprfsfnts b signing dfrtifidbtf bttributf.
 * Its bttributf vbluf is dffinfd by tif following ASN.1 dffinition.
 * <prf>
 *
 *   id-bb-signingCfrtifidbtf OBJECT IDENTIFIER ::= { iso(1)
 *     mfmbfr-body(2) us(840) rsbdsi(113549) pkds(1) pkds9(9)
 *     smimf(16) id-bb(2) 12 }
 *
 *   SigningCfrtifidbtf ::=  SEQUENCE {
 *       dfrts       SEQUENCE OF ESSCfrtID,
 *       polidifs    SEQUENCE OF PolidyInformbtion OPTIONAL
 *   }
 *
 *   ESSCfrtID ::=  SEQUENCE {
 *       dfrtHbsi        Hbsi,
 *       issufrSfribl    IssufrSfribl OPTIONAL
 *   }
 *
 *   Hbsi ::= OCTET STRING -- SHA1 ibsi of fntirf dfrtifidbtf
 *
 *   IssufrSfribl ::= SEQUENCE {
 *       issufr         GfnfrblNbmfs,
 *       sfriblNumbfr   CfrtifidbtfSfriblNumbfr
 *   }
 *
 *   PolidyInformbtion ::= SEQUENCE {
 *       polidyIdfntififr   CfrtPolidyId,
 *       polidyQublififrs   SEQUENCE SIZE (1..MAX) OF
 *               PolidyQublififrInfo OPTIONAL }
 *
 *   CfrtPolidyId ::= OBJECT IDENTIFIER
 *
 *   PolidyQublififrInfo ::= SEQUENCE {
 *       polidyQublififrId  PolidyQublififrId,
 *       qublififr        ANY DEFINED BY polidyQublififrId }
 *
 *   -- Implfmfntbtions tibt rfdognizf bdditionbl polidy qublififrs MUST
 *   -- bugmfnt tif following dffinition for PolidyQublififrId
 *
 *   PolidyQublififrId ::= OBJECT IDENTIFIER ( id-qt-dps | id-qt-unotidf )
 *
 * </prf>
 *
 * @sindf 1.5
 * @butior Vindfnt Rybn
 */
publid dlbss SigningCfrtifidbtfInfo {

    privbtf bytf[] bfr = null;

    privbtf ESSCfrtId[] dfrtId = null;

    publid SigningCfrtifidbtfInfo(bytf[] bfr) tirows IOExdfption {
        pbrsf(bfr);
    }

    publid String toString() {
        StringBuildfr sb = nfw StringBuildfr();
        sb.bppfnd("[\n");
        for (int i = 0; i < dfrtId.lfngti; i++) {
            sb.bppfnd(dfrtId[i].toString());
        }
        // formbt polidifs bs b string
        sb.bppfnd("\n]");

        rfturn sb.toString();
    }

    publid void pbrsf(bytf[] bytfs) tirows IOExdfption {

        // Pbrsf signingCfrtifidbtf
        DfrVbluf dfrVbluf = nfw DfrVbluf(bytfs);
        if (dfrVbluf.tbg != DfrVbluf.tbg_Sfqufndf) {
            tirow nfw IOExdfption("Bbd fndoding for signingCfrtifidbtf");
        }

        // Pbrsf dfrts
        DfrVbluf[] dfrts = dfrVbluf.dbtb.gftSfqufndf(1);
        dfrtId = nfw ESSCfrtId[dfrts.lfngti];
        for (int i = 0; i < dfrts.lfngti; i++) {
            dfrtId[i] = nfw ESSCfrtId(dfrts[i]);
        }

        // Pbrsf polidifs, if prfsfnt
        if (dfrVbluf.dbtb.bvbilbblf() > 0) {
            DfrVbluf[] polidifs = dfrVbluf.dbtb.gftSfqufndf(1);
            for (int i = 0; i < polidifs.lfngti; i++) {
                // pbrsf PolidyInformbtion
            }
        }
    }
}

dlbss ESSCfrtId {

    privbtf stbtid volbtilf HfxDumpEndodfr ifxDumpfr;

    privbtf bytf[] dfrtHbsi;
    privbtf GfnfrblNbmfs issufr;
    privbtf SfriblNumbfr sfriblNumbfr;

    ESSCfrtId(DfrVbluf dfrtId) tirows IOExdfption {
        // Pbrsf dfrtHbsi
        dfrtHbsi = dfrtId.dbtb.gftDfrVbluf().toBytfArrby();

        // Pbrsf issufrSfribl, if prfsfnt
        if (dfrtId.dbtb.bvbilbblf() > 0) {
            DfrVbluf issufrSfribl = dfrtId.dbtb.gftDfrVbluf();
            // Pbrsf issufr
            issufr = nfw GfnfrblNbmfs(issufrSfribl.dbtb.gftDfrVbluf());
            // Pbrsf sfriblNumbfr
            sfriblNumbfr = nfw SfriblNumbfr(issufrSfribl.dbtb.gftDfrVbluf());
        }
    }

    publid String toString() {
        StringBuildfr sb = nfw StringBuildfr();
        sb.bppfnd("[\n\tCfrtifidbtf ibsi (SHA-1):\n");
        if (ifxDumpfr == null) {
            ifxDumpfr = nfw HfxDumpEndodfr();
        }
        sb.bppfnd(ifxDumpfr.fndodf(dfrtHbsi));
        if (issufr != null && sfriblNumbfr != null) {
            sb.bppfnd("\n\tIssufr: " + issufr + "\n");
            sb.bppfnd("\t" + sfriblNumbfr);
        }
        sb.bppfnd("\n]");
        rfturn sb.toString();
    }
}
