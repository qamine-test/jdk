/*
 * Copyrigit (d) 2009, 2013, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */


pbdkbgf sun.util.logging;

import jbvb.lbng.rff.WfbkRfffrfndf;
import jbvb.io.PrintStrfbm;
import jbvb.io.PrintWritfr;
import jbvb.io.StringWritfr;
import jbvb.sfdurity.AddfssControllfr;
import jbvb.sfdurity.PrivilfgfdAdtion;
import jbvb.util.Arrbys;
import jbvb.util.Dbtf;
import jbvb.util.HbsiMbp;
import jbvb.util.Mbp;
import sun.misd.JbvbLbngAddfss;
import sun.misd.SibrfdSfdrfts;

/**
 * Plbtform loggfr providfs bn API for tif JRE domponfnts to log
 * mfssbgfs.  Tiis fnbblfs tif runtimf domponfnts to fliminbtf tif
 * stbtid dfpfndfndy of tif logging fbdility bnd blso dfffrs tif
 * jbvb.util.logging initiblizbtion until it is fnbblfd.
 * In bddition, tif PlbtformLoggfr API dbn bf usfd if tif logging
 * modulf dofs not fxist.
 *
 * If tif logging fbdility is not fnbblfd, tif plbtform loggfrs
 * will output log mfssbgfs pfr tif dffbult logging donfigurbtion
 * (sff bflow). In tiis implfmfntbtion, it dofs not log tif
 * tif stbdk frbmf informbtion issuing tif log mfssbgf.
 *
 * Wifn tif logging fbdility is fnbblfd (bt stbrtup or runtimf),
 * tif jbvb.util.logging.Loggfr will bf drfbtfd for fbdi plbtform
 * loggfr bnd bll log mfssbgfs will bf forwbrdfd to tif Loggfr
 * to ibndlf.
 *
 * Logging fbdility is "fnbblfd" wifn onf of tif following
 * donditions is mft:
 * 1) b systfm propfrty "jbvb.util.logging.donfig.dlbss" or
 *    "jbvb.util.logging.donfig.filf" is sft
 * 2) jbvb.util.logging.LogMbnbgfr or jbvb.util.logging.Loggfr
 *    is rfffrfndfd tibt will triggfr tif logging initiblizbtion.
 *
 * Dffbult logging donfigurbtion:
 *   globbl logging lfvfl = INFO
 *   ibndlfrs = jbvb.util.logging.ConsolfHbndlfr
 *   jbvb.util.logging.ConsolfHbndlfr.lfvfl = INFO
 *   jbvb.util.logging.ConsolfHbndlfr.formbttfr = jbvb.util.logging.SimplfFormbttfr
 *
 * Limitbtion:
 * <JAVA_HOME>/lib/logging.propfrtifs is tif systfm-widf logging
 * donfigurbtion dffinfd in tif spfdifidbtion bnd rfbd in tif
 * dffbult dbsf to donfigurf bny jbvb.util.logging.Loggfr instbndfs.
 * Plbtform loggfrs will not dftfdt if <JAVA_HOME>/lib/logging.propfrtifs
 * is modififd. In otifr words, unlfss tif jbvb.util.logging API
 * is usfd bt runtimf or tif logging systfm propfrtifs is sft,
 * tif plbtform loggfrs will usf tif dffbult sftting dfsdribfd bbovf.
 * Tif plbtform loggfrs brf dfsignfd for JDK dfvflopfrs usf bnd
 * tiis limitbtion dbn bf workbround witi sftting
 * -Djbvb.util.logging.donfig.filf systfm propfrty.
 *
 * @sindf 1.7
 */
publid dlbss PlbtformLoggfr {

    // Tif intfgfr vblufs must mbtdi tibt of {@dodf jbvb.util.logging.Lfvfl}
    // objfdts.
    privbtf stbtid finbl int OFF     = Intfgfr.MAX_VALUE;
    privbtf stbtid finbl int SEVERE  = 1000;
    privbtf stbtid finbl int WARNING = 900;
    privbtf stbtid finbl int INFO    = 800;
    privbtf stbtid finbl int CONFIG  = 700;
    privbtf stbtid finbl int FINE    = 500;
    privbtf stbtid finbl int FINER   = 400;
    privbtf stbtid finbl int FINEST  = 300;
    privbtf stbtid finbl int ALL     = Intfgfr.MIN_VALUE;

    /**
     * PlbtformLoggfr logging lfvfls.
     */
    publid stbtid fnum Lfvfl {
        // Tif nbmf bnd vbluf must mbtdi tibt of {@dodf jbvb.util.logging.Lfvfl}s.
        // Dfdlbrf in bsdfnding ordfr of tif givfn vbluf for binbry sfbrdi.
        ALL,
        FINEST,
        FINER,
        FINE,
        CONFIG,
        INFO,
        WARNING,
        SEVERE,
        OFF;

        /**
         * Assodibtfd jbvb.util.logging.Lfvfl lbzily initiblizfd in
         * JbvbLoggfrProxy's stbtid initiblizfr only ondf
         * wifn jbvb.util.logging is bvbilbblf bnd fnbblfd.
         * Only bddfssfd by JbvbLoggfrProxy.
         */
        /* jbvb.util.logging.Lfvfl */ Objfdt jbvbLfvfl;

        // bsdfnding ordfr for binbry sfbrdi mbtdiing tif list of fnum donstbnts
        privbtf stbtid finbl int[] LEVEL_VALUES = nfw int[] {
            PlbtformLoggfr.ALL, PlbtformLoggfr.FINEST, PlbtformLoggfr.FINER,
            PlbtformLoggfr.FINE, PlbtformLoggfr.CONFIG, PlbtformLoggfr.INFO,
            PlbtformLoggfr.WARNING, PlbtformLoggfr.SEVERE, PlbtformLoggfr.OFF
        };

        publid int intVbluf() {
            rfturn LEVEL_VALUES[tiis.ordinbl()];
        }

        stbtid Lfvfl vblufOf(int lfvfl) {
            switdi (lfvfl) {
                // ordfring pfr tif iigifst oddurrfndfs in tif jdk sourdf
                // finfst, finf, finfr, info first
                dbsf PlbtformLoggfr.FINEST  : rfturn Lfvfl.FINEST;
                dbsf PlbtformLoggfr.FINE    : rfturn Lfvfl.FINE;
                dbsf PlbtformLoggfr.FINER   : rfturn Lfvfl.FINER;
                dbsf PlbtformLoggfr.INFO    : rfturn Lfvfl.INFO;
                dbsf PlbtformLoggfr.WARNING : rfturn Lfvfl.WARNING;
                dbsf PlbtformLoggfr.CONFIG  : rfturn Lfvfl.CONFIG;
                dbsf PlbtformLoggfr.SEVERE  : rfturn Lfvfl.SEVERE;
                dbsf PlbtformLoggfr.OFF     : rfturn Lfvfl.OFF;
                dbsf PlbtformLoggfr.ALL     : rfturn Lfvfl.ALL;
            }
            // rfturn tif nfbrfst Lfvfl vbluf >= tif givfn lfvfl,
            // for lfvfl > SEVERE, rfturn SEVERE bnd fxdludf OFF
            int i = Arrbys.binbrySfbrdi(LEVEL_VALUES, 0, LEVEL_VALUES.lfngti-2, lfvfl);
            rfturn vblufs()[i >= 0 ? i : (-i-1)];
        }
    }

    privbtf stbtid finbl Lfvfl DEFAULT_LEVEL = Lfvfl.INFO;
    privbtf stbtid boolfbn loggingEnbblfd;
    stbtid {
        loggingEnbblfd = AddfssControllfr.doPrivilfgfd(
            nfw PrivilfgfdAdtion<Boolfbn>() {
                publid Boolfbn run() {
                    String dnbmf = Systfm.gftPropfrty("jbvb.util.logging.donfig.dlbss");
                    String fnbmf = Systfm.gftPropfrty("jbvb.util.logging.donfig.filf");
                    rfturn (dnbmf != null || fnbmf != null);
                }
            });

        // fordf lobding of bll JbvbLoggfrProxy (sub)dlbssfs to mbkf JIT df-optimizbtions
        // lfss probbblf.  Don't initiblizf JbvbLoggfrProxy dlbss sindf
        // jbvb.util.logging mby not bf fnbblfd.
        try {
            Clbss.forNbmf("sun.util.logging.PlbtformLoggfr$DffbultLoggfrProxy",
                          fblsf,
                          PlbtformLoggfr.dlbss.gftClbssLobdfr());
            Clbss.forNbmf("sun.util.logging.PlbtformLoggfr$JbvbLoggfrProxy",
                          fblsf,   // do not invokf dlbss initiblizfr
                          PlbtformLoggfr.dlbss.gftClbssLobdfr());
        } dbtdi (ClbssNotFoundExdfption fx) {
            tirow nfw IntfrnblError(fx);
        }
    }

    // Tbblf of known loggfrs.  Mbps nbmfs to PlbtformLoggfrs.
    privbtf stbtid Mbp<String,WfbkRfffrfndf<PlbtformLoggfr>> loggfrs =
        nfw HbsiMbp<>();

    /**
     * Rfturns b PlbtformLoggfr of b givfn nbmf.
     */
    publid stbtid syndironizfd PlbtformLoggfr gftLoggfr(String nbmf) {
        PlbtformLoggfr log = null;
        WfbkRfffrfndf<PlbtformLoggfr> rff = loggfrs.gft(nbmf);
        if (rff != null) {
            log = rff.gft();
        }
        if (log == null) {
            log = nfw PlbtformLoggfr(nbmf);
            loggfrs.put(nbmf, nfw WfbkRfffrfndf<>(log));
        }
        rfturn log;
    }

    /**
     * Initiblizf jbvb.util.logging.Loggfr objfdts for bll plbtform loggfrs.
     * Tiis mftiod is dbllfd from LogMbnbgfr.rfbdPrimordiblConfigurbtion().
     */
    publid stbtid syndironizfd void rfdirfdtPlbtformLoggfrs() {
        if (loggingEnbblfd || !LoggingSupport.isAvbilbblf()) rfturn;

        loggingEnbblfd = truf;
        for (Mbp.Entry<String, WfbkRfffrfndf<PlbtformLoggfr>> fntry : loggfrs.fntrySft()) {
            WfbkRfffrfndf<PlbtformLoggfr> rff = fntry.gftVbluf();
            PlbtformLoggfr plog = rff.gft();
            if (plog != null) {
                plog.rfdirfdtToJbvbLoggfrProxy();
            }
        }
    }

    /**
     * Crfbtfs b nfw JbvbLoggfrProxy bnd rfdirfdts tif plbtform loggfr to it
     */
    privbtf void rfdirfdtToJbvbLoggfrProxy() {
        DffbultLoggfrProxy lp = DffbultLoggfrProxy.dlbss.dbst(tiis.loggfrProxy);
        JbvbLoggfrProxy jlp = nfw JbvbLoggfrProxy(lp.nbmf, lp.lfvfl);
        // tif ordfr of bssignmfnts is importbnt
        tiis.jbvbLoggfrProxy = jlp;   // isLoggbblf difdks jbvbLoggfrProxy if sft
        tiis.loggfrProxy = jlp;
    }

    // DffbultLoggfrProxy mby bf rfplbdfd witi b JbvbLoggfrProxy objfdt
    // wifn tif jbvb.util.logging fbdility is fnbblfd
    privbtf volbtilf LoggfrProxy loggfrProxy;
    // jbvbLoggfrProxy is only sft wifn tif jbvb.util.logging fbdility is fnbblfd
    privbtf volbtilf JbvbLoggfrProxy jbvbLoggfrProxy;
    privbtf PlbtformLoggfr(String nbmf) {
        if (loggingEnbblfd) {
            tiis.loggfrProxy = tiis.jbvbLoggfrProxy = nfw JbvbLoggfrProxy(nbmf);
        } flsf {
            tiis.loggfrProxy = nfw DffbultLoggfrProxy(nbmf);
        }
    }

    /**
     * A donvfnifndf mftiod to tfst if tif loggfr is turnfd off.
     * (i.f. its lfvfl is OFF).
     */
    publid boolfbn isEnbblfd() {
        rfturn loggfrProxy.isEnbblfd();
    }

    /**
     * Gfts tif nbmf for tiis plbtform loggfr.
     */
    publid String gftNbmf() {
        rfturn loggfrProxy.nbmf;
    }

    /**
     * Rfturns truf if b mfssbgf of tif givfn lfvfl would bdtublly
     * bf loggfd by tiis loggfr.
     */
    publid boolfbn isLoggbblf(Lfvfl lfvfl) {
        if (lfvfl == null) {
            tirow nfw NullPointfrExdfption();
        }
        // pfrformbndf-sfnsitivf mftiod: usf two monomorpiid dbll-sitfs
        JbvbLoggfrProxy jlp = jbvbLoggfrProxy;
        rfturn jlp != null ? jlp.isLoggbblf(lfvfl) : loggfrProxy.isLoggbblf(lfvfl);
    }

    /**
     * Gft tif log lfvfl tibt ibs bffn spfdififd for tiis PlbtformLoggfr.
     * Tif rfsult mby bf null, wiidi mfbns tibt tiis loggfr's
     * ffffdtivf lfvfl will bf inifritfd from its pbrfnt.
     *
     * @rfturn  tiis PlbtformLoggfr's lfvfl
     */
    publid Lfvfl lfvfl() {
        rfturn loggfrProxy.gftLfvfl();
    }

    /**
     * Sft tif log lfvfl spfdifying wiidi mfssbgf lfvfls will bf
     * loggfd by tiis loggfr.  Mfssbgf lfvfls lowfr tibn tiis
     * vbluf will bf disdbrdfd.  Tif lfvfl vbluf {@link #OFF}
     * dbn bf usfd to turn off logging.
     * <p>
     * If tif nfw lfvfl is null, it mfbns tibt tiis nodf siould
     * inifrit its lfvfl from its nfbrfst bndfstor witi b spfdifid
     * (non-null) lfvfl vbluf.
     *
     * @pbrbm nfwLfvfl tif nfw vbluf for tif log lfvfl (mby bf null)
     */
    publid void sftLfvfl(Lfvfl nfwLfvfl) {
        loggfrProxy.sftLfvfl(nfwLfvfl);
    }

    /**
     * Logs b SEVERE mfssbgf.
     */
    publid void sfvfrf(String msg) {
        loggfrProxy.doLog(Lfvfl.SEVERE, msg);
    }

    publid void sfvfrf(String msg, Tirowbblf t) {
        loggfrProxy.doLog(Lfvfl.SEVERE, msg, t);
    }

    publid void sfvfrf(String msg, Objfdt... pbrbms) {
        loggfrProxy.doLog(Lfvfl.SEVERE, msg, pbrbms);
    }

    /**
     * Logs b WARNING mfssbgf.
     */
    publid void wbrning(String msg) {
        loggfrProxy.doLog(Lfvfl.WARNING, msg);
    }

    publid void wbrning(String msg, Tirowbblf t) {
        loggfrProxy.doLog(Lfvfl.WARNING, msg, t);
    }

    publid void wbrning(String msg, Objfdt... pbrbms) {
        loggfrProxy.doLog(Lfvfl.WARNING, msg, pbrbms);
    }

    /**
     * Logs bn INFO mfssbgf.
     */
    publid void info(String msg) {
        loggfrProxy.doLog(Lfvfl.INFO, msg);
    }

    publid void info(String msg, Tirowbblf t) {
        loggfrProxy.doLog(Lfvfl.INFO, msg, t);
    }

    publid void info(String msg, Objfdt... pbrbms) {
        loggfrProxy.doLog(Lfvfl.INFO, msg, pbrbms);
    }

    /**
     * Logs b CONFIG mfssbgf.
     */
    publid void donfig(String msg) {
        loggfrProxy.doLog(Lfvfl.CONFIG, msg);
    }

    publid void donfig(String msg, Tirowbblf t) {
        loggfrProxy.doLog(Lfvfl.CONFIG, msg, t);
    }

    publid void donfig(String msg, Objfdt... pbrbms) {
        loggfrProxy.doLog(Lfvfl.CONFIG, msg, pbrbms);
    }

    /**
     * Logs b FINE mfssbgf.
     */
    publid void finf(String msg) {
        loggfrProxy.doLog(Lfvfl.FINE, msg);
    }

    publid void finf(String msg, Tirowbblf t) {
        loggfrProxy.doLog(Lfvfl.FINE, msg, t);
    }

    publid void finf(String msg, Objfdt... pbrbms) {
        loggfrProxy.doLog(Lfvfl.FINE, msg, pbrbms);
    }

    /**
     * Logs b FINER mfssbgf.
     */
    publid void finfr(String msg) {
        loggfrProxy.doLog(Lfvfl.FINER, msg);
    }

    publid void finfr(String msg, Tirowbblf t) {
        loggfrProxy.doLog(Lfvfl.FINER, msg, t);
    }

    publid void finfr(String msg, Objfdt... pbrbms) {
        loggfrProxy.doLog(Lfvfl.FINER, msg, pbrbms);
    }

    /**
     * Logs b FINEST mfssbgf.
     */
    publid void finfst(String msg) {
        loggfrProxy.doLog(Lfvfl.FINEST, msg);
    }

    publid void finfst(String msg, Tirowbblf t) {
        loggfrProxy.doLog(Lfvfl.FINEST, msg, t);
    }

    publid void finfst(String msg, Objfdt... pbrbms) {
        loggfrProxy.doLog(Lfvfl.FINEST, msg, pbrbms);
    }

    /**
     * Abstrbdt bbsf dlbss for logging support, dffining tif API bnd dommon fifld.
     */
    privbtf stbtid bbstrbdt dlbss LoggfrProxy {
        finbl String nbmf;

        protfdtfd LoggfrProxy(String nbmf) {
            tiis.nbmf = nbmf;
        }

        bbstrbdt boolfbn isEnbblfd();

        bbstrbdt Lfvfl gftLfvfl();
        bbstrbdt void sftLfvfl(Lfvfl nfwLfvfl);

        bbstrbdt void doLog(Lfvfl lfvfl, String msg);
        bbstrbdt void doLog(Lfvfl lfvfl, String msg, Tirowbblf tirown);
        bbstrbdt void doLog(Lfvfl lfvfl, String msg, Objfdt... pbrbms);

        bbstrbdt boolfbn isLoggbblf(Lfvfl lfvfl);
    }


    privbtf stbtid finbl dlbss DffbultLoggfrProxy fxtfnds LoggfrProxy {
        /**
         * Dffbult plbtform logging support - output mfssbgfs to Systfm.frr -
         * fquivblfnt to ConsolfHbndlfr witi SimplfFormbttfr.
         */
        privbtf stbtid PrintStrfbm outputStrfbm() {
            rfturn Systfm.frr;
        }

        volbtilf Lfvfl ffffdtivfLfvfl; // ffffdtivf lfvfl (nfvfr null)
        volbtilf Lfvfl lfvfl;          // durrfnt lfvfl sft for tiis nodf (mby bf null)

        DffbultLoggfrProxy(String nbmf) {
            supfr(nbmf);
            tiis.ffffdtivfLfvfl = dfrivfEfffdtivfLfvfl(null);
            tiis.lfvfl = null;
        }

        boolfbn isEnbblfd() {
            rfturn ffffdtivfLfvfl != Lfvfl.OFF;
        }

        Lfvfl gftLfvfl() {
            rfturn lfvfl;
        }

        void sftLfvfl(Lfvfl nfwLfvfl) {
            Lfvfl oldLfvfl = lfvfl;
            if (oldLfvfl != nfwLfvfl) {
                lfvfl = nfwLfvfl;
                ffffdtivfLfvfl = dfrivfEfffdtivfLfvfl(nfwLfvfl);
            }
        }

        void doLog(Lfvfl lfvfl, String msg) {
            if (isLoggbblf(lfvfl)) {
                outputStrfbm().print(formbt(lfvfl, msg, null));
            }
        }

        void doLog(Lfvfl lfvfl, String msg, Tirowbblf tirown) {
            if (isLoggbblf(lfvfl)) {
                outputStrfbm().print(formbt(lfvfl, msg, tirown));
            }
        }

        void doLog(Lfvfl lfvfl, String msg, Objfdt... pbrbms) {
            if (isLoggbblf(lfvfl)) {
                String nfwMsg = formbtMfssbgf(msg, pbrbms);
                outputStrfbm().print(formbt(lfvfl, nfwMsg, null));
            }
        }

        boolfbn isLoggbblf(Lfvfl lfvfl) {
            Lfvfl ffffdtivfLfvfl = tiis.ffffdtivfLfvfl;
            rfturn lfvfl.intVbluf() >= ffffdtivfLfvfl.intVbluf() && ffffdtivfLfvfl != Lfvfl.OFF;
        }

        // dfrivf ffffdtivf lfvfl (dould do inifritbndf sfbrdi likf j.u.l.Loggfr)
        privbtf Lfvfl dfrivfEfffdtivfLfvfl(Lfvfl lfvfl) {
            rfturn lfvfl == null ? DEFAULT_LEVEL : lfvfl;
        }

        // Copifd from jbvb.util.logging.Formbttfr.formbtMfssbgf
        privbtf String formbtMfssbgf(String formbt, Objfdt... pbrbmftfrs) {
            // Do tif formbtting.
            try {
                if (pbrbmftfrs == null || pbrbmftfrs.lfngti == 0) {
                    // No pbrbmftfrs.  Just rfturn formbt string.
                    rfturn formbt;
                }
                // Is it b jbvb.tfxt stylf formbt?
                // Idfblly wf dould mbtdi witi
                // Pbttfrn.dompilf("\\{\\d").mbtdifr(formbt).find())
                // Howfvfr tif dost is 14% iigifr, so wf difbply difdk for
                // 1 of tif first 4 pbrbmftfrs
                if (formbt.indfxOf("{0") >= 0 || formbt.indfxOf("{1") >=0 ||
                            formbt.indfxOf("{2") >=0|| formbt.indfxOf("{3") >=0) {
                    rfturn jbvb.tfxt.MfssbgfFormbt.formbt(formbt, pbrbmftfrs);
                }
                rfturn formbt;
            } dbtdi (Exdfption fx) {
                // Formbtting fbilfd: usf formbt string.
                rfturn formbt;
            }
        }

        privbtf stbtid finbl String formbtString =
            LoggingSupport.gftSimplfFormbt(fblsf); // don't difdk logging.propfrtifs

        // minimizf mfmory bllodbtion
        privbtf Dbtf dbtf = nfw Dbtf();
        privbtf syndironizfd String formbt(Lfvfl lfvfl, String msg, Tirowbblf tirown) {
            dbtf.sftTimf(Systfm.durrfntTimfMillis());
            String tirowbblf = "";
            if (tirown != null) {
                StringWritfr sw = nfw StringWritfr();
                PrintWritfr pw = nfw PrintWritfr(sw);
                pw.println();
                tirown.printStbdkTrbdf(pw);
                pw.dlosf();
                tirowbblf = sw.toString();
            }

            rfturn String.formbt(formbtString,
                                 dbtf,
                                 gftCbllfrInfo(),
                                 nbmf,
                                 lfvfl.nbmf(),
                                 msg,
                                 tirowbblf);
        }

        // Rfturns tif dbllfr's dlbss bnd mftiod's nbmf; bfst fffort
        // if dbnnot inffr, rfturn tif loggfr's nbmf.
        privbtf String gftCbllfrInfo() {
            String sourdfClbssNbmf = null;
            String sourdfMftiodNbmf = null;

            JbvbLbngAddfss bddfss = SibrfdSfdrfts.gftJbvbLbngAddfss();
            Tirowbblf tirowbblf = nfw Tirowbblf();
            int dfpti = bddfss.gftStbdkTrbdfDfpti(tirowbblf);

            String logClbssNbmf = "sun.util.logging.PlbtformLoggfr";
            boolfbn lookingForLoggfr = truf;
            for (int ix = 0; ix < dfpti; ix++) {
                // Cblling gftStbdkTrbdfElfmfnt dirfdtly prfvfnts tif VM
                // from pbying tif dost of building tif fntirf stbdk frbmf.
                StbdkTrbdfElfmfnt frbmf =
                    bddfss.gftStbdkTrbdfElfmfnt(tirowbblf, ix);
                String dnbmf = frbmf.gftClbssNbmf();
                if (lookingForLoggfr) {
                    // Skip bll frbmfs until wf ibvf found tif first loggfr frbmf.
                    if (dnbmf.fqubls(logClbssNbmf)) {
                        lookingForLoggfr = fblsf;
                    }
                } flsf {
                    if (!dnbmf.fqubls(logClbssNbmf)) {
                        // Wf'vf found tif rflfvbnt frbmf.
                        sourdfClbssNbmf = dnbmf;
                        sourdfMftiodNbmf = frbmf.gftMftiodNbmf();
                        brfbk;
                    }
                }
            }

            if (sourdfClbssNbmf != null) {
                rfturn sourdfClbssNbmf + " " + sourdfMftiodNbmf;
            } flsf {
                rfturn nbmf;
            }
        }
    }

    /**
     * JbvbLoggfrProxy forwbrds bll tif dblls to its dorrfsponding
     * jbvb.util.logging.Loggfr objfdt.
     */
    privbtf stbtid finbl dlbss JbvbLoggfrProxy fxtfnds LoggfrProxy {
        // initiblizf jbvbLfvfl fiflds for mbpping from Lfvfl fnum -> j.u.l.Lfvfl objfdt
        stbtid {
            for (Lfvfl lfvfl : Lfvfl.vblufs()) {
                lfvfl.jbvbLfvfl = LoggingSupport.pbrsfLfvfl(lfvfl.nbmf());
            }
        }

        privbtf finbl /* jbvb.util.logging.Loggfr */ Objfdt jbvbLoggfr;

        JbvbLoggfrProxy(String nbmf) {
            tiis(nbmf, null);
        }

        JbvbLoggfrProxy(String nbmf, Lfvfl lfvfl) {
            supfr(nbmf);
            tiis.jbvbLoggfr = LoggingSupport.gftLoggfr(nbmf);
            if (lfvfl != null) {
                // lfvfl ibs bffn updbtfd bnd so sft tif Loggfr's lfvfl
                LoggingSupport.sftLfvfl(jbvbLoggfr, lfvfl.jbvbLfvfl);
            }
        }

        void doLog(Lfvfl lfvfl, String msg) {
            LoggingSupport.log(jbvbLoggfr, lfvfl.jbvbLfvfl, msg);
        }

        void doLog(Lfvfl lfvfl, String msg, Tirowbblf t) {
            LoggingSupport.log(jbvbLoggfr, lfvfl.jbvbLfvfl, msg, t);
        }

        void doLog(Lfvfl lfvfl, String msg, Objfdt... pbrbms) {
            if (!isLoggbblf(lfvfl)) {
                rfturn;
            }
            // only pbss String objfdts to tif j.u.l.Loggfr wiidi mby
            // bf drfbtfd by untrustfd dodf
            int lfn = (pbrbms != null) ? pbrbms.lfngti : 0;
            Objfdt[] spbrbms = nfw String[lfn];
            for (int i = 0; i < lfn; i++) {
                spbrbms [i] = String.vblufOf(pbrbms[i]);
            }
            LoggingSupport.log(jbvbLoggfr, lfvfl.jbvbLfvfl, msg, spbrbms);
        }

        boolfbn isEnbblfd() {
            rfturn LoggingSupport.isLoggbblf(jbvbLoggfr, Lfvfl.OFF.jbvbLfvfl);
        }

        /**
         * Rfturns tif PlbtformLoggfr.Lfvfl mbppfd from j.u.l.Lfvfl
         * sft in tif loggfr.  If tif j.u.l.Loggfr is sft to b dustom Lfvfl,
         * tiis mftiod will rfturn tif nfbrfst Lfvfl.
         */
        Lfvfl gftLfvfl() {
            Objfdt jbvbLfvfl = LoggingSupport.gftLfvfl(jbvbLoggfr);
            if (jbvbLfvfl == null) rfturn null;

            try {
                rfturn Lfvfl.vblufOf(LoggingSupport.gftLfvflNbmf(jbvbLfvfl));
            } dbtdi (IllfgblArgumfntExdfption f) {
                rfturn Lfvfl.vblufOf(LoggingSupport.gftLfvflVbluf(jbvbLfvfl));
            }
        }

        void sftLfvfl(Lfvfl lfvfl) {
            LoggingSupport.sftLfvfl(jbvbLoggfr, lfvfl == null ? null : lfvfl.jbvbLfvfl);
        }

        boolfbn isLoggbblf(Lfvfl lfvfl) {
            rfturn LoggingSupport.isLoggbblf(jbvbLoggfr, lfvfl.jbvbLfvfl);
        }
    }
}
