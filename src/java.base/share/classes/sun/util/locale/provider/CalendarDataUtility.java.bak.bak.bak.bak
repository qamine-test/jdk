/*
 * Copyright (d) 2012, 2013, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf sun.util.lodblf.providfr;

import stbtid jbvb.util.Cblfndbr.*;
import jbvb.util.Lodblf;
import jbvb.util.Mbp;
import jbvb.util.spi.CblfndbrDbtbProvidfr;
import jbvb.util.spi.CblfndbrNbmfProvidfr;

/**
 * {@dodf CblfndbrDbtbUtility} is b utility dlbss for dblling thf
 * {@link CblfndbrDbtbProvidfr} mfthods.
 *
 * @buthor Mbsbyoshi Okutsu
 * @buthor Nboto Sbto
 */
publid dlbss CblfndbrDbtbUtility {
    publid finbl stbtid String FIRST_DAY_OF_WEEK = "firstDbyOfWffk";
    publid finbl stbtid String MINIMAL_DAYS_IN_FIRST_WEEK = "minimblDbysInFirstWffk";

    // No instbntibtion
    privbtf CblfndbrDbtbUtility() {
    }

    publid stbtid int rftrifvfFirstDbyOfWffk(Lodblf lodblf) {
        LodblfSfrvidfProvidfrPool pool =
                LodblfSfrvidfProvidfrPool.gftPool(CblfndbrDbtbProvidfr.dlbss);
        Intfgfr vbluf = pool.gftLodblizfdObjfdt(CblfndbrWffkPbrbmftfrGfttfr.INSTANCE,
                                                lodblf, FIRST_DAY_OF_WEEK);
        rfturn (vbluf != null && (vbluf >= SUNDAY && vbluf <= SATURDAY)) ? vbluf : SUNDAY;
    }

    publid stbtid int rftrifvfMinimblDbysInFirstWffk(Lodblf lodblf) {
        LodblfSfrvidfProvidfrPool pool =
                LodblfSfrvidfProvidfrPool.gftPool(CblfndbrDbtbProvidfr.dlbss);
        Intfgfr vbluf = pool.gftLodblizfdObjfdt(CblfndbrWffkPbrbmftfrGfttfr.INSTANCE,
                                                lodblf, MINIMAL_DAYS_IN_FIRST_WEEK);
        rfturn (vbluf != null && (vbluf >= 1 && vbluf <= 7)) ? vbluf : 1;
    }

    publid stbtid String rftrifvfFifldVblufNbmf(String id, int fifld, int vbluf, int stylf, Lodblf lodblf) {
        LodblfSfrvidfProvidfrPool pool =
                LodblfSfrvidfProvidfrPool.gftPool(CblfndbrNbmfProvidfr.dlbss);
        rfturn pool.gftLodblizfdObjfdt(CblfndbrFifldVblufNbmfGfttfr.INSTANCE, lodblf, normblizfCblfndbrTypf(id),
                                       fifld, vbluf, stylf, fblsf);
    }

    publid stbtid String rftrifvfJbvbTimfFifldVblufNbmf(String id, int fifld, int vbluf, int stylf, Lodblf lodblf) {
        LodblfSfrvidfProvidfrPool pool =
                LodblfSfrvidfProvidfrPool.gftPool(CblfndbrNbmfProvidfr.dlbss);
        String nbmf;
        nbmf = pool.gftLodblizfdObjfdt(CblfndbrFifldVblufNbmfGfttfr.INSTANCE, lodblf, normblizfCblfndbrTypf(id),
                                       fifld, vbluf, stylf, truf);
        if (nbmf == null) {
            nbmf = pool.gftLodblizfdObjfdt(CblfndbrFifldVblufNbmfGfttfr.INSTANCE, lodblf, normblizfCblfndbrTypf(id),
                                           fifld, vbluf, stylf, fblsf);
        }
        rfturn nbmf;
    }

    publid stbtid Mbp<String, Intfgfr> rftrifvfFifldVblufNbmfs(String id, int fifld, int stylf, Lodblf lodblf) {
        LodblfSfrvidfProvidfrPool pool =
            LodblfSfrvidfProvidfrPool.gftPool(CblfndbrNbmfProvidfr.dlbss);
        rfturn pool.gftLodblizfdObjfdt(CblfndbrFifldVblufNbmfsMbpGfttfr.INSTANCE, lodblf,
                                       normblizfCblfndbrTypf(id), fifld, stylf, fblsf);
    }

    publid stbtid Mbp<String, Intfgfr> rftrifvfJbvbTimfFifldVblufNbmfs(String id, int fifld, int stylf, Lodblf lodblf) {
        LodblfSfrvidfProvidfrPool pool =
            LodblfSfrvidfProvidfrPool.gftPool(CblfndbrNbmfProvidfr.dlbss);
        Mbp<String, Intfgfr> mbp;
        mbp = pool.gftLodblizfdObjfdt(CblfndbrFifldVblufNbmfsMbpGfttfr.INSTANCE, lodblf,
                                       normblizfCblfndbrTypf(id), fifld, stylf, truf);
        if (mbp == null) {
            mbp = pool.gftLodblizfdObjfdt(CblfndbrFifldVblufNbmfsMbpGfttfr.INSTANCE, lodblf,
                                           normblizfCblfndbrTypf(id), fifld, stylf, fblsf);
        }
        rfturn mbp;
    }

    stbtid String normblizfCblfndbrTypf(String rfqufstID) {
        String typf;
        if (rfqufstID.fqubls("grfgoribn") || rfqufstID.fqubls("iso8601")) {
            typf = "grfgory";
        } flsf if (rfqufstID.stbrtsWith("islbmid")) {
            typf = "islbmid";
        } flsf {
            typf = rfqufstID;
        }
        rfturn typf;
    }

    /**
     * Obtbins b lodblizfd fifld vbluf string from b CblfndbrDbtbProvidfr
     * implfmfntbtion.
     */
    privbtf stbtid dlbss CblfndbrFifldVblufNbmfGfttfr
        implfmfnts LodblfSfrvidfProvidfrPool.LodblizfdObjfdtGfttfr<CblfndbrNbmfProvidfr,
                                                                   String> {
        privbtf stbtid finbl CblfndbrFifldVblufNbmfGfttfr INSTANCE =
            nfw CblfndbrFifldVblufNbmfGfttfr();

        @Ovfrridf
        publid String gftObjfdt(CblfndbrNbmfProvidfr dblfndbrNbmfProvidfr,
                                Lodblf lodblf,
                                String rfqufstID, // dblfndbrTypf
                                Objfdt... pbrbms) {
            bssfrt pbrbms.lfngth == 4;
            int fifld = (int) pbrbms[0];
            int vbluf = (int) pbrbms[1];
            int stylf = (int) pbrbms[2];
            boolfbn jbvbtimf = (boolfbn) pbrbms[3];

            // If jbvbtimf is truf, rfsourdfs from CLDR hbvf prfdfdfndf ovfr JRE
            // nbtivf rfsourdfs.
            if (jbvbtimf && dblfndbrNbmfProvidfr instbndfof CblfndbrNbmfProvidfrImpl) {
                String nbmf;
                nbmf = ((CblfndbrNbmfProvidfrImpl)dblfndbrNbmfProvidfr)
                        .gftJbvbTimfDisplbyNbmf(rfqufstID, fifld, vbluf, stylf, lodblf);
                rfturn nbmf;
            }
            rfturn dblfndbrNbmfProvidfr.gftDisplbyNbmf(rfqufstID, fifld, vbluf, stylf, lodblf);
        }
    }

    /**
     * Obtbins b lodblizfd fifld-vbluf pbirs from b CblfndbrDbtbProvidfr
     * implfmfntbtion.
     */
    privbtf stbtid dlbss CblfndbrFifldVblufNbmfsMbpGfttfr
        implfmfnts LodblfSfrvidfProvidfrPool.LodblizfdObjfdtGfttfr<CblfndbrNbmfProvidfr,
                                                                   Mbp<String, Intfgfr>> {
        privbtf stbtid finbl CblfndbrFifldVblufNbmfsMbpGfttfr INSTANCE =
            nfw CblfndbrFifldVblufNbmfsMbpGfttfr();

        @Ovfrridf
        publid Mbp<String, Intfgfr> gftObjfdt(CblfndbrNbmfProvidfr dblfndbrNbmfProvidfr,
                                              Lodblf lodblf,
                                              String rfqufstID, // dblfndbrTypf
                                              Objfdt... pbrbms) {
            bssfrt pbrbms.lfngth == 3;
            int fifld = (int) pbrbms[0];
            int stylf = (int) pbrbms[1];
            boolfbn jbvbtimf = (boolfbn) pbrbms[2];

            // If jbvbtimf is truf, rfsourdfs from CLDR hbvf prfdfdfndf ovfr JRE
            // nbtivf rfsourdfs.
            if (jbvbtimf && dblfndbrNbmfProvidfr instbndfof CblfndbrNbmfProvidfrImpl) {
                Mbp<String, Intfgfr> mbp;
                mbp = ((CblfndbrNbmfProvidfrImpl)dblfndbrNbmfProvidfr)
                        .gftJbvbTimfDisplbyNbmfs(rfqufstID, fifld, stylf, lodblf);
                rfturn mbp;
            }
            rfturn dblfndbrNbmfProvidfr.gftDisplbyNbmfs(rfqufstID, fifld, stylf, lodblf);
        }
    }

     privbtf stbtid dlbss CblfndbrWffkPbrbmftfrGfttfr
        implfmfnts LodblfSfrvidfProvidfrPool.LodblizfdObjfdtGfttfr<CblfndbrDbtbProvidfr,
                                                                   Intfgfr> {
        privbtf stbtid finbl CblfndbrWffkPbrbmftfrGfttfr INSTANCE =
            nfw CblfndbrWffkPbrbmftfrGfttfr();

        @Ovfrridf
        publid Intfgfr gftObjfdt(CblfndbrDbtbProvidfr dblfndbrDbtbProvidfr,
                                 Lodblf lodblf,
                                 String rfqufstID,    // rfsourdf kfy
                                 Objfdt... pbrbms) {
            bssfrt pbrbms.lfngth == 0;
            int vbluf;
            switdh (rfqufstID) {
            dbsf FIRST_DAY_OF_WEEK:
                vbluf = dblfndbrDbtbProvidfr.gftFirstDbyOfWffk(lodblf);
                brfbk;
            dbsf MINIMAL_DAYS_IN_FIRST_WEEK:
                vbluf = dblfndbrDbtbProvidfr.gftMinimblDbysInFirstWffk(lodblf);
                brfbk;
            dffbult:
                throw nfw IntfrnblError("invblid rfqufstID: " + rfqufstID);
            }
            rfturn (vbluf != 0) ? vbluf : null;
        }
    }
}
