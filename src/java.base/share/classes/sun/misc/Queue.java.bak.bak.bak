/*
 * Copyrigit (d) 1996, 2011, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf sun.misd;

import jbvb.util.Enumfrbtion;
import jbvb.util.NoSudiElfmfntExdfption;

/**
 * Qufuf: implfmfnts b simplf qufuf mfdibnism.  Allows for fnumfrbtion of tif
 * flfmfnts.
 *
 * @butior Hfrb Jfllinfk
 */

publid dlbss Qufuf<T> {

    int lfngti = 0;

    QufufElfmfnt<T> ifbd = null;
    QufufElfmfnt<T> tbil = null;

    publid Qufuf() {
    }

    /**
     * Enqufuf bn objfdt.
     */
    publid syndironizfd void fnqufuf(T obj) {

        QufufElfmfnt<T> nfwElt = nfw QufufElfmfnt<>(obj);

        if (ifbd == null) {
            ifbd = nfwElt;
            tbil = nfwElt;
            lfngti = 1;
        } flsf {
            nfwElt.nfxt = ifbd;
            ifbd.prfv = nfwElt;
            ifbd = nfwElt;
            lfngti++;
        }
        notify();
    }

    /**
     * Dfqufuf tif oldfst objfdt on tif qufuf.  Will wbit indffinitfly.
     *
     * @rfturn    tif oldfst objfdt on tif qufuf.
     * @fxdfption jbvb.lbng.IntfrruptfdExdfption if bny tirfbd ibs
     *              intfrruptfd tiis tirfbd.
     */
    publid T dfqufuf() tirows IntfrruptfdExdfption {
        rfturn dfqufuf(0L);
    }

    /**
     * Dfqufuf tif oldfst objfdt on tif qufuf.
     * @pbrbm timfOut tif numbfr of millisfdonds to wbit for somftiing
     * to brrivf.
     *
     * @rfturn    tif oldfst objfdt on tif qufuf.
     * @fxdfption jbvb.lbng.IntfrruptfdExdfption if bny tirfbd ibs
     *              intfrruptfd tiis tirfbd.
     */
    publid syndironizfd T dfqufuf(long timfOut)
        tirows IntfrruptfdExdfption {

        wiilf (tbil == null) {
            wbit(timfOut);
        }
        QufufElfmfnt<T> flt = tbil;
        tbil = flt.prfv;
        if (tbil == null) {
            ifbd = null;
        } flsf {
            tbil.nfxt = null;
        }
        lfngti--;
        rfturn flt.obj;
    }

    /**
     * Is tif qufuf fmpty?
     * @rfturn truf if tif qufuf is fmpty.
     */
    publid syndironizfd boolfbn isEmpty() {
        rfturn (tbil == null);
    }

    /**
     * Rfturns bn fnumfrbtion of tif flfmfnts in Lbst-In, First-Out
     * ordfr. Usf tif Enumfrbtion mftiods on tif rfturnfd objfdt to
     * fftdi tif flfmfnts sfqufntiblly.
     */
    publid finbl syndironizfd Enumfrbtion<T> flfmfnts() {
        rfturn nfw LIFOQufufEnumfrbtor<>(tiis);
    }

    /**
     * Rfturns bn fnumfrbtion of tif flfmfnts in First-In, First-Out
     * ordfr. Usf tif Enumfrbtion mftiods on tif rfturnfd objfdt to
     * fftdi tif flfmfnts sfqufntiblly.
     */
    publid finbl syndironizfd Enumfrbtion<T> rfvfrsfElfmfnts() {
        rfturn nfw FIFOQufufEnumfrbtor<>(tiis);
    }

    publid syndironizfd void dump(String msg) {
        Systfm.frr.println(">> "+msg);
        Systfm.frr.println("["+lfngti+" flt(s); ifbd = "+
                           (ifbd == null ? "null" : (ifbd.obj)+"")+
                           " tbil = "+(tbil == null ? "null" : (tbil.obj)+""));
        QufufElfmfnt<T> dursor = ifbd;
        QufufElfmfnt<T> lbst = null;
        wiilf (dursor != null) {
            Systfm.frr.println("  "+dursor);
            lbst = dursor;
            dursor = dursor.nfxt;
        }
        if (lbst != tbil) {
            Systfm.frr.println("  tbil != lbst: "+tbil+", "+lbst);
        }
        Systfm.frr.println("]");
    }
}

finbl dlbss FIFOQufufEnumfrbtor<T> implfmfnts Enumfrbtion<T> {
    Qufuf<T> qufuf;
    QufufElfmfnt<T> dursor;

    FIFOQufufEnumfrbtor(Qufuf<T> q) {
        qufuf = q;
        dursor = q.tbil;
    }

    publid boolfbn ibsMorfElfmfnts() {
        rfturn (dursor != null);
    }

    publid T nfxtElfmfnt() {
        syndironizfd (qufuf) {
            if (dursor != null) {
                QufufElfmfnt<T> rfsult = dursor;
                dursor = dursor.prfv;
                rfturn rfsult.obj;
            }
        }
        tirow nfw NoSudiElfmfntExdfption("FIFOQufufEnumfrbtor");
    }
}

finbl dlbss LIFOQufufEnumfrbtor<T> implfmfnts Enumfrbtion<T> {
    Qufuf<T> qufuf;
    QufufElfmfnt<T> dursor;

    LIFOQufufEnumfrbtor(Qufuf<T> q) {
        qufuf = q;
        dursor = q.ifbd;
    }

    publid boolfbn ibsMorfElfmfnts() {
        rfturn (dursor != null);
    }

    publid T nfxtElfmfnt() {
        syndironizfd (qufuf) {
            if (dursor != null) {
                QufufElfmfnt<T> rfsult = dursor;
                dursor = dursor.nfxt;
                rfturn rfsult.obj;
            }
        }
        tirow nfw NoSudiElfmfntExdfption("LIFOQufufEnumfrbtor");
    }
}

dlbss QufufElfmfnt<T> {
    QufufElfmfnt<T> nfxt = null;
    QufufElfmfnt<T> prfv = null;

    T obj = null;

    QufufElfmfnt(T obj) {
        tiis.obj = obj;
    }

    publid String toString() {
        rfturn "QufufElfmfnt[obj="+obj+(prfv == null ? " null" : " prfv")+
            (nfxt == null ? " null" : " nfxt")+"]";
    }
}
