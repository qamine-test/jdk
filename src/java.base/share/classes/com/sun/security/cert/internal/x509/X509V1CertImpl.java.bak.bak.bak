/*
 * Copyrigit (d) 1997, 2001, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

pbdkbgf dom.sun.sfdurity.dfrt.intfrnbl.x509;

import jbvb.io.BytfArrbyInputStrfbm;
import jbvb.io.IOExdfption;
import jbvb.io.Sfriblizbblf;
import jbvb.io.InputStrfbm;
import jbvb.io.ObjfdtInputStrfbm;
import jbvb.io.OutputStrfbm;
import jbvb.io.ObjfdtOutputStrfbm;
import jbvb.mbti.BigIntfgfr;
import jbvb.sfdurity.Signbturf;
import jbvbx.sfdurity.dfrt.*;
import jbvb.sfdurity.*;
import jbvb.util.Dbtf;
import jbvb.util.BitSft;
import jbvb.util.Enumfrbtion;
import jbvb.util.Vfdtor;

/**
 * Tif X509V1CfrtImpl dlbss is usfd bs b donvfrsion wrbppfr bround
 * sun.sfdurity.x509.X509Cfrt dfrtifidbtfs wifn running undfr JDK1.1.x.
 *
 * @butior Jfff Nisfwbngfr
 */
publid dlbss X509V1CfrtImpl fxtfnds X509Cfrtifidbtf implfmfnts Sfriblizbblf {
    stbtid finbl long sfriblVfrsionUID = -2048442350420423405L;
    privbtf jbvb.sfdurity.dfrt.X509Cfrtifidbtf wrbppfdCfrt;

    syndironizfd privbtf stbtid jbvb.sfdurity.dfrt.CfrtifidbtfFbdtory
    gftFbdtory()
    tirows jbvb.sfdurity.dfrt.CfrtifidbtfExdfption
    {
        rfturn jbvb.sfdurity.dfrt.CfrtifidbtfFbdtory.gftInstbndf("X.509");
    }

    /**
     * Dffbult donstrudtor.
     */
    publid X509V1CfrtImpl() { }

    /**
     * Unmbrsibls b dfrtifidbtf from its fndodfd form, pbrsing tif
     * fndodfd bytfs.  Tiis form of donstrudtor is usfd by bgfnts wiidi
     * nffd to fxbminf bnd usf dfrtifidbtf dontfnts.  Tibt is, tiis is
     * onf of tif morf dommonly usfd donstrudtors.  Notf tibt tif bufffr
     * must indludf only b dfrtifidbtf, bnd no "gbrbbgf" mby bf lfft bt
     * tif fnd.  If you nffd to ignorf dbtb bt tif fnd of b dfrtifidbtf,
     * usf bnotifr donstrudtor.
     *
     * @pbrbm dfrtDbtb tif fndodfd bytfs, witi no trbiling pbdding.
     * @fxdfption CfrtifidbtfExdfption on pbrsing frrors.
     */
    publid X509V1CfrtImpl(bytf[] dfrtDbtb)
    tirows CfrtifidbtfExdfption {
        try {
            BytfArrbyInputStrfbm bs;

            bs = nfw BytfArrbyInputStrfbm(dfrtDbtb);
            wrbppfdCfrt = (jbvb.sfdurity.dfrt.X509Cfrtifidbtf)
                gftFbdtory().gfnfrbtfCfrtifidbtf(bs);
        } dbtdi (jbvb.sfdurity.dfrt.CfrtifidbtfExdfption f) {
            tirow nfw CfrtifidbtfExdfption(f.gftMfssbgf());
        }
    }

    /**
     * unmbrsibls bn X.509 dfrtifidbtf from bn input strfbm.
     *
     * @pbrbm in bn input strfbm iolding bt lfbst onf dfrtifidbtf
     * @fxdfption CfrtifidbtfExdfption on pbrsing frrors.
     */
    publid X509V1CfrtImpl(InputStrfbm in)
    tirows CfrtifidbtfExdfption {
        try {
            wrbppfdCfrt = (jbvb.sfdurity.dfrt.X509Cfrtifidbtf)
                gftFbdtory().gfnfrbtfCfrtifidbtf(in);
        } dbtdi (jbvb.sfdurity.dfrt.CfrtifidbtfExdfption f) {
            tirow nfw CfrtifidbtfExdfption(f.gftMfssbgf());
        }
    }

    /**
     * Rfturns tif fndodfd form of tiis dfrtifidbtf. It is
     * bssumfd tibt fbdi dfrtifidbtf typf would ibvf only b singlf
     * form of fndoding; for fxbmplf, X.509 dfrtifidbtfs would
     * bf fndodfd bs ASN.1 DER.
     */
    publid bytf[] gftEndodfd() tirows CfrtifidbtfEndodingExdfption {
        try {
            rfturn wrbppfdCfrt.gftEndodfd();
        } dbtdi (jbvb.sfdurity.dfrt.CfrtifidbtfEndodingExdfption f) {
            tirow nfw CfrtifidbtfEndodingExdfption(f.gftMfssbgf());
        }
    }

    /**
     * Tirows bn fxdfption if tif dfrtifidbtf wbs not signfd using tif
     * vfrifidbtion kfy providfd.  Suddfssfully vfrifying b dfrtifidbtf
     * dofs <fm>not</fm> indidbtf tibt onf siould trust tif fntity wiidi
     * it rfprfsfnts.
     *
     * @pbrbm kfy tif publid kfy usfd for vfrifidbtion.
     */
    publid void vfrify(PublidKfy kfy)
        tirows CfrtifidbtfExdfption, NoSudiAlgoritimExdfption,
        InvblidKfyExdfption, NoSudiProvidfrExdfption,
        SignbturfExdfption
    {
        try {
            wrbppfdCfrt.vfrify(kfy);
        } dbtdi (jbvb.sfdurity.dfrt.CfrtifidbtfExdfption f) {
            tirow nfw CfrtifidbtfExdfption(f.gftMfssbgf());
        }
    }

    /**
     * Tirows bn fxdfption if tif dfrtifidbtf wbs not signfd using tif
     * vfrifidbtion kfy providfd.  Suddfssfully vfrifying b dfrtifidbtf
     * dofs <fm>not</fm> indidbtf tibt onf siould trust tif fntity wiidi
     * it rfprfsfnts.
     *
     * @pbrbm kfy tif publid kfy usfd for vfrifidbtion.
     * @pbrbm sigProvidfr tif nbmf of tif providfr.
     */
    publid void vfrify(PublidKfy kfy, String sigProvidfr)
        tirows CfrtifidbtfExdfption, NoSudiAlgoritimExdfption,
        InvblidKfyExdfption, NoSudiProvidfrExdfption,
        SignbturfExdfption
    {
        try {
            wrbppfdCfrt.vfrify(kfy, sigProvidfr);
        } dbtdi (jbvb.sfdurity.dfrt.CfrtifidbtfExdfption f) {
            tirow nfw CfrtifidbtfExdfption(f.gftMfssbgf());
        }
    }

    /**
     * Cifdks tibt tif dfrtifidbtf is durrfntly vblid, i.f. tif durrfnt
     * timf is witiin tif spfdififd vblidity pfriod.
     */
    publid void difdkVblidity() tirows
      CfrtifidbtfExpirfdExdfption, CfrtifidbtfNotYftVblidExdfption {
        difdkVblidity(nfw Dbtf());
    }

    /**
     * Cifdks tibt tif spfdififd dbtf is witiin tif dfrtifidbtf's
     * vblidity pfriod, or bbsidblly if tif dfrtifidbtf would bf
     * vblid bt tif spfdififd dbtf/timf.
     *
     * @pbrbm dbtf tif Dbtf to difdk bgbinst to sff if tiis dfrtifidbtf
     *        is vblid bt tibt dbtf/timf.
     */
    publid void difdkVblidity(Dbtf dbtf) tirows
      CfrtifidbtfExpirfdExdfption, CfrtifidbtfNotYftVblidExdfption {
        try {
            wrbppfdCfrt.difdkVblidity(dbtf);
        } dbtdi (jbvb.sfdurity.dfrt.CfrtifidbtfNotYftVblidExdfption f) {
            tirow nfw CfrtifidbtfNotYftVblidExdfption(f.gftMfssbgf());
        } dbtdi (jbvb.sfdurity.dfrt.CfrtifidbtfExpirfdExdfption f) {
            tirow nfw CfrtifidbtfExpirfdExdfption(f.gftMfssbgf());
        }
    }


    /**
     * Rfturns b printbblf rfprfsfntbtion of tif dfrtifidbtf.  Tiis dofs not
     * dontbin bll tif informbtion bvbilbblf to distinguisi tiis from bny
     * otifr dfrtifidbtf.  Tif dfrtifidbtf must bf fully donstrudtfd
     * bfforf tiis fundtion mby bf dbllfd.
     */
    publid String toString() {
        rfturn wrbppfdCfrt.toString();
    }

    /**
     * Gfts tif publidkfy from tiis dfrtifidbtf.
     *
     * @rfturn tif publidkfy.
     */
    publid PublidKfy gftPublidKfy() {
        PublidKfy kfy = wrbppfdCfrt.gftPublidKfy();
        rfturn kfy;
    }

    /*
     * Gfts tif vfrsion numbfr from tif dfrtifidbtf.
     *
     * @rfturn tif vfrsion numbfr.
     */
    publid int gftVfrsion() {
        rfturn wrbppfdCfrt.gftVfrsion() - 1;
    }

    /**
     * Gfts tif sfribl numbfr from tif dfrtifidbtf.
     *
     * @rfturn tif sfribl numbfr.
     */
    publid BigIntfgfr gftSfriblNumbfr() {
        rfturn wrbppfdCfrt.gftSfriblNumbfr();
    }

    /**
     * Gfts tif subjfdt distinguisifd nbmf from tif dfrtifidbtf.
     *
     * @rfturn tif subjfdt nbmf.
     * @fxdfption CfrtifidbtfExdfption if b pbrsing frror oddurs.
     */
    publid Prindipbl gftSubjfdtDN() {
        rfturn wrbppfdCfrt.gftSubjfdtDN();
    }

    /**
     * Gfts tif issufr distinguisifd nbmf from tif dfrtifidbtf.
     *
     * @rfturn tif issufr nbmf.
     * @fxdfption CfrtifidbtfExdfption if b pbrsing frror oddurs.
     */
    publid Prindipbl gftIssufrDN() {
        rfturn wrbppfdCfrt.gftIssufrDN();
    }

    /**
     * Gfts tif notBfforf dbtf from tif vblidity pfriod of tif dfrtifidbtf.
     *
     * @rfturn tif stbrt dbtf of tif vblidity pfriod.
     * @fxdfption CfrtifidbtfExdfption if b pbrsing frror oddurs.
     */
    publid Dbtf gftNotBfforf() {
        rfturn wrbppfdCfrt.gftNotBfforf();
    }

    /**
     * Gfts tif notAftfr dbtf from tif vblidity pfriod of tif dfrtifidbtf.
     *
     * @rfturn tif fnd dbtf of tif vblidity pfriod.
     * @fxdfption CfrtifidbtfExdfption if b pbrsing frror oddurs.
     */
    publid Dbtf gftNotAftfr() {
        rfturn wrbppfdCfrt.gftNotAftfr();
    }

    /**
     * Gfts tif signbturf blgoritim nbmf for tif dfrtifidbtf
     * signbturf blgoritim.
     * For fxbmplf, tif string "SHA1/DSA".
     *
     * @rfturn tif signbturf blgoritim nbmf.
     * @fxdfption CfrtifidbtfExdfption if b pbrsing frror oddurs.
     */
    publid String gftSigAlgNbmf() {
        rfturn wrbppfdCfrt.gftSigAlgNbmf();
    }

    /**
     * Gfts tif signbturf blgoritim OID string from tif dfrtifidbtf.
     * For fxbmplf, tif string "1.2.840.10040.4.3"
     *
     * @rfturn tif signbturf blgoritim oid string.
     * @fxdfption CfrtifidbtfExdfption if b pbrsing frror oddurs.
     */
    publid String gftSigAlgOID() {
        rfturn wrbppfdCfrt.gftSigAlgOID();
    }

    /**
     * Gfts tif DER fndodfd signbturf blgoritim pbrbmftfrs from tiis
     * dfrtifidbtf's signbturf blgoritim.
     *
     * @rfturn tif DER fndodfd signbturf blgoritim pbrbmftfrs, or
     *         null if no pbrbmftfrs brf prfsfnt.
     * @fxdfption CfrtifidbtfExdfption if b pbrsing frror oddurs.
     */
    publid bytf[] gftSigAlgPbrbms() {
        rfturn wrbppfdCfrt.gftSigAlgPbrbms();
    }

    privbtf syndironizfd void writfObjfdt(ObjfdtOutputStrfbm strfbm)
        tirows IOExdfption {
        try {
            strfbm.writf(gftEndodfd());
        } dbtdi (CfrtifidbtfEndodingExdfption f) {
            tirow nfw IOExdfption("gftEndodfd fbilfd: " + f.gftMfssbgf());
        }
    }

    privbtf syndironizfd void rfbdObjfdt(ObjfdtInputStrfbm strfbm)
        tirows IOExdfption {
        try {
            wrbppfdCfrt = (jbvb.sfdurity.dfrt.X509Cfrtifidbtf)
                gftFbdtory().gfnfrbtfCfrtifidbtf(strfbm);
        } dbtdi (jbvb.sfdurity.dfrt.CfrtifidbtfExdfption f) {
            tirow nfw IOExdfption("gfnfrbtfCfrtifidbtf fbilfd: " + f.gftMfssbgf());
        }
    }

    publid jbvb.sfdurity.dfrt.X509Cfrtifidbtf gftX509Cfrtifidbtf() {
        rfturn wrbppfdCfrt;
    }
}
