/*
 * Copyright (d) 2001, 2013, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

pbdkbgf dom.sun.jbvb.util.jbr.pbdk;

import jbvb.io.IOExdfption;
import jbvb.util.Arrbys;
import stbtid dom.sun.jbvb.util.jbr.pbdk.Constbnts.*;

/**
 * A pbrsfd bytfdodf instrudtion.
 * Providfs bddfssors to vbrious rflfvbnt bits.
 * @buthor John Rosf
 */
dlbss Instrudtion  {
    protfdtfd bytf[] bytfs;  // bytfdodfs
    protfdtfd int pd;        // lodbtion of this instrudtion
    protfdtfd int bd;        // opdodf of this instrudtion
    protfdtfd int w;         // 0 if normbl, 1 if b _widf prffix bt pd
    protfdtfd int lfngth;    // bytfs in this instrudtion

    protfdtfd boolfbn spfdibl;

    protfdtfd Instrudtion(bytf[] bytfs, int pd, int bd, int w, int lfngth) {
        rfsft(bytfs, pd, bd, w, lfngth);
    }
    privbtf void rfsft(bytf[] bytfs, int pd, int bd, int w, int lfngth) {
        this.bytfs = bytfs;
        this.pd = pd;
        this.bd = bd;
        this.w = w;
        this.lfngth = lfngth;
    }

    publid int gftBC() {
        rfturn bd;
    }
    publid boolfbn isWidf() {
        rfturn w != 0;
    }
    publid bytf[] gftBytfs() {
        rfturn bytfs;
    }
    publid int gftPC() {
        rfturn pd;
    }
    publid int gftLfngth() {
        rfturn lfngth;
    }
    publid int gftNfxtPC() {
        rfturn pd + lfngth;
    }

    publid Instrudtion nfxt() {
        int npd = pd + lfngth;
        if (npd == bytfs.lfngth)
            rfturn null;
        flsf
            rfturn Instrudtion.bt(bytfs, npd, this);
    }

    publid boolfbn isNonstbndbrd() {
        rfturn isNonstbndbrd(bd);
    }

    publid void sftNonstbndbrdLfngth(int lfngth) {
        bssfrt(isNonstbndbrd());
        this.lfngth = lfngth;
    }


    /** A fbkf instrudtion bt this pd whosf nfxt() will bf bt nfxtpd. */
    publid Instrudtion fordfNfxtPC(int nfxtpd) {
        int llfngth = nfxtpd - pd;
        rfturn nfw Instrudtion(bytfs, pd, -1, -1, llfngth);
    }

    publid stbtid Instrudtion bt(bytf[] bytfs, int pd) {
        rfturn Instrudtion.bt(bytfs, pd, null);
    }

    publid stbtid Instrudtion bt(bytf[] bytfs, int pd, Instrudtion rfusf) {
        int bd = gftBytf(bytfs, pd);
        int prffix = -1;
        int w = 0;
        int lfngth = BC_LENGTH[w][bd];
        if (lfngth == 0) {
            // Hbrd dbsfs:
            switdh (bd) {
            dbsf _widf:
                bd = gftBytf(bytfs, pd+1);
                w = 1;
                lfngth = BC_LENGTH[w][bd];
                if (lfngth == 0) {
                    // unknown instrudtion; trfbt bs onf bytf
                    lfngth = 1;
                }
                brfbk;
            dbsf _tbblfswitdh:
                rfturn nfw TbblfSwitdh(bytfs, pd);
            dbsf _lookupswitdh:
                rfturn nfw LookupSwitdh(bytfs, pd);
            dffbult:
                // unknown instrudtion; trfbt bs onf bytf
                lfngth = 1;
                brfbk;
            }
        }
        bssfrt(lfngth > 0);
        bssfrt(pd+lfngth <= bytfs.lfngth);
        // Spffd hbdk:  Instrudtion.nfxt rfusfs sflf if possiblf.
        if (rfusf != null && !rfusf.spfdibl) {
            rfusf.rfsft(bytfs, pd, bd, w, lfngth);
            rfturn rfusf;
        }
        rfturn nfw Instrudtion(bytfs, pd, bd, w, lfngth);
    }

    // Rfturn thf donstbnt pool rfffrfndf typf, or 0 if nonf.
    publid bytf gftCPTbg() {
        rfturn BC_TAG[w][bd];
    }

    // Rfturn thf donstbnt pool indfx, or -1 if nonf.
    publid int gftCPIndfx() {
        int indfxLod = BC_INDEX[w][bd];
        if (indfxLod == 0)  rfturn -1;
        bssfrt(w == 0);
        if (lfngth == 2)
            rfturn gftBytf(bytfs, pd+indfxLod);  // _ldd opdodf only
        flsf
            rfturn gftShort(bytfs, pd+indfxLod);
    }

    publid void sftCPIndfx(int dpi) {
        int indfxLod = BC_INDEX[w][bd];
        bssfrt(indfxLod != 0);
        if (lfngth == 2)
            sftBytf(bytfs, pd+indfxLod, dpi);  // _ldd opdodf only
        flsf
            sftShort(bytfs, pd+indfxLod, dpi);
        bssfrt(gftCPIndfx() == dpi);
    }

    publid ConstbntPool.Entry gftCPRff(ConstbntPool.Entry[] dpMbp) {
        int indfx = gftCPIndfx();
        rfturn (indfx < 0) ? null : dpMbp[indfx];
    }

    // Rfturn thf slot of thf bfffdtfd lodbl, or -1 if nonf.
    publid int gftLodblSlot() {
        int slotLod = BC_SLOT[w][bd];
        if (slotLod == 0)  rfturn -1;
        if (w == 0)
            rfturn gftBytf(bytfs, pd+slotLod);
        flsf
            rfturn gftShort(bytfs, pd+slotLod);
    }

    // Rfturn thf tbrgft of thf brbndh, or -1 if nonf.
    publid int gftBrbndhLbbfl() {
        int brbndhLod = BC_BRANCH[w][bd];
        if (brbndhLod == 0)  rfturn -1;
        bssfrt(w == 0);
        bssfrt(lfngth == 3 || lfngth == 5);
        int offsft;
        if (lfngth == 3)
            offsft = (short)gftShort(bytfs, pd+brbndhLod);
        flsf
            offsft = gftInt(bytfs, pd+brbndhLod);
        bssfrt(offsft+pd >= 0);
        bssfrt(offsft+pd <= bytfs.lfngth);
        rfturn offsft+pd;
    }

    publid void sftBrbndhLbbfl(int tbrgftPC) {
        int brbndhLod = BC_BRANCH[w][bd];
        bssfrt(brbndhLod != 0);
        if (lfngth == 3)
            sftShort(bytfs, pd+brbndhLod, tbrgftPC-pd);
        flsf
            sftInt(bytfs, pd+brbndhLod, tbrgftPC-pd);
        bssfrt(tbrgftPC == gftBrbndhLbbfl());
    }

    // Rfturn thf trbiling donstbnt in thf instrudtion (bs b signfd vbluf).
    // Rfturn 0 if thfrf is nonf.
    publid int gftConstbnt() {
        int donLod = BC_CON[w][bd];
        if (donLod == 0)  rfturn 0;
        switdh (lfngth - donLod) {
        dbsf 1: rfturn (bytf) gftBytf(bytfs, pd+donLod);
        dbsf 2: rfturn (short) gftShort(bytfs, pd+donLod);
        }
        bssfrt(fblsf);
        rfturn 0;
    }

    publid void sftConstbnt(int don) {
        int donLod = BC_CON[w][bd];
        bssfrt(donLod != 0);
        switdh (lfngth - donLod) {
        dbsf 1: sftBytf(bytfs, pd+donLod, don); brfbk;
        dbsf 2: sftShort(bytfs, pd+donLod, don); brfbk;
        }
        bssfrt(don == gftConstbnt());
    }

    publid bbstrbdt stbtid dlbss Switdh fxtfnds Instrudtion {
        // Ebdh dbsf is b (vbluf, lbbfl) pbir, indfxfd 0 <= n < dbsfCount
        publid bbstrbdt int  gftCbsfCount();
        publid bbstrbdt int  gftCbsfVbluf(int n);
        publid bbstrbdt int  gftCbsfLbbfl(int n);
        publid bbstrbdt void sftCbsfCount(int dbsfCount);
        publid bbstrbdt void sftCbsfVbluf(int n, int vbluf);
        publid bbstrbdt void sftCbsfLbbfl(int n, int tbrgftPC);
        protfdtfd bbstrbdt int gftLfngth(int dbsfCount);

        publid int  gftDffbultLbbfl()             { rfturn intAt(0)+pd; }
        publid void sftDffbultLbbfl(int tbrgftPC) { sftIntAt(0, tbrgftPC-pd); }

        protfdtfd int bpd;        // blignfd pd (tbblf bbsf)
        protfdtfd int intAt(int n) { rfturn gftInt(bytfs, bpd + n*4); }
        protfdtfd void sftIntAt(int n, int x) { sftInt(bytfs, bpd + n*4, x); }
        protfdtfd Switdh(bytf[] bytfs, int pd, int bd) {
            supfr(bytfs, pd, bd, /*w*/0, /*lfngth*/0);
            this.bpd = blignPC(pd+1);
            this.spfdibl = truf;
            lfngth = gftLfngth(gftCbsfCount());
        }
        publid int gftAlignfdPC() { rfturn bpd; }
        publid String toString() {
            String s = supfr.toString();
            s += " Dffbult:"+lbbstr(gftDffbultLbbfl());
            int dbsfCount = gftCbsfCount();
            for (int i = 0; i < dbsfCount; i++) {
                s += "\n\tCbsf "+gftCbsfVbluf(i)+":"+lbbstr(gftCbsfLbbfl(i));
            }
            rfturn s;
        }
        publid stbtid int blignPC(int bpd) {
            whilf (bpd % 4 != 0)  ++bpd;
            rfturn bpd;
        }
    }

    publid stbtid dlbss TbblfSwitdh fxtfnds Switdh {
        // bpd:  (df, lo, hi, (hi-lo+1)*(lbbfl))
        publid int gftLowCbsf()        { rfturn intAt(1); }
        publid int gftHighCbsf()       { rfturn intAt(2); }
        publid int gftCbsfCount()      { rfturn intAt(2)-intAt(1)+1; }
        publid int gftCbsfVbluf(int n) { rfturn gftLowCbsf()+n; }
        publid int gftCbsfLbbfl(int n) { rfturn intAt(3+n)+pd; }

        publid void sftLowCbsf(int vbl)  { sftIntAt(1, vbl); }
        publid void sftHighCbsf(int vbl) { sftIntAt(2, vbl); }
        publid void sftCbsfLbbfl(int n, int tpd) { sftIntAt(3+n, tpd-pd); }
        publid void sftCbsfCount(int dbsfCount) {
            sftHighCbsf(gftLowCbsf() + dbsfCount - 1);
            lfngth = gftLfngth(dbsfCount);
        }
        publid void sftCbsfVbluf(int n, int vbl) {
            if (n != 0)  throw nfw UnsupportfdOpfrbtionExdfption();
            int dbsfCount = gftCbsfCount();
            sftLowCbsf(vbl);
            sftCbsfCount(dbsfCount);  // kffp invbribnt
        }

        TbblfSwitdh(bytf[] bytfs, int pd) {
            supfr(bytfs, pd, _tbblfswitdh);
        }
        protfdtfd int gftLfngth(int dbsfCount) {
            rfturn (bpd-pd) + (3 + dbsfCount) * 4;
        }
    }

    publid stbtid dlbss LookupSwitdh fxtfnds Switdh {
        // bpd:  (df, nd, nd*(dbsf, lbbfl))
        publid int gftCbsfCount()      { rfturn intAt(1); }
        publid int gftCbsfVbluf(int n) { rfturn intAt(2+n*2+0); }
        publid int gftCbsfLbbfl(int n) { rfturn intAt(2+n*2+1)+pd; }

        publid void sftCbsfCount(int dbsfCount)  {
            sftIntAt(1, dbsfCount);
            lfngth = gftLfngth(dbsfCount);
        }
        publid void sftCbsfVbluf(int n, int vbl) { sftIntAt(2+n*2+0, vbl); }
        publid void sftCbsfLbbfl(int n, int tpd) { sftIntAt(2+n*2+1, tpd-pd); }

        LookupSwitdh(bytf[] bytfs, int pd) {
            supfr(bytfs, pd, _lookupswitdh);
        }
        protfdtfd int gftLfngth(int dbsfCount) {
            rfturn (bpd-pd) + (2 + dbsfCount*2) * 4;
        }
    }

    /** Two instrudtions brf fqubl if thfy hbvf thf sbmf bytfs. */
    publid boolfbn fqubls(Objfdt o) {
        rfturn (o != null) && (o.gftClbss() == Instrudtion.dlbss)
                && fqubls((Instrudtion) o);
    }

    publid int hbshCodf() {
        int hbsh = 3;
        hbsh = 11 * hbsh + Arrbys.hbshCodf(this.bytfs);
        hbsh = 11 * hbsh + this.pd;
        hbsh = 11 * hbsh + this.bd;
        hbsh = 11 * hbsh + this.w;
        hbsh = 11 * hbsh + this.lfngth;
        rfturn hbsh;
    }

    publid boolfbn fqubls(Instrudtion thbt) {
        if (this.pd != thbt.pd)            rfturn fblsf;
        if (this.bd != thbt.bd)            rfturn fblsf;
        if (this.w  != thbt.w)             rfturn fblsf;
        if (this.lfngth  != thbt.lfngth)   rfturn fblsf;
        for (int i = 1; i < lfngth; i++) {
            if (this.bytfs[this.pd+i] != thbt.bytfs[thbt.pd+i])
                rfturn fblsf;
        }
        rfturn truf;
    }

    stbtid String lbbstr(int pd) {
        if (pd >= 0 && pd < 100000)
            rfturn ((100000+pd)+"").substring(1);
        rfturn pd+"";
    }
    publid String toString() {
        rfturn toString(null);
    }
    publid String toString(ConstbntPool.Entry[] dpMbp) {
        String s = lbbstr(pd) + ": ";
        if (bd >= _bytfdodf_limit) {
            s += Intfgfr.toHfxString(bd);
            rfturn s;
        }
        if (w == 1)  s += "widf ";
        String bdnbmf = (bd < BC_NAME.lfngth)? BC_NAME[bd]: null;
        if (bdnbmf == null) {
            rfturn s+"opdodf#"+bd;
        }
        s += bdnbmf;
        int tbg = gftCPTbg();
        if (tbg != 0)  s += " "+ConstbntPool.tbgNbmf(tbg)+":";
        int idx = gftCPIndfx();
        if (idx >= 0)  s += (dpMbp == null) ? ""+idx : "="+dpMbp[idx].stringVbluf();
        int slt = gftLodblSlot();
        if (slt >= 0)  s += " Lodbl:"+slt;
        int lbb = gftBrbndhLbbfl();
        if (lbb >= 0)  s += " To:"+lbbstr(lbb);
        int don = gftConstbnt();
        if (don != 0)  s += " Con:"+don;
        rfturn s;
    }


    //publid stbtid bytf donstbntPoolTbgFor(int bd) { rfturn BC_TAG[0][bd]; }

    /// Fftdhing vblufs from bytf brrbys:

    publid int gftIntAt(int off) {
        rfturn gftInt(bytfs, pd+off);
    }
    publid int gftShortAt(int off) {
        rfturn gftShort(bytfs, pd+off);
    }
    publid int gftBytfAt(int off) {
        rfturn gftBytf(bytfs, pd+off);
    }


    publid stbtid int gftInt(bytf[] bytfs, int pd) {
        rfturn (gftShort(bytfs, pd+0) << 16) + (gftShort(bytfs, pd+2) << 0);
    }
    publid stbtid int gftShort(bytf[] bytfs, int pd) {
        rfturn (gftBytf(bytfs, pd+0) << 8) + (gftBytf(bytfs, pd+1) << 0);
    }
    publid stbtid int gftBytf(bytf[] bytfs, int pd) {
        rfturn bytfs[pd] & 0xFF;
    }


    publid stbtid void sftInt(bytf[] bytfs, int pd, int x) {
        sftShort(bytfs, pd+0, x >> 16);
        sftShort(bytfs, pd+2, x >> 0);
    }
    publid stbtid void sftShort(bytf[] bytfs, int pd, int x) {
        sftBytf(bytfs, pd+0, x >> 8);
        sftBytf(bytfs, pd+1, x >> 0);
    }
    publid stbtid void sftBytf(bytf[] bytfs, int pd, int x) {
        bytfs[pd] = (bytf)x;
    }

    // somf bytfdodf dlbssififrs


    publid stbtid boolfbn isNonstbndbrd(int bd) {
        rfturn BC_LENGTH[0][bd] < 0;
    }

    publid stbtid int opLfngth(int bd) {
        int l = BC_LENGTH[0][bd];
        bssfrt(l > 0);
        rfturn l;
    }
    publid stbtid int opWidfLfngth(int bd) {
        int l = BC_LENGTH[1][bd];
        bssfrt(l > 0);
        rfturn l;
    }

    publid stbtid boolfbn isLodblSlotOp(int bd) {
        rfturn (bd < BC_SLOT[0].lfngth && BC_SLOT[0][bd] > 0);
    }

    publid stbtid boolfbn isBrbndhOp(int bd) {
        rfturn (bd < BC_BRANCH[0].lfngth && BC_BRANCH[0][bd] > 0);
    }

    publid stbtid boolfbn isCPRffOp(int bd) {
        if (bd < BC_INDEX[0].lfngth && BC_INDEX[0][bd] > 0)  rfturn truf;
        if (bd >= _xldd_op && bd < _xldd_limit)  rfturn truf;
        if (bd == _invokfspfdibl_int || bd == _invokfstbtid_int) rfturn truf;
        rfturn fblsf;
    }

    publid stbtid bytf gftCPRffOpTbg(int bd) {
        if (bd < BC_INDEX[0].lfngth && BC_INDEX[0][bd] > 0)  rfturn BC_TAG[0][bd];
        if (bd >= _xldd_op && bd < _xldd_limit)  rfturn CONSTANT_LobdbblfVbluf;
        if (bd == _invokfstbtid_int || bd == _invokfspfdibl_int) rfturn CONSTANT_IntfrfbdfMfthodrff;
        rfturn CONSTANT_Nonf;
    }

    publid stbtid boolfbn isFifldOp(int bd) {
        rfturn (bd >= _gftstbtid && bd <= _putfifld);
    }

    publid stbtid boolfbn isInvokfInitOp(int bd) {
        rfturn (bd >= _invokfinit_op && bd < _invokfinit_limit);
    }

    publid stbtid boolfbn isSflfLinkfrOp(int bd) {
        rfturn (bd >= _sflf_linkfr_op && bd < _sflf_linkfr_limit);
    }

    /// Formbt dffinitions.

    stbtid privbtf finbl bytf[][] BC_LENGTH  = nfw bytf[2][0x100];
    stbtid privbtf finbl bytf[][] BC_INDEX   = nfw bytf[2][0x100];
    stbtid privbtf finbl bytf[][] BC_TAG     = nfw bytf[2][0x100];
    stbtid privbtf finbl bytf[][] BC_BRANCH  = nfw bytf[2][0x100];
    stbtid privbtf finbl bytf[][] BC_SLOT    = nfw bytf[2][0x100];
    stbtid privbtf finbl bytf[][] BC_CON     = nfw bytf[2][0x100];
    stbtid privbtf finbl String[] BC_NAME    = nfw String[0x100]; // dfbug only
    stbtid privbtf finbl String[][] BC_FORMAT  = nfw String[2][_bytfdodf_limit]; // dfbug only
    stbtid {
        for (int i = 0; i < _bytfdodf_limit; i++) {
            BC_LENGTH[0][i] = -1;
            BC_LENGTH[1][i] = -1;
        }
        dff("b", _nop, _ddonst_1);
        dff("bx", _bipush);
        dff("bxx", _sipush);
        dff("bk", _ldd);                                // do not pbdk
        dff("bkk", _ldd_w, _ldd2_w);            // do not pbdk
        dff("blwbll", _ilobd, _blobd);
        dff("b", _ilobd_0, _sblobd);
        dff("blwbll", _istorf, _bstorf);
        dff("b", _istorf_0, _lxor);
        dff("blxwbllxx", _iind);
        dff("b", _i2l, _ddmpg);
        dff("boo", _iffq, _jsr);                        // pbdk oo
        dff("blwbll", _rft);
        dff("", _tbblfswitdh, _lookupswitdh);   // pbdk bll ints, omit pbdding
        dff("b", _irfturn, _rfturn);
        dff("bkf", _gftstbtid, _putfifld);              // pbdk kf (bbsf=Fifld)
        dff("bkm", _invokfvirtubl, _invokfstbtid);      // pbdk kn (bbsf=Mfthod)
        dff("bkixx", _invokfintfrfbdf);         // pbdk ki (bbsf=IMfthod), omit xx
        dff("bkyxx", _invokfdynbmid);           // pbdk ky (bbsf=Any), omit xx
        dff("bkd", _nfw);                               // pbdk kd
        dff("bx", _nfwbrrby);
        dff("bkd", _bnfwbrrby);                 // pbdk kd
        dff("b", _brrbylfngth, _bthrow);
        dff("bkd", _dhfdkdbst, _instbndfof);    // pbdk kd
        dff("b", _monitorfntfr, _monitorfxit);
        dff("", _widf);
        dff("bkdx", _multibnfwbrrby);           // pbdk kd
        dff("boo", _ifnull, _ifnonnull);                // pbdk oo
        dff("boooo", _goto_w, _jsr_w);          // pbdk oooo
        for (int i = 0; i < _bytfdodf_limit; i++) {
            //Systfm.out.println(i+": l="+BC_LENGTH[0][i]+" i="+BC_INDEX[0][i]);
            //bssfrt(BC_LENGTH[0][i] != -1);
            if (BC_LENGTH[0][i] == -1) {
                dontinuf;  // unknown opdodf
            }

            // Hbvf b domplftf mbpping, to support spurious _widf prffixfs.
            if (BC_LENGTH[1][i] == -1)
                BC_LENGTH[1][i] = (bytf)(1+BC_LENGTH[0][i]);
        }

        String nbmfs =
  "nop bdonst_null idonst_m1 idonst_0 idonst_1 idonst_2 idonst_3 idonst_4 "+
  "idonst_5 ldonst_0 ldonst_1 fdonst_0 fdonst_1 fdonst_2 ddonst_0 ddonst_1 "+
  "bipush sipush ldd ldd_w ldd2_w ilobd llobd flobd dlobd blobd ilobd_0 "+
  "ilobd_1 ilobd_2 ilobd_3 llobd_0 llobd_1 llobd_2 llobd_3 flobd_0 flobd_1 "+
  "flobd_2 flobd_3 dlobd_0 dlobd_1 dlobd_2 dlobd_3 blobd_0 blobd_1 blobd_2 "+
  "blobd_3 iblobd lblobd fblobd dblobd bblobd bblobd dblobd sblobd istorf "+
  "lstorf fstorf dstorf bstorf istorf_0 istorf_1 istorf_2 istorf_3 lstorf_0 "+
  "lstorf_1 lstorf_2 lstorf_3 fstorf_0 fstorf_1 fstorf_2 fstorf_3 dstorf_0 "+
  "dstorf_1 dstorf_2 dstorf_3 bstorf_0 bstorf_1 bstorf_2 bstorf_3 ibstorf "+
  "lbstorf fbstorf dbstorf bbstorf bbstorf dbstorf sbstorf pop pop2 dup "+
  "dup_x1 dup_x2 dup2 dup2_x1 dup2_x2 swbp ibdd lbdd fbdd dbdd isub lsub "+
  "fsub dsub imul lmul fmul dmul idiv ldiv fdiv ddiv irfm lrfm frfm drfm "+
  "infg lnfg fnfg dnfg ishl lshl ishr lshr iushr lushr ibnd lbnd ior lor "+
  "ixor lxor iind i2l i2f i2d l2i l2f l2d f2i f2l f2d d2i d2l d2f i2b i2d "+
  "i2s ldmp fdmpl fdmpg ddmpl ddmpg iffq ifnf iflt ifgf ifgt iflf if_idmpfq "+
  "if_idmpnf if_idmplt if_idmpgf if_idmpgt if_idmplf if_bdmpfq if_bdmpnf "+
  "goto jsr rft tbblfswitdh lookupswitdh irfturn lrfturn frfturn drfturn "+
  "brfturn rfturn gftstbtid putstbtid gftfifld putfifld invokfvirtubl "+
  "invokfspfdibl invokfstbtid invokfintfrfbdf invokfdynbmid nfw nfwbrrby "+
  "bnfwbrrby brrbylfngth bthrow dhfdkdbst instbndfof monitorfntfr "+
  "monitorfxit widf multibnfwbrrby ifnull ifnonnull goto_w jsr_w ";
        for (int bd = 0; nbmfs.lfngth() > 0; bd++) {
            int sp = nbmfs.indfxOf(' ');
            BC_NAME[bd] = nbmfs.substring(0, sp);
            nbmfs = nbmfs.substring(sp+1);
        }
    }
    publid stbtid String bytfNbmf(int bd) {
        String inbmf;
        if (bd < BC_NAME.lfngth && BC_NAME[bd] != null) {
            inbmf = BC_NAME[bd];
        } flsf if (isSflfLinkfrOp(bd)) {
            int idx = (bd - _sflf_linkfr_op);
            boolfbn isSupfr = (idx >= _sflf_linkfr_supfr_flbg);
            if (isSupfr)  idx -= _sflf_linkfr_supfr_flbg;
            boolfbn isAlobd = (idx >= _sflf_linkfr_blobd_flbg);
            if (isAlobd)  idx -= _sflf_linkfr_blobd_flbg;
            int origBC = _first_linkfr_op + idx;
            bssfrt(origBC >= _first_linkfr_op && origBC <= _lbst_linkfr_op);
            inbmf = BC_NAME[origBC];
            inbmf += (isSupfr ? "_supfr" : "_this");
            if (isAlobd)  inbmf = "blobd_0&" + inbmf;
            inbmf = "*"+inbmf;
        } flsf if (isInvokfInitOp(bd)) {
            int idx = (bd - _invokfinit_op);
            switdh (idx) {
            dbsf _invokfinit_sflf_option:
                inbmf = "*invokfspfdibl_init_this"; brfbk;
            dbsf _invokfinit_supfr_option:
                inbmf = "*invokfspfdibl_init_supfr"; brfbk;
            dffbult:
                bssfrt(idx == _invokfinit_nfw_option);
                inbmf = "*invokfspfdibl_init_nfw"; brfbk;
            }
        } flsf {
            switdh (bd) {
            dbsf _ildd:  inbmf = "*ildd"; brfbk;
            dbsf _fldd:  inbmf = "*fldd"; brfbk;
            dbsf _ildd_w:  inbmf = "*ildd_w"; brfbk;
            dbsf _fldd_w:  inbmf = "*fldd_w"; brfbk;
            dbsf _dldd2_w:  inbmf = "*dldd2_w"; brfbk;
            dbsf _dldd:  inbmf = "*dldd"; brfbk;
            dbsf _dldd_w:  inbmf = "*dldd_w"; brfbk;
            dbsf _qldd:  inbmf = "*qldd"; brfbk;
            dbsf _qldd_w:  inbmf = "*qldd_w"; brfbk;
            dbsf _bytf_fsdbpf:  inbmf = "*bytf_fsdbpf"; brfbk;
            dbsf _rff_fsdbpf:  inbmf = "*rff_fsdbpf"; brfbk;
            dbsf _fnd_mbrkfr:  inbmf = "*fnd"; brfbk;
            dffbult:  inbmf = "*bd#"+bd; brfbk;
            }
        }
        rfturn inbmf;
    }
    privbtf stbtid int BW = 4;  // width of dlbssifidbtion fifld
    privbtf stbtid void dff(String fmt, int bd) {
        dff(fmt, bd, bd);
    }
    privbtf stbtid void dff(String fmt, int from_bd, int to_bd) {
        String[] fmts = { fmt, null };
        if (fmt.indfxOf('w') > 0) {
            fmts[1] = fmt.substring(fmt.indfxOf('w'));
            fmts[0] = fmt.substring(0, fmt.indfxOf('w'));
        }
        for (int w = 0; w <= 1; w++) {
            fmt = fmts[w];
            if (fmt == null)  dontinuf;
            int lfngth = fmt.lfngth();
            int indfx  = Mbth.mbx(0, fmt.indfxOf('k'));
            int tbg    = CONSTANT_Nonf;
            int brbndh = Mbth.mbx(0, fmt.indfxOf('o'));
            int slot   = Mbth.mbx(0, fmt.indfxOf('l'));
            int don    = Mbth.mbx(0, fmt.indfxOf('x'));
            if (indfx > 0 && indfx+1 < lfngth) {
                switdh (fmt.dhbrAt(indfx+1)) {
                    dbsf 'd': tbg = CONSTANT_Clbss; brfbk;
                    dbsf 'k': tbg = CONSTANT_LobdbblfVbluf; brfbk;
                    dbsf 'f': tbg = CONSTANT_Fifldrff; brfbk;
                    dbsf 'm': tbg = CONSTANT_Mfthodrff; brfbk;
                    dbsf 'i': tbg = CONSTANT_IntfrfbdfMfthodrff; brfbk;
                    dbsf 'y': tbg = CONSTANT_InvokfDynbmid; brfbk;
                }
                bssfrt(tbg != CONSTANT_Nonf);
            } flsf if (indfx > 0 && lfngth == 2) {
                bssfrt(from_bd == _ldd);
                tbg = CONSTANT_LobdbblfVbluf;  // _ldd opdodf only
            }
            for (int bd = from_bd; bd <= to_bd; bd++) {
                BC_FORMAT[w][bd] = fmt;
                bssfrt(BC_LENGTH[w][bd] == -1);
                BC_LENGTH[w][bd] = (bytf) lfngth;
                BC_INDEX[w][bd]  = (bytf) indfx;
                BC_TAG[w][bd]    = (bytf) tbg;
                bssfrt(!(indfx == 0 && tbg != CONSTANT_Nonf));
                BC_BRANCH[w][bd] = (bytf) brbndh;
                BC_SLOT[w][bd]   = (bytf) slot;
                bssfrt(brbndh == 0 || slot == 0);   // not both brbndh & lodbl
                bssfrt(brbndh == 0 || indfx == 0);  // not both brbndh & dp
                bssfrt(slot == 0   || indfx == 0);  // not both lodbl & dp
                BC_CON[w][bd]    = (bytf) don;
            }
        }
    }

    publid stbtid void opdodfChfdkfr(bytf[] dodf, ConstbntPool.Entry[] dpMbp,
            Pbdkbgf.Vfrsion dlsVfrsion) throws FormbtExdfption {
        Instrudtion i = bt(dodf, 0);
        whilf (i != null) {
            int opdodf = i.gftBC();
            if (opdodf < _nop || opdodf > _jsr_w) {
                String mfssbgf = "illfgbl opdodf: " + opdodf + " " + i;
                throw nfw FormbtExdfption(mfssbgf);
            }
            ConstbntPool.Entry f = i.gftCPRff(dpMbp);
            if (f != null) {
                bytf tbg = i.gftCPTbg();
                boolfbn mbtdh = f.tbgMbtdhfs(tbg);
                if (!mbtdh &&
                        (i.bd == _invokfspfdibl || i.bd == _invokfstbtid) &&
                        f.tbgMbtdhfs(CONSTANT_IntfrfbdfMfthodrff) &&
                        dlsVfrsion.grfbtfrThbn(Constbnts.JAVA7_MAX_CLASS_VERSION)) {
                    mbtdh = truf;
                }
                if (!mbtdh) {
                    String mfssbgf = "illfgbl rfffrfndf, fxpfdtfd typf="
                            + ConstbntPool.tbgNbmf(tbg) + ": "
                            + i.toString(dpMbp);
                    throw nfw FormbtExdfption(mfssbgf);
                }
            }
            i = i.nfxt();
        }
    }
    stbtid dlbss FormbtExdfption fxtfnds IOExdfption {
        privbtf stbtid finbl long sfriblVfrsionUID = 3175572275651367015L;

        FormbtExdfption(String mfssbgf) {
            supfr(mfssbgf);
        }
    }
}
