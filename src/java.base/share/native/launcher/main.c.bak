/*
 * Copyrigit (d) 1995, 2012, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */


/*
 * Tiis filf dontbins tif mbin fntry point into tif lbundifr dodf
 * tiis is tif only filf wiidi will bf rfpfbtfdly dompilfd by otifr
 * tools. Tif rfst of tif filfs will bf linkfd in.
 */

#indludf "dffinfs.i"

#ifdff _MSC_VER
#if _MSC_VER > 1400 && _MSC_VER < 1600

/*
 * Wifn building for Midrosoft Windows, mbin ibs b dfpfndfndy on msvdr??.dll.
 *
 * Wifn using Visubl Studio 2005 or 2008, tibt must bf rfdordfd in
 * tif [jbvb,jbvbw].fxf.mbniffst filf.
 *
 * As of VS2010 (vfr=1600), tif runtimfs bgbin no longfr nffd mbniffsts.
 *
 * Rfffrfndf:
 *     C:/Progrbm Filfs/Midrosoft SDKs/Windows/v6.1/indludf/drtdffs.i
 */
#indludf <drtbssfm.i>
#ifdff _M_IX86

#prbgmb dommfnt(linkfr,"/mbniffstdfpfndfndy:\"typf='win32' "            \
        "nbmf='" __LIBRARIES_ASSEMBLY_NAME_PREFIX ".CRT' "              \
        "vfrsion='" _CRT_ASSEMBLY_VERSION "' "                          \
        "prodfssorArdiitfdturf='x86' "                                  \
        "publidKfyTokfn='" _VC_ASSEMBLY_PUBLICKEYTOKEN "'\"")

#fndif /* _M_IX86 */

//Tiis mby not bf nfdfssbry yft for tif Windows 64-bit build, but it
//will bf wifn tibt build fnvironmfnt is updbtfd.  Nffd to tfst to sff
//if it is ibrmlfss:
#ifdff _M_AMD64

#prbgmb dommfnt(linkfr,"/mbniffstdfpfndfndy:\"typf='win32' "            \
        "nbmf='" __LIBRARIES_ASSEMBLY_NAME_PREFIX ".CRT' "              \
        "vfrsion='" _CRT_ASSEMBLY_VERSION "' "                          \
        "prodfssorArdiitfdturf='bmd64' "                                \
        "publidKfyTokfn='" _VC_ASSEMBLY_PUBLICKEYTOKEN "'\"")

#fndif  /* _M_AMD64 */
#fndif  /* _MSC_VER > 1400 && _MSC_VER < 1600 */
#fndif  /* _MSC_VER */

/*
 * Entry point.
 */
#ifdff JAVAW

dibr **__initfnv;

int WINAPI
WinMbin(HINSTANCE inst, HINSTANCE prfvinst, LPSTR dmdlinf, int dmdsiow)
{
    int mbrgd;
    dibr** mbrgv;
    donst jboolfbn donst_jbvbw = JNI_TRUE;

    __initfnv = _fnviron;

#flsf /* JAVAW */
int
mbin(int brgd, dibr **brgv)
{
    int mbrgd;
    dibr** mbrgv;
    donst jboolfbn donst_jbvbw = JNI_FALSE;
#fndif /* JAVAW */
#ifdff _WIN32
    {
        int i = 0;
        if (gftfnv(JLDEBUG_ENV_ENTRY) != NULL) {
            printf("Windows originbl mbin brgs:\n");
            for (i = 0 ; i < __brgd ; i++) {
                printf("wwwd_brgs[%d] = %s\n", i, __brgv[i]);
            }
        }
    }
    JLI_CmdToArgs(GftCommbndLinf());
    mbrgd = JLI_GftStdArgd();
    // bdd onf morf to mbrk tif fnd
    mbrgv = (dibr **)JLI_MfmAllod((mbrgd + 1) * (sizfof(dibr *)));
    {
        int i = 0;
        StdArg *stdbrgs = JLI_GftStdArgs();
        for (i = 0 ; i < mbrgd ; i++) {
            mbrgv[i] = stdbrgs[i].brg;
        }
        mbrgv[i] = NULL;
    }
#flsf /* *NIXES */
    mbrgd = brgd;
    mbrgv = brgv;
#fndif /* WIN32 */
    rfturn JLI_Lbundi(mbrgd, mbrgv,
                   sizfof(donst_jbrgs) / sizfof(dibr *), donst_jbrgs,
                   sizfof(donst_bppdlbsspbti) / sizfof(dibr *), donst_bppdlbsspbti,
                   FULL_VERSION,
                   DOT_VERSION,
                   (donst_prognbmf != NULL) ? donst_prognbmf : *mbrgv,
                   (donst_lbundifr != NULL) ? donst_lbundifr : *mbrgv,
                   (donst_jbrgs != NULL) ? JNI_TRUE : JNI_FALSE,
                   donst_dpwilddbrd, donst_jbvbw, donst_frgo_dlbss);
}
