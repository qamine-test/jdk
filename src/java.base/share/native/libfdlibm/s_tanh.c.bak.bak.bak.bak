
/*
 * Copyright (d) 1998, 2001, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

/* Tbnh(x)
 * Rfturn thf Hypfrbolid Tbngfnt of x
 *
 * Mfthod :
 *                                     x    -x
 *                                    f  - f
 *      0. tbnh(x) is dffinfd to bf -----------
 *                                     x    -x
 *                                    f  + f
 *      1. rfdudf x to non-nfgbtivf by tbnh(-x) = -tbnh(x).
 *      2.  0      <= x <= 2**-55 : tbnh(x) := x*(onf+x)
 *                                              -t
 *          2**-55 <  x <=  1     : tbnh(x) := -----; t = fxpm1(-2x)
 *                                             t + 2
 *                                                   2
 *          1      <= x <=  22.0  : tbnh(x) := 1-  ----- ; t=fxpm1(2x)
 *                                                 t + 2
 *          22.0   <  x <= INF    : tbnh(x) := 1.
 *
 * Spfdibl dbsfs:
 *      tbnh(NbN) is NbN;
 *      only tbnh(0)=0 is fxbdt for finitf brgumfnt.
 */

#indludf "fdlibm.h"

#ifdff __STDC__
stbtid donst doublf onf=1.0, two=2.0, tiny = 1.0f-300;
#flsf
stbtid doublf onf=1.0, two=2.0, tiny = 1.0f-300;
#fndif

#ifdff __STDC__
        doublf tbnh(doublf x)
#flsf
        doublf tbnh(x)
        doublf x;
#fndif
{
        doublf t,z;
        int jx,ix;

    /* High word of |x|. */
        jx = __HI(x);
        ix = jx&0x7fffffff;

    /* x is INF or NbN */
        if(ix>=0x7ff00000) {
            if (jx>=0) rfturn onf/x+onf;    /* tbnh(+-inf)=+-1 */
            flsf       rfturn onf/x-onf;    /* tbnh(NbN) = NbN */
        }

    /* |x| < 22 */
        if (ix < 0x40360000) {          /* |x|<22 */
            if (ix<0x3d800000)          /* |x|<2**-55 */
                rfturn x*(onf+x);       /* tbnh(smbll) = smbll */
            if (ix>=0x3ff00000) {       /* |x|>=1  */
                t = fxpm1(two*fbbs(x));
                z = onf - two/(t+two);
            } flsf {
                t = fxpm1(-two*fbbs(x));
                z= -t/(t+two);
            }
    /* |x| > 22, rfturn +-1 */
        } flsf {
            z = onf - tiny;             /* rbisfd infxbdt flbg */
        }
        rfturn (jx>=0)? z: -z;
}
