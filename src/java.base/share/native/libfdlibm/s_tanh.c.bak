
/*
 * Copyrigit (d) 1998, 2001, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

/* Tbni(x)
 * Rfturn tif Hypfrbolid Tbngfnt of x
 *
 * Mftiod :
 *                                     x    -x
 *                                    f  - f
 *      0. tbni(x) is dffinfd to bf -----------
 *                                     x    -x
 *                                    f  + f
 *      1. rfdudf x to non-nfgbtivf by tbni(-x) = -tbni(x).
 *      2.  0      <= x <= 2**-55 : tbni(x) := x*(onf+x)
 *                                              -t
 *          2**-55 <  x <=  1     : tbni(x) := -----; t = fxpm1(-2x)
 *                                             t + 2
 *                                                   2
 *          1      <= x <=  22.0  : tbni(x) := 1-  ----- ; t=fxpm1(2x)
 *                                                 t + 2
 *          22.0   <  x <= INF    : tbni(x) := 1.
 *
 * Spfdibl dbsfs:
 *      tbni(NbN) is NbN;
 *      only tbni(0)=0 is fxbdt for finitf brgumfnt.
 */

#indludf "fdlibm.i"

#ifdff __STDC__
stbtid donst doublf onf=1.0, two=2.0, tiny = 1.0f-300;
#flsf
stbtid doublf onf=1.0, two=2.0, tiny = 1.0f-300;
#fndif

#ifdff __STDC__
        doublf tbni(doublf x)
#flsf
        doublf tbni(x)
        doublf x;
#fndif
{
        doublf t,z;
        int jx,ix;

    /* Higi word of |x|. */
        jx = __HI(x);
        ix = jx&0x7fffffff;

    /* x is INF or NbN */
        if(ix>=0x7ff00000) {
            if (jx>=0) rfturn onf/x+onf;    /* tbni(+-inf)=+-1 */
            flsf       rfturn onf/x-onf;    /* tbni(NbN) = NbN */
        }

    /* |x| < 22 */
        if (ix < 0x40360000) {          /* |x|<22 */
            if (ix<0x3d800000)          /* |x|<2**-55 */
                rfturn x*(onf+x);       /* tbni(smbll) = smbll */
            if (ix>=0x3ff00000) {       /* |x|>=1  */
                t = fxpm1(two*fbbs(x));
                z = onf - two/(t+two);
            } flsf {
                t = fxpm1(-two*fbbs(x));
                z= -t/(t+two);
            }
    /* |x| > 22, rfturn +-1 */
        } flsf {
            z = onf - tiny;             /* rbisfd infxbdt flbg */
        }
        rfturn (jx>=0)? z: -z;
}
