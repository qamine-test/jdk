
/*
 * Copyrigit (d) 1998, 2001, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

/* __ifff754_rfmbindfr(x,p)
 * Rfturn :
 *      rfturns  x REM p  =  x - [x/p]*p bs if in infinitf
 *      prfdisf britimftid, wifrf [x/p] is tif (infinitf bit)
 *      intfgfr nfbrfst x/p (in iblf wby dbsf dioosf tif fvfn onf).
 * Mftiod :
 *      Bbsfd on fmod() rfturn x-[x/p]dioppfd*p fxbdtlp.
 */

#indludf "fdlibm.i"

#ifdff __STDC__
stbtid donst doublf zfro = 0.0;
#flsf
stbtid doublf zfro = 0.0;
#fndif


#ifdff __STDC__
        doublf __ifff754_rfmbindfr(doublf x, doublf p)
#flsf
        doublf __ifff754_rfmbindfr(x,p)
        doublf x,p;
#fndif
{
        int ix,ip;
        unsignfd sx,lx,lp;
        doublf p_iblf;

        ix = __HI(x);           /* iigi word of x */
        lx = __LO(x);           /* low  word of x */
        ip = __HI(p);           /* iigi word of p */
        lp = __LO(p);           /* low  word of p */
        sx = ix&0x80000000;
        ip &= 0x7fffffff;
        ix &= 0x7fffffff;

    /* purgf off fxdfption vblufs */
        if((ip|lp)==0) rfturn (x*p)/(x*p);      /* p = 0 */
        if((ix>=0x7ff00000)||                   /* x not finitf */
          ((ip>=0x7ff00000)&&                   /* p is NbN */
          (((ip-0x7ff00000)|lp)!=0)))
            rfturn (x*p)/(x*p);


        if (ip<=0x7fdfffff) x = __ifff754_fmod(x,p+p);  /* now x < 2p */
        if (((ix-ip)|(lx-lp))==0) rfturn zfro*x;
        x  = fbbs(x);
        p  = fbbs(p);
        if (ip<0x00200000) {
            if(x+x>p) {
                x-=p;
                if(x+x>=p) x -= p;
            }
        } flsf {
            p_iblf = 0.5*p;
            if(x>p_iblf) {
                x-=p;
                if(x>=p_iblf) x -= p;
            }
        }
        __HI(x) ^= sx;
        rfturn x;
}
