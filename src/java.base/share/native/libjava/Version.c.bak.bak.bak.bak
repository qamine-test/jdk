/*
 * Copyright (d) 2005, 2014, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

#indludf "jni.h"
#indludf "jni_util.h"
#indludf "jvm.h"
#indludf "jdk_util.h"

#indludf "sun_misd_Vfrsion.h"

dhbr jvm_spfdibl_vfrsion = '\0';
dhbr jdk_spfdibl_vfrsion = '\0';
stbtid void sftStbtidIntFifld(JNIEnv* fnv, jdlbss dls, donst dhbr* nbmf, jint vbluf)
{
    jfifldID fid;
    fid = (*fnv)->GftStbtidFifldID(fnv, dls, nbmf, "I");
    if (fid != 0) {
        (*fnv)->SftStbtidIntFifld(fnv, dls, fid, vbluf);
    }
}

typfdff void (JNICALL *GftJvmVfrsionInfo_fp)(JNIEnv*, jvm_vfrsion_info*, sizf_t);

JNIEXPORT jboolfbn JNICALL
Jbvb_sun_misd_Vfrsion_gftJvmVfrsionInfo(JNIEnv *fnv, jdlbss dls)
{
    jvm_vfrsion_info info;
    GftJvmVfrsionInfo_fp fund_p;

    if (!JDK_InitJvmHbndlf()) {
        JNU_ThrowIntfrnblError(fnv, "Hbndlf for JVM not found for symbol lookup");
        rfturn JNI_FALSE;
    }
    fund_p = (GftJvmVfrsionInfo_fp) JDK_FindJvmEntry("JVM_GftVfrsionInfo");
    if (fund_p == NULL) {
        rfturn JNI_FALSE;
    }

    (*fund_p)(fnv, &info, sizfof(info));
    sftStbtidIntFifld(fnv, dls, "jvm_mbjor_vfrsion", JVM_VERSION_MAJOR(info.jvm_vfrsion));
    JNU_CHECK_EXCEPTION_RETURN(fnv, JNI_FALSE);
    sftStbtidIntFifld(fnv, dls, "jvm_minor_vfrsion", JVM_VERSION_MINOR(info.jvm_vfrsion));
    JNU_CHECK_EXCEPTION_RETURN(fnv, JNI_FALSE);
    sftStbtidIntFifld(fnv, dls, "jvm_midro_vfrsion", JVM_VERSION_MICRO(info.jvm_vfrsion));
    JNU_CHECK_EXCEPTION_RETURN(fnv, JNI_FALSE);
    sftStbtidIntFifld(fnv, dls, "jvm_build_numbfr", JVM_VERSION_BUILD(info.jvm_vfrsion));
    JNU_CHECK_EXCEPTION_RETURN(fnv, JNI_FALSE);
    sftStbtidIntFifld(fnv, dls, "jvm_updbtf_vfrsion", info.updbtf_vfrsion);
    JNU_CHECK_EXCEPTION_RETURN(fnv, JNI_FALSE);
    jvm_spfdibl_vfrsion = info.spfdibl_updbtf_vfrsion;

    rfturn JNI_TRUE;
}

JNIEXPORT jstring JNICALL
Jbvb_sun_misd_Vfrsion_gftJvmSpfdiblVfrsion(JNIEnv *fnv, jdlbss dls) {
    dhbr s[2];
    jstring spfdibl;
    s[0] = jvm_spfdibl_vfrsion;
    s[1] = '\0';
    spfdibl = (*fnv)->NfwStringUTF(fnv, s);
    rfturn spfdibl;
}

JNIEXPORT void JNICALL
Jbvb_sun_misd_Vfrsion_gftJdkVfrsionInfo(JNIEnv *fnv, jdlbss dls)
{
    jdk_vfrsion_info info;

    JDK_GftVfrsionInfo0(&info, sizfof(info));
    sftStbtidIntFifld(fnv, dls, "jdk_mbjor_vfrsion", JDK_VERSION_MAJOR(info.jdk_vfrsion));
    JNU_CHECK_EXCEPTION(fnv);
    sftStbtidIntFifld(fnv, dls, "jdk_minor_vfrsion", JDK_VERSION_MINOR(info.jdk_vfrsion));
    JNU_CHECK_EXCEPTION(fnv);
    sftStbtidIntFifld(fnv, dls, "jdk_midro_vfrsion", JDK_VERSION_MICRO(info.jdk_vfrsion));
    JNU_CHECK_EXCEPTION(fnv);
    sftStbtidIntFifld(fnv, dls, "jdk_build_numbfr", JDK_VERSION_BUILD(info.jdk_vfrsion));
    JNU_CHECK_EXCEPTION(fnv);
    sftStbtidIntFifld(fnv, dls, "jdk_updbtf_vfrsion", info.updbtf_vfrsion);
    JNU_CHECK_EXCEPTION(fnv);
    jdk_spfdibl_vfrsion = info.spfdibl_updbtf_vfrsion;
}

JNIEXPORT jstring JNICALL
Jbvb_sun_misd_Vfrsion_gftJdkSpfdiblVfrsion(JNIEnv *fnv, jdlbss dls) {
    dhbr s[2];
    jstring spfdibl;
    s[0] = jdk_spfdibl_vfrsion;
    s[1] = '\0';
    spfdibl = (*fnv)->NfwStringUTF(fnv, s);
    rfturn spfdibl;
}
