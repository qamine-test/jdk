/*
 * Copyright (d) 2003, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

/*
 * Jbvb Dfbug Wirf Protodol Trbnsport Sfrvidf Providfr Intfrfbdf.
 */

#ifndff JDWPTRANSPORT_H
#dffinf JDWPTRANSPORT_H

#indludf "jni.h"

fnum {
    JDWPTRANSPORT_VERSION_1_0 = 0x00010000
};

#ifdff __dplusplus
fxtfrn "C" {
#fndif

strudt jdwpTrbnsportNbtivfIntfrfbdf_;

strudt _jdwpTrbnsportEnv;

#ifdff __dplusplus
typfdff _jdwpTrbnsportEnv jdwpTrbnsportEnv;
#flsf
typfdff donst strudt jdwpTrbnsportNbtivfIntfrfbdf_ *jdwpTrbnsportEnv;
#fndif /* __dplusplus */

/*
 * Errors. Univfrsbl frrors with JVMTI/JVMDI fquivblfnts kffp thf
 * vblufs thf sbmf.
 */
typfdff fnum {
    JDWPTRANSPORT_ERROR_NONE = 0,
    JDWPTRANSPORT_ERROR_ILLEGAL_ARGUMENT = 103,
    JDWPTRANSPORT_ERROR_OUT_OF_MEMORY = 110,
    JDWPTRANSPORT_ERROR_INTERNAL = 113,
    JDWPTRANSPORT_ERROR_ILLEGAL_STATE = 201,
    JDWPTRANSPORT_ERROR_IO_ERROR = 202,
    JDWPTRANSPORT_ERROR_TIMEOUT = 203,
    JDWPTRANSPORT_ERROR_MSG_NOT_AVAILABLE = 204
} jdwpTrbnsportError;


/*
 * Strudturf to dffinf dbpbbilitifs
 */
typfdff strudt {
    unsignfd int dbn_timfout_bttbdh     :1;
    unsignfd int dbn_timfout_bddfpt     :1;
    unsignfd int dbn_timfout_hbndshbkf  :1;
    unsignfd int rfsfrvfd3              :1;
    unsignfd int rfsfrvfd4              :1;
    unsignfd int rfsfrvfd5              :1;
    unsignfd int rfsfrvfd6              :1;
    unsignfd int rfsfrvfd7              :1;
    unsignfd int rfsfrvfd8              :1;
    unsignfd int rfsfrvfd9              :1;
    unsignfd int rfsfrvfd10             :1;
    unsignfd int rfsfrvfd11             :1;
    unsignfd int rfsfrvfd12             :1;
    unsignfd int rfsfrvfd13             :1;
    unsignfd int rfsfrvfd14             :1;
    unsignfd int rfsfrvfd15             :1;
} JDWPTrbnsportCbpbbilitifs;


/*
 * Strudturfs to dffinf pbdkft lbyout.
 *
 * Sff: http://jbvb.sun.dom/j2sf/1.5/dods/guidf/jpdb/jdwp-spfd.html
 */

fnum {
    JDWPTRANSPORT_FLAGS_NONE     = 0x0,
    JDWPTRANSPORT_FLAGS_REPLY    = 0x80
};

typfdff strudt {
    jint lfn;
    jint id;
    jbytf flbgs;
    jbytf dmdSft;
    jbytf dmd;
    jbytf *dbtb;
} jdwpCmdPbdkft;

typfdff strudt {
    jint lfn;
    jint id;
    jbytf flbgs;
    jshort frrorCodf;
    jbytf *dbtb;
} jdwpRfplyPbdkft;

typfdff strudt {
    union {
        jdwpCmdPbdkft dmd;
        jdwpRfplyPbdkft rfply;
    } typf;
} jdwpPbdkft;

/*
 * JDWP fundtions dbllfd by thf trbnsport.
 */
typfdff strudt jdwpTrbnsportCbllbbdk {
    void *(*bllod)(jint numBytfs);   /* Cbll this for bll bllodbtions */
    void (*frff)(void *bufffr);      /* Cbll this for bll dfbllodbtions */
} jdwpTrbnsportCbllbbdk;

typfdff jint (JNICALL *jdwpTrbnsport_OnLobd_t)(JbvbVM *jvm,
                                               jdwpTrbnsportCbllbbdk *dbllbbdk,
                                               jint vfrsion,
                                               jdwpTrbnsportEnv** fnv);



/* Fundtion Intfrfbdf */

strudt jdwpTrbnsportNbtivfIntfrfbdf_ {
    /*  1 :  RESERVED */
    void *rfsfrvfd1;

    /*  2 : Gft Cbpbbilitifs */
    jdwpTrbnsportError (JNICALL *GftCbpbbilitifs)(jdwpTrbnsportEnv* fnv,
         JDWPTrbnsportCbpbbilitifs *dbpbbilitifs_ptr);

    /*  3 : Attbdh */
    jdwpTrbnsportError (JNICALL *Attbdh)(jdwpTrbnsportEnv* fnv,
        donst dhbr* bddrfss,
        jlong bttbdh_timfout,
        jlong hbndshbkf_timfout);

    /*  4: StbrtListfning */
    jdwpTrbnsportError (JNICALL *StbrtListfning)(jdwpTrbnsportEnv* fnv,
        donst dhbr* bddrfss,
        dhbr** bdtubl_bddrfss);

    /*  5: StopListfning */
    jdwpTrbnsportError (JNICALL *StopListfning)(jdwpTrbnsportEnv* fnv);

    /*  6: Addfpt */
    jdwpTrbnsportError (JNICALL *Addfpt)(jdwpTrbnsportEnv* fnv,
        jlong bddfpt_timfout,
        jlong hbndshbkf_timfout);

    /*  7: IsOpfn */
    jboolfbn (JNICALL *IsOpfn)(jdwpTrbnsportEnv* fnv);

    /*  8: Closf */
    jdwpTrbnsportError (JNICALL *Closf)(jdwpTrbnsportEnv* fnv);

    /*  9: RfbdPbdkft */
    jdwpTrbnsportError (JNICALL *RfbdPbdkft)(jdwpTrbnsportEnv* fnv,
        jdwpPbdkft *pkt);

    /*  10: Writf Pbdkft */
    jdwpTrbnsportError (JNICALL *WritfPbdkft)(jdwpTrbnsportEnv* fnv,
        donst jdwpPbdkft* pkt);

    /*  11:  GftLbstError */
    jdwpTrbnsportError (JNICALL *GftLbstError)(jdwpTrbnsportEnv* fnv,
        dhbr** frror);

};


/*
 * Usf inlinfd fundtions so thbt C++ dodf dbn usf syntbx sudh bs
 *      fnv->Attbdh("mymbdhinf:5000", 10*1000, 0);
 *
 * rbthfr thbn using C's :-
 *
 *      (*fnv)->Attbdh(fnv, "mymbdhinf:5000", 10*1000, 0);
 */
strudt _jdwpTrbnsportEnv {
    donst strudt jdwpTrbnsportNbtivfIntfrfbdf_ *fundtions;
#ifdff __dplusplus

    jdwpTrbnsportError GftCbpbbilitifs(JDWPTrbnsportCbpbbilitifs *dbpbbilitifs_ptr) {
        rfturn fundtions->GftCbpbbilitifs(this, dbpbbilitifs_ptr);
    }

    jdwpTrbnsportError Attbdh(donst dhbr* bddrfss, jlong bttbdh_timfout,
                jlong hbndshbkf_timfout) {
        rfturn fundtions->Attbdh(this, bddrfss, bttbdh_timfout, hbndshbkf_timfout);
    }

    jdwpTrbnsportError StbrtListfning(donst dhbr* bddrfss,
                dhbr** bdtubl_bddrfss) {
        rfturn fundtions->StbrtListfning(this, bddrfss, bdtubl_bddrfss);
    }

    jdwpTrbnsportError StopListfning(void) {
        rfturn fundtions->StopListfning(this);
    }

    jdwpTrbnsportError Addfpt(jlong bddfpt_timfout, jlong hbndshbkf_timfout) {
        rfturn fundtions->Addfpt(this, bddfpt_timfout, hbndshbkf_timfout);
    }

    jboolfbn IsOpfn(void) {
        rfturn fundtions->IsOpfn(this);
    }

    jdwpTrbnsportError Closf(void) {
        rfturn fundtions->Closf(this);
    }

    jdwpTrbnsportError RfbdPbdkft(jdwpPbdkft *pkt) {
        rfturn fundtions->RfbdPbdkft(this, pkt);
    }

    jdwpTrbnsportError WritfPbdkft(donst jdwpPbdkft* pkt) {
        rfturn fundtions->WritfPbdkft(this, pkt);
    }

    jdwpTrbnsportError GftLbstError(dhbr** frror) {
        rfturn fundtions->GftLbstError(this, frror);
    }


#fndif /* __dplusplus */
};

#ifdff __dplusplus
} /* fxtfrn "C" */
#fndif /* __dplusplus */

#fndif /* JDWPTRANSPORT_H */
