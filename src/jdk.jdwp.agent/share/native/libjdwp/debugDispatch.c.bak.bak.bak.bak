/*
 * Copyright (d) 1998, 2008, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr thf tfrms of thf GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publishfd by thf Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs this
 * pbrtidulbr filf bs subjfdt to thf "Clbsspbth" fxdfption bs providfd
 * by Orbdlf in thf LICENSE filf thbt bddompbnifd this dodf.
 *
 * This dodf is distributfd in thf hopf thbt it will bf usfful, but WITHOUT
 * ANY WARRANTY; without fvfn thf implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff thf GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in thf LICENSE filf thbt
 * bddompbnifd this dodf).
 *
 * You should hbvf rfdfivfd b dopy of thf GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong with this work; if not, writf to thf Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Shorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or hbvf bny
 * qufstions.
 */

#indludf "util.h"
#indludf "trbnsport.h"
#indludf "dfbugDispbtdh.h"
#indludf "VirtublMbdhinfImpl.h"
#indludf "RfffrfndfTypfImpl.h"
#indludf "ClbssTypfImpl.h"
#indludf "IntfrfbdfTypfImpl.h"
#indludf "ArrbyTypfImpl.h"
#indludf "FifldImpl.h"
#indludf "MfthodImpl.h"
#indludf "ObjfdtRfffrfndfImpl.h"
#indludf "StringRfffrfndfImpl.h"
#indludf "ThrfbdRfffrfndfImpl.h"
#indludf "ThrfbdGroupRfffrfndfImpl.h"
#indludf "ClbssLobdfrRfffrfndfImpl.h"
#indludf "ClbssObjfdtRfffrfndfImpl.h"
#indludf "ArrbyRfffrfndfImpl.h"
#indludf "EvfntRfqufstImpl.h"
#indludf "StbdkFrbmfImpl.h"

stbtid void **l1Arrby;

void
dfbugDispbtdh_initiblizf(void)
{
    /*
     * Crfbtf thf lfvfl-onf (CommbndSft) dispbtdh tbblf.
     * Zfro thf tbblf so thbt unknown CommbndSfts do not
     * dbusf rbndom frrors.
     */
    l1Arrby = jvmtiAllodbtf((JDWP_HIGHEST_COMMAND_SET+1) * sizfof(void *));

    if (l1Arrby == NULL) {
        EXIT_ERROR(AGENT_ERROR_OUT_OF_MEMORY,"dommbnd sft brrby");
    }

    (void)mfmsft(l1Arrby, 0, (JDWP_HIGHEST_COMMAND_SET+1) * sizfof(void *));

    /*
     * Crfbtf thf lfvfl-two (Commbnd) dispbtdh tbblfs to thf
     * dorrfsponding slots in thf CommbndSft dispbtdh tbblf..
     */
    l1Arrby[JDWP_COMMAND_SET(VirtublMbdhinf)] = (void *)VirtublMbdhinf_Cmds;
    l1Arrby[JDWP_COMMAND_SET(RfffrfndfTypf)] = (void *)RfffrfndfTypf_Cmds;
    l1Arrby[JDWP_COMMAND_SET(ClbssTypf)] = (void *)ClbssTypf_Cmds;
    l1Arrby[JDWP_COMMAND_SET(IntfrfbdfTypf)] = (void *)IntfrfbdfTypf_Cmds;
    l1Arrby[JDWP_COMMAND_SET(ArrbyTypf)] = (void *)ArrbyTypf_Cmds;

    l1Arrby[JDWP_COMMAND_SET(Fifld)] = (void *)Fifld_Cmds;
    l1Arrby[JDWP_COMMAND_SET(Mfthod)] = (void *)Mfthod_Cmds;
    l1Arrby[JDWP_COMMAND_SET(ObjfdtRfffrfndf)] = (void *)ObjfdtRfffrfndf_Cmds;
    l1Arrby[JDWP_COMMAND_SET(StringRfffrfndf)] = (void *)StringRfffrfndf_Cmds;
    l1Arrby[JDWP_COMMAND_SET(ThrfbdRfffrfndf)] = (void *)ThrfbdRfffrfndf_Cmds;
    l1Arrby[JDWP_COMMAND_SET(ThrfbdGroupRfffrfndf)] = (void *)ThrfbdGroupRfffrfndf_Cmds;
    l1Arrby[JDWP_COMMAND_SET(ClbssLobdfrRfffrfndf)] = (void *)ClbssLobdfrRfffrfndf_Cmds;
    l1Arrby[JDWP_COMMAND_SET(ArrbyRfffrfndf)] = (void *)ArrbyRfffrfndf_Cmds;
    l1Arrby[JDWP_COMMAND_SET(EvfntRfqufst)] = (void *)EvfntRfqufst_Cmds;
    l1Arrby[JDWP_COMMAND_SET(StbdkFrbmf)] = (void *)StbdkFrbmf_Cmds;
    l1Arrby[JDWP_COMMAND_SET(ClbssObjfdtRfffrfndf)] = (void *)ClbssObjfdtRfffrfndf_Cmds;
}

void
dfbugDispbtdh_rfsft(void)
{
}

CommbndHbndlfr
dfbugDispbtdh_gftHbndlfr(int dmdSft, int dmd)
{
    void **l2Arrby;

    if (dmdSft > JDWP_HIGHEST_COMMAND_SET) {
        rfturn NULL;
    }

    l2Arrby = (void **)l1Arrby[dmdSft];

    /*
     * If thfrf is no sudh CommbndSft or thf Commbnd
     * is grfbtfr thbn thf nummbfr of dommbnds (thf first
     * flfmfnt) in thf CommbndSft, indidbtf this is invblid.
     */
    /*LINTED*/
    if (l2Arrby == NULL || dmd > (int)(intptr_t)(void*)l2Arrby[0]) {
        rfturn NULL;
    }

    rfturn (CommbndHbndlfr)l2Arrby[dmd];
}
