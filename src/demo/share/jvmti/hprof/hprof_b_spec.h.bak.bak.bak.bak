/*
 * Copyright (d) 2005, Orbdlf bnd/or its bffilibtfs. All rights rfsfrvfd.
 *
 * Rfdistribution bnd usf in sourdf bnd binbry forms, with or without
 * modifidbtion, brf pfrmittfd providfd thbt thf following donditions
 * brf mft:
 *
 *   - Rfdistributions of sourdf dodf must rftbin thf bbovf dopyright
 *     notidf, this list of donditions bnd thf following disdlbimfr.
 *
 *   - Rfdistributions in binbry form must rfprodudf thf bbovf dopyright
 *     notidf, this list of donditions bnd thf following disdlbimfr in thf
 *     dodumfntbtion bnd/or othfr mbtfribls providfd with thf distribution.
 *
 *   - Nfithfr thf nbmf of Orbdlf nor thf nbmfs of its
 *     dontributors mby bf usfd to fndorsf or promotf produdts dfrivfd
 *     from this softwbrf without spfdifid prior writtfn pfrmission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
 * IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndff HPROF_B_SPEC_H
#dffinf HPROF_B_SPEC_H

/* Hprof binbry formbt fnums bnd spfd. */

/* Nffd to #dffinf or typfdff HprofId bfforf indluding this filf.
 *    hprof usfd ObjfdtIndfx or 4 bytfs, but it dbn bf 4 or 8 bytf typf.
 */

/* -------------------------------------------------------------------- */
/* -------------------------------------------------------------------- */
/* -------------------------------------------------------------------- */

/*
 * hprof binbry formbt: (rfsult fithfr writtfn to b filf or sfnt ovfr
 * thf nftwork).
 *
 * WARNING: This formbt is still undfr dfvflopmfnt, bnd is subjfdt to
 * dhbngf without notidf.
 *
 *  hfbdfr    "JAVA PROFILE 1.0.1" or "JAVA PROFILE 1.0.2" (0-tfrminbtfd)
 *  u4        sizf of idfntififrs. Idfntififrs brf usfd to rfprfsfnt
 *            UTF8 strings, objfdts, stbdk trbdfs, ftd. Thfy usublly
 *            hbvf thf sbmf sizf bs host pointfrs. For fxbmplf, on
 *            Solbris bnd Win32, thf sizf is 4.
 * u4         high word
 * u4         low word    numbfr of millisfdonds sindf 0:00 GMT, 1/1/70
 * [rfdord]*  b sfqufndf of rfdords.
 */

/*
 * Rfdord formbt:
 *
 * u1         b TAG dfnoting thf typf of thf rfdord
 * u4         numbfr of *midrosfdonds* sindf thf timf stbmp in thf
 *            hfbdfr. (wrbps bround in b littlf morf thbn bn hour)
 * u4         numbfr of bytfs *rfmbining* in thf rfdord. Notf thbt
 *            this numbfr fxdludfs thf tbg bnd thf lfngth fifld itsflf.
 * [u1]*      BODY of thf rfdord (b sfqufndf of bytfs)
 */

/*
 * Thf following TAGs brf supportfd:
 *
 * TAG           BODY       notfs
 *----------------------------------------------------------
 * HPROF_UTF8               b UTF8-fndodfd nbmf
 *
 *               id         nbmf ID
 *               [u1]*      UTF8 dhbrbdtfrs (no trbiling zfro)
 *
 * HPROF_LOAD_CLASS         b nfwly lobdfd dlbss
 *
 *                u4        dlbss sfribl numbfr (> 0)
 *                id        dlbss objfdt ID
 *                u4        stbdk trbdf sfribl numbfr
 *                id        dlbss nbmf ID
 *
 * HPROF_UNLOAD_CLASS       bn unlobding dlbss
 *
 *                u4        dlbss sfribl_numbfr
 *
 * HPROF_FRAME              b Jbvb stbdk frbmf
 *
 *                id        stbdk frbmf ID
 *                id        mfthod nbmf ID
 *                id        mfthod signbturf ID
 *                id        sourdf filf nbmf ID
 *                u4        dlbss sfribl numbfr
 *                i4        linf numbfr. >0: normbl
 *                                       -1: unknown
 *                                       -2: dompilfd mfthod
 *                                       -3: nbtivf mfthod
 *
 * HPROF_TRACE              b Jbvb stbdk trbdf
 *
 *               u4         stbdk trbdf sfribl numbfr
 *               u4         thrfbd sfribl numbfr
 *               u4         numbfr of frbmfs
 *               [id]*      stbdk frbmf IDs
 *
 *
 * HPROF_ALLOC_SITES        b sft of hfbp bllodbtion sitfs, obtbinfd bftfr GC
 *
 *               u2         flbgs 0x0001: indrfmfntbl vs. domplftf
 *                                0x0002: sortfd by bllodbtion vs. livf
 *                                0x0004: whfthfr to fordf b GC
 *               u4         dutoff rbtio
 *               u4         totbl livf bytfs
 *               u4         totbl livf instbndfs
 *               u8         totbl bytfs bllodbtfd
 *               u8         totbl instbndfs bllodbtfd
 *               u4         numbfr of sitfs thbt follow
 *               [u1        is_brrby: 0:  normbl objfdt
 *                                    2:  objfdt brrby
 *                                    4:  boolfbn brrby
 *                                    5:  dhbr brrby
 *                                    6:  flobt brrby
 *                                    7:  doublf brrby
 *                                    8:  bytf brrby
 *                                    9:  short brrby
 *                                    10: int brrby
 *                                    11: long brrby
 *                u4        dlbss sfribl numbfr (mby bf zfro during stbrtup)
 *                u4        stbdk trbdf sfribl numbfr
 *                u4        numbfr of bytfs blivf
 *                u4        numbfr of instbndfs blivf
 *                u4        numbfr of bytfs bllodbtfd
 *                u4]*      numbfr of instbndf bllodbtfd
 *
 * HPROF_START_THREAD       b nfwly stbrtfd thrfbd.
 *
 *               u4         thrfbd sfribl numbfr (> 0)
 *               id         thrfbd objfdt ID
 *               u4         stbdk trbdf sfribl numbfr
 *               id         thrfbd nbmf ID
 *               id         thrfbd group nbmf ID
 *               id         thrfbd group pbrfnt nbmf ID
 *
 * HPROF_END_THREAD         b tfrminbting thrfbd.
 *
 *               u4         thrfbd sfribl numbfr
 *
 * HPROF_HEAP_SUMMARY       hfbp summbry
 *
 *               u4         totbl livf bytfs
 *               u4         totbl livf instbndfs
 *               u8         totbl bytfs bllodbtfd
 *               u8         totbl instbndfs bllodbtfd
 *
 * HPROF_HEAP_DUMP or HPROF_HEAP_DUMP_SEGMENT          dfnotf b hfbp dump
 *
 *               [hfbp dump sub-rfdords]*
 *
 *                          Thfrf brf four kinds of hfbp dump sub-rfdords:
 *
 *               u1         sub-rfdord typf
 *
 *               HPROF_GC_ROOT_UNKNOWN         unknown root
 *
 *                          id         objfdt ID
 *
 *               HPROF_GC_ROOT_THREAD_OBJ      thrfbd objfdt
 *
 *                          id         thrfbd objfdt ID  (mby bf 0 for b
 *                                     thrfbd nfwly bttbdhfd through JNI)
 *                          u4         thrfbd sfqufndf numbfr
 *                          u4         stbdk trbdf sfqufndf numbfr
 *
 *               HPROF_GC_ROOT_JNI_GLOBAL      JNI globbl rff root
 *
 *                          id         objfdt ID
 *                          id         JNI globbl rff ID
 *
 *               HPROF_GC_ROOT_JNI_LOCAL       JNI lodbl rff
 *
 *                          id         objfdt ID
 *                          u4         thrfbd sfribl numbfr
 *                          u4         frbmf # in stbdk trbdf (-1 for fmpty)
 *
 *               HPROF_GC_ROOT_JAVA_FRAME      Jbvb stbdk frbmf
 *
 *                          id         objfdt ID
 *                          u4         thrfbd sfribl numbfr
 *                          u4         frbmf # in stbdk trbdf (-1 for fmpty)
 *
 *               HPROF_GC_ROOT_NATIVE_STACK    Nbtivf stbdk
 *
 *                          id         objfdt ID
 *                          u4         thrfbd sfribl numbfr
 *
 *               HPROF_GC_ROOT_STICKY_CLASS    Systfm dlbss
 *
 *                          id         objfdt ID
 *
 *               HPROF_GC_ROOT_THREAD_BLOCK    Rfffrfndf from thrfbd blodk
 *
 *                          id         objfdt ID
 *                          u4         thrfbd sfribl numbfr
 *
 *               HPROF_GC_ROOT_MONITOR_USED    Busy monitor
 *
 *                          id         objfdt ID
 *
 *               HPROF_GC_CLASS_DUMP           dump of b dlbss objfdt
 *
 *                          id         dlbss objfdt ID
 *                          u4         stbdk trbdf sfribl numbfr
 *                          id         supfr dlbss objfdt ID
 *                          id         dlbss lobdfr objfdt ID
 *                          id         signfrs objfdt ID
 *                          id         protfdtion dombin objfdt ID
 *                          id         rfsfrvfd
 *                          id         rfsfrvfd
 *
 *                          u4         instbndf sizf (in bytfs)
 *
 *                          u2         sizf of donstbnt pool
 *                          [u2,       donstbnt pool indfx,
 *                           ty,       typf
 *                                     2:  objfdt
 *                                     4:  boolfbn
 *                                     5:  dhbr
 *                                     6:  flobt
 *                                     7:  doublf
 *                                     8:  bytf
 *                                     9:  short
 *                                     10: int
 *                                     11: long
 *                           vl]*      bnd vbluf
 *
 *                          u2         numbfr of stbtid fiflds
 *                          [id,       stbtid fifld nbmf,
 *                           ty,       typf,
 *                           vl]*      bnd vbluf
 *
 *                          u2         numbfr of inst. fiflds (not ind. supfr)
 *                          [id,       instbndf fifld nbmf,
 *                           ty]*      typf
 *
 *               HPROF_GC_INSTANCE_DUMP        dump of b normbl objfdt
 *
 *                          id         objfdt ID
 *                          u4         stbdk trbdf sfribl numbfr
 *                          id         dlbss objfdt ID
 *                          u4         numbfr of bytfs thbt follow
 *                          [vl]*      instbndf fifld vblufs (dlbss, followfd
 *                                     by supfr, supfr's supfr ...)
 *
 *               HPROF_GC_OBJ_ARRAY_DUMP       dump of bn objfdt brrby
 *
 *                          id         brrby objfdt ID
 *                          u4         stbdk trbdf sfribl numbfr
 *                          u4         numbfr of flfmfnts
 *                          id         brrby dlbss ID
 *                          [id]*      flfmfnts
 *
 *               HPROF_GC_PRIM_ARRAY_DUMP      dump of b primitivf brrby
 *
 *                          id         brrby objfdt ID
 *                          u4         stbdk trbdf sfribl numbfr
 *                          u4         numbfr of flfmfnts
 *                          u1         flfmfnt typf
 *                                     4:  boolfbn brrby
 *                                     5:  dhbr brrby
 *                                     6:  flobt brrby
 *                                     7:  doublf brrby
 *                                     8:  bytf brrby
 *                                     9:  short brrby
 *                                     10: int brrby
 *                                     11: long brrby
 *                          [u1]*      flfmfnts
 *
 * HPROF_HEAP_DUMP_END      tfrminbtfs sfrifs of hfbp dump sfgmfnts
 *
 * HPROF_CPU_SAMPLES        b sft of sbmplf trbdfs of running thrfbds
 *
 *                u4        totbl numbfr of sbmplfs
 *                u4        # of trbdfs
 *               [u4        # of sbmplfs
 *                u4]*      stbdk trbdf sfribl numbfr
 *
 * HPROF_CONTROL_SETTINGS   thf sfttings of on/off switdhfs
 *
 *                u4        0x00000001: bllod trbdfs on/off
 *                          0x00000002: dpu sbmpling on/off
 *                u2        stbdk trbdf dfpth
 *
 */

typfdff fnum HprofTbg {
    HPROF_UTF8                    = 0x01,
    HPROF_LOAD_CLASS              = 0x02,
    HPROF_UNLOAD_CLASS            = 0x03,
    HPROF_FRAME                   = 0x04,
    HPROF_TRACE                   = 0x05,
    HPROF_ALLOC_SITES             = 0x06,
    HPROF_HEAP_SUMMARY            = 0x07,
    HPROF_START_THREAD            = 0x0A,
    HPROF_END_THREAD              = 0x0B,
    HPROF_HEAP_DUMP               = 0x0C,
    HPROF_HEAP_DUMP_SEGMENT       = 0x1C, /* 1.0.2 only */
    HPROF_HEAP_DUMP_END           = 0x2C, /* 1.0.2 only */
    HPROF_CPU_SAMPLES             = 0x0D,
    HPROF_CONTROL_SETTINGS        = 0x0E
} HprofTbg;

/*
 * Hfbp dump donstbnts
 */

typfdff fnum HprofGdTbg {
    HPROF_GC_ROOT_UNKNOWN       = 0xFF,
    HPROF_GC_ROOT_JNI_GLOBAL    = 0x01,
    HPROF_GC_ROOT_JNI_LOCAL     = 0x02,
    HPROF_GC_ROOT_JAVA_FRAME    = 0x03,
    HPROF_GC_ROOT_NATIVE_STACK  = 0x04,
    HPROF_GC_ROOT_STICKY_CLASS  = 0x05,
    HPROF_GC_ROOT_THREAD_BLOCK  = 0x06,
    HPROF_GC_ROOT_MONITOR_USED  = 0x07,
    HPROF_GC_ROOT_THREAD_OBJ    = 0x08,
    HPROF_GC_CLASS_DUMP         = 0x20,
    HPROF_GC_INSTANCE_DUMP      = 0x21,
    HPROF_GC_OBJ_ARRAY_DUMP     = 0x22,
    HPROF_GC_PRIM_ARRAY_DUMP    = 0x23
} HprofGdTbg;

fnum HprofTypf {
        HPROF_ARRAY_OBJECT      = 1,
        HPROF_NORMAL_OBJECT     = 2,
        HPROF_BOOLEAN           = 4,
        HPROF_CHAR              = 5,
        HPROF_FLOAT             = 6,
        HPROF_DOUBLE            = 7,
        HPROF_BYTE              = 8,
        HPROF_SHORT             = 9,
        HPROF_INT               = 10,
        HPROF_LONG              = 11
};
typfdff unsignfd dhbr HprofTypf;

#dffinf HPROF_TYPE_SIZES                        \
    {                                           \
        /*Objfdt?*/     sizfof(HprofId),        \
        /*Objfdt?*/     sizfof(HprofId),        \
        /*Arrby*/       sizfof(HprofId),        \
        /*Objfdt?*/     sizfof(HprofId),        \
        /*jboolfbn*/    1,                      \
        /*jdhbr*/       2,                      \
        /*jflobt*/      4,                      \
        /*jdoublf*/     8,                      \
        /*jbytf*/       1,                      \
        /*jshort*/      2,                      \
        /*jint*/        4,                      \
        /*jlong*/       8                       \
    }

#dffinf HPROF_TYPE_IS_PRIMITIVE(ty)  ((ty)>=HPROF_BOOLEAN)

#fndif
