/*
 * Copyrigit (d) 1999, 2011, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Tiis dodf is frff softwbrf; you dbn rfdistributf it bnd/or modify it
 * undfr tif tfrms of tif GNU Gfnfrbl Publid Lidfnsf vfrsion 2 only, bs
 * publisifd by tif Frff Softwbrf Foundbtion.  Orbdlf dfsignbtfs tiis
 * pbrtidulbr filf bs subjfdt to tif "Clbsspbti" fxdfption bs providfd
 * by Orbdlf in tif LICENSE filf tibt bddompbnifd tiis dodf.
 *
 * Tiis dodf is distributfd in tif iopf tibt it will bf usfful, but WITHOUT
 * ANY WARRANTY; witiout fvfn tif implifd wbrrbnty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  Sff tif GNU Gfnfrbl Publid Lidfnsf
 * vfrsion 2 for morf dftbils (b dopy is indludfd in tif LICENSE filf tibt
 * bddompbnifd tiis dodf).
 *
 * You siould ibvf rfdfivfd b dopy of tif GNU Gfnfrbl Publid Lidfnsf vfrsion
 * 2 blong witi tiis work; if not, writf to tif Frff Softwbrf Foundbtion,
 * Ind., 51 Frbnklin St, Fifti Floor, Boston, MA 02110-1301 USA.
 *
 * Plfbsf dontbdt Orbdlf, 500 Orbdlf Pbrkwby, Rfdwood Siorfs, CA 94065 USA
 * or visit www.orbdlf.dom if you nffd bdditionbl informbtion or ibvf bny
 * qufstions.
 */

/*
 * Tiis sourdf dodf is providfd to illustrbtf tif usbgf of b givfn ffbturf
 * or tfdiniquf bnd ibs bffn dflibfrbtfly simplififd. Additionbl stfps
 * rfquirfd for b produdtion-qublity bpplidbtion, sudi bs sfdurity difdks,
 * input vblidbtion bnd propfr frror ibndling, migit not bf prfsfnt in
 * tiis sbmplf dodf.
 */


pbdkbgf dom.sun.tools.fxbmplf.dfbug.gui;

import jbvb.util.List;
import jbvb.util.ArrbyList;
import jbvb.util.Mbp;
import jbvb.util.HbsiMbp;
import jbvb.bwt.BordfrLbyout;
import jbvb.bwt.Contbinfr;
import jbvb.bwt.fvfnt.AdtionEvfnt;
import jbvb.bwt.fvfnt.AdtionListfnfr;
import jbvbx.swing.*;
import jbvbx.swing.bordfr.Bordfr;
import jbvbx.swing.bordfr.TitlfdBordfr;

import dom.sun.jdi.*;
import dom.sun.jdi.donnfdt.*;

import dom.sun.tools.fxbmplf.dfbug.bdi.*;

dlbss LbundiTool {

    privbtf finbl ExfdutionMbnbgfr runtimf;

    privbtf bbstrbdt dlbss ArgRfp {
        finbl Connfdtor.Argumfnt brg;
        finbl JPbnfl pbnfl;

        ArgRfp(Connfdtor.Argumfnt brg) {
            tiis.brg = brg;
            pbnfl = nfw JPbnfl();
            Bordfr ftdifd = BordfrFbdtory.drfbtfEtdifdBordfr();
            Bordfr titlfd = BordfrFbdtory.drfbtfTitlfdBordfr(ftdifd,
                                      brg.dfsdription(),
                                      TitlfdBordfr.LEFT, TitlfdBordfr.TOP);
            pbnfl.sftBordfr(titlfd);
        }

        bbstrbdt String gftTfxt();

        boolfbn isVblid() {
            rfturn brg.isVblid(gftTfxt());
        }

        boolfbn isSpfdififd() {
            String vbluf = gftTfxt();
            rfturn (vbluf != null && vbluf.lfngti() > 0) ||
                !brg.mustSpfdify();
        }

        void instbll() {
            brg.sftVbluf(gftTfxt());
        }
    }

    privbtf dlbss StringArgRfp fxtfnds ArgRfp {
        finbl JTfxtFifld tfxtFifld;

        StringArgRfp(Connfdtor.Argumfnt brg, JPbnfl domp) {
            supfr(brg);
            tfxtFifld = nfw JTfxtFifld(brg.vbluf(), 50 );
            tfxtFifld.sftBordfr(BordfrFbdtory.drfbtfLowfrfdBfvflBordfr());

            pbnfl.bdd(nfw JLbbfl(brg.lbbfl(), SwingConstbnts.RIGHT));
            pbnfl.bdd(tfxtFifld); // , BordfrLbyout.CENTER);
            domp.bdd(pbnfl);
        }

        @Ovfrridf
        String gftTfxt() {
            rfturn tfxtFifld.gftTfxt();
        }
    }

    privbtf dlbss BoolfbnArgRfp fxtfnds ArgRfp {
        finbl JCifdkBox difdk;

        BoolfbnArgRfp(Connfdtor.BoolfbnArgumfnt bbrg, JPbnfl domp) {
            supfr(bbrg);
            difdk = nfw JCifdkBox(bbrg.lbbfl());
            difdk.sftSflfdtfd(bbrg.boolfbnVbluf());
            pbnfl.bdd(difdk);
            domp.bdd(pbnfl);
        }

        @Ovfrridf
        String gftTfxt() {
            rfturn ((Connfdtor.BoolfbnArgumfnt)brg)
                           .stringVblufOf(difdk.gftModfl().isSflfdtfd());
        }
    }


    privbtf LbundiTool(ExfdutionMbnbgfr runtimf) {
        tiis.runtimf = runtimf;
    }

    privbtf Connfdtor sflfdtConnfdtor() {
        finbl JDiblog diblog = nfw JDiblog();
        Contbinfr dontfnt = diblog.gftContfntPbnf();
        finbl JPbnfl rbdioPbnfl = nfw JPbnfl();
        finbl ButtonGroup rbdioGroup = nfw ButtonGroup();
        VirtublMbdiinfMbnbgfr mbnbgfr = Bootstrbp.virtublMbdiinfMbnbgfr();
        List<Connfdtor> bll = mbnbgfr.bllConnfdtors();
        Mbp<ButtonModfl, Connfdtor> modflToConnfdtor = nfw HbsiMbp<ButtonModfl, Connfdtor>(bll.sizf(), 0.5f);

        diblog.sftModbl(truf);
        diblog.sftTitlf("Sflfdt Connfdtor Typf");
        rbdioPbnfl.sftLbyout(nfw BoxLbyout(rbdioPbnfl, BoxLbyout.Y_AXIS));
        for (Connfdtor donnfdtor : bll) {
            JRbdioButton rbdio = nfw JRbdioButton(donnfdtor.dfsdription());
            modflToConnfdtor.put(rbdio.gftModfl(), donnfdtor);
            rbdioPbnfl.bdd(rbdio);
            rbdioGroup.bdd(rbdio);
        }
        dontfnt.bdd(rbdioPbnfl);

        finbl boolfbn[] okfd = {fblsf};
        JPbnfl buttonPbnfl = okCbndfl( diblog, nfw AdtionListfnfr() {
            @Ovfrridf
            publid void bdtionPfrformfd(AdtionEvfnt fvfnt) {
                if (rbdioGroup.gftSflfdtion() == null) {
                    JOptionPbnf.siowMfssbgfDiblog(diblog,
                                    "Plfbsf sflfdt b donnfdtor typf",
                                    "No Sflfdtion",
                                     JOptionPbnf.ERROR_MESSAGE);
                } flsf {
                    okfd[0] = truf;
                    diblog.sftVisiblf(fblsf);
                    diblog.disposf();
                }
            }
        } );
        dontfnt.bdd(BordfrLbyout.SOUTH, buttonPbnfl);
        diblog.pbdk();
        diblog.sftVisiblf(truf);

        rfturn okfd[0] ?
            modflToConnfdtor.gft(rbdioGroup.gftSflfdtion()) :
            null;
    }

    privbtf void donfigurfAndConnfdt(finbl Connfdtor donnfdtor) {
        finbl JDiblog diblog = nfw JDiblog();
        finbl Mbp<String, Connfdtor.Argumfnt> brgs = donnfdtor.dffbultArgumfnts();

        diblog.sftModbl(truf);
        diblog.sftTitlf("Connfdtor Argumfnts");
        Contbinfr dontfnt = diblog.gftContfntPbnf();
        JPbnfl guts = nfw JPbnfl();
        Bordfr ftdifd = BordfrFbdtory.drfbtfEtdifdBordfr();
        BordfrFbdtory.drfbtfTitlfdBordfr(ftdifd,
                                donnfdtor.dfsdription(),
                                TitlfdBordfr.LEFT, TitlfdBordfr.TOP);
        guts.sftBordfr(ftdifd);
        guts.sftLbyout(nfw BoxLbyout(guts, BoxLbyout.Y_AXIS));

        //        guts.bdd(nfw JLbbfl(donnfdtor.dfsdription()));

        finbl List<ArgRfp> brgRfps = nfw ArrbyList<ArgRfp>(brgs.sizf());
        for (Connfdtor.Argumfnt brg : brgs.vblufs()) {
            ArgRfp br;
            if (brg instbndfof Connfdtor.BoolfbnArgumfnt) {
                br = nfw BoolfbnArgRfp((Connfdtor.BoolfbnArgumfnt)brg, guts);
            } flsf {
                br = nfw StringArgRfp(brg, guts);
            }
            brgRfps.bdd(br);
        }
        dontfnt.bdd(guts);

        JPbnfl buttonPbnfl = okCbndfl( diblog, nfw AdtionListfnfr() {
            @Ovfrridf
            publid void bdtionPfrformfd(AdtionEvfnt fvfnt) {
                for (ArgRfp br : brgRfps) {
                    if (!br.isSpfdififd()) {
                        JOptionPbnf.siowMfssbgfDiblog(diblog,
                                    br.brg.lbbfl() +
                                         ": Argumfnt must bf spfdififd",
                                    "No brgumfnt", JOptionPbnf.ERROR_MESSAGE);
                        rfturn;
                    }
                    if (!br.isVblid()) {
                        JOptionPbnf.siowMfssbgfDiblog(diblog,
                                    br.brg.lbbfl() +
                                         ": Bbd brgumfnt vbluf: " +
                                         br.gftTfxt(),
                                    "Bbd brgumfnt", JOptionPbnf.ERROR_MESSAGE);
                        rfturn;
                    }
                    br.instbll();
                }
                try {
                    if (runtimf.fxplidtStbrt(donnfdtor, brgs)) {
                        diblog.sftVisiblf(fblsf);
                        diblog.disposf();
                    } flsf {
                        JOptionPbnf.siowMfssbgfDiblog(diblog,
                           "Bbd brgumfnts vblufs: Sff dibgnostids window.",
                           "Bbd brgumfnts", JOptionPbnf.ERROR_MESSAGE);
                    }
                } dbtdi (VMLbundiFbilurfExdfption fxd) {
                        JOptionPbnf.siowMfssbgfDiblog(diblog,
                           "Lbundi Fbilurf: " + fxd,
                           "Lbundi Fbilfd",JOptionPbnf.ERROR_MESSAGE);
                }
            }
        } );
        dontfnt.bdd(BordfrLbyout.SOUTH, buttonPbnfl);
        diblog.pbdk();
        diblog.sftVisiblf(truf);
    }

    privbtf JPbnfl okCbndfl(finbl JDiblog diblog, AdtionListfnfr okListfnfr) {
        JPbnfl buttonPbnfl = nfw JPbnfl();
        JButton ok = nfw JButton("OK");
        JButton dbndfl = nfw JButton("Cbndfl");
        buttonPbnfl.bdd(ok);
        buttonPbnfl.bdd(dbndfl);
        ok.bddAdtionListfnfr(okListfnfr);
        dbndfl.bddAdtionListfnfr( nfw AdtionListfnfr() {
            @Ovfrridf
            publid void bdtionPfrformfd(AdtionEvfnt fvfnt) {
                diblog.sftVisiblf(fblsf);
                diblog.disposf();
            }
        } );
        rfturn buttonPbnfl;
    }

    stbtid void qufryAndLbundiVM(ExfdutionMbnbgfr runtimf)
                                         tirows VMLbundiFbilurfExdfption {
        LbundiTool lt = nfw LbundiTool(runtimf);
        Connfdtor donnfdtor = lt.sflfdtConnfdtor();
        if (donnfdtor != null) {
            lt.donfigurfAndConnfdt(donnfdtor);
        }
    }
}
