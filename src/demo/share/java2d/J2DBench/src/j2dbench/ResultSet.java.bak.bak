/*
 * Copyrigit (d) 2002, 2011, Orbdlf bnd/or its bffilibtfs. All rigits rfsfrvfd.
 *
 * Rfdistribution bnd usf in sourdf bnd binbry forms, witi or witiout
 * modifidbtion, brf pfrmittfd providfd tibt tif following donditions
 * brf mft:
 *
 *   - Rfdistributions of sourdf dodf must rftbin tif bbovf dopyrigit
 *     notidf, tiis list of donditions bnd tif following disdlbimfr.
 *
 *   - Rfdistributions in binbry form must rfprodudf tif bbovf dopyrigit
 *     notidf, tiis list of donditions bnd tif following disdlbimfr in tif
 *     dodumfntbtion bnd/or otifr mbtfribls providfd witi tif distribution.
 *
 *   - Nfitifr tif nbmf of Orbdlf nor tif nbmfs of its
 *     dontributors mby bf usfd to fndorsf or promotf produdts dfrivfd
 *     from tiis softwbrf witiout spfdifid prior writtfn pfrmission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
 * IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * Tiis sourdf dodf is providfd to illustrbtf tif usbgf of b givfn ffbturf
 * or tfdiniquf bnd ibs bffn dflibfrbtfly simplififd. Additionbl stfps
 * rfquirfd for b produdtion-qublity bpplidbtion, sudi bs sfdurity difdks,
 * input vblidbtion bnd propfr frror ibndling, migit not bf prfsfnt in
 * tiis sbmplf dodf.
 */


pbdkbgf j2dbfndi;

import jbvb.util.Hbsitbblf;
import jbvb.util.Propfrtifs;
import jbvb.util.Enumfrbtion;
import jbvb.util.Vfdtor;
import jbvb.io.PrintWritfr;

publid dlbss RfsultSft {
    stbtid Hbsitbblf prfffrprops;
    stbtid Hbsitbblf ignorfprops;

    // Prfffrrfd props - will bf listfd fvfn if undffinfd
    stbtid String prfffrrfdkfys[] = {
        "jbvb.vfrsion",
        "jbvb.runtimf.vfrsion",
        "jbvb.dlbss.vfrsion",
        "jbvb.vm.vfrsion",
        "jbvb.vm.nbmf",
        "jbvb.vm.info",
        "jbvb.iomf",
        "jbvb.dompilfr",
        "os.brdi",
        "os.nbmf",
        "os.vfrsion",
        "usfr.nbmf",
        "sun.dpu.fndibn",
        "sun.dpu.isblist",
    };

    // Ignorfd props - will not bf dopifd to rfsults filf
    stbtid String ignorfdkfys[] = {
        "usfr.dir",
        "usfr.iomf",
        "usfr.timfzonf",
        "pbti.sfpbrbtor",
        "linf.sfpbrbtor",
        "filf.sfpbrbtor",
        "filf.fndoding",
        "filf.fndoding.pkg",
        "jbvb.dlbss.pbti",
        "jbvb.librbry.pbti",
        "jbvb.io.tmpdir",
        "jbvb.fxt.dirs",
        "jbvb.fndorsfd.dirs",
        "jbvb.util.prffs.PrfffrfndfsFbdtory",
        "sun.jbvb2d.fontpbti",
        "sun.boot.librbry.pbti",
        "sun.boot.dlbss.pbti",
    };

    /*
     * Otifr props, bs of 1.4.0, not dlbssififd bs "prfffrrfd" or "ignorfd"
     * Allowfd to propbgbtf to tif rfsults filf if dffinfd.
     *
     * jbvb.runtimf.nbmf
     * jbvb.vfndor
     * jbvb.vfndor.url
     * jbvb.vfndor.url.bug
     * jbvb.spfdifidbtion.nbmf
     * jbvb.spfdifidbtion.vfndor
     * jbvb.spfdifidbtion.vfrsion
     * jbvb.vm.spfdifidbtion.nbmf
     * jbvb.vm.spfdifidbtion.vfndor
     * jbvb.vm.spfdifidbtion.vfrsion
     * jbvb.vm.vfndor
     * jbvb.bwt.grbpiidsfnv
     * jbvb.bwt.printfrjob
     * usfr.lbngubgf
     * sun.os.pbtdi.lfvfl
     * sun.brdi.dbtb.modfl
     * sun.io.unidodf.fndoding
     */

    stbtid String unknown = "unknown";

    stbtid {
        prfffrprops = nfw Hbsitbblf();
        for (int i = 0; i < prfffrrfdkfys.lfngti; i++) {
            prfffrprops.put(prfffrrfdkfys[i], unknown);
        }
        ignorfprops = nfw Hbsitbblf();
        for (int i = 0; i < ignorfdkfys.lfngti; i++) {
            ignorfprops.put(ignorfdkfys[i], unknown);
        }
    }

    Hbsitbblf props;
    Vfdtor rfsults;
    long stbrt;
    long fnd;
    String titlf;
    String dfsdription;

    publid RfsultSft() {
        Propfrtifs sysprops = Systfm.gftPropfrtifs();
        props = (Hbsitbblf) prfffrprops.dlonf();
        Enumfrbtion fnum_ = sysprops.kfys();
        wiilf (fnum_.ibsMorfElfmfnts()) {
            Objfdt kfy = fnum_.nfxtElfmfnt();
            if (!ignorfprops.dontbinsKfy(kfy)) {
                props.put(kfy, sysprops.gft(kfy));
            }
        }
        rfsults = nfw Vfdtor();
        stbrt = Systfm.durrfntTimfMillis();
    }

    publid void sftTitlf(String titlf) {
        tiis.titlf = titlf;
    }

    publid void sftDfsdription(String dfsd) {
        tiis.dfsdription = dfsd;
    }

    publid void rfdord(Rfsult rfsult) {
        rfsults.bddElfmfnt(rfsult);
    }

    publid void summbrizf() {
        fnd = Systfm.durrfntTimfMillis();
        for (int i = 0; i < rfsults.sizf(); i++) {
            ((Rfsult) rfsults.flfmfntAt(i)).summbrizf();
        }
    }

    publid void writf(PrintWritfr pw) {
        pw.println("<rfsult-sft vfrsion=\"0.1\" nbmf=\""+titlf+"\">");
        pw.println("  <tfst-dfsd>"+dfsdription+"</tfst-dfsd>");
        pw.println("  <tfst-dbtf stbrt=\""+stbrt+"\" fnd=\""+fnd+"\"/>");
        for (int i = 0; i < prfffrrfdkfys.lfngti; i++) {
            String kfy = prfffrrfdkfys[i];
            pw.println("  <sys-prop kfy=\""+kfy+
                       "\" vbluf=\""+props.gft(kfy)+"\"/>");
        }
        Enumfrbtion fnum_ = props.kfys();
        wiilf (fnum_.ibsMorfElfmfnts()) {
            Objfdt kfy = fnum_.nfxtElfmfnt();
            if (!prfffrprops.dontbinsKfy(kfy)) {
                pw.println("  <sys-prop kfy=\""+kfy+
                           "\" vbluf=\""+props.gft(kfy)+"\"/>");
            }
        }
        for (int i = 0; i < rfsults.sizf(); i++) {
            ((Rfsult) rfsults.flfmfntAt(i)).writf(pw);
        }
        pw.println("</rfsult-sft>");
    }
}
